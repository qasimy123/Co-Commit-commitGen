{"prompt": " file path A: SECURITY.md | file path B: SECURITY.md\n\n@@ -1,3 +1,3 @@\n-Angular is part of Google [Open Source Software Vulnerability Reward Program](https://bughunters.google.com/about/rules/6521337925468160/google-open-source-software-vulnerability-reward-program-rules), for vulnerabilities in Angular please submit your report [here](https://bughunters.google.com/report).\n+Angular is part of Google [Open Source Software Vulnerability Reward Program](https://bughunters.google.com/about/rules/6521337925468160/google-open-source-software-vulnerability-reward-program-rules). For vulnerabilities in Angular, please submit your report [here](https://bughunters.google.com/report).\n \n-For more information on Angular's security policy visit: https://angular.io/guide/security\n+For more information, check out [Angular's security policy](https://angular.io/guide/security).\n\n---\n file path A: SECURITY.md | file path B: SECURITY.md\n\n@@ -1,3 +1,3 @@\n-To report vulnerabilities in Angular itself, email us at security@angular.io.\n+Angular is part of Google [Open Source Software Vulnerability Reward Program](https://bughunters.google.com/about/rules/6521337925468160/google-open-source-software-vulnerability-reward-program-rules), for vulnerabilities in Angular please submit your report [here](https://bughunters.google.com/report).\n \n For more information on Angular's security policy visit: https://angular.io/guide/security\n\n\n###\n\n", "completion": "build: update `SECURITY.md` to match the content of `angular/.github`"}
{"prompt": " file path A: goldens/public-api/forms/index.md | file path B: goldens/public-api/forms/index.md\n\n@@ -553,7 +553,7 @@ export interface FormRecord<TControl> {\n export class FormsModule {\n     static withConfig(opts: {\n         callSetDisabledState?: SetDisabledStateOption;\n-    }): ModuleWithProviders<ReactiveFormsModule>;\n+    }): ModuleWithProviders<FormsModule>;\n     // (undocumented)\n     static \u0275fac: i0.\u0275\u0275FactoryDeclaration<FormsModule, never>;\n     // (undocumented)\n\n---\n file path A: packages/forms/src/form_providers.ts | file path B: packages/forms/src/form_providers.ts\n\n@@ -38,7 +38,7 @@ export class FormsModule {\n    */\n   static withConfig(opts: {\n     callSetDisabledState?: SetDisabledStateOption,\n-  }): ModuleWithProviders<ReactiveFormsModule> {\n+  }): ModuleWithProviders<FormsModule> {\n     return {\n       ngModule: FormsModule,\n       providers: [{\n\n\n###\n\n", "completion": "fix(forms): Form provider FormsModule.withConfig return a FormsModule (#<issue-num>)"}
{"prompt": " file path A: packages/forms/test/directives_spec.ts | file path B: packages/forms/test/directives_spec.ts\n\n@@ -112,14 +112,14 @@ class CustomValidatorDirective implements Validator {\n \n       describe('composeValidators', () => {\n         it('should compose functions', () => {\n-          const dummy1 = (_: any /** TODO #9100 */) => ({'dummy1': true});\n-          const dummy2 = (_: any /** TODO #9100 */) => ({'dummy2': true});\n+          const dummy1 = () => ({'dummy1': true});\n+          const dummy2 = () => ({'dummy2': true});\n           const v = composeValidators([dummy1, dummy2])!;\n           expect(v(new FormControl(''))).toEqual({'dummy1': true, 'dummy2': true});\n         });\n \n         it('should compose validator directives', () => {\n-          const dummy1 = (_: any /** TODO #9100 */) => ({'dummy1': true});\n+          const dummy1 = () => ({'dummy1': true});\n           const v = composeValidators([dummy1, new CustomValidatorDirective()])!;\n           expect(v(new FormControl(''))).toEqual({'dummy1': true, 'custom': true});\n         });\n@@ -309,10 +309,10 @@ class CustomValidatorDirective implements Validator {\n     });\n \n     describe('NgForm', () => {\n-      let form: any /** TODO #9100 */;\n+      let form: NgForm;\n       let formModel: FormGroup;\n-      let loginControlDir: any /** TODO #9100 */;\n-      let personControlGroupDir: any /** TODO #9100 */;\n+      let loginControlDir: NgModel;\n+      let personControlGroupDir: NgModelGroup;\n \n       beforeEach(() => {\n         form = new NgForm([], []);\n@@ -384,7 +384,7 @@ class CustomValidatorDirective implements Validator {\n       });\n \n       it('should set up sync validator', fakeAsync(() => {\n-           const formValidator = (c: any /** TODO #9100 */) => ({'custom': true});\n+           const formValidator = () => ({'custom': true});\n            const f = new NgForm([formValidator], []);\n \n            tick();\n@@ -402,8 +402,8 @@ class CustomValidatorDirective implements Validator {\n     });\n \n     describe('FormGroupName', () => {\n-      let formModel: any /** TODO #9100 */;\n-      let controlGroupDir: any /** TODO #9100 */;\n+      let formModel: FormGroup;\n+      let controlGroupDir: FormGroupName;\n \n       beforeEach(() => {\n         formModel = new FormGroup({'login': new FormControl(null)});\n@@ -481,9 +481,9 @@ class CustomValidatorDirective implements Validator {\n     });\n \n     describe('FormControlDirective', () => {\n-      let controlDir: any /** TODO #9100 */;\n-      let control: any /** TODO #9100 */;\n-      const checkProperties = function(control: AbstractControl) {\n+      let controlDir: FormControlDirective;\n+      let control: FormControl;\n+      const checkProperties = function(control: FormControl) {\n         expect(controlDir.control).toBe(control);\n         expect(controlDir.value).toBe(control.value);\n         expect(controlDir.valid).toBe(control.valid);\n@@ -648,8 +648,8 @@ class CustomValidatorDirective implements Validator {\n     });\n \n     describe('FormControlName', () => {\n-      let formModel: any /** TODO #9100 */;\n-      let controlNameDir: any /** TODO #9100 */;\n+      let formModel: FormControl;\n+      let controlNameDir: FormControlName;\n \n       beforeEach(() => {\n         formModel = new FormControl('name');\n\n---\n file path A: packages/forms/test/form_array_spec.ts | file path B: packages/forms/test/form_array_spec.ts\n\n@@ -850,7 +850,7 @@ describe('FormArray', () => {\n \n   describe('valueChanges', () => {\n     let a: FormArray;\n-    let c1: any /** TODO #9100 */, c2: any /** TODO #9100 */;\n+    let c1: FormControl, c2: FormControl;\n \n     beforeEach(() => {\n       c1 = new FormControl('old1');\n\n---\n file path A: packages/forms/test/form_builder_spec.ts | file path B: packages/forms/test/form_builder_spec.ts\n\n@@ -11,10 +11,10 @@ import {FormBuilder, NonNullableFormBuilder, ReactiveFormsModule, UntypedFormBui\n import {of} from 'rxjs';\n \n (function() {\n-function syncValidator(_: any /** TODO #9100 */): any /** TODO #9100 */ {\n+function syncValidator() {\n   return null;\n }\n-function asyncValidator(_: any /** TODO #9100 */) {\n+function asyncValidator() {\n   return Promise.resolve(null);\n }\n \n\n---\n file path A: packages/forms/test/form_control_spec.ts | file path B: packages/forms/test/form_control_spec.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {fakeAsync, tick} from '@angular/core/testing';\n-import {FormArray, FormControl, FormGroup, Validators} from '@angular/forms';\n+import {AsyncValidatorFn, FormArray, FormControl, FormGroup, Validators} from '@angular/forms';\n \n import {asyncValidator, asyncValidatorReturningObservable} from './util';\n \n@@ -16,7 +16,7 @@ function otherAsyncValidator() {\n   return Promise.resolve({'other': true});\n }\n \n-function syncValidator(_: any /** TODO #9100 */): any /** TODO #9100 */ {\n+function syncValidator() {\n   return null;\n }\n \n@@ -1105,7 +1105,7 @@ describe('FormControl', () => {\n     it('should fire an event after the status has been updated to pending', fakeAsync(() => {\n          const c = new FormControl('old', Validators.required, asyncValidator('expected'));\n \n-         const log: any[] /** TODO #9100 */ = [];\n+         const log: string[] = [];\n          c.valueChanges.subscribe({next: (value: any) => log.push(`value: '${value}'`)});\n \n          c.statusChanges.subscribe({next: (status: any) => log.push(`status: '${status}'`)});\n@@ -1133,7 +1133,7 @@ describe('FormControl', () => {\n \n     // TODO: remove the if statement after making observable delivery sync\n     it('should update set errors and status before emitting an event', done => {\n-      c.valueChanges.subscribe((value: any /** TODO #9100 */) => {\n+      c.valueChanges.subscribe(() => {\n         expect(c.valid).toEqual(false);\n         expect(c.errors).toEqual({'required': true});\n         done();\n@@ -1507,7 +1507,8 @@ describe('FormControl', () => {\n       });\n \n       it('should throw when sync validator passed into async validator param', () => {\n-        const fn = () => new FormControl('', syncValidator, syncValidator);\n+        const fn = () =>\n+            new FormControl('', syncValidator, syncValidator as unknown as AsyncValidatorFn);\n         // test for the specific error since without the error check it would still throw an error\n         // but\n         // not a meaningful one\n\n\n###\n\n", "completion": "refactor(forms): cleanup type any in forms tests (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/events.ts | file path B: packages/router/src/events.ts\n\n@@ -19,6 +19,7 @@ import {ActivatedRouteSnapshot, RouterStateSnapshot} from './router_state';\n  * @publicApi\n  */\n export type NavigationTrigger = 'imperative'|'popstate'|'hashchange';\n+export const IMPERATIVE_NAVIGATION = 'imperative';\n \n /**\n  * Identifies the type of a router event.\n\n---\n file path A: packages/router/src/navigation_transition.ts | file path B: packages/router/src/navigation_transition.ts\n\n@@ -11,7 +11,7 @@ import {BehaviorSubject, combineLatest, EMPTY, Observable, of, Subject} from 'rx\n import {catchError, defaultIfEmpty, filter, finalize, map, switchMap, take, tap} from 'rxjs/operators';\n \n import {createRouterState} from './create_router_state';\n-import {Event, GuardsCheckEnd, GuardsCheckStart, NavigationCancel, NavigationCancellationCode, NavigationEnd, NavigationError, NavigationSkipped, NavigationSkippedCode, NavigationStart, NavigationTrigger, ResolveEnd, ResolveStart, RouteConfigLoadEnd, RouteConfigLoadStart, RoutesRecognized} from './events';\n+import {Event, GuardsCheckEnd, GuardsCheckStart, IMPERATIVE_NAVIGATION, NavigationCancel, NavigationCancellationCode, NavigationEnd, NavigationError, NavigationSkipped, NavigationSkippedCode, NavigationStart, NavigationTrigger, ResolveEnd, ResolveStart, RouteConfigLoadEnd, RouteConfigLoadStart, RoutesRecognized} from './events';\n import {NavigationBehaviorOptions, QueryParamsHandling, Route, Routes} from './models';\n import {isNavigationCancelingError, isRedirectingNavigationCancelingError, redirectingNavigationError} from './navigation_canceling_error';\n import {activateRoutes} from './operators/activate_routes';\n@@ -335,7 +335,7 @@ export class NavigationTransitions {\n       resolve: null,\n       reject: null,\n       promise: Promise.resolve(true),\n-      source: 'imperative',\n+      source: IMPERATIVE_NAVIGATION,\n       restoredState: null,\n       currentSnapshot: router.routerState.snapshot,\n       targetSnapshot: null,\n@@ -726,11 +726,12 @@ export class NavigationTransitions {\n                                      isBrowserTriggeredNavigation(overallTransitionState.source)\n                                };\n \n-                               router.scheduleNavigation(mergedTree, 'imperative', null, extras, {\n-                                 resolve: overallTransitionState.resolve,\n-                                 reject: overallTransitionState.reject,\n-                                 promise: overallTransitionState.promise\n-                               });\n+                               router.scheduleNavigation(\n+                                   mergedTree, IMPERATIVE_NAVIGATION, null, extras, {\n+                                     resolve: overallTransitionState.resolve,\n+                                     reject: overallTransitionState.reject,\n+                                     promise: overallTransitionState.promise\n+                                   });\n                              }\n \n                              /* All other errors should reset to the router's internal URL reference\n@@ -764,6 +765,6 @@ export class NavigationTransitions {\n   }\n }\n \n-export function isBrowserTriggeredNavigation(source: 'imperative'|'popstate'|'hashchange') {\n-  return source !== 'imperative';\n+export function isBrowserTriggeredNavigation(source: NavigationTrigger) {\n+  return source !== IMPERATIVE_NAVIGATION;\n }\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -12,7 +12,7 @@ import {Observable, of, SubscriptionLike} from 'rxjs';\n \n import {CreateUrlTreeStrategy} from './create_url_tree_strategy';\n import {RuntimeErrorCode} from './errors';\n-import {Event, NavigationTrigger} from './events';\n+import {Event, IMPERATIVE_NAVIGATION, NavigationTrigger} from './events';\n import {NavigationBehaviorOptions, OnSameUrlNavigation, Routes} from './models';\n import {Navigation, NavigationExtras, NavigationTransition, NavigationTransitions, RestoredState, UrlCreationOptions} from './navigation_transition';\n import {TitleStrategy} from './page_title_strategy';\n@@ -354,7 +354,8 @@ export class Router {\n   initialNavigation(): void {\n     this.setUpLocationChangeListener();\n     if (!this.navigationTransitions.hasRequestedNavigation) {\n-      this.navigateByUrl(this.location.path(true), {replaceUrl: true});\n+      const state = this.location.getState() as RestoredState;\n+      this.navigateToSyncWithBrowser(this.location.path(true), IMPERATIVE_NAVIGATION, state);\n     }\n   }\n \n@@ -374,37 +375,49 @@ export class Router {\n           // The `setTimeout` was added in #12160 and is likely to support Angular/AngularJS\n           // hybrid apps.\n           setTimeout(() => {\n-            const extras: NavigationExtras = {replaceUrl: true};\n-\n-            // TODO: restoredState should always include the entire state, regardless\n-            // of navigationId. This requires a breaking change to update the type on\n-            // NavigationStart\u2019s restoredState, which currently requires navigationId\n-            // to always be present. The Router used to only restore history state if\n-            // a navigationId was present.\n-\n-            // The stored navigationId is used by the RouterScroller to retrieve the scroll\n-            // position for the page.\n-            const restoredState = event.state?.navigationId ? event.state : null;\n-\n-            // Separate to NavigationStart.restoredState, we must also restore the state to\n-            // history.state and generate a new navigationId, since it will be overwritten\n-            if (event.state) {\n-              const stateCopy = {...event.state} as Partial<RestoredState>;\n-              delete stateCopy.navigationId;\n-              delete stateCopy.\u0275routerPageId;\n-              if (Object.keys(stateCopy).length !== 0) {\n-                extras.state = stateCopy;\n-              }\n-            }\n-\n-            const urlTree = this.parseUrl(event['url']!);\n-            this.scheduleNavigation(urlTree, source, restoredState, extras);\n+            this.navigateToSyncWithBrowser(event['url']!, source, event.state);\n           }, 0);\n         }\n       });\n     }\n   }\n \n+  /**\n+   * Schedules a router navigation to synchronize Router state with the browser state.\n+   *\n+   * This is done as a response to a popstate event and the initial navigation. These\n+   * two scenarios represent times when the browser URL/state has been updated and\n+   * the Router needs to respond to ensure its internal state matches.\n+   */\n+  private navigateToSyncWithBrowser(\n+      url: string, source: NavigationTrigger, state: RestoredState|undefined) {\n+    const extras: NavigationExtras = {replaceUrl: true};\n+\n+    // TODO: restoredState should always include the entire state, regardless\n+    // of navigationId. This requires a breaking change to update the type on\n+    // NavigationStart\u2019s restoredState, which currently requires navigationId\n+    // to always be present. The Router used to only restore history state if\n+    // a navigationId was present.\n+\n+    // The stored navigationId is used by the RouterScroller to retrieve the scroll\n+    // position for the page.\n+    const restoredState = state?.navigationId ? state : null;\n+\n+    // Separate to NavigationStart.restoredState, we must also restore the state to\n+    // history.state and generate a new navigationId, since it will be overwritten\n+    if (state) {\n+      const stateCopy = {...state} as Partial<RestoredState>;\n+      delete stateCopy.navigationId;\n+      delete stateCopy.\u0275routerPageId;\n+      if (Object.keys(stateCopy).length !== 0) {\n+        extras.state = stateCopy;\n+      }\n+    }\n+\n+    const urlTree = this.parseUrl(url);\n+    this.scheduleNavigation(urlTree, source, restoredState, extras);\n+  }\n+\n   /** The current URL. */\n   get url(): string {\n     return this.serializeUrl(this.currentUrlTree);\n@@ -562,7 +575,7 @@ export class Router {\n     const urlTree = isUrlTree(url) ? url : this.parseUrl(url);\n     const mergedTree = this.urlHandlingStrategy.merge(urlTree, this.rawUrlTree);\n \n-    return this.scheduleNavigation(mergedTree, 'imperative', null, extras);\n+    return this.scheduleNavigation(mergedTree, IMPERATIVE_NAVIGATION, null, extras);\n   }\n \n   /**\n@@ -687,10 +700,6 @@ export class Router {\n \n     let targetPageId: number;\n     if (this.canceledNavigationResolution === 'computed') {\n-      const isInitialPage = this.currentPageId === 0;\n-      if (isInitialPage) {\n-        restoredState = this.location.getState() as RestoredState | null;\n-      }\n       // If the `\u0275routerPageId` exist in the state then `targetpageId` should have the value of\n       // `\u0275routerPageId`. This is the case for something like a page refresh where we assign the\n       // target id to the previously set value for that page.\n\n\n###\n\n", "completion": "fix(router): page refresh should not destroy history state (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/property-binding/src/app/item-detail/item-detail.component.ts | file path B: aio/content/examples/property-binding/src/app/item-detail/item-detail.component.ts\n\n@@ -7,7 +7,7 @@ import { Component, OnInit, Input } from '@angular/core';\n   templateUrl: './item-detail.component.html',\n   styleUrls: ['./item-detail.component.css']\n })\n-export class ItemDetailComponent implements OnInit {\n+export class ItemDetailComponent {\n \n   // #docregion input-type\n   @Input() childItem = '';\n@@ -18,9 +18,4 @@ export class ItemDetailComponent implements OnInit {\n \n   currentItem = 'bananas in boxes';\n \n-  constructor() { }\n-\n-  ngOnInit() {\n-  }\n-\n }\n\n---\n file path A: aio/content/examples/property-binding/src/app/item-list/item-list.component.ts | file path B: aio/content/examples/property-binding/src/app/item-list/item-list.component.ts\n\n@@ -12,6 +12,5 @@ export class ItemListComponent {\n   // #docregion item-input\n   @Input() items: Item[] = [];\n   // #enddocregion item-input\n-  constructor() { }\n \n }\n\n---\n file path A: aio/content/examples/two-way-binding/src/app/app.component.ts | file path B: aio/content/examples/two-way-binding/src/app/app.component.ts\n\n@@ -6,7 +6,6 @@ import { Component } from '@angular/core';\n   styleUrls: ['./app.component.css']\n })\n export class AppComponent {\n-  constructor() { }\n   // #docregion font-size\n   fontSizePx = 16;\n   // #enddocregion font-size\n\n---\n file path A: aio/content/examples/upgrade-lazy-load-ajs/src/app/home/home.component.ts | file path B: aio/content/examples/upgrade-lazy-load-ajs/src/app/home/home.component.ts\n\n@@ -1,15 +1,10 @@\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n \n @Component({\n   selector: 'app-home',\n   templateUrl: './home.component.html',\n   styleUrls: ['./home.component.css']\n })\n-export class HomeComponent implements OnInit {\n-\n-  constructor() { }\n-\n-  ngOnInit() {\n-  }\n+export class HomeComponent {\n \n }\n\n---\n file path A: aio/content/start/start-data.md | file path B: aio/content/start/start-data.md\n\n@@ -115,9 +115,6 @@ For customers to see their cart, you can create the cart view in two steps:\n \n     <code-example header=\"src/app/cart/cart.component.ts\" path=\"getting-started/src/app/cart/cart.component.1.ts\"></code-example>\n \n-    StackBlitz also generates an `ngOnInit()` by default in components.\n-    You can ignore the `CartComponent` `ngOnInit()` for this tutorial.\n-\n 1.  Notice that the newly created `CartComponent` is added to the module's `declarations` in `app.module.ts`.\n \n     <code-example header=\"src/app/app.module.ts\" path=\"getting-started/src/app/app.module.ts\" region=\"declare-cart\"></code-example>\n\n\n###\n\n", "completion": "docs: remove empty constructors & ngOnInit() (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/toh-pt1/src/app/heroes/heroes.component.ts | file path B: aio/content/examples/toh-pt1/src/app/heroes/heroes.component.ts\n\n@@ -1,6 +1,6 @@\n // #docplaster\n // #docregion, v1\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n // #enddocregion v1\n import { Hero } from '../hero';\n // #docregion v1\n@@ -10,7 +10,7 @@ import { Hero } from '../hero';\n   templateUrl: './heroes.component.html',\n   styleUrls: ['./heroes.component.css']\n })\n-export class HeroesComponent implements OnInit {\n+export class HeroesComponent {\n   // #enddocregion, v1\n   /*\n   // #docregion add-hero\n@@ -23,11 +23,5 @@ export class HeroesComponent implements OnInit {\n     name: 'Windstorm'\n   };\n   // #docregion v1\n-\n-  constructor() { }\n-\n-  ngOnInit(): void {\n-  }\n-\n }\n // #enddocregion, v1\n\n---\n file path A: aio/content/examples/toh-pt2/src/app/heroes/heroes.component.ts | file path B: aio/content/examples/toh-pt2/src/app/heroes/heroes.component.ts\n\n@@ -1,4 +1,4 @@\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n import { Hero } from '../hero';\n // #docregion import-heroes\n import { HEROES } from '../mock-heroes';\n@@ -14,7 +14,7 @@ import { HEROES } from '../mock-heroes';\n // #enddocregion metadata\n \n // #docregion component\n-export class HeroesComponent implements OnInit {\n+export class HeroesComponent {\n \n   heroes = HEROES;\n   // #enddocregion component\n@@ -22,11 +22,6 @@ export class HeroesComponent implements OnInit {\n   selectedHero?: Hero;\n  // #enddocregion on-select\n \n-  constructor() { }\n-\n-  ngOnInit(): void {\n-  }\n-\n   // #docregion on-select\n   onSelect(hero: Hero): void {\n     this.selectedHero = hero;\n\n---\n file path A: aio/content/examples/toh-pt3/src/app/hero-detail/hero-detail.component.ts | file path B: aio/content/examples/toh-pt3/src/app/hero-detail/hero-detail.component.ts\n\n@@ -1,6 +1,6 @@\n // #docregion\n // #docregion import-input\n-import { Component, OnInit, Input } from '@angular/core';\n+import { Component, Input } from '@angular/core';\n // #enddocregion import-input\n // #docregion import-hero\n import { Hero } from '../hero';\n@@ -11,14 +11,8 @@ import { Hero } from '../hero';\n   templateUrl: './hero-detail.component.html',\n   styleUrls: ['./hero-detail.component.css']\n })\n-export class HeroDetailComponent implements OnInit {\n+export class HeroDetailComponent {\n   // #docregion input-hero\n   @Input() hero?: Hero;\n   // #enddocregion input-hero\n-\n-  constructor() { }\n-\n-  ngOnInit(): void {\n-  }\n-\n }\n\n---\n file path A: aio/content/examples/toh-pt4/src/app/messages/messages.component.ts | file path B: aio/content/examples/toh-pt4/src/app/messages/messages.component.ts\n\n@@ -1,5 +1,5 @@\n // #docregion\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n // #docregion import-message-service\n import { MessageService } from '../message.service';\n // #enddocregion import-message-service\n@@ -9,13 +9,10 @@ import { MessageService } from '../message.service';\n   templateUrl: './messages.component.html',\n   styleUrls: ['./messages.component.css']\n })\n-export class MessagesComponent implements OnInit {\n+export class MessagesComponent {\n \n   // #docregion ctor\n   constructor(public messageService: MessageService) {}\n   // #enddocregion ctor\n \n-  ngOnInit() {\n-  }\n-\n }\n\n---\n file path A: aio/content/examples/toh-pt5/src/app/messages/messages.component.ts | file path B: aio/content/examples/toh-pt5/src/app/messages/messages.component.ts\n\n@@ -1,4 +1,4 @@\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n import { MessageService } from '../message.service';\n \n @Component({\n@@ -6,11 +6,8 @@ import { MessageService } from '../message.service';\n   templateUrl: './messages.component.html',\n   styleUrls: ['./messages.component.css']\n })\n-export class MessagesComponent implements OnInit {\n+export class MessagesComponent {\n \n   constructor(public messageService: MessageService) {}\n \n-  ngOnInit() {\n-  }\n-\n }\n\n---\n file path A: aio/content/examples/toh-pt6/src/app/messages/messages.component.ts | file path B: aio/content/examples/toh-pt6/src/app/messages/messages.component.ts\n\n@@ -1,4 +1,4 @@\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n import { MessageService } from '../message.service';\n \n @Component({\n@@ -6,11 +6,8 @@ import { MessageService } from '../message.service';\n   templateUrl: './messages.component.html',\n   styleUrls: ['./messages.component.css']\n })\n-export class MessagesComponent implements OnInit {\n+export class MessagesComponent {\n \n   constructor(public messageService: MessageService) {}\n \n-  ngOnInit() {\n-  }\n-\n }\n\n---\n file path A: aio/content/tutorial/tour-of-heroes/toh-pt1.md | file path B: aio/content/tutorial/tour-of-heroes/toh-pt1.md\n\n@@ -41,10 +41,6 @@ You always import the `Component` symbol from the Angular core library and annot\n \n The [CSS element selector](https://developer.mozilla.org/docs/Web/CSS/Type_selectors), `'app-heroes'`, matches the name of the HTML element that identifies this component within a parent component's template.\n \n-The `ngOnInit()` is a [lifecycle hook](guide/lifecycle-hooks#oninit).\n-Angular calls `ngOnInit()` shortly after creating a component.\n-It's a good place to put initialization logic.\n-\n Always `export` the component class so you can `import` it elsewhere &hellip; like in the `AppModule`.\n \n ### Add a `hero` property\n\n\n###\n\n", "completion": "docs: remove onInit from Tour Of Heroes. (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/deprecations.md | file path B: aio/content/guide/deprecations.md\n\n@@ -398,10 +398,9 @@ available in `RouterModule.forRoot` or `provideRouter` and `withRouterConfig`.\n * `canceledNavigationResolution`\n * `errorHandler`\n \n-The following options are available in `RouterModule.forRoot` but not\n-available in `provideRouter`:\n-* `malformedUriErrorHandler` - This was not found to be used by anyone.\n-  There are currently no plans to make this available in `provideRouter`.\n+The following options are deprecated in entirely:\n+* `malformedUriErrorHandler` - URI parsing errors should be handled in the `UrlSerializer` instead.\n+* `errorHandler` - Subscribe to the `Router` events and filter for `NavigationError` instead.\n \n <a id=\"router-can-load\"></a>\n \n\n---\n file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -246,9 +246,6 @@ export type DisabledInitialNavigationFeature = RouterFeature<RouterFeatureKind.D\n // @public\n export type EnabledBlockingInitialNavigationFeature = RouterFeature<RouterFeatureKind.EnabledBlockingInitialNavigationFeature>;\n \n-// @public\n-export type ErrorHandlerFeature = RouterFeature<RouterFeatureKind.NavigationErrorHandlerFeature>;\n-\n // @public\n type Event_2 = RouterEvent | NavigationStart | NavigationEnd | NavigationCancel | NavigationError | RoutesRecognized | GuardsCheckStart | GuardsCheckEnd | RouteConfigLoadStart | RouteConfigLoadEnd | ChildActivationStart | ChildActivationEnd | ActivationStart | ActivationEnd | Scroll | ResolveStart | ResolveEnd | NavigationSkipped;\n export { Event_2 as Event }\n@@ -294,8 +291,10 @@ export const enum EventType {\n // @public\n export interface ExtraOptions extends InMemoryScrollingOptions, RouterConfigOptions {\n     enableTracing?: boolean;\n-    errorHandler?: ErrorHandler;\n+    // @deprecated\n+    errorHandler?: (error: any) => any;\n     initialNavigation?: InitialNavigation;\n+    // @deprecated\n     malformedUriErrorHandler?: (error: URIError, urlSerializer: UrlSerializer, url: string) => UrlTree;\n     preloadingStrategy?: any;\n     scrollOffset?: [number, number] | (() => [number, number]);\n@@ -442,6 +441,9 @@ export class NavigationError extends RouterEvent {\n     readonly type = EventType.NavigationError;\n }\n \n+// @public\n+export type NavigationErrorHandlerFeature = RouterFeature<RouterFeatureKind.NavigationErrorHandlerFeature>;\n+\n // @public\n export interface NavigationExtras extends UrlCreationOptions, NavigationBehaviorOptions {\n }\n@@ -665,7 +667,7 @@ export class Router {\n     createUrlTree(commands: any[], navigationExtras?: UrlCreationOptions): UrlTree;\n     dispose(): void;\n     // @deprecated\n-    errorHandler: ErrorHandler;\n+    errorHandler: (error: any) => any;\n     get events(): Observable<Event_2>;\n     getCurrentNavigation(): Navigation | null;\n     initialNavigation(): void;\n@@ -751,7 +753,7 @@ export interface RouterFeature<FeatureKind extends RouterFeatureKind> {\n }\n \n // @public\n-export type RouterFeatures = PreloadingFeature | DebugTracingFeature | InitialNavigationFeature | InMemoryScrollingFeature | RouterConfigurationFeature | ErrorHandlerFeature;\n+export type RouterFeatures = PreloadingFeature | DebugTracingFeature | InitialNavigationFeature | InMemoryScrollingFeature | RouterConfigurationFeature | NavigationErrorHandlerFeature;\n \n // @public\n export type RouterHashLocationFeature = RouterFeature<RouterFeatureKind.RouterHashLocationFeature>;\n@@ -1074,15 +1076,15 @@ export function withDisabledInitialNavigation(): DisabledInitialNavigationFeatur\n // @public\n export function withEnabledBlockingInitialNavigation(): EnabledBlockingInitialNavigationFeature;\n \n-// @public\n-export function withErrorHandler(fn: (error: NavigationError) => void): ErrorHandlerFeature;\n-\n // @public\n export function withHashLocation(): RouterConfigurationFeature;\n \n // @public\n export function withInMemoryScrolling(options?: InMemoryScrollingOptions): InMemoryScrollingFeature;\n \n+// @public\n+export function withNavigationErrorHandler(fn: (error: NavigationError) => void): NavigationErrorHandlerFeature;\n+\n // @public\n export function withPreloading(preloadingStrategy: Type<PreloadingStrategy>): PreloadingFeature;\n \n\n---\n file path A: packages/router/src/index.ts | file path B: packages/router/src/index.ts\n\n@@ -15,7 +15,7 @@ export {ActivationEnd, ActivationStart, ChildActivationEnd, ChildActivationStart\n export {CanActivate, CanActivateChild, CanActivateChildFn, CanActivateFn, CanDeactivate, CanDeactivateFn, CanLoad, CanLoadFn, CanMatch, CanMatchFn, Data, DefaultExport, LoadChildren, LoadChildrenCallback, NavigationBehaviorOptions, OnSameUrlNavigation, QueryParamsHandling, Resolve, ResolveData, ResolveFn, Route, Routes, RunGuardsAndResolvers, UrlMatcher, UrlMatchResult} from './models';\n export {Navigation, NavigationExtras, UrlCreationOptions} from './navigation_transition';\n export {DefaultTitleStrategy, TitleStrategy} from './page_title_strategy';\n-export {DebugTracingFeature, DisabledInitialNavigationFeature, EnabledBlockingInitialNavigationFeature, InitialNavigationFeature, InMemoryScrollingFeature, NavigationErrorHandlerFeature as ErrorHandlerFeature, PreloadingFeature, provideRouter, provideRoutes, RouterConfigurationFeature, RouterFeature, RouterFeatures, RouterHashLocationFeature, withDebugTracing, withDisabledInitialNavigation, withEnabledBlockingInitialNavigation, withHashLocation, withInMemoryScrolling, withNavigationErrorHandler as withErrorHandler, withPreloading, withRouterConfig} from './provide_router';\n+export {DebugTracingFeature, DisabledInitialNavigationFeature, EnabledBlockingInitialNavigationFeature, InitialNavigationFeature, InMemoryScrollingFeature, NavigationErrorHandlerFeature, PreloadingFeature, provideRouter, provideRoutes, RouterConfigurationFeature, RouterFeature, RouterFeatures, RouterHashLocationFeature, withDebugTracing, withDisabledInitialNavigation, withEnabledBlockingInitialNavigation, withHashLocation, withInMemoryScrolling, withNavigationErrorHandler, withPreloading, withRouterConfig} from './provide_router';\n export {BaseRouteReuseStrategy, DetachedRouteHandle, RouteReuseStrategy} from './route_reuse_strategy';\n export {Router} from './router';\n export {ExtraOptions, InitialNavigation, InMemoryScrollingOptions, ROUTER_CONFIGURATION, RouterConfigOptions} from './router_config';\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -7,8 +7,8 @@\n  */\n \n import {Location} from '@angular/common';\n-import {Compiler, inject, Injectable, Injector, NgZone, Type, \u0275Console as Console, \u0275RuntimeError as RuntimeError} from '@angular/core';\n-import {BehaviorSubject, Observable, of, SubscriptionLike} from 'rxjs';\n+import {inject, Injectable, NgZone, Type, \u0275Console as Console, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {Observable, of, SubscriptionLike} from 'rxjs';\n \n import {CreateUrlTreeStrategy} from './create_url_tree_strategy';\n import {RuntimeErrorCode} from './errors';\n@@ -17,9 +17,8 @@ import {NavigationBehaviorOptions, OnSameUrlNavigation, Routes} from './models';\n import {Navigation, NavigationExtras, NavigationTransition, NavigationTransitions, RestoredState, UrlCreationOptions} from './navigation_transition';\n import {TitleStrategy} from './page_title_strategy';\n import {RouteReuseStrategy} from './route_reuse_strategy';\n-import {ErrorHandler, ExtraOptions, ROUTER_CONFIGURATION} from './router_config';\n+import {ROUTER_CONFIGURATION} from './router_config';\n import {ROUTES} from './router_config_loader';\n-import {ChildrenOutletContexts} from './router_outlet_context';\n import {createEmptyState, RouterState} from './router_state';\n import {Params} from './shared';\n import {UrlHandlingStrategy} from './url_handling_strategy';\n@@ -180,6 +179,8 @@ export class Router {\n    * A handler for navigation errors in this NgModule.\n    *\n    * @deprecated Subscribe to the `Router` events and watch for `NavigationError` instead.\n+   *   `provideRouter` has the `withErrorHandler` feature to make this easier.\n+   * @see `withErrorHandler`\n    */\n   errorHandler = this.options.errorHandler || defaultErrorHandler;\n \n@@ -189,8 +190,8 @@ export class Router {\n    * The most common case is a `%` sign\n    * that's not encoded and is not part of a percent encoded sequence.\n    *\n-   * @deprecated Configure this through `RouterModule.forRoot` instead:\n-   *   `RouterModule.forRoot(routes, {malformedUriErrorHandler: myHandler})`\n+   * @deprecated URI parsing errors should be handled in the `UrlSerializer`.\n+   *\n    * @see `RouterModule`\n    */\n   malformedUriErrorHandler =\n\n---\n file path A: packages/router/src/router_config.ts | file path B: packages/router/src/router_config.ts\n\n@@ -21,6 +21,7 @@ const NG_DEV_MODE = typeof ngDevMode === 'undefined' || !!ngDevMode;\n  * the exception.\n  *\n  * @publicApi\n+ * @deprecated Subscribe to the `Router` events and watch for `NavigationError` instead.\n  */\n export type ErrorHandler = (error: any) => any;\n \n@@ -202,8 +203,9 @@ export interface ExtraOptions extends InMemoryScrollingOptions, RouterConfigOpti\n    * If the handler returns a value, the navigation Promise is resolved with this value.\n    * If the handler throws an exception, the navigation Promise is rejected with the exception.\n    *\n+   * @deprecated Subscribe to the `Router` events and watch for `NavigationError` instead.\n    */\n-  errorHandler?: ErrorHandler;\n+  errorHandler?: (error: any) => any;\n \n   /**\n    * Configures a preloading strategy.\n@@ -230,6 +232,8 @@ export interface ExtraOptions extends InMemoryScrollingOptions, RouterConfigOpti\n    * - `'URIError'` - Error thrown when parsing a bad URL.\n    * - `'UrlSerializer'` - UrlSerializer that\u2019s configured with the router.\n    * - `'url'` -  The malformed URL that caused the URIError\n+   *\n+   * @deprecated URI parsing errors should be handled in the `UrlSerializer` instead.\n    * */\n   malformedUriErrorHandler?:\n       (error: URIError, urlSerializer: UrlSerializer, url: string) => UrlTree;\n\n\n###\n\n", "completion": "docs(router): Clean up error handler deprecations (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/deprecations.md | file path B: aio/content/guide/deprecations.md\n\n@@ -396,13 +396,12 @@ available in `RouterModule.forRoot` or `provideRouter` and `withRouterConfig`.\n * `paramsInheritanceStrategy`\n * `urlUpdateStrategy`\n * `canceledNavigationResolution`\n+* `errorHandler`\n \n The following options are available in `RouterModule.forRoot` but not\n available in `provideRouter`:\n * `malformedUriErrorHandler` - This was not found to be used by anyone.\n   There are currently no plans to make this available in `provideRouter`.\n-* `errorHandler` - Developers should instead subscribe to `Router.events`\n-  and filter for `NavigationError`.\n \n <a id=\"router-can-load\"></a>\n \n\n---\n file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -246,6 +246,9 @@ export type DisabledInitialNavigationFeature = RouterFeature<RouterFeatureKind.D\n // @public\n export type EnabledBlockingInitialNavigationFeature = RouterFeature<RouterFeatureKind.EnabledBlockingInitialNavigationFeature>;\n \n+// @public\n+export type ErrorHandlerFeature = RouterFeature<RouterFeatureKind.NavigationErrorHandlerFeature>;\n+\n // @public\n type Event_2 = RouterEvent | NavigationStart | NavigationEnd | NavigationCancel | NavigationError | RoutesRecognized | GuardsCheckStart | GuardsCheckEnd | RouteConfigLoadStart | RouteConfigLoadEnd | ChildActivationStart | ChildActivationEnd | ActivationStart | ActivationEnd | Scroll | ResolveStart | ResolveEnd | NavigationSkipped;\n export { Event_2 as Event }\n@@ -748,7 +751,7 @@ export interface RouterFeature<FeatureKind extends RouterFeatureKind> {\n }\n \n // @public\n-export type RouterFeatures = PreloadingFeature | DebugTracingFeature | InitialNavigationFeature | InMemoryScrollingFeature | RouterConfigurationFeature;\n+export type RouterFeatures = PreloadingFeature | DebugTracingFeature | InitialNavigationFeature | InMemoryScrollingFeature | RouterConfigurationFeature | ErrorHandlerFeature;\n \n // @public\n export type RouterHashLocationFeature = RouterFeature<RouterFeatureKind.RouterHashLocationFeature>;\n@@ -1071,6 +1074,9 @@ export function withDisabledInitialNavigation(): DisabledInitialNavigationFeatur\n // @public\n export function withEnabledBlockingInitialNavigation(): EnabledBlockingInitialNavigationFeature;\n \n+// @public\n+export function withErrorHandler(fn: (error: NavigationError) => void): ErrorHandlerFeature;\n+\n // @public\n export function withHashLocation(): RouterConfigurationFeature;\n \n\n---\n file path A: packages/router/src/index.ts | file path B: packages/router/src/index.ts\n\n@@ -15,7 +15,7 @@ export {ActivationEnd, ActivationStart, ChildActivationEnd, ChildActivationStart\n export {CanActivate, CanActivateChild, CanActivateChildFn, CanActivateFn, CanDeactivate, CanDeactivateFn, CanLoad, CanLoadFn, CanMatch, CanMatchFn, Data, DefaultExport, LoadChildren, LoadChildrenCallback, NavigationBehaviorOptions, OnSameUrlNavigation, QueryParamsHandling, Resolve, ResolveData, ResolveFn, Route, Routes, RunGuardsAndResolvers, UrlMatcher, UrlMatchResult} from './models';\n export {Navigation, NavigationExtras, UrlCreationOptions} from './navigation_transition';\n export {DefaultTitleStrategy, TitleStrategy} from './page_title_strategy';\n-export {DebugTracingFeature, DisabledInitialNavigationFeature, EnabledBlockingInitialNavigationFeature, InitialNavigationFeature, InMemoryScrollingFeature, PreloadingFeature, provideRouter, provideRoutes, RouterConfigurationFeature, RouterFeature, RouterFeatures, RouterHashLocationFeature, withDebugTracing, withDisabledInitialNavigation, withEnabledBlockingInitialNavigation, withHashLocation, withInMemoryScrolling, withPreloading, withRouterConfig} from './provide_router';\n+export {DebugTracingFeature, DisabledInitialNavigationFeature, EnabledBlockingInitialNavigationFeature, InitialNavigationFeature, InMemoryScrollingFeature, NavigationErrorHandlerFeature as ErrorHandlerFeature, PreloadingFeature, provideRouter, provideRoutes, RouterConfigurationFeature, RouterFeature, RouterFeatures, RouterHashLocationFeature, withDebugTracing, withDisabledInitialNavigation, withEnabledBlockingInitialNavigation, withHashLocation, withInMemoryScrolling, withNavigationErrorHandler as withErrorHandler, withPreloading, withRouterConfig} from './provide_router';\n export {BaseRouteReuseStrategy, DetachedRouteHandle, RouteReuseStrategy} from './route_reuse_strategy';\n export {Router} from './router';\n export {ExtraOptions, InitialNavigation, InMemoryScrollingOptions, ROUTER_CONFIGURATION, RouterConfigOptions} from './router_config';\n\n---\n file path A: packages/router/src/provide_router.ts | file path B: packages/router/src/provide_router.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {HashLocationStrategy, LOCATION_INITIALIZED, LocationStrategy, ViewportScroller} from '@angular/common';\n-import {APP_BOOTSTRAP_LISTENER, APP_INITIALIZER, ApplicationRef, ComponentRef, ENVIRONMENT_INITIALIZER, EnvironmentProviders, inject, InjectFlags, InjectionToken, Injector, makeEnvironmentProviders, NgZone, Provider, Type} from '@angular/core';\n+import {APP_BOOTSTRAP_LISTENER, APP_INITIALIZER, ApplicationRef, ComponentRef, ENVIRONMENT_INITIALIZER, EnvironmentInjector, EnvironmentProviders, inject, InjectFlags, InjectionToken, Injector, makeEnvironmentProviders, NgZone, Provider, Type} from '@angular/core';\n import {of, Subject} from 'rxjs';\n import {filter, map, take} from 'rxjs/operators';\n \n@@ -621,6 +621,63 @@ export function withHashLocation(): RouterConfigurationFeature {\n   return routerFeature(RouterFeatureKind.RouterConfigurationFeature, providers);\n }\n \n+/**\n+ * A type alias for providers returned by `withNavigationErrorHandler` for use with `provideRouter`.\n+ *\n+ * @see `withNavigationErrorHandler`\n+ * @see `provideRouter`\n+ *\n+ * @publicApi\n+ */\n+export type NavigationErrorHandlerFeature =\n+    RouterFeature<RouterFeatureKind.NavigationErrorHandlerFeature>;\n+\n+/**\n+ * Subscribes to the Router's navigation events and calls the given function when a\n+ * `NavigationError` happens.\n+ *\n+ * This function is run inside application's injection context so you can use the `inject` function.\n+ *\n+ * @usageNotes\n+ *\n+ * Basic example of how you can use the error handler option:\n+ * ```\n+ * const appRoutes: Routes = [];\n+ * bootstrapApplication(AppComponent,\n+ *   {\n+ *     providers: [\n+ *       provideRouter(appRoutes, withNavigationErrorHandler((e: NavigationError) =>\n+ * inject(MyErrorTracker).trackError(e))\n+ *     ]\n+ *   }\n+ * );\n+ * ```\n+ *\n+ * @see `NavigationError`\n+ * @see `inject`\n+ * @see `EnvironmentInjector#runInContext`\n+ *\n+ * @returns A set of providers for use with `provideRouter`.\n+ *\n+ * @publicApi\n+ */\n+export function withNavigationErrorHandler(fn: (error: NavigationError) => void):\n+    NavigationErrorHandlerFeature {\n+  const providers = [{\n+    provide: ENVIRONMENT_INITIALIZER,\n+    multi: true,\n+    useValue: () => {\n+      const injector = inject(EnvironmentInjector);\n+      inject(Router).events.subscribe((e) => {\n+        if (e instanceof NavigationError) {\n+          injector.runInContext(() => fn(e));\n+        }\n+      });\n+    }\n+  }];\n+  return routerFeature(RouterFeatureKind.NavigationErrorHandlerFeature, providers);\n+}\n+\n /**\n  * A type alias that represents all Router features available for use with `provideRouter`.\n  * Features can be enabled by adding special functions to the `provideRouter` call.\n@@ -632,7 +689,7 @@ export function withHashLocation(): RouterConfigurationFeature {\n  * @publicApi\n  */\n export type RouterFeatures = PreloadingFeature|DebugTracingFeature|InitialNavigationFeature|\n-    InMemoryScrollingFeature|RouterConfigurationFeature;\n+    InMemoryScrollingFeature|RouterConfigurationFeature|NavigationErrorHandlerFeature;\n \n /**\n  * The list of features as an enum to uniquely type each feature.\n@@ -644,5 +701,6 @@ export const enum RouterFeatureKind {\n   DisabledInitialNavigationFeature,\n   InMemoryScrollingFeature,\n   RouterConfigurationFeature,\n-  RouterHashLocationFeature\n+  RouterHashLocationFeature,\n+  NavigationErrorHandlerFeature,\n }\n\n---\n file path A: packages/router/test/integration.spec.ts | file path B: packages/router/test/integration.spec.ts\n\n@@ -17,7 +17,7 @@ import {concat, EMPTY, Observable, Observer, of, Subscription} from 'rxjs';\n import {delay, filter, first, last, map, mapTo, takeWhile, tap} from 'rxjs/operators';\n \n import {CanActivateChildFn, CanActivateFn, CanMatch, CanMatchFn, Data, ResolveFn} from '../src/models';\n-import {provideRouter, withRouterConfig} from '../src/provide_router';\n+import {provideRouter, withNavigationErrorHandler, withRouterConfig} from '../src/provide_router';\n import {forEach, wrapIntoObservable} from '../src/utils/collection';\n import {getLoadedRoutes} from '../src/utils/config';\n \n@@ -1668,6 +1668,29 @@ describe('Integration', () => {\n        ]);\n      })));\n \n+  it('should be able to provide an error handler with DI dependencies', async () => {\n+    @Injectable({providedIn: 'root'})\n+    class Handler {\n+      handlerCalled = false;\n+    }\n+    TestBed.configureTestingModule({\n+      providers: [\n+        provideRouter(\n+            [{\n+              path: 'throw',\n+              canMatch: [() => {\n+                throw new Error('');\n+              }],\n+              component: BlankCmp\n+            }],\n+            withNavigationErrorHandler(() => coreInject(Handler).handlerCalled = true)),\n+      ]\n+    });\n+    const router = TestBed.inject(Router);\n+    await expectAsync(router.navigateByUrl('/throw')).toBeRejected();\n+    expect(TestBed.inject(Handler).handlerCalled).toBeTrue();\n+  });\n+\n   // Errors should behave the same for both deferred and eager URL update strategies\n   ['deferred', 'eager'].forEach((strat: any) => {\n     it('should dispatch NavigationError after the url has been reset back', fakeAsync(() => {\n\n\n###\n\n", "completion": "feat(router): Add a withNavigationErrorHandler feature to provideRouter (#<issue-num>)"}
{"prompt": " file path A: packages/common/test/directives/ng_component_outlet_spec.ts | file path B: packages/common/test/directives/ng_component_outlet_spec.ts\n\n@@ -183,7 +183,7 @@ describe('insert/remove', () => {\n        fixture.componentInstance.currentComponent = Module2InjectedComponent;\n        fixture.detectChanges();\n \n-       const moduleRef = fixture.componentInstance.ngComponentOutlet['_moduleRef']!;\n+       const moduleRef = fixture.componentInstance.ngComponentOutlet?.['_moduleRef']!;\n        spyOn(moduleRef, 'destroy').and.callThrough();\n \n        expect(moduleRef.destroy).not.toHaveBeenCalled();\n@@ -197,7 +197,7 @@ describe('insert/remove', () => {\n        fixture.componentInstance.currentComponent = Module2InjectedComponent;\n        fixture.detectChanges();\n \n-       const moduleRef = fixture.componentInstance.ngComponentOutlet['_moduleRef']!;\n+       const moduleRef = fixture.componentInstance.ngComponentOutlet?.['_moduleRef']!;\n        spyOn(moduleRef, 'destroy').and.callThrough();\n \n        expect(moduleRef.destroy).not.toHaveBeenCalled();\n@@ -213,13 +213,13 @@ describe('insert/remove', () => {\n        fixture.componentInstance.currentComponent = Module2InjectedComponent;\n        fixture.detectChanges();\n        expect(fixture.nativeElement).toHaveText('baz');\n-       const moduleRef = fixture.componentInstance.ngComponentOutlet['_moduleRef'];\n+       const moduleRef = fixture.componentInstance.ngComponentOutlet?.['_moduleRef'];\n \n        fixture.componentInstance.currentComponent = Module2InjectedComponent2;\n        fixture.detectChanges();\n \n        expect(fixture.nativeElement).toHaveText('baz2');\n-       expect(moduleRef).toBe(fixture.componentInstance.ngComponentOutlet['_moduleRef']);\n+       expect(moduleRef).toBe(fixture.componentInstance.ngComponentOutlet?.['_moduleRef']);\n      }));\n \n   it('should re-create moduleRef when changed (NgModuleFactory)', waitForAsync(() => {\n@@ -322,16 +322,16 @@ class TestComponent {\n   ngModuleFactory?: NgModuleFactory<unknown>;\n \n   get cmpRef(): ComponentRef<any>|undefined {\n-    return this.ngComponentOutlet['_componentRef'];\n+    return this.ngComponentOutlet?.['_componentRef'];\n   }\n   set cmpRef(value: ComponentRef<any>|undefined) {\n-    this.ngComponentOutlet['_componentRef'] = value;\n+    if (this.ngComponentOutlet) {\n+      this.ngComponentOutlet['_componentRef'] = value;\n+    }\n   }\n \n-  // TODO(issue/24571): remove '!'.\n-  @ViewChildren(TemplateRef) tplRefs!: QueryList<TemplateRef<any>>;\n-  // TODO(issue/24571): remove '!'.\n-  @ViewChild(NgComponentOutlet, {static: true}) ngComponentOutlet!: NgComponentOutlet;\n+  @ViewChildren(TemplateRef) tplRefs: QueryList<TemplateRef<any>> = new QueryList();\n+  @ViewChild(NgComponentOutlet, {static: true}) ngComponentOutlet?: NgComponentOutlet;\n \n   constructor(public vcRef: ViewContainerRef) {}\n }\n\n---\n file path A: packages/common/test/directives/ng_template_outlet_spec.ts | file path B: packages/common/test/directives/ng_template_outlet_spec.ts\n\n@@ -338,14 +338,12 @@ class DestroyableCmpt implements OnDestroy {\n \n @Directive({selector: 'tpl-refs', exportAs: 'tplRefs'})\n class CaptureTplRefs {\n-  // TODO(issue/24571): remove '!'.\n-  @ContentChildren(TemplateRef) tplRefs!: QueryList<TemplateRef<any>>;\n+  @ContentChildren(TemplateRef) tplRefs?: QueryList<TemplateRef<any>>;\n }\n \n @Component({selector: 'test-cmp', template: ''})\n class TestComponent {\n-  // TODO(issue/24571): remove '!'.\n-  currentTplRef!: TemplateRef<any>;\n+  currentTplRef?: TemplateRef<any>;\n   context: any = {foo: 'bar'};\n   value = 'bar';\n   injector: Injector|null = null;\n\n\n###\n\n", "completion": "refactor(common): remove non-null assertions (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_for_of.ts | file path B: packages/common/src/directives/ng_for_of.ts\n\n@@ -168,12 +168,9 @@ export class NgForOf<T, U extends NgIterable<T> = NgIterable<T>> implements DoCh\n   @Input()\n   set ngForTrackBy(fn: TrackByFunction<T>) {\n     if (NG_DEV_MODE && fn != null && typeof fn !== 'function') {\n-      // TODO(vicb): use a log service once there is a public one available\n-      if (<any>console && <any>console.warn) {\n-        console.warn(\n-            `trackBy must be a function, but received ${JSON.stringify(fn)}. ` +\n-            `See https://angular.io/api/common/NgForOf#change-propagation for more information.`);\n-      }\n+      console.warn(\n+          `trackBy must be a function, but received ${JSON.stringify(fn)}. ` +\n+          `See https://angular.io/api/common/NgForOf#change-propagation for more information.`);\n     }\n     this._trackByFn = fn;\n   }\n@@ -185,7 +182,9 @@ export class NgForOf<T, U extends NgIterable<T> = NgIterable<T>> implements DoCh\n   private _ngForOf: U|undefined|null = null;\n   private _ngForOfDirty: boolean = true;\n   private _differ: IterableDiffer<T>|null = null;\n-  // TODO(issue/24571): remove '!'.\n+  // TODO(issue/24571): remove '!'\n+  // waiting for microsoft/typescript#43662 to allow the return type `TrackByFunction|undefined` for\n+  // the getter\n   private _trackByFn!: TrackByFunction<T>;\n \n   constructor(\n\n\n###\n\n", "completion": "refactor(common): code cleaning (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_plural.ts | file path B: packages/common/src/directives/ng_plural.ts\n\n@@ -12,7 +12,6 @@ import {getPluralCategory, NgLocalization} from '../i18n/localization';\n \n import {SwitchView} from './ng_switch';\n \n-\n /**\n  * @ngModule CommonModule\n  *\n@@ -49,29 +48,25 @@ import {SwitchView} from './ng_switch';\n   standalone: true,\n })\n export class NgPlural {\n-  // TODO(issue/24571): remove '!'.\n-  private _switchValue!: number;\n-  // TODO(issue/24571): remove '!'.\n-  private _activeView!: SwitchView;\n+  private _activeView?: SwitchView;\n   private _caseViews: {[k: string]: SwitchView} = {};\n \n   constructor(private _localization: NgLocalization) {}\n \n   @Input()\n   set ngPlural(value: number) {\n-    this._switchValue = value;\n-    this._updateView();\n+    this._updateView(value);\n   }\n \n   addCase(value: string, switchView: SwitchView): void {\n     this._caseViews[value] = switchView;\n   }\n \n-  private _updateView(): void {\n+  private _updateView(switchValue: number): void {\n     this._clearViews();\n \n     const cases = Object.keys(this._caseViews);\n-    const key = getPluralCategory(this._switchValue, cases, this._localization);\n+    const key = getPluralCategory(switchValue, cases, this._localization);\n     this._activateView(this._caseViews[key]);\n   }\n \n\n---\n file path A: packages/common/src/directives/ng_switch.ts | file path B: packages/common/src/directives/ng_switch.ts\n\n@@ -106,8 +106,7 @@ export class SwitchView {\n   standalone: true,\n })\n export class NgSwitch {\n-  // TODO(issue/24571): remove '!'.\n-  private _defaultViews!: SwitchView[];\n+  private _defaultViews: SwitchView[] = [];\n   private _defaultUsed = false;\n   private _caseCount = 0;\n   private _lastCaseCheckIndex = 0;\n@@ -129,9 +128,6 @@ export class NgSwitch {\n \n   /** @internal */\n   _addDefault(view: SwitchView) {\n-    if (!this._defaultViews) {\n-      this._defaultViews = [];\n-    }\n     this._defaultViews.push(view);\n   }\n \n@@ -149,10 +145,9 @@ export class NgSwitch {\n   }\n \n   private _updateDefaultCases(useDefault: boolean) {\n-    if (this._defaultViews && useDefault !== this._defaultUsed) {\n+    if (this._defaultViews.length > 0 && useDefault !== this._defaultUsed) {\n       this._defaultUsed = useDefault;\n-      for (let i = 0; i < this._defaultViews.length; i++) {\n-        const defaultView = this._defaultViews[i];\n+      for (const defaultView of this._defaultViews) {\n         defaultView.enforceState(useDefault);\n       }\n     }\n\n\n###\n\n", "completion": "refactor(common): remove non-null assertions (#<issue-num>)"}
{"prompt": " file path A: packages/router/testing/src/extra_router_testing_providers.ts | file path B: None\n\n@@ -1,10 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-// This file exists to easily patch the SpyNgModuleFactoryLoader into g3\n-export const EXTRA_ROUTER_TESTING_PROVIDERS = [];\n\n---\n file path A: packages/router/testing/src/router_testing_module.ts | file path B: packages/router/testing/src/router_testing_module.ts\n\n@@ -11,8 +11,6 @@ import {provideLocationMocks} from '@angular/common/testing';\n import {Compiler, inject, Injector, ModuleWithProviders, NgModule} from '@angular/core';\n import {ChildrenOutletContexts, ExtraOptions, NoPreloading, Route, Router, ROUTER_CONFIGURATION, RouteReuseStrategy, RouterModule, ROUTES, Routes, TitleStrategy, UrlHandlingStrategy, UrlSerializer, \u0275flatten as flatten, \u0275ROUTER_PROVIDERS as ROUTER_PROVIDERS, \u0275withPreloading as withPreloading} from '@angular/router';\n \n-import {EXTRA_ROUTER_TESTING_PROVIDERS} from './extra_router_testing_providers';\n-\n function isUrlHandlingStrategy(opts: ExtraOptions|\n                                UrlHandlingStrategy): opts is UrlHandlingStrategy {\n   // This property check is needed because UrlHandlingStrategy is an interface and doesn't exist at\n@@ -117,7 +115,6 @@ export function setupTestingRouter(\n   exports: [RouterModule],\n   providers: [\n     ROUTER_PROVIDERS,\n-    EXTRA_ROUTER_TESTING_PROVIDERS,\n     provideLocationMocks(),\n     withPreloading(NoPreloading).\u0275providers,\n     {provide: ROUTES, multi: true, useValue: []},\n\n---\n file path A: packages/router/testing/src/spy_ng_module_factory_loader.ts | file path B: None\n\n@@ -1,10 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-// This file exists for easily patching SpyNgModuleFactoryLoader in g3\n-export default {};\n\n---\n file path A: packages/router/testing/src/testing.ts | file path B: packages/router/testing/src/testing.ts\n\n@@ -12,4 +12,3 @@\n  * Entry point for all public APIs of the router/testing package.\n  */\n export * from './router_testing_module';\n-export * from './spy_ng_module_factory_loader';\n\n\n###\n\n", "completion": "refactor(router): Remove files no longer in use (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,31 @@\n+<a name=\"15.1.0-rc.0\"></a>\n+# 15.1.0-rc.0 (2023-01-05)\n+### common\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [2f4f0638c7](https://github.com/angular/angular/commit/2f4f0638c74dccfc2d0522f67ab226d3227c0566) | fix | Add data attribtue to NgOptimizedImage ([#48497](https://github.com/angular/angular/pull/48497)) |\n+### compiler\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [a532d71975](https://github.com/angular/angular/commit/a532d71975bef463223fd5d8322e3140760c9134) | feat | allow self-closing tags on custom elements ([#48535](https://github.com/angular/angular/pull/48535)) |\n+| [33f35b04ef](https://github.com/angular/angular/commit/33f35b04ef0f32f25624a6be59f8635675e3e131) | fix | type-only symbols incorrectly retained when downlevelling custom decorators ([#48638](https://github.com/angular/angular/pull/48638)) |\n+### compiler-cli\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [caedef0f5b](https://github.com/angular/angular/commit/caedef0f5b37ac6530885223b26879c39c36c1bd) | fix | update `@babel/core` dependency and lock version ([#48634](https://github.com/angular/angular/pull/48634)) |\n+### localize\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [a1a8e91eca](https://github.com/angular/angular/commit/a1a8e91ecaded6a2e4d700109a26d3117ad77c9c) | fix | add triple slash type reference on `@angular/localize` on `ng  add ([#48502](https://github.com/angular/angular/pull/48502)) |\n+### migrations\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [cc284afbbc](https://github.com/angular/angular/commit/cc284afbbc33b91884882204c5958a44a5d11392) | fix | combine newly-added imports in import manager ([#48620](https://github.com/angular/angular/pull/48620)) |\n+## Special Thanks\n+Alan Agius, Alex Castle, Andrew Kushnir, Derek Cormier, Joey Perrott, Kristiyan Kostadinov, Matthieu Riegler, Paul Gschwendtner, Pawel Kozlowski, Renan Ferro, Vadim, ced, mgechev, piyush132000 and robertIsaac\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.1.0-next.3\"></a>\n # 15.1.0-next.3 (2022-12-14)\n ### animations\n\n\n###\n\n", "completion": "docs: release notes for the v15.1.0-rc.0 release"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -452,9 +452,7 @@ jobs:\n       - run: git config --global --unset \"url.ssh://git@github.com.insteadof\"\n       - run:\n           name: Prepare GitHub credentials\n-          command: |\n-            # Ensure we never accidentally print the token to stdout/stderr.\n-            {echo \"https://${SNAPSHOT_BUILDS_GITHUB_TOKEN}:@github.com\" > $HOME/.git_credentials} &> /dev/null\n+          command: echo \"https://${SNAPSHOT_BUILDS_GITHUB_TOKEN}:@github.com\" > ${HOME}/.git_credentials\n       - run: ./scripts/ci/publish-build-artifacts.sh\n \n   aio_misc:\n\n\n###\n\n", "completion": "ci: fix snapshot publish github credential preparation (#<issue-num>)"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -451,11 +451,10 @@ jobs:\n       # Clear the global setting\n       - run: git config --global --unset \"url.ssh://git@github.com.insteadof\"\n       - run:\n-          name: Decrypt github credentials\n-          # We need ensure that the same default digest is used for encoding and decoding with\n-          # OpenSSL. OpenSSL versions might have different default digests which can cause\n-          # decryption failures based on the installed OpenSSL version. https://stackoverflow.com/a/39641378/4317734\n-          command: 'openssl aes-256-cbc -d -in .circleci/github_token -md md5 -k \"${KEY}\" -out ~/.git_credentials'\n+          name: Prepare GitHub credentials\n+          command: |\n+            # Ensure we never accidentally print the token to stdout/stderr.\n+            {echo \"https://${SNAPSHOT_BUILDS_GITHUB_TOKEN}:@github.com\" > $HOME/.git_credentials} &> /dev/null\n       - run: ./scripts/ci/publish-build-artifacts.sh\n \n   aio_misc:\n\n---\n file path A: .circleci/github_token | file path B: .circleci/github_token\n\nBinary files a/.circleci/github_token and /dev/null differ\n\n\n###\n\n", "completion": "ci: use snapshot deploy secret directly (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/transformers/downlevel_decorators_transform/downlevel_decorators_transform.ts | file path B: packages/compiler-cli/src/transformers/downlevel_decorators_transform/downlevel_decorators_transform.ts\n\n@@ -576,8 +576,9 @@ export function getDownlevelDecoratorsTransform(\n         modifiers = [...decoratorsToKeep, ...(classModifiers || [])];\n       }\n \n-      return ts.factory.createClassDeclaration(\n-          modifiers, classDecl.name, classDecl.typeParameters, classDecl.heritageClauses, members);\n+      return ts.factory.updateClassDeclaration(\n+          classDecl, modifiers, classDecl.name, classDecl.typeParameters, classDecl.heritageClauses,\n+          members);\n     }\n \n     /**\n\n---\n file path A: packages/compiler-cli/test/downlevel_decorators_transform_spec.ts | file path B: packages/compiler-cli/test/downlevel_decorators_transform_spec.ts\n\n@@ -702,6 +702,33 @@ describe('downlevel decorator transform', () => {\n     expect(output).not.toContain('tslib');\n   });\n \n+  it('should allow for type-only references to be removed with `emitDecoratorMetadata` from custom decorators',\n+     () => {\n+       context.writeFile('/external-interface.ts', `\n+        export interface ExternalInterface {\n+          id?: string;\n+        }\n+      `);\n+\n+       const {output} = transform(\n+           `\n+            import { ExternalInterface } from './external-interface';\n+\n+            export function CustomDecorator() {\n+              return <T>(target, propertyKey, descriptor: TypedPropertyDescriptor<T>) => {}\n+            }\n+\n+            export class Foo {\n+              @CustomDecorator() static test(): ExternalInterface { return {}; }\n+            }\n+          `,\n+           {emitDecoratorMetadata: true});\n+\n+       expect(diagnostics.length).toBe(0);\n+       expect(output).not.toContain('ExternalInterface');\n+       expect(output).toContain('metadata(\"design:returntype\", Object)');\n+     });\n+\n   describe('class decorators skipped', () => {\n     beforeEach(() => skipClassDecorators = true);\n \n\n\n###\n\n", "completion": "fix(compiler): type-only symbols incorrectly retained when downlevelling custom decorators (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/provide_router.ts | file path B: packages/router/src/provide_router.ts\n\n@@ -601,7 +601,7 @@ export type RouterHashLocationFeature = RouterFeature<RouterFeatureKind.RouterHa\n  * bootstrapApplication(AppComponent,\n  *   {\n  *     providers: [\n- *       provideRouter(appRoutes, withHashLocation()\n+ *       provideRouter(appRoutes, withHashLocation())\n  *     ]\n  *   }\n  * );\n\n\n###\n\n", "completion": "docs: missing closing parenthesis in withHashLocation() example (#<issue-num>)"}
{"prompt": " file path A: packages/compiler/src/expression_parser/lexer.ts | file path B: packages/compiler/src/expression_parser/lexer.ts\n\n@@ -353,10 +353,9 @@ class _Scanner {\n     while (this.peek != quote) {\n       if (this.peek == chars.$BACKSLASH) {\n         buffer += input.substring(marker, this.index);\n-        this.advance();\n         let unescapedCode: number;\n-        // Workaround for TS2.1-introduced type strictness\n-        this.peek = this.peek;\n+        this.advance();  // mutates this.peek\n+        // @ts-expect-error see microsoft/TypeScript#9998\n         if (this.peek == chars.$u) {\n           // 4 character hex code for unicode character.\n           const hex: string = input.substring(this.index + 1, this.index + 5);\n\n\n###\n\n", "completion": "refactor(compiler): Remove unnecessary assignment (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/attribute-binding/src/app/app.component.html | file path B: aio/content/examples/attribute-binding/src/app/app.component.html\n\n@@ -55,8 +55,8 @@\n <!-- #docregion dynamic-priority -->\n <h3>Dynamic vs static</h3>\n \n-<!-- If `classExpression` has a value for the `special` class, this value overrides the `class=\"special\"` below -->\n-<div class=\"special\" [class]=\"classExpression\">Some text.</div>\n+<!-- If `[class.special]` equals false, this value overrides the `class=\"special\"` below -->\n+<div class=\"special\" [class.special]=\"false\">Some text.</div>\n \n <!-- If `styleExpression` has a value for the `border` property, this value overrides the `style=\"border: dotted darkblue 3px\"` below -->\n <div style=\"border: dotted darkblue 3px\" [style]=\"styleExpression\">Some text.</div>\n\n\n###\n\n", "completion": "docs(docs-infra): update precedence of binding dynamic example and commentary (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/core/index.md | file path B: goldens/public-api/core/index.md\n\n@@ -1527,7 +1527,7 @@ export enum ViewEncapsulation {\n export abstract class ViewRef extends ChangeDetectorRef {\n     abstract destroy(): void;\n     abstract get destroyed(): boolean;\n-    abstract onDestroy(callback: Function): any /** TODO #9100 */;\n+    abstract onDestroy(callback: Function): any /** TODO #9100, replace by void in a major release*/;\n }\n \n // @public\n\n---\n file path A: packages/core/src/linker/view_ref.ts | file path B: packages/core/src/linker/view_ref.ts\n\n@@ -33,7 +33,7 @@ export abstract class ViewRef extends ChangeDetectorRef {\n    * @param callback A handler function that cleans up developer-defined data\n    * associated with a view. Called when the `destroy()` method is invoked.\n    */\n-  abstract onDestroy(callback: Function): any /** TODO #9100 */;\n+  abstract onDestroy(callback: Function): any /** TODO #9100, replace by void in a major release*/;\n }\n \n /**\n\n---\n file path A: packages/core/src/util/global.ts | file path B: packages/core/src/util/global.ts\n\n@@ -7,11 +7,11 @@\n  */\n \n // TODO(jteplitz602): Load WorkerGlobalScope from lib.webworker.d.ts file #3492\n-declare var WorkerGlobalScope: any /** TODO #9100 */;\n+declare var WorkerGlobalScope: any;\n // CommonJS / Node have global context exposed as \"global\" variable.\n // We don't want to include the whole node.d.ts this this compilation unit so we'll just fake\n // the global \"global\" var for now.\n-declare var global: any /** TODO #9100 */;\n+declare var global: any;\n \n // Always use __globalThis if available, which is the spec-defined global variable across all\n // environments, then fallback to __global first, because in Node tests both __global and\n\n---\n file path A: packages/core/test/di/reflective_injector_spec.ts | file path B: packages/core/test/di/reflective_injector_spec.ts\n\n@@ -493,11 +493,9 @@ describe('resolve', () => {\n   });\n \n   it('should support overriding factory dependencies with dependency annotations', () => {\n-    const providers = ReflectiveInjector.resolve([{\n-      provide: 'token',\n-      useFactory: (e: any /** TODO #9100 */) => 'result',\n-      deps: [[new Inject('dep')]]\n-    }]);\n+    const providers = ReflectiveInjector.resolve([\n+      {provide: 'token', useFactory: () => 'result', deps: [[new Inject('dep')]]},\n+    ]);\n \n     const provider = providers[0];\n \n\n---\n file path A: packages/core/test/directive_lifecycle_integration_spec.ts | file path B: packages/core/test/directive_lifecycle_integration_spec.ts\n\n@@ -64,10 +64,10 @@ class LifecycleDir implements DoCheck {\n })\n class LifecycleCmp implements OnChanges, OnInit, DoCheck, AfterContentInit, AfterContentChecked,\n                               AfterViewInit, AfterViewChecked {\n-  field: any /** TODO #9100 */;\n+  field: number = 0;\n   constructor(private _log: Log) {}\n \n-  ngOnChanges(_: any /** TODO #9100 */) {\n+  ngOnChanges() {\n     this._log.add('ngOnChanges');\n   }\n \n\n---\n file path A: packages/core/test/dom/shim_spec.ts | file path B: packages/core/test/dom/shim_spec.ts\n\n@@ -13,15 +13,15 @@ import '@angular/core/testing';\n {\n   describe('Shim', () => {\n     it('should provide correct function.name ', () => {\n-      const functionWithoutName = identity(() => function(_: any /** TODO #9100 */) {});\n-      function foo(_: any /** TODO #9100 */) {}\n+      const functionWithoutName = identity(() => function() {});\n+      function foo() {}\n \n-      expect((<any>functionWithoutName).name).toBeFalsy();\n-      expect((<any>foo).name).toEqual('foo');\n+      expect(functionWithoutName.name).toBeFalsy();\n+      expect(foo.name).toEqual('foo');\n     });\n   });\n }\n \n-function identity(a: any /** TODO #9100 */) {\n+function identity<T>(a: T): T {\n   return a;\n }\n\n---\n file path A: packages/core/test/event_emitter_spec.ts | file path B: packages/core/test/event_emitter_spec.ts\n\n@@ -12,18 +12,16 @@ import {EventEmitter} from '../src/event_emitter';\n \n {\n   describe('EventEmitter', () => {\n-    let emitter: EventEmitter<any>;\n+    let emitter: EventEmitter<number>;\n \n     beforeEach(() => {\n       emitter = new EventEmitter();\n     });\n \n     it('should call the next callback', done => {\n-      emitter.subscribe({\n-        next: (value: any) => {\n-          expect(value).toEqual(99);\n-          done();\n-        }\n+      emitter.subscribe((value: number) => {\n+        expect(value).toEqual(99);\n+        done();\n       });\n       emitter.emit(99);\n     });\n@@ -42,7 +40,7 @@ import {EventEmitter} from '../src/event_emitter';\n     it('should work when no throw callback is provided', done => {\n       emitter.subscribe({\n         next: () => {},\n-        error: (_: any) => {\n+        error: () => {\n           done();\n         }\n       });\n@@ -52,7 +50,7 @@ import {EventEmitter} from '../src/event_emitter';\n     it('should call the return callback', done => {\n       emitter.subscribe({\n         next: () => {},\n-        error: (_: any) => {},\n+        error: () => {},\n         complete: () => {\n           done();\n         }\n@@ -63,7 +61,7 @@ import {EventEmitter} from '../src/event_emitter';\n     it('should subscribe to the wrapper synchronously', () => {\n       let called = false;\n       emitter.subscribe({\n-        next: (value: any) => {\n+        next: () => {\n           called = true;\n         }\n       });\n@@ -73,19 +71,18 @@ import {EventEmitter} from '../src/event_emitter';\n     });\n \n     it('delivers next and error events synchronously', done => {\n-      const log: any[] /** TODO #9100 */ = [];\n-\n-      emitter.subscribe({\n-        next: (x: any) => {\n-          log.push(x);\n-          expect(log).toEqual([1, 2]);\n-        },\n-        error: (err: any) => {\n-          log.push(err);\n-          expect(log).toEqual([1, 2, 3, 4]);\n-          done();\n-        }\n-      });\n+      const log: number[] = [];\n+\n+      emitter.subscribe(\n+          (x: number) => {\n+            log.push(x);\n+            expect(log).toEqual([1, 2]);\n+          },\n+          (err: any) => {\n+            log.push(err);\n+            expect(log).toEqual([1, 2, 3, 4]);\n+            done();\n+          });\n       log.push(1);\n       emitter.emit(2);\n       log.push(3);\n@@ -94,14 +91,14 @@ import {EventEmitter} from '../src/event_emitter';\n     });\n \n     it('delivers next and complete events synchronously', () => {\n-      const log: any[] /** TODO #9100 */ = [];\n+      const log: number[] = [];\n \n       emitter.subscribe({\n-        next: (x: any) => {\n+        next: (x: number) => {\n           log.push(x);\n           expect(log).toEqual([1, 2]);\n         },\n-        error: null,\n+        error: undefined,\n         complete: () => {\n           log.push(4);\n           expect(log).toEqual([1, 2, 3, 4]);\n@@ -116,9 +113,9 @@ import {EventEmitter} from '../src/event_emitter';\n     });\n \n     it('delivers events asynchronously when forced to async mode', done => {\n-      const e = new EventEmitter(true);\n-      const log: any[] /** TODO #9100 */ = [];\n-      e.subscribe((x: any) => {\n+      const e = new EventEmitter<number>(true);\n+      const log: number[] = [];\n+      e.subscribe((x) => {\n         log.push(x);\n         expect(log).toEqual([1, 3, 2]);\n         done();\n\n---\n file path A: packages/core/test/fake_async_spec.ts | file path B: packages/core/test/fake_async_spec.ts\n\n@@ -26,7 +26,7 @@ const ProxyZoneSpec: {assertPresent: () => void} = (Zone as any)['ProxyZoneSpec'\n     });\n \n     it('should pass arguments to the wrapped function', () => {\n-      fakeAsync((foo: any /** TODO #9100 */, bar: any /** TODO #9100 */) => {\n+      fakeAsync((foo: string, bar: string) => {\n         expect(foo).toEqual('foo');\n         expect(bar).toEqual('bar');\n       })('foo', 'bar');\n@@ -40,7 +40,7 @@ const ProxyZoneSpec: {assertPresent: () => void} = (Zone as any)['ProxyZoneSpec'\n     it('should throw on nested calls', () => {\n       expect(() => {\n         fakeAsync(() => {\n-          fakeAsync((): any /** TODO #9100 */ => null)();\n+          fakeAsync((): null => null)();\n         })();\n       }).toThrowError('fakeAsync() calls can not be nested');\n     });\n@@ -76,7 +76,7 @@ const ProxyZoneSpec: {assertPresent: () => void} = (Zone as any)['ProxyZoneSpec'\n          }));\n \n       it('should run chained thens', fakeAsync(() => {\n-           const log = new Log();\n+           const log = new Log<number>();\n \n            resolvedPromise.then((_) => log.add(1)).then((_) => log.add(2));\n \n@@ -87,7 +87,7 @@ const ProxyZoneSpec: {assertPresent: () => void} = (Zone as any)['ProxyZoneSpec'\n          }));\n \n       it('should run Promise created in Promise', fakeAsync(() => {\n-           const log = new Log();\n+           const log = new Log<number>();\n \n            resolvedPromise.then((_) => {\n              log.add(1);\n@@ -245,9 +245,7 @@ const ProxyZoneSpec: {assertPresent: () => void} = (Zone as any)['ProxyZoneSpec'\n \n       it('should be able to cancel periodic timers from a callback', fakeAsync(() => {\n            let cycles = 0;\n-           let id: any /** TODO #9100 */;\n-\n-           id = setInterval(() => {\n+           const id = setInterval(() => {\n              cycles++;\n              clearInterval(id);\n            }, 10);\n@@ -261,7 +259,7 @@ const ProxyZoneSpec: {assertPresent: () => void} = (Zone as any)['ProxyZoneSpec'\n \n       it('should clear periodic timers', fakeAsync(() => {\n            let cycles = 0;\n-           const id = setInterval(() => {\n+           setInterval(() => {\n              cycles++;\n            }, 10);\n \n\n---\n file path A: packages/core/test/linker/query_integration_spec.ts | file path B: packages/core/test/linker/query_integration_spec.ts\n\n@@ -744,7 +744,7 @@ class NeedsContentChild implements AfterContentInit, AfterContentChecked {\n   get child() {\n     return this._child;\n   }\n-  logs: any[] /** TODO #9100 */ = [];\n+  logs: (string|null)[][] = [];\n \n   ngAfterContentInit() {\n     this.logs.push(['init', this.child ? this.child.text : null]);\n@@ -778,7 +778,7 @@ class NeedsViewChild implements AfterViewInit, AfterViewChecked {\n   get child() {\n     return this._child;\n   }\n-  logs: any[] /** TODO #9100 */ = [];\n+  logs: (string|null)[][] = [];\n \n   ngAfterViewInit() {\n     this.logs.push(['init', this.child ? this.child.text : null]);\n\n---\n file path A: packages/core/test/linker/query_list_spec.ts | file path B: packages/core/test/linker/query_list_spec.ts\n\n@@ -20,7 +20,7 @@ import {fakeAsync, tick} from '@angular/core/testing';\n       log = '';\n     });\n \n-    function logAppend(item: any /** TODO #9100 */) {\n+    function logAppend(item: string) {\n       log += (log.length == 0 ? '' : ', ') + item;\n     }\n \n@@ -177,7 +177,7 @@ import {fakeAsync, tick} from '@angular/core/testing';\n            }));\n \n         it('should provides query list as an argument', fakeAsync(() => {\n-             let recorded: any /** TODO #9100 */;\n+             let recorded: any; /** TODO #9100, replace with QueryList when #48004 is merged */\n              queryList.changes.subscribe({\n                next: (v: any) => {\n                  recorded = v;\n\n---\n file path A: packages/core/testing/src/component_fixture.ts | file path B: packages/core/testing/src/component_fixture.ts\n\n@@ -7,6 +7,7 @@\n  */\n \n import {ChangeDetectorRef, ComponentRef, DebugElement, ElementRef, getDebugNode, NgZone, RendererFactory2} from '@angular/core';\n+import {Subscription} from 'rxjs';\n \n \n /**\n@@ -43,12 +44,12 @@ export class ComponentFixture<T> {\n   private _renderer: RendererFactory2|null|undefined;\n   private _isStable: boolean = true;\n   private _isDestroyed: boolean = false;\n-  private _resolve: ((result: any) => void)|null = null;\n-  private _promise: Promise<any>|null = null;\n-  private _onUnstableSubscription: any /** TODO #9100 */ = null;\n-  private _onStableSubscription: any /** TODO #9100 */ = null;\n-  private _onMicrotaskEmptySubscription: any /** TODO #9100 */ = null;\n-  private _onErrorSubscription: any /** TODO #9100 */ = null;\n+  private _resolve: ((result: boolean) => void)|null = null;\n+  private _promise: Promise<boolean>|null = null;\n+  private _onUnstableSubscription: Subscription|null = null;\n+  private _onStableSubscription: Subscription|null = null;\n+  private _onMicrotaskEmptySubscription: Subscription|null = null;\n+  private _onErrorSubscription: Subscription|null = null;\n \n   constructor(\n       public componentRef: ComponentRef<T>, public ngZone: NgZone|null,\n\n---\n file path A: packages/core/testing/src/lang_utils.ts | file path B: None\n\n@@ -1,15 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-export function getTypeOf(instance: any /** TODO #9100 */) {\n-  return instance.constructor;\n-}\n-\n-export function instantiateType(type: Function, params: any[] = []) {\n-  return new (<any>type)(...params);\n-}\n\n---\n file path A: packages/core/testing/src/logger.ts | file path B: packages/core/testing/src/logger.ts\n\n@@ -9,19 +9,19 @@\n import {Injectable} from '@angular/core';\n \n @Injectable()\n-export class Log {\n-  logItems: any[];\n+export class Log<T = string> {\n+  logItems: T[];\n \n   constructor() {\n     this.logItems = [];\n   }\n \n-  add(value: any /** TODO #9100 */): void {\n+  add(value: T): void {\n     this.logItems.push(value);\n   }\n \n-  fn(value: any /** TODO #9100 */) {\n-    return (a1: any = null, a2: any = null, a3: any = null, a4: any = null, a5: any = null) => {\n+  fn(value: T) {\n+    return () => {\n       this.logItems.push(value);\n     };\n   }\n\n\n###\n\n", "completion": "refactor(core): cleanup type any (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/render3/i18n/i18n_parse.ts | file path B: packages/core/src/render3/i18n/i18n_parse.ts\n\n@@ -22,7 +22,6 @@ import {TNode, TNodeType} from '../interfaces/node';\n import {SanitizerFn} from '../interfaces/sanitization';\n import {HEADER_OFFSET, LView, TView} from '../interfaces/view';\n import {getCurrentParentTNode, getCurrentTNode, setCurrentTNode} from '../state';\n-import {attachDebugGetter} from '../util/debug_utils';\n \n import {i18nCreateOpCodesToString, i18nRemoveOpCodesToString, i18nUpdateOpCodesToString, icuCreateOpCodesToString} from './i18n_debug';\n import {addTNodeAndUpdateInsertBeforeIndex} from './i18n_insert_before_index';\n@@ -52,6 +51,23 @@ function replaceNgsp(value: string): string {\n   return value.replace(NGSP_UNICODE_REGEXP, ' ');\n }\n \n+/**\n+ * Patch a `debug` property getter on top of the existing object.\n+ *\n+ * NOTE: always call this method with `ngDevMode && attachDebugObject(...)`\n+ *\n+ * @param obj Object to patch\n+ * @param debugGetter Getter returning a value to patch\n+ */\n+function attachDebugGetter<T>(obj: T, debugGetter: (this: T) => any): void {\n+  if (ngDevMode) {\n+    Object.defineProperty(obj, 'debug', {get: debugGetter, enumerable: false});\n+  } else {\n+    throw new Error(\n+        'This method should be guarded with `ngDevMode` so that it can be tree shaken in production!');\n+  }\n+}\n+\n /**\n  * Create dynamic nodes from i18n translation block.\n  *\n\n---\n file path A: packages/core/src/render3/util/debug_utils.ts | file path B: None\n\n@@ -1,24 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-/**\n- * Patch a `debug` property getter on top of the existing object.\n- *\n- * NOTE: always call this method with `ngDevMode && attachDebugObject(...)`\n- *\n- * @param obj Object to patch\n- * @param debugGetter Getter returning a value to patch\n- */\n-export function attachDebugGetter<T>(obj: T, debugGetter: (this: T) => any): void {\n-  if (ngDevMode) {\n-    Object.defineProperty(obj, 'debug', {get: debugGetter, enumerable: false});\n-  } else {\n-    throw new Error(\n-        'This method should be guarded with `ngDevMode` so that it can be tree shaken in production!');\n-  }\n-}\n\n\n###\n\n", "completion": "refactor(core): move attachDebugGetter to i18n specifc code (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/render3/util/debug_utils.ts | file path B: packages/core/src/render3/util/debug_utils.ts\n\n@@ -6,23 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-/**\n- * Patch a `debug` property on top of the existing object.\n- *\n- * NOTE: always call this method with `ngDevMode && attachDebugObject(...)`\n- *\n- * @param obj Object to patch\n- * @param debug Value to patch\n- */\n-export function attachDebugObject(obj: any, debug: any): void {\n-  if (ngDevMode) {\n-    Object.defineProperty(obj, 'debug', {value: debug, enumerable: false});\n-  } else {\n-    throw new Error(\n-        'This method should be guarded with `ngDevMode` so that it can be tree shaken in production!');\n-  }\n-}\n-\n /**\n  * Patch a `debug` property getter on top of the existing object.\n  *\n\n\n###\n\n", "completion": "refactor(core): remove unused attachDebugObject function (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/toh-pt3/src/app/heroes/heroes.component.ts | file path B: aio/content/examples/toh-pt3/src/app/heroes/heroes.component.ts\n\n@@ -1,4 +1,4 @@\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n import { Hero } from '../hero';\n import { HEROES } from '../mock-heroes';\n \n@@ -7,17 +7,12 @@ import { HEROES } from '../mock-heroes';\n   templateUrl: './heroes.component.html',\n   styleUrls: ['./heroes.component.css']\n })\n-export class HeroesComponent implements OnInit {\n+export class HeroesComponent {\n \n   heroes = HEROES;\n \n   selectedHero!: Hero;\n \n-  constructor() { }\n-\n-  ngOnInit(): void {\n-  }\n-\n   onSelect(hero: Hero): void {\n     this.selectedHero = hero;\n   }\n\n---\n file path A: aio/content/examples/toh-pt4/src/app/hero-detail/hero-detail.component.ts | file path B: aio/content/examples/toh-pt4/src/app/hero-detail/hero-detail.component.ts\n\n@@ -1,4 +1,4 @@\n-import { Component, OnInit, Input } from '@angular/core';\n+import { Component, Input } from '@angular/core';\n import { Hero } from '../hero';\n \n @Component({\n@@ -6,13 +6,8 @@ import { Hero } from '../hero';\n   templateUrl: './hero-detail.component.html',\n   styleUrls: ['./hero-detail.component.css']\n })\n-export class HeroDetailComponent implements OnInit {\n+export class HeroDetailComponent {\n \n   @Input() hero: Hero | undefined;\n \n-  constructor() { }\n-\n-  ngOnInit(): void {\n-  }\n-\n }\n\n---\n file path A: aio/content/examples/upgrade-lazy-load-ajs/src/app/app404/app404.component.ts | file path B: aio/content/examples/upgrade-lazy-load-ajs/src/app/app404/app404.component.ts\n\n@@ -1,15 +1,8 @@\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n \n @Component({\n   selector: 'app-app404',\n   templateUrl: './app404.component.html',\n   styleUrls: ['./app404.component.css']\n })\n-export class App404Component implements OnInit {\n-\n-  constructor() { }\n-\n-  ngOnInit() {\n-  }\n-\n-}\n+export class App404Component {}\n\n\n###\n\n", "completion": "docs: updated docs removed unnecessary imports and empty methods (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -100,8 +100,8 @@\n     \"@types/node\": \"^12.7.9\",\n     \"@types/trusted-types\": \"^2.0.2\",\n     \"@types/xregexp\": \"^4.3.0\",\n-    \"@typescript-eslint/eslint-plugin\": \"5.46.1\",\n-    \"@typescript-eslint/parser\": \"5.46.1\",\n+    \"@typescript-eslint/eslint-plugin\": \"5.47.0\",\n+    \"@typescript-eslint/parser\": \"5.47.0\",\n     \"archiver\": \"^5.3.0\",\n     \"assert\": \"^2.0.0\",\n     \"canonical-path\": \"1.0.0\",\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -3251,14 +3251,14 @@\n   dependencies:\n     \"@types/node\" \"*\"\n \n-\"@typescript-eslint/eslint-plugin@5.46.1\":\n-  version \"5.46.1\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/eslint-plugin/-/eslint-plugin-5.46.1.tgz#098abb4c9354e19f460d57ab18bff1f676a6cff0\"\n-  integrity sha512-YpzNv3aayRBwjs4J3oz65eVLXc9xx0PDbIRisHj+dYhvBn02MjYOD96P8YGiWEIFBrojaUjxvkaUpakD82phsA==\n-  dependencies:\n-    \"@typescript-eslint/scope-manager\" \"5.46.1\"\n-    \"@typescript-eslint/type-utils\" \"5.46.1\"\n-    \"@typescript-eslint/utils\" \"5.46.1\"\n+\"@typescript-eslint/eslint-plugin@5.47.0\":\n+  version \"5.47.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/eslint-plugin/-/eslint-plugin-5.47.0.tgz#dadb79df3b0499699b155839fd6792f16897d910\"\n+  integrity sha512-AHZtlXAMGkDmyLuLZsRpH3p4G/1iARIwc/T0vIem2YB+xW6pZaXYXzCBnZSF/5fdM97R9QqZWZ+h3iW10XgevQ==\n+  dependencies:\n+    \"@typescript-eslint/scope-manager\" \"5.47.0\"\n+    \"@typescript-eslint/type-utils\" \"5.47.0\"\n+    \"@typescript-eslint/utils\" \"5.47.0\"\n     debug \"^4.3.4\"\n     ignore \"^5.2.0\"\n     natural-compare-lite \"^1.4.0\"\n@@ -3266,14 +3266,14 @@\n     semver \"^7.3.7\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/parser@5.46.1\":\n-  version \"5.46.1\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/parser/-/parser-5.46.1.tgz#1fc8e7102c1141eb64276c3b89d70da8c0ba5699\"\n-  integrity sha512-RelQ5cGypPh4ySAtfIMBzBGyrNerQcmfA1oJvPj5f+H4jI59rl9xxpn4bonC0tQvUKOEN7eGBFWxFLK3Xepneg==\n+\"@typescript-eslint/parser@5.47.0\":\n+  version \"5.47.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/parser/-/parser-5.47.0.tgz#62e83de93499bf4b500528f74bf2e0554e3a6c8d\"\n+  integrity sha512-udPU4ckK+R1JWCGdQC4Qa27NtBg7w020ffHqGyAK8pAgOVuNw7YaKXGChk+udh+iiGIJf6/E/0xhVXyPAbsczw==\n   dependencies:\n-    \"@typescript-eslint/scope-manager\" \"5.46.1\"\n-    \"@typescript-eslint/types\" \"5.46.1\"\n-    \"@typescript-eslint/typescript-estree\" \"5.46.1\"\n+    \"@typescript-eslint/scope-manager\" \"5.47.0\"\n+    \"@typescript-eslint/types\" \"5.47.0\"\n+    \"@typescript-eslint/typescript-estree\" \"5.47.0\"\n     debug \"^4.3.4\"\n \n \"@typescript-eslint/scope-manager@5.43.0\":\n@@ -3284,13 +3284,13 @@\n     \"@typescript-eslint/types\" \"5.43.0\"\n     \"@typescript-eslint/visitor-keys\" \"5.43.0\"\n \n-\"@typescript-eslint/scope-manager@5.46.1\":\n-  version \"5.46.1\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/scope-manager/-/scope-manager-5.46.1.tgz#70af8425c79bbc1178b5a63fb51102ddf48e104a\"\n-  integrity sha512-iOChVivo4jpwUdrJZyXSMrEIM/PvsbbDOX1y3UCKjSgWn+W89skxWaYXACQfxmIGhPVpRWK/VWPYc+bad6smIA==\n+\"@typescript-eslint/scope-manager@5.47.0\":\n+  version \"5.47.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/scope-manager/-/scope-manager-5.47.0.tgz#f58144a6b0ff58b996f92172c488813aee9b09df\"\n+  integrity sha512-dvJab4bFf7JVvjPuh3sfBUWsiD73aiftKBpWSfi3sUkysDQ4W8x+ZcFpNp7Kgv0weldhpmMOZBjx1wKN8uWvAw==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.46.1\"\n-    \"@typescript-eslint/visitor-keys\" \"5.46.1\"\n+    \"@typescript-eslint/types\" \"5.47.0\"\n+    \"@typescript-eslint/visitor-keys\" \"5.47.0\"\n \n \"@typescript-eslint/type-utils@5.43.0\":\n   version \"5.43.0\"\n@@ -3302,13 +3302,13 @@\n     debug \"^4.3.4\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/type-utils@5.46.1\":\n-  version \"5.46.1\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/type-utils/-/type-utils-5.46.1.tgz#195033e4b30b51b870dfcf2828e88d57b04a11cc\"\n-  integrity sha512-V/zMyfI+jDmL1ADxfDxjZ0EMbtiVqj8LUGPAGyBkXXStWmCUErMpW873zEHsyguWCuq2iN4BrlWUkmuVj84yng==\n+\"@typescript-eslint/type-utils@5.47.0\":\n+  version \"5.47.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/type-utils/-/type-utils-5.47.0.tgz#2b440979c574e317d3473225ae781f292c99e55d\"\n+  integrity sha512-1J+DFFrYoDUXQE1b7QjrNGARZE6uVhBqIvdaXTe5IN+NmEyD68qXR1qX1g2u4voA+nCaelQyG8w30SAOihhEYg==\n   dependencies:\n-    \"@typescript-eslint/typescript-estree\" \"5.46.1\"\n-    \"@typescript-eslint/utils\" \"5.46.1\"\n+    \"@typescript-eslint/typescript-estree\" \"5.47.0\"\n+    \"@typescript-eslint/utils\" \"5.47.0\"\n     debug \"^4.3.4\"\n     tsutils \"^3.21.0\"\n \n@@ -3317,10 +3317,10 @@\n   resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.43.0.tgz#e4ddd7846fcbc074325293515fa98e844d8d2578\"\n   integrity sha512-jpsbcD0x6AUvV7tyOlyvon0aUsQpF8W+7TpJntfCUWU1qaIKu2K34pMwQKSzQH8ORgUrGYY6pVIh1Pi8TNeteg==\n \n-\"@typescript-eslint/types@5.46.1\":\n-  version \"5.46.1\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.46.1.tgz#4e9db2107b9a88441c4d5ecacde3bb7a5ebbd47e\"\n-  integrity sha512-Z5pvlCaZgU+93ryiYUwGwLl9AQVB/PQ1TsJ9NZ/gHzZjN7g9IAn6RSDkpCV8hqTwAiaj6fmCcKSQeBPlIpW28w==\n+\"@typescript-eslint/types@5.47.0\":\n+  version \"5.47.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.47.0.tgz#67490def406eaa023dbbd8da42ee0d0c9b5229d3\"\n+  integrity sha512-eslFG0Qy8wpGzDdYKu58CEr3WLkjwC5Usa6XbuV89ce/yN5RITLe1O8e+WFEuxnfftHiJImkkOBADj58ahRxSg==\n \n \"@typescript-eslint/typescript-estree@5.43.0\":\n   version \"5.43.0\"\n@@ -3335,13 +3335,13 @@\n     semver \"^7.3.7\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/typescript-estree@5.46.1\":\n-  version \"5.46.1\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/typescript-estree/-/typescript-estree-5.46.1.tgz#5358088f98a8f9939355e0996f9c8f41c25eced2\"\n-  integrity sha512-j9W4t67QiNp90kh5Nbr1w92wzt+toiIsaVPnEblB2Ih2U9fqBTyqV9T3pYWZBRt6QoMh/zVWP59EpuCjc4VRBg==\n+\"@typescript-eslint/typescript-estree@5.47.0\":\n+  version \"5.47.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/typescript-estree/-/typescript-estree-5.47.0.tgz#ed971a11c5c928646d6ba7fc9dfdd6e997649aca\"\n+  integrity sha512-LxfKCG4bsRGq60Sqqu+34QT5qT2TEAHvSCCJ321uBWywgE2dS0LKcu5u+3sMGo+Vy9UmLOhdTw5JHzePV/1y4Q==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.46.1\"\n-    \"@typescript-eslint/visitor-keys\" \"5.46.1\"\n+    \"@typescript-eslint/types\" \"5.47.0\"\n+    \"@typescript-eslint/visitor-keys\" \"5.47.0\"\n     debug \"^4.3.4\"\n     globby \"^11.1.0\"\n     is-glob \"^4.0.3\"\n@@ -3362,16 +3362,16 @@\n     eslint-utils \"^3.0.0\"\n     semver \"^7.3.7\"\n \n-\"@typescript-eslint/utils@5.46.1\":\n-  version \"5.46.1\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/utils/-/utils-5.46.1.tgz#7da3c934d9fd0eb4002a6bb3429f33298b469b4a\"\n-  integrity sha512-RBdBAGv3oEpFojaCYT4Ghn4775pdjvwfDOfQ2P6qzNVgQOVrnSPe5/Pb88kv7xzYQjoio0eKHKB9GJ16ieSxvA==\n+\"@typescript-eslint/utils@5.47.0\":\n+  version \"5.47.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/utils/-/utils-5.47.0.tgz#b5005f7d2696769a1fdc1e00897005a25b3a0ec7\"\n+  integrity sha512-U9xcc0N7xINrCdGVPwABjbAKqx4GK67xuMV87toI+HUqgXj26m6RBp9UshEXcTrgCkdGYFzgKLt8kxu49RilDw==\n   dependencies:\n     \"@types/json-schema\" \"^7.0.9\"\n     \"@types/semver\" \"^7.3.12\"\n-    \"@typescript-eslint/scope-manager\" \"5.46.1\"\n-    \"@typescript-eslint/types\" \"5.46.1\"\n-    \"@typescript-eslint/typescript-estree\" \"5.46.1\"\n+    \"@typescript-eslint/scope-manager\" \"5.47.0\"\n+    \"@typescript-eslint/types\" \"5.47.0\"\n+    \"@typescript-eslint/typescript-estree\" \"5.47.0\"\n     eslint-scope \"^5.1.1\"\n     eslint-utils \"^3.0.0\"\n     semver \"^7.3.7\"\n@@ -3384,12 +3384,12 @@\n     \"@typescript-eslint/types\" \"5.43.0\"\n     eslint-visitor-keys \"^3.3.0\"\n \n-\"@typescript-eslint/visitor-keys@5.46.1\":\n-  version \"5.46.1\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/visitor-keys/-/visitor-keys-5.46.1.tgz#126cc6fe3c0f83608b2b125c5d9daced61394242\"\n-  integrity sha512-jczZ9noovXwy59KjRTk1OftT78pwygdcmCuBf8yMoWt/8O8l+6x2LSEze0E4TeepXK4MezW3zGSyoDRZK7Y9cg==\n+\"@typescript-eslint/visitor-keys@5.47.0\":\n+  version \"5.47.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/visitor-keys/-/visitor-keys-5.47.0.tgz#4aca4efbdf6209c154df1f7599852d571b80bb45\"\n+  integrity sha512-ByPi5iMa6QqDXe/GmT/hR6MZtVPi0SqMQPDx15FczCBXJo/7M8T88xReOALAfpBLm+zxpPfmhuEvPb577JRAEg==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.46.1\"\n+    \"@typescript-eslint/types\" \"5.47.0\"\n     eslint-visitor-keys \"^3.3.0\"\n \n \"@webassemblyjs/ast@1.11.1\":\n\n\n###\n\n", "completion": "build: update eslint dependencies to v5.47.0 (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -775,16 +775,13 @@ function assertNoImageDistortion(\n     dir: NgOptimizedImage, img: HTMLImageElement, renderer: Renderer2) {\n   const removeListenerFn = renderer.listen(img, 'load', () => {\n     removeListenerFn();\n-    // TODO: `clientWidth`, `clientHeight`, `naturalWidth` and `naturalHeight`\n-    // are typed as number, but we run `parseFloat` (which accepts strings only).\n-    // Verify whether `parseFloat` is needed in the cases below.\n-    const renderedWidth = parseFloat(img.clientWidth as any);\n-    const renderedHeight = parseFloat(img.clientHeight as any);\n+    const renderedWidth = img.clientWidth;\n+    const renderedHeight = img.clientHeight;\n     const renderedAspectRatio = renderedWidth / renderedHeight;\n     const nonZeroRenderedDimensions = renderedWidth !== 0 && renderedHeight !== 0;\n \n-    const intrinsicWidth = parseFloat(img.naturalWidth as any);\n-    const intrinsicHeight = parseFloat(img.naturalHeight as any);\n+    const intrinsicWidth = img.naturalWidth;\n+    const intrinsicHeight = img.naturalHeight;\n     const intrinsicAspectRatio = intrinsicWidth / intrinsicHeight;\n \n     const suppliedWidth = dir.width!;\n@@ -888,7 +885,7 @@ function assertNonZeroRenderedHeight(\n     dir: NgOptimizedImage, img: HTMLImageElement, renderer: Renderer2) {\n   const removeListenerFn = renderer.listen(img, 'load', () => {\n     removeListenerFn();\n-    const renderedHeight = parseFloat(img.clientHeight as any);\n+    const renderedHeight = img.clientHeight;\n     if (dir.fill && renderedHeight === 0) {\n       console.warn(formatRuntimeError(\n           RuntimeErrorCode.INVALID_INPUT,\n\n\n###\n\n", "completion": "refactor(common): remove unnecessary parseFloat from ng_optimized_image directive. (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/di/injector_compatibility.ts | file path B: packages/core/src/di/injector_compatibility.ts\n\n@@ -158,7 +158,7 @@ export function inject<T>(token: ProviderToken<T>, options: InjectOptions): T|nu\n  * @param token A token that represents a dependency that should be injected.\n  * @param flags Optional flags that control how injection is executed.\n  * The flags correspond to injection strategies that can be specified with\n- * parameter decorators `@Host`, `@Self`, `@SkipSef`, and `@Optional`.\n+ * parameter decorators `@Host`, `@Self`, `@SkipSelf`, and `@Optional`.\n  * @returns the injected value if operation is successful, `null` otherwise.\n  * @throws if called outside of a supported context.\n  *\n\n\n###\n\n", "completion": "docs: fix typo on SkipSelf (#<issue-num>)"}
{"prompt": " file path A: packages/localize/index.ts | file path B: packages/localize/index.ts\n\n@@ -11,3 +11,106 @@\n // public_api_guard rules\n \n export * from './localize';\n+\n+// The global declaration must be in the index.d.ts as otherwise it will not be picked up when used\n+// with\n+// /// <reference types=\"@angular/localize\" />\n+\n+import {LocalizeFn} from './src/localize';\n+\n+// `declare global` allows us to escape the current module and place types on the global namespace\n+declare global {\n+  /**\n+   * Tag a template literal string for localization.\n+   *\n+   * For example:\n+   *\n+   * ```ts\n+   * $localize `some string to localize`\n+   * ```\n+   *\n+   * **Providing meaning, description and id**\n+   *\n+   * You can optionally specify one or more of `meaning`, `description` and `id` for a localized\n+   * string by pre-pending it with a colon delimited block of the form:\n+   *\n+   * ```ts\n+   * $localize`:meaning|description@@id:source message text`;\n+   *\n+   * $localize`:meaning|:source message text`;\n+   * $localize`:description:source message text`;\n+   * $localize`:@@id:source message text`;\n+   * ```\n+   *\n+   * This format is the same as that used for `i18n` markers in Angular templates. See the\n+   * [Angular i18n guide](guide/i18n-common-prepare#mark-text-in-component-template).\n+   *\n+   * **Naming placeholders**\n+   *\n+   * If the template literal string contains expressions, then the expressions will be automatically\n+   * associated with placeholder names for you.\n+   *\n+   * For example:\n+   *\n+   * ```ts\n+   * $localize `Hi ${name}! There are ${items.length} items.`;\n+   * ```\n+   *\n+   * will generate a message-source of `Hi {$PH}! There are {$PH_1} items`.\n+   *\n+   * The recommended practice is to name the placeholder associated with each expression though.\n+   *\n+   * Do this by providing the placeholder name wrapped in `:` characters directly after the\n+   * expression. These placeholder names are stripped out of the rendered localized string.\n+   *\n+   * For example, to name the `items.length` expression placeholder `itemCount` you write:\n+   *\n+   * ```ts\n+   * $localize `There are ${items.length}:itemCount: items`;\n+   * ```\n+   *\n+   * **Escaping colon markers**\n+   *\n+   * If you need to use a `:` character directly at the start of a tagged string that has no\n+   * metadata block, or directly after a substitution expression that has no name you must escape\n+   * the `:` by preceding it with a backslash:\n+   *\n+   * For example:\n+   *\n+   * ```ts\n+   * // message has a metadata block so no need to escape colon\n+   * $localize `:some description::this message starts with a colon (:)`;\n+   * // no metadata block so the colon must be escaped\n+   * $localize `\\:this message starts with a colon (:)`;\n+   * ```\n+   *\n+   * ```ts\n+   * // named substitution so no need to escape colon\n+   * $localize `${label}:label:: ${}`\n+   * // anonymous substitution so colon must be escaped\n+   * $localize `${label}\\: ${}`\n+   * ```\n+   *\n+   * **Processing localized strings:**\n+   *\n+   * There are three scenarios:\n+   *\n+   * * **compile-time inlining**: the `$localize` tag is transformed at compile time by a\n+   * transpiler, removing the tag and replacing the template literal string with a translated\n+   * literal string from a collection of translations provided to the transpilation tool.\n+   *\n+   * * **run-time evaluation**: the `$localize` tag is a run-time function that replaces and\n+   * reorders the parts (static strings and expressions) of the template literal string with strings\n+   * from a collection of translations loaded at run-time.\n+   *\n+   * * **pass-through evaluation**: the `$localize` tag is a run-time function that simply evaluates\n+   * the original template literal string without applying any translations to the parts. This\n+   * version is used during development or where there is no need to translate the localized\n+   * template literals.\n+   *\n+   * @param messageParts a collection of the static parts of the template string.\n+   * @param expressions a collection of the values of each placeholder in the template string.\n+   * @returns the translated string, with the `messageParts` and `expressions` interleaved together.\n+   */\n+  const $localize: LocalizeFn;\n+}\n\n---\n file path A: packages/localize/localize.ts | file path B: packages/localize/localize.ts\n\n@@ -7,107 +7,9 @@\n  */\n \n // This file contains the public API of the `@angular/localize` entry-point\n-import {LocalizeFn} from './src/localize';\n \n export {clearTranslations, loadTranslations} from './src/translate';\n export {MessageId, TargetMessage} from './src/utils';\n \n // Exports that are not part of the public API\n export * from './private';\n-\n-// `declare global` allows us to escape the current module and place types on the global namespace\n-declare global {\n-  /**\n-   * Tag a template literal string for localization.\n-   *\n-   * For example:\n-   *\n-   * ```ts\n-   * $localize `some string to localize`\n-   * ```\n-   *\n-   * **Providing meaning, description and id**\n-   *\n-   * You can optionally specify one or more of `meaning`, `description` and `id` for a localized\n-   * string by pre-pending it with a colon delimited block of the form:\n-   *\n-   * ```ts\n-   * $localize`:meaning|description@@id:source message text`;\n-   *\n-   * $localize`:meaning|:source message text`;\n-   * $localize`:description:source message text`;\n-   * $localize`:@@id:source message text`;\n-   * ```\n-   *\n-   * This format is the same as that used for `i18n` markers in Angular templates. See the\n-   * [Angular i18n guide](guide/i18n-common-prepare#mark-text-in-component-template).\n-   *\n-   * **Naming placeholders**\n-   *\n-   * If the template literal string contains expressions, then the expressions will be automatically\n-   * associated with placeholder names for you.\n-   *\n-   * For example:\n-   *\n-   * ```ts\n-   * $localize `Hi ${name}! There are ${items.length} items.`;\n-   * ```\n-   *\n-   * will generate a message-source of `Hi {$PH}! There are {$PH_1} items`.\n-   *\n-   * The recommended practice is to name the placeholder associated with each expression though.\n-   *\n-   * Do this by providing the placeholder name wrapped in `:` characters directly after the\n-   * expression. These placeholder names are stripped out of the rendered localized string.\n-   *\n-   * For example, to name the `items.length` expression placeholder `itemCount` you write:\n-   *\n-   * ```ts\n-   * $localize `There are ${items.length}:itemCount: items`;\n-   * ```\n-   *\n-   * **Escaping colon markers**\n-   *\n-   * If you need to use a `:` character directly at the start of a tagged string that has no\n-   * metadata block, or directly after a substitution expression that has no name you must escape\n-   * the `:` by preceding it with a backslash:\n-   *\n-   * For example:\n-   *\n-   * ```ts\n-   * // message has a metadata block so no need to escape colon\n-   * $localize `:some description::this message starts with a colon (:)`;\n-   * // no metadata block so the colon must be escaped\n-   * $localize `\\:this message starts with a colon (:)`;\n-   * ```\n-   *\n-   * ```ts\n-   * // named substitution so no need to escape colon\n-   * $localize `${label}:label:: ${}`\n-   * // anonymous substitution so colon must be escaped\n-   * $localize `${label}\\: ${}`\n-   * ```\n-   *\n-   * **Processing localized strings:**\n-   *\n-   * There are three scenarios:\n-   *\n-   * * **compile-time inlining**: the `$localize` tag is transformed at compile time by a\n-   * transpiler, removing the tag and replacing the template literal string with a translated\n-   * literal string from a collection of translations provided to the transpilation tool.\n-   *\n-   * * **run-time evaluation**: the `$localize` tag is a run-time function that replaces and\n-   * reorders the parts (static strings and expressions) of the template literal string with strings\n-   * from a collection of translations loaded at run-time.\n-   *\n-   * * **pass-through evaluation**: the `$localize` tag is a run-time function that simply evaluates\n-   * the original template literal string without applying any translations to the parts. This\n-   * version is used during development or where there is no need to translate the localized\n-   * template literals.\n-   *\n-   * @param messageParts a collection of the static parts of the template string.\n-   * @param expressions a collection of the values of each placeholder in the template string.\n-   * @returns the translated string, with the `messageParts` and `expressions` interleaved together.\n-   */\n-  const $localize: LocalizeFn;\n-}\n\n---\n file path A: packages/localize/schematics/ng-add/index.ts | file path B: packages/localize/schematics/ng-add/index.ts\n\n@@ -18,6 +18,7 @@ import {Builders} from '@schematics/angular/utility/workspace-models';\n import {Schema} from './schema';\n \n const localizeType = `@angular/localize`;\n+const localizeTripleSlashType = `/// <reference types=\"@angular/localize\" />`;\n \n function addTypeScriptConfigTypes(projectName: string): Rule {\n   return async (host: Tree) => {\n@@ -28,7 +29,7 @@ function addTypeScriptConfigTypes(projectName: string): Rule {\n     }\n \n     // We add the root workspace tsconfig for better IDE support.\n-    const tsConfigFiles = new Set<string>(['tsconfig.json']);\n+    const tsConfigFiles = new Set<string>();\n     for (const target of project.targets.values()) {\n       switch (target.builder) {\n         case Builders.Karma:\n@@ -41,6 +42,13 @@ function addTypeScriptConfigTypes(projectName: string): Rule {\n \n           break;\n       }\n+\n+      if (target.builder === Builders.Browser) {\n+        const value = target.options?.['main'];\n+        if (typeof value === 'string') {\n+          addTripleSlashType(host, value);\n+        }\n+      }\n     }\n \n     const typesJsonPath: JSONPath = ['compilerOptions', 'types'];\n@@ -68,6 +76,13 @@ function addTypeScriptConfigTypes(projectName: string): Rule {\n   };\n }\n \n+function addTripleSlashType(host: Tree, path: string): void {\n+  const content = host.readText(path);\n+  if (!content.includes(localizeTripleSlashType)) {\n+    host.overwrite(path, localizeTripleSlashType + '\\n\\n' + content);\n+  }\n+}\n+\n function moveToDependencies(host: Tree, context: SchematicContext): void {\n   if (!host.exists('package.json')) {\n     return;\n\n---\n file path A: packages/localize/schematics/ng-add/index_spec.ts | file path B: packages/localize/schematics/ng-add/index_spec.ts\n\n@@ -16,7 +16,8 @@ interface TsConfig {\n }\n \n describe('ng-add schematic', () => {\n-  const localizeType = '@angular/localize';\n+  const localizeTripleSlashType = `/// <reference types=\"@angular/localize\" />`;\n+\n   const defaultOptions = {project: 'demo'};\n   const schematicRunner = new SchematicTestRunner(\n       '@angular/localize', runfiles.resolvePackageRelative('../collection.json'));\n@@ -33,6 +34,11 @@ describe('ng-add schematic', () => {\n       },\n     }));\n \n+    host.create('main.ts', `\n+      import { enableProdMode } from '@angular/core';\n+      import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n+    `);\n+\n     host.create('angular.json', JSON.stringify({\n       version: 1,\n       projects: {\n@@ -42,6 +48,7 @@ describe('ng-add schematic', () => {\n             build: {\n               builder: '@angular-devkit/build-angular:browser',\n               options: {\n+                main: './main.ts',\n                 tsConfig: './tsconfig.app.json',\n               },\n             },\n@@ -69,36 +76,22 @@ describe('ng-add schematic', () => {\n     }));\n   });\n \n-  it(`should add '@angular/localize' in 'types' in the root level 'tsconfig.json'`, async () => {\n-    host.create('tsconfig.json', JSON.stringify({\n-      compilerOptions: {\n-        types: ['node'],\n-      },\n-    }));\n-\n+  it(`should add '@angular/localize' type reference in 'main.ts'`, async () => {\n     host = await schematicRunner.runSchematicAsync('ng-add', defaultOptions, host).toPromise();\n-    const {compilerOptions} = host.readJson('tsconfig.json') as TsConfig;\n-    const types = compilerOptions?.types;\n-    expect(types).toContain(localizeType);\n-    expect(types).toHaveSize(2);\n+    expect(host.readText('main.ts')).toContain(localizeTripleSlashType);\n   });\n \n-  it(`should not add '@angular/localize' in 'types' tsconfig when '@angular/localize/init' is present`,\n+  it(`should not add '@angular/localize' type reference in 'main.ts' if already present`,\n      async () => {\n-       host.create('tsconfig.json', JSON.stringify({\n-         compilerOptions: {\n-           types: ['node', '@angular/localize/init'],\n-         },\n-       }));\n-\n+       const mainContentInput = `\n+      ${localizeTripleSlashType}\n+      import { enableProdMode } from '@angular/core';\n+    `;\n+       host.overwrite('main.ts', mainContentInput);\n        host = await schematicRunner.runSchematicAsync('ng-add', defaultOptions, host).toPromise();\n-       const {compilerOptions} = host.readJson('tsconfig.json') as TsConfig;\n-       const types = compilerOptions?.types;\n-       expect(types).not.toContain(localizeType);\n-       expect(types).toHaveSize(2);\n+       expect(host.readText('main.ts')).toBe(mainContentInput);\n      });\n \n-\n   it(`should not add '@angular/localize' in 'types' tsconfigs referenced in non official builders`,\n      async () => {\n        const tsConfig = JSON.stringify({\n\n\n###\n\n", "completion": "fix(localize): add triple slash type reference on `@angular/localize` on `ng  add (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -417,6 +417,11 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n \n     this.setHostAttribute('loading', this.getLoadingBehavior());\n     this.setHostAttribute('fetchpriority', this.getFetchPriority());\n+\n+    // The `data-ng-img` attribute flags an image as using the directive, to allow\n+    // for analysis of the directive's performance.\n+    this.setHostAttribute('ng-img', 'true');\n+\n     // The `src` and `srcset` attributes should be set last since other attributes\n     // could affect the image's loading behavior.\n     const rewrittenSrc = this.getRewrittenSrc();\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -807,6 +807,29 @@ describe('Image directive', () => {\n     });\n   });\n \n+  describe('meta data', () => {\n+    it('should add a data attribute to the element for identification', () => {\n+      setupTestingModule();\n+      const template = '<img ngSrc=\"a.png\" width=\"100\" height=\"50\">';\n+\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.getAttribute('ng-img')).not.toBeNull();\n+    });\n+    it('should add a data attribute to the element for identification, when ngSrc bound', () => {\n+      setupTestingModule();\n+      const template = `<img [ngSrc]=\"'a.png'\" width=\"100\" height=\"50\">`;\n+\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.getAttribute('ng-img')).not.toBeNull();\n+    });\n+  });\n+\n   describe('fill mode', () => {\n     it('should allow unsized images in fill mode', () => {\n       setupTestingModule();\n\n\n###\n\n", "completion": "fix(common): Add data attribtue to NgOptimizedImage (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/aio-preview-build.yml | file path B: .github/workflows/aio-preview-build.yml\n\n@@ -22,7 +22,7 @@ jobs:\n       (github.event.action == 'labeled' && github.event.label.name == 'aio: preview') ||\n       (github.event.action == 'synchronize' && contains(github.event.pull_request.labels.*.name, 'aio: preview'))\n     steps:\n-      - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n+      - uses: actions/checkout@755da8c3cf115ac066823e79a1e1788f8940201b # tag=v3.2.0\n       - uses: ./.github/actions/yarn-install\n \n       - uses: angular/dev-infra/github-actions/setup-bazel-remote-exec@96fdaaa056f1cfa7ffbc4c69b7e9007279f76c94\n\n---\n file path A: .github/workflows/assistant-to-the-branch-manager.yml | file path B: .github/workflows/assistant-to-the-branch-manager.yml\n\n@@ -13,7 +13,7 @@ jobs:\n   assistant_to_the_branch_manager:\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n+      - uses: actions/checkout@755da8c3cf115ac066823e79a1e1788f8940201b # tag=v3.2.0\n         with:\n           persist-credentials: false\n       - uses: angular/dev-infra/github-actions/branch-manager@96fdaaa056f1cfa7ffbc4c69b7e9007279f76c94\n\n---\n file path A: .github/workflows/dev-infra.yml | file path B: .github/workflows/dev-infra.yml\n\n@@ -12,14 +12,14 @@ jobs:\n   labels:\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n+      - uses: actions/checkout@755da8c3cf115ac066823e79a1e1788f8940201b # tag=v3.2.0\n       - uses: angular/dev-infra/github-actions/commit-message-based-labels@96fdaaa056f1cfa7ffbc4c69b7e9007279f76c94\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n   post_approval_changes:\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n+      - uses: actions/checkout@755da8c3cf115ac066823e79a1e1788f8940201b # tag=v3.2.0\n       - uses: angular/dev-infra/github-actions/post-approval-changes@96fdaaa056f1cfa7ffbc4c69b7e9007279f76c94\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n---\n file path A: .github/workflows/google-internal-tests.yml | file path B: .github/workflows/google-internal-tests.yml\n\n@@ -12,7 +12,7 @@ jobs:\n   trigger:\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n+      - uses: actions/checkout@755da8c3cf115ac066823e79a1e1788f8940201b # tag=v3.2.0\n       - uses: angular/dev-infra/github-actions/google-internal-tests@96fdaaa056f1cfa7ffbc4c69b7e9007279f76c94\n         with:\n           run-tests-guide-url: http://go/angular/g3sync\n\n---\n file path A: .github/workflows/update-events.yml | file path B: .github/workflows/update-events.yml\n\n@@ -24,7 +24,7 @@ jobs:\n     runs-on: ubuntu-latest\n     steps:\n       - name: Checkout the repository\n-        uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n+        uses: actions/checkout@755da8c3cf115ac066823e79a1e1788f8940201b # tag=v3.2.0\n         with:\n           # Setting `persist-credentials: false` prevents the github-action account from being the\n           # account that is attempted to be used for authentication, instead the remote is set to\n\n---\n file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -52,9 +52,9 @@ http_archive(\n # Fetch Aspect lib for utilities like write_source_files\n http_archive(\n     name = \"aspect_bazel_lib\",\n-    sha256 = \"be236556c7b9c7b91cb370e837fdcec62b6e8893408cd4465ae883c9d7c67024\",\n-    strip_prefix = \"bazel-lib-1.18.0\",\n-    url = \"https://github.com/aspect-build/bazel-lib/archive/refs/tags/v1.18.0.tar.gz\",\n+    sha256 = \"a7bfc7aed7b86a4caaba382116e0214ebbaa623f393a9e716d87a3e1bab29d78\",\n+    strip_prefix = \"bazel-lib-1.19.0\",\n+    url = \"https://github.com/aspect-build/bazel-lib/archive/refs/tags/v1.19.0.tar.gz\",\n )\n \n # Download cli source from angular/cli-builds for doc generation at a specific tag or commit.\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -74,7 +74,7 @@\n     \"@angular/platform-browser-dynamic\": \"15.1.0-next.2\",\n     \"@angular/router\": \"15.1.0-next.2\",\n     \"@angular/service-worker\": \"15.1.0-next.2\",\n-    \"rxjs\": \"~7.6.0\",\n+    \"rxjs\": \"~7.8.0\",\n     \"safevalues\": \"^0.4.2\",\n     \"tslib\": \"^2.3.0\",\n     \"zone.js\": \"~0.12.0\"\n\n---\n file path A: aio/tools/examples/shared/boilerplate/cli-ajs/package.json | file path B: aio/tools/examples/shared/boilerplate/cli-ajs/package.json\n\n@@ -24,7 +24,7 @@\n     \"angular\": \"^1.8.3\",\n     \"angular-in-memory-web-api\": \"~0.15.0\",\n     \"angular-route\": \"1.8.3\",\n-    \"rxjs\": \"~7.6.0\",\n+    \"rxjs\": \"~7.8.0\",\n     \"tslib\": \"^2.3.0\",\n     \"zone.js\": \"~0.12.0\"\n   },\n\n---\n file path A: aio/tools/examples/shared/boilerplate/cli/package.json | file path B: aio/tools/examples/shared/boilerplate/cli/package.json\n\n@@ -22,7 +22,7 @@\n     \"@angular/platform-browser-dynamic\": \"^15.0.0-rc.1\",\n     \"@angular/router\": \"^15.0.0-rc.1\",\n     \"angular-in-memory-web-api\": \"~0.15.0\",\n-    \"rxjs\": \"~7.6.0\",\n+    \"rxjs\": \"~7.8.0\",\n     \"tslib\": \"^2.3.0\",\n     \"zone.js\": \"~0.12.0\"\n   },\n\n---\n file path A: aio/tools/examples/shared/boilerplate/elements/package.json | file path B: aio/tools/examples/shared/boilerplate/elements/package.json\n\n@@ -23,7 +23,7 @@\n     \"@angular/platform-browser-dynamic\": \"^15.0.0-rc.1\",\n     \"@angular/router\": \"^15.0.0-rc.1\",\n     \"angular-in-memory-web-api\": \"~0.15.0\",\n-    \"rxjs\": \"~7.6.0\",\n+    \"rxjs\": \"~7.8.0\",\n     \"tslib\": \"^2.3.0\",\n     \"zone.js\": \"~0.12.0\"\n   },\n\n---\n file path A: aio/tools/examples/shared/boilerplate/i18n/package.json | file path B: aio/tools/examples/shared/boilerplate/i18n/package.json\n\n@@ -25,7 +25,7 @@\n     \"@angular/platform-browser-dynamic\": \"^15.0.0-rc.1\",\n     \"@angular/router\": \"^15.0.0-rc.1\",\n     \"angular-in-memory-web-api\": \"~0.15.0\",\n-    \"rxjs\": \"~7.6.0\",\n+    \"rxjs\": \"~7.8.0\",\n     \"tslib\": \"^2.3.0\",\n     \"zone.js\": \"~0.12.0\"\n   },\n\n---\n file path A: aio/tools/examples/shared/boilerplate/service-worker/package.json | file path B: aio/tools/examples/shared/boilerplate/service-worker/package.json\n\n@@ -23,7 +23,7 @@\n     \"@angular/router\": \"^15.0.0-rc.1\",\n     \"@angular/service-worker\": \"^15.0.0-rc.1\",\n     \"angular-in-memory-web-api\": \"~0.15.0\",\n-    \"rxjs\": \"~7.6.0\",\n+    \"rxjs\": \"~7.8.0\",\n     \"tslib\": \"^2.3.0\",\n     \"zone.js\": \"~0.12.0\"\n   },\n\n---\n file path A: aio/tools/examples/shared/boilerplate/systemjs/package.json | file path B: aio/tools/examples/shared/boilerplate/systemjs/package.json\n\n@@ -35,7 +35,7 @@\n     \"@angular/router\": \"^15.0.0-rc.1\",\n     \"@angular/upgrade\": \"^15.0.0-rc.1\",\n     \"core-js\": \"^2.5.4\",\n-    \"rxjs\": \"~7.6.0\",\n+    \"rxjs\": \"~7.8.0\",\n     \"systemjs\": \"~0.19.39\",\n     \"systemjs-plugin-babel\": \"~0.0.25\",\n     \"tslib\": \"^2.3.0\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/universal/package.json | file path B: aio/tools/examples/shared/boilerplate/universal/package.json\n\n@@ -29,7 +29,7 @@\n     \"@nguniversal/express-engine\": \"^15.0.0-next.0\",\n     \"angular-in-memory-web-api\": \"~0.15.0\",\n     \"express\": \"^4.18.1\",\n-    \"rxjs\": \"~7.6.0\",\n+    \"rxjs\": \"~7.8.0\",\n     \"tslib\": \"^2.3.0\",\n     \"zone.js\": \"~0.12.0\"\n   },\n\n---\n file path A: aio/tools/examples/shared/package.json | file path B: aio/tools/examples/shared/package.json\n\n@@ -39,7 +39,7 @@\n     \"angular-route\": \"1.8.3\",\n     \"core-js\": \"^2.5.4\",\n     \"express\": \"^4.18.1\",\n-    \"rxjs\": \"~7.6.0\",\n+    \"rxjs\": \"~7.8.0\",\n     \"systemjs\": \"~0.19.39\",\n     \"systemjs-plugin-babel\": \"~0.0.25\",\n     \"tslib\": \"^2.3.0\",\n@@ -59,7 +59,7 @@\n     \"@types/angular-route\": \"^1.7.2\",\n     \"@types/express\": \"^4.17.13\",\n     \"@types/jasmine\": \"~4.3.0\",\n-    \"@types/jquery\": \"3.5.14\",\n+    \"@types/jquery\": \"3.5.16\",\n     \"@types/node\": \"^16.11.35\",\n     \"canonical-path\": \"1.0.0\",\n     \"concurrently\": \"^7.0.0\",\n\n---\n file path A: aio/tools/examples/shared/yarn.lock | file path B: aio/tools/examples/shared/yarn.lock\n\n@@ -1950,10 +1950,10 @@\n   resolved \"https://registry.yarnpkg.com/@types/jasmine/-/jasmine-4.3.0.tgz#1dfdfb226820911addb1b5a9031422be72c53aac\"\n   integrity sha512-u1jWakf8CWvLfSEZyxmzkgBzOEvXH/szpT0e6G8BTkx5Eu0BhDn7sbc5dz0JBN/6Wwm9rBe+JAsk9tJRyH9ZkA==\n \n-\"@types/jquery@3.5.14\":\n-  version \"3.5.14\"\n-  resolved \"https://registry.yarnpkg.com/@types/jquery/-/jquery-3.5.14.tgz#ac8e11ee591e94d4d58da602cb3a5a8320dee577\"\n-  integrity sha512-X1gtMRMbziVQkErhTQmSe2jFwwENA/Zr+PprCkF63vFq+Yt5PZ4AlKqgmeNlwgn7dhsXEK888eIW2520EpC+xg==\n+\"@types/jquery@3.5.16\":\n+  version \"3.5.16\"\n+  resolved \"https://registry.yarnpkg.com/@types/jquery/-/jquery-3.5.16.tgz#632131baf30951915b0317d48c98e9890bdf051d\"\n+  integrity sha512-bsI7y4ZgeMkmpG9OM710RRzDFp+w4P1RGiIt30C1mSBT+ExCleeh4HObwgArnDFELmRrOpXgSYN9VF1hj+f1lw==\n   dependencies:\n     \"@types/sizzle\" \"*\"\n \n@@ -7211,10 +7211,10 @@ rxjs@^7.0.0, rxjs@^7.5.5:\n   dependencies:\n     tslib \"^2.1.0\"\n \n-rxjs@~7.6.0:\n-  version \"7.6.0\"\n-  resolved \"https://registry.yarnpkg.com/rxjs/-/rxjs-7.6.0.tgz#361da5362b6ddaa691a2de0b4f2d32028f1eb5a2\"\n-  integrity sha512-DDa7d8TFNUalGC9VqXvQ1euWNN7sc63TrUCuM9J998+ViviahMIjKSOU7rfcgFOF+FCD71BhDRv4hrFz+ImDLQ==\n+rxjs@~7.8.0:\n+  version \"7.8.0\"\n+  resolved \"https://registry.yarnpkg.com/rxjs/-/rxjs-7.8.0.tgz#90a938862a82888ff4c7359811a595e14e1e09a4\"\n+  integrity sha512-F2+gxDshqmIub1KdvZkaEfGDwLNpPvk9Fs6LD/MyQxNgMds/WH9OdDDXOmxUZpME+iSK3rQCctkL0DYyytUqMg==\n   dependencies:\n     tslib \"^2.1.0\"\n \n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -11630,10 +11630,10 @@ rxjs@^7.5.5:\n   dependencies:\n     tslib \"^2.1.0\"\n \n-rxjs@~7.6.0:\n-  version \"7.6.0\"\n-  resolved \"https://registry.yarnpkg.com/rxjs/-/rxjs-7.6.0.tgz#361da5362b6ddaa691a2de0b4f2d32028f1eb5a2\"\n-  integrity sha512-DDa7d8TFNUalGC9VqXvQ1euWNN7sc63TrUCuM9J998+ViviahMIjKSOU7rfcgFOF+FCD71BhDRv4hrFz+ImDLQ==\n+rxjs@~7.8.0:\n+  version \"7.8.0\"\n+  resolved \"https://registry.yarnpkg.com/rxjs/-/rxjs-7.8.0.tgz#90a938862a82888ff4c7359811a595e14e1e09a4\"\n+  integrity sha512-F2+gxDshqmIub1KdvZkaEfGDwLNpPvk9Fs6LD/MyQxNgMds/WH9OdDDXOmxUZpME+iSK3rQCctkL0DYyytUqMg==\n   dependencies:\n     tslib \"^2.1.0\"\n \n\n---\n file path A: package.json | file path B: package.json\n\n@@ -89,7 +89,7 @@\n     \"@types/babel__traverse\": \"7.18.3\",\n     \"@types/base64-js\": \"1.3.0\",\n     \"@types/bluebird\": \"^3.5.27\",\n-    \"@types/chrome\": \"^0.0.203\",\n+    \"@types/chrome\": \"^0.0.206\",\n     \"@types/convert-source-map\": \"^1.5.1\",\n     \"@types/diff\": \"^5.0.0\",\n     \"@types/events\": \"3.0.0\",\n@@ -195,7 +195,7 @@\n     \"glob\": \"8.0.3\",\n     \"gulp\": \"^4.0.2\",\n     \"gulp-conventional-changelog\": \"^2.0.35\",\n-    \"husky\": \"8.0.2\",\n+    \"husky\": \"8.0.3\",\n     \"karma-sauce-launcher\": \"^4.3.6\",\n     \"madge\": \"^5.0.0\",\n     \"multimatch\": \"^6.0.0\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -3708,10 +3708,10 @@\n     \"@types/node\" \"*\"\n     \"@types/responselike\" \"*\"\n \n-\"@types/chrome@^0.0.203\":\n-  version \"0.0.203\"\n-  resolved \"https://registry.yarnpkg.com/@types/chrome/-/chrome-0.0.203.tgz#cf883669ba489ec965e48d32cdcf14f45437f7cf\"\n-  integrity sha512-JlQNebwpBETVc8U1Rr2inDFuOTtn0lahRAhnddx1dd0S5RrLAFJEEsyIu7AXI14mkCgSunksnuLGioH8kvBqRA==\n+\"@types/chrome@^0.0.206\":\n+  version \"0.0.206\"\n+  resolved \"https://registry.yarnpkg.com/@types/chrome/-/chrome-0.0.206.tgz#ad1fd9799f368b5993d7c240492d4adaf5efbd8c\"\n+  integrity sha512-fQnTFjghPB9S4UzbfublUB6KmsBkvvJeGXGaaoD5Qu+ZxrDUfgJnKN5egLSzDcGAH5YxQubDgbCdNwwUGewQHg==\n   dependencies:\n     \"@types/filesystem\" \"*\"\n     \"@types/har-format\" \"*\"\n@@ -9803,10 +9803,10 @@ humanize-ms@^1.2.1:\n   dependencies:\n     ms \"^2.0.0\"\n \n-husky@8.0.2:\n-  version \"8.0.2\"\n-  resolved \"https://registry.yarnpkg.com/husky/-/husky-8.0.2.tgz#5816a60db02650f1f22c8b69b928fd6bcd77a236\"\n-  integrity sha512-Tkv80jtvbnkK3mYWxPZePGFpQ/tT3HNSs/sasF9P2YfkMezDl3ON37YN6jUUI4eTg5LcyVynlb6r4eyvOmspvg==\n+husky@8.0.3:\n+  version \"8.0.3\"\n+  resolved \"https://registry.yarnpkg.com/husky/-/husky-8.0.3.tgz#4936d7212e46d1dea28fef29bb3a108872cd9184\"\n+  integrity sha512-+dQSyqPh4x1hlO1swXBiNb2HzTDN1I2IGLQx1GrBuiqFJfoMrnZWwVmatvSiO+Iz8fBUnf+lekwNo4c2LlXItg==\n \n iconv-lite@0.4.24, iconv-lite@^0.4.24:\n   version \"0.4.24\"\n\n\n###\n\n", "completion": "build: update all non-major dependencies (#<issue-num>)"}
{"prompt": " file path A: None | file path B: aio/content/errors/NG0403.md\n\n@@ -0,0 +1,42 @@\n+@name Bootstrapped NgModule doesn't specify which component to initialize\n+@category runtime\n+@shortDescription An NgModule that was used for bootstrapping does not specify which component should be initialized.\n+\n+@description\n+This error means that an NgModule that was used for bootstrapping an application is missing key information for Angular to proceed with the bootstrap process.\n+\n+The error happens when the NgModule `bootstrap` property is missing (or is an empty array) in the `@NgModule` annotation and there is no `ngDoBootstrap` lifecycle hook defined on that NgModule class.\n+\n+More information about the bootstrapping process can be found in [this guide](guide/bootstrapping).\n+\n+The following examples will trigger the error.\n+\n+```typescript\n+@NgModule({\n+  declarations: [AppComponent],\n+  imports: [BrowserModule, AppRoutingModule],\n+  providers: [],\n+})\n+export class AppModule {}\n+\n+// The `AppModule` is used for bootstrapping, but the `@NgModule.bootstrap` field is missing.\n+platformBrowser().bootstrapModule(AppModule);\n+```\n+\n+```typescript\n+@NgModule({\n+  declarations: [AppComponent],\n+  imports: [BrowserModule, AppRoutingModule],\n+  providers: [],\n+  bootstrap: [],\n+})\n+export class AppModule {}\n+\n+// The `AppModule` is used for bootstrapping, but the `@NgModule.bootstrap` field contains an empty array.\n+platformBrowser().bootstrapModule(AppModule);\n+```\n+\n+@debugging\n+Please make sure that the NgModule that is used for bootstrapping is setup correctly:\n+- either the `bootstrap` property exists (and contains a non-empty array) in the `@NgModule` annotation\n+- or the `ngDoBootstrap` method exists on the NgModule class\n\n---\n file path A: goldens/public-api/core/errors.md | file path B: goldens/public-api/core/errors.md\n\n@@ -21,7 +21,7 @@ export const enum RuntimeErrorCode {\n     // (undocumented)\n     ASYNC_INITIALIZERS_STILL_RUNNING = 405,\n     // (undocumented)\n-    BOOTSTRAP_COMPONENTS_NOT_FOUND = 403,\n+    BOOTSTRAP_COMPONENTS_NOT_FOUND = -403,\n     // (undocumented)\n     CYCLIC_DI_DEPENDENCY = -200,\n     // (undocumented)\n\n---\n file path A: packages/core/src/errors.ts | file path B: packages/core/src/errors.ts\n\n@@ -53,7 +53,7 @@ export const enum RuntimeErrorCode {\n   MULTIPLE_PLATFORMS = 400,\n   PLATFORM_NOT_FOUND = 401,\n   ERROR_HANDLER_NOT_FOUND = 402,\n-  BOOTSTRAP_COMPONENTS_NOT_FOUND = 403,\n+  BOOTSTRAP_COMPONENTS_NOT_FOUND = -403,\n   PLATFORM_ALREADY_DESTROYED = 404,\n   ASYNC_INITIALIZERS_STILL_RUNNING = 405,\n   APPLICATION_REF_ALREADY_DESTROYED = 406,\n\n---\n file path A: packages/core/test/application_ref_spec.ts | file path B: packages/core/test/application_ref_spec.ts\n\n@@ -456,8 +456,10 @@ class SomeComponent {\n          waitForAsync(async () => {\n            defaultPlatform.bootstrapModule(await createModule({ngDoBootstrap: false}))\n                .then(() => expect(false).toBe(true), (e) => {\n-                 const expectedErrMsg =\n-                     `NG0403: The module MyModule was bootstrapped, but it does not declare \"@NgModule.bootstrap\" components nor a \"ngDoBootstrap\" method. Please define one of these.`;\n+                 const expectedErrMsg = `NG0403: The module MyModule was bootstrapped, ` +\n+                     `but it does not declare \"@NgModule.bootstrap\" components nor a \"ngDoBootstrap\" method. ` +\n+                     `Please define one of these. ` +\n+                     `Find more at https://angular.io/errors/NG0403`;\n                  expect(e.message).toEqual(expectedErrMsg);\n                  expect(mockConsole.res[0].join('#')).toEqual('ERROR#Error: ' + expectedErrMsg);\n                });\n\n\n###\n\n", "completion": "docs: add NG0403.md for Bootstrapped NgModule doesn't specify which component to initialize error (#<issue-num>)"}
{"prompt": " file path A: package.json | file path B: package.json\n\n@@ -137,8 +137,6 @@\n     \"jasmine\": \"^4.0.0\",\n     \"jasmine-ajax\": \"^4.0.0\",\n     \"jasmine-core\": \"^4.0.0\",\n-    \"jquery\": \"3.6.1\",\n-    \"js-levenshtein\": \"^1.1.6\",\n     \"karma\": \"~6.4.0\",\n     \"karma-chrome-launcher\": \"^3.1.0\",\n     \"karma-firefox-launcher\": \"^2.1.0\",\n@@ -185,13 +183,9 @@\n     \"@bazel/buildifier\": \"^5.0.0\",\n     \"@bazel/ibazel\": \"^0.16.0\",\n     \"@octokit/graphql\": \"^5.0.0\",\n-    \"@types/browser-sync\": \"^2.26.1\",\n     \"@types/cldrjs\": \"^0.4.22\",\n     \"@types/cli-progress\": \"^3.4.2\",\n-    \"@types/minimist\": \"^1.2.0\",\n-    \"@types/send\": \"^0.17.0\",\n     \"@yarnpkg/lockfile\": \"^1.1.0\",\n-    \"browser-sync\": \"2.27.10\",\n     \"check-side-effects\": \"0.0.23\",\n     \"cldr\": \"7.3.0\",\n     \"cldrjs\": \"0.5.5\",\n@@ -204,13 +198,11 @@\n     \"husky\": \"8.0.2\",\n     \"karma-sauce-launcher\": \"^4.3.6\",\n     \"madge\": \"^5.0.0\",\n-    \"minimist\": \"^1.2.0\",\n     \"multimatch\": \"^6.0.0\",\n     \"patch-package\": \"^6.5.0\",\n     \"prettier\": \"^2.5.1\",\n     \"sauce-connect\": \"https://saucelabs.com/downloads/sc-4.8.1-linux.tar.gz\",\n     \"semver\": \"^7.3.5\",\n-    \"send\": \"^0.18.0\",\n     \"ts-node\": \"^10.8.1\",\n     \"tsec\": \"0.2.6\",\n     \"tslint-eslint-rules\": \"5.4.0\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -3688,7 +3688,7 @@\n   dependencies:\n     \"@types/node\" \"*\"\n \n-\"@types/browser-sync@^2.26.1\", \"@types/browser-sync@^2.26.3\":\n+\"@types/browser-sync@^2.26.3\":\n   version \"2.26.3\"\n   resolved \"https://registry.yarnpkg.com/@types/browser-sync/-/browser-sync-2.26.3.tgz#d8a2c316144b55d5cb11328b7cb63dc1778de524\"\n   integrity sha512-HIiI438D8q/DXFhdc2JELRMPtuHmR+0q+QNwP/mQoItHvPi7LK+bkZC7amKrSpnB2t4ct8BRd32LtOfd6TMNIw==\n@@ -4082,7 +4082,7 @@\n   resolved \"https://registry.yarnpkg.com/@types/semver/-/semver-7.3.10.tgz#5f19ee40cbeff87d916eedc8c2bfe2305d957f73\"\n   integrity sha512-zsv3fsC7S84NN6nPK06u79oWgrPVd0NvOyqgghV1haPaFcVxIrP4DLomRwGAXk0ui4HZA7mOcSFL98sMVW9viw==\n \n-\"@types/send@^0.17.0\", \"@types/send@^0.17.1\":\n+\"@types/send@^0.17.1\":\n   version \"0.17.1\"\n   resolved \"https://registry.yarnpkg.com/@types/send/-/send-0.17.1.tgz#ed4932b8a2a805f1fe362a70f4e62d0ac994e301\"\n   integrity sha512-Cwo8LE/0rnvX7kIIa3QHCkcuF21c05Ayb0ZfxPiv0W8VRiZiNW/WuRupHKpqqGVGf7SUA44QSOUKaEd9lIrd/Q==\n@@ -5325,7 +5325,7 @@ browser-sync-ui@^2.27.10:\n     socket.io-client \"^4.4.1\"\n     stream-throttle \"^0.1.3\"\n \n-browser-sync@2.27.10, browser-sync@^2.27.7:\n+browser-sync@^2.27.7:\n   version \"2.27.10\"\n   resolved \"https://registry.yarnpkg.com/browser-sync/-/browser-sync-2.27.10.tgz#3568d4f66afb0f68fee4a10902ecbbe8b2f680dd\"\n   integrity sha512-xKm+6KJmJu6RuMWWbFkKwOCSqQOxYe3nOrFkKI5Tr/ZzjPxyU3pFShKK3tWnazBo/3lYQzN7fzjixG8fwJh1Xw==\n@@ -10597,16 +10597,6 @@ join-path@^1.1.1:\n     url-join \"0.0.1\"\n     valid-url \"^1\"\n \n-jquery@3.6.1:\n-  version \"3.6.1\"\n-  resolved \"https://registry.yarnpkg.com/jquery/-/jquery-3.6.1.tgz#fab0408f8b45fc19f956205773b62b292c147a16\"\n-  integrity sha512-opJeO4nCucVnsjiXOE+/PcCgYw9Gwpvs/a6B1LL/lQhwWwpbVEVYDZ1FokFr8PRc7ghYlrFPuyHuiiDNTQxmcw==\n-\n-js-levenshtein@^1.1.6:\n-  version \"1.1.6\"\n-  resolved \"https://registry.yarnpkg.com/js-levenshtein/-/js-levenshtein-1.1.6.tgz#c6cee58eb3550372df8deb85fad5ce66ce01d59d\"\n-  integrity sha512-X2BB11YZtrRqY4EnQcLX5Rh373zbK4alC1FW7D7MBhL2gtcC17cTnr6DmfHZeS0s2rTHjUTMMHfG7gO8SSdw+g==\n-\n js-tokens@^4.0.0:\n   version \"4.0.0\"\n   resolved \"https://registry.yarnpkg.com/js-tokens/-/js-tokens-4.0.0.tgz#19203fb59991df98e3a287050d4647cdeaf32499\"\n\n\n###\n\n", "completion": "build: remove unused dependencies (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/package.json | file path B: packages/compiler-cli/package.json\n\n@@ -53,7 +53,7 @@\n     }\n   },\n   \"dependencies\": {\n-    \"@babel/core\": \"^7.17.2\",\n+    \"@babel/core\": \"7.19.3\",\n     \"@jridgewell/sourcemap-codec\": \"^1.4.14\",\n     \"reflect-metadata\": \"^0.1.2\",\n     \"chokidar\": \"^3.0.0\",\n\n\n###\n\n", "completion": "fix(compiler-cli): update `@babel/core` dependency and lock version (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/aio-preview-deploy.yml | file path B: .github/workflows/aio-preview-deploy.yml\n\n@@ -17,8 +17,8 @@ permissions:\n   pull-requests: write\n \n env:\n-  # TODO(pgschwendtner): use a different project for framework previews here.\n-  PREVIEW_PROJECT: ng-comp-dev\n+  PREVIEW_PROJECT: ng-dev-previews\n+  PREVIEW_SITE: ng-dev-previews-fw\n \n jobs:\n   aio-deploy:\n@@ -31,9 +31,8 @@ jobs:\n         working-directory: aio/\n         run: |\n           # We can use `npx` as the Firebase deploy actions uses it too.\n-          # The default site is used as we don't use multi-sites in the project.\n           npx -y firebase-tools@latest target:clear --project ${{env.PREVIEW_PROJECT}} hosting aio\n-          npx -y firebase-tools@latest target:apply --project ${{env.PREVIEW_PROJECT}} hosting aio ${{env.PREVIEW_PROJECT}}\n+          npx -y firebase-tools@latest target:apply --project ${{env.PREVIEW_PROJECT}} hosting aio ${{env.PREVIEW_SITE}}\n \n       - uses: angular/dev-infra/github-actions/deploy-previews/upload-artifacts-to-firebase@96fdaaa056f1cfa7ffbc4c69b7e9007279f76c94\n         with:\n\n\n###\n\n", "completion": "build: switch from `ng-comp-dev` to canonical dev-infra preview Firebase project (#<issue-num>)"}
{"prompt": " file path A: aio/src/app/app.component.html | file path B: aio/src/app/app.component.html\n\n@@ -11,7 +11,7 @@\n <header>\n   <mat-toolbar #appToolbar color=\"primary\" class=\"app-toolbar no-print\" [class.transitioning]=\"isTransitioning\">\n     <mat-toolbar-row class=\"notification-container\">\n-      <aio-notification notificationId=\"survey-november-2022\" expirationDate=\"2023-02-01\" [dismissOnContentClick]=\"true\" (dismissed)=\"notificationDismissed()\">\n+      <aio-notification notificationId=\"survey-november-2022\" expirationDate=\"2022-12-20\" [dismissOnContentClick]=\"true\" (dismissed)=\"notificationDismissed()\">\n         <a href=\"https://survey.devographics.com/survey/state-of-js/2022\">\n           <mat-icon class=\"icon\" svgIcon=\"insert_comment\" aria-label=\"Announcement\"></mat-icon>\n           <span class=\"message\">Share your experience with Angular in <b>The State of JavaScript</b></span>\n\n\n###\n\n", "completion": "docs: hide state of js survey (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/preconnect_link_checker.ts | file path B: packages/common/src/directives/ng_optimized_image/preconnect_link_checker.ts\n\n@@ -88,7 +88,7 @@ export class PreconnectLinkChecker {\n   }\n \n   /**\n-   * Checks that a preconnect resource hint exists in the head fo rthe\n+   * Checks that a preconnect resource hint exists in the head for the\n    * given src.\n    *\n    * @param rewrittenSrc src formatted with loader\n\n\n###\n\n", "completion": "docs: fix typo in preconnect_link_checker.ts (#<issue-num>)"}
{"prompt": " file path A: packages/zone.js/rollup.config.js | file path B: packages/zone.js/rollup.config.js\n\n@@ -1,5 +1,6 @@\n const node = require('@rollup/plugin-node-resolve').default;\n const commonjs = require('@rollup/plugin-commonjs');\n+const MagicString = require('magic-string');\n \n // Parse the stamp file produced by Bazel from the version control system\n let version = '<unknown>';\n@@ -14,6 +15,29 @@ if (bazel_version_file) {\n   }\n }\n \n+/** Removed license banners from input files. */\n+const stripBannerPlugin = {\n+  name: 'strip-license-banner',\n+  transform(code, _filePath) {\n+    const banner = /(\\/\\**\\s+\\*\\s@license.*?\\*\\/)/s.exec(code);\n+    if (!banner) {\n+      return;\n+    }\n+\n+    const [bannerContent] = banner;\n+    const magicString = new MagicString(code);\n+    const pos = code.indexOf(bannerContent);\n+    magicString.remove(pos, pos + bannerContent.length).trimStart();\n+\n+    return {\n+      code: magicString.toString(),\n+      map: magicString.generateMap({\n+        hires: true,\n+      }),\n+    };\n+  },\n+};\n+\n // Add 'use strict' to the bundle, https://github.com/angular/angular/pull/40456\n // When rollup build esm bundle of zone.js, there will be no 'use strict'\n // since all esm bundles are `strict`, but when webpack load the esm bundle,\n@@ -35,6 +59,7 @@ module.exports = {\n       mainFields: ['es2015', 'module', 'jsnext:main', 'main'],\n     }),\n     commonjs(),\n+    stripBannerPlugin,\n   ],\n   external: (id) => {\n     if (/zone\\.js[\\\\/]lib/.test(id)) {\n\n---\n file path A: packages/zone.js/test/karma_test.bzl | file path B: packages/zone.js/test/karma_test.bzl\n\n@@ -18,6 +18,7 @@ def karma_test_prepare(name, env_srcs, env_deps, env_entry_point, test_srcs, tes\n             \":\" + name + \"_env\",\n             \"@npm//@rollup/plugin-commonjs\",\n             \"@npm//@rollup/plugin-node-resolve\",\n+            \"@npm//magic-string\",\n         ],\n     )\n     ts_library(\n@@ -37,6 +38,7 @@ def karma_test_prepare(name, env_srcs, env_deps, env_entry_point, test_srcs, tes\n             \":\" + name + \"_test\",\n             \"@npm//@rollup/plugin-commonjs\",\n             \"@npm//@rollup/plugin-node-resolve\",\n+            \"@npm//magic-string\",\n         ],\n     )\n \n\n---\n file path A: packages/zone.js/tools.bzl | file path B: packages/zone.js/tools.bzl\n\n@@ -2,7 +2,7 @@\n \n load(\"//tools:defaults.bzl\", \"rollup_bundle\")\n \n-def zone_rollup_bundle(module_name, entry_point, rollup_config):\n+def zone_rollup_bundle(module_name, entry_point):\n     config_file = \"//packages/zone.js:rollup.config.js\"\n     rollup_bundle(\n         name = module_name + \"-rollup\",\n@@ -14,6 +14,7 @@ def zone_rollup_bundle(module_name, entry_point, rollup_config):\n             \"//packages/zone.js/lib\",\n             \"@npm//@rollup/plugin-commonjs\",\n             \"@npm//@rollup/plugin-node-resolve\",\n+            \"@npm//magic-string\",\n         ],\n     )\n \n@@ -44,23 +45,19 @@ def generate_rollup_bundle(bundles):\n             entry_point = rollup_config.get(\"entrypoint\")\n             zone_rollup_bundle(\n                 module_name = module_name + \"-es5\",\n-                rollup_config = rollup_config,\n                 entry_point = entry_point,\n             )\n             zone_rollup_bundle(\n                 module_name = module_name + \"-es2015\",\n-                rollup_config = rollup_config,\n                 entry_point = entry_point,\n             )\n         else:\n             zone_rollup_bundle(\n                 module_name = module_name + \"-es5\",\n-                rollup_config = rollup_config,\n                 entry_point = rollup_config.get(\"es5\"),\n             )\n             zone_rollup_bundle(\n                 module_name = module_name + \"-es2015\",\n-                rollup_config = rollup_config,\n                 entry_point = rollup_config.get(\"es2015\"),\n             )\n \n\n\n###\n\n", "completion": "build: remove duplicate license banners from FESM bundles (#<issue-num>)"}
{"prompt": " file path A: packages/bazel/package.json | file path B: packages/bazel/package.json\n\n@@ -23,6 +23,7 @@\n   },\n   \"dependencies\": {\n     \"@microsoft/api-extractor\": \"^7.24.2\",\n+    \"magic-string\": \"^0.27.0\",\n     \"tsickle\": \"^0.46.3\",\n     \"tslib\": \"^2.3.0\"\n   },\n\n---\n file path A: packages/bazel/src/ng_package/rollup.config.js | file path B: packages/bazel/src/ng_package/rollup.config.js\n\n@@ -11,6 +11,7 @@\n \n const {nodeResolve} = require('@rollup/plugin-node-resolve');\n const commonjs = require('@rollup/plugin-commonjs');\n+const MagicString = require('magic-string');\n const sourcemaps = require('rollup-plugin-sourcemaps');\n const path = require('path');\n const fs = require('fs');\n@@ -169,6 +170,29 @@ const downlevelToES2015Plugin = {\n   },\n };\n \n+/** Removed license banners from input files. */\n+const stripBannerPlugin = {\n+  name: 'strip-license-banner',\n+  transform(code, _filePath) {\n+    const banner = /(\\/\\**\\s+\\*\\s@license.*?\\*\\/)/s.exec(code);\n+    if (!banner) {\n+      return;\n+    }\n+\n+    const [bannerContent] = banner;\n+    const magicString = new MagicString(code);\n+    const pos = code.indexOf(bannerContent);\n+    magicString.remove(pos, pos + bannerContent.length).trimStart();\n+\n+    return {\n+      code: magicString.toString(),\n+      map: magicString.generateMap({\n+        hires: true,\n+      }),\n+    };\n+  }\n+};\n+\n const plugins = [\n   {\n     name: 'resolveBazel',\n@@ -179,6 +203,7 @@ const plugins = [\n     jail: process.cwd(),\n     customResolveOptions: {moduleDirectory: nodeModulesRoot}\n   }),\n+  stripBannerPlugin,\n   commonjs({ignoreGlobal: true}),\n   sourcemaps(),\n ];\n\n---\n file path A: packages/bazel/src/ng_package/rollup/BUILD.bazel | file path B: packages/bazel/src/ng_package/rollup/BUILD.bazel\n\n@@ -13,6 +13,7 @@ nodejs_binary(\n     data = [\n         \"@npm//@rollup/plugin-commonjs\",\n         \"@npm//@rollup/plugin-node-resolve\",\n+        \"@npm//magic-string\",\n         \"@npm//rollup\",\n         \"@npm//rollup-plugin-sourcemaps\",\n         \"@npm//typescript\",\n\n---\n file path A: packages/bazel/test/ng_package/example_package.golden | file path B: packages/bazel/test/ng_package/example_package.golden\n\n@@ -321,13 +321,6 @@ export const a = 1;\n import * as i0 from '@angular/core';\n import { NgModule } from '@angular/core';\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n class A11yModule {\n }\n A11yModule.\u0275fac = i0.\u0275\u0275ngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport: i0, type: A11yModule, deps: [], target: i0.\u0275\u0275FactoryTarget.NgModule });\n@@ -338,14 +331,6 @@ i0.\u0275\u0275ngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport\n             args: [{}]\n         }] });\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n /**\n  * Generated bundle index. Do not edit.\n  */\n@@ -365,13 +350,6 @@ export { A11yModule };\n import * as i0 from '@angular/core';\n import { Injectable } from '@angular/core';\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n class MySecondService {\n }\n MySecondService.\u0275fac = i0.\u0275\u0275ngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport: i0, type: MySecondService, deps: [], target: i0.\u0275\u0275FactoryTarget.Injectable });\n@@ -381,13 +359,6 @@ i0.\u0275\u0275ngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport\n             args: [{ providedIn: 'root' }]\n         }] });\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n class MyService {\n     constructor(secondService) {\n         this.secondService = secondService;\n@@ -400,14 +371,6 @@ i0.\u0275\u0275ngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport\n             args: [{ providedIn: 'root' }]\n         }], ctorParameters: function () { return [{ type: MySecondService }]; } });\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n /**\n  * Generated bundle index. Do not edit.\n  */\n@@ -427,13 +390,6 @@ export { MyService };\n import * as i0 from '@angular/core';\n import { NgModule } from '@angular/core';\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n class SecondaryModule {\n }\n SecondaryModule.\u0275fac = i0.\u0275\u0275ngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport: i0, type: SecondaryModule, deps: [], target: i0.\u0275\u0275FactoryTarget.NgModule });\n@@ -445,14 +401,6 @@ i0.\u0275\u0275ngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport\n         }] });\n const a = 1;\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n /**\n  * Generated bundle index. Do not edit.\n  */\n@@ -472,13 +420,6 @@ export { SecondaryModule, a };\n import * as i0 from '@angular/core';\n import { NgModule } from '@angular/core';\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n class MyModule {\n }\n MyModule.\u0275fac = i0.\u0275\u0275ngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport: i0, type: MyModule, deps: [], target: i0.\u0275\u0275FactoryTarget.NgModule });\n@@ -489,14 +430,6 @@ i0.\u0275\u0275ngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport\n             args: [{}]\n         }] });\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n /**\n  * Generated bundle index. Do not edit.\n  */\n@@ -516,13 +449,6 @@ export { MyModule };\n import * as i0 from '@angular/core';\n import { NgModule } from '@angular/core';\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n class A11yModule {\n }\n A11yModule.\u0275fac = i0.\u0275\u0275ngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport: i0, type: A11yModule, deps: [], target: i0.\u0275\u0275FactoryTarget.NgModule });\n@@ -533,14 +459,6 @@ i0.\u0275\u0275ngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport\n             args: [{}]\n         }] });\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n /**\n  * Generated bundle index. Do not edit.\n  */\n@@ -560,13 +478,6 @@ export { A11yModule };\n import * as i0 from '@angular/core';\n import { Injectable } from '@angular/core';\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n class MySecondService {\n }\n MySecondService.\u0275fac = i0.\u0275\u0275ngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport: i0, type: MySecondService, deps: [], target: i0.\u0275\u0275FactoryTarget.Injectable });\n@@ -576,13 +487,6 @@ i0.\u0275\u0275ngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport\n             args: [{ providedIn: 'root' }]\n         }] });\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n class MyService {\n     constructor(secondService) {\n         this.secondService = secondService;\n@@ -595,14 +499,6 @@ i0.\u0275\u0275ngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport\n             args: [{ providedIn: 'root' }]\n         }], ctorParameters: function () { return [{ type: MySecondService }]; } });\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n /**\n  * Generated bundle index. Do not edit.\n  */\n@@ -622,13 +518,6 @@ export { MyService };\n import * as i0 from '@angular/core';\n import { NgModule } from '@angular/core';\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n class SecondaryModule {\n }\n SecondaryModule.\u0275fac = i0.\u0275\u0275ngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport: i0, type: SecondaryModule, deps: [], target: i0.\u0275\u0275FactoryTarget.NgModule });\n@@ -640,14 +529,6 @@ i0.\u0275\u0275ngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport\n         }] });\n const a = 1;\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n /**\n  * Generated bundle index. Do not edit.\n  */\n@@ -667,13 +548,6 @@ export { SecondaryModule, a };\n import * as i0 from '@angular/core';\n import { NgModule } from '@angular/core';\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n class MyModule {\n }\n MyModule.\u0275fac = i0.\u0275\u0275ngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport: i0, type: MyModule, deps: [], target: i0.\u0275\u0275FactoryTarget.NgModule });\n@@ -684,14 +558,6 @@ i0.\u0275\u0275ngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport\n             args: [{}]\n         }] });\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n /**\n  * Generated bundle index. Do not edit.\n  */\n\n---\n file path A: packages/bazel/test/ng_package/example_with_ts_library_package.golden | file path B: packages/bazel/test/ng_package/example_with_ts_library_package.golden\n\n@@ -129,13 +129,6 @@ export function dispatchFakeEvent(el, ev) {\n  * License: MIT\n  */\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n const VERSION = '0.0.0';\n \n export { VERSION };\n@@ -153,13 +146,6 @@ export { VERSION };\n import * as i0 from '@angular/core';\n import { NgModule } from '@angular/core';\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n class PortalModule {\n }\n PortalModule.\u0275fac = i0.\u0275\u0275ngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport: i0, type: PortalModule, deps: [], target: i0.\u0275\u0275FactoryTarget.NgModule });\n@@ -171,14 +157,6 @@ i0.\u0275\u0275ngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport\n         }] });\n const a = 1;\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n /**\n  * Generated bundle index. Do not edit.\n  */\n@@ -195,25 +173,10 @@ export { PortalModule, a };\n  * License: MIT\n  */\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n function dispatchFakeEvent(el, ev) {\n     el.dispatchEvent(ev);\n }\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n export { dispatchFakeEvent };\n //# sourceMappingURL=utils.mjs.map\n \n@@ -226,13 +189,6 @@ export { dispatchFakeEvent };\n  * License: MIT\n  */\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n const VERSION = '0.0.0';\n \n export { VERSION };\n@@ -250,13 +206,6 @@ export { VERSION };\n import * as i0 from '@angular/core';\n import { NgModule } from '@angular/core';\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n class PortalModule {\n }\n PortalModule.\u0275fac = i0.\u0275\u0275ngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport: i0, type: PortalModule, deps: [], target: i0.\u0275\u0275FactoryTarget.NgModule });\n@@ -268,14 +217,6 @@ i0.\u0275\u0275ngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0\", ngImport\n         }] });\n const a = 1;\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n /**\n  * Generated bundle index. Do not edit.\n  */\n@@ -292,25 +233,10 @@ export { PortalModule, a };\n  * License: MIT\n  */\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n function dispatchFakeEvent(el, ev) {\n     el.dispatchEvent(ev);\n }\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n export { dispatchFakeEvent };\n //# sourceMappingURL=utils.mjs.map\n \n\n\n###\n\n", "completion": "fix(bazel): remove duplicate license banners from FESM bundles (#<issue-num>)"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -125,7 +125,6 @@ copy_to_directory(\n # All source and configuration files required to build the docs app\n APPLICATION_FILES = [\n     \"angular.json\",\n-    \"package.json\",\n     \"tsconfig.app.json\",\n     \"tsconfig.json\",\n     \"tsconfig.worker.json\",\n\n---\n file path A: aio/scripts/local-workspace-status.mjs | file path B: aio/scripts/local-workspace-status.mjs\n\n@@ -16,7 +16,20 @@ const pkgJson = JSON.parse(fs.readFileSync(pkgJsonPath, 'utf8'));\n \n const aioAngularVersion = pkgJson.dependencies['@angular/core'].replace(/^[\\^~]/, '') + \"+forAIOLocalBuildToAvoidMismatch\";\n \n-// Output the workspace status variable format to stdout so Bazel can read it\n console.log(`\\\n BUILD_SCM_VERSION ${aioAngularVersion}\n `);\n+\n+// Fix stable-status.txt values to improve remote cache performance.\n+console.log(`\\\n+BUILD_HOST fake_host\n+BUILD_USER fake_user\n+`)\n+\n+// Fix the timestamp in volatile-status.txt to improve remote cache performance.\n+// Unlike the local Bazel cache, the remote cache does not ignore volatile-status.txt\n+// and will invalidate actions that depend on it when the values change.\n+// https://github.com/bazelbuild/bazel/issues/10075#issuecomment-546872111\n+console.log(`\\\n+BUILD_TIMESTAMP 0\n+`)\n\n---\n file path A: aio/tools/example-zipper/exampleZipper.mjs | file path B: aio/tools/example-zipper/exampleZipper.mjs\n\n@@ -182,18 +182,25 @@ export class ExampleZipper {\n       // zip.append(fs.createReadStream(fileName), { name: relativePath });\n       let output = regionExtractor()(content, extn).contents;\n \n-      zip.append(output, { name: relativePath } );\n+      appendToZip(zip, output, { name: relativePath });\n     });\n \n     // also a systemjs config\n     if (exampleType === 'systemjs') {\n-      zip.append(fs.readFileSync(this.examplesSystemjsConfig, 'utf8'), { name: 'src/systemjs.config.js' });\n-      zip.append(fs.readFileSync(this.examplesSystemjsLoaderConfig, 'utf8'), { name: 'src/systemjs-angular-loader.js' });\n+      appendToZip(zip, fs.readFileSync(this.examplesSystemjsConfig, 'utf8'), { name: 'src/systemjs.config.js' });\n+      appendToZip(zip, fs.readFileSync(this.examplesSystemjsLoaderConfig, 'utf8'), { name: 'src/systemjs-angular-loader.js' });\n       // a modified tsconfig\n       let tsconfig = fs.readFileSync(this.exampleTsconfig, 'utf8');\n-      zip.append(this._changeTypeRoots(tsconfig), {name: 'src/tsconfig.json'});\n+      appendToZip(zip, this._changeTypeRoots(tsconfig), {name: 'src/tsconfig.json' });\n     }\n \n     zip.finalize();\n   }\n }\n+\n+// Fix the timestamp on zip entries in order create reproducible zip\n+// files, which improves remote Bazel cache performance.\n+function appendToZip(zip, source, data) {\n+  const FIXED_DATE = new Date(0);\n+  zip.append(source, {...data, date: FIXED_DATE});\n+}\n\n\n###\n\n", "completion": "build(bazel): improve remote caching for AIO local deps build (#<issue-num>)"}
{"prompt": " file path A: packages/core/schematics/utils/import_manager.ts | file path B: packages/core/schematics/utils/import_manager.ts\n\n@@ -29,6 +29,13 @@ export class ImportManager {\n       new Map<ts.ImportDeclaration, {propertyName?: ts.Identifier, importName: ts.Identifier}[]>();\n   /** Map of source-files and their previously used identifier names. */\n   private usedIdentifierNames = new Map<ts.SourceFile, string[]>();\n+  /** Map of source files and the new imports that have to be added to them. */\n+  private newImports: Map<ts.SourceFile, {\n+    importStartIndex: number,\n+    defaultImports: Map<string, ts.Identifier>,\n+    namedImports: Map<string, ts.ImportSpecifier[]>,\n+  }> = new Map();\n+\n   /**\n    * Array of previously resolved symbol imports. Cache can be re-used to return\n    * the same identifier without checking the source-file again.\n@@ -142,37 +149,34 @@ export class ImportManager {\n     }\n \n     let identifier: ts.Identifier|null = null;\n-    let newImport: ts.ImportDeclaration|null = null;\n+\n+    if (!this.newImports.has(sourceFile)) {\n+      this.newImports.set(sourceFile, {\n+        importStartIndex,\n+        defaultImports: new Map(),\n+        namedImports: new Map(),\n+      });\n+    }\n \n     if (symbolName) {\n       const propertyIdentifier = ts.factory.createIdentifier(symbolName);\n       const generatedUniqueIdentifier = this._getUniqueIdentifier(sourceFile, symbolName);\n       const needsGeneratedUniqueName = generatedUniqueIdentifier.text !== symbolName;\n+      const importMap = this.newImports.get(sourceFile)!.namedImports;\n       identifier = needsGeneratedUniqueName ? generatedUniqueIdentifier : propertyIdentifier;\n \n-      newImport = createImportDeclaration(\n-          undefined,\n-          ts.factory.createImportClause(\n-              false, undefined,\n-              ts.factory.createNamedImports([ts.factory.createImportSpecifier(\n-                  false, needsGeneratedUniqueName ? propertyIdentifier : undefined, identifier)])),\n-          ts.factory.createStringLiteral(moduleName));\n+      if (!importMap.has(moduleName)) {\n+        importMap.set(moduleName, []);\n+      }\n+\n+      importMap.get(moduleName)!.push(ts.factory.createImportSpecifier(\n+          false, needsGeneratedUniqueName ? propertyIdentifier : undefined, identifier));\n     } else {\n+      const importMap = this.newImports.get(sourceFile)!.defaultImports;\n       identifier = this._getUniqueIdentifier(sourceFile, 'defaultExport');\n-      newImport = createImportDeclaration(\n-          undefined, ts.factory.createImportClause(false, identifier, undefined),\n-          ts.factory.createStringLiteral(moduleName));\n+      importMap.set(moduleName, identifier);\n     }\n \n-    const newImportText = this.printer.printNode(ts.EmitHint.Unspecified, newImport, sourceFile);\n-    // If the import is generated at the start of the source file, we want to add\n-    // a new-line after the import. Otherwise if the import is generated after an\n-    // existing import, we need to prepend a new-line so that the import is not on\n-    // the same line as the existing import anchor.\n-    this.getUpdateRecorder(sourceFile)\n-        .addNewImport(\n-            importStartIndex, importStartIndex === 0 ? `${newImportText}\\n` : `\\n${newImportText}`);\n-\n     // Keep track of all generated imports so that we don't generate duplicate\n     // similar imports as these can't be statically analyzed in the source-file yet.\n     this.importCache.push({sourceFile, symbolName, moduleName, identifier});\n@@ -200,6 +204,30 @@ export class ImportManager {\n           this.printer.printNode(ts.EmitHint.Unspecified, newNamedBindings, sourceFile);\n       recorder.updateExistingImport(namedBindings, newNamedBindingsText);\n     });\n+\n+    this.newImports.forEach(({importStartIndex, defaultImports, namedImports}, sourceFile) => {\n+      const recorder = this.getUpdateRecorder(sourceFile);\n+\n+      defaultImports.forEach((identifier, moduleName) => {\n+        const newImport = createImportDeclaration(\n+            undefined, ts.factory.createImportClause(false, identifier, undefined),\n+            ts.factory.createStringLiteral(moduleName));\n+\n+        recorder.addNewImport(\n+            importStartIndex, this._getNewImportText(importStartIndex, newImport, sourceFile));\n+      });\n+\n+      namedImports.forEach((specifiers, moduleName) => {\n+        const newImport = createImportDeclaration(\n+            undefined,\n+            ts.factory.createImportClause(\n+                false, undefined, ts.factory.createNamedImports(specifiers)),\n+            ts.factory.createStringLiteral(moduleName));\n+\n+        recorder.addNewImport(\n+            importStartIndex, this._getNewImportText(importStartIndex, newImport, sourceFile));\n+      });\n+    });\n   }\n \n   /** Gets an unique identifier with a base name for the given source file. */\n@@ -260,6 +288,19 @@ export class ImportManager {\n     }\n     return commentRanges[commentRanges.length - 1]!.end;\n   }\n+\n+  /** Gets the text that should be added to the file for a newly-created import declaration. */\n+  private _getNewImportText(\n+      importStartIndex: number, newImport: ts.ImportDeclaration,\n+      sourceFile: ts.SourceFile): string {\n+    const text = this.printer.printNode(ts.EmitHint.Unspecified, newImport, sourceFile);\n+\n+    // If the import is generated at the start of the source file, we want to add\n+    // a new-line after the import. Otherwise if the import is generated after an\n+    // existing import, we need to prepend a new-line so that the import is not on\n+    // the same line as the existing import anchor\n+    return importStartIndex === 0 ? `${text}\\n` : `\\n${text}`;\n+  }\n }\n \n /**\n\n\n###\n\n", "completion": "fix(migrations): combine newly-added imports in import manager (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/update-events.yml | file path B: .github/workflows/update-events.yml\n\n@@ -30,8 +30,6 @@ jobs:\n           # account that is attempted to be used for authentication, instead the remote is set to\n           # an authenticated URL.\n           persist-credentials: false\n-      - name: Install AIO dependencies\n-        run: yarn --cwd=aio install\n       - name: Generate `events.json`\n         run: node aio/scripts/generate-events/index.mjs --ignore-invalid-dates\n       - name: Create a PR (if necessary)\n\n\n###\n\n", "completion": "ci: remove redundant aio dependencies installation step (#<issue-num>)"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -86,7 +86,7 @@ npm_package_bin(\n     },\n     exec_properties = ENABLE_NETWORK,\n     output_dir = True,\n-    stamp = \"@rules_nodejs//nodejs/stamp:always\",\n+    stamp = \"@rules_nodejs//nodejs/stamp:use_stamp_flag\",\n     # Makes remote git calls to get previous versions\n     tags = [\n         \"requires-network\",\n\n---\n file path A: aio/tools/transforms/angular-base-package/services/bazelStampedProperties.js | file path B: aio/tools/transforms/angular-base-package/services/bazelStampedProperties.js\n\n@@ -10,6 +10,10 @@ const fs = require('fs');\n  * @returns a map of key-value pairs\n  */\n module.exports = function bazelStampedProperties() {\n+  if (!process.env.BAZEL_VERSION_FILE) {\n+    // Bazel stamping not enabled with --stamp\n+    return {};\n+  }\n   const volatileStatus = fs.readFileSync(process.env.BAZEL_VERSION_FILE, 'utf8');\n   const properties = {};\n   for (const match of `\\n${volatileStatus}`.matchAll(/^([^\\s]+)\\s+(.*)/gm)) {\n\n\n###\n\n", "completion": "build(bazel): prevent remote cache misses on dgeni build (#<issue-num>)"}
{"prompt": " file path A: tools/saucelabs/karma-saucelabs.mjs | file path B: tools/saucelabs/karma-saucelabs.mjs\n\n@@ -11,13 +11,19 @@\n import shell from 'shelljs';\n import {runfiles} from '@bazel/runfiles';\n import fs from 'fs';\n+import childProcess from 'child_process';\n \n const karmaBin = runfiles.resolve('npm/node_modules/karma/bin/karma');\n const sauceService = runfiles.resolveWorkspaceRelative(process.argv[2]);\n \n process.argv = [process.argv[0], karmaBin, ...process.argv.splice(3)];\n \n-try {\n+main().catch((e) => {\n+  console.error(e);\n+  process.exitCode = 1;\n+});\n+\n+async function main() {\n   console.error(`Setting up environment for SauceLabs karma tests...`);\n   // KARMA_WEB_TEST_MODE is set which informs /karma-js.conf.js that it should\n   // run the test with the karma saucelabs launcher\n@@ -65,10 +71,20 @@ try {\n   }\n \n   console.error(`Launching karma ${karmaBin}...`);\n-  module.constructor._load(karmaBin, this, /*isMain=*/ true);\n-} catch (e) {\n-  console.error(e.stack || e);\n-  process.exit(1);\n+\n+  await launchNodeBinaryAndWait(karmaBin, process.argv.slice(2));\n+}\n+\n+function launchNodeBinaryAndWait(entryPointPath, args) {\n+  return new Promise((resolve, reject) => {\n+    const proc = childProcess.fork(entryPointPath, args, {stdio: 'inherit'});\n+    proc.on('error', (err) => reject(err));\n+    proc.on('close', (code) =>\n+      code !== 0\n+        ? reject(new Error(`Script \"${entryPointPath}\" exited with non-zero status code: ${code}`))\n+        : resolve()\n+    );\n+  });\n }\n \n function readLocalSauceConnectParams() {\n\n\n###\n\n", "completion": "build: do not rely on CommonJS `module` global for Bazel karma saucelabs (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/lazy-loading-ngmodules/src/app/orders/orders.component.ts | file path B: aio/content/examples/lazy-loading-ngmodules/src/app/orders/orders.component.ts\n\n@@ -1,15 +1,8 @@\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n \n @Component({\n   selector: 'app-orders',\n   templateUrl: './orders.component.html',\n   styleUrls: ['./orders.component.css']\n })\n-export class OrdersComponent implements OnInit {\n-\n-  constructor() { }\n-\n-  ngOnInit() {\n-  }\n-\n-}\n+export class OrdersComponent {}\n\n---\n file path A: aio/content/examples/schematics-for-libraries/projects/my-lib/src/lib/my-lib.component.ts | file path B: aio/content/examples/schematics-for-libraries/projects/my-lib/src/lib/my-lib.component.ts\n\n@@ -1,4 +1,4 @@\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n \n @Component({\n   selector: 'lib-my-lib',\n@@ -9,11 +9,4 @@ import { Component, OnInit } from '@angular/core';\n   `,\n   styles: []\n })\n-export class MyLibComponent implements OnInit {\n-\n-  constructor() { }\n-\n-  ngOnInit() {\n-  }\n-\n-}\n+export class MyLibComponent {}\n\n---\n file path A: aio/content/examples/styleguide/src/04-08/app/heroes/heroes.component.ts | file path B: aio/content/examples/styleguide/src/04-08/app/heroes/heroes.component.ts\n\n@@ -1,11 +1,7 @@\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n \n @Component({\n   selector: 'toh-heroes',\n   templateUrl: './heroes.component.html'\n })\n-export class HeroesComponent implements OnInit {\n-  constructor() { /* ... */ }\n-\n-  ngOnInit() { /* ... */ }\n-}\n+export class HeroesComponent {}\n\n\n###\n\n", "completion": "docs: updated docs removed unnecessary imports and empty methods (#<issue-num>)"}
{"prompt": " file path A: tools/defaults.bzl | file path B: tools/defaults.bzl\n\n@@ -319,33 +319,33 @@ def karma_web_test_suite(\n         **kwargs\n     )\n \n-    # Add a saucelabs target for these karma tests\n-    _karma_web_test(\n-        name = \"saucelabs_%s\" % name,\n-        # Default timeout is moderate (5min). This causes the test to be terminated while\n-        # Saucelabs browsers keep running. Ultimately resulting in failing tests and browsers\n-        # unnecessarily being acquired. Our specified Saucelabs idle timeout is 10min, so we use\n-        # Bazel's long timeout (15min). This ensures that Karma can shut down properly.\n-        timeout = \"long\",\n-        bootstrap = bootstrap,\n-        config_file = \"//:karma-js.conf.js\",\n-        deps = [\n-            \"@npm//karma-sauce-launcher\",\n-            \":%s_bundle\" % name,\n-        ],\n-        data = data + [\n-            \"//:browser-providers.conf.js\",\n-        ],\n-        karma = \"//tools/saucelabs:karma-saucelabs\",\n-        tags = tags + [\n-            \"exclusive\",\n-            \"manual\",\n-            \"no-remote-exec\",\n-            \"saucelabs\",\n-        ],\n-        configuration_env_vars = [\"KARMA_WEB_TEST_MODE\"],\n-        **kwargs\n-    )\n+    # Add a saucelabs target for Karma tests in `//packages/`.\n+    if native.package_name().startswith(\"packages/\"):\n+        _karma_web_test(\n+            name = \"saucelabs_%s\" % name,\n+            # Default timeout is moderate (5min). This causes the test to be terminated while\n+            # Saucelabs browsers keep running. Ultimately resulting in failing tests and browsers\n+            # unnecessarily being acquired. Our specified Saucelabs idle timeout is 10min, so we use\n+            # Bazel's long timeout (15min). This ensures that Karma can shut down properly.\n+            timeout = \"long\",\n+            config_file = \"//:karma-js.conf.js\",\n+            deps = [\n+                \"@npm//karma-sauce-launcher\",\n+                \":%s_bundle\" % name,\n+            ],\n+            data = data + [\n+                \"//:browser-providers.conf.js\",\n+            ],\n+            karma = \"//tools/saucelabs:karma-saucelabs\",\n+            tags = tags + [\n+                \"exclusive\",\n+                \"manual\",\n+                \"no-remote-exec\",\n+                \"saucelabs\",\n+            ],\n+            configuration_env_vars = [\"KARMA_WEB_TEST_MODE\"],\n+            **kwargs\n+        )\n \n def protractor_web_test_suite(\n         name,\n\n\n###\n\n", "completion": "build: only generate bazel saucelabs targets for `//packages/` (#<issue-num>)"}
{"prompt": " file path A: .ng-dev/google-sync-config.json | file path B: .ng-dev/google-sync-config.json\n\n@@ -1,5 +1,5 @@\n {\n-  \"syncedFilePatterns\": [\"LICENSE\", \"modules/benchmarks/**\", \"modules/system.d.ts\", \"packages/**\"],\n+  \"syncedFilePatterns\": [\"LICENSE\", \"modules/benchmarks/**\", \"packages/**\"],\n   \"alwaysExternalFilePatterns\": [\n     \"packages/*\",\n     \"packages/bazel/*\",\n@@ -15,6 +15,7 @@\n     \"packages/compiler-cli/linker/**\",\n     \"packages/compiler-cli/ngcc/**\",\n     \"packages/compiler-cli/src/ngtsc/sourcemaps/**\",\n+    \"packages/compiler-cli/src/ngtsc/testing/**\",\n     \"packages/compiler-cli/private/bazel.ts\",\n     \"packages/compiler-cli/private/localize.ts\",\n     \"packages/compiler-cli/private/tooling.ts\",\n\n\n###\n\n", "completion": "build: update google sync config to match internal changes (#<issue-num>)"}
{"prompt": " file path A: modules/benchmarks/src/change_detection/transplanted_views/BUILD.bazel | file path B: modules/benchmarks/src/change_detection/transplanted_views/BUILD.bazel\n\n@@ -27,11 +27,19 @@ app_bundle(\n     ],\n )\n \n+# The script needs to be called `app_bundle` for easier syncing into g3.\n+genrule(\n+    name = \"app_bundle\",\n+    srcs = [\":bundle.debug.min.js\"],\n+    outs = [\"app_bundle.js\"],\n+    cmd = \"cp $< $@\",\n+)\n+\n http_server(\n     name = \"prodserver\",\n     srcs = [\"index.html\"],\n     deps = [\n-        \":bundle.debug.min.js\",\n+        \":app_bundle\",\n         \"//packages/zone.js/bundles:zone.umd.js\",\n     ],\n )\n\n---\n file path A: modules/benchmarks/src/change_detection/transplanted_views/index.html | file path B: modules/benchmarks/src/change_detection/transplanted_views/index.html\n\n@@ -26,7 +26,11 @@\n       <declaration-component id=\"root\"></declaration-component>\n     </div>\n \n+    <!-- BEGIN-EXTERNAL -->\n     <script src=\"/angular/packages/zone.js/bundles/zone.umd.js\"></script>\n-    <script src=\"/bundle.debug.min.js\"></script>\n+    <!-- END-EXTERNAL -->\n+\n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n+    <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/expanding_rows/BUILD.bazel | file path B: modules/benchmarks/src/expanding_rows/BUILD.bazel\n\n@@ -40,11 +40,19 @@ app_bundle(\n     ],\n )\n \n+# The script needs to be called `app_bundle` for easier syncing into g3.\n+genrule(\n+    name = \"app_bundle\",\n+    srcs = [\":bundle.debug.min.js\"],\n+    outs = [\"app_bundle.js\"],\n+    cmd = \"cp $< $@\",\n+)\n+\n http_server(\n     name = \"prodserver\",\n     srcs = [\"index.html\"],\n     deps = [\n-        \":bundle.debug.min.js\",\n+        \":app_bundle\",\n         \"//packages/zone.js/bundles:zone.umd.js\",\n     ],\n )\n\n---\n file path A: modules/benchmarks/src/expanding_rows/index.html | file path B: modules/benchmarks/src/expanding_rows/index.html\n\n@@ -11,7 +11,11 @@\n \n     <benchmark-root>Loading...</benchmark-root>\n \n+    <!-- BEGIN-EXTERNAL -->\n     <script src=\"/angular/packages/zone.js/bundles/zone.umd.js\"></script>\n-    <script src=\"/bundle.debug.min.js\"></script>\n+    <!-- END-EXTERNAL -->\n+\n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n+    <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/js-web-frameworks/ng2/BUILD.bazel | file path B: modules/benchmarks/src/js-web-frameworks/ng2/BUILD.bazel\n\n@@ -24,11 +24,19 @@ app_bundle(\n     ],\n )\n \n+# The script needs to be called `app_bundle` for easier syncing into g3.\n+genrule(\n+    name = \"app_bundle\",\n+    srcs = [\":bundle.debug.min.js\"],\n+    outs = [\"app_bundle.js\"],\n+    cmd = \"cp $< $@\",\n+)\n+\n http_server(\n     name = \"prodserver\",\n     srcs = [\"index.html\"],\n     deps = [\n-        \":bundle.debug.min.js\",\n+        \":app_bundle\",\n         \"//packages/zone.js/bundles:zone.umd.js\",\n     ],\n )\n\n---\n file path A: modules/benchmarks/src/js-web-frameworks/ng2/index.html | file path B: modules/benchmarks/src/js-web-frameworks/ng2/index.html\n\n@@ -24,7 +24,11 @@\n       <js-web-frameworks id=\"root\">Loading...</js-web-frameworks>\n     </div>\n \n+    <!-- BEGIN-EXTERNAL -->\n     <script src=\"/angular/packages/zone.js/bundles/zone.umd.js\"></script>\n-    <script src=\"/bundle.debug.min.js\"></script>\n+    <!-- END-EXTERNAL -->\n+\n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n+    <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/largeform/ng2/index.html | file path B: modules/benchmarks/src/largeform/ng2/index.html\n\n@@ -20,6 +20,7 @@\n       <app id=\"root\">Loading...</app>\n     </div>\n \n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n     <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/largeform/ng2/index.ts | file path B: modules/benchmarks/src/largeform/ng2/index.ts\n\n@@ -6,8 +6,11 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+// BEGIN-EXTERNAL\n import 'zone.js/lib/browser/rollup-main';\n \n+// END-EXTERNAL\n+\n import {enableProdMode} from '@angular/core';\n import {platformBrowserDynamic} from '@angular/platform-browser-dynamic';\n \n\n---\n file path A: modules/benchmarks/src/largeform/ng2/index_aot.ts | file path B: modules/benchmarks/src/largeform/ng2/index_aot.ts\n\n@@ -6,8 +6,11 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+// BEGIN-EXTERNAL\n import 'zone.js/lib/browser/rollup-main';\n \n+// END-EXTERNAL\n+\n import {enableProdMode} from '@angular/core';\n import {platformBrowser} from '@angular/platform-browser';\n \n\n---\n file path A: modules/benchmarks/src/largetable/baseline/BUILD.bazel | file path B: modules/benchmarks/src/largetable/baseline/BUILD.bazel\n\n@@ -15,11 +15,19 @@ ts_library(\n )\n \n app_bundle(\n-    name = \"app_bundle\",\n+    name = \"bundle\",\n     entry_point = \":index.ts\",\n     deps = [\":baseline\"],\n )\n \n+# The script needs to be called `app_bundle` for easier syncing into g3.\n+genrule(\n+    name = \"app_bundle\",\n+    srcs = [\":bundle.debug.min.js\"],\n+    outs = [\"app_bundle.js\"],\n+    cmd = \"cp $< $@\",\n+)\n+\n http_server(\n     name = \"devserver\",\n     srcs = [\"index.html\"],\n\n---\n file path A: modules/benchmarks/src/largetable/baseline/index.html | file path B: modules/benchmarks/src/largetable/baseline/index.html\n\n@@ -28,6 +28,7 @@\n       <largetable id=\"root\">Loading...</largetable>\n     </div>\n \n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n     <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/largetable/incremental_dom/BUILD.bazel | file path B: modules/benchmarks/src/largetable/incremental_dom/BUILD.bazel\n\n@@ -15,11 +15,19 @@ ts_library(\n )\n \n app_bundle(\n-    name = \"app_bundle\",\n+    name = \"bundle\",\n     entry_point = \":index.ts\",\n     deps = [\":incremental_dom\"],\n )\n \n+# The script needs to be called `app_bundle` for easier syncing into g3.\n+genrule(\n+    name = \"app_bundle\",\n+    srcs = [\":bundle.debug.min.js\"],\n+    outs = [\"app_bundle.js\"],\n+    cmd = \"cp $< $@\",\n+)\n+\n http_server(\n     name = \"devserver\",\n     srcs = [\n\n---\n file path A: modules/benchmarks/src/largetable/incremental_dom/index.html | file path B: modules/benchmarks/src/largetable/incremental_dom/index.html\n\n@@ -28,7 +28,11 @@\n       <largetable id=\"root\"></largetable>\n     </div>\n \n+    <!-- BEGIN-EXTERNAL -->\n     <script src=\"/npm/node_modules/incremental-dom/dist/incremental-dom.js\"></script>\n+    <!-- END-EXTERNAL -->\n+\n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n     <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/largetable/iv/BUILD.bazel | file path B: modules/benchmarks/src/largetable/iv/BUILD.bazel\n\n@@ -7,8 +7,8 @@ package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])\n http_server(\n     name = \"devserver\",\n     srcs = [\n+        \"app_bundle.js\",\n         \"index.html\",\n-        \"largetable.js\",\n     ],\n )\n \n\n---\n file path A: modules/benchmarks/src/largetable/iv/largetable.js | file path B: modules/benchmarks/src/largetable/iv/app_bundle.js\n\n\n---\n file path A: modules/benchmarks/src/largetable/iv/index.html | file path B: modules/benchmarks/src/largetable/iv/index.html\n\n@@ -28,6 +28,7 @@\n       <largetable id=\"root\"></largetable>\n     </div>\n \n-    <script src=\"/largetable.js\"></script>\n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n+    <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/largetable/ng2/BUILD.bazel | file path B: modules/benchmarks/src/largetable/ng2/BUILD.bazel\n\n@@ -30,11 +30,19 @@ app_bundle(\n     ],\n )\n \n+# The script needs to be called `app_bundle` for easier syncing into g3.\n+genrule(\n+    name = \"app_bundle\",\n+    srcs = [\":bundle.debug.min.js\"],\n+    outs = [\"app_bundle.js\"],\n+    cmd = \"cp $< $@\",\n+)\n+\n http_server(\n     name = \"prodserver\",\n     srcs = [\"index.html\"],\n     deps = [\n-        \":bundle.debug.min.js\",\n+        \":app_bundle\",\n         \"//packages/zone.js/bundles:zone.umd.js\",\n     ],\n )\n\n---\n file path A: modules/benchmarks/src/largetable/ng2/index.html | file path B: modules/benchmarks/src/largetable/ng2/index.html\n\n@@ -28,7 +28,11 @@\n       <largetable id=\"root\">Loading...</largetable>\n     </div>\n \n+    <!-- BEGIN-EXTERNAL -->\n     <script src=\"/angular/packages/zone.js/bundles/zone.umd.js\"></script>\n-    <script src=\"/bundle.debug.min.js\"></script>\n+    <!-- END-EXTERNAL -->\n+\n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n+    <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/largetable/ng2_switch/BUILD.bazel | file path B: modules/benchmarks/src/largetable/ng2_switch/BUILD.bazel\n\n@@ -19,11 +19,19 @@ ng_module(\n )\n \n app_bundle(\n-    name = \"app_bundle\",\n+    name = \"bundle\",\n     entry_point = \":index.ts\",\n     deps = [\":ng2_switch\"],\n )\n \n+# The script needs to be called `app_bundle` for easier syncing into g3.\n+genrule(\n+    name = \"app_bundle\",\n+    srcs = [\":bundle.debug.min.js\"],\n+    outs = [\"app_bundle.js\"],\n+    cmd = \"cp $< $@\",\n+)\n+\n http_server(\n     name = \"devserver\",\n     srcs = [\"index.html\"],\n\n---\n file path A: modules/benchmarks/src/largetable/ng2_switch/index.html | file path B: modules/benchmarks/src/largetable/ng2_switch/index.html\n\n@@ -28,7 +28,11 @@\n       <largetable id=\"root\">Loading...</largetable>\n     </div>\n \n+    <!-- BEGIN-EXTERNAL -->\n     <script src=\"/angular/packages/zone.js/bundles/zone.umd.js\"></script>\n+    <!-- END-EXTERNAL -->\n+\n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n     <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/styling/ng2/BUILD.bazel | file path B: modules/benchmarks/src/styling/ng2/BUILD.bazel\n\n@@ -24,11 +24,19 @@ app_bundle(\n     ],\n )\n \n+# The script needs to be called `app_bundle` for easier syncing into g3.\n+genrule(\n+    name = \"app_bundle\",\n+    srcs = [\":bundle.debug.min.js\"],\n+    outs = [\"app_bundle.js\"],\n+    cmd = \"cp $< $@\",\n+)\n+\n http_server(\n     name = \"prodserver\",\n     srcs = [\"index.html\"],\n     deps = [\n-        \":bundle.debug.min.js\",\n+        \":app_bundle\",\n         \"//packages/zone.js/bundles:zone.umd.js\",\n     ],\n )\n\n---\n file path A: modules/benchmarks/src/styling/ng2/index.html | file path B: modules/benchmarks/src/styling/ng2/index.html\n\n@@ -49,7 +49,11 @@\n       <styling-bindings id=\"root\">Loading...</styling-bindings>\n     </div>\n \n+    <!-- BEGIN-EXTERNAL -->\n     <script src=\"/angular/packages/zone.js/bundles/zone.umd.js\"></script>\n-    <script src=\"/bundle.debug.min.js\"></script>\n+    <!-- END-EXTERNAL -->\n+\n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n+    <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/tree/baseline/BUILD.bazel | file path B: modules/benchmarks/src/tree/baseline/BUILD.bazel\n\n@@ -15,11 +15,19 @@ ts_library(\n )\n \n app_bundle(\n-    name = \"app_bundle\",\n+    name = \"bundle\",\n     entry_point = \":index.ts\",\n     deps = [\":baseline\"],\n )\n \n+# The script needs to be called `app_bundle` for easier syncing into g3.\n+genrule(\n+    name = \"app_bundle\",\n+    srcs = [\":bundle.debug.min.js\"],\n+    outs = [\"app_bundle.js\"],\n+    cmd = \"cp $< $@\",\n+)\n+\n http_server(\n     name = \"devserver\",\n     srcs = [\"index.html\"],\n\n---\n file path A: modules/benchmarks/src/tree/baseline/index.html | file path B: modules/benchmarks/src/tree/baseline/index.html\n\n@@ -25,6 +25,7 @@\n       <tree id=\"root\">Loading...</tree>\n     </div>\n \n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n     <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/tree/incremental_dom/BUILD.bazel | file path B: modules/benchmarks/src/tree/incremental_dom/BUILD.bazel\n\n@@ -16,11 +16,19 @@ ts_library(\n )\n \n app_bundle(\n-    name = \"app_bundle\",\n+    name = \"bundle\",\n     entry_point = \":index.ts\",\n     deps = [\":incremental_dom\"],\n )\n \n+# The script needs to be called `app_bundle` for easier syncing into g3.\n+genrule(\n+    name = \"app_bundle\",\n+    srcs = [\":bundle.debug.min.js\"],\n+    outs = [\"app_bundle.js\"],\n+    cmd = \"cp $< $@\",\n+)\n+\n http_server(\n     name = \"devserver\",\n     srcs = [\n\n---\n file path A: modules/benchmarks/src/tree/incremental_dom/index.html | file path B: modules/benchmarks/src/tree/incremental_dom/index.html\n\n@@ -25,7 +25,11 @@\n       <tree id=\"root\"></tree>\n     </div>\n \n+    <!-- BEGIN-EXTERNAL -->\n     <script src=\"/npm/node_modules/incremental-dom/dist/incremental-dom.js\"></script>\n+    <!-- END-EXTERNAL -->\n+\n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n     <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/tree/iv/BUILD.bazel | file path B: modules/benchmarks/src/tree/iv/BUILD.bazel\n\n@@ -7,8 +7,8 @@ package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])\n http_server(\n     name = \"devserver\",\n     srcs = [\n+        \"app_bundle.js\",\n         \"index.html\",\n-        \"tree.js\",\n     ],\n )\n \n\n---\n file path A: modules/benchmarks/src/tree/iv/tree.js | file path B: modules/benchmarks/src/tree/iv/app_bundle.js\n\n\n---\n file path A: modules/benchmarks/src/tree/iv/index.html | file path B: modules/benchmarks/src/tree/iv/index.html\n\n@@ -26,6 +26,7 @@\n     <div>Change detection runs:<span id=\"numberOfChecks\"></span></div>\n     <div id=\"root\"></div>\n \n-    <script src=\"/tree.js\"></script>\n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n+    <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/tree/ng1/BUILD.bazel | file path B: modules/benchmarks/src/tree/ng1/BUILD.bazel\n\n@@ -15,11 +15,19 @@ ts_library(\n )\n \n app_bundle(\n-    name = \"app_bundle\",\n+    name = \"bundle\",\n     entry_point = \":index.ts\",\n     deps = [\":ng1\"],\n )\n \n+# The script needs to be called `app_bundle` for easier syncing into g3.\n+genrule(\n+    name = \"app_bundle\",\n+    srcs = [\":bundle.debug.min.js\"],\n+    outs = [\"app_bundle.js\"],\n+    cmd = \"cp $< $@\",\n+)\n+\n http_server(\n     name = \"devserver\",\n     srcs = [\n\n---\n file path A: modules/benchmarks/src/tree/ng1/index.html | file path B: modules/benchmarks/src/tree/ng1/index.html\n\n@@ -28,7 +28,11 @@\n       <tree id=\"root\" data=\"initData\">Loading...</tree>\n     </div>\n \n+    <!-- BEGIN-EXTERNAL -->\n     <script src=\"/npm/node_modules/angular-1.8/angular.js\"></script>\n+    <!-- END-EXTERNAL -->\n+\n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n     <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/tree/ng2/BUILD.bazel | file path B: modules/benchmarks/src/tree/ng2/BUILD.bazel\n\n@@ -30,11 +30,19 @@ app_bundle(\n     ],\n )\n \n+# The script needs to be called `app_bundle` for easier syncing into g3.\n+genrule(\n+    name = \"app_bundle\",\n+    srcs = [\":bundle.debug.min.js\"],\n+    outs = [\"app_bundle.js\"],\n+    cmd = \"cp $< $@\",\n+)\n+\n http_server(\n     name = \"prodserver\",\n     srcs = [\"index.html\"],\n     deps = [\n-        \":bundle.debug.min.js\",\n+        \":app_bundle\",\n         \"//packages/zone.js/bundles:zone.umd.js\",\n     ],\n )\n\n---\n file path A: modules/benchmarks/src/tree/ng2/index.html | file path B: modules/benchmarks/src/tree/ng2/index.html\n\n@@ -28,7 +28,11 @@\n       <tree id=\"root\">Loading...</tree>\n     </div>\n \n+    <!-- BEGIN-EXTERNAL -->\n     <script src=\"/angular/packages/zone.js/bundles/zone.umd.js\"></script>\n-    <script src=\"/bundle.debug.min.js\"></script>\n+    <!-- END-EXTERNAL -->\n+\n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n+    <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/tree/ng2_static/index.html | file path B: modules/benchmarks/src/tree/ng2_static/index.html\n\n@@ -25,8 +25,12 @@\n       <tree id=\"root\"></tree>\n     </div>\n \n+    <!-- BEGIN-EXTERNAL -->\n     <script src=\"/npm/node_modules/reflect-metadata/Reflect.js\"></script>\n     <script src=\"/angular/packages/zone.js/bundles/zone.umd.js\"></script>\n+    <!-- END-EXTERNAL -->\n+\n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n     <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/tree/ng2_switch/BUILD.bazel | file path B: modules/benchmarks/src/tree/ng2_switch/BUILD.bazel\n\n@@ -19,11 +19,19 @@ ng_module(\n )\n \n app_bundle(\n-    name = \"app_bundle\",\n+    name = \"bundle\",\n     entry_point = \":index.ts\",\n     deps = [\":ng2_switch\"],\n )\n \n+# The script needs to be called `app_bundle` for easier syncing into g3.\n+genrule(\n+    name = \"app_bundle\",\n+    srcs = [\":bundle.debug.min.js\"],\n+    outs = [\"app_bundle.js\"],\n+    cmd = \"cp $< $@\",\n+)\n+\n http_server(\n     name = \"devserver\",\n     srcs = [\"index.html\"],\n\n---\n file path A: modules/benchmarks/src/tree/ng2_switch/index.html | file path B: modules/benchmarks/src/tree/ng2_switch/index.html\n\n@@ -25,7 +25,11 @@\n       <tree id=\"root\">Loading...</tree>\n     </div>\n \n+    <!-- BEGIN-EXTERNAL -->\n     <script src=\"/angular/packages/zone.js/bundles/zone.umd.js\"></script>\n+    <!-- END-EXTERNAL -->\n+\n+    <!-- Needs to be named `app_bundle` for sync into Google. -->\n     <script src=\"/app_bundle.js\"></script>\n   </body>\n </html>\n\n---\n file path A: modules/benchmarks/src/views/BUILD.bazel | file path B: modules/benchmarks/src/views/BUILD.bazel\n\n@@ -25,6 +25,14 @@ app_bundle(\n     ],\n )\n \n+# The script needs to be called `app_bundle` for easier syncing into g3.\n+genrule(\n+    name = \"app_bundle\",\n+    srcs = [\":bundle.debug.min.js\"],\n+    outs = [\"app_bundle.js\"],\n+    cmd = \"cp $< $@\",\n+)\n+\n http_server(\n     name = \"server\",\n     srcs = [\n\n\n###\n\n", "completion": "refactor: make benchmarking syncing easier and add comments for future insight (#<issue-num>)"}
{"prompt": " file path A: modules/benchmarks/src/BUILD.bazel | file path B: modules/benchmarks/src/BUILD.bazel\n\n@@ -6,14 +6,3 @@ ts_library(\n     name = \"util_lib\",\n     srcs = [\"util.ts\"],\n )\n-\n-ts_library(\n-    name = \"bootstrap\",\n-    srcs = [\n-        \"bootstrap_ng2.ts\",\n-        \"bootstrap_plain.ts\",\n-    ],\n-    deps = [\n-        \"//packages:types\",\n-    ],\n-)\n\n---\n file path A: modules/benchmarks/src/bootstrap_ng2.ts | file path B: None\n\n@@ -1,85 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-(function(global: any) {\n-\n-writeScriptTag('/all/benchmarks/vendor/core.js');\n-writeScriptTag('/all/benchmarks/vendor/zone.js');\n-writeScriptTag('/all/benchmarks/vendor/long-stack-trace-zone.js');\n-writeScriptTag('/all/benchmarks/vendor/system.src.js');\n-writeScriptTag('/all/benchmarks/vendor/Reflect.js', 'benchmarksBootstrap()');\n-\n-(<any>global).benchmarksBootstrap = benchmarksBootstrap;\n-\n-function benchmarksBootstrap() {\n-  // check query param\n-  const useBundles = location.search.indexOf('bundles=false') == -1;\n-  if (useBundles) {\n-    System.config({\n-      defaultJSExtensions: true,\n-      map: {\n-        '@angular/core': '/packages-dist/core/bundles/core.umd.js',\n-        '@angular/animations': '/packages-dist/common/bundles/animations.umd.js',\n-        '@angular/platform-browser/animations':\n-            '/packages-dist/platform-browser/bundles/platform-browser-animations.umd.js',\n-        '@angular/common': '/packages-dist/common/bundles/common.umd.js',\n-        '@angular/forms': '/packages-dist/forms/bundles/forms.umd.js',\n-        '@angular/compiler': '/packages-dist/compiler/bundles/compiler.umd.js',\n-        '@angular/platform-browser':\n-            '/packages-dist/platform-browser/bundles/platform-browser.umd.js',\n-        '@angular/platform-browser-dynamic':\n-            '/packages-dist/platform-browser-dynamic/bundles/platform-browser-dynamic.umd.js',\n-        '@angular/upgrade': '/packages-dist/upgrade/bundles/upgrade.umd.js',\n-        '@angular/router': '/packages-dist/router/bundles/router.umd.js',\n-        'rxjs': '/all/benchmarks/vendor/rxjs',\n-      },\n-      packages: {\n-        'rxjs/ajax': {main: 'index.js', defaultExtension: 'js'},\n-        'rxjs/operators': {main: 'index.js', defaultExtension: 'js'},\n-        'rxjs/testing': {main: 'index.js', defaultExtension: 'js'},\n-        'rxjs/websocket': {main: 'index.js', defaultExtension: 'js'},\n-        'rxjs': {main: 'index.js', defaultExtension: 'js'},\n-      }\n-    });\n-  } else {\n-    console.warn(\n-        'Not using the Angular bundles. Don\\'t use this configuration for e2e/performance tests!');\n-\n-    System.config({\n-      defaultJSExtensions: true,\n-      map: {'@angular': '/all/@angular', 'rxjs': '/all/benchmarks/vendor/rxjs'},\n-      packages: {\n-        '@angular/core': {main: 'index.js', defaultExtension: 'js'},\n-        '@angular/animations': {main: 'index.js', defaultExtension: 'js'},\n-        '@angular/platform-browser/animations': {main: 'index.js', defaultExtension: 'js'},\n-        '@angular/compiler': {main: 'index.js', defaultExtension: 'js'},\n-        '@angular/router': {main: 'index.js', defaultExtension: 'js'},\n-        '@angular/common': {main: 'index.js', defaultExtension: 'js'},\n-        '@angular/forms': {main: 'index.js', defaultExtension: 'js'},\n-        '@angular/platform-browser': {main: 'index.js', defaultExtension: 'js'},\n-        '@angular/platform-browser-dynamic': {main: 'index.js', defaultExtension: 'js'},\n-        '@angular/upgrade': {main: 'index.js', defaultExtension: 'js'},\n-        'rxjs/ajax': {main: 'index.js', defaultExtension: 'js'},\n-        'rxjs/operators': {main: 'index.js', defaultExtension: 'js'},\n-        'rxjs/testing': {main: 'index.js', defaultExtension: 'js'},\n-        'rxjs/websocket': {main: 'index.js', defaultExtension: 'js'},\n-        'rxjs': {main: 'index.js', defaultExtension: 'js'},\n-      }\n-    });\n-  }\n-\n-  // BOOTSTRAP the app!\n-  System.import('index').then(function(m: any) {\n-    m.main();\n-  }, console.error.bind(console));\n-}\n-\n-function writeScriptTag(scriptUrl: string, onload?: string) {\n-  document.write(`<script src=\"${scriptUrl}\" onload=\"${onload}\"></script>`);\n-}\n-}(window));\n\n---\n file path A: modules/benchmarks/src/bootstrap_plain.ts | file path B: None\n\n@@ -1,31 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-(function(global: any) {\n-\n-writeScriptTag('/all/benchmarks/vendor/core.js');\n-writeScriptTag('/all/benchmarks/vendor/system.src.js', 'benchmarksBootstrap()');\n-\n-(<any>global).benchmarksBootstrap = benchmarksBootstrap;\n-\n-function benchmarksBootstrap() {\n-  System.config({\n-    defaultJSExtensions: true,\n-    map: {'incremental-dom': '/all/benchmarks/vendor/incremental-dom-cjs.js'}\n-  });\n-\n-  // BOOTSTRAP the app!\n-  System.import('index').then(function(m: any) {\n-    m.main && m.main();\n-  }, console.error.bind(console));\n-}\n-\n-function writeScriptTag(scriptUrl: string, onload?: string) {\n-  document.write(`<script src=\"${scriptUrl}\" onload=\"${onload}\"></script>`);\n-}\n-}(window));\n\n\n###\n\n", "completion": "build: remove unused systemjs bootstrap benchmark scripts (#<issue-num>)"}
{"prompt": " file path A: packages/bazel/package.json | file path B: packages/bazel/package.json\n\n@@ -8,10 +8,10 @@\n     \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"bin\": {\n-    \"ngc-wrapped\": \"./src/ngc-wrapped/index.js\",\n-    \"packager\": \"./src/ng_package/packager.js\",\n-    \"types_bundler\": \"./src/types_bundle/index.js\",\n-    \"xi18n\": \"./src/ngc-wrapped/extract_i18n.js\"\n+    \"ngc-wrapped\": \"./src/ngc-wrapped/index.mjs\",\n+    \"packager\": \"./src/ng_package/packager.mjs\",\n+    \"types_bundler\": \"./src/types_bundle/index.mjs\",\n+    \"xi18n\": \"./src/ngc-wrapped/extract_i18n.mjs\"\n   },\n   \"typings\": \"./src/ngc-wrapped/index.d.ts\",\n   \"bazelBin\": {\n\n---\n file path A: packages/bazel/src/ng_package/BUILD.bazel | file path B: packages/bazel/src/ng_package/BUILD.bazel\n\n@@ -1,48 +1,13 @@\n+# BEGIN-DEV-ONLY\n load(\"//tools:defaults.bzl\", \"nodejs_binary\", \"ts_library\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-nodejs_binary(\n-    name = \"rollup_for_ng_package\",\n-    data = [\n-        # BEGIN-DEV-ONLY\n-        \"@npm\" +\n-        # END-DEV-ONLY\n-        \"//rollup\",\n-        # BEGIN-DEV-ONLY\n-        \"@npm\" +\n-        # END-DEV-ONLY\n-        \"//@rollup/plugin-commonjs\",\n-        # BEGIN-DEV-ONLY\n-        \"@npm\" +\n-        # END-DEV-ONLY\n-        \"//@rollup/plugin-node-resolve\",\n-        # BEGIN-DEV-ONLY\n-        \"@npm\" +\n-        # END-DEV-ONLY\n-        \"//rollup-plugin-sourcemaps\",\n-        # BEGIN-DEV-ONLY\n-        \"@npm\" +\n-        # END-DEV-ONLY\n-        \"//typescript\",\n-    ],\n-    entry_point = (\n-        # BEGIN-DEV-ONLY\n-        \"@npm\" +\n-        # END-DEV-ONLY\n-        \"//:node_modules/rollup/dist/bin/rollup\"\n-    ),\n-    # Disable the linker and rely on patched resolution which works better on Windows\n-    # and is less prone to race conditions when targets build concurrently.\n-    templated_args = [\"--nobazel_run_linker\"],\n-)\n-\n exports_files([\n     \"ng_package.bzl\",\n     \"rollup.config.js\",\n ])\n \n-# BEGIN-DEV-ONLY\n ts_library(\n     name = \"lib\",\n     srcs = glob([\"*.ts\"]),\n@@ -55,6 +20,7 @@ ts_library(\n filegroup(\n     name = \"package_assets\",\n     srcs = glob([\"*.bzl\"]) + [\n+        \"//packages/bazel/src/ng_package/rollup:package_assets\",\n         \"BUILD.bazel\",\n         \"rollup.config.js\",\n     ],\n\n---\n file path A: packages/bazel/src/ng_package/ng_package.bzl | file path B: packages/bazel/src/ng_package/ng_package.bzl\n\n@@ -32,7 +32,7 @@ def _debug(vars, *args):\n \n _DEFAULT_NG_PACKAGER = \"//@angular/bazel/bin:packager\"\n _DEFAULT_ROLLUP_CONFIG_TMPL = \"//:node_modules/@angular/bazel/src/ng_package/rollup.config.js\"\n-_DEFAULT_ROLLUP = \"//@angular/bazel/src/ng_package:rollup_for_ng_package\"\n+_DEFAULT_ROLLUP = \"//@angular/bazel/src/ng_package/rollup\"\n \n _NG_PACKAGE_MODULE_MAPPINGS_ATTR = \"ng_package_module_mappings\"\n \n@@ -112,7 +112,7 @@ def _compute_node_modules_root(ctx):\n     \"\"\"Computes the node_modules root from the node_modules and deps attributes.\n \n     Args:\n-      ctx: the skylark execution context\n+      ctx: the starlark execution context\n \n     Returns:\n       The node_modules root as a string\n\n---\n file path A: None | file path B: packages/bazel/src/ng_package/rollup/BUILD.bazel\n\n@@ -0,0 +1,26 @@\n+# Note: This file is shipped to NPM. It cannot use the `defaults.bzl` macro.\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"nodejs_binary\")\n+\n+package(default_visibility = [\"//visibility:public\"])\n+\n+filegroup(\n+    name = \"package_assets\",\n+    srcs = [\"BUILD.bazel\"],\n+)\n+\n+nodejs_binary(\n+    name = \"rollup\",\n+    data = [\n+        \"@npm//@rollup/plugin-commonjs\",\n+        \"@npm//@rollup/plugin-node-resolve\",\n+        \"@npm//rollup\",\n+        \"@npm//rollup-plugin-sourcemaps\",\n+        \"@npm//typescript\",\n+    ],\n+    entry_point = (\n+        \"@npm//:node_modules/rollup/dist/bin/rollup\"\n+    ),\n+    # Disable the linker and rely on patched resolution which works better on Windows\n+    # and is less prone to race conditions when targets build concurrently.\n+    templated_args = [\"--nobazel_run_linker\"],\n+)\n\n---\n file path A: tools/defaults.bzl | file path B: tools/defaults.bzl\n\n@@ -26,7 +26,7 @@ _INTERNAL_NG_MODULE_COMPILER = \"//packages/bazel/src/ngc-wrapped\"\n _INTERNAL_NG_MODULE_XI18N = \"//packages/bazel/src/ngc-wrapped:xi18n\"\n _INTERNAL_NG_PACKAGE_PACKAGER = \"//packages/bazel/src/ng_package:packager\"\n _INTERNAL_NG_PACKAGE_DEFAULT_ROLLUP_CONFIG_TMPL = \"//packages/bazel/src/ng_package:rollup.config.js\"\n-_INTERNAL_NG_PACKAGE_DEFAULT_ROLLUP = \"//packages/bazel/src/ng_package:rollup_for_ng_package\"\n+_INTERNAL_NG_PACKAGE_DEFAULT_ROLLUP = \"//packages/bazel/src/ng_package/rollup\"\n \n esbuild_config = _esbuild_config\n http_server = _http_server\n\n\n###\n\n", "completion": "refactor: update `packages/bazel` npm artifact to not rely on `defaults.bzl` (#<issue-num>)"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -23,16 +23,18 @@ version: 2.1\n #              (See https://support.circleci.com/hc/en-us/articles/360012618473-Creating-a-daily-cache.)\n # **NOTE 2 **: If you change the cache key prefix, also sync the cache_key_fallback to match.\n # **NOTE 3 **: Keep the static part of the cache key as prefix to enable correct fallbacks.\n+# **NOTE 4 **: To make sure modified patches can be applied without needing to manually update the cache key,\n+#              the fallback cache key will not match if patches have been modified.\n # See https://circleci.com/docs/2.0/caching/#restoring-cache for how prefixes work in CircleCI.\n-var_3: &cache_key v8-angular-node-16-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}-{{ checksum \"aio/yarn.lock\" }}\n+var_3: &cache_key v8-angular-node-16-{{ checksum \"month.txt\" }}-{{ checksum \"patches.hash\"}}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}-{{ checksum \"aio/yarn.lock\" }}\n # We invalidate the cache if the Bazel version changes because otherwise the `bazelisk` cache\n # folder will contain all previously used versions and ultimately cause the cache restoring to\n # be slower due to its growing size.\n-var_4: &cache_key_fallback v8-angular-node-16-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}\n+var_4: &cache_key_fallback v8-angular-node-16-{{ checksum \"month.txt\" }}-{{ checksum \"patches.hash\"}}-{{ checksum \".bazelversion\" }}\n \n # Windows needs its own cache key because binaries in node_modules are different.\n-var_3_win: &cache_key_win v10-angular-win-node-16-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}\n-var_4_win: &cache_key_win_fallback v10-angular-win-node-16-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}\n+var_3_win: &cache_key_win v10-angular-win-node-16-{{ checksum \"month.txt\" }}-{{ checksum \"patches.hash\"}}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}\n+var_4_win: &cache_key_win_fallback v10-angular-win-node-16-{{ checksum \"month.txt\" }}-{{ checksum \"patches.hash\"}}-{{ checksum \".bazelversion\" }}\n \n # Workspace initially persisted by the `setup` job, and then enhanced by `build-npm-packages`.\n # https://circleci.com/docs/2.0/workflows/#using-workspaces-to-share-data-among-jobs\n@@ -182,6 +184,12 @@ commands:\n           # snapshot stamping would have the `-with-local-changes` suffix.\n           command: date +%Y-%m > month.txt\n \n+  capture_patches_for_cache_key:\n+    description: Hashes all patches so that the cache can be reset upon changes.\n+    steps:\n+      - run: |\n+          md5sum tools/esm-interop/patches/npm/* > patches.hash\n+\n   yarn_install:\n     description: Install dependencies\n     steps:\n@@ -214,6 +222,7 @@ jobs:\n     steps:\n       - checkout\n       - save_month_to_file\n+      - capture_patches_for_cache_key\n       - init_environment\n       - devinfra/rebase-pr-on-target-branch:\n           base_revision: << pipeline.git.base_revision >>\n@@ -590,6 +599,7 @@ jobs:\n     steps:\n       - checkout\n       - save_month_to_file\n+      - capture_patches_for_cache_key\n       - init_environment\n \n       # Setup the proper NodeJS version. The image comes pre-installed with `nvm-windows`.\n\n\n###\n\n", "completion": "ci: reset cache when patches change (#<issue-num>)"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -530,8 +530,6 @@ jobs:\n             mkdir -p packages/common/locales/extra\n             cp dist/bin/packages/common/locales/*.ts packages/common/locales\n             cp dist/bin/packages/common/locales/extra/*.ts packages/common/locales/extra\n-      # Build ZoneJS so that it can be loaded globally in the Karma tests.\n-      - run: yarn bazel build //packages/zone.js:npm_package\n       # Build the bundle for all tests to run within Saucelabs\n       - run: node tools/legacy-saucelabs/build-saucelabs-test-bundle.mjs\n       - run:\n\n---\n file path A: karma-js.conf.js | file path B: karma-js.conf.js\n\n@@ -38,16 +38,6 @@ module.exports = function(config) {\n       'node_modules/core-js-bundle/index.js',\n       'node_modules/jasmine-ajax/lib/mock-ajax.js',\n \n-      // ZoneJS configuration needed for some event manager tests. This config could\n-      // affect all legacy tests but in reality is scoped to certain special tests.\n-      'packages/platform-browser/test/dom/events/zone_event_unpatched.init.js',\n-\n-      // Dependencies built by Bazel. See `config.yml` for steps running before\n-      // the legacy Saucelabs tests run.\n-      'dist/bin/packages/zone.js/npm_package/bundles/zone.umd.js',\n-      'dist/bin/packages/zone.js/npm_package/bundles/zone-testing.umd.js',\n-      'dist/bin/packages/zone.js/npm_package/bundles/task-tracking.umd.js',\n-\n       // Static test assets.\n       {pattern: 'packages/platform-browser/test/static_assets/**/*', included: false},\n       {pattern: 'packages/platform-browser/test/browser/static_assets/**/*', included: false},\n\n---\n file path A: packages/platform-browser/test/BUILD.bazel | file path B: packages/platform-browser/test/BUILD.bazel\n\n@@ -43,7 +43,7 @@ ts_library(\n \n js_library(\n     name = \"zone_event_unpatched_init_lib\",\n-    srcs = [\"dom/events/zone_event_unpatched.init.js\"],\n+    srcs = [\"dom/events/zone_event_unpatched.init.mjs\"],\n )\n \n jasmine_node_test(\n\n---\n file path A: packages/platform-browser/test/dom/events/zone_event_unpatched.init.js | file path B: packages/platform-browser/test/dom/events/zone_event_unpatched.init.mjs\n\n@@ -14,4 +14,11 @@\n // strictly needed, but done for a specific test verifying that unpatched events are\n // running outside the zone. See `event_manager_spec.ts` and the\n // `unpatchedEvents handler outside of ngZone` spec.\n-window.__zone_symbol__UNPATCHED_EVENTS = ['unpatchedEventManagerTest'];\n+\n+export function configureZoneUnpatchedEvent() {\n+  window.__zone_symbol__UNPATCHED_EVENTS = ['unpatchedEventManagerTest'];\n+}\n+\n+// Invoke the function as a side-effect. We still expose the function so that it could be\n+// used e.g. in the Saucelabs legacy-job `test-init.ts` file.\n+configureZoneUnpatchedEvent();\n\n---\n file path A: tools/legacy-saucelabs/build-saucelabs-test-bundle.mjs | file path B: tools/legacy-saucelabs/build-saucelabs-test-bundle.mjs\n\n@@ -74,37 +74,33 @@ async function main() {\n async function findSpecFiles() {\n   const baseTestFiles = glob.sync('**/*_spec.js', {absolute: true, cwd: legacyOutputDir});\n \n-  return multimatch(\n-    baseTestFiles,\n-    [\n-      '**/*',\n-      `!${legacyOutputDir}/_testing_init/**`,\n-      `!${legacyOutputDir}/**/e2e_test/**`,\n-      `!${legacyOutputDir}/**/*node_only_spec.js`,\n-      `!${legacyOutputDir}/benchpress/**`,\n-      `!${legacyOutputDir}/compiler-cli/**`,\n-      `!${legacyOutputDir}/compiler-cli/src/ngtsc/**`,\n-      `!${legacyOutputDir}/compiler-cli/test/compliance/**`,\n-      `!${legacyOutputDir}/compiler-cli/test/ngtsc/**`,\n-      `!${legacyOutputDir}/compiler/test/aot/**`,\n-      `!${legacyOutputDir}/compiler/test/render3/**`,\n-      `!${legacyOutputDir}/core/test/bundling/**`,\n-      `!${legacyOutputDir}/core/schematics/test/**`,\n-      `!${legacyOutputDir}/core/test/render3/ivy/**`,\n-      `!${legacyOutputDir}/core/test/render3/jit/**`,\n-      `!${legacyOutputDir}/core/test/render3/perf/**`,\n-      `!${legacyOutputDir}/elements/schematics/**`,\n-      `!${legacyOutputDir}/examples/**/e2e_test/*`,\n-      `!${legacyOutputDir}/language-service/**`,\n-      `!${legacyOutputDir}/platform-server/**`,\n-      `!${legacyOutputDir}/localize/**/test/**`,\n-      `!${legacyOutputDir}/localize/schematics/**`,\n-      `!${legacyOutputDir}/router/**/test/**`,\n-      `!${legacyOutputDir}/zone.js/**/test/**`,\n-      `!${legacyOutputDir}/platform-browser/testing/e2e_util.js`,\n-\n-    ]\n-  );\n+  return multimatch(baseTestFiles, [\n+    '**/*',\n+    `!${legacyOutputDir}/_testing_init/**`,\n+    `!${legacyOutputDir}/**/e2e_test/**`,\n+    `!${legacyOutputDir}/**/*node_only_spec.js`,\n+    `!${legacyOutputDir}/benchpress/**`,\n+    `!${legacyOutputDir}/compiler-cli/**`,\n+    `!${legacyOutputDir}/compiler-cli/src/ngtsc/**`,\n+    `!${legacyOutputDir}/compiler-cli/test/compliance/**`,\n+    `!${legacyOutputDir}/compiler-cli/test/ngtsc/**`,\n+    `!${legacyOutputDir}/compiler/test/aot/**`,\n+    `!${legacyOutputDir}/compiler/test/render3/**`,\n+    `!${legacyOutputDir}/core/test/bundling/**`,\n+    `!${legacyOutputDir}/core/schematics/test/**`,\n+    `!${legacyOutputDir}/core/test/render3/ivy/**`,\n+    `!${legacyOutputDir}/core/test/render3/jit/**`,\n+    `!${legacyOutputDir}/core/test/render3/perf/**`,\n+    `!${legacyOutputDir}/elements/schematics/**`,\n+    `!${legacyOutputDir}/examples/**/e2e_test/*`,\n+    `!${legacyOutputDir}/language-service/**`,\n+    `!${legacyOutputDir}/platform-server/**`,\n+    `!${legacyOutputDir}/localize/**/test/**`,\n+    `!${legacyOutputDir}/localize/schematics/**`,\n+    `!${legacyOutputDir}/router/**/test/**`,\n+    `!${legacyOutputDir}/zone.js/**/test/**`,\n+    `!${legacyOutputDir}/platform-browser/testing/e2e_util.js`,\n+  ]);\n }\n \n /**\n@@ -149,13 +145,16 @@ async function createResolveEsbuildPlugin() {\n   const resolveMappings = new Map([\n     [/@angular\\//, `${legacyOutputDir}/`],\n     [/^angular-in-memory-web-api$/, join(legacyOutputDir, 'misc/angular-in-memory-web-api')],\n+    [/^zone.js\\//, `${legacyOutputDir}/zone.js/`],\n   ]);\n \n   return {\n-    name: 'ng-resolve-esbuild', setup: (build) => {\n-      build.onResolve({filter: /(@angular\\/|angular-in-memory-web-api)/}, async (args) => {\n-        const matchedPattern = Array.from(resolveMappings.keys()).find(\n-            pattern => args.path.match(pattern));\n+    name: 'ng-resolve-esbuild',\n+    setup: (build) => {\n+      build.onResolve({filter: /(@angular\\/|angular-in-memory-web-api|zone.js)/}, async (args) => {\n+        const matchedPattern = Array.from(resolveMappings.keys()).find((pattern) =>\n+          args.path.match(pattern)\n+        );\n \n         if (matchedPattern === undefined) {\n           return undefined;\n@@ -177,7 +176,7 @@ async function createResolveEsbuildPlugin() {\n \n         return stats !== null ? {path: resolvedPath} : undefined;\n       });\n-    }\n+    },\n   };\n }\n \n@@ -210,9 +209,10 @@ async function transpileDecoratorDownlevelTransform() {\n  * Compiles the project using the TypeScript compiler in order to produce\n  * JS output of the packages and tests.\n  */\n- async function compileProjectWithTsc() {\n+async function compileProjectWithTsc() {\n   const {legacyCompilationDownlevelDecoratorTransform} = await import(\n-      url.pathToFileURL(decoratorDownlevelOutFile));\n+    url.pathToFileURL(decoratorDownlevelOutFile)\n+  );\n   const config = parseTsconfigFile(legacyTsconfigPath, dirname(legacyTsconfigPath));\n   const program = ts.createProgram(config.fileNames, config.options);\n \n@@ -225,15 +225,17 @@ async function transpileDecoratorDownlevelTransform() {\n   const diagnostics = [\n     ...result.diagnostics,\n     ...program.getSyntacticDiagnostics(),\n-    ...program.getSemanticDiagnostics()\n+    ...program.getSemanticDiagnostics(),\n   ];\n \n   if (diagnostics.length) {\n-    console.error(ts.formatDiagnosticsWithColorAndContext(diagnostics, {\n-      getCanonicalFileName: fileName => fileName,\n-      getCurrentDirectory: () => program.getCurrentDirectory(),\n-      getNewLine: () => '\\n',\n-    }));\n+    console.error(\n+      ts.formatDiagnosticsWithColorAndContext(diagnostics, {\n+        getCanonicalFileName: (fileName) => fileName,\n+        getCurrentDirectory: () => program.getCurrentDirectory(),\n+        getNewLine: () => '\\n',\n+      })\n+    );\n \n     throw new Error('Compilation failed. See errors above.');\n   }\n@@ -261,7 +263,6 @@ function parseTsconfigFile(tsconfigPath, basePath) {\n   return ts.parseJsonConfigFileContent(config, parseConfigHost, basePath, {});\n }\n \n-\n /**\n  * Retrieves the `fs.Stats` results for the given path gracefully.\n  * If the file does not exist, returns `null`.\n@@ -274,7 +275,7 @@ async function statGraceful(path) {\n   }\n }\n \n-main().catch(e => {\n+main().catch((e) => {\n   console.error(e);\n   process.exitCode = 1;\n });\n\n---\n file path A: None | file path B: tools/legacy-saucelabs/pre-setup.ts\n\n@@ -0,0 +1,16 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+// ZoneJS configuration needed for some event manager tests. This config could\n+// affect all legacy tests but in reality is scoped to certain special tests.\n+import {configureZoneUnpatchedEvent} from '../../packages/platform-browser/test/dom/events/zone_event_unpatched.init.mjs';\n+\n+// Increase the timeout for specs as Saucelabs devices can be slow.\n+jasmine.DEFAULT_TIMEOUT_INTERVAL = 30000;\n+\n+configureZoneUnpatchedEvent();\n\n---\n file path A: tools/legacy-saucelabs/test-init.ts | file path B: tools/legacy-saucelabs/test-init.ts\n\n@@ -6,7 +6,5 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-// Increase the timeout for specs as Saucelabs devices can be slow.\n-jasmine.DEFAULT_TIMEOUT_INTERVAL = 30000;\n-\n-import '../testing/init_browser_tests';\n+import './pre-setup';\n+import '../testing/browser_tests.init';\n\n\n###\n\n", "completion": "build: fix legacy saucelabs test bundle generation after ESM changes (#<issue-num>)"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -34,39 +34,34 @@ var_4: &cache_key_fallback v8-angular-node-16-{{ checksum \"month.txt\" }}-{{ chec\n var_3_win: &cache_key_win v10-angular-win-node-16-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}\n var_4_win: &cache_key_win_fallback v10-angular-win-node-16-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}\n \n-# Cache key for the `components-repo-unit-tests` job. **Note** when updating the SHA in the\n-# cache keys also update the SHA for the \"COMPONENTS_REPO_COMMIT\" environment variable.\n-var_5: &components_repo_unit_tests_cache_key v2-angular-components-{{ checksum \"month.txt\" }}-87eb708d162e89897e66809c371e3a1e079de962\n-var_6: &components_repo_unit_tests_cache_key_fallback v2-angular-components-{{ checksum \"month.txt\" }}\n-\n # Workspace initially persisted by the `setup` job, and then enhanced by `build-npm-packages`.\n # https://circleci.com/docs/2.0/workflows/#using-workspaces-to-share-data-among-jobs\n # https://circleci.com/blog/deep-diving-into-circleci-workspaces/\n-var_7: &workspace_location ~/\n+var_5: &workspace_location ~/\n \n # Filter to run a job on builds for pull requests only.\n-var_8: &only_on_pull_requests\n+var_6: &only_on_pull_requests\n   filters:\n     branches:\n       only:\n         - /pull\\/\\d+/\n \n # Filter to skip a job on builds for pull requests.\n-var_9: &skip_on_pull_requests\n+var_7: &skip_on_pull_requests\n   filters:\n     branches:\n       ignore:\n         - /pull\\/\\d+/\n \n # Filter to run a job on builds for the main branch only.\n-var_10: &only_on_main_branch\n+var_8: &only_on_main_branch\n   filters:\n     branches:\n       only:\n         - main\n \n # Filter to run a job on all releasable branches.\n-var_11: &only_release_branches\n+var_9: &only_release_branches\n   filters:\n     branches:\n       only:\n@@ -551,59 +546,6 @@ jobs:\n           name: Stop Saucelabs tunnel service\n           command: ./tools/saucelabs/sauce-service.sh stop\n \n-  # Job that runs all unit tests of the `angular/components` repository.\n-  components-repo-unit-tests:\n-    executor:\n-      name: default-executor\n-      resource_class: xlarge\n-    steps:\n-      - custom_attach_workspace\n-      - init_environment\n-      # Restore the cache before cloning the repository because the clone script re-uses\n-      # the restored repository if present. This reduces the amount of times the components\n-      # repository needs to be cloned (this is slow and increases based on commits in the repo).\n-      - restore_cache:\n-          keys:\n-            - *components_repo_unit_tests_cache_key\n-            # Whenever the `angular/components` SHA is updated, the cache key will no longer\n-            # match. The fallback cache will still match, and CircleCI will restore the most\n-            # recently cached repository folder. Without the fallback cache, we'd need to download\n-            # the repository from scratch and it would slow down the job. This is because we can't\n-            # clone the repository with reduced `--depth`, but rather need to clone the whole\n-            # repository to be able to support arbitrary SHAs.\n-            - *components_repo_unit_tests_cache_key_fallback\n-      - run:\n-          name: 'Fetching angular/components repository'\n-          command: ./scripts/ci/clone_angular_components_repo.sh\n-      - run:\n-          # Run yarn install to fetch the Bazel binaries as used in the components repo.\n-          name: Installing dependencies.\n-          command: yarn --cwd ${COMPONENTS_REPO_TMP_DIR} install --frozen-lockfile --non-interactive --cache-folder ~/.cache/yarn\n-      - save_cache:\n-          key: *components_repo_unit_tests_cache_key\n-          paths:\n-            # Temporary directory must be kept in sync with the `$COMPONENTS_REPO_TMP_DIR` env\n-            # variable. It needs to be hardcoded here, because env variables interpolation is\n-            # not supported.\n-            - '/tmp/angular-components-repo'\n-      - run:\n-          # Copy zone.js package to dist/packages-dist, so `angular/components` can also use the local zone.js build.\n-          name: Setting up zone.js release packages.\n-          command: cp -r dist/zone.js-dist/zone.js dist/packages-dist/\n-      - run:\n-          # Updates the `angular/components` `package.json` file to refer to the release output\n-          # inside the `packages-dist` directory.\n-          name: Setting up framework release packages.\n-          command: node scripts/ci/update-framework-deps-to-dist-packages.js ${COMPONENTS_REPO_TMP_DIR}/package.json dist/packages-dist/\n-      - run:\n-          # Run `yarn install` again to install the Angular packages from `packages-dist/` and update the lockfile.\n-          # NOTE: We cannot rely on Bazel to run `yarn install`, because it uses the `--frozen-lockfile` flag and fails.\n-          name: Installing local Angular packages.\n-          command: yarn --cwd ${COMPONENTS_REPO_TMP_DIR} install --non-interactive --cache-folder ~/.cache/yarn\n-      - run:\n-          name: 'Running `angular/components` unit tests'\n-          command: ./scripts/ci/run_angular_components_unit_tests.sh\n-\n   test_zonejs:\n     executor:\n       name: default-executor\n@@ -752,9 +694,6 @@ workflows:\n             # since the publishing script expects the legacy outputs layout.\n             - build-npm-packages\n             - legacy-unit-tests-saucelabs\n-      - components-repo-unit-tests:\n-          requires:\n-            - build-npm-packages\n       - test_zonejs:\n           requires:\n             - setup\n\n---\n file path A: .circleci/env.sh | file path B: .circleci/env.sh\n\n@@ -61,20 +61,6 @@ setPublicVar SAUCE_TUNNEL_IDENTIFIER \"angular-framework-${CIRCLE_BUILD_NUM}-${CI\n # acquire CircleCI instances for too long if sauceconnect failed, we need a connect timeout.\n setPublicVar SAUCE_READY_FILE_TIMEOUT 120\n \n-\n-####################################################################################################\n-# Define environment variables for the `angular/components` repo unit tests job.\n-####################################################################################################\n-# We specifically use a directory within \"/tmp\" here because we want the cloned repo to be\n-# completely isolated from angular/angular in order to avoid any bad interactions between\n-# their separate build setups. **NOTE**: When updating the temporary directory, also update\n-# the `save_cache` path configuration in `config.yml`\n-setPublicVar COMPONENTS_REPO_TMP_DIR \"/tmp/angular-components-repo\"\n-setPublicVar COMPONENTS_REPO_URL \"https://github.com/angular/components.git\"\n-setPublicVar COMPONENTS_REPO_BRANCH \"main\"\n-# **NOTE**: When updating the commit SHA, also update the cache key in the CircleCI `config.yml`.\n-setPublicVar COMPONENTS_REPO_COMMIT \"87eb708d162e89897e66809c371e3a1e079de962\"\n-\n ####################################################################################################\n # Create shell script in /tmp for Bazel actions to access CI envs without\n # busting the cache. Used by payload-size.sh script in integration tests.\n\n---\n file path A: docs/DEBUG_COMPONENTS_REPO_IVY.md | file path B: None\n\n@@ -1,39 +0,0 @@\n-# Debugging the `components-repo-unit-tests` job\n-\n-Currently, all changes to Ivy are validated against the test suite of the\n-`angular/components` repository. In order to debug the `components-repo-unit-tests` CI\n-job, the following steps can be used:\n-\n-1\\) Build the Ivy package output by running `yarn build` in the `angular/angular` repo.\n-\n-2\\) Clone the `angular/components` repository if not done yet ([quick link to repo](https://github.com/angular/components)).\n-\n-3\\) Set up the package output in the `angular/components` repository by running the following\n-command in the `angular/angular` repo:\n-\n-```bash\n-node ./scripts/ci/update-framework-deps-to-dist-packages.js {COMPONENTS_REPO}/package.json ./dist/packages-dist\n-```\n-\n-4\\) Switch into the `angular/components` repository and run the tests by using the\n-following command:\n-\n-```bash\n-yarn test --deleted_packages=//src/dev-app\n-```\n-\n-### Running tests for individual entry-points\n-\n-The `yarn test` script from the `components` repository runs all tests in the project.\n-This is sometimes not desired because it involves building and testing of all packages\n-and entry-points. Running tests for an individual entry-point is possible by explicitly\n-selecting a given test target.\n-\n-Here is an example of commands that run individual test targets. Note that it is\n-**important** to specify the `--config=ivy` flag in order to run tests with Ivy.\n-\n-```bash\n-yarn bazel test --config=ivy src/material/slider:unit_tests\n-yarn bazel test --config=ivy src/cdk/a11y:unit_tests\n-yarn bazel test --config=ivy src/material/toolbar:unit_tests\n-```\n\n---\n file path A: scripts/ci/clone_angular_components_repo.sh | file path B: None\n\n@@ -1,31 +0,0 @@\n-#!/usr/bin/env bash\n-set -u -e -o pipefail\n-\n-# Clones the `angular/components` repository if the repository has not been cloned before.\n-# If the repository has been already cloned, the script refreshes the repository by syncing\n-# with the upstream remote, and resetting to the commit specified in the `COMPONENTS_REPO_COMMIT`\n-# environment variable.\n-\n-if [[ ! -d \"${COMPONENTS_REPO_TMP_DIR}\" ]]; then\n-  # Clone the repository if not present through restored cache.\n-  git clone --branch ${COMPONENTS_REPO_BRANCH} ${COMPONENTS_REPO_URL} ${COMPONENTS_REPO_TMP_DIR}\n-\n-  # Switch into the cloned repository.\n-  cd ${COMPONENTS_REPO_TMP_DIR}\n-\n-  # Reset branch to the desired commit.\n-  git reset --hard ${COMPONENTS_REPO_COMMIT}\n-else\n-  # Switch into the cached repository.\n-  cd ${COMPONENTS_REPO_TMP_DIR}\n-\n-  # Only refresh the repository if the current branch HEAD is not\n-  # matching the desired commit.\n-  if [[ \"$(git rev-parse HEAD)\" != \"${COMPONENTS_REPO_COMMIT}\" ]]; then\n-    # Pull the latest changes of the specified branch.\n-    git fetch origin ${COMPONENTS_REPO_BRANCH}\n-\n-    # Reset the current branch to the desired commit.\n-    git reset --hard ${COMPONENTS_REPO_COMMIT}\n-  fi\n-fi\n\n---\n file path A: scripts/ci/run_angular_components_unit_tests.sh | file path B: None\n\n@@ -1,27 +0,0 @@\n-#!/usr/bin/env bash\n-set -u -e -o pipefail\n-\n-# Script that runs all unit tests of the `angular/components` repository.\n-\n-# Path to the Angular project.\n-angular_dir=$(pwd)\n-\n-# Switch into the temporary directory where the `angular/components`\n-# repository has been cloned into.\n-cd ${COMPONENTS_REPO_TMP_DIR}\n-\n-# Create a symlink for the Bazel binary installed through NPM, as running through Yarn introduces OOM errors.\n-./scripts/circleci/setup_bazel_binary.sh\n-\n-# Properly wire up the components repo CircleCI Bazel configuration\n-# Also enable RBE. The credentials are expected to be set up already.\n-echo \"import %workspace%/.circleci/bazel.rc\" >> ./.bazelrc.user\n-echo \"build --config=remote\" >> ./.bazelrc.user\n-\n-# Now actually run the tests.\n-bazel test \\\n-  --build_tag_filters=-docs-package,-e2e,-browser:firefox \\\n-  --test_tag_filters=-e2e,-browser:firefox \\\n-  --build_tests_only \\\n-  --keep_going \\\n-  -- src/...\n\n\n###\n\n", "completion": "build: remove components repo unit tests job (#<issue-num>)"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -105,9 +105,10 @@ yarn_install(\n         \"//:scripts/puppeteer-chromedriver-versions.js\",\n         \"//:scripts/webdriver-manager-update.js\",\n         \"//tools:postinstall-patches.js\",\n-        \"//tools/esm-interop:patches/npm/@angular+build-tooling+0.0.0-2fe6d743f60e2e1ba91f9e49c417927a46dcd90f.patch\",\n+        \"//tools/esm-interop:patches/npm/@angular+build-tooling+0.0.0-d4d1329adbe1cdb5fd382d618e830c69e578c41b.patch\",\n         \"//tools/esm-interop:patches/npm/@bazel+concatjs+5.7.1.patch\",\n         \"//tools/esm-interop:patches/npm/@bazel+esbuild+5.7.1.patch\",\n+        \"//tools/esm-interop:patches/npm/@bazel+protractor+5.7.1.patch\",\n         \"//tools/esm-interop:patches/npm/rxjs+6.6.7.patch\",\n     ],\n     # Currently disabled due to:\n\n---\n file path A: package.json | file path B: package.json\n\n@@ -179,7 +179,7 @@\n   },\n   \"// 2\": \"devDependencies are not used under Bazel. Many can be removed after test.sh is deleted.\",\n   \"devDependencies\": {\n-    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#700b36f4887bdd4c82332f7ce0e407d19cd9a644\",\n+    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#98ed19ad0bc7e985718d240aac9c9f56f5fbcd4c\",\n     \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#05278122c48e06eff8e5398d59c49ed6688c949b\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n     \"@bazel/buildifier\": \"^5.0.0\",\n\n---\n file path A: tools/defaults.bzl | file path B: tools/defaults.bzl\n\n@@ -363,19 +363,24 @@ def karma_web_test_suite(\n         **kwargs\n     )\n \n-def protractor_web_test_suite(name, deps = [], **kwargs):\n+def protractor_web_test_suite(\n+        name,\n+        deps = [],\n+        external = [],\n+        browsers = [\"@npm//@angular/build-tooling/bazel/browsers/chromium:chromium\"],\n+        **kwargs):\n     \"\"\"Default values for protractor_web_test_suite\"\"\"\n     spec_bundle(\n         name = \"%s_bundle\" % name,\n         deps = deps,\n         platform = \"cjs-legacy\",\n-        external = [\"protractor\"],\n+        external = external + [\"protractor\"],\n     )\n \n     _protractor_web_test_suite(\n         name = name,\n-        browsers = [\"@npm//@angular/build-tooling/bazel/browsers/chromium:chromium\"],\n         deps = [\":%s_bundle\" % name],\n+        browsers = browsers,\n         **kwargs\n     )\n \n\n---\n file path A: tools/esm-interop/patches/npm/@angular+build-tooling+0.0.0-2fe6d743f60e2e1ba91f9e49c417927a46dcd90f.patch | file path B: tools/esm-interop/patches/npm/@angular+build-tooling+0.0.0-d4d1329adbe1cdb5fd382d618e830c69e578c41b.patch\n\n@@ -1,5 +1,5 @@\n diff --git a/node_modules/@angular/build-tooling/bazel/app-bundling/esbuild.config-tmpl.mjs b/node_modules/@angular/build-tooling/bazel/app-bundling/esbuild.config-tmpl.mjs\n-index dde2164..772c153 100755\n+index e4410ba..33d75cd 100755\n --- a/node_modules/@angular/build-tooling/bazel/app-bundling/esbuild.config-tmpl.mjs\n +++ b/node_modules/@angular/build-tooling/bazel/app-bundling/esbuild.config-tmpl.mjs\n @@ -9,7 +9,7 @@\n@@ -24,8 +24,35 @@ index 1edd96d..3d423f4 100755\n              \"@npm//@angular/build-tooling/shared-scripts/angular-optimization:js_lib\",\n          ],\n          **common_base_attributes\n+diff --git a/node_modules/@angular/build-tooling/bazel/benchmark/component_benchmark/benchmark_test.bzl b/node_modules/@angular/build-tooling/bazel/benchmark/component_benchmark/benchmark_test.bzl\n+index d36afe6..fbdc9bb 100755\n+--- a/node_modules/@angular/build-tooling/bazel/benchmark/component_benchmark/benchmark_test.bzl\n++++ b/node_modules/@angular/build-tooling/bazel/benchmark/component_benchmark/benchmark_test.bzl\n+@@ -1,4 +1,4 @@\n+-load(\"@npm//@bazel/protractor:index.bzl\", \"protractor_web_test_suite\")\n++load(\"@angular//tools:defaults.bzl\", \"protractor_web_test_suite\")\n+ \n+ \"\"\"\n+   Macro that can be used to define a benchmark test. This differentiates from\n+@@ -7,7 +7,7 @@ load(\"@npm//@bazel/protractor:index.bzl\", \"protractor_web_test_suite\")\n+   unless explicitly requested.\n+ \"\"\"\n+ \n+-def benchmark_test(name, server, tags = [], **kwargs):\n++def benchmark_test(name, server, tags = [], data = [], **kwargs):\n+     protractor_web_test_suite(\n+         name = name,\n+         browsers = [\"@npm//@angular/build-tooling/bazel/browsers/chromium:chromium\"],\n+@@ -19,6 +19,7 @@ def benchmark_test(name, server, tags = [], **kwargs):\n+             \"manual\",\n+             \"no-remote-exec\",\n+         ],\n++        data = data + [\"@angular//packages/benchpress\"],\n+         test_suite_tags = [\n+             \"manual\",\n+             \"no-remote-exec\",\n diff --git a/node_modules/@angular/build-tooling/bazel/benchmark/component_benchmark/component_benchmark.bzl b/node_modules/@angular/build-tooling/bazel/benchmark/component_benchmark/component_benchmark.bzl\n-index 6213703..4d91aa3 100755\n+index 6213703..8f1ec71 100755\n --- a/node_modules/@angular/build-tooling/bazel/benchmark/component_benchmark/component_benchmark.bzl\n +++ b/node_modules/@angular/build-tooling/bazel/benchmark/component_benchmark/component_benchmark.bzl\n @@ -1,7 +1,7 @@\n@@ -57,6 +84,15 @@ index 6213703..4d91aa3 100755\n  \n      if not assets:\n          html = prefix + \"index.html\"\n+@@ -142,6 +142,8 @@ def component_benchmark(\n+     ts_library(\n+         name = benchmark_driver,\n+         tsconfig = \"@npm//@angular/build-tooling/bazel/benchmark/component_benchmark:tsconfig-e2e.json\",\n++        devmode_module = \"esnext\",\n++        devmode_target = \"es2020\",\n+         testonly = True,\n+         srcs = [driver],\n+         deps = driver_deps,\n diff --git a/node_modules/@angular/build-tooling/shared-scripts/angular-optimization/BUILD.bazel b/node_modules/@angular/build-tooling/shared-scripts/angular-optimization/BUILD.bazel\n index 79afcb8..ebbb37b 100755\n --- a/node_modules/@angular/build-tooling/shared-scripts/angular-optimization/BUILD.bazel\n@@ -72,7 +108,7 @@ index 79afcb8..ebbb37b 100755\n          \"@npm//@babel/plugin-proposal-async-generator-functions\",\n      ],\n diff --git a/node_modules/@angular/build-tooling/shared-scripts/angular-optimization/esbuild-plugin.mjs b/node_modules/@angular/build-tooling/shared-scripts/angular-optimization/esbuild-plugin.mjs\n-index fbaf182..e690328 100755\n+index f5908b9..d5fac4f 100755\n --- a/node_modules/@angular/build-tooling/shared-scripts/angular-optimization/esbuild-plugin.mjs\n +++ b/node_modules/@angular/build-tooling/shared-scripts/angular-optimization/esbuild-plugin.mjs\n @@ -54,8 +54,8 @@ export async function createEsbuildAngularOptimizePlugin(opts, additionalBabelPl\n\n---\n file path A: None | file path B: tools/esm-interop/patches/npm/@bazel+protractor+5.7.1.patch\n\n@@ -0,0 +1,13 @@\n+diff --git a/node_modules/@bazel/protractor/protractor_web_test.bzl b/node_modules/@bazel/protractor/protractor_web_test.bzl\n+index 77fcd99..8c65658 100755\n+--- a/node_modules/@bazel/protractor/protractor_web_test.bzl\n++++ b/node_modules/@bazel/protractor/protractor_web_test.bzl\n+@@ -14,7 +14,7 @@\n+ \"Run end-to-end tests with Protractor\"\n+ \n+ load(\"@rules_nodejs//nodejs:providers.bzl\", \"JSModuleInfo\")\n+-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"nodejs_binary\")\n++load(\"@angular//tools/esm-interop:index.bzl\", \"nodejs_binary\")\n+ load(\"@build_bazel_rules_nodejs//:providers.bzl\", \"ExternalNpmPackageInfo\", \"JSNamedModuleInfo\", \"node_modules_aspect\")\n+ load(\"@build_bazel_rules_nodejs//internal/common:windows_utils.bzl\", \"create_windows_native_launcher_script\", \"is_windows\")\n+ load(\"@io_bazel_rules_webtesting//web:web.bzl\", \"web_test_suite\")\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -149,9 +149,9 @@\n     \"@angular/core\" \"^13.0.0 || ^14.0.0-0\"\n     reflect-metadata \"^0.1.13\"\n \n-\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#700b36f4887bdd4c82332f7ce0e407d19cd9a644\":\n-  version \"0.0.0-bc7bf8bfc84492f04d18dc1cbf4b7547e51c3786\"\n-  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#700b36f4887bdd4c82332f7ce0e407d19cd9a644\"\n+\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#98ed19ad0bc7e985718d240aac9c9f56f5fbcd4c\":\n+  version \"0.0.0-4d9ea67a331c5333fc4b0ffbfa32479a8ec0a17b\"\n+  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#98ed19ad0bc7e985718d240aac9c9f56f5fbcd4c\"\n   dependencies:\n     \"@angular-devkit/build-angular\" \"15.1.0-next.2\"\n     \"@angular/benchpress\" \"0.3.0\"\n\n\n###\n\n", "completion": "build: update build-tooling and adjust benchmark macros for ESM (#<issue-num>)"}
{"prompt": " file path A: packages/service-worker/config/test/BUILD.bazel | file path B: packages/service-worker/config/test/BUILD.bazel\n\n@@ -3,7 +3,7 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/service-worker/config/index.js\",\n+    entry_point = \"angular/packages/service-worker/config/index.mjs\",\n     deps = [\"//packages/service-worker/config\"],\n )\n \n\n---\n file path A: packages/service-worker/test/BUILD.bazel | file path B: packages/service-worker/test/BUILD.bazel\n\n@@ -3,7 +3,7 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/service-worker/index.js\",\n+    entry_point = \"angular/packages/service-worker/index.mjs\",\n     deps = [\"//packages/service-worker\"],\n )\n \n\n---\n file path A: packages/service-worker/worker/test/BUILD.bazel | file path B: packages/service-worker/worker/test/BUILD.bazel\n\n@@ -3,7 +3,7 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/service-worker/worker/main.js\",\n+    entry_point = \"angular/packages/service-worker/worker/main.mjs\",\n     deps = [\"//packages/service-worker/worker:main\"],\n )\n \n\n---\n file path A: packages/service-worker/worker/testing/utils.ts | file path B: packages/service-worker/worker/testing/utils.ts\n\n@@ -15,19 +15,7 @@ import {NormalizedUrl} from '../src/api';\n  * @return Whether ServiceWorker tests can be run in the current environment.\n  */\n export function envIsSupported(): boolean {\n-  if (typeof URL === 'function') {\n-    return true;\n-  }\n-\n-  // If we're in a browser that doesn't support URL at this point, don't go any further\n-  // since browser builds use requirejs which will fail on the `require` call below.\n-  if (typeof window !== 'undefined' && window) {\n-    return false;\n-  }\n-\n-  // In older Node.js versions, the `URL` global does not exist. We can use `url` instead.\n-  const url = (typeof require === 'function') && require('url');\n-  return url && (typeof url.parse === 'function') && (typeof url.resolve === 'function');\n+  return typeof URL === 'function';\n }\n \n /**\n@@ -55,9 +43,7 @@ export function normalizeUrl(url: string, relativeTo: string): NormalizedUrl {\n  */\n export function parseUrl(\n     url: string, relativeTo?: string): {origin: string, path: string, search: string} {\n-  const parsedUrl: URL = (typeof URL === 'function') ?\n-      (!relativeTo ? new URL(url) : new URL(url, relativeTo)) :\n-      require('url').parse(require('url').resolve(relativeTo || '', url));\n+  const parsedUrl: URL = (!relativeTo ? new URL(url) : new URL(url, relativeTo));\n \n   return {\n     origin: parsedUrl.origin || `${parsedUrl.protocol}//${parsedUrl.host}`,\n\n\n###\n\n", "completion": "refactor: update `service-worker` tests to work with ESM (#<issue-num>)"}
{"prompt": " file path A: packages/language-service/BUILD.bazel | file path B: packages/language-service/BUILD.bazel\n\n@@ -1,4 +1,4 @@\n-load(\"//tools:defaults.bzl\", \"pkg_npm\", \"ts_library\")\n+load(\"//tools:defaults.bzl\", \"esbuild\", \"extract_types\", \"pkg_npm\", \"ts_library\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -6,20 +6,43 @@ ts_library(\n     name = \"api\",\n     srcs = [\n         \"api.ts\",\n-        \"index.ts\",\n-        \"override_rename_ts_plugin.ts\",\n     ],\n-    prodmode_module = \"commonjs\",\n     deps = [\n+        \"@npm//typescript\",\n+    ],\n+)\n+\n+ts_library(\n+    name = \"factory_lib\",\n+    srcs = [\"plugin-factory.ts\"],\n+    deps = [\n+        \":api\",\n         \"@npm//@types/node\",\n         \"@npm//typescript\",\n     ],\n )\n \n+esbuild(\n+    name = \"factory_bundle\",\n+    entry_point = \":plugin-factory.ts\",\n+    external = [\"./bundles/language-service.js\"],\n+    format = \"cjs\",\n+    deps = [\":factory_lib\"],\n+)\n+\n+extract_types(\n+    name = \"factory_types\",\n+    deps = [\":factory_lib\"],\n+)\n+\n pkg_npm(\n     name = \"npm_package\",\n     package_name = \"@angular/language-service\",\n-    srcs = [\"package.json\"],\n+    srcs = [\n+        \"index.d.ts\",\n+        \"index.js\",\n+        \"package.json\",\n+    ],\n     tags = [\n         \"release-with-framework\",\n     ],\n@@ -32,8 +55,8 @@ pkg_npm(\n         \"//integration:__subpackages__\",\n     ],\n     deps = [\n-        \":api\",\n-        # min bundle is not used at the moment; omit from package to speed up build\n+        \":factory_bundle\",\n+        \":factory_types\",\n         \"//packages/language-service/bundles:language-service.js\",\n     ],\n )\n\n---\n file path A: None | file path B: packages/language-service/index.d.ts\n\n@@ -0,0 +1,13 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {factory} from './plugin-factory';\n+\n+// Tsserver expects `@angular/language-service` to provide a factory function\n+// as the default export of the package.\n+export = factory;\n\n---\n file path A: None | file path B: packages/language-service/index.js\n\n@@ -0,0 +1,13 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+const {factory} = require('./factory_bundle');\n+\n+// Tsserver expects `@angular/language-service` to provide a factory function\n+// as the default export of the package.\n+module.exports = factory;\n\n---\n file path A: packages/language-service/override_rename_ts_plugin.ts | file path B: packages/language-service/override_rename_ts_plugin.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import * as ts from 'typescript/lib/tsserverlibrary';\n+import ts from 'typescript/lib/tsserverlibrary';\n \n function isAngularCore(path: string): boolean {\n   return isExternalAngularCore(path) || isInternalAngularCore(path);\n\n---\n file path A: packages/language-service/index.ts | file path B: packages/language-service/plugin-factory.ts\n\n@@ -6,7 +6,8 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import * as ts from 'typescript/lib/tsserverlibrary';\n+import ts from 'typescript/lib/tsserverlibrary';\n+\n import {NgLanguageService, PluginConfig} from './api';\n \n interface PluginModule extends ts.server.PluginModule {\n@@ -14,7 +15,7 @@ interface PluginModule extends ts.server.PluginModule {\n   onConfigurationChanged?(config: PluginConfig): void;\n }\n \n-const factory: ts.server.PluginModuleFactory = (tsModule): PluginModule => {\n+export const factory: ts.server.PluginModuleFactory = (tsModule): PluginModule => {\n   let plugin: PluginModule;\n \n   return {\n@@ -30,10 +31,3 @@ const factory: ts.server.PluginModuleFactory = (tsModule): PluginModule => {\n     },\n   };\n };\n-\n-/**\n- * Tsserver expects `@angular/language-service` to provide a factory function\n- * as the default export of the package. See\n- * https://github.com/microsoft/TypeScript/blob/f4d0ea6539edb6d8f70b626132d6f9ac1ac4281a/src/server/project.ts#L1611\n- */\n-export = factory;\n\n---\n file path A: packages/language-service/src/adapters.ts | file path B: packages/language-service/src/adapters.ts\n\n@@ -14,7 +14,7 @@ import {AbsoluteFsPath, FileStats, PathSegment, PathString} from '@angular/compi\n import {isShim} from '@angular/compiler-cli/src/ngtsc/shims';\n import {getRootDirs} from '@angular/compiler-cli/src/ngtsc/util/src/typescript';\n import * as p from 'path';\n-import * as ts from 'typescript/lib/tsserverlibrary';\n+import ts from 'typescript/lib/tsserverlibrary';\n \n import {isTypeScriptFile} from './utils';\n \n\n---\n file path A: packages/language-service/src/codefixes/code_fixes.ts | file path B: packages/language-service/src/codefixes/code_fixes.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {NgCompiler} from '@angular/compiler-cli/src/ngtsc/core';\n-import * as tss from 'typescript/lib/tsserverlibrary';\n+import tss from 'typescript/lib/tsserverlibrary';\n \n import {TemplateInfo} from '../utils';\n \n\n---\n file path A: packages/language-service/src/codefixes/fix_invalid_banana_in_box.ts | file path B: packages/language-service/src/codefixes/fix_invalid_banana_in_box.ts\n\n@@ -8,7 +8,7 @@\n \n import {ErrorCode, ngErrorCode} from '@angular/compiler-cli/src/ngtsc/diagnostics';\n import {BoundEvent} from '@angular/compiler/src/render3/r3_ast';\n-import * as tss from 'typescript/lib/tsserverlibrary';\n+import tss from 'typescript/lib/tsserverlibrary';\n \n import {getTargetAtPosition, TargetNodeKind} from '../template_target';\n import {getTemplateInfoAtPosition, TemplateInfo} from '../utils';\n\n---\n file path A: packages/language-service/src/codefixes/fix_missing_member.ts | file path B: packages/language-service/src/codefixes/fix_missing_member.ts\n\n@@ -9,7 +9,7 @@\n import {findFirstMatchingNode} from '@angular/compiler-cli/src/ngtsc/typecheck/src/comments';\n import * as e from '@angular/compiler/src/expression_parser/ast';  // e for expression AST\n import ts from 'typescript';\n-import * as tss from 'typescript/lib/tsserverlibrary';\n+import tss from 'typescript/lib/tsserverlibrary';\n \n import {getTargetAtPosition, getTcbNodesOfTemplateAtPosition, TargetNodeKind} from '../template_target';\n import {getTemplateInfoAtPosition} from '../utils';\n\n---\n file path A: packages/language-service/src/codefixes/utils.ts | file path B: packages/language-service/src/codefixes/utils.ts\n\n@@ -8,7 +8,7 @@\n \n import {absoluteFrom} from '@angular/compiler-cli';\n import {NgCompiler} from '@angular/compiler-cli/src/ngtsc/core';\n-import * as tss from 'typescript/lib/tsserverlibrary';\n+import tss from 'typescript/lib/tsserverlibrary';\n \n import {TemplateInfo} from '../utils';\n \n\n---\n file path A: packages/language-service/src/language_service.ts | file path B: packages/language-service/src/language_service.ts\n\n@@ -17,7 +17,7 @@ import {isNamedClassDeclaration} from '@angular/compiler-cli/src/ngtsc/reflectio\n import {TypeCheckShimGenerator} from '@angular/compiler-cli/src/ngtsc/typecheck';\n import {OptimizeFor} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n import {findFirstMatchingNode} from '@angular/compiler-cli/src/ngtsc/typecheck/src/comments';\n-import * as ts from 'typescript/lib/tsserverlibrary';\n+import ts from 'typescript/lib/tsserverlibrary';\n \n import {GetComponentLocationsForTemplateResponse, GetTcbResponse, GetTemplateLocationForComponentResponse} from '../api';\n \n\n---\n file path A: packages/language-service/src/signature_help.ts | file path B: packages/language-service/src/signature_help.ts\n\n@@ -10,7 +10,7 @@ import {Call, SafeCall} from '@angular/compiler';\n import {NgCompiler} from '@angular/compiler-cli/src/ngtsc/core';\n import {getSourceFileOrError} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {SymbolKind} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n-import * as ts from 'typescript/lib/tsserverlibrary';\n+import ts from 'typescript/lib/tsserverlibrary';\n \n import {getTargetAtPosition, TargetNodeKind} from './template_target';\n import {findTightestNode} from './ts_utils';\n\n---\n file path A: packages/language-service/src/template_target.ts | file path B: packages/language-service/src/template_target.ts\n\n@@ -11,7 +11,7 @@ import {NgCompiler} from '@angular/compiler-cli/src/ngtsc/core';\n import {findFirstMatchingNode} from '@angular/compiler-cli/src/ngtsc/typecheck/src/comments';\n import * as e from '@angular/compiler/src/expression_parser/ast';  // e for expression AST\n import * as t from '@angular/compiler/src/render3/r3_ast';         // t for template AST\n-import * as tss from 'typescript/lib/tsserverlibrary';\n+import tss from 'typescript/lib/tsserverlibrary';\n \n import {isBoundEventWithSyntheticHandler, isTemplateNodeWithKeyAndValue, isWithin, isWithinKeyValue, TemplateInfo} from './utils';\n \n\n---\n file path A: packages/language-service/src/ts_plugin.ts | file path B: packages/language-service/src/ts_plugin.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import * as ts from 'typescript/lib/tsserverlibrary';\n+import ts from 'typescript/lib/tsserverlibrary';\n \n import {GetComponentLocationsForTemplateResponse, GetTcbResponse, GetTemplateLocationForComponentResponse, NgLanguageService} from '../api';\n \n\n---\n file path A: packages/language-service/test/adapters_spec.ts | file path B: packages/language-service/test/adapters_spec.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import * as ts from 'typescript/lib/tsserverlibrary';\n+import ts from 'typescript/lib/tsserverlibrary';\n \n import {LSParseConfigHost} from '../src/adapters';\n \n\n---\n file path A: packages/language-service/test/legacy/compiler_factory_spec.ts | file path B: packages/language-service/test/legacy/compiler_factory_spec.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import * as ts from 'typescript/lib/tsserverlibrary';\n+import ts from 'typescript/lib/tsserverlibrary';\n \n import {APP_COMPONENT, MockService, setup, TEST_TEMPLATE} from './mock_host';\n \n\n---\n file path A: packages/language-service/test/legacy/language_service_spec.ts | file path B: packages/language-service/test/legacy/language_service_spec.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {ErrorCode, ngErrorCode} from '@angular/compiler-cli/src/ngtsc/diagnostics';\n-import * as ts from 'typescript/lib/tsserverlibrary';\n+import ts from 'typescript/lib/tsserverlibrary';\n \n import {LanguageService} from '../../src/language_service';\n \n\n---\n file path A: packages/language-service/test/legacy/mock_host.ts | file path B: packages/language-service/test/legacy/mock_host.ts\n\n@@ -8,7 +8,7 @@\n \n import {NgCompilerOptions} from '@angular/compiler-cli/src/ngtsc/core/api';\n import {join} from 'path';\n-import * as ts from 'typescript/lib/tsserverlibrary';\n+import ts from 'typescript/lib/tsserverlibrary';\n \n import {isTypeScriptFile} from '../../src/utils';\n \n\n---\n file path A: packages/language-service/test/legacy/mock_host_spec.ts | file path B: packages/language-service/test/legacy/mock_host_spec.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import * as ts from 'typescript/lib/tsserverlibrary';\n+import ts from 'typescript/lib/tsserverlibrary';\n \n import {APP_COMPONENT, APP_MAIN, MockService, setup, TEST_SRCDIR} from './mock_host';\n \n\n---\n file path A: packages/language-service/test/quick_info_spec.ts | file path B: packages/language-service/test/quick_info_spec.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {initMockFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n-import * as ts from 'typescript/lib/tsserverlibrary';\n+import ts from 'typescript/lib/tsserverlibrary';\n \n import {createModuleAndProjectWithDeclarations, LanguageServiceTestEnv, Project} from '../testing';\n \n\n---\n file path A: packages/language-service/testing/src/buffer.ts | file path B: packages/language-service/testing/src/buffer.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import * as ts from 'typescript/lib/tsserverlibrary';\n+import ts from 'typescript/lib/tsserverlibrary';\n \n import {LanguageService} from '../../src/language_service';\n \n\n---\n file path A: packages/language-service/testing/src/env.ts | file path B: packages/language-service/testing/src/env.ts\n\n@@ -9,7 +9,7 @@\n import {getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {MockFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n import {loadStandardTestFiles} from '@angular/compiler-cli/src/ngtsc/testing';\n-import * as ts from 'typescript/lib/tsserverlibrary';\n+import ts from 'typescript/lib/tsserverlibrary';\n \n import {MockServerHost} from './host';\n import {Project, ProjectFiles, TestableOptions} from './project';\n\n---\n file path A: packages/language-service/testing/src/host.ts | file path B: packages/language-service/testing/src/host.ts\n\n@@ -8,7 +8,7 @@\n \n import {absoluteFrom} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {MockFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n-import * as ts from 'typescript/lib/tsserverlibrary';\n+import ts from 'typescript/lib/tsserverlibrary';\n \n const NOOP_FILE_WATCHER: ts.FileWatcher = {\n   close() {}\n\n---\n file path A: packages/language-service/testing/src/project.ts | file path B: packages/language-service/testing/src/project.ts\n\n@@ -9,7 +9,7 @@\n import {InternalOptions, LegacyNgcOptions, StrictTemplateOptions} from '@angular/compiler-cli/src/ngtsc/core/api';\n import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem, getSourceFileOrError} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {OptimizeFor, TemplateTypeChecker} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n-import * as ts from 'typescript/lib/tsserverlibrary';\n+import ts from 'typescript/lib/tsserverlibrary';\n \n import {LanguageService} from '../../src/language_service';\n \n\n---\n file path A: tslint.json | file path B: tslint.json\n\n@@ -21,6 +21,7 @@\n         // the ESM interop only exposes statically-discoverable named exports). Instead\n         // default imports should be used to ensure compatibility with both ESM or CommonJS.\n         \"noNamedExports\": [\n+          \"typescript/lib/tsserverlibrary\",\n           \"typescript\",\n           \"minimist\",\n           \"magic-string\",\n@@ -73,7 +74,10 @@\n       true,\n       {\"name\": \"fdescribe\", \"message\": \"Don't keep jasmine focus methods.\"},\n       {\"name\": \"fit\", \"message\": \"Don't keep jasmine focus methods.\"},\n-      {\"name\": [\"*\", \"getMutableClone\"], \"message\": \"Use a ts.factory.update* or ts.factory.create* method instead.\"}\n+      {\n+        \"name\": [\"*\", \"getMutableClone\"],\n+        \"message\": \"Use a ts.factory.update* or ts.factory.create* method instead.\"\n+      }\n     ]\n   },\n   \"jsRules\": {\n\n\n###\n\n", "completion": "refactor: update `language-service` package and tests to work with ESM (#<issue-num>)"}
{"prompt": " file path A: tools/saucelabs/BUILD.bazel | file path B: tools/saucelabs/BUILD.bazel\n\n@@ -54,12 +54,14 @@ sh_binary(\n nodejs_binary(\n     name = \"karma-saucelabs\",\n     data = [\n-        \"sauce-service.sh\",\n         \"@npm//@bazel/runfiles\",\n         \"@npm//karma\",\n         \"@npm//sauce-connect\",\n         \"@npm//shelljs\",\n     ],\n-    entry_point = \"karma-saucelabs.js\",\n+    data_for_expansion = [\n+        \"sauce-service.sh\",\n+    ],\n+    entry_point = \"karma-saucelabs.mjs\",\n     templated_args = [\"$(rootpath sauce-service.sh)\"],\n )\n\n---\n file path A: tools/saucelabs/karma-saucelabs.js | file path B: tools/saucelabs/karma-saucelabs.mjs\n\n@@ -8,15 +8,15 @@\n \n 'use strict';\n \n-const shell = require('shelljs');\n-const karmaBin = require.resolve('karma/bin/karma');\n-const {runfiles} = require('@bazel/runfiles');\n+import shell from 'shelljs';\n+import {runfiles} from '@bazel/runfiles';\n+import fs from 'fs';\n+\n+const karmaBin = runfiles.resolve('npm/node_modules/karma/bin/karma');\n const sauceService = runfiles.resolveWorkspaceRelative(process.argv[2]);\n-process.argv = [\n-  process.argv[0],\n-  karmaBin,\n-  ...process.argv.splice(3),\n-];\n+\n+process.argv = [process.argv[0], karmaBin, ...process.argv.splice(3)];\n+\n try {\n   console.error(`Setting up environment for SauceLabs karma tests...`);\n   // KARMA_WEB_TEST_MODE is set which informs /karma-js.conf.js that it should\n@@ -26,8 +26,11 @@ try {\n   // will be `null` if the test runs locally without the `sauce-service` being started.\n   const saucelabsParams = readLocalSauceConnectParams();\n   // Setup required SAUCE_* env if they are not already set\n-  if (!process.env['SAUCE_USERNAME'] || !process.env['SAUCE_ACCESS_KEY'] ||\n-      !process.env['SAUCE_TUNNEL_IDENTIFIER']) {\n+  if (\n+    !process.env['SAUCE_USERNAME'] ||\n+    !process.env['SAUCE_ACCESS_KEY'] ||\n+    !process.env['SAUCE_TUNNEL_IDENTIFIER']\n+  ) {\n     // We print a helpful error message below if the required Saucelabs parameters have not\n     // been specified in test environment, and the `sauce-service` params file has not been\n     // created either.\n@@ -74,7 +77,9 @@ function readLocalSauceConnectParams() {\n     // We setup the required saucelabs environment variables here for the karma test\n     // from a json file under /tmp/angular/sauce-service  so that we don't break the\n     // test cache with a changing SAUCE_TUNNEL_IDENTIFIER provided through --test_env\n-    return require('/tmp/angular/sauce-service/sauce-connect-params.json');\n+    return JSON.parse(\n+      fs.readFileSync('/tmp/angular/sauce-service/sauce-connect-params.json', 'utf8')\n+    );\n   } catch {\n     return null;\n   }\n\n---\n file path A: tools/symbol-extractor/BUILD.bazel | file path B: tools/symbol-extractor/BUILD.bazel\n\n@@ -29,6 +29,7 @@ ts_library(\n     deps = [\n         \":lib\",\n         \"//packages:types\",\n+        \"@npm//@bazel/runfiles\",\n         \"@npm//typescript\",\n     ],\n )\n\n---\n file path A: tools/symbol-extractor/symbol_extractor_spec.ts | file path B: tools/symbol-extractor/symbol_extractor_spec.ts\n\n@@ -6,6 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {runfiles} from '@bazel/runfiles';\n import * as fs from 'fs';\n import * as path from 'path';\n \n@@ -13,7 +14,7 @@ import {SymbolExtractor} from './symbol_extractor';\n \n describe('scenarios', () => {\n   const symbolExtractorSpecDir = path.dirname(\n-      require.resolve('angular/tools/symbol-extractor/symbol_extractor_spec/empty.json'));\n+      runfiles.resolve('angular/tools/symbol-extractor/symbol_extractor_spec/empty.json'));\n   const scenarioFiles = fs.readdirSync(symbolExtractorSpecDir);\n   for (let i = 0; i < scenarioFiles.length; i++) {\n     const filePath = scenarioFiles[i];\n@@ -46,7 +47,7 @@ describe('scenarios', () => {\n \n   it('should properly capture classes in TypeScript ES2015 class output', () => {\n     const jsFileContent = fs.readFileSync(\n-        require.resolve(\n+        runfiles.resolve(\n             'angular/tools/symbol-extractor/symbol_extractor_spec/es2015_class_output.mjs'),\n         'utf8');\n     const jsonFileContent =\n\n\n###\n\n", "completion": "refactor: update `tools` tests and scripts to work with Bazel ESM (#<issue-num>)"}
{"prompt": " file path A: devtools/tools/defaults.bzl | file path B: devtools/tools/defaults.bzl\n\n@@ -1,36 +1,8 @@\n # Re-export of Bazel rules with devtools-wide defaults\n \n-load(\"@npm//@angular/build-tooling/bazel/spec-bundling:index.bzl\", \"spec_bundle\")\n-load(\"@npm//@angular/build-tooling/bazel/karma:index.bzl\", _karma_web_test_suite = \"karma_web_test_suite\")\n-load(\"@npm//@angular/build-tooling/bazel:extract_js_module_output.bzl\", \"extract_js_module_output\")\n+load(\"//tools:defaults.bzl\", _karma_web_test_suite = \"karma_web_test_suite\")\n \n def karma_web_test_suite(name, **kwargs):\n-    test_deps = kwargs.get(\"deps\", [])\n-    kwargs[\"deps\"] = [\"%s_bundle\" % name]\n-\n-    # TODO(ESM): Remove this when devmode & prodmode are combined.\n-    extract_js_module_output(\n-        name = \"%s_prodmode_deps\" % name,\n-        deps = test_deps,\n-        provider = \"JSEcmaScriptModuleInfo\",\n-        forward_linker_mappings = True,\n-        include_external_npm_packages = True,\n-        include_default_files = False,\n-        include_declarations = True,\n-        testonly = True,\n-    )\n-\n-    spec_bundle(\n-        name = \"%s_bundle\" % name,\n-        deps = [\"%s_prodmode_deps\" % name],\n-        platform = \"browser\",\n-        run_angular_linker = True,\n-        # We consume the Angular framework packages directly from source. The\n-        # placeholders might not be substituted and still use `0.0.0-PLACEHOLDER`.\n-        linker_unknown_declaration_handling = \"ignore\",\n-        workspace_name = \"angular\",\n-    )\n-\n     # Set up default browsers if no explicit `browsers` have been specified.\n     if not hasattr(kwargs, \"browsers\"):\n         kwargs[\"tags\"] = [\"native\"] + kwargs.get(\"tags\", [])\n@@ -44,8 +16,5 @@ def karma_web_test_suite(name, **kwargs):\n     # Default test suite with all configured browsers.\n     _karma_web_test_suite(\n         name = name,\n-        bootstrap = [\n-            \"@npm//:node_modules/tslib/tslib.js\",\n-        ],\n         **kwargs\n     )\n\n---\n file path A: devtools/tools/esbuild/BUILD.bazel | file path B: devtools/tools/esbuild/BUILD.bazel\n\n@@ -1,11 +1,16 @@\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n load(\"//tools:defaults.bzl\", \"esbuild_config\")\n load(\":index.bzl\", \"create_angular_bundle_targets\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-esbuild_config(\n+js_library(\n     name = \"esbuild_base\",\n-    config_file = \"esbuild-base.config.mjs\",\n+    srcs = [\"esbuild-base.config.mjs\"],\n+    deps = [\n+        \"//packages/compiler-cli/private\",\n+        \"@npm//@angular/build-tooling/shared-scripts/angular-optimization:js_lib\",\n+    ],\n )\n \n esbuild_config(\n@@ -13,7 +18,7 @@ esbuild_config(\n     config_file = \"esbuild-esm.config.mjs\",\n     deps = [\n         \":esbuild_base\",\n-        \"@npm//@angular/build-tooling/shared-scripts/angular-linker:js_lib\",\n+        \"@npm//@angular/build-tooling/shared-scripts/angular-optimization:js_lib\",\n     ],\n )\n \n@@ -22,9 +27,6 @@ esbuild_config(\n     config_file = \"esbuild-esm-prod.config.mjs\",\n     deps = [\n         \":esbuild_base\",\n-        \"//packages/compiler-cli/private\",\n-        \"@npm//@angular/build-tooling/shared-scripts/angular-linker:js_lib\",\n-        \"@npm//@angular/build-tooling/shared-scripts/angular-optimization:js_lib\",\n     ],\n )\n \n@@ -42,7 +44,6 @@ esbuild_config(\n     config_file = \"esbuild-spec.config.mjs\",\n     deps = [\n         \":esbuild_base\",\n-        \"@npm//@angular/build-tooling/shared-scripts/angular-linker:js_lib\",\n     ],\n )\n \n\n---\n file path A: devtools/tools/esbuild/esbuild-base.config.mjs | file path B: devtools/tools/esbuild/esbuild-base.config.mjs\n\n@@ -6,10 +6,57 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-export default {\n-  resolveExtensions: ['.mjs', '.js'],\n-  // This ensures that we prioritize ES2020. RxJS would otherwise use the ESM5 output.\n-  mainFields: ['es2020', 'es2015', 'module', 'main'],\n-  // `tslib` sets the `module` condition to resolve to ESM.\n-  conditions: ['es2020', 'es2015', 'module']\n-};\n+import {createEsbuildAngularOptimizePlugin} from '@angular/build-tooling/shared-scripts/angular-optimization/esbuild-plugin.mjs';\n+import {GLOBAL_DEFS_FOR_TERSER_WITH_AOT} from '@angular/compiler-cli/private/tooling.js';\n+\n+/** Converts an object to a string dictionary. */\n+function convertObjectToStringDictionary(value) {\n+  return Object.entries(value).reduce((result, [propName, value]) => {\n+    result[propName] = String(value);\n+    return result;\n+  }, {});\n+}\n+\n+export default async function createConfig({enableLinker, optimize}) {\n+  return {\n+    resolveExtensions: ['.mjs', '.js'],\n+    // This ensures that we prioritize ES2020. RxJS would otherwise use the ESM5 output.\n+    mainFields: ['es2020', 'es2015', 'module', 'main'],\n+    // `tslib` sets the `module` condition to resolve to ESM.\n+    conditions: ['es2020', 'es2015', 'module'],\n+    supported: {\n+      // Downlevel native `async/await` so that ZoneJS can intercept it.\n+      'async-await': false,\n+    },\n+    define: optimize ? convertObjectToStringDictionary(GLOBAL_DEFS_FOR_TERSER_WITH_AOT) : undefined,\n+    plugins: [\n+      await createEsbuildAngularOptimizePlugin({\n+        optimize: {\n+          isSideEffectFree: null,\n+        },\n+        downlevelAsyncGeneratorsIfPresent: true,\n+        enableLinker: enableLinker\n+          ? {\n+              ensureNoPartialDeclaration: false,\n+              // Only run the linker on `fesm2020/` bundles. This should not have an effect on\n+              // the bundle output, but helps speeding up ESBuild when it visits other modules.\n+              filterPaths: /fesm2020/,\n+              linkerOptions: {\n+                // DevTools relies on angular framework packages that are consumed,\n+                // locally via bazel. These packages have a version of 0.0.0-PLACEHOLDER.\n+                // DevTools also relies on Angular CDK and Material packages that are consumed via npm.\n+                // Because of this, we set unknownDeclarationVersionHandling to ignore so that we bypass\n+                // selecting a linker for our CDK and Material dependencies based on our local framework\n+                // version (0.0.0-PLACEHOLDER).\n+                // Instead this option defaults to the latest linker version, which should\n+                // be correct, except for the small time interval where we rollout a new\n+                // declaration version and target a material release that hasn't been compiled\n+                // with that version yet.\n+                unknownDeclarationVersionHandling: 'ignore',\n+              },\n+            }\n+          : undefined,\n+      }),\n+    ],\n+  };\n+}\n\n---\n file path A: devtools/tools/esbuild/esbuild-esm-prod.config.mjs | file path B: devtools/tools/esbuild/esbuild-esm-prod.config.mjs\n\n@@ -6,42 +6,9 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import { createLinkerEsbuildPlugin } from '@angular/build-tooling/shared-scripts/angular-linker/esbuild-plugin.mjs';\n-import { createEsbuildAngularOptimizePlugin } from '@angular/build-tooling/shared-scripts/angular-optimization/esbuild-plugin.mjs';\n-import { GLOBAL_DEFS_FOR_TERSER_WITH_AOT } from '@angular/compiler-cli/private/tooling.js';\n-import baseEsbuildConfig from './esbuild-base.config.mjs';\n+import createConfig from './esbuild-base.config.mjs';\n \n export default {\n-  ...baseEsbuildConfig,\n+  ...createConfig({enableLinker: true, optimize: true}),\n   format: 'esm',\n-  plugins: [\n-    // Only run the linker on `fesm2020/` bundles. This should not have an effect on\n-    // the bundle output, but helps speeding up ESBuild when it visits other modules.\n-    await createLinkerEsbuildPlugin(\n-      /fesm2020/,\n-      /* ensureNoPartialDeclaration */ false,\n-\n-      // DevTools relies on angular framework packages that are consumed,\n-      // locally via bazel. These packages have a version of 0.0.0-PLACEHOLDER.\n-      // DevTools also relies on Angular CDK and Material packages that are consumed via npm.\n-      // Because of this, we set unknownDeclarationVersionHandling to ignore so that we bypass\n-      // selecting a linker for our CDK and Material dependencies based on our local framework\n-      // version (0.0.0-PLACEHOLDER).\n-      // Instead this option defaults to the latest linker version, which should\n-      // be correct, except for the small time interval where we rollout a new\n-      // declaration version and target a material release that hasn't been compiled\n-      // with that version yet.\n-      { unknownDeclarationVersionHandling: 'ignore' }\n-    ),\n-    await createEsbuildAngularOptimizePlugin()\n-  ],\n-  define: convertObjectToStringDictionary(GLOBAL_DEFS_FOR_TERSER_WITH_AOT),\n };\n-\n-/** Converts an object to a string dictionary. */\n-function convertObjectToStringDictionary(value) {\n-  return Object.entries(value).reduce((result, [propName, value]) => {\n-    result[propName] = String(value);\n-    return result;\n-  }, {});\n-}\n\n---\n file path A: devtools/tools/esbuild/esbuild-esm.config.mjs | file path B: devtools/tools/esbuild/esbuild-esm.config.mjs\n\n@@ -6,30 +6,9 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {createLinkerEsbuildPlugin} from '@angular/build-tooling/shared-scripts/angular-linker/esbuild-plugin.mjs';\n-import baseEsbuildConfig from './esbuild-base.config.mjs';\n+import createConfig from './esbuild-base.config.mjs';\n \n export default {\n-  ...baseEsbuildConfig,\n+  ...createConfig({enableLinker: true, optimize: false}),\n   format: 'esm',\n-  plugins: [\n-    // Only run the linker on `fesm2020/` bundles. This should not have an effect on\n-    // the bundle output, but helps speeding up ESBuild when it visits other modules.\n-    await createLinkerEsbuildPlugin(\n-      /fesm2020/,\n-      /* ensureNoPartialDeclaration */ false,\n-\n-      // DevTools relies on angular framework packages that are consumed,\n-      // locally via bazel. These packages have a version of 0.0.0-PLACEHOLDER.\n-      // DevTools also relies on Angular CDK and Material packages that are consumed via npm.\n-      // Because of this, we set unknownDeclarationVersionHandling to ignore so that we bypass\n-      // selecting a linker for our CDK and Material dependencies based on our local framework\n-      // version (0.0.0-PLACEHOLDER).\n-      // Instead this option defaults to the latest linker version, which should\n-      // be correct, except for the small time interval where we rollout a new\n-      // declaration version and target a material release that hasn't been compiled\n-      // with that version yet.\n-      { unknownDeclarationVersionHandling: 'ignore' }\n-    ),\n-  ],\n };\n\n---\n file path A: devtools/tools/esbuild/esbuild-iife.config.mjs | file path B: devtools/tools/esbuild/esbuild-iife.config.mjs\n\n@@ -6,9 +6,9 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import baseEsbuildConfig from './esbuild-base.config.mjs';\n+import createConfig from './esbuild-base.config.mjs';\n \n export default {\n-  ...baseEsbuildConfig,\n-  format: 'iife'\n+  ...createConfig({enableLinker: false, optimize: false}),\n+  format: 'iife',\n };\n\n---\n file path A: devtools/tools/esbuild/esbuild-spec.config.mjs | file path B: devtools/tools/esbuild/esbuild-spec.config.mjs\n\n@@ -6,46 +6,11 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import baseEsbuildConfig from './esbuild-base.config.mjs';\n-\n-/**\n- * Loads and creates the ESBuild linker plugin.\n- *\n- * The plugin is not loaded at top-level as not all spec bundle targets rely\n- * on the linker and this would slow-down bundling.\n- */\n- async function fetchAndCreateLinkerEsbuildPlugin() {\n-  // Note: This needs to be a NPM module path as this ESBuild config is generated and can\n-  // end up in arbitrary Bazel packages or differently-named consumer workspaces.\n-  const {createLinkerEsbuildPlugin} = await import(\n-    '@angular/build-tooling/shared-scripts/angular-linker/esbuild-plugin.mjs'\n-  );\n-\n-  return await createLinkerEsbuildPlugin(\n-    /.*/,\n-    /* ensureNoPartialDeclaration */ true,\n-\n-    // DevTools relies on angular framework packages that are consumed,\n-    // locally via bazel. These packages have a version of 0.0.0-PLACEHOLDER.\n-    // DevTools also relies on Angular CDK and Material packages that are consumed via npm.\n-    // Because of this, we set unknownDeclarationVersionHandling to ignore so that we bypass\n-    // selecting a linker for our CDK and Material dependencies based on our local framework\n-    // version (0.0.0-PLACEHOLDER).\n-    // Instead this option defaults to the latest linker version, which should\n-    // be correct, except for the small time interval where we rollout a new\n-    // declaration version and target a Material release that hasn't been compiled\n-    // with that version yet\n-    { unknownDeclarationVersionHandling: 'ignore' }\n-  );\n-}\n-\n-// Based on the Bazel action and its substitutions, we run the linker for all inputs.\n-const plugins = [await fetchAndCreateLinkerEsbuildPlugin()];\n+import createConfig from './esbuild-base.config.mjs';\n \n export default {\n-  ...baseEsbuildConfig,\n+  ...createConfig({enableLinker: true, optimize: false}),\n   // Use the `iife` format for the test entry-point as tests should run immediately.\n   // For browser tests which are wrapped in an AMD header and footer, this works as well.\n   format: 'iife',\n-  plugins,\n };\n\n---\n file path A: tools/defaults.bzl | file path B: tools/defaults.bzl\n\n@@ -295,7 +295,14 @@ def pkg_npm(name, validate = True, use_prodmode_output = False, **kwargs):\n         visibility = visibility,\n     )\n \n-def karma_web_test_suite(name, external = [], **kwargs):\n+def karma_web_test_suite(\n+        name,\n+        external = [],\n+        browsers = [\n+            \"@npm//@angular/build-tooling/bazel/browsers/chromium:chromium\",\n+            \"@npm//@angular/build-tooling/bazel/browsers/firefox:firefox\",\n+        ],\n+        **kwargs):\n     \"\"\"Default values for karma_web_test_suite\"\"\"\n \n     # Default value for bootstrap\n@@ -322,10 +329,7 @@ def karma_web_test_suite(name, external = [], **kwargs):\n     _karma_web_test_suite(\n         name = name,\n         deps = [\":%s_bundle\" % name],\n-        browsers = [\n-            \"@npm//@angular/build-tooling/bazel/browsers/chromium:chromium\",\n-            \"@npm//@angular/build-tooling/bazel/browsers/firefox:firefox\",\n-        ],\n+        browsers = browsers,\n         data = data,\n         tags = tags,\n         **kwargs\n\n\n###\n\n", "completion": "refactor: simplify devtools setup given recent ESM changes (#<issue-num>)"}
{"prompt": " file path A: package.json | file path B: package.json\n\n@@ -179,7 +179,7 @@\n   },\n   \"// 2\": \"devDependencies are not used under Bazel. Many can be removed after test.sh is deleted.\",\n   \"devDependencies\": {\n-    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#e1aec534818208328b29a76cfe9892c2a031ed94\",\n+    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#700b36f4887bdd4c82332f7ce0e407d19cd9a644\",\n     \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#05278122c48e06eff8e5398d59c49ed6688c949b\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n     \"@bazel/buildifier\": \"^5.0.0\",\n\n---\n file path A: tools/esm-interop/esm-extension-loader.mjs | file path B: tools/esm-interop/esm-extension-loader.mjs\n\n@@ -8,6 +8,7 @@\n \n const explicitExtensionRe = /\\.[mc]?js$/;\n const explicitJsExtensionRe = /\\.js$/;\n+const builtinNamespaceImportRe = /^node:/;\n \n /*\n  * NodeJS resolver that enables the interop with the current Bazel setup.\n@@ -34,7 +35,9 @@ export async function resolve(specifier, context, nextResolve) {\n     interopAttempts.push(specifier.replace(explicitJsExtensionRe, '.mjs'));\n   }\n \n-  if (!explicitExtensionRe.test(specifier)) {\n+  // If there is no explicit extension and we are not dealing with a\n+  // builtin namespace module, attempt various subpaths to prioritize ESM.\n+  if (!explicitExtensionRe.test(specifier) && !builtinNamespaceImportRe.test(specifier)) {\n     interopAttempts.push(`${specifier}.mjs`);\n     interopAttempts.push(`${specifier}/index.mjs`);\n     // Last attempts are normal `.js` extensions. These could still\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -149,9 +149,9 @@\n     \"@angular/core\" \"^13.0.0 || ^14.0.0-0\"\n     reflect-metadata \"^0.1.13\"\n \n-\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#e1aec534818208328b29a76cfe9892c2a031ed94\":\n-  version \"0.0.0-30acfb31077ddc552b6be501516833ec234ce5c1\"\n-  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#e1aec534818208328b29a76cfe9892c2a031ed94\"\n+\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#700b36f4887bdd4c82332f7ce0e407d19cd9a644\":\n+  version \"0.0.0-bc7bf8bfc84492f04d18dc1cbf4b7547e51c3786\"\n+  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#700b36f4887bdd4c82332f7ce0e407d19cd9a644\"\n   dependencies:\n     \"@angular-devkit/build-angular\" \"15.1.0-next.2\"\n     \"@angular/benchpress\" \"0.3.0\"\n\n\n###\n\n", "completion": "build: update dev-infra build tooling and properly handle builtin `node:` imports (#<issue-num>)"}
{"prompt": " file path A: tools/esm-interop/esm-node-module-loader.mjs | file path B: tools/esm-interop/esm-node-module-loader.mjs\n\n@@ -37,6 +37,14 @@ export async function resolve(specifier, context, nextResolve) {\n     return nextResolve(specifier, context);\n   }\n \n+  // Attempt the next (or builtin) resolution first.\n+  let nextResolveError = null;\n+  try {\n+    return await nextResolve(specifier, context);\n+  } catch (e) {\n+    nextResolveError = e;\n+  }\n+\n   const packageImport = parsePackageImport(specifier);\n   const pathToNodeModule = path.join(nodeModulesPath, packageImport.packageName);\n \n@@ -58,8 +66,8 @@ export async function resolve(specifier, context, nextResolve) {\n     return localMappingResult;\n   }\n \n-  // Process built-in modules or unknown specifiers.\n-  return nextResolve(specifier, context);\n+  // Re-throw the next resolve error if the we couldn't find the module.\n+  throw nextResolveError;\n }\n \n /** Gets whether the specifier refers to a module. */\n\n\n###\n\n", "completion": "build: always attempt next/builtin resolution first when resolving modules (#<issue-num>)"}
{"prompt": " file path A: tools/esm-interop/patches/npm/@bazel+esbuild+5.7.1.patch | file path B: tools/esm-interop/patches/npm/@bazel+esbuild+5.7.1.patch\n\n@@ -6,7 +6,7 @@ index 7d84b1d..d008b4b 100755\n -exports_files([\"launcher.js\"])\n +exports_files([\"launcher.mjs\"])\n diff --git a/node_modules/@bazel/esbuild/esbuild.bzl b/node_modules/@bazel/esbuild/esbuild.bzl\n-index 9600076..5a69c8d 100755\n+index 9600076..8a0cace 100755\n --- a/node_modules/@bazel/esbuild/esbuild.bzl\n +++ b/node_modules/@bazel/esbuild/esbuild.bzl\n @@ -4,7 +4,7 @@ esbuild rule\n@@ -18,12 +18,13 @@ index 9600076..5a69c8d 100755\n  load(\"@build_bazel_rules_nodejs//:providers.bzl\", \"ExternalNpmPackageInfo\", \"JSEcmaScriptModuleInfo\", \"node_modules_aspect\", \"run_node\")\n  load(\"@build_bazel_rules_nodejs//internal/linker:link_node_modules.bzl\", \"LinkerPackageMappingInfo\", \"module_mappings_aspect\")\n  load(\"@build_bazel_rules_nodejs//internal/common:expand_variables.bzl\", \"expand_variables\")\n-@@ -420,7 +420,7 @@ def esbuild_macro(name, output_dir = False, splitting = False, **kwargs):\n+@@ -420,7 +420,8 @@ def esbuild_macro(name, output_dir = False, splitting = False, **kwargs):\n      _launcher = \"_%s_esbuild_launcher\" % name\n      nodejs_binary(\n          name = _launcher,\n -        entry_point = Label(\"//@bazel/esbuild:launcher.js\"),\n +        entry_point = Label(\"//@bazel/esbuild:launcher.mjs\"),\n++        linker_enabled = True,\n      )\n  \n      srcs = kwargs.pop(\"srcs\", [])\n\n\n###\n\n", "completion": "build: ensure esbuild `nodejs_binary` correctly wires up ESM loader (#<issue-num>)"}
{"prompt": " file path A: packages/elements/test/BUILD.bazel | file path B: packages/elements/test/BUILD.bazel\n\n@@ -3,7 +3,7 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/elements/index.js\",\n+    entry_point = \"angular/packages/elements/index.mjs\",\n     deps = [\"//packages/elements\"],\n )\n \n\n\n###\n\n", "completion": "refactor: update `elements` test to work with ESM outputs (#<issue-num>)"}
{"prompt": " file path A: packages/forms/test/BUILD.bazel | file path B: packages/forms/test/BUILD.bazel\n\n@@ -1,9 +1,9 @@\n-load(\"//tools:defaults.bzl\", \"jasmine_node_test\", \"karma_web_test_suite\", \"ts_library\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\", \"ts_library\", \"zone_compatible_jasmine_node_test\")\n load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/forms/index.js\",\n+    entry_point = \"angular/packages/forms/index.mjs\",\n     deps = [\"//packages/forms\"],\n )\n \n@@ -25,7 +25,9 @@ ts_library(\n     ],\n )\n \n-jasmine_node_test(\n+# Tests rely on `async/await` for a `waitForAsync` test.\n+# This syntax needs to be downleveled until ZoneJS supports it.\n+zone_compatible_jasmine_node_test(\n     name = \"test\",\n     bootstrap = [\"//tools/testing:node\"],\n     deps = [\n\n\n###\n\n", "completion": "refactor: update `forms` package tests to work with ES2020 ESM (#<issue-num>)"}
{"prompt": " file path A: packages/upgrade/src/common/test/BUILD.bazel | file path B: packages/upgrade/src/common/test/BUILD.bazel\n\n@@ -3,7 +3,7 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/upgrade/index.js\",\n+    entry_point = \"angular/packages/upgrade/index.mjs\",\n     deps = [\"//packages/upgrade\"],\n )\n \n\n---\n file path A: packages/upgrade/static/test/BUILD.bazel | file path B: packages/upgrade/static/test/BUILD.bazel\n\n@@ -3,7 +3,7 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/upgrade/static/index.js\",\n+    entry_point = \"angular/packages/upgrade/static/index.mjs\",\n     deps = [\"//packages/upgrade/static\"],\n )\n \n\n---\n file path A: packages/upgrade/static/testing/test/BUILD.bazel | file path B: packages/upgrade/static/testing/test/BUILD.bazel\n\n@@ -1,11 +1,11 @@\n-package(default_visibility = [\"//visibility:public\"])\n-\n load(\"//tools:defaults.bzl\", \"karma_web_test_suite\", \"ts_library\")\n load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n+package(default_visibility = [\"//visibility:public\"])\n+\n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/upgrade/static/testing/index.js\",\n+    entry_point = \"angular/packages/upgrade/static/testing/index.mjs\",\n     deps = [\"//packages/upgrade/static/testing\"],\n )\n \n\n\n###\n\n", "completion": "refactor: update `upgrade` package tests to work with ESM output (#<issue-num>)"}
{"prompt": " file path A: packages/platform-browser-dynamic/test/BUILD.bazel | file path B: packages/platform-browser-dynamic/test/BUILD.bazel\n\n@@ -3,7 +3,7 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/platform-browser-dynamic/index.js\",\n+    entry_point = \"angular/packages/platform-browser-dynamic/index.mjs\",\n     deps = [\"//packages/platform-browser-dynamic\"],\n )\n \n\n\n###\n\n", "completion": "refactor: update `platform-browser-dynamic` to work with ESM output (#<issue-num>)"}
{"prompt": " file path A: packages/platform-server/init/test/BUILD.bazel | file path B: packages/platform-server/init/test/BUILD.bazel\n\n@@ -3,7 +3,7 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/platform-server/init/index.js\",\n+    entry_point = \"angular/packages/platform-server/init/index.mjs\",\n     deps = [\"//packages/platform-server/init\"],\n )\n \n@@ -13,6 +13,7 @@ ts_library(\n     srcs = glob([\"**/*.ts\"]),\n     deps = [\n         \"//packages/platform-server/init\",\n+        \"@npm//domino\",\n     ],\n )\n \n\n---\n file path A: packages/platform-server/init/test/shims_spec.ts | file path B: packages/platform-server/init/test/shims_spec.ts\n\n@@ -5,12 +5,11 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n+import domino from 'domino';\n+\n import {applyShims} from '../src/shims';\n \n describe('applyShims()', () => {\n-  if (isBrowser) return;  // NODE only\n-\n-  const domino = require('domino');\n   const globalClone = {...global};\n \n   afterEach(() => {\n\n---\n file path A: packages/platform-server/test/BUILD.bazel | file path B: packages/platform-server/test/BUILD.bazel\n\n@@ -3,13 +3,13 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/platform-server/index.js\",\n+    entry_point = \"angular/packages/platform-server/index.mjs\",\n     deps = [\"//packages/platform-server\"],\n )\n \n circular_dependency_test(\n     name = \"testing_circular_deps_test\",\n-    entry_point = \"angular/packages/platform-server/testing/index.js\",\n+    entry_point = \"angular/packages/platform-server/testing/index.mjs\",\n     deps = [\"//packages/platform-server/testing\"],\n )\n \n\n\n###\n\n", "completion": "refactor: update `platform-server` tests to work with ESM (#<issue-num>)"}
{"prompt": " file path A: tools/defaults.bzl | file path B: tools/defaults.bzl\n\n@@ -359,11 +359,19 @@ def karma_web_test_suite(name, external = [], **kwargs):\n         **kwargs\n     )\n \n-def protractor_web_test_suite(**kwargs):\n+def protractor_web_test_suite(name, deps = [], **kwargs):\n     \"\"\"Default values for protractor_web_test_suite\"\"\"\n+    spec_bundle(\n+        name = \"%s_bundle\" % name,\n+        deps = deps,\n+        platform = \"cjs-legacy\",\n+        external = [\"protractor\"],\n+    )\n \n     _protractor_web_test_suite(\n+        name = name,\n         browsers = [\"@npm//@angular/build-tooling/bazel/browsers/chromium:chromium\"],\n+        deps = [\":%s_bundle\" % name],\n         **kwargs\n     )\n \n@@ -418,9 +426,9 @@ def npm_package_bin(args = [], **kwargs):\n         **kwargs\n     )\n \n-    # TODO(devversion): Jasmine Node tests are only bundled using `spec_bundle`\n-    # because `async/await` syntax needs to be downleveled for ZoneJS. In the\n-    # future this can be removed when ZoneJS can work with native async/await in NodeJS.\n+# TODO(devversion): Jasmine Node tests are only bundled using `spec_bundle`\n+# because `async/await` syntax needs to be downleveled for ZoneJS. In the\n+# future this can be removed when ZoneJS can work with native async/await in NodeJS.\n def zone_compatible_jasmine_node_test(name, external = [], deps = [], bootstrap = [], **kwargs):\n     spec_bundle(\n         name = \"%s_bundle\" % name,\n\n\n###\n\n", "completion": "build: bundle tests for protractor tests to support ESM output (#<issue-num>)"}
{"prompt": " file path A: packages/platform-server/BUILD.bazel | file path B: packages/platform-server/BUILD.bazel\n\n@@ -24,6 +24,7 @@ ng_module(\n         \"@npm//@types/node\",\n         \"@npm//domino\",\n         \"@npm//rxjs\",\n+        \"@npm//xhr2\",\n     ],\n )\n \n\n---\n file path A: tools/testing/BUILD.bazel | file path B: tools/testing/BUILD.bazel\n\n@@ -8,6 +8,7 @@ ts_library(\n     srcs = [\"zone_base_setup.ts\"],\n     deps = [\n         \"//packages/zone.js/lib\",\n+        \"@npm//reflect-metadata\",\n     ],\n )\n \n\n\n###\n\n", "completion": "build: add missing dependencies to platform-server and tools/testing (#<issue-num>)"}
{"prompt": " file path A: packages/router/test/BUILD.bazel | file path B: packages/router/test/BUILD.bazel\n\n@@ -1,15 +1,15 @@\n-load(\"//tools:defaults.bzl\", \"jasmine_node_test\", \"karma_web_test_suite\", \"ts_library\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\", \"ts_library\", \"zone_compatible_jasmine_node_test\")\n load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/router/index.js\",\n+    entry_point = \"angular/packages/router/index.mjs\",\n     deps = [\"//packages/router\"],\n )\n \n circular_dependency_test(\n     name = \"testing_circular_deps_test\",\n-    entry_point = \"angular/packages/router/testing/index.js\",\n+    entry_point = \"angular/packages/router/testing/index.mjs\",\n     deps = [\"//packages/router/testing\"],\n )\n \n@@ -34,7 +34,9 @@ ts_library(\n     ],\n )\n \n-jasmine_node_test(\n+# Tests rely on `async/await` for change detection.\n+# This syntax needs to be downleveled until ZoneJS supports it.\n+zone_compatible_jasmine_node_test(\n     name = \"test\",\n     bootstrap = [\"//tools/testing:node\"],\n     deps = [\n\n---\n file path A: packages/router/upgrade/test/BUILD.bazel | file path B: packages/router/upgrade/test/BUILD.bazel\n\n@@ -3,7 +3,7 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/router/upgrade/index.js\",\n+    entry_point = \"angular/packages/router/upgrade/index.mjs\",\n     deps = [\"//packages/router/upgrade\"],\n )\n \n\n\n###\n\n", "completion": "refactor: update `packages/router` tests to be compatible with ESM (#<issue-num>)"}
{"prompt": " file path A: tools/defaults.bzl | file path B: tools/defaults.bzl\n\n@@ -418,6 +418,26 @@ def npm_package_bin(args = [], **kwargs):\n         **kwargs\n     )\n \n+    # TODO(devversion): Jasmine Node tests are only bundled using `spec_bundle`\n+    # because `async/await` syntax needs to be downleveled for ZoneJS. In the\n+    # future this can be removed when ZoneJS can work with native async/await in NodeJS.\n+def zone_compatible_jasmine_node_test(name, external = [], deps = [], bootstrap = [], **kwargs):\n+    spec_bundle(\n+        name = \"%s_bundle\" % name,\n+        # Specs from this attribute are filtered and will be executed. We\n+        # add bootstrap here for discovery of the module mappings aspect.\n+        deps = deps + bootstrap,\n+        bootstrap = bootstrap,\n+        external = external + [\"domino\", \"typescript\"],\n+        platform = \"node\",\n+    )\n+\n+    jasmine_node_test(\n+        name = name,\n+        deps = [\":%s_bundle\" % name],\n+        **kwargs\n+    )\n+\n def jasmine_node_test(name, srcs = [], data = [], bootstrap = [], env = {}, **kwargs):\n     # Very common dependencies for tests\n     deps = kwargs.pop(\"deps\", []) + [\n\n\n###\n\n", "completion": "build: introduce `zone_compatible_jasmine_node_test` rule (#<issue-num>)"}
{"prompt": " file path A: packages/core/test/bundling/image-directive/BUILD.bazel | file path B: packages/core/test/bundling/image-directive/BUILD.bazel\n\n@@ -1,4 +1,4 @@\n-load(\"//tools:defaults.bzl\", \"app_bundle\", \"ng_module\", \"protractor_web_test_suite\", \"ts_devserver\", \"ts_library\")\n+load(\"//tools:defaults.bzl\", \"esbuild\", \"http_server\", \"ng_module\", \"protractor_web_test_suite\", \"ts_library\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -22,7 +22,9 @@ ng_module(\n     ],\n )\n \n-app_bundle(\n+# Note: Cannot use `app_bundle` as the e2e tests rely on `ngDevMode`\n+# output which would otherwise be omitted.\n+esbuild(\n     name = \"bundle\",\n     entry_point = \":index.ts\",\n     deps = [\n@@ -35,35 +37,19 @@ app_bundle(\n     ],\n )\n \n-genrule(\n-    name = \"tslib\",\n-    srcs = [\n-        \"@npm//:node_modules/tslib/tslib.js\",\n-    ],\n-    outs = [\n-        \"tslib.js\",\n-    ],\n-    cmd = \"cp $< $@\",\n-)\n-\n-ts_devserver(\n+http_server(\n     name = \"devserver\",\n-    bootstrap = [\"//packages/zone.js/bundles:zone.umd.js\"],\n-    entry_module = \"@angular/core/test/bundling/image-directive\",\n-    port = 4200,\n-    scripts = [\n-        \"//tools/rxjs:rxjs_umd_modules\",\n-    ],\n-    serving_path = \"/bundle.min.js\",\n-    static_files = [\n-        \"index.html\",\n-        \":tslib\",\n+    srcs = [\n         \"e2e/a.png\",\n         \"e2e/b.png\",\n-        \"e2e/logo-500w.jpg\",\n         \"e2e/logo-1500w.jpg\",\n+        \"e2e/logo-500w.jpg\",\n+        \"index.html\",\n+    ],\n+    deps = [\n+        \":bundle\",\n+        \"//packages/zone.js/bundles:zone.umd.js\",\n     ],\n-    deps = [\":image-directive\"],\n )\n \n ts_library(\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/start-server.js | file path B: packages/core/test/bundling/image-directive/e2e/start-server.js\n\n@@ -14,7 +14,7 @@ const protractor = require('protractor');\n  * Used as a part of the `protractor_web_test_suite` rule configuration.\n  */\n module.exports = async function(config) {\n-  const {port} = await protractorUtils.runServer(config.workspace, config.server, '-port', []);\n+  const {port} = await protractorUtils.runServer(config.workspace, config.server, '--port', []);\n   const serverUrl = `http://localhost:${port}`;\n \n   protractor.browser.baseUrl = serverUrl;\n\n---\n file path A: packages/core/test/bundling/image-directive/index.html | file path B: packages/core/test/bundling/image-directive/index.html\n\n@@ -10,24 +10,7 @@\n \n     <app-root></app-root>\n \n-    <!--\n-      Script tag which bootstraps the application. Use `?debug` in URL to select\n-      the debug version of the script.\n-\n-      There are two scripts sources: `bundle.min.js` and `bundle.debug.min.js` You can\n-      switch between which bundle the browser loads to experiment with the application.\n-\n-      - `bundle.min.js`: Is what the site would serve to their users. It has gone\n-        through rollup, build-optimizer, and uglify with tree shaking.\n-      - `bundle.debug.min.js`: Is what the developer would like to see when debugging\n-        the application. It has also gone through full pipeline of esbuild, babel optimization,\n-        plugins from the devkit and terser, however mangling is disabled and the minified\n-        file is formatted using prettier (to ease debugging).\n-    -->\n-    <script>\n-        document.write('<script src=\"' +\n-          (document.location.search.endsWith('debug') ? '/bundle.debug.min.js' : '/bundle.min.js') +\n-          '\"></' + 'script>');\n-    </script>\n+    <script src=\"angular/packages/zone.js/bundles/zone.umd.js\"></script>\n+    <script src=\"bundle.js\"></script>\n   </body>\n </html>\n\n\n###\n\n", "completion": "refactor: update image-directive e2e test to work with ESM (#<issue-num>)"}
{"prompt": " file path A: karma-js.conf.js | file path B: karma-js.conf.js\n\n@@ -40,7 +40,7 @@ module.exports = function(config) {\n \n       // ZoneJS configuration needed for some event manager tests. This config could\n       // affect all legacy tests but in reality is scoped to certain special tests.\n-      'packages/platform-browser/test/dom/events/zone_event_unpatched_init.js',\n+      'packages/platform-browser/test/dom/events/zone_event_unpatched.init.js',\n \n       // Dependencies built by Bazel. See `config.yml` for steps running before\n       // the legacy Saucelabs tests run.\n@@ -56,7 +56,7 @@ module.exports = function(config) {\n       {\n         pattern: 'node_modules/@webcomponents/custom-elements/**/*.js',\n         included: false,\n-        watched: false\n+        watched: false,\n       },\n \n       'node_modules/reflect-metadata/Reflect.js',\n\n---\n file path A: packages/platform-browser/animations/test/BUILD.bazel | file path B: packages/platform-browser/animations/test/BUILD.bazel\n\n@@ -3,7 +3,7 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/platform-browser/animations/index.js\",\n+    entry_point = \"angular/packages/platform-browser/animations/index.mjs\",\n     deps = [\"//packages/platform-browser/animations\"],\n )\n \n\n---\n file path A: packages/platform-browser/test/BUILD.bazel | file path B: packages/platform-browser/test/BUILD.bazel\n\n@@ -1,3 +1,4 @@\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n load(\"//tools:defaults.bzl\", \"jasmine_node_test\", \"karma_web_test_suite\", \"ts_library\")\n load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n@@ -8,13 +9,13 @@ exports_files([\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/platform-browser/index.js\",\n+    entry_point = \"angular/packages/platform-browser/index.mjs\",\n     deps = [\"//packages/platform-browser\"],\n )\n \n circular_dependency_test(\n     name = \"testing_circular_deps_test\",\n-    entry_point = \"angular/packages/platform-browser/testing/index.js\",\n+    entry_point = \"angular/packages/platform-browser/testing/index.mjs\",\n     deps = [\"//packages/platform-browser/testing\"],\n )\n \n@@ -40,6 +41,11 @@ ts_library(\n     ],\n )\n \n+js_library(\n+    name = \"zone_event_unpatched_init_lib\",\n+    srcs = [\"dom/events/zone_event_unpatched.init.js\"],\n+)\n+\n jasmine_node_test(\n     name = \"test\",\n     bootstrap = [\"//tools/testing:node\"],\n@@ -51,7 +57,7 @@ jasmine_node_test(\n karma_web_test_suite(\n     name = \"test_web\",\n     bootstrap = [\n-        \"dom/events/zone_event_unpatched_init.js\",\n+        \":zone_event_unpatched_init_lib\",\n     ],\n     static_files = [\n         \":static_assets/test.html\",\n\n---\n file path A: packages/platform-browser/test/dom/events/zone_event_unpatched_init.js | file path B: packages/platform-browser/test/dom/events/zone_event_unpatched.init.js\n\n\n\n###\n\n", "completion": "refactor: update platform-browser tests to run as ESM (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/file_system/src/node_js_file_system.ts | file path B: packages/compiler-cli/src/ngtsc/file_system/src/node_js_file_system.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n /// <reference types=\"node\" />\n-import * as fs from 'fs';\n+import fs from 'fs';\n import module from 'module';\n import * as p from 'path';\n import {fileURLToPath} from 'url';\n\n---\n file path A: packages/compiler-cli/src/ngtsc/file_system/test/node_js_file_system_spec.ts | file path B: packages/compiler-cli/src/ngtsc/file_system/test/node_js_file_system_spec.ts\n\n@@ -9,7 +9,8 @@\n // named exports being modified if we apply jasmine spies on `realFs`. Using\n // the default export gives us an object where we can patch properties on.\n import realFs from 'fs';\n-import * as os from 'os';\n+import os from 'os';\n+import url from 'url';\n \n import {NodeJSFileSystem, NodeJSPathManipulation, NodeJSReadonlyFileSystem} from '../src/node_js_file_system';\n import {AbsoluteFsPath, PathSegment} from '../src/types';\n@@ -57,7 +58,8 @@ describe('NodeJSReadonlyFileSystem', () => {\n \n   describe('isCaseSensitive()', () => {\n     it('should return true if the FS is case-sensitive', () => {\n-      const isCaseSensitive = !realFs.existsSync(__filename.toUpperCase());\n+      const currentFilename = url.fileURLToPath(import.meta.url);\n+      const isCaseSensitive = !realFs.existsSync(currentFilename.toUpperCase());\n       expect(fs.isCaseSensitive()).toEqual(isCaseSensitive);\n     });\n   });\n\n---\n file path A: packages/compiler-cli/src/ngtsc/testing/BUILD.bazel | file path B: packages/compiler-cli/src/ngtsc/testing/BUILD.bazel\n\n@@ -15,6 +15,7 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/file_system/testing\",\n         \"//packages/compiler-cli/src/ngtsc/reflection\",\n         \"//packages/compiler-cli/src/ngtsc/util\",\n+        \"@npm//@bazel/runfiles\",\n         \"@npm//typescript\",\n     ],\n )\n\n---\n file path A: packages/compiler-cli/src/ngtsc/testing/src/mock_file_loading.ts | file path B: packages/compiler-cli/src/ngtsc/testing/src/mock_file_loading.ts\n\n@@ -13,7 +13,7 @@ import {resolve} from 'path';\n import {AbsoluteFsPath, FileSystem, getFileSystem} from '../../file_system';\n import {Folder, MockFileSystemPosix, TestFile} from '../../file_system/testing';\n \n-import {getAngularPackagesFromRunfiles, resolveNpmTreeArtifact} from './runfile_helpers';\n+import {getAngularPackagesFromRunfiles, resolveFromRunfiles} from './runfile_helpers';\n \n export function loadTestFiles(files: TestFile[]) {\n   const fs = getFileSystem();\n@@ -39,9 +39,10 @@ class CachedFolder {\n   }\n }\n \n-const typescriptFolder = new CachedFolder(() => loadFolder(resolveNpmTreeArtifact('typescript')));\n+const typescriptFolder =\n+    new CachedFolder(() => loadFolder(resolveFromRunfiles('npm/node_modules/typescript')));\n const angularFolder = new CachedFolder(loadAngularFolder);\n-const rxjsFolder = new CachedFolder(() => loadFolder(resolveNpmTreeArtifact('rxjs')));\n+const rxjsFolder = new CachedFolder(() => loadFolder(resolveFromRunfiles('npm/node_modules/rxjs')));\n \n export function loadStandardTestFiles(\n     {fakeCore = true, fakeCommon = false, rxjs = false}:\n@@ -72,21 +73,21 @@ export function loadStandardTestFiles(\n \n export function loadTsLib(fs: FileSystem, basePath: string = '/') {\n   loadTestDirectory(\n-      fs, resolveNpmTreeArtifact('tslib'), fs.resolve(basePath, 'node_modules/tslib'));\n+      fs, resolveFromRunfiles('npm/node_modules/tslib'),\n+      fs.resolve(basePath, 'node_modules/tslib'));\n }\n \n export function loadFakeCore(fs: FileSystem, basePath: string = '/') {\n   loadTestDirectory(\n       fs,\n-      resolveNpmTreeArtifact(\n-          'angular/packages/compiler-cli/src/ngtsc/testing/fake_core/npm_package'),\n+      resolveFromRunfiles('angular/packages/compiler-cli/src/ngtsc/testing/fake_core/npm_package'),\n       fs.resolve(basePath, 'node_modules/@angular/core'));\n }\n \n export function loadFakeCommon(fs: FileSystem, basePath: string = '/') {\n   loadTestDirectory(\n       fs,\n-      resolveNpmTreeArtifact(\n+      resolveFromRunfiles(\n           'angular/packages/compiler-cli/src/ngtsc/testing/fake_common/npm_package'),\n       fs.resolve(basePath, 'node_modules/@angular/common'));\n }\n\n---\n file path A: packages/compiler-cli/src/ngtsc/testing/src/runfile_helpers.ts | file path B: packages/compiler-cli/src/ngtsc/testing/src/runfile_helpers.ts\n\n@@ -7,6 +7,7 @@\n  */\n /// <reference types=\"node\" />\n \n+import {runfiles} from '@bazel/runfiles';\n import * as fs from 'fs';\n import * as path from 'path';\n \n@@ -39,11 +40,7 @@ export function getAngularPackagesFromRunfiles() {\n            }));\n }\n \n-/**\n- * Resolves a NPM package from the Bazel runfiles. We need to resolve the Bazel tree\n- * artifacts using a \"resolve file\" because the NodeJS module resolution does not allow\n- * resolving to directory paths.\n- */\n-export function resolveNpmTreeArtifact(manifestPath: string, resolveFile = 'package.json') {\n-  return path.dirname(require.resolve(path.posix.join(manifestPath, resolveFile)));\n+/** Resolves a file or directory from the Bazel runfiles. */\n+export function resolveFromRunfiles(manifestPath: string) {\n+  return runfiles.resolve(manifestPath);\n }\n\n---\n file path A: packages/compiler-cli/test/compliance/linked/linked_compile_spec.ts | file path B: packages/compiler-cli/test/compliance/linked/linked_compile_spec.ts\n\n@@ -5,9 +5,10 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n+import babel, {PluginObj} from '@babel/core';\n+\n import {needsLinking} from '../../../linker';\n import {createEs2015LinkerPlugin} from '../../../linker/babel';\n-import {PluginObj, transformSync} from '../../../linker/babel/src/babel_core';\n import {AbsoluteFsPath, FileSystem} from '../../../src/ngtsc/file_system';\n import {ConsoleLogger, LogLevel} from '../../../src/ngtsc/logging';\n import {MapAndPath, RawSourceMap, SourceFileLoader} from '../../../src/ngtsc/sourcemaps';\n@@ -88,7 +89,7 @@ function applyLinker(\n   if (!filename.endsWith('.js') || !needsLinking(filename, source)) {\n     return {linkedSource: source, linkedSourceMap: sourceMap};\n   }\n-  const result = transformSync(source, {\n+  const result = babel.transformSync(source, {\n     cwd,\n     filename,\n     sourceMaps: !!sourceMap,\n\n---\n file path A: packages/compiler-cli/test/compliance/partial/partial_compliance_goldens.bzl | file path B: packages/compiler-cli/test/compliance/partial/partial_compliance_goldens.bzl\n\n@@ -17,7 +17,8 @@ def partial_compliance_golden(filePath):\n     nodejs_binary(\n         name = generate_partial_name,\n         testonly = True,\n-        data = data + [filePath],\n+        data = data,\n+        data_for_args = [filePath],\n         visibility = [\":__pkg__\"],\n         entry_point = \"//packages/compiler-cli/test/compliance/partial:cli.ts\",\n         templated_args = [\"$(execpath %s)\" % filePath],\n\n---\n file path A: packages/compiler-cli/test/test_support.ts | file path B: packages/compiler-cli/test/test_support.ts\n\n@@ -12,7 +12,7 @@ import ts from 'typescript';\n \n import * as ng from '../index';\n import {NodeJSFileSystem, setFileSystem} from '../src/ngtsc/file_system';\n-import {getAngularPackagesFromRunfiles, resolveNpmTreeArtifact} from '../src/ngtsc/testing';\n+import {getAngularPackagesFromRunfiles, resolveFromRunfiles} from '../src/ngtsc/testing';\n \n // TEST_TMPDIR is always set by Bazel.\n const tmpdir = process.env.TEST_TMPDIR!;\n@@ -132,14 +132,14 @@ export function setupBazelTo(tmpDirPath: string) {\n   });\n \n   // Link typescript\n-  const typeScriptSource = resolveNpmTreeArtifact('npm/node_modules/typescript');\n+  const typeScriptSource = resolveFromRunfiles('npm/node_modules/typescript');\n   const typescriptDest = path.join(nodeModulesPath, 'typescript');\n   fs.symlinkSync(typeScriptSource, typescriptDest, 'junction');\n \n   // Link \"rxjs\" if it has been set up as a runfile. \"rxjs\" is linked optionally because\n   // not all compiler-cli tests need \"rxjs\" set up.\n   try {\n-    const rxjsSource = resolveNpmTreeArtifact('rxjs', 'index.js');\n+    const rxjsSource = resolveFromRunfiles('npm/node_modules/rxjs');\n     const rxjsDest = path.join(nodeModulesPath, 'rxjs');\n     fs.symlinkSync(rxjsSource, rxjsDest, 'junction');\n   } catch (e: any) {\n\n\n###\n\n", "completion": "refactor: update compiler-cli to work with ESM (#<issue-num>)"}
{"prompt": " file path A: packages/compiler/test/BUILD.bazel | file path B: packages/compiler/test/BUILD.bazel\n\n@@ -9,7 +9,7 @@ NODE_ONLY = [\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/compiler/index.js\",\n+    entry_point = \"angular/packages/compiler/index.mjs\",\n     deps = [\"//packages/compiler\"],\n )\n \n\n\n###\n\n", "completion": "build: refactor `packages/compiler/test` to work with ESM (#<issue-num>)"}
{"prompt": " file path A: packages/bazel/test/ng_package/common_package.spec.ts | file path B: packages/bazel/test/ng_package/common_package.spec.ts\n\n@@ -7,9 +7,9 @@\n  */\n \n import {runfiles} from '@bazel/runfiles';\n-import * as fs from 'fs';\n-import * as path from 'path';\n-import * as shx from 'shelljs';\n+import fs from 'fs';\n+import path from 'path';\n+import shx from 'shelljs';\n \n import {matchesObjectWithOrder} from './test_utils';\n \n\n---\n file path A: packages/bazel/test/ng_package/core_package.spec.ts | file path B: packages/bazel/test/ng_package/core_package.spec.ts\n\n@@ -7,8 +7,8 @@\n  */\n \n import {runfiles} from '@bazel/runfiles';\n-import * as path from 'path';\n-import * as shx from 'shelljs';\n+import path from 'path';\n+import shx from 'shelljs';\n \n import {matchesObjectWithOrder} from './test_utils';\n \n\n---\n file path A: packages/bazel/test/ng_package/example_package.spec.ts | file path B: packages/bazel/test/ng_package/example_package.spec.ts\n\n@@ -7,10 +7,10 @@\n  */\n \n import {runfiles} from '@bazel/runfiles';\n-import * as crypto from 'crypto';\n+import crypto from 'crypto';\n import {createPatch} from 'diff';\n-import * as fs from 'fs';\n-import * as path from 'path';\n+import fs from 'fs';\n+import path from 'path';\n \n type TestPackage = {\n   displayName: string; packagePath: string; goldenFilePath: string;\n@@ -147,14 +147,10 @@ function hashFileContents(filePath: string): string {\n   return crypto.createHash('md5').update(fs.readFileSync(filePath)).digest('hex');\n }\n \n-if (require.main === module) {\n-  const args = process.argv.slice(2);\n-  const acceptingNewGold = (args[0] === '--accept');\n-\n-  if (acceptingNewGold) {\n-    for (let p of packagesToTest) {\n-      acceptNewPackageGold(p);\n-    }\n+// This spec file can be invoked as a `nodejs_binary` to update the golden files.\n+if (process.argv.slice(2).includes('--accept')) {\n+  for (let p of packagesToTest) {\n+    acceptNewPackageGold(p);\n   }\n } else {\n   describe('Comparing test packages to golds', () => {\n\n---\n file path A: packages/bazel/test/ngc-wrapped/BUILD.bazel | file path B: packages/bazel/test/ngc-wrapped/BUILD.bazel\n\n@@ -12,6 +12,7 @@ ts_library(\n     deps = [\n         \"//packages/bazel/src/ngc-wrapped:ngc_lib\",\n         \"//packages/compiler-cli\",\n+        \"@npm//@bazel/runfiles\",\n         \"@npm//typescript\",\n     ],\n )\n\n---\n file path A: packages/bazel/test/ngc-wrapped/flat_module_test.ts | file path B: packages/bazel/test/ngc-wrapped/flat_module_test.ts\n\n@@ -25,8 +25,10 @@ describe('flat_module ng_module', () => {\n   });\n \n   describe('flat module out file', () => {\n-    it('should have a proper AMD module name', () => {\n-      expect(readFileSync(flatModuleOutFile, 'utf8')).toContain(`define(\"flat_module\"`);\n+    it('should have a proper flat module re-export', () => {\n+      expect(readFileSync(flatModuleOutFile, 'utf8')).toContain(`export * from './index';`);\n+      expect(readFileSync(flatModuleOutFile, 'utf8'))\n+          .toContain(`Generated bundle index. Do not edit.`);\n     });\n   });\n });\n\n---\n file path A: packages/bazel/test/ngc-wrapped/test_support.ts | file path B: packages/bazel/test/ngc-wrapped/test_support.ts\n\n@@ -7,6 +7,7 @@\n  */\n \n import {runOneBuild} from '@angular/bazel';\n+import {runfiles} from '@bazel/runfiles';\n import * as fs from 'fs';\n import * as path from 'path';\n import ts from 'typescript';\n@@ -46,14 +47,16 @@ export function setup({\n \n   const basePath = makeTempDir(runfilesPath);\n \n+  console.error(basePath);\n+\n   const bazelBinPath = path.resolve(basePath, bazelBin);\n   fs.mkdirSync(bazelBinPath);\n \n-  const angularCorePath = path.dirname(require.resolve('angular/packages/core'));\n+  const angularCorePath = runfiles.resolve('angular/packages/core');\n   const tsConfigJsonPath = path.resolve(basePath, tsconfig);\n \n   const emptyTsConfig = ts.readConfigFile(\n-      require.resolve('angular/packages/bazel/test/ngc-wrapped/empty/empty_tsconfig.json'), read);\n+      runfiles.resolve('angular/packages/bazel/test/ngc-wrapped/empty/empty_tsconfig.json'), read);\n   const typesRoots = (emptyTsConfig as any).config.compilerOptions.typeRoots[0];\n \n   return {\n@@ -134,7 +137,8 @@ export function setup({\n     }\n \n     const emptyTsConfig = ts.readConfigFile(\n-        require.resolve('angular/packages/bazel/test/ngc-wrapped/empty/empty_tsconfig.json'), read);\n+        runfiles.resolve('angular/packages/bazel/test/ngc-wrapped/empty/empty_tsconfig.json'),\n+        read);\n \n     const tsconfig = createTsConfig({\n       defaultTsConfig: emptyTsConfig.config,\n\n---\n file path A: packages/bazel/test/ngc-wrapped/tsconfig_template.ts | file path B: packages/bazel/test/ngc-wrapped/tsconfig_template.ts\n\n@@ -6,6 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {runfiles} from '@bazel/runfiles';\n import * as path from 'path';\n \n const EXT = /(\\.ts|\\.d\\.ts|\\.js|\\.jsx|\\.tsx)$/;\n@@ -71,7 +72,7 @@ export function createTsConfig(options: TsConfigOptions) {\n       // we don't copy the node_modules into our tmp dir, so we should look in\n       // the original workspace directory for it\n       'nodeModulesPrefix':\n-          path.join(require.resolve('npm/node_modules/typescript/package.json'), '../../'),\n+          path.join(runfiles.resolve('npm/node_modules/typescript/package.json'), '../../'),\n     },\n     'files': options.files,\n     'angularCompilerOptions': {\n\n\n###\n\n", "completion": "build: update `packages/bazel/test` to work with ESM (#<issue-num>)"}
{"prompt": " file path A: packages/common/http/test/BUILD.bazel | file path B: packages/common/http/test/BUILD.bazel\n\n@@ -3,7 +3,7 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/common/http/index.js\",\n+    entry_point = \"angular/packages/common/http/index.mjs\",\n     deps = [\"//packages/common/http\"],\n )\n \n\n---\n file path A: packages/common/http/testing/test/BUILD.bazel | file path B: packages/common/http/testing/test/BUILD.bazel\n\n@@ -3,7 +3,7 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/common/http/testing/index.js\",\n+    entry_point = \"angular/packages/common/http/testing/index.mjs\",\n     deps = [\"//packages/common/http/testing\"],\n )\n \n\n---\n file path A: packages/common/test/BUILD.bazel | file path B: packages/common/test/BUILD.bazel\n\n@@ -3,13 +3,13 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/common/index.js\",\n+    entry_point = \"angular/packages/common/index.mjs\",\n     deps = [\"//packages/common\"],\n )\n \n circular_dependency_test(\n     name = \"testing_circular_deps_test\",\n-    entry_point = \"angular/packages/common/testing/index.js\",\n+    entry_point = \"angular/packages/common/testing/index.mjs\",\n     deps = [\"//packages/common/testing\"],\n )\n \n\n---\n file path A: packages/common/upgrade/test/BUILD.bazel | file path B: packages/common/upgrade/test/BUILD.bazel\n\n@@ -3,7 +3,7 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/common/upgrade/index.js\",\n+    entry_point = \"angular/packages/common/upgrade/index.mjs\",\n     deps = [\"//packages/common/upgrade\"],\n )\n \n\n\n###\n\n", "completion": "refactor: update packages/common tests to work with ESM pipeline (#<issue-num>)"}
{"prompt": " file path A: packages/animations/browser/test/BUILD.bazel | file path B: packages/animations/browser/test/BUILD.bazel\n\n@@ -3,13 +3,13 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/animations/browser/index.js\",\n+    entry_point = \"angular/packages/animations/browser/index.mjs\",\n     deps = [\"//packages/animations/browser\"],\n )\n \n circular_dependency_test(\n     name = \"testing_circular_deps_test\",\n-    entry_point = \"angular/packages/animations/browser/testing/index.js\",\n+    entry_point = \"angular/packages/animations/browser/testing/index.mjs\",\n     deps = [\"//packages/animations/browser/testing\"],\n )\n \n\n---\n file path A: packages/animations/test/BUILD.bazel | file path B: packages/animations/test/BUILD.bazel\n\n@@ -3,7 +3,7 @@ load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/animations/index.js\",\n+    entry_point = \"angular/packages/animations/index.mjs\",\n     deps = [\"//packages/animations\"],\n )\n \n\n\n###\n\n", "completion": "refactor: update `animations` tests to work with ESM output (#<issue-num>)"}
{"prompt": " file path A: packages/misc/angular-in-memory-web-api/test/BUILD.bazel | file path B: packages/misc/angular-in-memory-web-api/test/BUILD.bazel\n\n@@ -20,14 +20,6 @@ ts_library(\n \n karma_web_test_suite(\n     name = \"test_web\",\n-    # do not sort\n-    bootstrap = [\n-        \"@npm//:node_modules/core-js-bundle/index.js\",\n-        \"@npm//:node_modules/reflect-metadata/Reflect.js\",\n-        \"@npm//:node_modules/jasmine-ajax/lib/mock-ajax.js\",\n-        \"//packages/zone.js/bundles:zone.umd.js\",\n-        \"//packages/zone.js/bundles:zone-testing.umd.js\",\n-    ],\n     deps = [\n         \":test_lib\",\n     ],\n\n---\n file path A: packages/misc/angular-in-memory-web-api/test/http-client-backend-service_spec.ts | file path B: packages/misc/angular-in-memory-web-api/test/http-client-backend-service_spec.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-/// <reference types=\"jasmine-ajax\" />\n+import 'jasmine-ajax';\n \n import {HTTP_INTERCEPTORS, HttpBackend, HttpClient, HttpClientModule, HttpEvent, HttpEventType, HttpHandler, HttpInterceptor, HttpRequest, HttpResponse} from '@angular/common/http';\n import {Injectable} from '@angular/core';\n\n\n###\n\n", "completion": "build: update `angular-in-memory-web-api` to work with ESM (#<issue-num>)"}
{"prompt": " file path A: packages/core/schematics/migrations/google3/BUILD.bazel | file path B: packages/core/schematics/migrations/google3/BUILD.bazel\n\n@@ -3,6 +3,8 @@ load(\"//tools:defaults.bzl\", \"ts_library\")\n ts_library(\n     name = \"google3\",\n     srcs = glob([\"**/*.ts\"]),\n+    # TODO(ESM): Change when schematics support ESM.\n+    devmode_module = \"commonjs\",\n     tsconfig = \"//packages/core/schematics:tsconfig.json\",\n     visibility = [\"//packages/core/schematics/test/google3:__pkg__\"],\n     deps = [\n\n---\n file path A: packages/core/schematics/migrations/relative-link-resolution/BUILD.bazel | file path B: packages/core/schematics/migrations/relative-link-resolution/BUILD.bazel\n\n@@ -3,6 +3,8 @@ load(\"//tools:defaults.bzl\", \"ts_library\")\n ts_library(\n     name = \"relative-link-resolution\",\n     srcs = glob([\"**/*.ts\"]),\n+    # TODO(ESM): Change when schematics support ESM.\n+    devmode_module = \"commonjs\",\n     tsconfig = \"//packages/core/schematics:tsconfig.json\",\n     visibility = [\n         \"//packages/core/schematics:__pkg__\",\n\n---\n file path A: packages/core/schematics/migrations/router-link-with-href/BUILD.bazel | file path B: packages/core/schematics/migrations/router-link-with-href/BUILD.bazel\n\n@@ -3,6 +3,8 @@ load(\"//tools:defaults.bzl\", \"ts_library\")\n ts_library(\n     name = \"router-link-with-href\",\n     srcs = glob([\"**/*.ts\"]),\n+    # TODO(ESM): Change when schematics support ESM.\n+    devmode_module = \"commonjs\",\n     tsconfig = \"//packages/core/schematics:tsconfig.json\",\n     visibility = [\n         \"//packages/core/schematics:__pkg__\",\n\n---\n file path A: packages/core/schematics/test/BUILD.bazel | file path B: packages/core/schematics/test/BUILD.bazel\n\n@@ -1,4 +1,6 @@\n-load(\"//tools:defaults.bzl\", \"jasmine_node_test\", \"ts_library\")\n+# TODO(ESM): Use rule from defaults if schematics run as ESM.\n+load(\"@npm//@bazel/jasmine:index.bzl\", \"jasmine_node_test\")\n+load(\"//tools:defaults.bzl\", \"ts_library\")\n \n ts_library(\n     name = \"test_lib\",\n@@ -7,6 +9,8 @@ ts_library(\n     data = [\n         \"//packages/core/schematics:migrations.json\",\n     ],\n+    # TODO(ESM): Change when schematics support ESM.\n+    devmode_module = \"commonjs\",\n     deps = [\n         \"//packages/core/schematics/migrations/relative-link-resolution\",\n         \"//packages/core/schematics/migrations/router-link-with-href\",\n@@ -20,6 +24,7 @@ ts_library(\n \n jasmine_node_test(\n     name = \"test\",\n+    templated_args = [\"--nobazel_run_linker\"],\n     deps = [\n         \":test_lib\",\n         \"@npm//shelljs\",\n\n---\n file path A: packages/core/schematics/test/google3/BUILD.bazel | file path B: packages/core/schematics/test/google3/BUILD.bazel\n\n@@ -1,9 +1,13 @@\n-load(\"//tools:defaults.bzl\", \"jasmine_node_test\", \"ts_library\")\n+# TODO(ESM): Use rule from defaults if schematics run as ESM.\n+load(\"@npm//@bazel/jasmine:index.bzl\", \"jasmine_node_test\")\n+load(\"//tools:defaults.bzl\", \"ts_library\")\n \n ts_library(\n     name = \"test_lib\",\n     testonly = True,\n     srcs = glob([\"**/*.ts\"]),\n+    # TODO(ESM): Change when schematics support ESM.\n+    devmode_module = \"commonjs\",\n     deps = [\n         \"//packages/core/schematics/migrations/google3\",\n         \"@npm//@types/shelljs\",\n@@ -13,6 +17,7 @@ ts_library(\n \n jasmine_node_test(\n     name = \"google3\",\n+    templated_args = [\"--nobazel_run_linker\"],\n     deps = [\n         \":test_lib\",\n         \"@npm//shelljs\",\n\n---\n file path A: packages/core/schematics/utils/BUILD.bazel | file path B: packages/core/schematics/utils/BUILD.bazel\n\n@@ -3,6 +3,8 @@ load(\"//tools:defaults.bzl\", \"ts_library\")\n ts_library(\n     name = \"utils\",\n     srcs = glob([\"**/*.ts\"]),\n+    # TODO(ESM): Change when schematics support ESM.\n+    devmode_module = \"commonjs\",\n     tsconfig = \"//packages/core/schematics:tsconfig.json\",\n     visibility = [\"//packages/core/schematics:__subpackages__\"],\n     deps = [\n\n---\n file path A: packages/core/schematics/utils/tslint/BUILD.bazel | file path B: packages/core/schematics/utils/tslint/BUILD.bazel\n\n@@ -3,6 +3,8 @@ load(\"//tools:defaults.bzl\", \"ts_library\")\n ts_library(\n     name = \"tslint\",\n     srcs = glob([\"**/*.ts\"]),\n+    # TODO(ESM): Change when schematics support ESM.\n+    devmode_module = \"commonjs\",\n     tsconfig = \"//packages/core/schematics:tsconfig.json\",\n     visibility = [\n         \"//packages/core/schematics/migrations/google3:__pkg__\",\n\n---\n file path A: tools/defaults.bzl | file path B: tools/defaults.bzl\n\n@@ -112,8 +112,6 @@ def ts_library(\n         deps = [],\n         module_name = None,\n         package_name = None,\n-        # TODO(devversion): disallow configuration of the target when binaries/schematics can be ESM.\n-        devmode_target = None,\n         devmode_module = None,\n         **kwargs):\n     \"\"\"Default values for ts_library\"\"\"\n@@ -143,9 +141,8 @@ def ts_library(\n         tsconfig = tsconfig,\n         testonly = testonly,\n         deps = deps,\n-        # We also set devmode output to the same settings as prodmode as a first step in\n-        # combining devmode and prodmode output.\n-        devmode_target = devmode_target if devmode_target != None else default_target,\n+        # TODO(ESM): Remove when schematics work with ESM.\n+        devmode_target = default_target,\n         devmode_module = devmode_module if devmode_module != None else default_module,\n         # For prodmode, the target is set to `ES2020`. `@bazel/typecript` sets `ES2015` by\n         # default. Note that this should be in sync with the `ng_module` tsconfig generation.\n\n\n###\n\n", "completion": "build: override schematics to be built and tested using CommonJS (#<issue-num>)"}
{"prompt": " file path A: BUILD.bazel | file path B: BUILD.bazel\n\n@@ -26,20 +26,6 @@ alias(\n     actual = \"//packages:tsconfig-build.json\",\n )\n \n-filegroup(\n-    name = \"web_test_bootstrap_scripts\",\n-    # do not sort\n-    srcs = [\n-        \"@npm//:node_modules/core-js-bundle/index.js\",\n-        \"//packages/zone.js/bundles:zone.umd.js\",\n-        \"//packages/zone.js/bundles:zone-testing.umd.js\",\n-        \"//packages/zone.js/bundles:task-tracking.umd.js\",\n-        # Including systemjs because it defines `__eval`, which produces correct stack traces.\n-        \"@npm//:node_modules/systemjs/dist/system.src.js\",\n-        \"@npm//:node_modules/reflect-metadata/Reflect.js\",\n-    ],\n-)\n-\n filegroup(\n     name = \"angularjs_scripts\",\n     srcs = [\n\n---\n file path A: packages/core/test/BUILD.bazel | file path B: packages/core/test/BUILD.bazel\n\n@@ -127,6 +127,7 @@ jasmine_node_test(\n \n karma_web_test_suite(\n     name = \"test_web\",\n+    external = [\"@angular/platform-server\"],\n     runtime_deps = [\":downleveled_es5_fixture\"],\n     deps = [\n         \":test_lib\",\n\n---\n file path A: packages/platform-browser/test/BUILD.bazel | file path B: packages/platform-browser/test/BUILD.bazel\n\n@@ -52,7 +52,6 @@ karma_web_test_suite(\n     name = \"test_web\",\n     bootstrap = [\n         \"dom/events/zone_event_unpatched_init.js\",\n-        \"//:web_test_bootstrap_scripts\",\n     ],\n     static_files = [\n         \":static_assets/test.html\",\n\n---\n file path A: packages/private/testing/BUILD.bazel | file path B: packages/private/testing/BUILD.bazel\n\n@@ -9,6 +9,7 @@ exports_files([\"package.json\"])\n \n ng_module(\n     name = \"testing\",\n+    package_name = \"@angular/private/testing\",\n     testonly = True,\n     srcs = glob(\n         [\"**/*.ts\"],\n\n---\n file path A: packages/zone.js/lib/BUILD.bazel | file path B: packages/zone.js/lib/BUILD.bazel\n\n@@ -16,6 +16,7 @@ ts_library(\n \n ts_library(\n     name = \"lib\",\n+    package_name = \"zone.js/lib\",\n     srcs = glob(\n         [\"**/*.ts\"],\n         exclude = [\"zone.ts\"],\n\n---\n file path A: tools/defaults.bzl | file path B: tools/defaults.bzl\n\n@@ -16,6 +16,7 @@ load(\"@npm//@angular/build-tooling/bazel:extract_js_module_output.bzl\", \"extract\n load(\"@npm//@angular/build-tooling/bazel:extract_types.bzl\", _extract_types = \"extract_types\")\n load(\"@npm//@angular/build-tooling/bazel/esbuild:index.bzl\", _esbuild = \"esbuild\", _esbuild_config = \"esbuild_config\")\n load(\"@npm//@angular/build-tooling/bazel/spec-bundling:spec-entrypoint.bzl\", \"spec_entrypoint\")\n+load(\"@npm//@angular/build-tooling/bazel/spec-bundling:index.bzl\", \"spec_bundle\")\n load(\"@npm//tsec:index.bzl\", _tsec_test = \"tsec_test\")\n load(\"//packages/bazel:index.bzl\", _ng_module = \"ng_module\", _ng_package = \"ng_package\")\n load(\"//tools/esm-interop:index.bzl\", \"enable_esm_node_module_loader\", \"extract_esm_outputs\", _nodejs_binary = \"nodejs_binary\", _nodejs_test = \"nodejs_test\")\n@@ -297,35 +298,33 @@ def pkg_npm(name, validate = True, use_prodmode_output = False, **kwargs):\n         visibility = visibility,\n     )\n \n-def karma_web_test_suite(name, **kwargs):\n+def karma_web_test_suite(name, external = [], **kwargs):\n     \"\"\"Default values for karma_web_test_suite\"\"\"\n \n     # Default value for bootstrap\n-    bootstrap = kwargs.pop(\"bootstrap\", [\n-        \"//:web_test_bootstrap_scripts\",\n-    ])\n-\n-    # Add common deps\n-    deps = kwargs.pop(\"deps\", []) + [\n-        \"@npm//karma-sauce-launcher\",\n-        \"@npm//:node_modules/tslib/tslib.js\",\n-        \"//tools/rxjs:rxjs_umd_modules\",\n-        \"//packages/zone.js:npm_package\",\n-    ]\n-\n-    # Add common runtime deps\n-    runtime_deps = kwargs.pop(\"runtime_deps\", []) + [\n+    bootstrap = kwargs.pop(\"bootstrap\", []) + [\n         \"//tools/testing:browser\",\n     ]\n \n+    # Add common deps\n+    deps = kwargs.pop(\"deps\", [])\n     data = kwargs.pop(\"data\", [])\n     tags = kwargs.pop(\"tags\", [])\n \n+    spec_bundle(\n+        name = \"%s_bundle\" % name,\n+        # Specs from this attribute are filtered and will be executed. We\n+        # add bootstrap here for discovery of the module mappings aspect.\n+        deps = deps + bootstrap,\n+        bootstrap = bootstrap,\n+        workspace_name = \"angular\",\n+        external = external,\n+        platform = \"browser\",\n+    )\n+\n     _karma_web_test_suite(\n         name = name,\n-        runtime_deps = runtime_deps,\n-        bootstrap = bootstrap,\n-        deps = deps,\n+        deps = [\":%s_bundle\" % name],\n         browsers = [\n             \"@npm//@angular/build-tooling/bazel/browsers/chromium:chromium\",\n             \"@npm//@angular/build-tooling/bazel/browsers/firefox:firefox\",\n@@ -343,10 +342,12 @@ def karma_web_test_suite(name, **kwargs):\n         # unnecessarily being acquired. Our specified Saucelabs idle timeout is 10min, so we use\n         # Bazel's long timeout (15min). This ensures that Karma can shut down properly.\n         timeout = \"long\",\n-        runtime_deps = runtime_deps,\n         bootstrap = bootstrap,\n         config_file = \"//:karma-js.conf.js\",\n-        deps = deps,\n+        deps = [\n+            \"@npm//karma-sauce-launcher\",\n+            \":%s_bundle\" % name,\n+        ],\n         data = data + [\n             \"//:browser-providers.conf.js\",\n         ],\n\n---\n file path A: tools/testing/BUILD.bazel | file path B: tools/testing/BUILD.bazel\n\n@@ -2,15 +2,26 @@ load(\"//tools:defaults.bzl\", \"jasmine_node_test\", \"ts_library\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n+ts_library(\n+    name = \"zone_base_setup_lib\",\n+    testonly = 1,\n+    srcs = [\"zone_base_setup.ts\"],\n+    deps = [\n+        \"//packages/zone.js/lib\",\n+    ],\n+)\n+\n ts_library(\n     name = \"browser\",\n     testonly = 1,\n     srcs = [\"browser_tests.init.ts\"],\n     deps = [\n+        \":zone_base_setup_lib\",\n         \"//packages/compiler\",\n         \"//packages/core/testing\",\n         \"//packages/platform-browser-dynamic/testing\",\n         \"//packages/platform-browser/animations\",\n+        \"//packages/zone.js/lib\",\n     ],\n )\n \n@@ -19,6 +30,7 @@ ts_library(\n     testonly = 1,\n     srcs = [\"node_tests.init.ts\"],\n     deps = [\n+        \":zone_base_setup_lib\",\n         \"//packages/compiler\",\n         \"//packages/core/testing\",\n         \"//packages/platform-server\",\n\n---\n file path A: tools/testing/browser_tests.init.ts | file path B: tools/testing/browser_tests.init.ts\n\n@@ -6,6 +6,8 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import 'zone.js/lib/browser/rollup-main';\n+import './zone_base_setup';\n import '@angular/compiler'; // For JIT mode. Must be in front of any other @angular/* imports.\n \n import {TestBed} from '@angular/core/testing';\n\n---\n file path A: tools/testing/node_tests.init.ts | file path B: tools/testing/node_tests.init.ts\n\n@@ -7,14 +7,7 @@\n  */\n \n import 'zone.js/lib/node/rollup-main';\n-import 'zone.js/lib/zone-spec/long-stack-trace';\n-import 'zone.js/lib/zone-spec/task-tracking';\n-import 'zone.js/lib/zone-spec/proxy';\n-import 'zone.js/lib/zone-spec/sync-test';\n-import 'zone.js/lib/testing/async-testing';\n-import 'zone.js/lib/testing/fake-async';\n-import 'reflect-metadata/Reflect';\n-import 'zone.js/lib/jasmine/jasmine';\n+import './zone_base_setup';\n \n (global as any).isNode = true;\n (global as any).isBrowser = false;\n\n---\n file path A: None | file path B: tools/testing/zone_base_setup.ts\n\n@@ -0,0 +1,16 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import 'zone.js/lib/zone-spec/long-stack-trace';\n+import 'zone.js/lib/zone-spec/task-tracking';\n+import 'zone.js/lib/zone-spec/proxy';\n+import 'zone.js/lib/zone-spec/sync-test';\n+import 'zone.js/lib/testing/async-testing';\n+import 'zone.js/lib/testing/fake-async';\n+import 'reflect-metadata/Reflect';\n+import 'zone.js/lib/jasmine/jasmine';\n\n\n###\n\n", "completion": "build: bundle tests for karma web test suites (#<issue-num>)"}
{"prompt": " file path A: packages/core/test/render3/jit/declare_component_spec.ts | file path B: packages/core/test/render3/jit/declare_component_spec.ts\n\n@@ -8,7 +8,7 @@\n \n import {ChangeDetectionStrategy, Component, Directive, ElementRef, forwardRef, Pipe, Type, ViewEncapsulation, \u0275\u0275ngDeclareComponent} from '@angular/core';\n \n-import {AttributeMarker, ComponentDef} from '../../../src/render3';\n+import {AttributeMarker, ComponentDef, \u0275\u0275InheritDefinitionFeature, \u0275\u0275NgOnChangesFeature} from '../../../src/render3';\n \n import {functionContaining} from './matcher';\n \n@@ -220,7 +220,7 @@ describe('component declaration jit compilation', () => {\n                 }) as ComponentDef<TestClass>;\n \n     expectComponentDef(def, {\n-      features: [functionContaining(['\u0275\u0275InheritDefinitionFeature'])],\n+      features: [\u0275\u0275InheritDefinitionFeature],\n     });\n   });\n \n@@ -232,7 +232,7 @@ describe('component declaration jit compilation', () => {\n                 }) as ComponentDef<TestClass>;\n \n     expectComponentDef(def, {\n-      features: [functionContaining(['\u0275\u0275NgOnChangesFeature'])],\n+      features: [\u0275\u0275NgOnChangesFeature],\n     });\n   });\n \n\n---\n file path A: packages/core/test/render3/jit/declare_directive_spec.ts | file path B: packages/core/test/render3/jit/declare_directive_spec.ts\n\n@@ -8,7 +8,7 @@\n \n import {ElementRef, forwardRef, \u0275\u0275ngDeclareDirective} from '@angular/core';\n \n-import {AttributeMarker, DirectiveDef} from '../../../src/render3';\n+import {AttributeMarker, DirectiveDef, \u0275\u0275InheritDefinitionFeature, \u0275\u0275NgOnChangesFeature} from '../../../src/render3';\n \n import {functionContaining} from './matcher';\n \n@@ -236,7 +236,7 @@ describe('directive declaration jit compilation', () => {\n                 }) as DirectiveDef<TestClass>;\n \n     expectDirectiveDef(def, {\n-      features: [functionContaining(['\u0275\u0275InheritDefinitionFeature'])],\n+      features: [\u0275\u0275InheritDefinitionFeature],\n     });\n   });\n \n@@ -247,7 +247,7 @@ describe('directive declaration jit compilation', () => {\n                 }) as DirectiveDef<TestClass>;\n \n     expectDirectiveDef(def, {\n-      features: [functionContaining(['\u0275\u0275NgOnChangesFeature'])],\n+      features: [\u0275\u0275NgOnChangesFeature],\n     });\n   });\n });\n\n\n###\n\n", "completion": "test: refactor render3 definition feature test to be less sensitive to JS output (#<issue-num>)"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -105,7 +105,7 @@ yarn_install(\n         \"//:scripts/puppeteer-chromedriver-versions.js\",\n         \"//:scripts/webdriver-manager-update.js\",\n         \"//tools:postinstall-patches.js\",\n-        \"//tools/esm-interop:patches/npm/@angular+build-tooling+0.0.0-96fdaaa056f1cfa7ffbc4c69b7e9007279f76c94.patch\",\n+        \"//tools/esm-interop:patches/npm/@angular+build-tooling+0.0.0-2fe6d743f60e2e1ba91f9e49c417927a46dcd90f.patch\",\n         \"//tools/esm-interop:patches/npm/@bazel+concatjs+5.7.1.patch\",\n         \"//tools/esm-interop:patches/npm/@bazel+esbuild+5.7.1.patch\",\n         \"//tools/esm-interop:patches/npm/rxjs+6.6.7.patch\",\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -86,7 +86,7 @@\n     \"@angular-eslint/eslint-plugin\": \"^15.0.0\",\n     \"@angular-eslint/eslint-plugin-template\": \"^15.0.0\",\n     \"@angular-eslint/template-parser\": \"^15.0.0\",\n-    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#8bfc7e1aca9125487c1d52a5a2c09cc9e134e421\",\n+    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#558babc9c5ca06bedb01cce505fe7036fe8805f7\",\n     \"@angular/cli\": \"15.1.0-next.2\",\n     \"@angular/compiler-cli\": \"15.1.0-next.2\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -188,14 +188,15 @@\n     \"@angular/core\" \"^13.0.0 || ^14.0.0-0\"\n     reflect-metadata \"^0.1.13\"\n \n-\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#8bfc7e1aca9125487c1d52a5a2c09cc9e134e421\":\n-  version \"0.0.0-96fdaaa056f1cfa7ffbc4c69b7e9007279f76c94\"\n-  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#8bfc7e1aca9125487c1d52a5a2c09cc9e134e421\"\n+\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#558babc9c5ca06bedb01cce505fe7036fe8805f7\":\n+  version \"0.0.0-2fe6d743f60e2e1ba91f9e49c417927a46dcd90f\"\n+  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#558babc9c5ca06bedb01cce505fe7036fe8805f7\"\n   dependencies:\n     \"@angular-devkit/build-angular\" \"15.1.0-next.2\"\n     \"@angular/benchpress\" \"0.3.0\"\n     \"@babel/core\" \"^7.16.0\"\n     \"@babel/helper-annotate-as-pure\" \"^7.18.6\"\n+    \"@babel/plugin-proposal-async-generator-functions\" \"^7.20.1\"\n     \"@bazel/buildifier\" \"5.1.0\"\n     \"@bazel/concatjs\" \"5.7.3\"\n     \"@bazel/esbuild\" \"5.7.3\"\n\n---\n file path A: package.json | file path B: package.json\n\n@@ -179,7 +179,7 @@\n   },\n   \"// 2\": \"devDependencies are not used under Bazel. Many can be removed after test.sh is deleted.\",\n   \"devDependencies\": {\n-    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#8bfc7e1aca9125487c1d52a5a2c09cc9e134e421\",\n+    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#e1aec534818208328b29a76cfe9892c2a031ed94\",\n     \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#05278122c48e06eff8e5398d59c49ed6688c949b\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n     \"@bazel/buildifier\": \"^5.0.0\",\n\n---\n file path A: tools/esm-interop/patches/npm/@angular+build-tooling+0.0.0-96fdaaa056f1cfa7ffbc4c69b7e9007279f76c94.patch | file path B: tools/esm-interop/patches/npm/@angular+build-tooling+0.0.0-2fe6d743f60e2e1ba91f9e49c417927a46dcd90f.patch\n\n@@ -1,36 +1,31 @@\n diff --git a/node_modules/@angular/build-tooling/bazel/app-bundling/esbuild.config-tmpl.mjs b/node_modules/@angular/build-tooling/bazel/app-bundling/esbuild.config-tmpl.mjs\n-index 618bbc5..96c6c92 100755\n+index dde2164..772c153 100755\n --- a/node_modules/@angular/build-tooling/bazel/app-bundling/esbuild.config-tmpl.mjs\n +++ b/node_modules/@angular/build-tooling/bazel/app-bundling/esbuild.config-tmpl.mjs\n-@@ -9,9 +9,9 @@\n+@@ -9,7 +9,7 @@\n  import * as path from 'path';\n  \n  import {createEsbuildAngularOptimizePlugin} from '@angular/build-tooling/shared-scripts/angular-optimization/esbuild-plugin.mjs';\n--import {createEs2015LinkerPlugin} from '@angular/compiler-cli/linker/babel';\n--import {ConsoleLogger, NodeJSFileSystem, LogLevel} from '@angular/compiler-cli';\n -import {GLOBAL_DEFS_FOR_TERSER_WITH_AOT} from '@angular/compiler-cli/private/tooling';\n-+import {createEs2015LinkerPlugin} from '@angular/compiler-cli/linker/babel/index.js';\n-+import {ConsoleLogger, NodeJSFileSystem, LogLevel} from '@angular/compiler-cli/index.mjs';\n-+import {GLOBAL_DEFS_FOR_TERSER_WITH_AOT} from '@angular/compiler-cli/private/tooling.js';\n++import {GLOBAL_DEFS_FOR_TERSER_WITH_AOT} from '@angular/compiler-cli/private/tooling.mjs';\n  \n  /** Root path pointing to the app bundle source entry-point file. */\n  const entryPointSourceRootPath = path.normalize(`TMPL_ENTRY_POINT_ROOTPATH`);\n diff --git a/node_modules/@angular/build-tooling/bazel/app-bundling/index.bzl b/node_modules/@angular/build-tooling/bazel/app-bundling/index.bzl\n-index 1edd96d..b1c2ed1 100755\n+index 1edd96d..3d423f4 100755\n --- a/node_modules/@angular/build-tooling/bazel/app-bundling/index.bzl\n +++ b/node_modules/@angular/build-tooling/bazel/app-bundling/index.bzl\n-@@ -64,7 +64,8 @@ def app_bundle(\n+@@ -64,7 +64,7 @@ def app_bundle(\n          name = \"%s_esbuild_config\" % name,\n          config_file = \":%s_config_file\" % name,\n          deps = [\n -            \"@npm//@angular/compiler-cli\",\n-+            \"@angular//packages/compiler-cli\",\n-+            \"@angular//packages/compiler-cli/linker/babel\",\n++            \"@angular//packages/compiler-cli/private\",\n              \"@npm//@angular/build-tooling/shared-scripts/angular-optimization:js_lib\",\n          ],\n          **common_base_attributes\n diff --git a/node_modules/@angular/build-tooling/bazel/benchmark/component_benchmark/component_benchmark.bzl b/node_modules/@angular/build-tooling/bazel/benchmark/component_benchmark/component_benchmark.bzl\n-index 6213703..7c0abd3 100755\n+index 6213703..4d91aa3 100755\n --- a/node_modules/@angular/build-tooling/bazel/benchmark/component_benchmark/component_benchmark.bzl\n +++ b/node_modules/@angular/build-tooling/bazel/benchmark/component_benchmark/component_benchmark.bzl\n @@ -1,7 +1,7 @@\n@@ -58,36 +53,36 @@ index 6213703..7c0abd3 100755\n          # scope and to make it easier to replace this dependency inside the `angular/angular`\n          # repository with its corresponding source target that does not come with any typings.\n -        ng_bundle_deps.append(\"@npm//zone.js\")\n-+        ng_bundle_deps.append(\"//packages/zone.js/dist:zone\")\n++        ng_bundle_deps.append(\"@angular//packages/zone.js/dist:zone\")\n  \n      if not assets:\n          html = prefix + \"index.html\"\n-diff --git a/node_modules/@angular/build-tooling/shared-scripts/angular-linker/BUILD.bazel b/node_modules/@angular/build-tooling/shared-scripts/angular-linker/BUILD.bazel\n-index b14dbdb..eb21619 100755\n---- a/node_modules/@angular/build-tooling/shared-scripts/angular-linker/BUILD.bazel\n-+++ b/node_modules/@angular/build-tooling/shared-scripts/angular-linker/BUILD.bazel\n-@@ -19,7 +19,8 @@ js_library(\n-     package_name = \"@angular/build-tooling/shared-scripts/angular-linker\",\n+diff --git a/node_modules/@angular/build-tooling/shared-scripts/angular-optimization/BUILD.bazel b/node_modules/@angular/build-tooling/shared-scripts/angular-optimization/BUILD.bazel\n+index 79afcb8..ebbb37b 100755\n+--- a/node_modules/@angular/build-tooling/shared-scripts/angular-optimization/BUILD.bazel\n++++ b/node_modules/@angular/build-tooling/shared-scripts/angular-optimization/BUILD.bazel\n+@@ -43,7 +43,8 @@ js_library(\n      srcs = [\":js_lib_files\"],\n      deps = [\n+         \":angular_devkit_plugins\",\n -        \"@npm//@angular/compiler-cli\",\n +        \"@angular//packages/compiler-cli\",\n +        \"@angular//packages/compiler-cli/linker/babel\",\n          \"@npm//@babel/core\",\n+         \"@npm//@babel/plugin-proposal-async-generator-functions\",\n      ],\n- )\n-diff --git a/node_modules/@angular/build-tooling/shared-scripts/angular-linker/esbuild-plugin.mjs b/node_modules/@angular/build-tooling/shared-scripts/angular-linker/esbuild-plugin.mjs\n-index 965a10e..175aa92 100755\n---- a/node_modules/@angular/build-tooling/shared-scripts/angular-linker/esbuild-plugin.mjs\n-+++ b/node_modules/@angular/build-tooling/shared-scripts/angular-linker/esbuild-plugin.mjs\n-@@ -7,8 +7,8 @@\n-  */\n+diff --git a/node_modules/@angular/build-tooling/shared-scripts/angular-optimization/esbuild-plugin.mjs b/node_modules/@angular/build-tooling/shared-scripts/angular-optimization/esbuild-plugin.mjs\n+index fbaf182..e690328 100755\n+--- a/node_modules/@angular/build-tooling/shared-scripts/angular-optimization/esbuild-plugin.mjs\n++++ b/node_modules/@angular/build-tooling/shared-scripts/angular-optimization/esbuild-plugin.mjs\n+@@ -54,8 +54,8 @@ export async function createEsbuildAngularOptimizePlugin(opts, additionalBabelPl\n  \n- import fs from 'fs';\n--import {NodeJSFileSystem, ConsoleLogger, LogLevel} from '@angular/compiler-cli';\n--import {createEs2015LinkerPlugin} from '@angular/compiler-cli/linker/babel';\n-+import {NodeJSFileSystem, ConsoleLogger, LogLevel} from '@angular/compiler-cli/index.mjs';\n-+import {createEs2015LinkerPlugin} from '@angular/compiler-cli/linker/babel/index.mjs';\n- import babel from '@babel/core';\n+   if (opts.enableLinker) {\n+     linkerCreator = {\n+-      compiler: await import('@angular/compiler-cli'),\n+-      babel: await import('@angular/compiler-cli/linker/babel'),\n++      compiler: await import('@angular/compiler-cli/index.mjs'),\n++      babel: await import('@angular/compiler-cli/linker/babel/index.mjs'),\n+     };\n+   }\n  \n- /** Naively checks whether this node path resolves to an Angular declare invocation. */\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -149,15 +149,15 @@\n     \"@angular/core\" \"^13.0.0 || ^14.0.0-0\"\n     reflect-metadata \"^0.1.13\"\n \n-\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#8bfc7e1aca9125487c1d52a5a2c09cc9e134e421\":\n-  version \"0.0.0-96fdaaa056f1cfa7ffbc4c69b7e9007279f76c94\"\n-  uid \"8bfc7e1aca9125487c1d52a5a2c09cc9e134e421\"\n-  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#8bfc7e1aca9125487c1d52a5a2c09cc9e134e421\"\n+\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#e1aec534818208328b29a76cfe9892c2a031ed94\":\n+  version \"0.0.0-30acfb31077ddc552b6be501516833ec234ce5c1\"\n+  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#e1aec534818208328b29a76cfe9892c2a031ed94\"\n   dependencies:\n     \"@angular-devkit/build-angular\" \"15.1.0-next.2\"\n     \"@angular/benchpress\" \"0.3.0\"\n     \"@babel/core\" \"^7.16.0\"\n     \"@babel/helper-annotate-as-pure\" \"^7.18.6\"\n+    \"@babel/plugin-proposal-async-generator-functions\" \"^7.20.1\"\n     \"@bazel/buildifier\" \"5.1.0\"\n     \"@bazel/concatjs\" \"5.7.3\"\n     \"@bazel/esbuild\" \"5.7.3\"\n@@ -305,7 +305,6 @@\n \n \"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#05278122c48e06eff8e5398d59c49ed6688c949b\":\n   version \"0.0.0-96fdaaa056f1cfa7ffbc4c69b7e9007279f76c94\"\n-  uid \"05278122c48e06eff8e5398d59c49ed6688c949b\"\n   resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#05278122c48e06eff8e5398d59c49ed6688c949b\"\n   dependencies:\n     \"@yarnpkg/lockfile\" \"^1.1.0\"\n\n\n###\n\n", "completion": "build: update dev-infra build tooling to leverage recent ESM changes (#<issue-num>)"}
{"prompt": " file path A: packages/core/test/bundling/animations/BUILD.bazel | file path B: packages/core/test/bundling/animations/BUILD.bazel\n\n@@ -34,6 +34,7 @@ ts_library(\n         \"//packages/core\",\n         \"//packages/core/testing\",\n         \"//packages/private/testing\",\n+        \"@npm//@bazel/runfiles\",\n     ],\n )\n \n\n---\n file path A: packages/core/test/bundling/animations/treeshaking_spec.ts | file path B: packages/core/test/bundling/animations/treeshaking_spec.ts\n\n@@ -8,6 +8,7 @@\n \n import '@angular/compiler';\n \n+import {runfiles} from '@bazel/runfiles';\n import * as fs from 'fs';\n import * as path from 'path';\n \n@@ -17,7 +18,7 @@ describe('treeshaking with uglify', () => {\n   let content: string;\n   // We use the debug version as otherwise symbols/identifiers would be mangled (and the test would\n   // always pass)\n-  const contentPath = require.resolve(path.join(PACKAGE, 'bundle.debug.min.js'));\n+  const contentPath = runfiles.resolve(path.join(PACKAGE, 'bundle.debug.min.js'));\n   beforeAll(() => {\n     content = fs.readFileSync(contentPath, {encoding: 'utf-8'});\n   });\n\n---\n file path A: packages/core/test/bundling/cyclic_import/BUILD.bazel | file path B: packages/core/test/bundling/cyclic_import/BUILD.bazel\n\n@@ -35,6 +35,7 @@ ts_library(\n         \"//packages/compiler\",\n         \"//packages/core/testing\",\n         \"//packages/private/testing\",\n+        \"@npm//@bazel/runfiles\",\n     ],\n )\n \n\n---\n file path A: packages/core/test/bundling/cyclic_import/integration_spec.ts | file path B: packages/core/test/bundling/cyclic_import/integration_spec.ts\n\n@@ -9,6 +9,7 @@\n import '@angular/compiler';\n \n import {withBody} from '@angular/private/testing';\n+import {runfiles} from '@bazel/runfiles';\n import * as fs from 'fs';\n import * as path from 'path';\n \n@@ -16,28 +17,28 @@ const PACKAGE = 'angular/packages/core/test/bundling/cyclic_import';\n \n describe('treeshaking with uglify', () => {\n   let content: string;\n-  const contentPath = require.resolve(path.join(PACKAGE, 'bundle.debug.min.js'));\n+  const contentPath = runfiles.resolve(path.join(PACKAGE, 'bundle.debug.min.js'));\n   beforeAll(() => {\n     content = fs.readFileSync(contentPath, {encoding: 'utf-8'});\n   });\n \n   describe('functional test in domino', () => {\n     it('should render hello world when not minified', withBody('<trigger></trigger>', async () => {\n-         require(path.join(PACKAGE, 'bundle.js'));\n+         await import(path.join(PACKAGE, 'bundle.js'));\n          await (window as any).appReady;\n          expect(document.body.textContent).toEqual('dep');\n        }));\n \n     it('should render hello world when debug minified',\n        withBody('<trigger></trigger>', async () => {\n-         require(path.join(PACKAGE, 'bundle.debug.min.js'));\n+         await import(path.join(PACKAGE, 'bundle.debug.min.js'));\n          await (window as any).appReady;\n          expect(document.body.textContent).toEqual('dep');\n        }));\n \n     it('should render hello world when fully minified',\n        withBody('<trigger></trigger>', async () => {\n-         require(path.join(PACKAGE, 'bundle.min.js'));\n+         await import(path.join(PACKAGE, 'bundle.min.js'));\n          await (window as any).appReady;\n          expect(document.body.textContent).toEqual('dep');\n        }));\n\n---\n file path A: packages/core/test/bundling/forms_reactive/BUILD.bazel | file path B: packages/core/test/bundling/forms_reactive/BUILD.bazel\n\n@@ -36,6 +36,7 @@ ts_library(\n         \"//packages/core\",\n         \"//packages/core/testing\",\n         \"//packages/private/testing\",\n+        \"@npm//@bazel/runfiles\",\n     ],\n )\n \n\n---\n file path A: packages/core/test/bundling/forms_reactive/forms_e2e_spec.ts | file path B: packages/core/test/bundling/forms_reactive/forms_e2e_spec.ts\n\n@@ -19,7 +19,7 @@ describe('functional test for reactive forms', () => {\n     describe(`using ${bundle} bundle`, () => {\n       it('should render template form', withBody('<app-root></app-root>', async () => {\n            // load the bundle\n-           require(path.join(PACKAGE, bundle));\n+           await import(path.join(PACKAGE, bundle));\n            // the bundle attaches the following fields to the `window` global.\n            const {bootstrapApp} = window as any;\n \n\n---\n file path A: packages/core/test/bundling/forms_reactive/treeshaking_spec.ts | file path B: packages/core/test/bundling/forms_reactive/treeshaking_spec.ts\n\n@@ -8,6 +8,7 @@\n \n import '@angular/compiler';\n \n+import {runfiles} from '@bazel/runfiles';\n import * as fs from 'fs';\n import * as path from 'path';\n \n@@ -17,7 +18,7 @@ describe('treeshaking with uglify', () => {\n   let content: string;\n   // We use the debug version as otherwise symbols/identifiers would be mangled (and the test would\n   // always pass)\n-  const contentPath = require.resolve(path.join(PACKAGE, 'bundle.debug.min.js'));\n+  const contentPath = runfiles.resolve(path.join(PACKAGE, 'bundle.debug.min.js'));\n   beforeAll(() => {\n     content = fs.readFileSync(contentPath, {encoding: 'utf-8'});\n   });\n\n---\n file path A: packages/core/test/bundling/forms_template_driven/BUILD.bazel | file path B: packages/core/test/bundling/forms_template_driven/BUILD.bazel\n\n@@ -36,6 +36,7 @@ ts_library(\n         \"//packages/core\",\n         \"//packages/core/testing\",\n         \"//packages/private/testing\",\n+        \"@npm//@bazel/runfiles\",\n     ],\n )\n \n\n---\n file path A: packages/core/test/bundling/forms_template_driven/forms_e2e_spec.ts | file path B: packages/core/test/bundling/forms_template_driven/forms_e2e_spec.ts\n\n@@ -19,7 +19,7 @@ describe('functional test for forms', () => {\n     describe(`using ${bundle} bundle`, () => {\n       it('should render template form', withBody('<app-root></app-root>', async () => {\n            // load the bundle\n-           require(path.join(PACKAGE, bundle));\n+           await import(path.join(PACKAGE, bundle));\n            // the bundle attaches the following fields to the `window` global.\n            const {bootstrapApp} = window as any;\n \n\n---\n file path A: packages/core/test/bundling/forms_template_driven/treeshaking_spec.ts | file path B: packages/core/test/bundling/forms_template_driven/treeshaking_spec.ts\n\n@@ -8,6 +8,7 @@\n \n import '@angular/compiler';\n \n+import {runfiles} from '@bazel/runfiles';\n import * as fs from 'fs';\n import * as path from 'path';\n \n@@ -17,7 +18,7 @@ describe('treeshaking with uglify', () => {\n   let content: string;\n   // We use the debug version as otherwise symbols/identifiers would be mangled (and the test would\n   // always pass)\n-  const contentPath = require.resolve(path.join(PACKAGE, 'bundle.debug.min.js'));\n+  const contentPath = runfiles.resolve(path.join(PACKAGE, 'bundle.debug.min.js'));\n   beforeAll(() => {\n     content = fs.readFileSync(contentPath, {encoding: 'utf-8'});\n   });\n\n---\n file path A: packages/core/test/bundling/hello_world/BUILD.bazel | file path B: packages/core/test/bundling/hello_world/BUILD.bazel\n\n@@ -33,6 +33,7 @@ ts_library(\n         \"//packages/compiler\",\n         \"//packages/core/testing\",\n         \"//packages/private/testing\",\n+        \"@npm//@bazel/runfiles\",\n     ],\n )\n \n\n---\n file path A: packages/core/test/bundling/hello_world/treeshaking_spec.ts | file path B: packages/core/test/bundling/hello_world/treeshaking_spec.ts\n\n@@ -8,6 +8,7 @@\n \n import '@angular/compiler';\n \n+import {runfiles} from '@bazel/runfiles';\n import * as fs from 'fs';\n import * as path from 'path';\n \n@@ -15,7 +16,7 @@ const PACKAGE = 'angular/packages/core/test/bundling/hello_world';\n \n describe('treeshaking with uglify', () => {\n   let content: string;\n-  const contentPath = require.resolve(path.join(PACKAGE, 'bundle.debug.min.js'));\n+  const contentPath = runfiles.resolve(path.join(PACKAGE, 'bundle.debug.min.js'));\n   beforeAll(() => {\n     content = fs.readFileSync(contentPath, {encoding: 'utf-8'});\n   });\n\n---\n file path A: packages/core/test/bundling/router/BUILD.bazel | file path B: packages/core/test/bundling/router/BUILD.bazel\n\n@@ -38,6 +38,7 @@ ts_library(\n         \"//packages/core\",\n         \"//packages/core/testing\",\n         \"//packages/private/testing\",\n+        \"@npm//@bazel/runfiles\",\n     ],\n )\n \n\n---\n file path A: packages/core/test/bundling/router/treeshaking_spec.ts | file path B: packages/core/test/bundling/router/treeshaking_spec.ts\n\n@@ -8,6 +8,7 @@\n \n import '@angular/compiler';\n \n+import {runfiles} from '@bazel/runfiles';\n import * as fs from 'fs';\n import * as path from 'path';\n \n@@ -17,7 +18,7 @@ describe('treeshaking with uglify', () => {\n   let content: string;\n   // We use the debug version as otherwise symbols/identifiers would be mangled (and the test would\n   // always pass)\n-  const contentPath = require.resolve(path.join(PACKAGE, 'bundle.debug.min.js'));\n+  const contentPath = runfiles.resolve(path.join(PACKAGE, 'bundle.debug.min.js'));\n   beforeAll(() => {\n     content = fs.readFileSync(contentPath, {encoding: 'utf-8'});\n   });\n\n---\n file path A: packages/core/test/bundling/standalone_bootstrap/BUILD.bazel | file path B: packages/core/test/bundling/standalone_bootstrap/BUILD.bazel\n\n@@ -33,6 +33,7 @@ ts_library(\n         \"//packages/compiler\",\n         \"//packages/core/testing\",\n         \"//packages/private/testing\",\n+        \"@npm//@bazel/runfiles\",\n     ],\n )\n \n\n---\n file path A: packages/core/test/bundling/standalone_bootstrap/treeshaking_spec.ts | file path B: packages/core/test/bundling/standalone_bootstrap/treeshaking_spec.ts\n\n@@ -8,6 +8,7 @@\n \n import '@angular/compiler';\n \n+import {runfiles} from '@bazel/runfiles';\n import * as fs from 'fs';\n import * as path from 'path';\n \n@@ -17,7 +18,7 @@ describe('treeshaking with uglify', () => {\n   let content: string;\n   // We use the debug version as otherwise symbols/identifiers would be mangled (and the test would\n   // always pass)\n-  const contentPath = require.resolve(path.join(PACKAGE, 'bundle.debug.min.js'));\n+  const contentPath = runfiles.resolve(path.join(PACKAGE, 'bundle.debug.min.js'));\n   beforeAll(() => {\n     content = fs.readFileSync(contentPath, {encoding: 'utf-8'});\n   });\n\n---\n file path A: packages/core/test/bundling/todo/todo_e2e_spec.ts | file path B: packages/core/test/bundling/todo/todo_e2e_spec.ts\n\n@@ -20,7 +20,7 @@ describe('functional test for todo', () => {\n       it('should place styles on the elements within the component',\n          withBody('<todo-app></todo-app>', async () => {\n            // load the bundle\n-           require(path.join(PACKAGE, bundle));\n+           await import(path.join(PACKAGE, bundle));\n            // the bundle attaches the following fields to the `window` global.\n            const {bootstrapApp} = window as any;\n \n\n---\n file path A: packages/core/test/bundling/todo_i18n/todo_e2e_spec.ts | file path B: packages/core/test/bundling/todo_i18n/todo_e2e_spec.ts\n\n@@ -21,7 +21,7 @@ describe('functional test for todo i18n', () => {\n       it('should render todo i18n', withBody('<todo-app></todo-app>', async () => {\n            clearTranslations();\n            // load the bundle\n-           require(path.join(PACKAGE, bundle));\n+           await import(path.join(PACKAGE, bundle));\n            // the bundle attaches the following fields to the `window` global.\n            const {appReady} = window as any;\n            await appReady;\n\n\n###\n\n", "completion": "test: refactor core bundling tests to work with ESM (#<issue-num>)"}
{"prompt": " file path A: tools/symbol-extractor/cli.ts | file path B: tools/symbol-extractor/cli.ts\n\n@@ -11,10 +11,8 @@ import * as fs from 'fs';\n \n import {SymbolExtractor} from './symbol_extractor';\n \n-if (require.main === module) {\n-  const args = process.argv.slice(2) as [string, string];\n-  process.exitCode = main(args) ? 0 : 1;\n-}\n+const args = process.argv.slice(2) as [string, string];\n+process.exitCode = main(args) ? 0 : 1;\n \n /**\n  * CLI main method.\n\n\n###\n\n", "completion": "refactor: update symbol extractor test tool to work with ESM (#<issue-num>)"}
{"prompt": " file path A: tools/esm-interop/esm-extension-loader.mjs | file path B: tools/esm-interop/esm-extension-loader.mjs\n\n@@ -29,15 +29,6 @@ const explicitJsExtensionRe = /\\.js$/;\n  *        2. It results in additional churn, having to put `package.json` into `bin`.\n  */\n export async function resolve(specifier, context, nextResolve) {\n-  // Actual resolution is the actual specifier. This is where errors\n-  // should not be silenced as it's the actual user-specifier.\n-  let resolveError = null;\n-  try {\n-    return await nextResolve(specifier, context);\n-  } catch (e) {\n-    resolveError = e;\n-  }\n-\n   const interopAttempts = [];\n   if (explicitJsExtensionRe.test(specifier)) {\n     interopAttempts.push(specifier.replace(explicitJsExtensionRe, '.mjs'));\n@@ -58,6 +49,7 @@ export async function resolve(specifier, context, nextResolve) {\n     } catch {}\n   }\n \n-  // Rethrow the existing resolution error.\n-  throw resolveError;\n+  // Original specifier is attempted at the end because\n+  // we want to prioritize the ESM variants first.\n+  return await nextResolve(specifier, context);\n }\n\n---\n file path A: tools/esm-interop/esm-node-module-loader.mjs | file path B: tools/esm-interop/esm-node-module-loader.mjs\n\n@@ -104,15 +104,14 @@ function resolvePackageWithExportsSupport(pathToNodeModule, packageImport) {\n   const packageJson = JSON.parse(\n     fs.readFileSync(path.join(pathToNodeModule, 'package.json'), 'utf8')\n   );\n-  const localPackagePath = resolvePackageLocalFilepath(\n+  const localResolvedPackagePath = resolvePackageLocalFilepath(\n     pathToNodeModule,\n     packageImport,\n     packageJson\n   );\n-  const resolvedFilePath = path.join(pathToNodeModule, localPackagePath);\n \n-  if (fs.existsSync(resolvedFilePath)) {\n-    return {url: pathToFileURL(resolvedFilePath).href};\n+  if (fs.existsSync(localResolvedPackagePath)) {\n+    return {url: pathToFileURL(localResolvedPackagePath).href};\n   }\n   return null;\n }\n@@ -123,9 +122,10 @@ function resolvePackageWithExportsSupport(pathToNodeModule, packageImport) {\n  */\n function resolvePackageLocalFilepath(pathToNodeModule, packageImport, packageJson) {\n   if (packageJson.exports) {\n-    return resolveExports(packageJson, packageImport.specifier);\n+    return path.join(pathToNodeModule, resolveExports(packageJson, packageImport.specifier));\n   }\n \n+  let pkgJsonDir = pathToNodeModule;\n   // If we couldn't resolve the subpath via `exports`, we check if the subpath\n   // already points to an explicit file, or respect deep `package.json` files.\n   if (packageImport.pathInPackage !== '') {\n@@ -133,11 +133,12 @@ function resolvePackageLocalFilepath(pathToNodeModule, packageImport, packageJso\n     const deepPackageJsonPath = path.join(fullPath, 'package.json');\n \n     if (fs.existsSync(deepPackageJsonPath)) {\n+      pkgJsonDir = fullPath;\n       packageJson = JSON.parse(fs.readFileSync(deepPackageJsonPath, 'utf8'));\n-    } else if (fs.existsSync(fullPath)) {\n-      return packageImport.pathInPackage;\n+    } else {\n+      return fullPath;\n     }\n   }\n \n-  return packageJson.module || packageJson.main || 'index.js';\n+  return path.join(pkgJsonDir, packageJson.module || packageJson.main || 'index.js');\n }\n\n\n###\n\n", "completion": "build: update esm nodejs loader to properly handle subpaths (#<issue-num>)"}
{"prompt": " file path A: packages/platform-server/src/domino_adapter.ts | file path B: packages/platform-server/src/domino_adapter.ts\n\n@@ -8,7 +8,7 @@\n \n import {\u0275setRootDomAdapter as setRootDomAdapter} from '@angular/common';\n import {\u0275BrowserDomAdapter as BrowserDomAdapter} from '@angular/platform-browser';\n-import * as domino from 'domino';\n+import domino from 'domino';\n \n export function setDomTypes() {\n   // Make all Domino types available in the global env.\n\n---\n file path A: tools/testing/node_tests.init.ts | file path B: tools/testing/node_tests.init.ts\n\n@@ -24,9 +24,9 @@ import '@angular/compiler'; // For JIT mode. Must be in front of any other @angu\n import {TestBed} from '@angular/core/testing';\n import {ServerTestingModule, platformServerTesting} from '@angular/platform-server/testing/src/server';\n import {DominoAdapter} from '@angular/platform-server/src/domino_adapter';\n-import {createDocument} from 'domino';\n+import domino from 'domino';\n \n TestBed.initTestEnvironment(ServerTestingModule, platformServerTesting());\n DominoAdapter.makeCurrent();\n-(global as any).document =\n-    (DominoAdapter as any).defaultDoc || ((DominoAdapter as any).defaultDoc = createDocument());\n+(global as any).document = (DominoAdapter as any).defaultDoc ||\n+    ((DominoAdapter as any).defaultDoc = domino.createDocument());\n\n\n###\n\n", "completion": "refactor(platform-server): use proper ESM-compatible import to `domino` (#<issue-num>)"}
{"prompt": " file path A: tools/testing/node_tests.init.ts | file path B: tools/testing/node_tests.init.ts\n\n@@ -14,11 +14,6 @@ import 'zone.js/lib/zone-spec/sync-test';\n import 'zone.js/lib/testing/async-testing';\n import 'zone.js/lib/testing/fake-async';\n import 'reflect-metadata/Reflect';\n-\n-// Initialize jasmine with @bazel/jasmine boot() function. This will initialize\n-// global.jasmine so that it can be patched by zone.js jasmine-patch.js.\n-(await import('@bazel/jasmine' as any)).boot();\n-\n import 'zone.js/lib/jasmine/jasmine';\n \n (global as any).isNode = true;\n\n\n###\n\n", "completion": "build: remove unnecessary import to `@bazel/jasmine` (#<issue-num>)"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -106,6 +106,7 @@ yarn_install(\n         \"//:scripts/webdriver-manager-update.js\",\n         \"//tools:postinstall-patches.js\",\n         \"//tools/esm-interop:patches/npm/@bazel+concatjs+5.7.1.patch\",\n+        \"//tools/esm-interop:patches/npm/rxjs+6.6.7.patch\",\n     ],\n     # Currently disabled due to:\n     #  1. Missing Windows support currently.\n\n---\n file path A: tools/esm-interop/esm-extension-loader.mjs | file path B: tools/esm-interop/esm-extension-loader.mjs\n\n@@ -46,6 +46,10 @@ export async function resolve(specifier, context, nextResolve) {\n   if (!explicitExtensionRe.test(specifier)) {\n     interopAttempts.push(`${specifier}.mjs`);\n     interopAttempts.push(`${specifier}/index.mjs`);\n+    // Last attempts are normal `.js` extensions. These could still\n+    // be valid ESM when there is an type:module `package.json` file\n+    interopAttempts.push(`${specifier}.js`);\n+    interopAttempts.push(`${specifier}/index.js`);\n   }\n \n   for (const attempt of interopAttempts) {\n\n---\n file path A: tools/esm-interop/esm-node-module-loader.mjs | file path B: tools/esm-interop/esm-node-module-loader.mjs\n\n@@ -104,7 +104,11 @@ function resolvePackageWithExportsSupport(pathToNodeModule, packageImport) {\n   const packageJson = JSON.parse(\n     fs.readFileSync(path.join(pathToNodeModule, 'package.json'), 'utf8')\n   );\n-  const localPackagePath = resolvePackageLocalFilepath(packageImport, packageJson);\n+  const localPackagePath = resolvePackageLocalFilepath(\n+    pathToNodeModule,\n+    packageImport,\n+    packageJson\n+  );\n   const resolvedFilePath = path.join(pathToNodeModule, localPackagePath);\n \n   if (fs.existsSync(resolvedFilePath)) {\n@@ -117,9 +121,23 @@ function resolvePackageWithExportsSupport(pathToNodeModule, packageImport) {\n  * Resolves the remaining package-local portion of an import. Leverages\n  * the `package.json` `exports` field information for resolution.\n  */\n-function resolvePackageLocalFilepath(packageImport, packageJson) {\n+function resolvePackageLocalFilepath(pathToNodeModule, packageImport, packageJson) {\n   if (packageJson.exports) {\n     return resolveExports(packageJson, packageImport.specifier);\n   }\n-  return packageImport.pathInPackage || packageJson.module || packageJson.main || 'index.js';\n+\n+  // If we couldn't resolve the subpath via `exports`, we check if the subpath\n+  // already points to an explicit file, or respect deep `package.json` files.\n+  if (packageImport.pathInPackage !== '') {\n+    const fullPath = path.join(pathToNodeModule, packageImport.pathInPackage);\n+    const deepPackageJsonPath = path.join(fullPath, 'package.json');\n+\n+    if (fs.existsSync(deepPackageJsonPath)) {\n+      packageJson = JSON.parse(fs.readFileSync(deepPackageJsonPath, 'utf8'));\n+    } else if (fs.existsSync(fullPath)) {\n+      return packageImport.pathInPackage;\n+    }\n+  }\n+\n+  return packageJson.module || packageJson.main || 'index.js';\n }\n\n---\n file path A: None | file path B: tools/esm-interop/patches/npm/rxjs+6.6.7.patch\n\n@@ -0,0 +1,20 @@\n+diff --git a/node_modules/rxjs/_esm2015/package.json b/node_modules/rxjs/_esm2015/package.json\n+new file mode 100644\n+index 0000000..9f2258e\n+--- /dev/null\n++++ b/node_modules/rxjs/_esm2015/package.json\n+@@ -0,0 +1,4 @@\n++{\n++    \"type\": \"module\",\n++    \"sideEffects\": false\n++}\n+diff --git a/node_modules/rxjs/_esm5/package.json b/node_modules/rxjs/_esm5/package.json\n+new file mode 100644\n+index 0000000..9f2258e\n+--- /dev/null\n++++ b/node_modules/rxjs/_esm5/package.json\n+@@ -0,0 +1,4 @@\n++{\n++    \"type\": \"module\",\n++    \"sideEffects\": false\n++}\n\n\n###\n\n", "completion": "build: fix loader and support rxjs to be used in NodeJS ESM (#<issue-num>)"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -105,6 +105,7 @@ yarn_install(\n         \"//:scripts/puppeteer-chromedriver-versions.js\",\n         \"//:scripts/webdriver-manager-update.js\",\n         \"//tools:postinstall-patches.js\",\n+        \"//tools/esm-interop:patches/npm/@bazel+concatjs+5.7.1.patch\",\n     ],\n     # Currently disabled due to:\n     #  1. Missing Windows support currently.\n\n---\n file path A: package.json | file path B: package.json\n\n@@ -22,7 +22,7 @@\n     \"// 2\": \"Find the usage you are looking for with:\",\n     \"// 3\": \"yarn ng-dev --help\",\n     \"/ \": \"\",\n-    \"postinstall\": \"node scripts/webdriver-manager-update.js && node --preserve-symlinks --preserve-symlinks-main ./tools/postinstall-patches.js\",\n+    \"postinstall\": \"node scripts/webdriver-manager-update.js && node --preserve-symlinks --preserve-symlinks-main ./tools/postinstall-patches.js && patch-package --patch-dir tools/esm-interop/patches/npm\",\n     \"prepare\": \"husky install\",\n     \"ng-dev\": \"cross-env TS_NODE_PROJECT=$PWD/.ng-dev/tsconfig.json TS_NODE_TRANSPILE_ONLY=1 node --no-warnings --loader ts-node/esm node_modules/@angular/ng-dev/bundles/cli.mjs\",\n     \"build\": \"ts-node --esm --project scripts/tsconfig.json scripts/build/build-packages-dist.mts\",\n@@ -206,6 +206,7 @@\n     \"madge\": \"^5.0.0\",\n     \"minimist\": \"^1.2.0\",\n     \"multimatch\": \"^6.0.0\",\n+    \"patch-package\": \"^6.5.0\",\n     \"prettier\": \"^2.5.1\",\n     \"sauce-connect\": \"https://saucelabs.com/downloads/sc-4.8.1-linux.tar.gz\",\n     \"semver\": \"^7.3.5\",\n\n---\n file path A: None | file path B: tools/esm-interop/patches/npm/@bazel+concatjs+5.7.1.patch\n\n@@ -0,0 +1,57 @@\n+diff --git a/node_modules/@bazel/concatjs/internal/common/compilation.bzl b/node_modules/@bazel/concatjs/internal/common/compilation.bzl\n+index fed787a..ec76478 100755\n+--- a/node_modules/@bazel/concatjs/internal/common/compilation.bzl\n++++ b/node_modules/@bazel/concatjs/internal/common/compilation.bzl\n+@@ -272,10 +272,6 @@ def compile_ts(\n+     # Not all existing implementations of outputs() may return transpilation_infos\n+     transpilation_infos = getattr(outs, \"transpilation_infos\", [])\n+ \n+-    if has_sources and _get_runtime(ctx) != \"nodejs\":\n+-        # Note: setting this variable controls whether tsickle is run at all.\n+-        tsickle_externs = [ctx.actions.declare_file(ctx.label.name + \".externs.js\")]\n+-\n+     dep_declarations = _collect_dep_declarations(ctx, declaration_infos)\n+ \n+     type_blocklisted_declarations = dep_declarations.type_blocklisted_declarations\n+@@ -298,7 +294,6 @@ def compile_ts(\n+         perf_trace = str(ctx.label) == ctx.var[\"TYPESCRIPT_PERF_TRACE_TARGET\"]\n+ \n+     compilation_inputs = dep_declarations.transitive_declarations.to_list() + srcs_files\n+-    tsickle_externs_path = tsickle_externs[0] if tsickle_externs else None\n+ \n+     # Calculate allowed dependencies for strict deps enforcement.\n+     allowed_deps = depset(\n+@@ -313,7 +308,7 @@ def compile_ts(\n+         compilation_inputs,\n+         srcs_files,\n+         jsx_factory = jsx_factory,\n+-        tsickle_externs = tsickle_externs_path,\n++        tsickle_externs = None,\n+         type_blocklisted_declarations = type_blocklisted_declarations.to_list(),\n+         allowed_deps = allowed_deps,\n+     )\n+@@ -322,7 +317,7 @@ def compile_ts(\n+     # .d.ts (or even errors) from the altered Closure-style JS emit.\n+     tsconfig_es6[\"compilerOptions\"][\"declaration\"] = False\n+     tsconfig_es6[\"compilerOptions\"].pop(\"declarationDir\")\n+-    outputs = transpiled_closure_js + tsickle_externs\n++    outputs = transpiled_closure_js\n+ \n+     node_profile_args = []\n+     if perf_trace and has_sources:\n+@@ -412,13 +407,13 @@ def compile_ts(\n+     # both ts_library and ts_declarations generate .mjs files:\n+     # - for libraries, this is the ES6/production code\n+     # - for declarations, these are generated shims\n+-    es6_sources = depset(transpiled_closure_js + tsickle_externs)\n++    es6_sources = depset(transpiled_closure_js)\n+     if is_library:\n+         es5_sources = depset(transpiled_devmode_js)\n+     else:\n+         # In development mode, no code ever references shims as they only\n+         # contain types, and the ES5 code does not get type annotated.\n+-        es5_sources = depset(tsickle_externs)\n++        es5_sources = depset()\n+ \n+         # Similarly, in devmode these sources do not get loaded, so do not need\n+         # to be in a manifest.\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -8448,6 +8448,13 @@ find-up@^5.0.0:\n     locate-path \"^6.0.0\"\n     path-exists \"^4.0.0\"\n \n+find-yarn-workspace-root@^2.0.0:\n+  version \"2.0.0\"\n+  resolved \"https://registry.yarnpkg.com/find-yarn-workspace-root/-/find-yarn-workspace-root-2.0.0.tgz#f47fb8d239c900eb78179aa81b66673eac88f7bd\"\n+  integrity sha512-1IMnbjt4KzsQfnhnzNd8wUEgXZ44IzZaZmnLYx7D5FZlaHt2gW20Cri8Q+E/t5tIj4+epTBub+2Zxu/vNILzqQ==\n+  dependencies:\n+    micromatch \"^4.0.2\"\n+\n findup-sync@^2.0.0:\n   version \"2.0.0\"\n   resolved \"https://registry.yarnpkg.com/findup-sync/-/findup-sync-2.0.0.tgz#9326b1488c22d1a6088650a86901b2d9a90a2cbc\"\n@@ -8688,6 +8695,15 @@ fs-extra@^10.1.0:\n     jsonfile \"^6.0.1\"\n     universalify \"^2.0.0\"\n \n+fs-extra@^7.0.1, fs-extra@~7.0.1:\n+  version \"7.0.1\"\n+  resolved \"https://registry.yarnpkg.com/fs-extra/-/fs-extra-7.0.1.tgz#4f189c44aa123b895f722804f55ea23eadc348e9\"\n+  integrity sha512-YJDaCJZEnBmcbw13fvdAM9AwNOJwOzrE4pqMqBq5nFiEqXUqHwlK4B+3pUw6JNvfSPtX05xFHtYy/1ni01eGCw==\n+  dependencies:\n+    graceful-fs \"^4.1.2\"\n+    jsonfile \"^4.0.0\"\n+    universalify \"^0.1.0\"\n+\n fs-extra@^8.1.0:\n   version \"8.1.0\"\n   resolved \"https://registry.yarnpkg.com/fs-extra/-/fs-extra-8.1.0.tgz#49d43c45a88cd9677668cb7be1b46efdb8d2e1c0\"\n@@ -8707,15 +8723,6 @@ fs-extra@^9.0.1:\n     jsonfile \"^6.0.1\"\n     universalify \"^2.0.0\"\n \n-fs-extra@~7.0.1:\n-  version \"7.0.1\"\n-  resolved \"https://registry.yarnpkg.com/fs-extra/-/fs-extra-7.0.1.tgz#4f189c44aa123b895f722804f55ea23eadc348e9\"\n-  integrity sha512-YJDaCJZEnBmcbw13fvdAM9AwNOJwOzrE4pqMqBq5nFiEqXUqHwlK4B+3pUw6JNvfSPtX05xFHtYy/1ni01eGCw==\n-  dependencies:\n-    graceful-fs \"^4.1.2\"\n-    jsonfile \"^4.0.0\"\n-    universalify \"^0.1.0\"\n-\n fs-minipass@^2.0.0, fs-minipass@^2.1.0:\n   version \"2.1.0\"\n   resolved \"https://registry.yarnpkg.com/fs-minipass/-/fs-minipass-2.1.0.tgz#7f5036fdbf12c63c169190cbe4199c852271f9fb\"\n@@ -10404,7 +10411,7 @@ is-wsl@^1.1.0:\n   resolved \"https://registry.yarnpkg.com/is-wsl/-/is-wsl-1.1.0.tgz#1f16e4aa22b04d1336b66188a66af3c600c3a66d\"\n   integrity sha512-gfygJYZ2gLTDlmbWMI0CE2MwnFzSN/2SZfkMlItC4K/JBlsWVDB0bO6XhqcY13YXE7iMcAJnzTCJjPiTeJJ0Mw==\n \n-is-wsl@^2.2.0:\n+is-wsl@^2.1.1, is-wsl@^2.2.0:\n   version \"2.2.0\"\n   resolved \"https://registry.yarnpkg.com/is-wsl/-/is-wsl-2.2.0.tgz#74a4c76e77ca9fd3f932f290c17ea326cd157271\"\n   integrity sha512-fKzAra0rGJUUBwGBgNkHZuToZcn+TtXHpeCgmkMJMMYx1sQDYaCSyjJBSCa2nH1DGm7s3n1oBnohoVTBaN7Lww==\n@@ -10956,6 +10963,13 @@ kind-of@^6.0.0, kind-of@^6.0.2, kind-of@^6.0.3:\n   resolved \"https://registry.yarnpkg.com/kind-of/-/kind-of-6.0.3.tgz#07c05034a6c349fa06e24fa35aa76db4580ce4dd\"\n   integrity sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==\n \n+klaw-sync@^6.0.0:\n+  version \"6.0.0\"\n+  resolved \"https://registry.yarnpkg.com/klaw-sync/-/klaw-sync-6.0.0.tgz#1fd2cfd56ebb6250181114f0a581167099c2b28c\"\n+  integrity sha512-nIeuVSzdCCs6TDPTqI8w1Yre34sSq7AkZ4B3sfOBbI2CgVSB4Du4aLQijFU2+lhAFCwt9+42Hel6lQNIv6AntQ==\n+  dependencies:\n+    graceful-fs \"^4.1.11\"\n+\n klona@^2.0.4, klona@^2.0.5:\n   version \"2.0.5\"\n   resolved \"https://registry.yarnpkg.com/klona/-/klona-2.0.5.tgz#d166574d90076395d9963aa7a928fabb8d76afbc\"\n@@ -12465,6 +12479,14 @@ open@^6.3.0:\n   dependencies:\n     is-wsl \"^1.1.0\"\n \n+open@^7.4.2:\n+  version \"7.4.2\"\n+  resolved \"https://registry.yarnpkg.com/open/-/open-7.4.2.tgz#b8147e26dcf3e426316c730089fd71edd29c2321\"\n+  integrity sha512-MVHddDVweXZF3awtlAS+6pgKLlm/JgxZ90+/NBurBoQctVOOB/zDdVjcyPzQ+0laDGbsWgrRkflI65sQeOgT9Q==\n+  dependencies:\n+    is-docker \"^2.0.0\"\n+    is-wsl \"^2.1.1\"\n+\n openapi3-ts@^2.0.1:\n   version \"2.0.2\"\n   resolved \"https://registry.yarnpkg.com/openapi3-ts/-/openapi3-ts-2.0.2.tgz#a200dd838bf24c9086c8eedcfeb380b7eb31e82a\"\n@@ -12829,6 +12851,26 @@ passerror@1.1.1, passerror@^1.1.1:\n   resolved \"https://registry.yarnpkg.com/passerror/-/passerror-1.1.1.tgz#a25b88dbdd910a29603aec7dcb96e9a7a97687b4\"\n   integrity sha512-PwrEQJBkJMxnxG+tdraz95vTstYnCRqiURNbGtg/vZHLgcAODc9hbiD5ZumGUoh3bpw0F0qKLje7Vd2Fd5Lx3g==\n \n+patch-package@^6.5.0:\n+  version \"6.5.0\"\n+  resolved \"https://registry.yarnpkg.com/patch-package/-/patch-package-6.5.0.tgz#feb058db56f0005da59cfa316488321de585e88a\"\n+  integrity sha512-tC3EqJmo74yKqfsMzELaFwxOAu6FH6t+FzFOsnWAuARm7/n2xB5AOeOueE221eM9gtMuIKMKpF9tBy/X2mNP0Q==\n+  dependencies:\n+    \"@yarnpkg/lockfile\" \"^1.1.0\"\n+    chalk \"^4.1.2\"\n+    cross-spawn \"^6.0.5\"\n+    find-yarn-workspace-root \"^2.0.0\"\n+    fs-extra \"^7.0.1\"\n+    is-ci \"^2.0.0\"\n+    klaw-sync \"^6.0.0\"\n+    minimist \"^1.2.6\"\n+    open \"^7.4.2\"\n+    rimraf \"^2.6.3\"\n+    semver \"^5.6.0\"\n+    slash \"^2.0.0\"\n+    tmp \"^0.0.33\"\n+    yaml \"^1.10.2\"\n+\n path-case@^3.0.4:\n   version \"3.0.4\"\n   resolved \"https://registry.yarnpkg.com/path-case/-/path-case-3.0.4.tgz#9168645334eb942658375c56f80b4c0cb5f82c6f\"\n@@ -14002,7 +14044,7 @@ rgb2hex@0.2.3:\n   resolved \"https://registry.yarnpkg.com/rgb2hex/-/rgb2hex-0.2.3.tgz#8aa464c517b8a26c7a79d767dabaec2b49ee78ec\"\n   integrity sha512-clEe0m1xv+Tva1B/TOepuIcvLAxP0U+sCDfgt1SX1HmI2Ahr5/Cd/nzJM1e78NKVtWdoo0s33YehpFA8UfIShQ==\n \n-rimraf@2, rimraf@^2.2.8, rimraf@^2.5.2, rimraf@^2.5.4:\n+rimraf@2, rimraf@^2.2.8, rimraf@^2.5.2, rimraf@^2.5.4, rimraf@^2.6.3:\n   version \"2.7.1\"\n   resolved \"https://registry.yarnpkg.com/rimraf/-/rimraf-2.7.1.tgz#35797f13a7fdadc566142c29d4f07ccad483e3ec\"\n   integrity sha512-uWjbaKIK3T1OSVptzX7Nl6PvQ3qAGtKEtVRjRuazjfL3Bx5eI409VZSqgND+4UNnmzLVdPj9FqFJNPqBZFve4w==\n\n\n###\n\n", "completion": "build: patch `ts_library` to not emit a tsickle extern file (#<issue-num>)"}
{"prompt": " file path A: packages/zone.js/test/BUILD.bazel | file path B: packages/zone.js/test/BUILD.bazel\n\n@@ -87,7 +87,7 @@ ts_library(\n ts_library(\n     name = \"node_entry_point\",\n     testonly = True,\n-    srcs = [\"node_entry_point.ts\"],\n+    srcs = [\"node_entry_point.init.ts\"],\n     deps = [\n         \":common_spec_env\",\n         \":common_spec_srcs\",\n@@ -104,7 +104,7 @@ ts_library(\n ts_library(\n     name = \"node_entry_point_no_patch_clock\",\n     testonly = True,\n-    srcs = [\"node_entry_point_no_patch_clock.ts\"],\n+    srcs = [\"node_entry_point_no_patch_clock.init.ts\"],\n     deps = [\n         \":common_spec_env\",\n         \":common_spec_srcs\",\n@@ -134,7 +134,7 @@ ts_library(\n ts_library(\n     name = \"node_bluebird_entry_point\",\n     testonly = True,\n-    srcs = [\"node_bluebird_entry_point.ts\"],\n+    srcs = [\"node_bluebird_entry_point.init.ts\"],\n     deps = [\n         \":common_spec_env\",\n         \"//packages/zone.js/lib\",\n@@ -145,7 +145,7 @@ ts_library(\n ts_library(\n     name = \"node_error_disable_policy_entry_point\",\n     testonly = True,\n-    srcs = [\"node_error_disable_policy_entry_point.ts\"],\n+    srcs = [\"node_error_disable_policy_entry_point.init.ts\"],\n     deps = [\n         \":common_spec_env\",\n         \":common_spec_util\",\n@@ -158,7 +158,7 @@ ts_library(\n ts_library(\n     name = \"node_error_entry_point\",\n     testonly = True,\n-    srcs = [\"node_error_entry_point.ts\"],\n+    srcs = [\"node_error_entry_point.init.ts\"],\n     deps = [\n         \":common_spec_env\",\n         \":common_spec_util\",\n@@ -170,7 +170,7 @@ ts_library(\n ts_library(\n     name = \"node_error_lazy_policy_entry_point\",\n     testonly = True,\n-    srcs = [\"node_error_lazy_policy_entry_point.ts\"],\n+    srcs = [\"node_error_lazy_policy_entry_point.init.ts\"],\n     deps = [\n         \":common_spec_env\",\n         \":common_spec_util\",\n\n---\n file path A: packages/zone.js/test/node_bluebird_entry_point.ts | file path B: packages/zone.js/test/node_bluebird_entry_point.init.ts\n\n\n---\n file path A: packages/zone.js/test/node_entry_point.ts | file path B: packages/zone.js/test/node_entry_point.init.ts\n\n\n---\n file path A: packages/zone.js/test/node_entry_point_no_patch_clock.ts | file path B: packages/zone.js/test/node_entry_point_no_patch_clock.init.ts\n\n\n---\n file path A: packages/zone.js/test/node_error_disable_policy_entry_point.ts | file path B: packages/zone.js/test/node_error_disable_policy_entry_point.init.ts\n\n\n---\n file path A: packages/zone.js/test/node_error_entry_point.ts | file path B: packages/zone.js/test/node_error_entry_point.init.ts\n\n\n---\n file path A: packages/zone.js/test/node_error_lazy_policy_entry_point.ts | file path B: packages/zone.js/test/node_error_lazy_policy_entry_point.init.ts\n\n\n---\n file path A: tools/defaults.bzl | file path B: tools/defaults.bzl\n\n@@ -15,6 +15,7 @@ load(\"@npm//@angular/build-tooling/bazel/api-golden:index.bzl\", _api_golden_test\n load(\"@npm//@angular/build-tooling/bazel:extract_js_module_output.bzl\", \"extract_js_module_output\")\n load(\"@npm//@angular/build-tooling/bazel:extract_types.bzl\", _extract_types = \"extract_types\")\n load(\"@npm//@angular/build-tooling/bazel/esbuild:index.bzl\", _esbuild = \"esbuild\", _esbuild_config = \"esbuild_config\")\n+load(\"@npm//@angular/build-tooling/bazel/spec-bundling:spec-entrypoint.bzl\", \"spec_entrypoint\")\n load(\"@npm//tsec:index.bzl\", _tsec_test = \"tsec_test\")\n load(\"//packages/bazel:index.bzl\", _ng_module = \"ng_module\", _ng_package = \"ng_package\")\n load(\"//tools/esm-interop:index.bzl\", \"enable_esm_node_module_loader\", \"extract_esm_outputs\")\n@@ -455,32 +456,7 @@ def npm_package_bin(args = [], **kwargs):\n         **kwargs\n     )\n \n-def jasmine_node_test(bootstrap = [], **kwargs):\n-    \"\"\"Default values for jasmine_node_test\n-\n-    Args:\n-      bootstrap: A list of labels of scripts to run before the entry_point.\n-\n-                 The labels can either be individual files or a filegroup that contain a single\n-                 file.\n-\n-                 The label is automatically added to the deps of jasmine_node_test.\n-                 If the label ends in `_files` which by convention selects the JS outputs\n-                 of a ts_library rule, then corresponding ts_library target sans `_files`\n-                 is also added to the deps of jasmine_node_test.\n-\n-                 For example with,\n-\n-                 jasmine_node_test(\n-                     name = \"test\",\n-                     bootstrap = [\"//tools/testing:node_files\"],\n-                     deps = [\":test_lib\"],\n-                 )\n-\n-                 the `//tools/testing:node` target will automatically get added to deps\n-                 by this macro. This removes the need for duplicate deps on the\n-                 target and makes the usage of this rule less verbose.\"\"\"\n-\n+def jasmine_node_test(name, srcs = [], bootstrap = [], env = {}, **kwargs):\n     # Very common dependencies for tests\n     deps = kwargs.pop(\"deps\", []) + [\n         \"@npm//chokidar\",\n@@ -497,20 +473,37 @@ def jasmine_node_test(bootstrap = [], **kwargs):\n     # and is less prone to race conditions when targets build concurrently.\n     templated_args = [\"--nobazel_run_linker\"] + kwargs.pop(\"templated_args\", [])\n \n-    for label in bootstrap:\n-        deps.append(label)\n-        templated_args.append(\"--node_options=--require=$$(rlocation $(rootpath %s))\" % label)\n-        if label.endswith(\"_files\"):\n-            # If this label is a filegroup derived from a ts_library then automatically\n-            # add the ts_library target (which is the label sans `_files`) to deps so we pull\n-            # in all of its transitive deps. This removes the need for duplicate deps on the\n-            # target and makes the usage of this rule less verbose.\n-            deps.append(label[:-len(\"_files\")])\n+    # We disable the linker, so the ESM node module loader needs to be enabled.\n+    npm_workspace = _node_modules_workspace_name()\n+    env = enable_esm_node_module_loader(npm_workspace, env)\n+\n+    extract_esm_outputs(\n+        name = \"%s_esm_deps\" % name,\n+        testonly = True,\n+        deps = deps + srcs,\n+    )\n+\n+    extract_esm_outputs(\n+        name = \"%s_esm_bootstrap\" % name,\n+        testonly = True,\n+        deps = bootstrap,\n+    )\n+\n+    spec_entrypoint(\n+        name = \"%s_spec_entrypoint.spec\" % name,\n+        testonly = True,\n+        deps = [\"%s_esm_deps\" % name],\n+        bootstrap = [\"%s_esm_bootstrap\" % name],\n+    )\n \n     _jasmine_node_test(\n-        deps = deps,\n+        name = name,\n+        srcs = [\":%s_spec_entrypoint.spec\" % name],\n+        use_direct_specs = True,\n         configuration_env_vars = configuration_env_vars,\n+        env = env,\n         templated_args = templated_args,\n+        use_esm = True,\n         **kwargs\n     )\n \n\n---\n file path A: tools/testing/BUILD.bazel | file path B: tools/testing/BUILD.bazel\n\n@@ -5,7 +5,7 @@ package(default_visibility = [\"//visibility:public\"])\n ts_library(\n     name = \"browser\",\n     testonly = 1,\n-    srcs = [\"init_browser_tests.ts\"],\n+    srcs = [\"browser_tests.init.ts\"],\n     deps = [\n         \"//packages/compiler\",\n         \"//packages/core/testing\",\n@@ -17,7 +17,7 @@ ts_library(\n ts_library(\n     name = \"node\",\n     testonly = 1,\n-    srcs = [\"init_node_tests.ts\"],\n+    srcs = [\"node_tests.init.ts\"],\n     deps = [\n         \"//packages/compiler\",\n         \"//packages/core/testing\",\n@@ -31,7 +31,7 @@ ts_library(\n ts_library(\n     name = \"node_no_angular\",\n     testonly = 1,\n-    srcs = [\"init_node_no_angular_tests.ts\"],\n+    srcs = [\"node_no_angular_tests.init.ts\"],\n     deps = [\n         \"//packages:types\",\n     ],\n\n---\n file path A: tools/testing/init_browser_tests.ts | file path B: tools/testing/browser_tests.init.ts\n\n\n---\n file path A: tools/testing/init_node_no_angular_tests.ts | file path B: tools/testing/node_no_angular_tests.init.ts\n\n\n---\n file path A: tools/testing/init_node_tests.ts | file path B: tools/testing/node_tests.init.ts\n\n@@ -17,7 +17,8 @@ import 'reflect-metadata/Reflect';\n \n // Initialize jasmine with @bazel/jasmine boot() function. This will initialize\n // global.jasmine so that it can be patched by zone.js jasmine-patch.js.\n-require('@bazel/jasmine').boot();\n+(await import('@bazel/jasmine' as any)).boot();\n+\n import 'zone.js/lib/jasmine/jasmine';\n \n (global as any).isNode = true;\n\n\n###\n\n", "completion": "build: update `jasmine_node_test` macro to support ESM (#<issue-num>)"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -28,7 +28,7 @@ http_archive(\n     patches = [\n         # TODO(devversion): remove when https://github.com/bazelbuild/rules_nodejs/pull/3605 is available.\n         \"//tools:bazel-repo-patches/rules_nodejs__#3605.patch\",\n-        \"//tools/esm-interop:patches/nodejs_binary_mjs_execution.patch\",\n+        \"//tools/esm-interop:patches/bazel/nodejs_binary_esm_support.patch\",\n     ],\n     sha256 = \"c29944ba9b0b430aadcaf3bf2570fece6fc5ebfb76df145c6cdad40d65c20811\",\n     urls = [\"https://github.com/bazelbuild/rules_nodejs/releases/download/5.7.0/rules_nodejs-5.7.0.tar.gz\"],\n\n---\n file path A: tools/defaults.bzl | file path B: tools/defaults.bzl\n\n@@ -17,7 +17,7 @@ load(\"@npm//@angular/build-tooling/bazel:extract_types.bzl\", _extract_types = \"e\n load(\"@npm//@angular/build-tooling/bazel/esbuild:index.bzl\", _esbuild = \"esbuild\", _esbuild_config = \"esbuild_config\")\n load(\"@npm//tsec:index.bzl\", _tsec_test = \"tsec_test\")\n load(\"//packages/bazel:index.bzl\", _ng_module = \"ng_module\", _ng_package = \"ng_package\")\n-load(\"//tools/esm-interop:index.bzl\", \"enable_esm_node_module_loader\", \"extract_esm_outputs\", \"install_esm_loaders\")\n+load(\"//tools/esm-interop:index.bzl\", \"enable_esm_node_module_loader\", \"extract_esm_outputs\")\n \n _DEFAULT_TSCONFIG_TEST = \"//packages:tsconfig-test\"\n _INTERNAL_NG_MODULE_COMPILER = \"//packages/bazel/src/ngc-wrapped\"\n@@ -394,9 +394,6 @@ def nodejs_binary(\n         enable_linker = False,\n         **kwargs):\n     npm_workspace = _node_modules_workspace_name()\n-    rule_data = []\n-\n-    (templated_args, rule_data) = install_esm_loaders(templated_args, rule_data)\n \n     if not enable_linker:\n         templated_args = templated_args + [\n@@ -415,7 +412,7 @@ def nodejs_binary(\n \n     _nodejs_binary(\n         name = name,\n-        data = [\":%s_esm_deps\" % name] + rule_data + data_for_args,\n+        data = [\":%s_esm_deps\" % name] + data_for_args,\n         testonly = testonly,\n         entry_point = entry_point.replace(\".js\", \".mjs\"),\n         env = env,\n@@ -425,9 +422,6 @@ def nodejs_binary(\n     )\n \n def nodejs_test(name, data = [], env = {}, data_for_args = [], templated_args = [], enable_linker = False, **kwargs):\n-    rule_data = []\n-    (templated_args, rule_data) = install_esm_loaders(templated_args, rule_data)\n-\n     if not enable_linker:\n         templated_args = templated_args + [\n             # Disable the linker and rely on patched resolution which works better on Windows\n@@ -446,7 +440,7 @@ def nodejs_test(name, data = [], env = {}, data_for_args = [], templated_args =\n \n     _nodejs_test(\n         name = name,\n-        data = [\":%s_esm_deps\" % name] + rule_data + data_for_args,\n+        data = [\":%s_esm_deps\" % name] + data_for_args,\n         env = env,\n         templated_args = templated_args,\n         use_esm = True,\n\n---\n file path A: tools/esm-interop/esm-loaders.bzl | file path B: None\n\n@@ -1,26 +0,0 @@\n-\"\"\"ESM loader helpers.\"\"\"\n-\n-def install_esm_loaders(\n-        templated_args,\n-        data):\n-    \"\"\"Installs a NodeJS import loader for ESM support. Individual loades may \\\n-      be controlled via environment variables.\n-\n-    Args:\n-      templated_args: Existing list of arguments passed to the binary/test.\n-      data: Existing runtime dependencies for the binary/test.\n-\n-    Returns:\n-      A ruple with the updated `templated_args` and `data`.\n-    \"\"\"\n-\n-    templated_args = templated_args + [\n-        \"--node_options=--experimental-loader=file:///$$(rlocation $(rootpath //tools/esm-interop:esm-main-loader.mjs))\",\n-        \"--node_options=--no-warnings\",  # `--loader` is an experimental feature with warnings.\n-    ]\n-    data = data + [\n-        \"//tools/esm-interop:esm-main-loader.mjs\",\n-        \"//tools/esm-interop:loaders\",\n-    ]\n-\n-    return (templated_args, data)\n\n---\n file path A: tools/esm-interop/index.bzl | file path B: tools/esm-interop/index.bzl\n\n@@ -2,9 +2,7 @@\n \n load(\"@npm//@angular/build-tooling/bazel:extract_js_module_output.bzl\", \"extract_js_module_output\")\n load(\"//tools/esm-interop:esm-node-module-loader.bzl\", _enable_esm_node_module_loader = \"enable_esm_node_module_loader\")\n-load(\"//tools/esm-interop:esm-loaders.bzl\", _install_esm_loaders = \"install_esm_loaders\")\n \n-install_esm_loaders = _install_esm_loaders\n enable_esm_node_module_loader = _enable_esm_node_module_loader\n \n def extract_esm_outputs(name, deps, testonly = False):\n\n---\n file path A: tools/esm-interop/patches/bazel/nodejs_binary_mjs_execution.patch | file path B: tools/esm-interop/patches/bazel/nodejs_binary_esm_support.patch\n\n@@ -1,5 +1,22 @@\n+diff --git internal/node/launcher.sh internal/node/launcher.sh\n+index 191622f..24b475e 100755\n+--- internal/node/launcher.sh\n++++ internal/node/launcher.sh\n+@@ -352,6 +352,12 @@ if [ \"$PATCH_REQUIRE\" = true ]; then\n+   LAUNCHER_NODE_OPTIONS+=( \"--require\" \"$require_patch_script\" )\n+ fi\n+\n++if [[ \"TEMPLATED_use_esm\" == \"true\" ]]; then\n++  esmLoaderPath=$(rlocation  \"angular/tools/esm-interop/esm-main-loader.mjs\")\n++  LAUNCHER_NODE_OPTIONS+=( \"--loader\" \"file://$esmLoaderPath\" )\n++  LAUNCHER_NODE_OPTIONS+=( \"--no-warnings\" )\n++fi\n++\n+ # Entry point is the user-supplied script\n+ MAIN=\"${PWD}/\"TEMPLATED_entry_point_execroot_path\n+ # TODO: after we link-all-bins we should not need this extra lookup\n diff --git internal/node/node.bzl internal/node/node.bzl\n-index 3b8ce74..2e643cc 100755\n+index 3b8ce74..85bc77d 100755\n --- internal/node/node.bzl\n +++ internal/node/node.bzl\n @@ -93,7 +93,7 @@ def _write_require_patch_script(ctx, data, node_modules_root):\n@@ -25,7 +42,15 @@ index 3b8ce74..2e643cc 100755\n      elif entry_point_path.endswith(\".tsx\"):\n          return entry_point_path[:-4] + \".js\"\n      return entry_point_path\n-@@ -333,8 +338,8 @@ if (process.cwd() !== __dirname) {\n+@@ -322,6 +327,7 @@ if (process.cwd() !== __dirname) {\n+         \"TEMPLATED_node_patches_script\": _to_manifest_path(ctx, ctx.file._node_patches_script),\n+         \"TEMPLATED_require_patch_script\": _to_manifest_path(ctx, ctx.outputs.require_patch_script),\n+         \"TEMPLATED_runfiles_helper_script\": _to_manifest_path(ctx, ctx.file._runfile_helpers_main),\n++        \"TEMPLATED_use_esm\": \"true\" if ctx.attr.use_esm else \"false\",\n+         \"TEMPLATED_node_tool_path\": strip_external(node_toolchain.nodeinfo.target_tool_path),\n+         \"TEMPLATED_node_args\": ctx.attr._node_args[UserBuildSettingInfo].value,\n+         \"TEMPLATED_chdir\": chdir_script_runfiles_path if ctx.attr.chdir else \"\",\n+@@ -333,8 +339,8 @@ if (process.cwd() !== __dirname) {\n      #else:\n      #    substitutions[\"TEMPLATED_script_path\"] = \"$(rlocation \\\"%s\\\")\" % _to_manifest_path(ctx, ctx.file.entry_point)\n      # For now we need to look in both places\n@@ -36,7 +61,7 @@ index 3b8ce74..2e643cc 100755\n      if DirectoryFilePathInfo in ctx.attr.entry_point:\n          substitutions[\"TEMPLATED_entry_point_main\"] = ctx.attr.entry_point[DirectoryFilePathInfo].path\n      else:\n-@@ -355,7 +360,7 @@ if (process.cwd() !== __dirname) {\n+@@ -355,7 +361,7 @@ if (process.cwd() !== __dirname) {\n \n      # Note: `to_list()` is expensive and should only be called once.\n      sources_list = sources.to_list()\n@@ -45,10 +70,24 @@ index 3b8ce74..2e643cc 100755\n      entry_point_script = None\n \n      for f in sources_list:\n-@@ -631,6 +636,7 @@ Predefined genrule variables are not supported in this context.\n+@@ -370,6 +376,9 @@ if (process.cwd() !== __dirname) {\n+         # need to explicitly repeat the entry point in the `data` attribute.\n+         runfiles.append(entry_point_script)\n+\n++    if ctx.attr.use_esm:\n++        node_tool_files.extend(ctx.files._esm_interop_runfiles)\n++\n+     return [\n+         DefaultInfo(\n+             executable = executable,\n+@@ -631,6 +640,11 @@ Predefined genrule variables are not supported in this context.\n          ],\n          allow_files = True,\n      ),\n++    \"_esm_interop_runfiles\": attr.label_list(\n++        default = [\"@angular//tools/esm-interop:loaders\"],\n++        allow_files = True,\n++    ),\n +    \"use_esm\": attr.bool(default = False),\n  }\n \n\n\n###\n\n", "completion": "build: support enabling esm interop loader even outside of `defaults.bzl` (#<issue-num>)"}
{"prompt": " file path A: packages/core/test/BUILD.bazel | file path B: packages/core/test/BUILD.bazel\n\n@@ -5,13 +5,13 @@ package(default_visibility = [\"//visibility:public\"])\n \n circular_dependency_test(\n     name = \"circular_deps_test\",\n-    entry_point = \"angular/packages/core/index.js\",\n+    entry_point = \"angular/packages/core/index.mjs\",\n     deps = [\"//packages/core\"],\n )\n \n circular_dependency_test(\n     name = \"testing_circular_deps_test\",\n-    entry_point = \"angular/packages/core/testing/index.js\",\n+    entry_point = \"angular/packages/core/testing/index.mjs\",\n     deps = [\"//packages/core/testing\"],\n )\n \n\n\n###\n\n", "completion": "build: update madge circular deps tests to use `.mjs` output (#<issue-num>)"}
{"prompt": " file path A: tools/esm-interop/index.bzl | file path B: tools/esm-interop/index.bzl\n\n@@ -18,6 +18,6 @@ def extract_esm_outputs(name, deps, testonly = False):\n         provider = \"JSEcmaScriptModuleInfo\",\n         forward_linker_mappings = True,\n         include_external_npm_packages = True,\n-        include_default_files = False,\n+        include_default_files = True,\n         include_declarations = False,\n     )\n\n\n###\n\n", "completion": "build: include default files when extracting ESM outputs (#<issue-num>)"}
{"prompt": " file path A: tools/esm-interop/patches/nodejs_binary_mjs_execution.patch | file path B: tools/esm-interop/patches/bazel/nodejs_binary_mjs_execution.patch\n\n\n\n###\n\n", "completion": "build: move nodejs binary patch into more obvious place (#<issue-num>)"}
{"prompt": " file path A: tools/circular_dependency_test/index.bzl | file path B: tools/circular_dependency_test/index.bzl\n\n@@ -15,8 +15,9 @@ MADGE_CONFIG_LABEL = \"//tools/circular_dependency_test:madge-resolve.config.js\"\n def circular_dependency_test(name, deps, entry_point, **kwargs):\n     nodejs_test(\n         name = name,\n-        data = [\"@npm//madge\", MADGE_CONFIG_LABEL] + deps,\n+        data = [\"@npm//madge\"] + deps,\n         entry_point = \"@npm//:node_modules/madge/bin/cli.js\",\n+        data_for_args = [MADGE_CONFIG_LABEL],\n         templated_args = [\n             \"--circular\",\n             \"--no-spinner\",\n\n---\n file path A: tools/defaults.bzl | file path B: tools/defaults.bzl\n\n@@ -389,6 +389,7 @@ def nodejs_binary(\n         testonly = False,\n         data = [],\n         env = {},\n+        data_for_args = [],\n         templated_args = [],\n         enable_linker = False,\n         **kwargs):\n@@ -414,7 +415,7 @@ def nodejs_binary(\n \n     _nodejs_binary(\n         name = name,\n-        data = [\":%s_esm_deps\" % name] + rule_data,\n+        data = [\":%s_esm_deps\" % name] + rule_data + data_for_args,\n         testonly = testonly,\n         entry_point = entry_point.replace(\".js\", \".mjs\"),\n         env = env,\n@@ -423,7 +424,7 @@ def nodejs_binary(\n         **kwargs\n     )\n \n-def nodejs_test(name, data = [], env = {}, templated_args = [], enable_linker = False, **kwargs):\n+def nodejs_test(name, data = [], env = {}, data_for_args = [], templated_args = [], enable_linker = False, **kwargs):\n     rule_data = []\n     (templated_args, rule_data) = install_esm_loaders(templated_args, rule_data)\n \n@@ -445,7 +446,7 @@ def nodejs_test(name, data = [], env = {}, templated_args = [], enable_linker =\n \n     _nodejs_test(\n         name = name,\n-        data = [\":%s_esm_deps\" % name] + rule_data,\n+        data = [\":%s_esm_deps\" % name] + rule_data + data_for_args,\n         env = env,\n         templated_args = templated_args,\n         use_esm = True,\n\n---\n file path A: tools/symbol-extractor/index.bzl | file path B: tools/symbol-extractor/index.bzl\n\n@@ -13,8 +13,6 @@ def js_expected_symbol_test(name, src, golden, data = [], **kwargs):\n     \"\"\"This test verifies that a set of top level symbols from a javascript file match a gold file.\n     \"\"\"\n     all_data = data + [\n-        src,\n-        golden,\n         Label(\"//tools/symbol-extractor:lib\"),\n         Label(\"@npm//typescript\"),\n     ]\n@@ -25,9 +23,8 @@ def js_expected_symbol_test(name, src, golden, data = [], **kwargs):\n         data = all_data,\n         entry_point = entry_point,\n         tags = kwargs.pop(\"tags\", []) + [\"symbol_extractor\"],\n-        # Disable the linker and rely on patched resolution which works better on Windows\n-        # and is less prone to race conditions when targets build concurrently.\n-        templated_args = [\"--nobazel_run_linker\", \"$(rootpath %s)\" % src, \"$(rootpath %s)\" % golden],\n+        data_for_args = [src, golden],\n+        templated_args = [\"$(rootpath %s)\" % src, \"$(rootpath %s)\" % golden],\n         **kwargs\n     )\n \n@@ -36,8 +33,7 @@ def js_expected_symbol_test(name, src, golden, data = [], **kwargs):\n         testonly = True,\n         data = all_data,\n         entry_point = entry_point,\n-        # Disable the linker and rely on patched resolution which works better on Windows\n-        # and is less prone to race conditions when targets build concurrently.\n-        templated_args = [\"--nobazel_run_linker\", \"$(rootpath %s)\" % src, \"$(rootpath %s)\" % golden, \"--accept\"],\n+        data_for_args = [src, golden],\n+        templated_args = [\"$(rootpath %s)\" % src, \"$(rootpath %s)\" % golden, \"--accept\"],\n         **kwargs\n     )\n\n\n###\n\n", "completion": "build: support template make variables in `nodejs_binary`/test (#<issue-num>)"}
{"prompt": " file path A: packages/bazel/package.json | file path B: packages/bazel/package.json\n\n@@ -23,7 +23,6 @@\n   },\n   \"dependencies\": {\n     \"@microsoft/api-extractor\": \"^7.24.2\",\n-    \"shelljs\": \"^0.8.5\",\n     \"tsickle\": \"^0.46.3\",\n     \"tslib\": \"^2.3.0\"\n   },\n\n---\n file path A: packages/bazel/src/ng_package/BUILD.bazel | file path B: packages/bazel/src/ng_package/BUILD.bazel\n\n@@ -53,7 +53,6 @@ ts_library(\n     tsconfig = \":tsconfig.json\",\n     deps = [\n         \"@npm//@types/node\",\n-        \"@npm//@types/shelljs\",\n     ],\n )\n \n@@ -69,7 +68,6 @@ nodejs_binary(\n     name = \"packager\",\n     data = [\n         \"lib\",\n-        \"@npm//shelljs\",\n     ],\n     entry_point = \":packager.ts\",\n     # Disable the linker and rely on patched resolution which works better on Windows\n\n---\n file path A: packages/bazel/src/ng_package/packager.ts | file path B: packages/bazel/src/ng_package/packager.ts\n\n@@ -8,7 +8,6 @@\n \n import * as fs from 'fs';\n import * as path from 'path';\n-import * as shx from 'shelljs';\n \n /**\n  * Interface describing a file captured in the Bazel action.\n@@ -86,10 +85,10 @@ type PackageJson = {\n   exports?: Record<string, ConditionalExport>;\n };\n \n-function main(args: string[]): void {\n-  // Exit immediately when encountering an error.\n-  shx.set('-e');\n+// Main entry-point.\n+main(process.argv.slice(2));\n \n+function main(args: string[]): void {\n   // This utility expects all of its arguments to be specified in a params file generated by\n   // bazel (see https://docs.bazel.build/versions/master/skylark/lib/Args.html#use_param_file).\n   const paramFilePath = args[0];\n@@ -152,7 +151,7 @@ function main(args: string[]): void {\n     const outputPath = path.join(outputDirExecPath, outputRelativePath);\n \n     // Always ensure that the target directory exists.\n-    shx.mkdir('-p', path.dirname(outputPath));\n+    fs.mkdirSync(path.dirname(outputPath), {recursive: true});\n     fs.writeFileSync(outputPath, fileContent);\n   }\n \n@@ -454,7 +453,3 @@ function main(args: string[]): void {\n     return result.startsWith('.') ? result : `./${result}`;\n   }\n }\n-\n-if (require.main === module) {\n-  main(process.argv.slice(2));\n-}\n\n---\n file path A: packages/bazel/src/ng_package/tsconfig.json | file path B: packages/bazel/src/ng_package/tsconfig.json\n\n@@ -2,6 +2,6 @@\n   \"compilerOptions\": {\n     \"noImplicitAny\": true,\n     \"lib\": [\"es2015\"],\n-    \"types\": []\n+    \"types\": [\"node\"]\n   }\n }\n\n\n###\n\n", "completion": "build: refactor `ng_package` to work with ESM (#<issue-num>)"}
{"prompt": " file path A: tools/defaults.bzl | file path B: tools/defaults.bzl\n\n@@ -423,9 +423,8 @@ def nodejs_binary(\n         **kwargs\n     )\n \n-def nodejs_test(data = [], env = {}, templated_args = [], enable_linker = False, **kwargs):\n+def nodejs_test(name, data = [], env = {}, templated_args = [], enable_linker = False, **kwargs):\n     rule_data = []\n-\n     (templated_args, rule_data) = install_esm_loaders(templated_args, rule_data)\n \n     if not enable_linker:\n@@ -438,10 +437,18 @@ def nodejs_test(data = [], env = {}, templated_args = [], enable_linker = False,\n         npm_workspace = _node_modules_workspace_name()\n         env = enable_esm_node_module_loader(npm_workspace, env)\n \n+    extract_esm_outputs(\n+        name = \"%s_esm_deps\" % name,\n+        testonly = True,\n+        deps = data,\n+    )\n+\n     _nodejs_test(\n-        data = data + rule_data,\n+        name = name,\n+        data = [\":%s_esm_deps\" % name] + rule_data,\n         env = env,\n         templated_args = templated_args,\n+        use_esm = True,\n         **kwargs\n     )\n \n\n\n###\n\n", "completion": "build: prioritize ESM output in `nodejs_test` similar to binary-variant (#<issue-num>)"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -28,6 +28,7 @@ http_archive(\n     patches = [\n         # TODO(devversion): remove when https://github.com/bazelbuild/rules_nodejs/pull/3605 is available.\n         \"//tools:bazel-repo-patches/rules_nodejs__#3605.patch\",\n+        \"//tools/esm-interop:patches/nodejs_binary_mjs_execution.patch\",\n     ],\n     sha256 = \"c29944ba9b0b430aadcaf3bf2570fece6fc5ebfb76df145c6cdad40d65c20811\",\n     urls = [\"https://github.com/bazelbuild/rules_nodejs/releases/download/5.7.0/rules_nodejs-5.7.0.tar.gz\"],\n\n---\n file path A: None | file path B: tools/esm-interop/patches/nodejs_binary_mjs_execution.patch\n\n@@ -0,0 +1,55 @@\n+diff --git internal/node/node.bzl internal/node/node.bzl\n+index 3b8ce74..2e643cc 100755\n+--- internal/node/node.bzl\n++++ internal/node/node.bzl\n+@@ -93,7 +93,7 @@ def _write_require_patch_script(ctx, data, node_modules_root):\n+         is_executable = True,\n+     )\n+\n+-def _ts_to_js(entry_point_path):\n++def _ts_to_js(ctx, entry_point_path):\n+     \"\"\"If the entry point specified is a typescript file then set it to .js.\n+\n+     Workaround for #1974\n+@@ -103,7 +103,12 @@ def _ts_to_js(entry_point_path):\n+         entry_point_path: a file path\n+     \"\"\"\n+     if entry_point_path.endswith(\".ts\"):\n+-        return entry_point_path[:-3] + \".js\"\n++        if ctx.attr.use_esm:\n++            ext = \".mjs\"\n++        else:\n++            ext = \".js\"\n++\n++        return entry_point_path[:-3] + ext\n+     elif entry_point_path.endswith(\".tsx\"):\n+         return entry_point_path[:-4] + \".js\"\n+     return entry_point_path\n+@@ -333,8 +338,8 @@ if (process.cwd() !== __dirname) {\n+     #else:\n+     #    substitutions[\"TEMPLATED_script_path\"] = \"$(rlocation \\\"%s\\\")\" % _to_manifest_path(ctx, ctx.file.entry_point)\n+     # For now we need to look in both places\n+-    substitutions[\"TEMPLATED_entry_point_execroot_path\"] = \"\\\"%s\\\"\" % _ts_to_js(_to_execroot_path(ctx, _get_entry_point_file(ctx)))\n+-    substitutions[\"TEMPLATED_entry_point_manifest_path\"] = \"$(rlocation \\\"%s\\\")\" % _ts_to_js(_to_manifest_path(ctx, _get_entry_point_file(ctx)))\n++    substitutions[\"TEMPLATED_entry_point_execroot_path\"] = \"\\\"%s\\\"\" % _ts_to_js(ctx, _to_execroot_path(ctx, _get_entry_point_file(ctx)))\n++    substitutions[\"TEMPLATED_entry_point_manifest_path\"] = \"$(rlocation \\\"%s\\\")\" % _ts_to_js(ctx, _to_manifest_path(ctx, _get_entry_point_file(ctx)))\n+     if DirectoryFilePathInfo in ctx.attr.entry_point:\n+         substitutions[\"TEMPLATED_entry_point_main\"] = ctx.attr.entry_point[DirectoryFilePathInfo].path\n+     else:\n+@@ -355,7 +360,7 @@ if (process.cwd() !== __dirname) {\n+\n+     # Note: `to_list()` is expensive and should only be called once.\n+     sources_list = sources.to_list()\n+-    entry_point_input_short_path = _ts_to_js(_get_entry_point_file(ctx).short_path)\n++    entry_point_input_short_path = _ts_to_js(ctx, _get_entry_point_file(ctx).short_path)\n+     entry_point_script = None\n+\n+     for f in sources_list:\n+@@ -631,6 +636,7 @@ Predefined genrule variables are not supported in this context.\n+         ],\n+         allow_files = True,\n+     ),\n++    \"use_esm\": attr.bool(default = False),\n+ }\n+\n+ _NODEJS_EXECUTABLE_OUTPUTS = {\n\n\n###\n\n", "completion": "build: patch `rules_nodejs` to prioritize ESM files for `nodejs_binary/test` (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/BUILD.bazel | file path B: packages/compiler-cli/BUILD.bazel\n\n@@ -63,11 +63,6 @@ ts_config(\n     deps = [\"//packages:tsconfig-build.json\"],\n )\n \n-ts_library(\n-    name = \"import_meta_url_types\",\n-    srcs = [\"import_meta_url.d.ts\"],\n-)\n-\n ts_library(\n     name = \"compiler-cli\",\n     srcs = glob(\n@@ -76,13 +71,11 @@ ts_library(\n             \"src/**/*.ts\",\n         ],\n         exclude = [\n-            \"import_meta_url.d.ts\",\n             \"src/integrationtest/**/*.ts\",\n         ],\n     ),\n     tsconfig = \":tsconfig\",\n     deps = [\n-        \":import_meta_url_types\",\n         \"//packages/compiler\",\n         \"//packages/compiler-cli/private\",\n         \"//packages/compiler-cli/src/ngtsc/core\",\n\n---\n file path A: packages/compiler-cli/esbuild.config.js | file path B: packages/compiler-cli/esbuild.config.js\n\n@@ -7,18 +7,14 @@\n  */\n \n module.exports = {\n-  resolveExtensions: ['.mjs', '.js'],\n+  resolveExtensions : ['.mjs', '.js'],\n   // Note: `@bazel/esbuild` has a bug and does not pass-through the format from Starlark.\n-  format: 'esm',\n-  banner: {\n+  format : 'esm',\n+  banner : {\n     // Workaround for: https://github.com/evanw/esbuild/issues/946\n-    // We also define `__ESM_IMPORT_META_URL__` because we cannot use `import.meta.url`\n-    // in our sources yet. The devmode CommonJS output will otherwise break.\n-    // TODO: Remove this workaround in the future once devmode is ESM as well.\n-    js: `\n+    js : `\n       import {createRequire as __cjsCompatRequire} from 'module';\n       const require = __cjsCompatRequire(import.meta.url);\n-      const __ESM_IMPORT_META_URL__ = import.meta.url;\n     `,\n   },\n };\n\n---\n file path A: packages/compiler-cli/import_meta_url.d.ts | file path B: None\n\n@@ -1,14 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-\n-// Note: The `__ESM_IMPORT_META_URL__` identifier will be defined as part of bundling.\n-// We cannot use `import.meta.url` directly as this code currently still runs in CommonJS\n-// for devmode. This is a solution allowing for both ESModule and CommonJS to run this file.\n-// TODO(devversion): replace all of this with `import.meta.url` once devmode is using ESM.\n-declare const __ESM_IMPORT_META_URL__: string;\n\\ No newline at end of file\n\n---\n file path A: packages/compiler-cli/ngcc/BUILD.bazel | file path B: packages/compiler-cli/ngcc/BUILD.bazel\n\n@@ -13,7 +13,6 @@ ts_library(\n         \"//packages:types\",\n         \"//packages/compiler\",\n         \"//packages/compiler-cli\",\n-        \"//packages/compiler-cli:import_meta_url_types\",\n         \"//packages/compiler-cli/src/ngtsc/annotations\",\n         \"//packages/compiler-cli/src/ngtsc/annotations/common\",\n         \"//packages/compiler-cli/src/ngtsc/cycles\",\n\n---\n file path A: packages/compiler-cli/ngcc/index.ts | file path B: packages/compiler-cli/ngcc/index.ts\n\n@@ -25,12 +25,9 @@ export function process(options: AsyncNgccOptions|SyncNgccOptions): void|Promise\n   return mainNgcc(options);\n }\n \n-\n-// CommonJS/ESM interop for determining the current file name and containing\n-// directory. These path is needed for providing an absolute path to the ngcc\n-// command line entry-point script (for the CLI).\n-export const containingDirPath =\n-    typeof __dirname !== 'undefined' ? __dirname : dirname(fileURLToPath(__ESM_IMPORT_META_URL__));\n+// The current script path is needed for providing an absolute path to the\n+// ngcc command line entry-point script (leveraged by the Angular CLI).\n+const containingDirPath = dirname(fileURLToPath(import.meta.url));\n \n /**\n  * Absolute file path that points to the `ngcc` command line entry-point.\n\n---\n file path A: packages/compiler-cli/ngcc/src/execution/cluster/master.ts | file path B: packages/compiler-cli/ngcc/src/execution/cluster/master.ts\n\n@@ -345,10 +345,8 @@ export class ClusterMaster {\n \n /** Gets the absolute file path to the cluster worker script. */\n export function getClusterWorkerScriptPath(fileSystem: PathManipulation): AbsoluteFsPath {\n-  // This is an interop allowing for the worker script to be determined in both\n-  // a CommonJS module, or an ES module which does not come with `require` by default.\n-  const requireFn =\n-      typeof require !== 'undefined' ? require : module.createRequire(__ESM_IMPORT_META_URL__);\n+  // NodeJS `import.meta.resolve` is experimental. We leverage `require`.\n+  const requireFn = module.createRequire(import.meta.url);\n   // We resolve the worker script using module resolution as in the package output,\n   // the worker might be bundled but exposed through a subpath export mapping.\n   const workerScriptPath =\n\n---\n file path A: packages/compiler-cli/ngcc/src/locking/lock_file.ts | file path B: packages/compiler-cli/ngcc/src/locking/lock_file.ts\n\n@@ -11,10 +11,8 @@ import module from 'module';\n import {AbsoluteFsPath, PathManipulation} from '../../../src/ngtsc/file_system';\n \n export function getLockFilePath(fs: PathManipulation) {\n-  // This is an interop allowing for the unlocking script to be determined in both\n-  // a CommonJS module, or an ES module which does not come with `require` by default.\n-  const requireFn =\n-      typeof require !== 'undefined' ? require : module.createRequire(__ESM_IMPORT_META_URL__);\n+  // NodeJS `import.meta.resolve` is experimental. We leverage `require`.\n+  const requireFn = module.createRequire(import.meta.url);\n   // The lock file location is resolved based on the location of the `ngcc` entry-point as this\n   // allows us to have a consistent position for the lock file to reside. We are unable to rely\n   // on `__dirname` (or equivalent) as this code is being bundled and different entry-points\n\n---\n file path A: packages/compiler-cli/ngcc/src/locking/lock_file_with_child_process/index.ts | file path B: packages/compiler-cli/ngcc/src/locking/lock_file_with_child_process/index.ts\n\n@@ -91,10 +91,8 @@ export class LockFileWithChildProcess implements LockFile {\n \n /** Gets the absolute file path to the lock file unlocker script. */\n export function getLockFileUnlockerScriptPath(fileSystem: FileSystem): AbsoluteFsPath {\n-  // This is an interop allowing for the unlocking script to be determined in both\n-  // a CommonJS module, or an ES module which does not come with `require` by default.\n-  const requireFn =\n-      typeof require !== 'undefined' ? require : module.createRequire(__ESM_IMPORT_META_URL__);\n+  // NodeJS `import.meta.resolve` is experimental. We leverage `require`.\n+  const requireFn = module.createRequire(import.meta.url);\n   // We resolve the worker script using module resolution as in the package output,\n   // the worker might be bundled but exposed through a subpath export mapping.\n   const unlockerScriptPath = requireFn.resolve(\n\n---\n file path A: packages/compiler-cli/ngcc/src/packages/configuration.ts | file path B: packages/compiler-cli/ngcc/src/packages/configuration.ts\n\n@@ -268,11 +268,6 @@ export const DEFAULT_NGCC_CONFIG: NgccProjectConfig = {\n \n const NGCC_CONFIG_FILENAME = 'ngcc.config.js';\n \n-// CommonJS/ESM interop for determining the current file name and containing\n-// directory. The path is needed for loading the user configuration.\n-const isCommonJS = typeof require !== 'undefined';\n-const currentFileUrl = isCommonJS ? null : __ESM_IMPORT_META_URL__;\n-\n /**\n  * The processed package level configuration as a result of processing a raw package level config.\n  */\n@@ -443,7 +438,7 @@ export class NgccConfiguration {\n   }\n \n   private evalSrcFile(srcPath: AbsoluteFsPath): any {\n-    const requireFn = isCommonJS ? require : module.createRequire(currentFileUrl!);\n+    const requireFn = module.createRequire(import.meta.url);\n     const src = this.fs.readFile(srcPath);\n     const theExports = {};\n     const sandbox = {\n\n---\n file path A: packages/compiler-cli/src/ngtsc/file_system/BUILD.bazel | file path B: packages/compiler-cli/src/ngtsc/file_system/BUILD.bazel\n\n@@ -8,9 +8,6 @@ ts_library(\n         \"src/**/*.ts\",\n     ]),\n     deps = [\n-        # Allows for the `import.meta.url` constant to be used. This is\n-        # a temporary interop until devmode is switched to ESM.\n-        \"//packages/compiler-cli:import_meta_url_types\",\n         \"@npm//@types/node\",\n         \"@npm//typescript\",\n     ],\n\n---\n file path A: packages/compiler-cli/src/ngtsc/file_system/src/node_js_file_system.ts | file path B: packages/compiler-cli/src/ngtsc/file_system/src/node_js_file_system.ts\n\n@@ -54,12 +54,10 @@ export class NodeJSPathManipulation implements PathManipulation {\n   }\n }\n \n-// CommonJS/ESM interop for determining the current file name and containing\n-// directory. These paths are needed for detecting whether the file system\n-// is case sensitive, or for finding the TypeScript default libraries.\n-// TODO(devversion): Simplify this in the future if devmode uses ESM as well.\n+// G3-ESM-MARKER: G3 uses CommonJS, but externally everything in ESM.\n+// CommonJS/ESM interop for determining the current file name and containing dir.\n const isCommonJS = typeof __filename !== 'undefined';\n-const currentFileUrl = isCommonJS ? null : __ESM_IMPORT_META_URL__;\n+const currentFileUrl = isCommonJS ? null : import.meta.url;\n const currentFileName = isCommonJS ? __filename : fileURLToPath(currentFileUrl!);\n \n /**\n@@ -97,7 +95,7 @@ export class NodeJSReadonlyFileSystem extends NodeJSPathManipulation implements\n     return this.resolve(fs.realpathSync(path));\n   }\n   getDefaultLibLocation(): AbsoluteFsPath {\n-    // TODO(devversion): Once devmode output uses ESM, we can simplify this.\n+    // G3-ESM-MARKER: G3 uses CommonJS, but externally everything in ESM.\n     const requireFn = isCommonJS ? require : module.createRequire(currentFileUrl!);\n     return this.resolve(requireFn.resolve('typescript'), '..');\n   }\n\n\n###\n\n", "completion": "refactor: remove `__ESM_IMPORT_META_URL__` workaround now that we can use ESM (#<issue-num>)"}
{"prompt": " file path A: packages/common/locales/generate-locales-tool/bin/base-locale.ts | file path B: packages/common/locales/generate-locales-tool/bin/base-locale.ts\n\n@@ -6,7 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-\n /**\n  * Base locale used as foundation for other locales. For example: A base locale allows\n  * generation of a file containing all currencies with their corresponding symbols. If we\n\n---\n file path A: packages/common/locales/generate-locales-tool/bin/get-base-currencies-file.ts | file path B: packages/common/locales/generate-locales-tool/bin/get-base-currencies-file.ts\n\n@@ -18,6 +18,4 @@ function main() {\n   process.stdout.write(generateBaseCurrenciesFile(baseLocaleData));\n }\n \n-if (require.main === module) {\n-  main();\n-}\n+main();\n\n---\n file path A: packages/common/locales/generate-locales-tool/bin/get-base-locale-file.ts | file path B: packages/common/locales/generate-locales-tool/bin/get-base-locale-file.ts\n\n@@ -20,6 +20,4 @@ function main() {\n   process.stdout.write(generateLocale(BASE_LOCALE, baseLocaleData, baseCurrencies));\n }\n \n-if (require.main === module) {\n-  main();\n-}\n+main();\n\n---\n file path A: packages/common/locales/generate-locales-tool/bin/get-closure-locale-file.ts | file path B: packages/common/locales/generate-locales-tool/bin/get-closure-locale-file.ts\n\n@@ -20,6 +20,4 @@ function main() {\n   process.stdout.write(generateClosureLocaleFile(cldrData, baseCurrencies));\n }\n \n-if (require.main === module) {\n-  main();\n-}\n+main();\n\n---\n file path A: packages/common/locales/generate-locales-tool/bin/write-locale-files-to-dist.ts | file path B: packages/common/locales/generate-locales-tool/bin/write-locale-files-to-dist.ts\n\n@@ -21,7 +21,11 @@ import {BASE_LOCALE} from './base-locale';\n  * Generates locale files for each available CLDR locale and writes it to the\n  * specified directory.\n  */\n-function main(outputDir: string) {\n+function main(outputDir: string|undefined) {\n+  if (outputDir === undefined) {\n+    throw Error('No output directory specified.');\n+  }\n+\n   const cldrData = new CldrData();\n   const baseLocaleData = cldrData.getLocaleData(BASE_LOCALE)!;\n   const baseCurrencies = generateBaseCurrencies(baseLocaleData);\n@@ -31,7 +35,7 @@ function main(outputDir: string) {\n   console.info(`Writing locales to: ${outputDir}`);\n \n   // Generate locale files for all locales we have data for.\n-  cldrData.availableLocales.forEach(localeData => {\n+  cldrData.availableLocales.forEach((localeData) => {\n     const locale = localeData.locale;\n     const localeFile = generateLocale(locale, localeData, baseCurrencies);\n     const localeExtraFile = generateLocaleExtra(locale, localeData);\n@@ -43,15 +47,4 @@ function main(outputDir: string) {\n   });\n }\n \n-\n-if (require.main === module) {\n-  // The first argument is expected to be a path resolving to a directory\n-  // where all locales should be generated into.\n-  const outputDir = process.argv[2];\n-\n-  if (outputDir === undefined) {\n-    throw Error('No output directory specified.');\n-  }\n-\n-  main(outputDir);\n-}\n+main(process.argv[2]);\n\n---\n file path A: packages/common/locales/generate-locales-tool/cldr-data.ts | file path B: packages/common/locales/generate-locales-tool/cldr-data.ts\n\n@@ -7,15 +7,10 @@\n  */\n \n import {runfiles} from '@bazel/runfiles';\n-import {CldrStatic} from 'cldrjs';\n+import cldrjs, {type CldrStatic} from 'cldrjs';\n+import fs from 'fs';\n import glob from 'glob';\n \n-// TypeScript doesn't allow us to import the default export without the `esModuleInterop`. We use\n-// the NodeJS require function instead as specifying a custom tsconfig complicates the setup\n-// unnecessarily.\n-// TODO: See if we can improve this by having better types for `cldrjs`.\n-const cldrjs: typeof import('cldrjs') = require('cldrjs');\n-\n /**\n  * Globs that match CLDR JSON data files that should be fetched. We limit these intentionally\n  * as loading unused data results in significant slow-down of the generation\n@@ -93,14 +88,14 @@ export class CldrData {\n    */\n   getLanguageAliases():\n       {[localeName: string]: {_reason: CldrLocaleAliasReason, _replacement: string}} {\n-    return require(`${this.cldrDataDir}/${CLDR_LOCALE_ALIASES_PATH}`)\n+    return this._loadJsonOrThrow(`${this.cldrDataDir}/${CLDR_LOCALE_ALIASES_PATH}`)\n         .supplemental.metadata.alias.languageAlias;\n   }\n \n   /** Gets a list of all locales CLDR provides data for. */\n   private _getAvailableLocales(): CldrLocaleData[] {\n-    const allLocales =\n-        require(`${this.cldrDataDir}/${CLDR_AVAILABLE_LOCALES_PATH}`).availableLocales.full;\n+    const allLocales = this._loadJsonOrThrow(`${this.cldrDataDir}/${CLDR_AVAILABLE_LOCALES_PATH}`)\n+                           .availableLocales.full;\n     const localesWithData: CldrLocaleData[] = [];\n \n     for (const localeName of allLocales) {\n@@ -140,7 +135,7 @@ export class CldrData {\n \n     // Read the JSON for all determined CLDR json files.\n     return jsonFiles.map(filePath => {\n-      const parsed = require(filePath);\n+      const parsed = this._loadJsonOrThrow(filePath);\n \n       // Guards against cases where non-CLDR data files are accidentally picked up\n       // by the glob above and would throw-off the bundle lookup in `cldrjs`.\n@@ -151,4 +146,8 @@ export class CldrData {\n       return parsed;\n     });\n   }\n+\n+  private _loadJsonOrThrow(filePath: string): any {\n+    return JSON.parse(fs.readFileSync(filePath, 'utf8')) as unknown as any;\n+  }\n }\n\n---\n file path A: packages/common/locales/generate-locales-tool/plural-function.ts | file path B: packages/common/locales/generate-locales-tool/plural-function.ts\n\n@@ -10,7 +10,7 @@ import {runfiles} from '@bazel/runfiles';\n import {CldrLocaleData} from './cldr-data';\n \n // There are no types available for `cldr`.\n-const {load: createCldr} = require('cldr');\n+const {load: createCldr} = await import('cldr' as any);\n \n /**\n  * Returns the plural function for a locale.\n\n\n###\n\n", "completion": "build: refactor `generate-locales-tool` to ESM (#<issue-num>)"}
{"prompt": " file path A: packages/bazel/src/ngc-wrapped/BUILD.bazel | file path B: packages/bazel/src/ngc-wrapped/BUILD.bazel\n\n@@ -1,12 +1,12 @@\n # BEGIN-DEV-ONLY\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"nodejs_binary\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"ts_library\")\n+load(\"//tools:defaults.bzl\", \"nodejs_binary\", \"ts_library\")\n \n ts_library(\n     name = \"ngc_lib\",\n     srcs = [\n         \"extract_i18n.ts\",\n         \"index.ts\",\n+        \"ngc-wrapped-main.ts\",\n     ],\n     module_name = \"@angular/bazel\",\n     visibility = [\n@@ -29,10 +29,8 @@ nodejs_binary(\n     data = [\n         \":ngc_lib\",\n         \"//packages/bazel/third_party/github.com/bazelbuild/bazel/src/main/protobuf:worker_protocol.proto\",\n-        \"@npm//source-map-support\",\n-        \"@npm//tslib\",\n     ],\n-    entry_point = \":index.ts\",\n+    entry_point = \":ngc-wrapped-main.ts\",\n     # Disables the Bazel node modules linker. The node module linker is unreliable for the\n     # persistent worker executable, as it would rely on the `node_modules/` folder in the\n     # execroot that can be shared in non-sandbox environments or for persistent workers.\n@@ -45,7 +43,6 @@ nodejs_binary(\n     name = \"xi18n\",\n     data = [\n         \":ngc_lib\",\n-        \"@npm//source-map-support\",\n     ],\n     entry_point = \":extract_i18n.ts\",\n     # Follows the same reasoning as for the actual `ngc-wrapped` target.\n\n---\n file path A: packages/bazel/src/ngc-wrapped/index.ts | file path B: packages/bazel/src/ngc-wrapped/index.ts\n\n@@ -7,32 +7,20 @@\n  */\n \n // `tsc-wrapped` helpers are not exposed in the primary `@bazel/concatjs` entry-point.\n-// TODO: Update when https://github.com/bazelbuild/rules_nodejs/pull/3286 is available.\n-import {BazelOptions as ExternalBazelOptions, CachedFileLoader, CompilerHost, constructManifest, debug, FileCache, FileLoader, parseTsconfig, resolveNormalizedPath, runAsWorker, runWorkerLoop, UncachedFileLoader} from '@bazel/concatjs/internal/tsc_wrapped';\n-\n-import type {AngularCompilerOptions, CompilerHost as NgCompilerHost, TsEmitCallback, Program, CompilerOptions} from '@angular/compiler-cli';\n+import * as ng from '@angular/compiler-cli';\n+import {PerfPhase} from '@angular/compiler-cli/private/bazel';\n+import tscw from '@bazel/concatjs/internal/tsc_wrapped/index.js';\n import * as fs from 'fs';\n import * as path from 'path';\n import * as tsickle from 'tsickle';\n import ts from 'typescript';\n-import {pathToFileURL} from 'url';\n-\n-type CompilerCliModule =\n-    typeof import('@angular/compiler-cli')&typeof import('@angular/compiler-cli/private/bazel');\n \n // Add devmode for blaze internal\n-interface BazelOptions extends ExternalBazelOptions {\n+interface BazelOptions extends tscw.BazelOptions {\n   allowedInputs?: string[];\n   unusedInputsListPath?: string;\n }\n \n-/**\n- * Reference to the previously loaded `compiler-cli` module exports. We cache the exports\n- * as `ngc-wrapped` can run as part of a worker where the Angular compiler should not be\n- * resolved through a dynamic import for every build.\n- */\n-let _cachedCompilerCliModule: CompilerCliModule|null = null;\n-\n const EXT = /(\\.ts|\\.d\\.ts|\\.js|\\.jsx|\\.tsx)$/;\n const NGC_GEN_FILES = /^(.*?)\\.(ngfactory|ngsummary|ngstyle|shim\\.ngstyle)(.*)$/;\n // FIXME: we should be able to add the assets to the tsconfig so FileLoader\n@@ -47,8 +35,8 @@ const ALL_DEPS_COMPILED_WITH_BAZEL = false;\n const NODE_MODULES = 'node_modules/';\n \n export async function main(args: string[]) {\n-  if (runAsWorker(args)) {\n-    await runWorkerLoop(runOneBuild);\n+  if (tscw.runAsWorker(args)) {\n+    await tscw.runWorkerLoop(runOneBuild);\n   } else {\n     return await runOneBuild(args) ? 0 : 1;\n   }\n@@ -56,46 +44,7 @@ export async function main(args: string[]) {\n }\n \n /** The one FileCache instance used in this process. */\n-const fileCache = new FileCache<ts.SourceFile>(debug);\n-\n-/**\n- * Loads a module that can either be CommonJS or an ESModule. This is done\n- * as interop with the current devmode CommonJS and prodmode ESM output.\n- */\n-async function loadModuleInterop<T>(moduleName: string): Promise<T> {\n-  // Note: This assumes that there are no conditional exports switching between `import`\n-  // or `require`. We cannot fully rely on the dynamic import expression here because the\n-  // Bazel NodeJS rules do not patch the `import` NodeJS module resolution, and this would\n-  // make ngc-wrapped dependent on the linker. The linker is not enabled when the `ngc-wrapped`\n-  // binary is shipped in the NPM package and is not available in Google3 either.\n-  const resolvedUrl = pathToFileURL(require.resolve(moduleName));\n-  const exports: Partial<T>&{default?: T} =\n-      await new Function('m', `return import(m);`)(resolvedUrl);\n-  return exports.default ?? exports as T;\n-}\n-\n-/**\n- * Fetches the Angular compiler CLI module dynamically, allowing for an ESM\n- * variant of the compiler.\n- */\n-async function fetchCompilerCliModule(): Promise<CompilerCliModule> {\n-  if (_cachedCompilerCliModule !== null) {\n-    return _cachedCompilerCliModule;\n-  }\n-\n-  // Note: We load the compiler-cli package dynamically using `loadModuleInterop` as\n-  // this script runs as CommonJS module but the compiler-cli could be built as strict ESM\n-  // package. Unfortunately we have a mix of CommonJS and ESM output here because the devmode\n-  // output is still using CommonJS and this is primarily used for testing. Also inside G3,\n-  // the devmode output will remain CommonJS regardless for now.\n-  // TODO: Fix this up once devmode and prodmode are combined and we use ESM everywhere.\n-  const compilerExports =\n-      await loadModuleInterop<typeof import('@angular/compiler-cli')>('@angular/compiler-cli');\n-  const compilerPrivateExports =\n-      await loadModuleInterop<typeof import('@angular/compiler-cli/private/bazel')>(\n-          '@angular/compiler-cli/private/bazel');\n-  return _cachedCompilerCliModule = {...compilerExports, ...compilerPrivateExports};\n-}\n+const fileCache = new tscw.FileCache<ts.SourceFile>(tscw.debug);\n \n export async function runOneBuild(\n     args: string[], inputs?: {[path: string]: string}): Promise<boolean> {\n@@ -105,9 +54,8 @@ export async function runOneBuild(\n \n   // Strip leading at-signs, used to indicate a params file\n   const project = args[0].replace(/^@+/, '');\n-  const ng = await fetchCompilerCliModule();\n \n-  const [parsedOptions, errors] = parseTsconfig(project);\n+  const [parsedOptions, errors] = tscw.parseTsconfig(project);\n   if (errors?.length) {\n     console.error(ng.formatDiagnostics(errors));\n     return false;\n@@ -153,9 +101,9 @@ export async function runOneBuild(\n \n   // Angular Compiler options are always set under Bazel. See `ng_module.bzl`.\n   const angularConfigRawOptions =\n-      (config as {angularCompilerOptions: AngularCompilerOptions})['angularCompilerOptions'];\n+      (config as {angularCompilerOptions: ng.AngularCompilerOptions})['angularCompilerOptions'];\n \n-  const compilerOpts: AngularCompilerOptions = {\n+  const compilerOpts: ng.AngularCompilerOptions = {\n     ...userOverrides,\n     ...angularConfigRawOptions,\n     ...tsOptions,\n@@ -175,7 +123,6 @@ export async function runOneBuild(\n     bazelOpts,\n     files,\n     inputs,\n-    ng,\n   });\n   if (diagnostics.length) {\n     console.error(ng.formatDiagnostics(diagnostics));\n@@ -205,18 +152,17 @@ export function compile({\n   expectedOuts,\n   gatherDiagnostics,\n   bazelHost,\n-  ng,\n }: {\n   allDepsCompiledWithBazel?: boolean,\n-  useManifestPathsAsModuleName?: boolean, compilerOpts: CompilerOptions, tsHost: ts.CompilerHost,\n+  useManifestPathsAsModuleName?: boolean, compilerOpts: ng.CompilerOptions, tsHost: ts.CompilerHost,\n   inputs?: {[path: string]: string},\n         bazelOpts: BazelOptions,\n         files: string[],\n         expectedOuts: string[],\n-  gatherDiagnostics?: (program: Program) => readonly ts.Diagnostic[],\n-  bazelHost?: CompilerHost, ng: CompilerCliModule,\n-}): {diagnostics: readonly ts.Diagnostic[], program: Program|undefined} {\n-  let fileLoader: FileLoader;\n+  gatherDiagnostics?: (program: ng.Program) => readonly ts.Diagnostic[],\n+  bazelHost?: tscw.CompilerHost,\n+}): {diagnostics: readonly ts.Diagnostic[], program: ng.Program|undefined} {\n+  let fileLoader: tscw.FileLoader;\n \n   // These options are expected to be set in Bazel. See:\n   // https://github.com/bazelbuild/rules_nodejs/blob/591e76edc9ee0a71d604c5999af8bad7909ef2d4/packages/concatjs/internal/common/tsconfig.bzl#L246.\n@@ -232,17 +178,17 @@ export function compile({\n   }\n \n   if (inputs) {\n-    fileLoader = new CachedFileLoader(fileCache);\n+    fileLoader = new tscw.CachedFileLoader(fileCache);\n     // Resolve the inputs to absolute paths to match TypeScript internals\n     const resolvedInputs = new Map<string, string>();\n     const inputKeys = Object.keys(inputs);\n     for (let i = 0; i < inputKeys.length; i++) {\n       const key = inputKeys[i];\n-      resolvedInputs.set(resolveNormalizedPath(key), inputs[key]);\n+      resolvedInputs.set(tscw.resolveNormalizedPath(key), inputs[key]);\n     }\n     fileCache.updateCache(resolvedInputs);\n   } else {\n-    fileLoader = new UncachedFileLoader();\n+    fileLoader = new tscw.UncachedFileLoader();\n   }\n \n   // Detect from compilerOpts whether the entrypoint is being invoked in Ivy mode.\n@@ -268,7 +214,7 @@ export function compile({\n       };\n \n   if (!bazelHost) {\n-    bazelHost = new CompilerHost(files, compilerOpts, bazelOpts, tsHost, fileLoader);\n+    bazelHost = new tscw.CompilerHost(files, compilerOpts, bazelOpts, tsHost, fileLoader);\n   }\n \n   const delegate = bazelHost.shouldSkipTsickleProcessing.bind(bazelHost);\n@@ -370,7 +316,7 @@ export function compile({\n     // as that has a different implementation of fromSummaryFileName / toSummaryFileName\n     ngHost.fromSummaryFileName = (fileName: string, referringLibFileName: string) => {\n       const workspaceRelative = fileName.split('/').splice(1).join('/');\n-      return resolveNormalizedPath(bazelBin, workspaceRelative) + '.d.ts';\n+      return tscw.resolveNormalizedPath(bazelBin, workspaceRelative) + '.d.ts';\n     };\n   }\n   // Patch a property on the ngHost that allows the resourceNameToModuleName function to\n@@ -380,7 +326,7 @@ export function compile({\n     console.error('Check that it\\'s included in the `assets` attribute of the `ng_module` rule.\\n');\n   };\n \n-  const emitCallback: TsEmitCallback<tsickle.EmitResult> = ({\n+  const emitCallback: ng.TsEmitCallback<tsickle.EmitResult> = ({\n     program,\n     targetSourceFile,\n     writeFile,\n@@ -398,7 +344,7 @@ export function compile({\n \n   if (!gatherDiagnostics) {\n     gatherDiagnostics = (program) =>\n-        gatherDiagnosticsForInputsOnly(compilerOpts, bazelOpts, program, ng);\n+        gatherDiagnosticsForInputsOnly(compilerOpts, bazelOpts, program);\n   }\n   const {diagnostics, emitResult, program} = ng.performCompilation({\n     rootNames: files,\n@@ -416,7 +362,7 @@ export function compile({\n       externs += tsickle.getGeneratedExterns(tsickleEmitResult.externs, rootDir);\n     }\n     if (bazelOpts.manifest) {\n-      const manifest = constructManifest(tsickleEmitResult.modulesManifest, bazelHost);\n+      const manifest = tscw.constructManifest(tsickleEmitResult.modulesManifest, bazelHost);\n       fs.writeFileSync(bazelOpts.manifest, manifest);\n     }\n   }\n@@ -499,14 +445,13 @@ function convertToForwardSlashPath(filePath: string): string {\n }\n \n function gatherDiagnosticsForInputsOnly(\n-    options: CompilerOptions, bazelOpts: BazelOptions, ngProgram: Program,\n-    ng: CompilerCliModule): ts.Diagnostic[] {\n+    options: ng.CompilerOptions, bazelOpts: BazelOptions, ngProgram: ng.Program): ts.Diagnostic[] {\n   const tsProgram = ngProgram.getTsProgram();\n \n   // For the Ivy compiler, track the amount of time spent fetching TypeScript diagnostics.\n-  let previousPhase = ng.PerfPhase.Unaccounted;\n+  let previousPhase = PerfPhase.Unaccounted;\n   if (ngProgram instanceof ng.NgtscProgram) {\n-    previousPhase = ngProgram.compiler.perfRecorder.phase(ng.PerfPhase.TypeScriptDiagnostics);\n+    previousPhase = ngProgram.compiler.perfRecorder.phase(PerfPhase.TypeScriptDiagnostics);\n   }\n   const diagnostics: ts.Diagnostic[] = [];\n   // These checks mirror ts.getPreEmitDiagnostics, with the important\n@@ -536,13 +481,6 @@ function gatherDiagnosticsForInputsOnly(\n   return diagnostics;\n }\n \n-if (require.main === module) {\n-  main(process.argv.slice(2)).then(exitCode => process.exitCode = exitCode).catch(e => {\n-    console.error(e);\n-    process.exitCode = 1;\n-  });\n-}\n-\n /**\n  * Adds support for the optional `fileNameToModuleName` operation to a given `ng.CompilerHost`.\n  *\n@@ -552,7 +490,7 @@ if (require.main === module) {\n  * correctly.\n  */\n export function patchNgHostWithFileNameToModuleName(\n-    ngHost: NgCompilerHost, compilerOpts: CompilerOptions, bazelOpts: BazelOptions,\n+    ngHost: ng.CompilerHost, compilerOpts: ng.CompilerOptions, bazelOpts: BazelOptions,\n     rootDirs: string[], useManifestPathsAsModuleName: boolean): void {\n   const fileNameToModuleNameCache = new Map<string, string>();\n   ngHost.fileNameToModuleName = (importedFilePath: string, containingFilePath?: string) => {\n\n---\n file path A: None | file path B: packages/bazel/src/ngc-wrapped/ngc-wrapped-main.ts\n\n@@ -0,0 +1,14 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {main} from './index';\n+\n+main(process.argv.slice(2)).then(exitCode => process.exitCode = exitCode).catch(e => {\n+  console.error(e);\n+  process.exitCode = 1;\n+});\n\n---\n file path A: packages/compiler-cli/BUILD.bazel | file path B: packages/compiler-cli/BUILD.bazel\n\n@@ -1,9 +1,6 @@\n-load(\"//tools:defaults.bzl\", \"api_golden_test\", \"extract_types\", \"pkg_npm\", \"ts_config\", \"ts_library\")\n load(\"@npm//@bazel/esbuild:index.bzl\", \"esbuild\", \"esbuild_config\")\n-\n-# Load ng_perf_flag explicitly from ng_perf.bzl as it's private API, and not exposed to other\n-# consumers of @angular/bazel.\n load(\"//packages/bazel/src:ng_perf.bzl\", \"ng_perf_flag\")\n+load(\"//tools:defaults.bzl\", \"api_golden_test\", \"extract_types\", \"pkg_npm\", \"ts_config\", \"ts_library\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n\n\n###\n\n", "completion": "build: refactor `ngc-wrapped` to support ESM (#<issue-num>)"}
{"prompt": " file path A: tools/esm-loader/BUILD.bazel | file path B: tools/esm-interop/BUILD.bazel\n\n\n---\n file path A: None | file path B: tools/esm-interop/esm-node-module-loader.mjs\n\n@@ -0,0 +1,76 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import fs from 'fs';\n+import path from 'path';\n+import {pathToFileURL} from 'url';\n+import {resolve as resolveExports} from '../../third_party/github.com/lukeed/resolve.exports/index.mjs';\n+\n+/*\n+  Custom module loader (see https://nodejs.org/api/cli.html#--experimental-loadermodule) to support\n+  loading third-party packages in esm modules when the rules_nodejs linker is disabled. Resolves\n+  third-party imports from the node_modules folder in the bazel workspace defined by\n+  process.env.NODE_MODULES_WORKSPACE_NAME, and uses default resolution for all other imports.\n+\n+  This is required because rules_nodejs only patches requires in cjs modules when the linker\n+  is disabled, not imports in mjs modules.\n+*/\n+export async function resolve(specifier, context, defaultResolve) {\n+  if (!isNodeOrNpmPackageImport(specifier)) {\n+    return defaultResolve(specifier, context, defaultResolve);\n+  }\n+\n+  const runfilesRoot = path.resolve(process.env.RUNFILES);\n+  const nodeModules = path.join(\n+    runfilesRoot,\n+    process.env.NODE_MODULES_WORKSPACE_NAME,\n+    'node_modules'\n+  );\n+  const packageImport = parsePackageImport(specifier);\n+  const pathToNodeModule = path.join(nodeModules, packageImport.packageName);\n+\n+  const isInternalNodePackage = !fs.existsSync(pathToNodeModule);\n+  if (isInternalNodePackage) {\n+    return defaultResolve(specifier, context, defaultResolve);\n+  }\n+\n+  const packageJson = JSON.parse(\n+    fs.readFileSync(path.join(pathToNodeModule, 'package.json'), 'utf-8')\n+  );\n+\n+  const localPackagePath = resolvePackageLocalFilepath(packageImport, packageJson);\n+  const resolvedFilePath = path.join(pathToNodeModule, localPackagePath);\n+\n+  return {url: pathToFileURL(resolvedFilePath).href};\n+}\n+\n+function isNodeOrNpmPackageImport(specifier) {\n+  return (\n+    !specifier.startsWith('./') &&\n+    !specifier.startsWith('../') &&\n+    !specifier.startsWith('node:') &&\n+    !specifier.startsWith('file:')\n+  );\n+}\n+\n+function parsePackageImport(specifier) {\n+  const [, packageName, pathInPackage = ''] =\n+    /^((?:@[^/]+\\/)?[^/]+)(?:\\/(.+))?$/.exec(specifier) ?? [];\n+  if (!packageName) {\n+    throw new Error(`Could not parse package name import statement '${specifier}'`);\n+  }\n+  return {packageName, pathInPackage, specifier};\n+}\n+\n+function resolvePackageLocalFilepath(packageImport, packageJson) {\n+  if (packageJson.exports) {\n+    return resolveExports(packageJson, packageImport.specifier);\n+  }\n+\n+  return packageImport.pathInPackage || packageJson.module || packageJson.main || 'index.js';\n+}\n\n---\n file path A: tools/esm-loader/esm-loader.mjs | file path B: None\n\n@@ -1,64 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import fs from 'fs';\n-import path from 'path';\n-import {pathToFileURL} from 'url';\n-import {resolve as resolveExports} from '../../third_party/github.com/lukeed/resolve.exports/index.mjs';\n-\n-/*\n-  Custom module loader (see https://nodejs.org/api/cli.html#--experimental-loadermodule) to support\n-  loading third-party packages in esm modules when the rules_nodejs linker is disabled. Resolves\n-  third-party imports from the node_modules folder in the bazel workspace defined by \n-  process.env.NODE_MODULES_WORKSPACE_NAME, and uses default resolution for all other imports.\n-\n-  This is required because rules_nodejs only patches requires in cjs modules when the linker\n-  is disabled, not imports in mjs modules.\n-*/ \n-export async function resolve(specifier, context, defaultResolve) {\n-    if (!isNodeOrNpmPackageImport(specifier)) {\n-      return defaultResolve(specifier, context, defaultResolve);\n-    }\n-\n-    const runfilesRoot = path.resolve(process.env.RUNFILES);\n-    const nodeModules = path.join(runfilesRoot, process.env.NODE_MODULES_WORKSPACE_NAME, 'node_modules');\n-    const packageImport = parsePackageImport(specifier);\n-    const pathToNodeModule = path.join(nodeModules, packageImport.packageName);\n-\n-    const isInternalNodePackage = !fs.existsSync(pathToNodeModule);\n-    if (isInternalNodePackage) {\n-      return defaultResolve(specifier, context, defaultResolve);\n-    }\n-\n-    const packageJson = JSON.parse(fs.readFileSync(path.join(pathToNodeModule, 'package.json'), 'utf-8'));\n-\n-    const localPackagePath = resolvePackageLocalFilepath(packageImport, packageJson);\n-    const resolvedFilePath = path.join(pathToNodeModule, localPackagePath);\n-\n-    return {url: pathToFileURL(resolvedFilePath).href};\n-}\n-\n-function isNodeOrNpmPackageImport(specifier) {\n-  return !specifier.startsWith('./') && !specifier.startsWith('../') && !specifier.startsWith('node:') && !specifier.startsWith('file:');\n-}\n-\n-function parsePackageImport(specifier) {\n-  const [, packageName, pathInPackage = ''] = /^((?:@[^/]+\\/)?[^/]+)(?:\\/(.+))?$/.exec(specifier) ?? [];\n-  if (!packageName) {\n-    throw new Error(`Could not parse package name import statement '${specifier}'`);\n-  }\n-  return {packageName, pathInPackage, specifier};\n-}\n-\n-function resolvePackageLocalFilepath(packageImport, packageJson) {\n-    if (packageJson.exports) {\n-        return resolveExports(packageJson, packageImport.specifier);\n-    }\n-\n-    return packageImport.pathInPackage || packageJson.module || packageJson.main || 'index.js';\n-}\n\n\n###\n\n", "completion": "build: rename `esm-loader.mjs` to a more specific filename (#<issue-num>)"}
{"prompt": " file path A: packages/bazel/src/ng_module/ng_module.bzl | file path B: packages/bazel/src/ng_module/ng_module.bzl\n\n@@ -60,7 +60,7 @@ def _flat_module_out_file(ctx):\n     from other attributes (name)\n \n     Args:\n-      ctx: skylark rule execution context\n+      ctx: starlark rule execution context\n \n     Returns:\n       a basename used for the flat module out (no extension)\n@@ -76,7 +76,7 @@ def _should_produce_flat_module_outs(ctx):\n     based on the presence of the module_name attribute.\n \n     Args:\n-      ctx: skylark rule execution context\n+      ctx: starlark rule execution context\n \n     Returns:\n       true iff we should run the bundle_index_host to produce flat module metadata and bundle index\n@@ -118,7 +118,7 @@ def _expected_outs(ctx):\n             else:\n                 devmode_js = [\".js\"]\n                 if not _is_bazel():\n-                    devmode_js += [\".ngfactory.js\"]\n+                    devmode_js.append(\".ngfactory.js\")\n         else:\n             continue\n \n@@ -238,17 +238,13 @@ def _ngc_tsconfig(ctx, files, srcs, **kwargs):\n     })\n \n     # For prodmode, the compilation target is set to `ES2020`. `@bazel/typecript`\n-    # using the `create_tsconfig` function sets `ES2015` by default.\n+    # using the `create_tsconfig` function sets `ES2015` by default for prodmode\n+    # and uses ES5 with UMD for devmode. We want to consistenly use ES2020 ESM.\n     # https://github.com/bazelbuild/rules_nodejs/blob/901df3868e3ceda177d3ed181205e8456a5592ea/third_party/github.com/bazelbuild/rules_typescript/internal/common/tsconfig.bzl#L195\n     # TODO(devversion): In the future, combine prodmode and devmode so we can get rid of the\n     # ambiguous terminology and concept that can result in slow-down for development workflows.\n-    if not is_devmode:\n-        # Note: Keep in sync with the `prodmode_target` for `ts_library` in `tools/defaults.bzl`\n-        tsconfig[\"compilerOptions\"][\"target\"] = \"es2020\"\n-    else:\n-        # For devmode output, we use ES2015 to match with what `ts_library` produces by default.\n-        # https://github.com/bazelbuild/rules_nodejs/blob/9b36274dba34204625579463e3da054a9f42cb47/packages/typescript/internal/build_defs.bzl#L83.\n-        tsconfig[\"compilerOptions\"][\"target\"] = \"es2015\"\n+    tsconfig[\"compilerOptions\"][\"target\"] = \"es2020\"\n+    tsconfig[\"compilerOptions\"][\"module\"] = \"esnext\"\n \n     return tsconfig\n \n@@ -278,7 +274,7 @@ def ngc_compile_action(\n     as part of the public API.\n \n     Args:\n-      ctx: skylark context\n+      ctx: starlark context\n       label: the label of the ng_module being compiled\n       inputs: passed to the ngc action's inputs\n       outputs: passed to the ngc action's outputs\n@@ -315,7 +311,7 @@ def ngc_compile_action(\n     # Two at-signs escapes the argument so it's passed through to ngc\n     # rather than the contents getting expanded.\n     if supports_workers == \"1\":\n-        arguments += [\"@@\" + tsconfig_file.path]\n+        arguments.append(\"@@\" + tsconfig_file.path)\n     else:\n         arguments += [\"-p\", tsconfig_file.path]\n \n@@ -414,7 +410,7 @@ def ng_module_impl(ctx, ts_compile_actions):\n     and is not meant as a public API.\n \n     Args:\n-      ctx: the skylark rule context\n+      ctx: the starlark rule context\n       ts_compile_actions: generates all the actions to run an ngc compilation\n \n     Returns:\n\n---\n file path A: tools/defaults.bzl | file path B: tools/defaults.bzl\n\n@@ -102,7 +102,17 @@ def ts_devserver(**kwargs):\n \n ts_config = _ts_config\n \n-def ts_library(name, tsconfig = None, testonly = False, deps = [], module_name = None, package_name = None, **kwargs):\n+def ts_library(\n+        name,\n+        tsconfig = None,\n+        testonly = False,\n+        deps = [],\n+        module_name = None,\n+        package_name = None,\n+        # TODO(devversion): disallow configuration of the target when binaries/schematics can be ESM.\n+        devmode_target = None,\n+        devmode_module = None,\n+        **kwargs):\n     \"\"\"Default values for ts_library\"\"\"\n     deps = deps + [\"@npm//tslib\"]\n     if testonly:\n@@ -122,16 +132,24 @@ def ts_library(name, tsconfig = None, testonly = False, deps = [], module_name =\n     if not package_name:\n         package_name = _default_module_name(testonly)\n \n+    default_target = \"es2020\"\n+    default_module = \"esnext\"\n+\n     _ts_library(\n         name = name,\n         tsconfig = tsconfig,\n         testonly = testonly,\n         deps = deps,\n+        # We also set devmode output to the same settings as prodmode as a first step in\n+        # combining devmode and prodmode output.\n+        devmode_target = devmode_target if devmode_target != None else default_target,\n+        devmode_module = devmode_module if devmode_module != None else default_module,\n         # For prodmode, the target is set to `ES2020`. `@bazel/typecript` sets `ES2015` by\n         # default. Note that this should be in sync with the `ng_module` tsconfig generation.\n         # https://github.com/bazelbuild/rules_nodejs/blob/901df3868e3ceda177d3ed181205e8456a5592ea/third_party/github.com/bazelbuild/rules_typescript/internal/common/tsconfig.bzl#L195\n         # https://github.com/bazelbuild/rules_nodejs/blob/9b36274dba34204625579463e3da054a9f42cb47/packages/typescript/internal/build_defs.bzl#L85.\n-        prodmode_target = \"es2020\",\n+        prodmode_target = default_target,\n+        prodmode_module = default_module,\n         # `module_name` is used for AMD module names within emitted JavaScript files.\n         module_name = module_name,\n         # `package_name` can be set to allow for the Bazel NodeJS linker to run. This\n\n\n###\n\n", "completion": "build: switch `ng_module` and `ts_library` devmode to ES2020 ESM (#<issue-num>)"}
{"prompt": " file path A: None | file path B: .github/workflows/merge-ready-status.yml\n\n@@ -0,0 +1,14 @@\n+name: Merge Ready\n+\n+on: pull_request_target\n+\n+# Declare default permissions as read only.\n+permissions: {}\n+\n+jobs:\n+  status:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - uses: angular/dev-infra/github-actions/unified-status-check@f1e8862e5034f046cc0bc66641d37f5b36d3e9b5\n+        with:\n+          angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n\n###\n\n", "completion": "build: enable new merge ready status action (#<issue-num>)"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -319,6 +319,9 @@ architect_test(\n         \"CHROME_BIN\": \"../$(CHROMIUM)\",\n         \"CHROMEDRIVER_BIN\": \"../$(CHROMEDRIVER)\",\n     },\n+    # TODO: investigate why those tests became more flaky\n+    #       (presumably after AIO migration to Bazel)\n+    flaky = True,\n     toolchains = [\n         \"@aio_npm//@angular/build-tooling/bazel/browsers/chromium:toolchain_alias\",\n     ],\n\n\n###\n\n", "completion": "ci: mark //aio:e2e tests as flaky (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,23 @@\n+<a name=\"15.0.4\"></a>\n+# 15.0.4 (2022-12-14)\n+### animations\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [6c1064c72f](https://github.com/angular/angular/commit/6c1064c72f7d5b9a455813046939ab0161c143bf) | fix | fix incorrect handling of camel-case css properties ([#48436](https://github.com/angular/angular/pull/48436)) |\n+### common\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [f30d18a942](https://github.com/angular/angular/commit/f30d18a9424afacbd47d70f91e233e286bb94b0d) | fix | Fix TestBed.overrideProvider type to include multi ([#48424](https://github.com/angular/angular/pull/48424)) |\n+| [59c6bfb632](https://github.com/angular/angular/commit/59c6bfb6324c5baf53b907afee9170e1ce81ddbc) | fix | Update `Location` to get a normalized URL valid in case a represented URL starts with the substring equals `APP_BASE_HREF` ([#48394](https://github.com/angular/angular/pull/48394)) |\n+### compiler-cli\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [b55d2dab5d](https://github.com/angular/angular/commit/b55d2dab5d76ffa809ac1feb78392a75c3081dec) | fix | evaluate const tuple types statically ([#48091](https://github.com/angular/angular/pull/48091)) |\n+## Special Thanks\n+Alan Agius, Andrew Kushnir, Andrew Scott, Aristeidis Bampakos, Bob Watson, BrowserPerson, Jens, Jessica Janiuk, Joey Perrott, JoostK, Konstantin Kharitonov, Lukas Matta, Piotr Kowalski, Virginia Dooley, Yannick Baron, dario-piotrowicz, lsst25, piyush132000 and why520crazy\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.1.0-next.2\"></a>\n # 15.1.0-next.2 (2022-12-07)\n ### common\n\n\n###\n\n", "completion": "docs: release notes for the v15.0.4 release"}
{"prompt": " file path A: goldens/public-api/common/index.md | file path B: goldens/public-api/common/index.md\n\n@@ -50,6 +50,48 @@ export class AsyncPipe implements OnDestroy, PipeTransform {\n     static \u0275pipe: i0.\u0275\u0275PipeDeclaration<AsyncPipe, \"async\", true>;\n }\n \n+// @public\n+export class BrowserPlatformLocation extends PlatformLocation {\n+    constructor(_doc: any);\n+    // (undocumented)\n+    back(): void;\n+    // (undocumented)\n+    forward(): void;\n+    // (undocumented)\n+    getBaseHrefFromDOM(): string;\n+    // (undocumented)\n+    getState(): unknown;\n+    // (undocumented)\n+    get hash(): string;\n+    // (undocumented)\n+    historyGo(relativePosition?: number): void;\n+    // (undocumented)\n+    get hostname(): string;\n+    // (undocumented)\n+    get href(): string;\n+    // (undocumented)\n+    onHashChange(fn: LocationChangeListener): VoidFunction;\n+    // (undocumented)\n+    onPopState(fn: LocationChangeListener): VoidFunction;\n+    // (undocumented)\n+    get pathname(): string;\n+    set pathname(newPath: string);\n+    // (undocumented)\n+    get port(): string;\n+    // (undocumented)\n+    get protocol(): string;\n+    // (undocumented)\n+    pushState(state: any, title: string, url: string): void;\n+    // (undocumented)\n+    replaceState(state: any, title: string, url: string): void;\n+    // (undocumented)\n+    get search(): string;\n+    // (undocumented)\n+    static \u0275fac: i0.\u0275\u0275FactoryDeclaration<BrowserPlatformLocation, never>;\n+    // (undocumented)\n+    static \u0275prov: i0.\u0275\u0275InjectableDeclaration<BrowserPlatformLocation>;\n+}\n+\n // @public\n export class CommonModule {\n     // (undocumented)\n\n---\n file path A: packages/common/src/location/index.ts | file path B: packages/common/src/location/index.ts\n\n@@ -9,4 +9,4 @@\n export {HashLocationStrategy} from './hash_location_strategy';\n export {Location, PopStateEvent} from './location';\n export {APP_BASE_HREF, LocationStrategy, PathLocationStrategy} from './location_strategy';\n-export {LOCATION_INITIALIZED, LocationChangeEvent, LocationChangeListener, PlatformLocation} from './platform_location';\n+export {BrowserPlatformLocation, LOCATION_INITIALIZED, LocationChangeEvent, LocationChangeListener, PlatformLocation} from './platform_location';\n\n---\n file path A: packages/common/src/location/platform_location.ts | file path B: packages/common/src/location/platform_location.ts\n\n@@ -7,6 +7,7 @@\n  */\n \n import {Inject, Injectable, InjectionToken, \u0275\u0275inject} from '@angular/core';\n+\n import {getDOM} from '../dom_adapter';\n import {DOCUMENT} from '../dom_tokens';\n \n@@ -106,6 +107,8 @@ export interface LocationChangeListener {\n  * `PlatformLocation` encapsulates all of the direct calls to platform APIs.\n  * This class should not be used directly by an application developer. Instead, use\n  * {@link Location}.\n+ *\n+ * @publicApi\n  */\n @Injectable({\n   providedIn: 'platform',\n@@ -113,18 +116,12 @@ export interface LocationChangeListener {\n   useFactory: createBrowserPlatformLocation,\n })\n export class BrowserPlatformLocation extends PlatformLocation {\n-  public readonly location!: Location;\n-  private _history!: History;\n+  private _location: Location;\n+  private _history: History;\n \n   constructor(@Inject(DOCUMENT) private _doc: any) {\n     super();\n-    this._init();\n-  }\n-\n-  // This is moved to its own method so that `MockPlatformLocationStrategy` can overwrite it\n-  /** @internal */\n-  _init() {\n-    (this as {location: Location}).location = window.location;\n+    this._location = window.location;\n     this._history = window.history;\n   }\n \n@@ -145,35 +142,35 @@ export class BrowserPlatformLocation extends PlatformLocation {\n   }\n \n   override get href(): string {\n-    return this.location.href;\n+    return this._location.href;\n   }\n   override get protocol(): string {\n-    return this.location.protocol;\n+    return this._location.protocol;\n   }\n   override get hostname(): string {\n-    return this.location.hostname;\n+    return this._location.hostname;\n   }\n   override get port(): string {\n-    return this.location.port;\n+    return this._location.port;\n   }\n   override get pathname(): string {\n-    return this.location.pathname;\n+    return this._location.pathname;\n   }\n   override get search(): string {\n-    return this.location.search;\n+    return this._location.search;\n   }\n   override get hash(): string {\n-    return this.location.hash;\n+    return this._location.hash;\n   }\n   override set pathname(newPath: string) {\n-    this.location.pathname = newPath;\n+    this._location.pathname = newPath;\n   }\n \n   override pushState(state: any, title: string, url: string): void {\n     if (supportsState()) {\n       this._history.pushState(state, title, url);\n     } else {\n-      this.location.hash = url;\n+      this._location.hash = url;\n     }\n   }\n \n@@ -181,7 +178,7 @@ export class BrowserPlatformLocation extends PlatformLocation {\n     if (supportsState()) {\n       this._history.replaceState(state, title, url);\n     } else {\n-      this.location.hash = url;\n+      this._location.hash = url;\n     }\n   }\n \n\n\n###\n\n", "completion": "feat(common): Add BrowserPlatformLocation to the public API (#<issue-num>)"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -59,7 +59,7 @@ http_archive(\n # Download cli source from angular/cli-builds for doc generation at a specific tag or commit.\n # If the ref is a commit sha, use the full sha instead of the abbreviated form. Tags, which\n # hold an abbreviated sha by convention in cli-builds, can continue to use the short form.\n-CLI_SRC_REF = \"6ccbc6b4cba4fde7898b67d2e195a1ea3bf4553e\"\n+CLI_SRC_REF = \"f0163d17d581f7ea59ada47420599264060db77a\"\n \n http_archive(\n     name = \"angular_cli_src\",\n@@ -77,7 +77,7 @@ filegroup(\n     # Run the following command to calculate the sha256, substituting the CLI_SRC_REF\n     # wget -O- -q https://github.com/angular/cli-builds/archive/{CLI_SRC_REF}.tar.gz | sha256sum\n     # Alternatively, just remove the parameter and bazel debug will output the sha as a suggestion.\n-    sha256 = \"6558e1774904719d0615f01b88368d7fe3a927ea1e54cb0436e7957bc8f6d0a6\",\n+    sha256 = \"952a62ce2b040af74fe3ae4d0bef5eaca505b7986df3bcf776e4ce84628cd3ed\",\n     strip_prefix = \"cli-builds-%s\" % CLI_SRC_REF,\n     url = \"https://github.com/angular/cli-builds/archive/%s.tar.gz\" % CLI_SRC_REF,\n )\n\n\n###\n\n", "completion": "docs: update CLI sources ref (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/releases.md | file path B: aio/content/guide/releases.md\n\n@@ -112,9 +112,9 @@ Dates are offered as general guidance and are subject to change.\n \n | Version | Date               |\n | :---    | :---               |\n-| v15.1   | Week of 2022-01-09 |\n-| v15.2   | Week of 2022-02-20 |\n-| v16.0   | Week of 2022-05-01 |\n+| v15.1   | Week of 2023-01-09 |\n+| v15.2   | Week of 2023-02-20 |\n+| v16.0   | Week of 2023-05-01 |\n \n ### Support window\n \n\n\n###\n\n", "completion": "docs: update date from 2022 to 2023 (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/releases.md | file path B: aio/content/guide/releases.md\n\n@@ -112,7 +112,9 @@ Dates are offered as general guidance and are subject to change.\n \n | Version | Date               |\n | :---    | :---               |\n-| v15.0   | Week of 2022-11-18 |\n+| v15.1   | Week of 2022-01-09 |\n+| v15.2   | Week of 2022-02-20 |\n+| v16.0   | Week of 2022-05-01 |\n \n ### Support window\n \n\n\n###\n\n", "completion": "docs: add planned release schedule till v16 (#<issue-num>)"}
{"prompt": " file path A: packages/core/test/bundling/router/bundle.golden_symbols.json | file path B: packages/core/test/bundling/router/bundle.golden_symbols.json\n\n@@ -110,6 +110,9 @@\n   {\n     \"name\": \"Console\"\n   },\n+  {\n+    \"name\": \"CreateUrlTreeStrategy\"\n+  },\n   {\n     \"name\": \"DEFAULT_SERIALIZER\"\n   },\n@@ -251,6 +254,9 @@\n   {\n     \"name\": \"LQuery_\"\n   },\n+  {\n+    \"name\": \"LegacyCreateUrlTree\"\n+  },\n   {\n     \"name\": \"LifecycleHooksFeature\"\n   },\n\n---\n file path A: packages/router/src/create_url_tree.ts | file path B: packages/router/src/create_url_tree.ts\n\n@@ -74,10 +74,11 @@ export function createUrlTreeFromSnapshot(\n   return createUrlTreeFromSegmentGroup(relativeToUrlSegmentGroup, commands, queryParams, fragment);\n }\n \n-function createSegmentGroupFromRoute(route: ActivatedRouteSnapshot): UrlSegmentGroup {\n+export function createSegmentGroupFromRoute(route: ActivatedRouteSnapshot): UrlSegmentGroup {\n   let targetGroup: UrlSegmentGroup|undefined;\n \n-  function createSegmentGroupFromRouteRecursive(currentRoute: ActivatedRouteSnapshot) {\n+  function createSegmentGroupFromRouteRecursive(currentRoute: ActivatedRouteSnapshot):\n+      UrlSegmentGroup {\n     const childOutlets: {[outlet: string]: UrlSegmentGroup} = {};\n     for (const childSnapshot of currentRoute.children) {\n       const root = createSegmentGroupFromRouteRecursive(childSnapshot);\n\n---\n file path A: None | file path B: packages/router/src/create_url_tree_strategy.ts\n\n@@ -0,0 +1,69 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Injectable} from '@angular/core';\n+\n+import {createSegmentGroupFromRoute, createUrlTree, createUrlTreeFromSegmentGroup} from './create_url_tree';\n+import {ActivatedRoute, RouterState} from './router_state';\n+import {Params} from './shared';\n+import {UrlSegmentGroup, UrlTree} from './url_tree';\n+\n+const NG_DEV_MODE = typeof ngDevMode === 'undefined' || ngDevMode;\n+\n+@Injectable()\n+export class LegacyCreateUrlTree implements CreateUrlTreeStrategy {\n+  createUrlTree(\n+      relativeTo: ActivatedRoute|null|undefined, currentState: RouterState, currentUrlTree: UrlTree,\n+      commands: any[], queryParams: Params|null, fragment: string|null): UrlTree {\n+    const a = relativeTo || currentState.root;\n+    return createUrlTree(a, currentUrlTree, commands, queryParams, fragment);\n+  }\n+}\n+\n+@Injectable()\n+export class CreateUrlTreeUsingSnapshot implements CreateUrlTreeStrategy {\n+  createUrlTree(\n+      relativeTo: ActivatedRoute|null|undefined, currentState: RouterState, currentUrlTree: UrlTree,\n+      commands: any[], queryParams: Params|null, fragment: string|null): UrlTree {\n+    let relativeToUrlSegmentGroup: UrlSegmentGroup|undefined;\n+    try {\n+      const relativeToSnapshot = relativeTo ? relativeTo.snapshot : currentState.snapshot.root;\n+      relativeToUrlSegmentGroup = createSegmentGroupFromRoute(relativeToSnapshot);\n+    } catch (e: unknown) {\n+      // This is strictly for backwards compatibility with tests that create\n+      // invalid `ActivatedRoute` mocks.\n+      // Note: the difference between having this fallback for invalid `ActivatedRoute` setups and\n+      // just throwing is ~500 test failures. Fixing all of those tests by hand is not feasible at\n+      // the moment.\n+      if (NG_DEV_MODE) {\n+        console.warn(\n+            `The ActivatedRoute has an invalid structure. This is likely due to an incomplete mock in tests.`);\n+      }\n+      if (typeof commands[0] !== 'string' || !commands[0].startsWith('/')) {\n+        // Navigations that were absolute in the old way of creating UrlTrees\n+        // would still work because they wouldn't attempt to match the\n+        // segments in the `ActivatedRoute` to the `currentUrlTree` but\n+        // instead just replace the root segment with the navigation result.\n+        // Non-absolute navigations would fail to apply the commands because\n+        // the logic could not find the segment to replace (so they'd act like there were no\n+        // commands).\n+        commands = [];\n+      }\n+      relativeToUrlSegmentGroup = currentUrlTree.root;\n+    }\n+    return createUrlTreeFromSegmentGroup(\n+        relativeToUrlSegmentGroup, commands, queryParams, fragment);\n+  }\n+}\n+\n+@Injectable({providedIn: 'root', useClass: LegacyCreateUrlTree})\n+export abstract class CreateUrlTreeStrategy {\n+  abstract createUrlTree(\n+      relativeTo: ActivatedRoute|null|undefined, currentState: RouterState, currentUrlTree: UrlTree,\n+      commands: any[], queryParams: Params|null, fragment: string|null): UrlTree;\n+}\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -10,7 +10,7 @@ import {Location} from '@angular/common';\n import {Compiler, inject, Injectable, Injector, NgZone, Type, \u0275Console as Console, \u0275RuntimeError as RuntimeError} from '@angular/core';\n import {BehaviorSubject, Observable, of, SubscriptionLike} from 'rxjs';\n \n-import {createUrlTree} from './create_url_tree';\n+import {CreateUrlTreeStrategy} from './create_url_tree_strategy';\n import {RuntimeErrorCode} from './errors';\n import {Event, NavigationTrigger} from './events';\n import {NavigationBehaviorOptions, OnSameUrlNavigation, Routes} from './models';\n@@ -228,6 +228,9 @@ export class Router {\n    */\n   routeReuseStrategy = inject(RouteReuseStrategy);\n \n+  /** Strategy used to create a UrlTree. */\n+  private readonly urlCreationStrategy = inject(CreateUrlTreeStrategy);\n+\n   /**\n    * A strategy for setting the title based on the `routerState`.\n    *\n@@ -503,7 +506,6 @@ export class Router {\n   createUrlTree(commands: any[], navigationExtras: UrlCreationOptions = {}): UrlTree {\n     const {relativeTo, queryParams, fragment, queryParamsHandling, preserveFragment} =\n         navigationExtras;\n-    const a = relativeTo || this.routerState.root;\n     const f = preserveFragment ? this.currentUrlTree.fragment : fragment;\n     let q: Params|null = null;\n     switch (queryParamsHandling) {\n@@ -519,7 +521,8 @@ export class Router {\n     if (q !== null) {\n       q = this.removeEmptyProps(q);\n     }\n-    return createUrlTree(a, this.currentUrlTree, commands, q, f ?? null);\n+    return this.urlCreationStrategy.createUrlTree(\n+        relativeTo, this.routerState, this.currentUrlTree, commands, q, f ?? null);\n   }\n \n   /**\n\n\n###\n\n", "completion": "refactor(router): Add opt-in provider for upcoming router change (#<issue-num>)"}
{"prompt": " file path A: None | file path B: aio/content/extended-diagnostics/NG8104.md\n\n@@ -0,0 +1,48 @@\n+@name Text attribute not binding\n+\n+@description\n+\n+This diagnostic ensures that attributes which have the \"special\" Angular binding prefix (`attr.`, `style.`, and\n+`class.`) are interpreted as bindings. For example, `<div attr.id=\"my-id\"></div>` will not\n+interpret this as an attribute binding to `id` but rather just a regular attribute and will appear\n+as-is in the final HTML (`<div attr.id=\"my-id\"></div>`). This is likely not the intent of the developer.\n+Instead, the intent is likely to have the `id` be set to 'my-id' (`<div id=\"my-id\"></div>`).\n+\n+## What should I do instead?\n+\n+When binding to `attr.`, `class.`, or `style.`, ensure you use the Angular template binding syntax.\n+\n+<pre>\n+  &lt;div [attr.id]=\"my-id\">&lt;/div>\n+  &lt;div [style.color]=\"red\">&lt;/div>\n+  &lt;div [class.blue]=\"true\">&lt;/div>\n+</pre>\n+\n+\n+## What if I can't avoid this?\n+\n+This diagnostic can be disabled by editing the project's `tsconfig.json` file:\n+\n+<code-example format=\"json\" language=\"json\">\n+\n+{\n+  \"angularCompilerOptions\": {\n+    \"extendedDiagnostics\": {\n+      \"checks\": {\n+        \"textAttributeNotBinding\": \"suppress\"\n+      }\n+    }\n+  }\n+}\n+\n+</code-example>\n+\n+See [extended diagnostic configuration](extended-diagnostics#configuration) for more info.\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-11-30\n\n---\n file path A: aio/content/extended-diagnostics/index.md | file path B: aio/content/extended-diagnostics/index.md\n\n@@ -13,6 +13,7 @@ Currently, Angular supports the following extended diagnostics:\n *   [NG8103 - `missingControlFlowDirective`](extended-diagnostics/NG8103)\n *   [NG8105 - `missingNgForOfLet`](extended-diagnostics/NG8105)\n *   [NG8106 - `suffixNotSupported`](extended-diagnostics/NG8106)\n+*   [NG8104 - `textAttributeNotBinding`](extended-diagnostics/NG8104)\n \n ## Configuration\n \n\n\n###\n\n", "completion": "docs: Add doc page for 'textAttributeNotBinding' extended diagnostic (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/dependency-injection.md | file path B: aio/content/guide/dependency-injection.md\n\n@@ -44,7 +44,8 @@ When you register a provider at the component level, you get a new instance of t\n class HeroListModule {}\n </code-example>\n \n-When you register a provider with a specific NgModule, the same instance of a service is available to all components in that NgModule (to understand all edge-cases, see [Hierarchical injectors](guide/hierarchical-dependency-injection)).\n+When you register a provider with a specific NgModule, the same instance of a service is available to all components in that NgModule.\n+To understand all edge-cases, see [Hierarchical injectors](guide/hierarchical-dependency-injection).\n \n * At the application root level, which allows injecting it into other classes in the application. This can be done by adding the `providedIn: 'root'` field to the `@Injectable` decorator:\n \n\n\n###\n\n", "completion": "docs: edit suggestion to meet style guide (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/dependency-injection.md | file path B: aio/content/guide/dependency-injection.md\n\n@@ -44,7 +44,7 @@ When you register a provider at the component level, you get a new instance of t\n class HeroListModule {}\n </code-example>\n \n-When you register a provider with a specific NgModule, the same instance of a service is available to all components in that NgModule.\n+When you register a provider with a specific NgModule, the same instance of a service is available to all components in that NgModule (to understand all edge-cases, see [Hierarchical injectors](guide/hierarchical-dependency-injection)).\n \n * At the application root level, which allows injecting it into other classes in the application. This can be done by adding the `providedIn: 'root'` field to the `@Injectable` decorator:\n \n\n\n###\n\n", "completion": "docs: add a link to hierarchical-dependency-injection (#<issue-num>)"}
{"prompt": " file path A: None | file path B: aio/content/errors/NG0209.md\n\n@@ -0,0 +1,17 @@\n+@name Invalid multi provider\n+@category runtime\n+@shortDescription Expected provider to be `multi: true` but did not get an Array\n+\n+@description\n+\n+The Angular runtime will throw this error when it injects a token intended to be used with `multi: true` but\n+a non-Array was found instead. For example, `ENVIRONMENT_INITIALIZER` should be provided\n+like `{provide: ENVIRONMENT_INITIALIZER, multi: true, useValue: () => {...}}`.\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-11-28\n\\ No newline at end of file\n\n---\n file path A: goldens/public-api/core/errors.md | file path B: goldens/public-api/core/errors.md\n\n@@ -59,7 +59,7 @@ export const enum RuntimeErrorCode {\n     // (undocumented)\n     INVALID_INJECTION_TOKEN = 204,\n     // (undocumented)\n-    INVALID_MULTI_PROVIDER = 209,\n+    INVALID_MULTI_PROVIDER = -209,\n     // (undocumented)\n     MISSING_GENERATED_DEF = 906,\n     // (undocumented)\n\n---\n file path A: packages/core/src/application_init.ts | file path B: packages/core/src/application_init.ts\n\n@@ -102,6 +102,7 @@ export class ApplicationInitStatus {\n \n   constructor(@Inject(APP_INITIALIZER) @Optional() private readonly appInits:\n                   ReadonlyArray<() => Observable<unknown>| Promise<unknown>| void>) {\n+    // TODO: Throw RuntimeErrorCode.INVALID_MULTI_PROVIDER if appInits is not an array\n     this.donePromise = new Promise((res, rej) => {\n       this.resolve = res;\n       this.reject = rej;\n\n---\n file path A: packages/core/src/application_ref.ts | file path B: packages/core/src/application_ref.ts\n\n@@ -1051,8 +1051,16 @@ export class ApplicationRef {\n     this.tick();\n     this.components.push(componentRef);\n     // Get the listeners lazily to prevent DI cycles.\n-    const listeners =\n-        this._injector.get(APP_BOOTSTRAP_LISTENER, []).concat(this._bootstrapListeners);\n+    const listeners = this._injector.get(APP_BOOTSTRAP_LISTENER, []);\n+    if (ngDevMode && !Array.isArray(listeners)) {\n+      throw new RuntimeError(\n+          RuntimeErrorCode.INVALID_MULTI_PROVIDER,\n+          'Unexpected type of the `APP_BOOTSTRAP_LISTENER` token value ' +\n+              `(expected an array, but got ${typeof listeners}). ` +\n+              'Please check that the `APP_BOOTSTRAP_LISTENER` token is configured as a ' +\n+              '`multi: true` provider.');\n+    }\n+    listeners.push(...this._bootstrapListeners);\n     listeners.forEach((listener) => listener(componentRef));\n   }\n \n\n---\n file path A: packages/core/src/errors.ts | file path B: packages/core/src/errors.ts\n\n@@ -32,7 +32,7 @@ export const enum RuntimeErrorCode {\n   INJECTOR_ALREADY_DESTROYED = 205,\n   PROVIDER_IN_WRONG_CONTEXT = 207,\n   MISSING_INJECTION_TOKEN = 208,\n-  INVALID_MULTI_PROVIDER = 209,\n+  INVALID_MULTI_PROVIDER = -209,\n \n   // Template Errors\n   MULTIPLE_COMPONENTS_MATCH = -300,\n\n---\n file path A: packages/core/test/acceptance/environment_injector_spec.ts | file path B: packages/core/test/acceptance/environment_injector_spec.ts\n\n@@ -8,6 +8,7 @@\n \n import {Component, ComponentFactoryResolver, createEnvironmentInjector, ENVIRONMENT_INITIALIZER, EnvironmentInjector, inject, InjectFlags, InjectionToken, INJECTOR, Injector, NgModuleRef, ViewContainerRef} from '@angular/core';\n import {R3Injector} from '@angular/core/src/di/r3_injector';\n+import {RuntimeError, RuntimeErrorCode} from '@angular/core/src/errors';\n import {TestBed} from '@angular/core/testing';\n \n describe('environment injector', () => {\n@@ -117,11 +118,7 @@ describe('environment injector', () => {\n       useValue: () => {},\n     }];\n     expect(() => createEnvironmentInjector(providers, parentEnvInjector))\n-        .toThrowError(\n-            'NG0209: Unexpected type of the `ENVIRONMENT_INITIALIZER` token value ' +\n-            '(expected an array, but got function). ' +\n-            'Please check that the `ENVIRONMENT_INITIALIZER` token is configured as ' +\n-            'a `multi: true` provider.');\n+        .toThrowMatching((e: RuntimeError) => e.code === RuntimeErrorCode.INVALID_MULTI_PROVIDER);\n   });\n \n   it('should adopt environment-scoped providers', () => {\n\n\n###\n\n", "completion": "docs(core): Document invalid multi token (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -100,8 +100,8 @@\n     \"@types/node\": \"^12.7.9\",\n     \"@types/trusted-types\": \"^2.0.2\",\n     \"@types/xregexp\": \"^4.3.0\",\n-    \"@typescript-eslint/eslint-plugin\": \"5.45.1\",\n-    \"@typescript-eslint/parser\": \"5.45.1\",\n+    \"@typescript-eslint/eslint-plugin\": \"5.46.1\",\n+    \"@typescript-eslint/parser\": \"5.46.1\",\n     \"archiver\": \"^5.3.0\",\n     \"assert\": \"^2.0.0\",\n     \"canonical-path\": \"1.0.0\",\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -190,7 +190,6 @@\n \n \"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#8bfc7e1aca9125487c1d52a5a2c09cc9e134e421\":\n   version \"0.0.0-96fdaaa056f1cfa7ffbc4c69b7e9007279f76c94\"\n-  uid \"8bfc7e1aca9125487c1d52a5a2c09cc9e134e421\"\n   resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#8bfc7e1aca9125487c1d52a5a2c09cc9e134e421\"\n   dependencies:\n     \"@angular-devkit/build-angular\" \"15.1.0-next.2\"\n@@ -3251,14 +3250,14 @@\n   dependencies:\n     \"@types/node\" \"*\"\n \n-\"@typescript-eslint/eslint-plugin@5.45.1\":\n-  version \"5.45.1\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/eslint-plugin/-/eslint-plugin-5.45.1.tgz#ee5b51405f6c9ee7e60e4006d68c69450d3b4536\"\n-  integrity sha512-cOizjPlKEh0bXdFrBLTrI/J6B/QMlhwE9auOov53tgB+qMukH6/h8YAK/qw+QJGct/PTbdh2lytGyipxCcEtAw==\n+\"@typescript-eslint/eslint-plugin@5.46.1\":\n+  version \"5.46.1\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/eslint-plugin/-/eslint-plugin-5.46.1.tgz#098abb4c9354e19f460d57ab18bff1f676a6cff0\"\n+  integrity sha512-YpzNv3aayRBwjs4J3oz65eVLXc9xx0PDbIRisHj+dYhvBn02MjYOD96P8YGiWEIFBrojaUjxvkaUpakD82phsA==\n   dependencies:\n-    \"@typescript-eslint/scope-manager\" \"5.45.1\"\n-    \"@typescript-eslint/type-utils\" \"5.45.1\"\n-    \"@typescript-eslint/utils\" \"5.45.1\"\n+    \"@typescript-eslint/scope-manager\" \"5.46.1\"\n+    \"@typescript-eslint/type-utils\" \"5.46.1\"\n+    \"@typescript-eslint/utils\" \"5.46.1\"\n     debug \"^4.3.4\"\n     ignore \"^5.2.0\"\n     natural-compare-lite \"^1.4.0\"\n@@ -3266,14 +3265,14 @@\n     semver \"^7.3.7\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/parser@5.45.1\":\n-  version \"5.45.1\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/parser/-/parser-5.45.1.tgz#6440ec283fa1373a12652d4e2fef4cb6e7b7e8c6\"\n-  integrity sha512-JQ3Ep8bEOXu16q0ztsatp/iQfDCtvap7sp/DKo7DWltUquj5AfCOpX2zSzJ8YkAVnrQNqQ5R62PBz2UtrfmCkA==\n+\"@typescript-eslint/parser@5.46.1\":\n+  version \"5.46.1\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/parser/-/parser-5.46.1.tgz#1fc8e7102c1141eb64276c3b89d70da8c0ba5699\"\n+  integrity sha512-RelQ5cGypPh4ySAtfIMBzBGyrNerQcmfA1oJvPj5f+H4jI59rl9xxpn4bonC0tQvUKOEN7eGBFWxFLK3Xepneg==\n   dependencies:\n-    \"@typescript-eslint/scope-manager\" \"5.45.1\"\n-    \"@typescript-eslint/types\" \"5.45.1\"\n-    \"@typescript-eslint/typescript-estree\" \"5.45.1\"\n+    \"@typescript-eslint/scope-manager\" \"5.46.1\"\n+    \"@typescript-eslint/types\" \"5.46.1\"\n+    \"@typescript-eslint/typescript-estree\" \"5.46.1\"\n     debug \"^4.3.4\"\n \n \"@typescript-eslint/scope-manager@5.43.0\":\n@@ -3284,13 +3283,13 @@\n     \"@typescript-eslint/types\" \"5.43.0\"\n     \"@typescript-eslint/visitor-keys\" \"5.43.0\"\n \n-\"@typescript-eslint/scope-manager@5.45.1\":\n-  version \"5.45.1\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/scope-manager/-/scope-manager-5.45.1.tgz#5b87d025eec7035d879b99c260f03be5c247883c\"\n-  integrity sha512-D6fCileR6Iai7E35Eb4Kp+k0iW7F1wxXYrOhX/3dywsOJpJAQ20Fwgcf+P/TDtvQ7zcsWsrJaglaQWDhOMsspQ==\n+\"@typescript-eslint/scope-manager@5.46.1\":\n+  version \"5.46.1\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/scope-manager/-/scope-manager-5.46.1.tgz#70af8425c79bbc1178b5a63fb51102ddf48e104a\"\n+  integrity sha512-iOChVivo4jpwUdrJZyXSMrEIM/PvsbbDOX1y3UCKjSgWn+W89skxWaYXACQfxmIGhPVpRWK/VWPYc+bad6smIA==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.45.1\"\n-    \"@typescript-eslint/visitor-keys\" \"5.45.1\"\n+    \"@typescript-eslint/types\" \"5.46.1\"\n+    \"@typescript-eslint/visitor-keys\" \"5.46.1\"\n \n \"@typescript-eslint/type-utils@5.43.0\":\n   version \"5.43.0\"\n@@ -3302,13 +3301,13 @@\n     debug \"^4.3.4\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/type-utils@5.45.1\":\n-  version \"5.45.1\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/type-utils/-/type-utils-5.45.1.tgz#cb7d300c3c95802cea9f87c7f8be363cf8f8538c\"\n-  integrity sha512-aosxFa+0CoYgYEl3aptLe1svP910DJq68nwEJzyQcrtRhC4BN0tJAvZGAe+D0tzjJmFXe+h4leSsiZhwBa2vrA==\n+\"@typescript-eslint/type-utils@5.46.1\":\n+  version \"5.46.1\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/type-utils/-/type-utils-5.46.1.tgz#195033e4b30b51b870dfcf2828e88d57b04a11cc\"\n+  integrity sha512-V/zMyfI+jDmL1ADxfDxjZ0EMbtiVqj8LUGPAGyBkXXStWmCUErMpW873zEHsyguWCuq2iN4BrlWUkmuVj84yng==\n   dependencies:\n-    \"@typescript-eslint/typescript-estree\" \"5.45.1\"\n-    \"@typescript-eslint/utils\" \"5.45.1\"\n+    \"@typescript-eslint/typescript-estree\" \"5.46.1\"\n+    \"@typescript-eslint/utils\" \"5.46.1\"\n     debug \"^4.3.4\"\n     tsutils \"^3.21.0\"\n \n@@ -3317,10 +3316,10 @@\n   resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.43.0.tgz#e4ddd7846fcbc074325293515fa98e844d8d2578\"\n   integrity sha512-jpsbcD0x6AUvV7tyOlyvon0aUsQpF8W+7TpJntfCUWU1qaIKu2K34pMwQKSzQH8ORgUrGYY6pVIh1Pi8TNeteg==\n \n-\"@typescript-eslint/types@5.45.1\":\n-  version \"5.45.1\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.45.1.tgz#8e1883041cee23f1bb7e1343b0139f97f6a17c14\"\n-  integrity sha512-HEW3U0E5dLjUT+nk7b4lLbOherS1U4ap+b9pfu2oGsW3oPu7genRaY9dDv3nMczC1rbnRY2W/D7SN05wYoGImg==\n+\"@typescript-eslint/types@5.46.1\":\n+  version \"5.46.1\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.46.1.tgz#4e9db2107b9a88441c4d5ecacde3bb7a5ebbd47e\"\n+  integrity sha512-Z5pvlCaZgU+93ryiYUwGwLl9AQVB/PQ1TsJ9NZ/gHzZjN7g9IAn6RSDkpCV8hqTwAiaj6fmCcKSQeBPlIpW28w==\n \n \"@typescript-eslint/typescript-estree@5.43.0\":\n   version \"5.43.0\"\n@@ -3335,13 +3334,13 @@\n     semver \"^7.3.7\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/typescript-estree@5.45.1\":\n-  version \"5.45.1\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/typescript-estree/-/typescript-estree-5.45.1.tgz#b3dc37f0c4f0fe73e09917fc735e6f96eabf9ba4\"\n-  integrity sha512-76NZpmpCzWVrrb0XmYEpbwOz/FENBi+5W7ipVXAsG3OoFrQKJMiaqsBMbvGRyLtPotGqUfcY7Ur8j0dksDJDng==\n+\"@typescript-eslint/typescript-estree@5.46.1\":\n+  version \"5.46.1\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/typescript-estree/-/typescript-estree-5.46.1.tgz#5358088f98a8f9939355e0996f9c8f41c25eced2\"\n+  integrity sha512-j9W4t67QiNp90kh5Nbr1w92wzt+toiIsaVPnEblB2Ih2U9fqBTyqV9T3pYWZBRt6QoMh/zVWP59EpuCjc4VRBg==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.45.1\"\n-    \"@typescript-eslint/visitor-keys\" \"5.45.1\"\n+    \"@typescript-eslint/types\" \"5.46.1\"\n+    \"@typescript-eslint/visitor-keys\" \"5.46.1\"\n     debug \"^4.3.4\"\n     globby \"^11.1.0\"\n     is-glob \"^4.0.3\"\n@@ -3362,16 +3361,16 @@\n     eslint-utils \"^3.0.0\"\n     semver \"^7.3.7\"\n \n-\"@typescript-eslint/utils@5.45.1\":\n-  version \"5.45.1\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/utils/-/utils-5.45.1.tgz#39610c98bde82c4792f2a858b29b7d0053448be2\"\n-  integrity sha512-rlbC5VZz68+yjAzQBc4I7KDYVzWG2X/OrqoZrMahYq3u8FFtmQYc+9rovo/7wlJH5kugJ+jQXV5pJMnofGmPRw==\n+\"@typescript-eslint/utils@5.46.1\":\n+  version \"5.46.1\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/utils/-/utils-5.46.1.tgz#7da3c934d9fd0eb4002a6bb3429f33298b469b4a\"\n+  integrity sha512-RBdBAGv3oEpFojaCYT4Ghn4775pdjvwfDOfQ2P6qzNVgQOVrnSPe5/Pb88kv7xzYQjoio0eKHKB9GJ16ieSxvA==\n   dependencies:\n     \"@types/json-schema\" \"^7.0.9\"\n     \"@types/semver\" \"^7.3.12\"\n-    \"@typescript-eslint/scope-manager\" \"5.45.1\"\n-    \"@typescript-eslint/types\" \"5.45.1\"\n-    \"@typescript-eslint/typescript-estree\" \"5.45.1\"\n+    \"@typescript-eslint/scope-manager\" \"5.46.1\"\n+    \"@typescript-eslint/types\" \"5.46.1\"\n+    \"@typescript-eslint/typescript-estree\" \"5.46.1\"\n     eslint-scope \"^5.1.1\"\n     eslint-utils \"^3.0.0\"\n     semver \"^7.3.7\"\n@@ -3384,12 +3383,12 @@\n     \"@typescript-eslint/types\" \"5.43.0\"\n     eslint-visitor-keys \"^3.3.0\"\n \n-\"@typescript-eslint/visitor-keys@5.45.1\":\n-  version \"5.45.1\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/visitor-keys/-/visitor-keys-5.45.1.tgz#204428430ad6a830d24c5ac87c71366a1cfe1948\"\n-  integrity sha512-cy9ln+6rmthYWjH9fmx+5FU/JDpjQb586++x2FZlveq7GdGuLLW9a2Jcst2TGekH82bXpfmRNSwP9tyEs6RjvQ==\n+\"@typescript-eslint/visitor-keys@5.46.1\":\n+  version \"5.46.1\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/visitor-keys/-/visitor-keys-5.46.1.tgz#126cc6fe3c0f83608b2b125c5d9daced61394242\"\n+  integrity sha512-jczZ9noovXwy59KjRTk1OftT78pwygdcmCuBf8yMoWt/8O8l+6x2LSEze0E4TeepXK4MezW3zGSyoDRZK7Y9cg==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.45.1\"\n+    \"@typescript-eslint/types\" \"5.46.1\"\n     eslint-visitor-keys \"^3.3.0\"\n \n \"@webassemblyjs/ast@1.11.1\":\n\n\n###\n\n", "completion": "build: update eslint dependencies to v5.46.1 (#<issue-num>)"}
{"prompt": " file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/devtools-tabs.component.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/devtools-tabs.component.ts\n\n@@ -8,8 +8,8 @@\n \n /// <reference types=\"resize-observer-browser\" />\n import {AfterViewInit, Component, Input, OnDestroy, OnInit, ViewChild} from '@angular/core';\n-import {MatSlideToggleChange} from '@angular/material/slide-toggle';\n-import {MatTabNav} from '@angular/material/tabs';\n+import {MatLegacySlideToggleChange as MatSlideToggleChange} from '@angular/material/legacy-slide-toggle';\n+import {MatLegacyTabNav as MatTabNav} from '@angular/material/legacy-tabs';\n import {Events, MessageBus, Route} from 'protocol';\n import {Subscription} from 'rxjs';\n \n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/devtools-tabs.module.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/devtools-tabs.module.ts\n\n@@ -8,12 +8,12 @@\n \n import {CommonModule} from '@angular/common';\n import {NgModule} from '@angular/core';\n-import {MatButtonModule} from '@angular/material/button';\n import {MatIconModule} from '@angular/material/icon';\n-import {MatMenuModule} from '@angular/material/menu';\n-import {MatSlideToggleModule} from '@angular/material/slide-toggle';\n-import {MatTabsModule} from '@angular/material/tabs';\n-import {MatTooltipModule} from '@angular/material/tooltip';\n+import {MatLegacyButtonModule as MatButtonModule} from '@angular/material/legacy-button';\n+import {MatLegacyMenuModule as MatMenuModule} from '@angular/material/legacy-menu';\n+import {MatLegacySlideToggleModule as MatSlideToggleModule} from '@angular/material/legacy-slide-toggle';\n+import {MatLegacyTabsModule as MatTabsModule} from '@angular/material/legacy-tabs';\n+import {MatLegacyTooltipModule as MatTooltipModule} from '@angular/material/legacy-tooltip';\n \n import {DevToolsTabsComponent} from './devtools-tabs.component';\n import {DirectiveExplorerModule} from './directive-explorer/directive-explorer.module';\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-explorer.module.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-explorer.module.ts\n\n@@ -9,11 +9,11 @@\n import {ScrollingModule} from '@angular/cdk/scrolling';\n import {CommonModule} from '@angular/common';\n import {NgModule} from '@angular/core';\n-import {MatButtonModule} from '@angular/material/button';\n-import {MatCardModule} from '@angular/material/card';\n import {MatIconModule} from '@angular/material/icon';\n-import {MatSnackBarModule} from '@angular/material/snack-bar';\n-import {MatTooltipModule} from '@angular/material/tooltip';\n+import {MatLegacyButtonModule as MatButtonModule} from '@angular/material/legacy-button';\n+import {MatLegacyCardModule as MatCardModule} from '@angular/material/legacy-card';\n+import {MatLegacySnackBarModule as MatSnackBarModule} from '@angular/material/legacy-snack-bar';\n+import {MatLegacyTooltipModule as MatTooltipModule} from '@angular/material/legacy-tooltip';\n import {MatTreeModule} from '@angular/material/tree';\n \n import {AngularSplitModule} from '../../vendor/angular-split/public_api';\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-forest/breadcrumbs/breadcrumbs.module.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-forest/breadcrumbs/breadcrumbs.module.ts\n\n@@ -8,9 +8,9 @@\n \n import {CommonModule} from '@angular/common';\n import {NgModule} from '@angular/core';\n-import {MatButtonModule} from '@angular/material/button';\n-import {MatCardModule} from '@angular/material/card';\n import {MatIconModule} from '@angular/material/icon';\n+import {MatLegacyButtonModule as MatButtonModule} from '@angular/material/legacy-button';\n+import {MatLegacyCardModule as MatCardModule} from '@angular/material/legacy-card';\n \n import {BreadcrumbsComponent} from './breadcrumbs.component';\n \n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-forest/directive-forest.module.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-forest/directive-forest.module.ts\n\n@@ -9,9 +9,9 @@\n import {ScrollingModule} from '@angular/cdk/scrolling';\n import {CommonModule} from '@angular/common';\n import {NgModule} from '@angular/core';\n-import {MatButtonModule} from '@angular/material/button';\n-import {MatCardModule} from '@angular/material/card';\n import {MatIconModule} from '@angular/material/icon';\n+import {MatLegacyButtonModule as MatButtonModule} from '@angular/material/legacy-button';\n+import {MatLegacyCardModule as MatCardModule} from '@angular/material/legacy-card';\n \n import {BreadcrumbsModule} from './breadcrumbs/breadcrumbs.module';\n import {DirectiveForestComponent} from './directive-forest.component';\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-forest/filter/filter.module.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-forest/filter/filter.module.ts\n\n@@ -8,9 +8,9 @@\n \n import {CommonModule} from '@angular/common';\n import {NgModule} from '@angular/core';\n-import {MatButtonModule} from '@angular/material/button';\n-import {MatCardModule} from '@angular/material/card';\n import {MatIconModule} from '@angular/material/icon';\n+import {MatLegacyButtonModule as MatButtonModule} from '@angular/material/legacy-button';\n+import {MatLegacyCardModule as MatCardModule} from '@angular/material/legacy-card';\n \n import {FilterComponent} from './filter.component';\n \n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-tab.module.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-tab.module.ts\n\n@@ -8,10 +8,10 @@\n \n import {CommonModule} from '@angular/common';\n import {NgModule} from '@angular/core';\n-import {MatButtonModule} from '@angular/material/button';\n import {MatExpansionModule} from '@angular/material/expansion';\n import {MatIconModule} from '@angular/material/icon';\n-import {MatTooltipModule} from '@angular/material/tooltip';\n+import {MatLegacyButtonModule as MatButtonModule} from '@angular/material/legacy-button';\n+import {MatLegacyTooltipModule as MatTooltipModule} from '@angular/material/legacy-tooltip';\n \n import {ComponentMetadataComponent} from './component-metadata.component';\n import {PropertyTabHeaderComponent} from './property-tab-header.component';\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-view.module.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-view.module.ts\n\n@@ -10,11 +10,11 @@ import {DragDropModule} from '@angular/cdk/drag-drop';\n import {CommonModule} from '@angular/common';\n import {NgModule} from '@angular/core';\n import {FormsModule} from '@angular/forms';\n-import {MatButtonModule} from '@angular/material/button';\n import {MatExpansionModule} from '@angular/material/expansion';\n import {MatIconModule} from '@angular/material/icon';\n+import {MatLegacyButtonModule as MatButtonModule} from '@angular/material/legacy-button';\n+import {MatLegacyTooltipModule as MatTooltipModule} from '@angular/material/legacy-tooltip';\n import {MatToolbarModule} from '@angular/material/toolbar';\n-import {MatTooltipModule} from '@angular/material/tooltip';\n import {MatTreeModule} from '@angular/material/tree';\n \n import {PropertyEditorComponent} from './property-editor.component';\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/profiler/profiler-import-dialog.component.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/profiler/profiler-import-dialog.component.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {Component, Inject} from '@angular/core';\n-import {MAT_DIALOG_DATA, MatDialogRef} from '@angular/material/dialog';\n+import {MAT_LEGACY_DIALOG_DATA as MAT_DIALOG_DATA, MatLegacyDialogRef as MatDialogRef} from '@angular/material/legacy-dialog';\n \n interface DialogData {\n   profilerVersion?: number;\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/profiler/profiler.component.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/profiler/profiler.component.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {Component, OnDestroy, OnInit} from '@angular/core';\n-import {MatDialog} from '@angular/material/dialog';\n+import {MatLegacyDialog as MatDialog} from '@angular/material/legacy-dialog';\n import {Events, MessageBus, ProfilerFrame} from 'protocol';\n import {Subject, Subscription} from 'rxjs';\n \n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/profiler/profiler.module.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/profiler/profiler.module.ts\n\n@@ -9,12 +9,12 @@\n import {CommonModule} from '@angular/common';\n import {NgModule} from '@angular/core';\n import {FormsModule} from '@angular/forms';\n-import {MatButtonModule} from '@angular/material/button';\n-import {MatCardModule} from '@angular/material/card';\n-import {MatDialogModule} from '@angular/material/dialog';\n import {MatIconModule} from '@angular/material/icon';\n-import {MatSelectModule} from '@angular/material/select';\n-import {MatTooltipModule} from '@angular/material/tooltip';\n+import {MatLegacyButtonModule as MatButtonModule} from '@angular/material/legacy-button';\n+import {MatLegacyCardModule as MatCardModule} from '@angular/material/legacy-card';\n+import {MatLegacyDialogModule as MatDialogModule} from '@angular/material/legacy-dialog';\n+import {MatLegacySelectModule as MatSelectModule} from '@angular/material/legacy-select';\n+import {MatLegacyTooltipModule as MatTooltipModule} from '@angular/material/legacy-tooltip';\n \n import {ProfilerImportDialogComponent} from './profiler-import-dialog.component';\n import {ProfilerComponent} from './profiler.component';\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/profiler/timeline/recording-visualizer/recording-visualizer.module.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/profiler/timeline/recording-visualizer/recording-visualizer.module.ts\n\n@@ -8,9 +8,9 @@\n \n import {CommonModule} from '@angular/common';\n import {NgModule} from '@angular/core';\n-import {MatCardModule} from '@angular/material/card';\n+import {MatLegacyCardModule as MatCardModule} from '@angular/material/legacy-card';\n+import {MatLegacyTooltipModule as MatTooltipModule} from '@angular/material/legacy-tooltip';\n import {MatToolbarModule} from '@angular/material/toolbar';\n-import {MatTooltipModule} from '@angular/material/tooltip';\n import {NgxFlamegraphModule} from 'ngx-flamegraph';\n \n import {AngularSplitModule} from '../../../../vendor/angular-split/public_api';\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/profiler/timeline/timeline.module.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/profiler/timeline/timeline.module.ts\n\n@@ -10,15 +10,15 @@ import {ScrollingModule} from '@angular/cdk/scrolling';\n import {CommonModule} from '@angular/common';\n import {NgModule} from '@angular/core';\n import {FormsModule} from '@angular/forms';\n-import {MatButtonModule} from '@angular/material/button';\n-import {MatCardModule} from '@angular/material/card';\n-import {MatCheckboxModule} from '@angular/material/checkbox';\n-import {MatDialogModule} from '@angular/material/dialog';\n import {MatIconModule} from '@angular/material/icon';\n-import {MatInputModule} from '@angular/material/input';\n-import {MatProgressBarModule} from '@angular/material/progress-bar';\n-import {MatSelectModule} from '@angular/material/select';\n-import {MatTooltipModule} from '@angular/material/tooltip';\n+import {MatLegacyButtonModule as MatButtonModule} from '@angular/material/legacy-button';\n+import {MatLegacyCardModule as MatCardModule} from '@angular/material/legacy-card';\n+import {MatLegacyCheckboxModule as MatCheckboxModule} from '@angular/material/legacy-checkbox';\n+import {MatLegacyDialogModule as MatDialogModule} from '@angular/material/legacy-dialog';\n+import {MatLegacyInputModule as MatInputModule} from '@angular/material/legacy-input';\n+import {MatLegacyProgressBarModule as MatProgressBarModule} from '@angular/material/legacy-progress-bar';\n+import {MatLegacySelectModule as MatSelectModule} from '@angular/material/legacy-select';\n+import {MatLegacyTooltipModule as MatTooltipModule} from '@angular/material/legacy-tooltip';\n import {NgxFlamegraphModule} from 'ngx-flamegraph';\n \n import {FrameSelectorComponent} from './frame-selector.component';\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/router-tree/router-tree.module.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/router-tree/router-tree.module.ts\n\n@@ -8,7 +8,7 @@\n \n import {CommonModule} from '@angular/common';\n import {NgModule} from '@angular/core';\n-import {MatDialogModule} from '@angular/material/dialog';\n+import {MatLegacyDialogModule as MatDialogModule} from '@angular/material/legacy-dialog';\n import {MatSelectModule} from '@angular/material/select';\n \n import {RouterTreeComponent} from './router-tree.component';\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools.module.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools.module.ts\n\n@@ -8,8 +8,8 @@\n \n import {CommonModule} from '@angular/common';\n import {NgModule} from '@angular/core';\n-import {MatProgressSpinnerModule} from '@angular/material/progress-spinner';\n-import {MatTooltipModule} from '@angular/material/tooltip';\n+import {MatLegacyProgressSpinnerModule as MatProgressSpinnerModule} from '@angular/material/legacy-progress-spinner';\n+import {MatLegacyTooltipModule as MatTooltipModule} from '@angular/material/legacy-tooltip';\n \n import {DevToolsTabModule} from './devtools-tabs/devtools-tabs.module';\n import {DevToolsComponent} from './devtools.component';\n\n---\n file path A: devtools/src/app/demo-app/todo/app-todo.component.ts | file path B: devtools/src/app/demo-app/todo/app-todo.component.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {Component} from '@angular/core';\n-import {MatDialog} from '@angular/material/dialog';\n+import {MatLegacyDialog as MatDialog} from '@angular/material/legacy-dialog';\n \n import {DialogComponent} from './dialog.component';\n \n\n---\n file path A: devtools/src/app/demo-app/todo/app.module.ts | file path B: devtools/src/app/demo-app/todo/app.module.ts\n\n@@ -9,9 +9,9 @@\n import {CommonModule} from '@angular/common';\n import {NgModule} from '@angular/core';\n import {FormsModule} from '@angular/forms';\n-import {MatDialogModule} from '@angular/material/dialog';\n-import {MatFormFieldModule} from '@angular/material/form-field';\n-import {MatInputModule} from '@angular/material/input';\n+import {MatLegacyDialogModule as MatDialogModule} from '@angular/material/legacy-dialog';\n+import {MatLegacyFormFieldModule as MatFormFieldModule} from '@angular/material/legacy-form-field';\n+import {MatLegacyInputModule as MatInputModule} from '@angular/material/legacy-input';\n import {RouterModule} from '@angular/router';\n \n import {AppTodoComponent} from './app-todo.component';\n\n---\n file path A: devtools/src/app/demo-app/todo/dialog.component.ts | file path B: devtools/src/app/demo-app/todo/dialog.component.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {Component, Inject} from '@angular/core';\n-import {MAT_DIALOG_DATA, MatDialogRef} from '@angular/material/dialog';\n+import {MAT_LEGACY_DIALOG_DATA as MAT_DIALOG_DATA, MatLegacyDialogRef as MatDialogRef} from '@angular/material/legacy-dialog';\n \n export interface DialogData {\n   animal: string;\n\n---\n file path A: devtools/src/styles.scss | file path B: devtools/src/styles.scss\n\n@@ -1,6 +1,7 @@\n @use 'sass:map';\n @use 'external/npm/node_modules/@angular/material/index' as mat;\n-@include mat.core();\n+@include mat.all-legacy-component-typographies();\n+@include mat.legacy-core();\n \n html,\n body {\n@@ -39,9 +40,9 @@ $dark-theme: map.deep-merge(\n );\n \n .light-theme {\n-  @include mat.all-component-themes($light-theme);\n+  @include mat.all-legacy-component-themes($light-theme);\n }\n \n .dark-theme {\n-  @include mat.all-component-themes($dark-theme);\n+  @include mat.all-legacy-component-themes($dark-theme);\n }\n\n\n###\n\n", "completion": "fix(devtools): Replace material imports and styles (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/router/src/app/compose-message/compose-message.component.ts | file path B: aio/content/examples/router/src/app/compose-message/compose-message.component.ts\n\n@@ -1,5 +1,5 @@\n // #docregion\n-import { Component, HostBinding } from '@angular/core';\n+import { Component } from '@angular/core';\n import { Router } from '@angular/router';\n \n @Component({\n\n---\n file path A: aio/content/examples/router/src/app/crisis-center/crisis-center/crisis-center.component.ts | file path B: aio/content/examples/router/src/app/crisis-center/crisis-center/crisis-center.component.ts\n\n@@ -6,4 +6,4 @@ import { Component } from '@angular/core';\n   templateUrl: './crisis-center.component.html',\n   styleUrls: ['./crisis-center.component.css']\n })\n-export class CrisisCenterComponent { }\n+export class CrisisCenterComponent {}\n\n---\n file path A: aio/content/examples/router/src/app/heroes/hero-list/hero-list.component.1.ts | file path B: aio/content/examples/router/src/app/heroes/hero-list/hero-list.component.1.ts\n\n@@ -1,6 +1,5 @@\n // TODO: Feature Componetized like HeroCenter\n import { Component, OnInit } from '@angular/core';\n-import { Router } from '@angular/router';\n import { Observable } from 'rxjs';\n \n import { HeroService } from '../hero.service';\n@@ -15,7 +14,6 @@ export class HeroListComponent implements OnInit {\n   heroes$!: Observable<Hero[]>;\n \n   constructor(\n-    private router: Router,\n     private service: HeroService\n   ) {}\n \n\n---\n file path A: aio/content/examples/router/src/app/page-not-found/page-not-found.component.ts | file path B: aio/content/examples/router/src/app/page-not-found/page-not-found.component.ts\n\n@@ -1,15 +1,9 @@\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n \n @Component({\n   selector: 'app-page-not-found',\n   templateUrl: './page-not-found.component.html',\n   styleUrls: ['./page-not-found.component.css']\n })\n-export class PageNotFoundComponent implements OnInit {\n+export class PageNotFoundComponent {}\n \n-  constructor() { }\n-\n-  ngOnInit() {\n-  }\n-\n-}\n\n\n###\n\n", "completion": "docs: updated docs removed unnecessary imports and empty methods (#<issue-num>)"}
{"prompt": " file path A: aio/content/images/bios/korneeva.jpg | file path B: aio/content/images/bios/korneeva.jpg\n\nBinary files /dev/null and b/aio/content/images/bios/korneeva.jpg differ\n\n---\n file path A: aio/content/marketing/contributors.json | file path B: aio/content/marketing/contributors.json\n\n@@ -670,6 +670,14 @@\n     \"mentor\": \"mgechev\",\n     \"groups\": [\"GDE\", \"Collaborators\"]\n   },\n+  \"mariakorneeva\": {\n+    \"name\": \"Maria Korneeva\",\n+    \"picture\": \"korneeva.jpg\",\n+    \"twitter\": \"BrowserPerson\",\n+    \"website\": \"https://www.linkedin.com/in/maria-korneeva/\",\n+    \"bio\": \"Maria is a trainer and consultant with focus on Angular. She writes for ng-conf and speaks at tech meetups and conferences. In her tweets and articles Maria likes to share her learnings from everyday coding. Fun fact: she illustrates her stories herself because she likes drawing.\",\n+    \"groups\": [\"GDE\"]\n+  },\n   \"markostanimirovic\": {\n     \"name\": \"Marko Stanimirovi\u0107\",\n     \"picture\": \"marko.jpg\",\n\n\n###\n\n", "completion": "docs: add maria korneeva to GDE resources (#<issue-num>)"}
{"prompt": " file path A: aio/content/marketing/events.json | file path B: aio/content/marketing/events.json\n\n@@ -1094,6 +1094,12 @@\n     \"linkUrl\": \"https://portotechhub.com/conference-2022\",\n     \"name\": \"Porto Tech Hub\"\n   },\n+  {\n+    \"date\": {\n+      \"start\": \"2022-11-07\"\n+    },\n+    \"name\": \"Jamstack Conf\"\n+  },\n   {\n     \"date\": {\n       \"start\": \"2022-11-10\"\n\n\n###\n\n", "completion": "docs: update events (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -750,6 +750,9 @@ export interface RouterFeature<FeatureKind extends RouterFeatureKind> {\n // @public\n export type RouterFeatures = PreloadingFeature | DebugTracingFeature | InitialNavigationFeature | InMemoryScrollingFeature | RouterConfigurationFeature;\n \n+// @public\n+export type RouterHashLocationFeature = RouterFeature<RouterFeatureKind.RouterHashLocationFeature>;\n+\n // @public\n class RouterLink implements OnChanges, OnDestroy {\n     constructor(router: Router, route: ActivatedRoute, tabIndexAttribute: string | null | undefined, renderer: Renderer2, el: ElementRef, locationStrategy?: LocationStrategy | undefined);\n@@ -1068,6 +1071,9 @@ export function withDisabledInitialNavigation(): DisabledInitialNavigationFeatur\n // @public\n export function withEnabledBlockingInitialNavigation(): EnabledBlockingInitialNavigationFeature;\n \n+// @public\n+export function withHashLocation(): RouterConfigurationFeature;\n+\n // @public\n export function withInMemoryScrolling(options?: InMemoryScrollingOptions): InMemoryScrollingFeature;\n \n\n---\n file path A: packages/router/src/index.ts | file path B: packages/router/src/index.ts\n\n@@ -15,7 +15,7 @@ export {ActivationEnd, ActivationStart, ChildActivationEnd, ChildActivationStart\n export {CanActivate, CanActivateChild, CanActivateChildFn, CanActivateFn, CanDeactivate, CanDeactivateFn, CanLoad, CanLoadFn, CanMatch, CanMatchFn, Data, DefaultExport, LoadChildren, LoadChildrenCallback, NavigationBehaviorOptions, OnSameUrlNavigation, QueryParamsHandling, Resolve, ResolveData, ResolveFn, Route, Routes, RunGuardsAndResolvers, UrlMatcher, UrlMatchResult} from './models';\n export {Navigation, NavigationExtras, UrlCreationOptions} from './navigation_transition';\n export {DefaultTitleStrategy, TitleStrategy} from './page_title_strategy';\n-export {DebugTracingFeature, DisabledInitialNavigationFeature, EnabledBlockingInitialNavigationFeature, InitialNavigationFeature, InMemoryScrollingFeature, PreloadingFeature, provideRouter, provideRoutes, RouterConfigurationFeature, RouterFeature, RouterFeatures, withDebugTracing, withDisabledInitialNavigation, withEnabledBlockingInitialNavigation, withInMemoryScrolling, withPreloading, withRouterConfig} from './provide_router';\n+export {DebugTracingFeature, DisabledInitialNavigationFeature, EnabledBlockingInitialNavigationFeature, InitialNavigationFeature, InMemoryScrollingFeature, PreloadingFeature, provideRouter, provideRoutes, RouterConfigurationFeature, RouterFeature, RouterFeatures, RouterHashLocationFeature, withDebugTracing, withDisabledInitialNavigation, withEnabledBlockingInitialNavigation, withHashLocation, withInMemoryScrolling, withPreloading, withRouterConfig} from './provide_router';\n export {BaseRouteReuseStrategy, DetachedRouteHandle, RouteReuseStrategy} from './route_reuse_strategy';\n export {Router} from './router';\n export {ExtraOptions, InitialNavigation, InMemoryScrollingOptions, ROUTER_CONFIGURATION, RouterConfigOptions} from './router_config';\n\n---\n file path A: packages/router/src/provide_router.ts | file path B: packages/router/src/provide_router.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {LOCATION_INITIALIZED, ViewportScroller} from '@angular/common';\n+import {HashLocationStrategy, LOCATION_INITIALIZED, LocationStrategy, ViewportScroller} from '@angular/common';\n import {APP_BOOTSTRAP_LISTENER, APP_INITIALIZER, ApplicationRef, ComponentRef, ENVIRONMENT_INITIALIZER, EnvironmentProviders, inject, InjectFlags, InjectionToken, Injector, makeEnvironmentProviders, NgZone, Provider, Type} from '@angular/core';\n import {of, Subject} from 'rxjs';\n import {filter, map, take} from 'rxjs/operators';\n@@ -580,6 +580,47 @@ export function withRouterConfig(options: RouterConfigOptions): RouterConfigurat\n   return routerFeature(RouterFeatureKind.RouterConfigurationFeature, providers);\n }\n \n+/**\n+ * A type alias for providers returned by `withHashLocation` for use with `provideRouter`.\n+ *\n+ * @see `withHashLocation`\n+ * @see `provideRouter`\n+ *\n+ * @publicApi\n+ */\n+export type RouterHashLocationFeature = RouterFeature<RouterFeatureKind.RouterHashLocationFeature>;\n+\n+/**\n+ * Provides the location strategy that uses the URL fragment instead of the history API.\n+ *\n+ * @usageNotes\n+ *\n+ * Basic example of how you can use the hash location option:\n+ * ```\n+ * const appRoutes: Routes = [];\n+ * bootstrapApplication(AppComponent,\n+ *   {\n+ *     providers: [\n+ *       provideRouter(appRoutes, withHashLocation()\n+ *     ]\n+ *   }\n+ * );\n+ * ```\n+ *\n+ * @see `provideRouter`\n+ * @see `HashLocationStrategy`\n+ *\n+ * @returns A set of providers for use with `provideRouter`.\n+ *\n+ * @publicApi\n+ */\n+export function withHashLocation(): RouterConfigurationFeature {\n+  const providers = [\n+    {provide: LocationStrategy, useClass: HashLocationStrategy},\n+  ];\n+  return routerFeature(RouterFeatureKind.RouterConfigurationFeature, providers);\n+}\n+\n /**\n  * A type alias that represents all Router features available for use with `provideRouter`.\n  * Features can be enabled by adding special functions to the `provideRouter` call.\n@@ -602,5 +643,6 @@ export const enum RouterFeatureKind {\n   EnabledBlockingInitialNavigationFeature,\n   DisabledInitialNavigationFeature,\n   InMemoryScrollingFeature,\n-  RouterConfigurationFeature\n+  RouterConfigurationFeature,\n+  RouterHashLocationFeature\n }\n\n\n###\n\n", "completion": "feat(router): Add feature provider for enabling hash navigation (#<issue-num>)"}
{"prompt": " file path A: aio/content/marketing/resources.json | file path B: aio/content/marketing/resources.json\n\n@@ -287,6 +287,12 @@\n             \"title\": \"Compodoc\",\n             \"url\": \"https://github.com/compodoc/compodoc\"\n           },\n+          \"docgeni\": {\n+            \"desc\": \"A modern, powerful and out of the box documentation generator for Angular component lib and markdown docs.\",\n+            \"logo\": \"\",\n+            \"title\": \"Docgeni\",\n+            \"url\": \"https://github.com/docgeni/docgeni\"\n+          },\n           \"angular-playground\": {\n             \"desc\": \"UI development environment for building, testing, and documenting Angular applications.\",\n             \"title\": \"Angular Playground\",\n\n\n###\n\n", "completion": "docs: add docgeni to tooling of resources list (#<issue-num>)"}
{"prompt": " file path A: packages/animations/browser/src/dsl/animation_transition_factory.ts | file path B: packages/animations/browser/src/dsl/animation_transition_factory.ts\n\n@@ -191,7 +191,7 @@ export class AnimationStateStyles {\n           }\n           const normalizedProp = this.normalizer.normalizePropertyName(prop, errors);\n           val = this.normalizer.normalizeStyleValue(prop, normalizedProp, val, errors);\n-          finalStyles.set(normalizedProp, val);\n+          finalStyles.set(prop, val);\n         });\n       }\n     });\n\n---\n file path A: packages/core/test/animation/animations_with_web_animations_integration_spec.ts | file path B: packages/core/test/animation/animations_with_web_animations_integration_spec.ts\n\n@@ -567,6 +567,74 @@ describe('animation integration tests using web animations', function() {\n     expect(elm.style.getPropertyValue('width')).toEqual('300px');\n     expect(elm.style.getPropertyValue('font-size')).toEqual('14px');\n   });\n+\n+  it('should apply correct state transitions for both CamelCase and kebab-case CSS properties',\n+     () => {\n+       @Component({\n+         selector: 'ani-cmp',\n+         template: `\n+          <div id=\"camelCaseDiv\" [@camelCaseTrigger]=\"status\"></div>\n+          <div id=\"kebab-case-div\" [@kebab-case-trigger]=\"status\"></div>\n+        `,\n+         animations: [\n+           trigger(\n+               'camelCaseTrigger',\n+               [\n+                 state('active', style({\n+                         'backgroundColor': 'green',\n+                       })),\n+                 transition(\n+                     'inactive => active',\n+                     [\n+                       style({\n+                         'backgroundColor': 'red',\n+                       }),\n+                       animate(500),\n+                     ]),\n+               ]),\n+           trigger(\n+               'kebab-case-trigger',\n+               [\n+                 state('active', style({\n+                         'background-color': 'green',\n+                       })),\n+                 transition(\n+                     'inactive => active',\n+                     [\n+                       style({\n+                         'background-color': 'red',\n+                       }),\n+                       animate(500),\n+                     ]),\n+               ]),\n+         ]\n+       })\n+       class Cmp {\n+         public status: 'active'|'inactive' = 'inactive';\n+       }\n+\n+       TestBed.configureTestingModule({declarations: [Cmp]});\n+\n+       const engine = TestBed.inject(\u0275AnimationEngine);\n+       const fixture = TestBed.createComponent(Cmp);\n+       const cmp = fixture.componentInstance;\n+       fixture.detectChanges();\n+\n+       cmp.status = 'active';\n+       fixture.detectChanges();\n+       engine.flush();\n+\n+       expect(engine.players.length).toEqual(2);\n+       const [camelCaseWebPlayer, kebabCaseWebPlayer] = engine.players.map(\n+           player => (player as TransitionAnimationPlayer).getRealPlayer() as \u0275WebAnimationsPlayer);\n+\n+       [camelCaseWebPlayer, kebabCaseWebPlayer].forEach(webPlayer => {\n+         expect(webPlayer.keyframes).toEqual([\n+           new Map<string, string|number>([['backgroundColor', 'red'], ['offset', 0]]),\n+           new Map<string, string|number>([['backgroundColor', 'green'], ['offset', 1]])\n+         ]);\n+       });\n+     });\n });\n })();\n \n\n\n###\n\n", "completion": "fix(animations): fix incorrect handling of camel-case css properties (#<issue-num>)"}
{"prompt": " file path A: aio/content/marketing/events.json | file path B: aio/content/marketing/events.json\n\n@@ -1059,6 +1059,13 @@\n     \"linkUrl\": \"https://2022.angularday.it/\",\n     \"name\": \"angularday\"\n   },\n+  {\n+    \"date\": {\n+      \"start\": \"2022-10-18\"\n+    },\n+    \"linkUrl\": \"https://firebase.google.com/summit\",\n+    \"name\": \"Firebase Summit 22\"\n+  },\n   {\n     \"date\": {\n       \"start\": \"2022-10-18\"\n@@ -1093,6 +1100,20 @@\n     },\n     \"name\": \"JavaScript Day (JetBrains)\"\n   },\n+  {\n+    \"date\": {\n+      \"start\": \"2022-11-16\"\n+    },\n+    \"linkUrl\": \"https://www.meetup.com/angular-london/\",\n+    \"name\": \"Angular London\"\n+  },\n+  {\n+    \"date\": {\n+      \"start\": \"2022-11-17\"\n+    },\n+    \"linkUrl\": \"https://www.modernfrontends.live/\",\n+    \"name\": \"Modern Frontends Live!\"\n+  },\n   {\n     \"date\": {\n       \"start\": \"2022-12-02\"\n\n\n###\n\n", "completion": "docs: update events (#<issue-num>)"}
{"prompt": " file path A: aio/content/images/bios/yannickbaron.jpg | file path B: aio/content/images/bios/yannickbaron.jpg\n\nBinary files /dev/null and b/aio/content/images/bios/yannickbaron.jpg differ\n\n---\n file path A: aio/content/marketing/contributors.json | file path B: aio/content/marketing/contributors.json\n\n@@ -1071,6 +1071,14 @@\n     \"bio\": \"GDE (Google Developer Expert) Angular and Web Technologies, GDG Salvador organizer, passionate about technology and active in communities with a focus on web development, including Angular, JavaScript, HTML5, CSS3, Workflow, web performance, security and Internet of things. Participates in events organization, speaker at conferences in Brazil and other countries and contributes to several open source projects.\",\n     \"groups\": [\"GDE\"]\n   },\n+  \"yannickbaron\": {\n+    \"name\": \"Yannick Baron\",\n+    \"picture\": \"yannickbaron.jpg\",\n+    \"twitter\": \"yannick_baron\",\n+    \"website\": \"https://thinktecture.com\",\n+    \"bio\": \"Yannick is an Angular GDE (Google Developer Expert) and a consultant at Thinktecture in Germany. He has a passion for RxJS and reactive programming, and loves to help others improve their understanding of development with TypeScript and Angular. In his spare time, Yannick enjoys staying up-to-date with the latest trends and techniques in the world of web development. In addition to his work as a consultant, Yannick is also an active blogger and frequently speaks at conferences and meetups about topics related to Angular, RxJS, and reactive state management.\",\n+    \"groups\": [\"GDE\"]\n+  },\n   \"yharaskrik\": {\n     \"name\": \"Jay Bell\",\n     \"picture\": \"jaybell.jpg\",\n\n\n###\n\n", "completion": "docs: add yannick baron to list of aio GDEs (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/directive-composition-api.md | file path B: aio/content/guide/directive-composition-api.md\n\n@@ -4,7 +4,7 @@ Angular directives offer a great way to encapsulate reusable behaviors\u2014 direct\n attributes, CSS classes, and event listeners to an element.\n \n The *directive composition API* lets you apply directives to a component's host element from\n-_within_ the component.\n+_within_ the component TypeScript class.\n \n ## Adding directives to a component\n \n@@ -217,3 +217,5 @@ component and one for each host directive. For a few checkboxes on a page, this\n significant issues. However, if your page renders _hundreds_ of checkboxes, such as in a table, then\n you could start to see an impact of the additional object allocations. Always be sure to profile\n your application to determine the right composition pattern for your use case.\n+\n+@reviewed 2022-12-11\n\n\n###\n\n", "completion": "docs: modify directive composition API guide (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/updating-search-keywords.md | file path B: aio/content/guide/updating-search-keywords.md\n\n@@ -26,7 +26,7 @@ Perform these steps in a browser.\n     </code-example>\n \n 1.  [Update or add the `@reviewed` entry](guide/reviewing-content#update-the-last-reviewed-date) at the end of the topic's source code.\n-1.  Propose your changes from as described in [make a minor change](guide/contributors-guide-overview#to-make-a-minor-change-to-a-documentation-topic).\n+1.  Propose your changes as described in [make a minor change](guide/contributors-guide-overview#to-make-a-minor-change-to-a-documentation-topic).\n \n <!-- links -->\n \n@@ -34,4 +34,4 @@ Perform these steps in a browser.\n \n <!-- end links -->\n \n-@reviewed 2022-10-12\n+@reviewed 2022-12-11\n\n\n###\n\n", "completion": "docs: fix typo in search keywords guide (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/reviewing-content.md | file path B: aio/content/guide/reviewing-content.md\n\n@@ -111,7 +111,7 @@ If the topic has minor errors, you can fix them when you [make a minor change](/\n \n If the topic requires major changes, you can [make a major change](guide/contributors-guide-overview#make-a-major-change), or [open a docs issue in GitHub](https://github.com/angular/angular/issues/new?assignees=&labels=&template=3-docs-bug.yaml). You shouldn't make major changes in the GitHub user interface because it doesn't allow you to test them before you submit them.\n \n-Whether you make the changes the topic needs or open a docs issue, you should still [update the **Last reviewed** date](#update-the-last-reviewed-date). You can use the GitHub user interface in the browse if you only want to update the **Last reviewed** date.\n+Whether you make the changes the topic needs or open a docs issue, you should still [update the **Last reviewed** date](#update-the-last-reviewed-date). You can use the GitHub user interface in the browser if you only want to update the **Last reviewed** date.\n \n <!-- links -->\n \n@@ -119,4 +119,4 @@ Whether you make the changes the topic needs or open a docs issue, you should st\n \n <!-- end links -->\n \n-@reviewed 2022-10-12\n+@reviewed 2022-12-11\n\n\n###\n\n", "completion": "docs: fix typos in reviewing content guide (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/contributors-guide-overview.md | file path B: aio/content/guide/contributors-guide-overview.md\n\n@@ -131,4 +131,4 @@ For information about localizing the Angular documentation in a new language, se\n \n <!--end links -->\n \n-@reviewed 2022-10-12\n+@reviewed 2022-12-11\n\n\n###\n\n", "completion": "docs: fix style in contributors overview guide (#<issue-num>)"}
{"prompt": " file path A: aio/tools/doc-linter/styles/Angular/Google_WordListSuggestions.yml | file path B: aio/tools/doc-linter/styles/Angular/Google_WordListSuggestions.yml\n\n@@ -14,6 +14,7 @@ swap:\n   admin: administrator\n   aggregate: together|join\n   all of: all\n+  application: app\n   as to: to\n   assistance: help\n   boolean: Boolean\n\n---\n file path A: aio/tools/doc-linter/styles/Angular/Google_WordListWarnings.yml | file path B: aio/tools/doc-linter/styles/Angular/Google_WordListWarnings.yml\n\n@@ -30,7 +30,6 @@ swap:\n   Android device: Android-powered device\n   android: Android\n   API explorer: APIs Explorer\n-  application: app\n   approx\\.: approximately\n   authN: authentication\n   authZ: authorization\n\n\n###\n\n", "completion": "docs: make \"app\" a suggested replacement for \"application\" (#<issue-num>)"}
{"prompt": " file path A: aio/tools/doc-linter/styles/Angular/Angular_Spelling.yml | file path B: None\n\n@@ -1,11 +0,0 @@\n-# Uses the built-in dictionary and filters.\n-extends: spelling\n-dicpath: ../../dictionaries/en_us/\n-message: \"Did you really mean '%s'? It wasn't found in our dictionary.\"\n-level: warning\n-ignore:\n-  - Vocab/Angular.txt # Angular terms\n-  - Vocab/Foreign.txt # Foreign language words used in the text\n-  - Vocab/Jargon.txt # Computer jargon\n-  - Vocab/Names.txt # Names of people, products, and things\n-  - Vocab/Web.txt # Web terms\n\n\n###\n\n", "completion": "docs: remove spell checker from vale testing until vale bug is resolved (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/core/testing/index.md | file path B: goldens/public-api/core/testing/index.md\n\n@@ -140,16 +140,19 @@ export interface TestBed {\n     overrideProvider(token: any, provider: {\n         useFactory: Function;\n         deps: any[];\n+        multi?: boolean;\n     }): TestBed;\n     // (undocumented)\n     overrideProvider(token: any, provider: {\n         useValue: any;\n+        multi?: boolean;\n     }): TestBed;\n     // (undocumented)\n     overrideProvider(token: any, provider: {\n         useFactory?: Function;\n         useValue?: any;\n         deps?: any[];\n+        multi?: boolean;\n     }): TestBed;\n     // (undocumented)\n     overrideTemplate(component: Type<any>, template: string): TestBed;\n\n---\n file path A: packages/core/test/test_bed_spec.ts | file path B: packages/core/test/test_bed_spec.ts\n\n@@ -1020,7 +1020,7 @@ describe('TestBed', () => {\n \n     it('overridden with an array', () => {\n       const overrideValue = ['override'];\n-      TestBed.overrideProvider(multiToken, {useValue: overrideValue, multi: true} as any);\n+      TestBed.overrideProvider(multiToken, {useValue: overrideValue, multi: true});\n \n       const value = TestBed.inject(multiToken);\n       expect(value.length).toEqual(overrideValue.length);\n@@ -1031,7 +1031,7 @@ describe('TestBed', () => {\n       // This is actually invalid because multi providers return arrays. We have this here so we can\n       // ensure Ivy behaves the same as VE does currently.\n       const overrideValue = 'override';\n-      TestBed.overrideProvider(multiToken, {useValue: overrideValue, multi: true} as any);\n+      TestBed.overrideProvider(multiToken, {useValue: overrideValue, multi: true});\n \n       const value = TestBed.inject(multiToken);\n       expect(value.length).toEqual(overrideValue.length);\n@@ -1248,7 +1248,7 @@ describe('TestBed', () => {\n     });\n \n     const multiOverride = {useValue: [{value: 'new provider'}], multi: true};\n-    TestBed.overrideProvider(MY_TOKEN, multiOverride as any);\n+    TestBed.overrideProvider(MY_TOKEN, multiOverride);\n \n     const fixture = TestBed.createComponent(MyComp);\n     expect(fixture.componentInstance.myProviders).toEqual([{value: 'new provider'}]);\n\n---\n file path A: packages/core/testing/src/test_bed.ts | file path B: packages/core/testing/src/test_bed.ts\n\n@@ -127,13 +127,12 @@ export interface TestBed {\n   /**\n    * Overwrites all providers for the given token with the given provider definition.\n    */\n-  overrideProvider(token: any, provider: {\n-    useFactory: Function,\n-    deps: any[],\n-  }): TestBed;\n-  overrideProvider(token: any, provider: {useValue: any;}): TestBed;\n-  overrideProvider(token: any, provider: {useFactory?: Function, useValue?: any, deps?: any[]}):\n+  overrideProvider(token: any, provider: {useFactory: Function, deps: any[], multi?: boolean}):\n       TestBed;\n+  overrideProvider(token: any, provider: {useValue: any, multi?: boolean}): TestBed;\n+  overrideProvider(\n+      token: any,\n+      provider: {useFactory?: Function, useValue?: any, deps?: any[], multi?: boolean}): TestBed;\n \n   overrideTemplateUsingTestingModule(component: Type<any>, template: string): TestBed;\n \n\n\n###\n\n", "completion": "fix(common): Fix TestBed.overrideProvider type to include multi (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/getting-started/src/app/cart.service.1.ts | file path B: aio/content/examples/getting-started/src/app/cart.service.1.ts\n\n@@ -3,8 +3,4 @@ import { Injectable } from '@angular/core';\n @Injectable({\n   providedIn: 'root'\n })\n-export class CartService {\n-\n-  constructor() {}\n-\n-}\n+export class CartService {}\n\n---\n file path A: aio/content/examples/ngmodules/src/app/items/items.component.ts | file path B: aio/content/examples/ngmodules/src/app/items/items.component.ts\n\n@@ -1,15 +1,9 @@\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n \n @Component({\n   selector: 'app-items',\n   templateUrl: './items.component.html',\n   styleUrls: ['./items.component.css']\n })\n-export class ItemsComponent implements OnInit {\n+export class ItemsComponent {}\n \n-  constructor() { }\n-\n-  ngOnInit() {\n-  }\n-\n-}\n\n---\n file path A: aio/content/examples/providers/src/app/user.service.ts | file path B: aio/content/examples/providers/src/app/user.service.ts\n\n@@ -9,9 +9,6 @@ export interface User {\n   providedIn: 'root',\n })\n export class UserService {\n-\n-  constructor() { }\n-\n   getUsers(): Promise<User[]> {\n     return Promise.resolve([\n       { id: 1, name: 'Maria' },\n@@ -26,5 +23,4 @@ export class UserService {\n       { id: 10, name: 'Seth' }\n     ]);\n   }\n-\n }\n\n\n###\n\n", "completion": "docs: updated docs removed unnecessary imports and empty methods (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/location/location.ts | file path B: packages/common/src/location/location.ts\n\n@@ -301,7 +301,10 @@ export function createLocation() {\n }\n \n function _stripBasePath(basePath: string, url: string): string {\n-  return basePath && url.startsWith(basePath) ? url.substring(basePath.length) : url;\n+  if (basePath === url) {\n+    return '';\n+  }\n+  return basePath && url.startsWith(basePath + '/') ? url.substring(basePath.length) : url;\n }\n \n function _stripIndexHtml(url: string): string {\n\n---\n file path A: packages/common/test/location/location_spec.ts | file path B: packages/common/test/location/location_spec.ts\n\n@@ -266,4 +266,18 @@ describe('Location Class', () => {\n       expect(location.normalize(url)).toBe(route);\n     });\n   });\n+\n+  describe('location.normalize(url) should return correct route', () => {\n+    it('in case url starts with the substring equals APP_BASE_HREF', () => {\n+      const baseHref = '/en';\n+      const url = '/enigma';\n+\n+      TestBed.configureTestingModule({providers: [{provide: APP_BASE_HREF, useValue: baseHref}]});\n+\n+      const location = TestBed.inject(Location);\n+\n+      expect(location.normalize(url)).toBe(url);\n+      expect(location.normalize(baseHref + url)).toBe(url);\n+    });\n+  });\n });\n\n\n###\n\n", "completion": "fix(common): Update `Location` to get a normalized URL valid in case a represented URL starts with the substring equals `APP_BASE_HREF` (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/router_config_loader.ts | file path B: packages/router/src/router_config_loader.ts\n\n@@ -24,7 +24,7 @@ const NG_DEV_MODE = typeof ngDevMode === 'undefined' || !!ngDevMode;\n  * `ROUTES` is a low level API for router configuration via dependency injection.\n  *\n  * We recommend that in almost all cases to use higher level APIs such as `RouterModule.forRoot()`,\n- * `RouterModule.forChild()`, `provideRoutes`, or `Router.resetConfig()`.\n+ * `provideRouter`, or `Router.resetConfig()`.\n  *\n  * @publicApi\n  */\n\n\n###\n\n", "completion": "docs(router): Update ROUTES docs to not point to provideRoutes (#<issue-num>)"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -128,6 +128,7 @@ groups:\n           'packages/platform-browser/animations/**/{*,.*}',\n           'aio/content/guide/animations.md',\n           'aio/content/guide/animate-state-style.md',\n+          'aio/content/guide/animation-api-summary.md',\n           'aio/content/examples/animations/**/{*,.*}',\n           'aio/content/images/guide/animations/**/{*,.*}',\n           'aio/content/guide/complex-animation-sequences.md',\n\n---\n file path A: None | file path B: aio/content/guide/animation-api-summary.md\n\n@@ -0,0 +1,26 @@\n+# Animation API summary\n+\n+<!-- vale off -->\n+\n+The functional API provided by the `@angular/animations` module provides a domain-specific language \\(DSL\\) for creating and controlling animations in Angular applications.\n+See the [API reference](api/animations) for a complete listing and syntax details of the core functions and related data structures.\n+<!-- vale on --> \n+| Function name                     | What it does                                                                                                                                                                                                |\n+|:---                               |:---                                                                                                                                                                                                         |\n+| `trigger()`                       | Kicks off the animation and serves as a container for all other animation function calls. HTML template binds to `triggerName`. Use the first argument to declare a unique trigger name. Uses array syntax. |\n+| `style()`                         | Defines one or more CSS styles to use in animations. Controls the visual appearance of HTML elements during animations. Uses object syntax.                                                                 |\n+| [`state()`](api/animations/state) | Creates a named set of CSS styles that should be applied on successful transition to a given state. The state can then be referenced by name within other animation functions.                              |\n+| `animate()`                       | Specifies the timing information for a transition. Optional values for `delay` and `easing`. Can contain `style()` calls within.                                                                            |\n+| `transition()`                    | Defines the animation sequence between two named states. Uses array syntax.                                                                                                                                 |\n+| `keyframes()`                     | Allows a sequential change between styles within a specified time interval. Use within `animate()`. Can include multiple `style()` calls within each `keyframe()`. Uses array syntax.                       |\n+| [`group()`](api/animations/group) | Specifies a group of animation steps \\(*inner animations*\\) to be run in parallel. Animation continues only after all inner animation steps have completed. Used within `sequence()` or `transition()`.     |\n+| `query()`                         | Finds one or more inner HTML elements within the current element.                                                                                                                                           |\n+| `sequence()`                      | Specifies a list of animation steps that are run sequentially, one by one.                                                                                                                                  |\n+| `stagger()`                       | Staggers the starting time for animations for multiple elements.                                                                                                                                            |\n+| `animation()`                     | Produces a reusable animation that can be invoked from elsewhere. Used together with `useAnimation()`.                                                                                                      |\n+| `useAnimation()`                  | Activates a reusable animation. Used with `animation()`.                                                                                                                                                    |\n+| `animateChild()`                  | Allows animations on child components to be run within the same timeframe as the parent.                                                                                                                    |\n+\n+</table>\n+\n+@reviewed 2022-10-28\n\n\n###\n\n", "completion": "docs: Document extracted from the original Introduction document, which is to be retired. (#<issue-num>)"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -134,7 +134,8 @@ groups:\n           'aio/content/guide/reusable-animations.md',\n           'aio/content/guide/route-animations.md',\n           'aio/content/guide/transition-and-triggers.md',\n-          'aio/content/guide/animations-attach-to-html-template.md'\n+          'aio/content/guide/animations-attach-to-html-template.md',\n+          'aio/content/guide/animation-transition-timing.md'\n           ])\n     reviewers:\n       users:\n\n---\n file path A: None | file path B: aio/content/guide/animation-transition-timing.md\n\n@@ -0,0 +1,126 @@\n+# Animation transition and timing\n+\n+An animation *transition* specifies changes that occur between one state and another. Set the transition to make the change less abrupt. An animation *transition* specifies the changes that occur between one state and another.\n+\n+## Animation `transition()` function defined\n+\n+The `transition()` function accepts two arguments:\n+\n+An expression that defines the direction between two transition states\n+An expression that accepts one or a series of `animate()` steps\n+\n+Use the `animate()` function of a transition to define:\n+\n+* Length\n+* Delay\n+* Easing\n+* Style function for defining styles while transitions are taking place\n+\n+Use the `animate()` function to define the `keyframes()` function for multi-step animations.\n+These definitions are placed in the second argument of the `animate()` function.\n+\n+## Animation metadata: duration, delay, and easing\n+\n+The `animate()` function accepts the `timings` and `styles` input parameters.\n+\n+The `timings` parameter takes either a number or a string defined in three parts.\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+\n+animate (duration)\n+\n+</code-example>\n+\n+or\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+\n+animate ('duration delay easing')\n+\n+</code-example>\n+\n+The first part, `duration`, is required.\n+The duration can be expressed in milliseconds as a number without quotes, or in seconds with quotes and a time specifier.\n+For example, a duration of a tenth of a second can be expressed as follows:\n+\n+*   As a plain number, in milliseconds:\n+    `100`\n+\n+*   In a string, as milliseconds:\n+    `'100ms'`\n+\n+*   In a string, as seconds:\n+    `'0.1s'`\n+\n+The second argument, `delay`, has the same syntax as `duration`.\n+For example:\n+\n+*   Wait for 100 ms and then run for 200 ms: `'0.2s 100ms'`\n+\n+The third argument, `easing`, controls how the animation [accelerates and decelerates](https://easings.net) during its runtime.\n+For example, `ease-in` causes the animation to begin slowly, and to pick up speed as it progresses.\n+\n+*   Wait for 100 ms, run for 200 ms.\n+    Use a deceleration curve to start out fast and slowly decelerate to a resting point:\n+\n+    <code-example format=\"output\" language=\"shell\">\n+\n+    0.2s 100ms ease-out\n+\n+    </code-example>\n+\n+*   Run for 200 ms, with no delay.\n+    Use a standard curve to start slow, speed up in the middle, and then decelerate slowly at the end:\n+\n+    <code-example format=\"output\" language=\"shell\">\n+\n+    0.2s ease-in-out\n+\n+    </code-example>\n+\n+*   Start immediately, run for 200 ms.\n+    Use an acceleration curve to start slow and end at full velocity:\n+    <code-example format=\"output\" language=\"shell\">\n+\n+    0.2s ease-in\n+\n+    </code-example>\n+\n+<div class=\"alert is-helpful\">\n+\n+**NOTE**: <br />\n+See the Material Design website's topic on [Natural easing curves](https://material.io/design/motion/speed.html#easing) for general information on easing curves.\n+\n+</div>\n+\n+This example provides a state transition from `open` to `closed` with a 1-second transition between states.\n+\n+<code-example header=\"src/app/open-close.component.ts\" path=\"animations/src/app/open-close.component.ts\" region=\"transition1\"></code-example>\n+\n+In the preceding code snippet, the `=>` operator indicates unidirectional transitions, and `<=>` is bidirectional.\n+Within the transition, `animate()` specifies how long the transition takes.\n+In this case, the state change from `open` to `closed` takes 1 second, expressed here as `1s`.\n+\n+This example adds a state transition from the `closed` state to the `open` state with a 0.5-second transition animation arc.\n+\n+<code-example header=\"src/app/open-close.component.ts\" path=\"animations/src/app/open-close.component.ts\" region=\"transition2\"></code-example>\n+\n+<div class=\"alert is-helpful\">\n+\n+**NOTE**: <br />\n+Using styles within [`state`](api/animations/state) and `transition` functions:\n+\n+*   Use [`state()`](api/animations/state) to define styles that are applied at the end of each transition, they persist after the animation completes\n+*   Use `transition()` to define intermediate styles, which create the illusion of motion during the animation\n+*   When animations are turned off, `transition()` styles can be skipped, but [`state()`](api/animations/state) styles can't\n+*   Include multiple state pairs within the same `transition()` argument:\n+\n+    <code-example format=\"typescript\" language=\"typescript\">\n+\n+    transition( 'on =&gt; off, off =&gt; void' )\n+\n+    </code-example>\n+\n+</div>\n+\n+@reviewed 2022-10-04\n\n\n###\n\n", "completion": "docs: Document extracted from the original Introduction document, which is to be retired. Linting suggested corrections made.  Restructuring or rewording sentences to be shorter and clearer. (#<issue-num>)"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -133,7 +133,8 @@ groups:\n           'aio/content/guide/complex-animation-sequences.md',\n           'aio/content/guide/reusable-animations.md',\n           'aio/content/guide/route-animations.md',\n-          'aio/content/guide/transition-and-triggers.md'\n+          'aio/content/guide/transition-and-triggers.md',\n+          'aio/content/guide/animations-attach-to-html-template.md'\n           ])\n     reviewers:\n       users:\n\n---\n file path A: None | file path B: aio/content/guide/animations-attach-to-html-template.md\n\n@@ -0,0 +1,43 @@\n+# Define animations and attach to an HTML template\n+\n+Animations are defined in the metadata of the component that controls the HTML element to be animated.\n+\n+## Define the animation\n+\n+Put the code that defines your animations under the `animations:` property within the `@Component()` decorator.\n+\n+<code-example header=\"src/app/open-close.component.ts\" path=\"animations/src/app/open-close.component.ts\" region=\"component\"></code-example>\n+\n+When an animation trigger for a component is defined, attach it to an element in the template. Wrap the trigger name in brackets and precede it with an `@` symbol.\n+Bind the trigger to a template expression using standard Angular property binding syntax. The `triggerName` is the name of the trigger, and `expression` evaluates to a defined animation state.\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+\n+&lt;div [&commat;triggerName]=\"expression\"&gt;&hellip;&lt;/div&gt;;\n+\n+</code-example>\n+\n+The animation is executed or triggered when the expression value changes to a new state.\n+\n+The following code snippet binds the trigger to the value of the `isOpen` property.\n+\n+<code-example header=\"src/app/open-close.component.html\" path=\"animations/src/app/open-close.component.1.html\" region=\"trigger\"></code-example>\n+\n+In this example, when the `isOpen` expression evaluates to a defined state of `open` or `closed`, it notifies the trigger `openClose` of a state change.\n+Then it's up to the `openClose` code to handle the state change and kick off a state change animation.\n+\n+For elements entering or leaving a page \\(inserted or removed from the DOM\\), you can make the animations conditional.\n+For example, use `*ngIf` with the animation trigger in the HTML template.\n+\n+<div class=\"alert is-helpful\">\n+\n+**NOTE**: <br />\n+In the component file, set the trigger that defines the animations as the value of the `animations:` property in the `@Component()` decorator.\n+\n+## Attach an animation to an HTML template\n+\n+In the HTML template file, use the trigger name to attach the defined animations to the HTML element to be animated.\n+\n+</div>\n+\n+@reviewed 2022-10-28\n\n\n###\n\n", "completion": "docs: Document extracted from the original Introduction document, which is to be retired. Linting suggested corrections made.  Restructuring or rewording sentences to be shorter and clearer. (#<issue-num>)"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -127,6 +127,7 @@ groups:\n           'packages/animations/**/{*,.*}',\n           'packages/platform-browser/animations/**/{*,.*}',\n           'aio/content/guide/animations.md',\n+          'aio/content/guide/animate-state-style.md',\n           'aio/content/examples/animations/**/{*,.*}',\n           'aio/content/images/guide/animations/**/{*,.*}',\n           'aio/content/guide/complex-animation-sequences.md',\n\n---\n file path A: None | file path B: aio/content/guide/animate-state-style.md\n\n@@ -0,0 +1,30 @@\n+# Animate state and style\n+\n+You can define a set of styles together to make up a specific state for animating elements and transitions. These states represent style at certain points in your animations that you can animate to and from. For example, you can animate a state as the starting point to a different state and the end of an animation.\n+\n+## What is a state?\n+\n+A state is the condition of an animation. The Angular state() function takes two parameters: a unique name and a style. There is also an optional parameter.\n+\n+## Why would you want to use state?\n+\n+Aliasing a set of styles and allows you to reference that alias for animations in general. This can make animations more readable or more understandable at a glance. You can give animations a useful and descriptive state name, which allows you to quickly understand the purpose of that animation state.\n+\n+Use Angular's [`state()`](api/animations/state) function to define different states to call at the end of each transition.\n+This function takes two arguments:\n+A unique name like `open` or `closed` and a `style()` function.\n+\n+Use the `style()` function to define a set of styles to associate with a given state name.\n+You must use [*camelCase*](guide/glossary#case-conventions) for style attributes that contain dashes, such as `backgroundColor` or wrap them in quotes, such as `'background-color'`.\n+\n+Angular's [`state()`](api/animations/state) function works with the `style\u2063\u00ad(\u2060)` function to set CSS style attributes.\n+In this code snippet, multiple style attributes are set at the same time for the state.\n+In the `open` state, the button has a height of 200 pixels, an opacity of 1, and a yellow background color.\n+\n+<code-example header=\"src/app/open-close.component.ts\" path=\"animations/src/app/open-close.component.ts\" region=\"state1\"></code-example>\n+\n+In the following `closed` state, the button has a height of 100 pixels, an opacity of 0.8, and a background color of blue.\n+\n+<code-example header=\"src/app/open-close.component.ts\" path=\"animations/src/app/open-close.component.ts\" region=\"state2\"></code-example>\n+\n+@reviewed 2022-10-28\n\n\n###\n\n", "completion": "docs: Document extracted from the original Introduction document, which is to be retired. Linting suggested corrections made.  Restructuring or rewording sentences to be shorter and clearer. (#<issue-num>)"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -1286,6 +1286,7 @@ groups:\n         - andrewseguin\n         - dgp1130\n         - ~jelbourn\n+        - jessicajaniuk\n         - josephperrott\n \n   ####################################################################################\n\n\n###\n\n", "completion": "ci: Add jessicajaniuk to code-ownership pullapprove group (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/animations/src/app/home.component.ts | file path B: aio/content/examples/animations/src/app/home.component.ts\n\n@@ -1,15 +1,8 @@\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n \n @Component({\n   selector: 'app-home',\n   templateUrl: './home.component.html',\n   styleUrls: ['./home.component.css']\n })\n-export class HomeComponent implements OnInit {\n-\n-  constructor() { }\n-\n-  ngOnInit() {\n-  }\n-\n-}\n+export class HomeComponent {}\n\n---\n file path A: aio/content/examples/dynamic-form/src/app/question-control.service.ts | file path B: aio/content/examples/dynamic-form/src/app/question-control.service.ts\n\n@@ -6,8 +6,6 @@ import { QuestionBase } from './question-base';\n \n @Injectable()\n export class QuestionControlService {\n-  constructor() { }\n-\n   toFormGroup(questions: QuestionBase<string>[] ) {\n     const group: any = {};\n \n\n---\n file path A: aio/content/examples/lazy-loading-ngmodules/src/app/customers/customers.component.ts | file path B: aio/content/examples/lazy-loading-ngmodules/src/app/customers/customers.component.ts\n\n@@ -1,15 +1,8 @@\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n \n @Component({\n   selector: 'app-customers',\n   templateUrl: './customers.component.html',\n   styleUrls: ['./customers.component.css']\n })\n-export class CustomersComponent implements OnInit {\n-\n-  constructor() { }\n-\n-  ngOnInit() {\n-  }\n-\n-}\n+export class CustomersComponent {}\n\n\n###\n\n", "completion": "docs: cleanup the components (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/location/location.ts | file path B: packages/common/src/location/location.ts\n\n@@ -68,6 +68,12 @@ export class Location implements OnDestroy {\n   constructor(locationStrategy: LocationStrategy) {\n     this._locationStrategy = locationStrategy;\n     const baseHref = this._locationStrategy.getBaseHref();\n+    // Note: This class's interaction with base HREF does not fully follow the rules\n+    // outlined in the spec https://www.freesoft.org/CIE/RFC/1808/18.htm.\n+    // Instead of trying to fix individual bugs with more and more code, we should\n+    // investigate using the URL constructor and providing the base as a second\n+    // argument.\n+    // https://developer.mozilla.org/en-US/docs/Web/API/URL/URL#parameters\n     this._basePath = _stripOrigin(stripTrailingSlash(_stripIndexHtml(baseHref)));\n     this._locationStrategy.onPopState((ev) => {\n       this._subject.emit({\n\n\n###\n\n", "completion": "docs(common): Add note to location about investigating base href handling (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/animations/src/app/about.component.ts | file path B: aio/content/examples/animations/src/app/about.component.ts\n\n@@ -5,6 +5,4 @@ import { Component } from '@angular/core';\n   templateUrl: './about.component.html',\n   styleUrls: ['./about.component.css']\n })\n-export class AboutComponent {\n-\n-}\n+export class AboutComponent {}\n\n---\n file path A: aio/content/examples/deprecation-guide/src/app/lazy/lazy.component.ts | file path B: aio/content/examples/deprecation-guide/src/app/lazy/lazy.component.ts\n\n@@ -1,15 +1,8 @@\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n \n @Component({\n   selector: 'app-lazy',\n   templateUrl: './lazy.component.html',\n   styleUrls: ['./lazy.component.css']\n })\n-export class LazyComponent implements OnInit {\n-\n-  constructor() { }\n-\n-  ngOnInit(): void {\n-  }\n-\n-}\n+export class LazyComponent {}\n\n---\n file path A: aio/content/examples/displaying-data/src/app/app-ctor.component.1.ts | file path B: aio/content/examples/displaying-data/src/app/app-ctor.component.1.ts\n\n@@ -8,11 +8,6 @@ import { Component } from '@angular/core';\n     `\n })\n export class AppComponent {\n-  title: string;\n-  myHero: string;\n-\n-  constructor() {\n-    this.title = 'Tour of Heroes';\n-    this.myHero = 'Windstorm';\n-  }\n+  title = 'Tour of Heroes';\n+  myHero = 'Windstorm';\n }\n\n---\n file path A: aio/content/examples/dynamic-form/src/app/app.module.ts | file path B: aio/content/examples/dynamic-form/src/app/app.module.ts\n\n@@ -12,7 +12,4 @@ import { DynamicFormQuestionComponent } from './dynamic-form-question.component'\n   declarations: [ AppComponent, DynamicFormComponent, DynamicFormQuestionComponent ],\n   bootstrap: [ AppComponent ]\n })\n-export class AppModule {\n-  constructor() {\n-  }\n-}\n+export class AppModule {}\n\n---\n file path A: aio/content/examples/event-binding/src/app/app.module.ts | file path B: aio/content/examples/event-binding/src/app/app.module.ts\n\n@@ -19,4 +19,4 @@ import { ClickDirective } from './click.directive';\n   providers: [],\n   bootstrap: [AppComponent]\n })\n-export class AppModule { }\n+export class AppModule {}\n\n\n###\n\n", "completion": "docs: updated local variables and removed empty methods (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -119,7 +119,7 @@\n     \"eslint-plugin-prefer-arrow\": \"^1.2.3\",\n     \"find-free-port\": \"^2.0.0\",\n     \"firebase-tools\": \"^11.0.0\",\n-    \"fs-extra\": \"^10.0.0\",\n+    \"fs-extra\": \"^11.0.0\",\n     \"get-port\": \"^6.1.2\",\n     \"globby\": \"^13.0.0\",\n     \"hast-util-has-property\": \"^1.0.4\",\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -6892,7 +6892,7 @@ fs-extra@3.0.1:\n     jsonfile \"^3.0.0\"\n     universalify \"^0.1.0\"\n \n-fs-extra@^10.0.0, fs-extra@^10.1.0:\n+fs-extra@^10.1.0:\n   version \"10.1.0\"\n   resolved \"https://registry.yarnpkg.com/fs-extra/-/fs-extra-10.1.0.tgz#02873cfbc4084dde127eaa5f9905eef2325d1abf\"\n   integrity sha512-oRXApq54ETRj4eMiFzGnHWGy+zo5raudjuxN0b8H7s/RU2oW0Wvsx9O0ACRN/kRq9E8Vu/ReskGB5o3ji+FzHQ==\n@@ -6901,6 +6901,15 @@ fs-extra@^10.0.0, fs-extra@^10.1.0:\n     jsonfile \"^6.0.1\"\n     universalify \"^2.0.0\"\n \n+fs-extra@^11.0.0:\n+  version \"11.1.0\"\n+  resolved \"https://registry.yarnpkg.com/fs-extra/-/fs-extra-11.1.0.tgz#5784b102104433bb0e090f48bfc4a30742c357ed\"\n+  integrity sha512-0rcTq621PD5jM/e0a3EJoGC/1TC5ZBCERW82LQuwfGnCa1V8w7dpYH1yNu+SLb6E5dkeCBzKEyLGlFrnr+dUyw==\n+  dependencies:\n+    graceful-fs \"^4.2.0\"\n+    jsonfile \"^6.0.1\"\n+    universalify \"^2.0.0\"\n+\n fs-extra@^8.1.0:\n   version \"8.1.0\"\n   resolved \"https://registry.yarnpkg.com/fs-extra/-/fs-extra-8.1.0.tgz#49d43c45a88cd9677668cb7be1b46efdb8d2e1c0\"\n\n\n###\n\n", "completion": "build: update dependency fs-extra to v11 (#<issue-num>)"}
{"prompt": " file path A: aio/content/demos/first-app/.gitignore | file path B: aio/content/demos/first-app/.gitignore\n\n@@ -1,5 +1,41 @@\n-# git should ignore the cached files\n-.angular\n+# See http://help.github.com/ignore-files/ for more about ignoring files.\n \n-# git should ignore the generated files\n-dist\n+# Compiled output\n+/dist\n+/tmp\n+/out-tsc\n+\n+# Node\n+/node_modules\n+npm-debug.log\n+yarn-error.log\n+\n+# IDEs and editors\n+.idea/\n+.project\n+.classpath\n+.c9/\n+*.launch\n+.settings/\n+*.sublime-workspace\n+\n+# Visual Studio Code\n+.vscode/*\n+!.vscode/settings.json\n+!.vscode/tasks.json\n+!.vscode/launch.json\n+!.vscode/extensions.json\n+.history/*\n+\n+# Miscellaneous\n+/.angular/cache\n+.sass-cache/\n+/connect.lock\n+/coverage\n+/libpeerconnection.log\n+testem.log\n+/typings\n+\n+# System files\n+.DS_Store\n+Thumbs.db\n\n\n###\n\n", "completion": "build: update gitignore to ignore files which should not be commited. (#<issue-num>)"}
{"prompt": " file path A: renovate.json | file path B: renovate.json\n\n@@ -15,6 +15,9 @@\n   \"timezone\": \"America/Tijuana\",\n   \"lockFileMaintenance\": {\"enabled\": true},\n   \"labels\": [\"target: patch\", \"area: build & ci\", \"action: review\"],\n+  \"ignorePaths\": [\n+    \"aio/content/demos/first-app/package.json\"\n+  ],\n   \"ignoreDeps\": [\n     \"@angular/animations-12\",\n     \"@angular/common-12\",\n\n\n###\n\n", "completion": "ci: disable renovate from updating `marketing-first-app` (#<issue-num>)"}
{"prompt": " file path A: package.json | file path B: package.json\n\n@@ -180,7 +180,7 @@\n   \"// 2\": \"devDependencies are not used under Bazel. Many can be removed after test.sh is deleted.\",\n   \"devDependencies\": {\n     \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#f6e4541df4e7949876ac76fd3a7b36a13ec8a5f6\",\n-    \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#5677f11ede284cd64355b568fcfd29e6ea1e9cb4\",\n+    \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#33b71080f5a62f7482ae5cb3db2823824bd09cc4\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n     \"@bazel/buildifier\": \"^5.0.0\",\n     \"@bazel/ibazel\": \"^0.16.0\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -151,7 +151,6 @@\n \n \"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#f6e4541df4e7949876ac76fd3a7b36a13ec8a5f6\":\n   version \"0.0.0-51f34baeaffbc8b5df200e9e8cf5a4bde1cc9714\"\n-  uid f6e4541df4e7949876ac76fd3a7b36a13ec8a5f6\n   resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#f6e4541df4e7949876ac76fd3a7b36a13ec8a5f6\"\n   dependencies:\n     \"@angular-devkit/build-angular\" \"15.1.0-next.1\"\n@@ -303,10 +302,9 @@\n     \"@material/typography\" \"15.0.0-canary.7971d6ad5.0\"\n     tslib \"^2.3.0\"\n \n-\"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#5677f11ede284cd64355b568fcfd29e6ea1e9cb4\":\n-  version \"0.0.0-51f34baeaffbc8b5df200e9e8cf5a4bde1cc9714\"\n-  uid \"5677f11ede284cd64355b568fcfd29e6ea1e9cb4\"\n-  resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#5677f11ede284cd64355b568fcfd29e6ea1e9cb4\"\n+\"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#33b71080f5a62f7482ae5cb3db2823824bd09cc4\":\n+  version \"0.0.0-6d049bb52bd72e2f08b94f0a37a5603e660ac27b\"\n+  resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#33b71080f5a62f7482ae5cb3db2823824bd09cc4\"\n   dependencies:\n     \"@yarnpkg/lockfile\" \"^1.1.0\"\n     typescript \"~4.8.0\"\n\n\n###\n\n", "completion": "build: update to latest @angular/ng-dev buid (#<issue-num>)"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -843,7 +843,7 @@ groups:\n           'aio/content/images/guide/setup-local/**/{*,.*}',\n           'aio/content/tutorial/**/{*,.*}',\n           'aio/content/images/guide/toh/**/{*,.*}',\n-          'aio/content/examples/marketing-first-app/**/{*,.*}',\n+          'aio/content/demos/first-app/**/{*,.*}',\n           'aio/content/examples/toh-pt0/**/{*,.*}',\n           'aio/content/examples/toh-pt1/**/{*,.*}',\n           'aio/content/examples/toh-pt2/**/{*,.*}',\n\n---\n file path A: aio/content/examples/marketing-first-app/.gitignore | file path B: aio/content/demos/first-app/.gitignore\n\n\n---\n file path A: aio/content/examples/marketing-first-app/angular.json | file path B: aio/content/demos/first-app/angular.json\n\n\n---\n file path A: aio/content/examples/marketing-first-app/package-lock.json | file path B: aio/content/demos/first-app/package-lock.json\n\n\n---\n file path A: aio/content/examples/marketing-first-app/package.json | file path B: aio/content/demos/first-app/package.json\n\n\n---\n file path A: aio/content/examples/marketing-first-app/src/index.html | file path B: aio/content/demos/first-app/src/index.html\n\n\n---\n file path A: aio/content/examples/marketing-first-app/src/karma.conf.js | file path B: aio/content/demos/first-app/src/karma.conf.js\n\n\n---\n file path A: aio/content/examples/marketing-first-app/src/main.ts | file path B: aio/content/demos/first-app/src/main.ts\n\n\n---\n file path A: aio/content/examples/marketing-first-app/src/polyfills.ts | file path B: aio/content/demos/first-app/src/polyfills.ts\n\n\n---\n file path A: aio/content/examples/marketing-first-app/src/styles.css | file path B: aio/content/demos/first-app/src/styles.css\n\n\n---\n file path A: aio/content/examples/marketing-first-app/src/tsconfig.app.json | file path B: aio/content/demos/first-app/src/tsconfig.app.json\n\n\n---\n file path A: aio/content/examples/marketing-first-app/src/tsconfig.spec.json | file path B: aio/content/demos/first-app/src/tsconfig.spec.json\n\n\n---\n file path A: aio/content/examples/marketing-first-app/tsconfig.json | file path B: aio/content/demos/first-app/tsconfig.json\n\n\n\n###\n\n", "completion": "docs: move marketing demo out of tested examples (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/location/location.ts | file path B: packages/common/src/location/location.ts\n\n@@ -303,7 +303,13 @@ function _stripIndexHtml(url: string): string {\n }\n \n function _stripOrigin(baseHref: string): string {\n-  if (/^(https?:)?\\/\\//.test(baseHref)) {\n+  // DO NOT REFACTOR! Previously, this check looked like this:\n+  // `/^(https?:)?\\/\\//.test(baseHref)`, but that resulted in\n+  // syntactically incorrect code after Closure Compiler minification.\n+  // This was likely caused by a bug in Closure Compiler, but\n+  // for now, the check is rewritten to use `new RegExp` instead.\n+  const isAbsoluteUrl = (new RegExp('^(https?:)?//')).test(baseHref);\n+  if (isAbsoluteUrl) {\n     const [, pathname] = baseHref.split(/\\/\\/[^\\/]+/);\n     return pathname;\n   }\n\n\n###\n\n", "completion": "refactor(router): use `RegExp` to check if a URL is absolute (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/partial_evaluator/src/interpreter.ts | file path B: packages/compiler-cli/src/ngtsc/partial_evaluator/src/interpreter.ts\n\n@@ -704,6 +704,10 @@ export class StaticInterpreter {\n       return this.visitTupleType(node, context);\n     } else if (ts.isNamedTupleMember(node)) {\n       return this.visitType(node.type, context);\n+    } else if (ts.isTypeOperatorNode(node) && node.operator === ts.SyntaxKind.ReadonlyKeyword) {\n+      return this.visitType(node.type, context);\n+    } else if (ts.isTypeQueryNode(node)) {\n+      return this.visitTypeQuery(node, context);\n     }\n \n     return DynamicValue.fromDynamicType(node);\n@@ -718,6 +722,20 @@ export class StaticInterpreter {\n \n     return res;\n   }\n+\n+  private visitTypeQuery(node: ts.TypeQueryNode, context: Context): ResolvedValue {\n+    if (!ts.isIdentifier(node.exprName)) {\n+      return DynamicValue.fromUnknown(node);\n+    }\n+\n+    const decl = this.host.getDeclarationOfIdentifier(node.exprName);\n+    if (decl === null) {\n+      return DynamicValue.fromUnknownIdentifier(node.exprName);\n+    }\n+\n+    const declContext: Context = {...context, ...joinModuleContext(context, node, decl)};\n+    return this.visitAmbiguousDeclaration(decl, declContext);\n+  }\n }\n \n function isFunctionOrMethodReference(ref: Reference<ts.Node>):\n\n---\n file path A: packages/compiler-cli/src/ngtsc/partial_evaluator/test/evaluator_spec.ts | file path B: packages/compiler-cli/src/ngtsc/partial_evaluator/test/evaluator_spec.ts\n\n@@ -371,6 +371,38 @@ runInEachFileSystem(() => {\n       expect(evaluate(`declare const x: ['bar'];`, `[...x]`)).toEqual(['bar']);\n     });\n \n+    // https://github.com/angular/angular/issues/48089\n+    it('supports declarations of readonly tuples with class references', () => {\n+      const tuple = evaluate(\n+          `\n+        import {External} from 'external';\n+        declare class Local {}\n+        declare const x: readonly [typeof External, typeof Local];`,\n+          `x`, [\n+            {\n+              name: _('/node_modules/external/index.d.ts'),\n+              contents: 'export declare class External {}'\n+            },\n+          ]);\n+      if (!Array.isArray(tuple)) {\n+        return fail('Should have evaluated tuple as an array');\n+      }\n+      const [external, local] = tuple;\n+      if (!(external instanceof Reference)) {\n+        return fail('Should have evaluated `typeof A` to a Reference');\n+      }\n+      expect(ts.isClassDeclaration(external.node)).toBe(true);\n+      expect(external.debugName).toBe('External');\n+      expect(external.ownedByModuleGuess).toBe('external');\n+\n+      if (!(local instanceof Reference)) {\n+        return fail('Should have evaluated `typeof B` to a Reference');\n+      }\n+      expect(ts.isClassDeclaration(local.node)).toBe(true);\n+      expect(local.debugName).toBe('Local');\n+      expect(local.ownedByModuleGuess).toBeNull();\n+    });\n+\n     it('evaluates tuple elements it cannot understand to DynamicValue', () => {\n       const value = evaluate(`declare const x: ['foo', string];`, `x`) as [string, DynamicValue];\n \n\n---\n file path A: packages/compiler-cli/test/ngtsc/standalone_spec.ts | file path B: packages/compiler-cli/test/ngtsc/standalone_spec.ts\n\n@@ -870,6 +870,35 @@ runInEachFileSystem(() => {\n         const jsCode = env.getContents('test.js');\n         expect(jsCode).toContain('dependencies: [StandalonePipe]');\n       });\n+\n+      it('should compile imports using a const tuple in external library', () => {\n+        env.write('node_modules/external/index.d.ts', `\n+          import {\u0275\u0275DirectiveDeclaration} from '@angular/core';\n+\n+          export declare class StandaloneDir {\n+            static \u0275dir: \u0275\u0275DirectiveDeclaration<StandaloneDir, \"[dir]\", never, {}, {}, never, never, true>;\n+          }\n+\n+          export declare const DECLARATIONS: readonly [typeof StandaloneDir];\n+        `);\n+        env.write('test.ts', `\n+          import {Component, Directive} from '@angular/core';\n+          import {DECLARATIONS} from 'external';\n+\n+          @Component({\n+            standalone: true,\n+            selector: 'test-cmp',\n+            template: '<div dir></div>',\n+            imports: [DECLARATIONS],\n+          })\n+          export class TestCmp {}\n+        `);\n+        env.driveMain();\n+\n+        const jsCode = env.getContents('test.js');\n+        expect(jsCode).toContain('import * as i1 from \"external\";');\n+        expect(jsCode).toContain('dependencies: [i1.StandaloneDir]');\n+      });\n     });\n \n     describe('optimizations', () => {\n\n\n###\n\n", "completion": "fix(compiler-cli): evaluate const tuple types statically (#<issue-num>)"}
{"prompt": " file path A: package.json | file path B: package.json\n\n@@ -76,6 +76,7 @@\n     \"@bazel/runfiles\": \"5.7.1\",\n     \"@bazel/terser\": \"5.7.1\",\n     \"@bazel/worker\": \"5.7.1\",\n+    \"@jridgewell/sourcemap-codec\": \"^1.4.14\",\n     \"@microsoft/api-extractor\": \"^7.24.2\",\n     \"@rollup/plugin-babel\": \"^6.0.0\",\n     \"@rollup/plugin-commonjs\": \"^23.0.0\",\n@@ -162,7 +163,6 @@\n     \"shelljs\": \"^0.8.5\",\n     \"source-map\": \"0.7.4\",\n     \"source-map-support\": \"0.5.21\",\n-    \"sourcemap-codec\": \"^1.4.8\",\n     \"start-server-and-test\": \"^1.10.11\",\n     \"systemjs\": \"0.18.10\",\n     \"terser\": \"^5.8.0\",\n\n---\n file path A: packages/compiler-cli/BUILD.bazel | file path B: packages/compiler-cli/BUILD.bazel\n\n@@ -49,7 +49,7 @@ esbuild(\n         \"dependency-graph\",\n         \"magic-string\",\n         \"semver\",\n-        \"sourcemap-codec\",\n+        \"@jridgewell/sourcemap-codec\",\n         \"tslib\",\n         \"yargs\",\n     ],\n\n---\n file path A: packages/compiler-cli/ngcc/test/BUILD.bazel | file path B: packages/compiler-cli/ngcc/test/BUILD.bazel\n\n@@ -27,11 +27,11 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/testing\",\n         \"//packages/compiler-cli/src/ngtsc/transform\",\n         \"//packages/compiler-cli/src/ngtsc/translator\",\n+        \"@npm//@jridgewell/sourcemap-codec\",\n         \"@npm//@types/convert-source-map\",\n         \"@npm//@types/yargs\",\n         \"@npm//dependency-graph\",\n         \"@npm//magic-string\",\n-        \"@npm//sourcemap-codec\",\n         \"@npm//typescript\",\n     ],\n )\n\n---\n file path A: packages/compiler-cli/ngcc/test/rendering/dts_renderer_spec.ts | file path B: packages/compiler-cli/ngcc/test/rendering/dts_renderer_spec.ts\n\n@@ -5,9 +5,9 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n+import {encode} from '@jridgewell/sourcemap-codec';\n import mapHelpers from 'convert-source-map';\n import MagicString from 'magic-string';\n-import {encode} from 'sourcemap-codec';\n import ts from 'typescript';\n \n import {absoluteFrom, getFileSystem} from '../../../src/ngtsc/file_system';\n\n---\n file path A: packages/compiler-cli/ngcc/test/rendering/renderer_spec.ts | file path B: packages/compiler-cli/ngcc/test/rendering/renderer_spec.ts\n\n@@ -8,7 +8,6 @@\n import {Statement} from '@angular/compiler';\n import mapHelpers from 'convert-source-map';\n import MagicString from 'magic-string';\n-import {encode, SourceMapMappings} from 'sourcemap-codec';\n import ts from 'typescript';\n \n import {absoluteFrom, getFileSystem} from '../../../src/ngtsc/file_system';\n@@ -145,29 +144,6 @@ runInEachFileSystem(() => {\n             `import { NgModule } from '@angular/core';\\nexport class A {}\\nA.decorators = [\\n    { type: NgModule, args: [{}] }\\n];\\n`\n       };\n \n-      const JS_CONTENT_MAPPINGS: SourceMapMappings = [\n-        [\n-          [0, 0, 0, 0], [7, 0, 0, 7], [9, 0, 0, 8], [18, 0, 0, 17], [20, 0, 0, 18], [26, 0, 0, 24],\n-          [41, 0, 0, 39], [42, 0, 0, 40]\n-        ],\n-        [[0, 0, 2, 0], [4, 0, 2, 13], [5, 0, 2, 14], [8, 0, 2, 0], [14, 0, 2, 13], [15, 0, 2, 14]],\n-        [[4, 0, 3, 2], [7, 0, 3, 5], [8, 0, 3, 6], [9, 0, 3, 15]],\n-        [\n-          [0, 0, 3, 27], [7, 0, 3, 34], [8, 0, 3, 35], [9, 0, 3, 36], [10, 0, 3, 37],\n-          [11, 0, 3, 38], [1, 0, 4, 1], [2, 0, 4, 1]\n-        ],\n-        [[0, 0, 2, 13], [1, 0, 2, 14]],\n-        [],\n-        [\n-          [2, 0, 1, 1], [11, 0, 1, 10], [12, 0, 1, 11], [14, 0, 1, 12], [3, 0, 2, 13],\n-          [4, 0, 2, 14], [5, 0, 4, 1]\n-        ],\n-        [\n-          [5, 0, 1, 20], [7, 0, 1, 22], [12, 0, 1, 27], [14, 0, 1, 28], [15, 0, 1, 29],\n-          [9, 0, 2, 13], [10, 0, 2, 14]\n-        ],\n-      ];\n-\n       JS_CONTENT_MAP = mapHelpers.fromObject({\n         'version': 3,\n         'file': 'file.js',\n@@ -175,7 +151,7 @@ runInEachFileSystem(() => {\n         'sources': ['file.ts'],\n         'sourcesContent': [TS_CONTENT.contents],\n         'names': [],\n-        'mappings': encode(JS_CONTENT_MAPPINGS),\n+        'mappings': ';;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA',\n       });\n \n       RENDERED_CONTENTS =\n@@ -187,29 +163,7 @@ runInEachFileSystem(() => {\n         'file': 'file.js',\n         'sources': ['file.js'],\n         'names': [],\n-        'mappings': encode([\n-          [],\n-          [],\n-          [],\n-          [],\n-          [],\n-          [],\n-          [],\n-          [],\n-          [],\n-          [],\n-          [],\n-          [],\n-          [[0, 0, 0, 0]],\n-          [[0, 0, 1, 0]],\n-          [[0, 0, 2, 0]],\n-          [[0, 0, 3, 0]],\n-          [[0, 0, 4, 0]],\n-          [[0, 0, 5, 0]],\n-          [[0, 0, 6, 0]],\n-          [[0, 0, 7, 0]],\n-          [[0, 0, 8, 0]]\n-        ]),\n+        'mappings': ';;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA',\n         'sourcesContent': [JS_CONTENT.contents],\n       });\n \n@@ -218,53 +172,7 @@ runInEachFileSystem(() => {\n         'file': 'file.js',\n         'sources': ['file.ts'],\n         'names': [],\n-        'mappings': encode([\n-          [],\n-          [],\n-          [],\n-          [],\n-          [],\n-          [],\n-          [],\n-          [],\n-          [],\n-          [],\n-          [],\n-          [],\n-          [\n-            [0, 0, 0, 0], [7, 0, 0, 7], [9, 0, 0, 8], [18, 0, 0, 17], [20, 0, 0, 18],\n-            [26, 0, 0, 24], [41, 0, 0, 39], [42, 0, 0, 40]\n-          ],\n-          [\n-            [0, 0, 2, 0], [4, 0, 2, 13], [5, 0, 2, 14], [8, 0, 2, 0], [14, 0, 2, 13], [15, 0, 2, 14]\n-          ],\n-          [[0, 0, 2, 16], [4, 0, 3, 2], [7, 0, 3, 5], [8, 0, 3, 6], [9, 0, 3, 15]],\n-          [\n-            [0, 0, 3, 27], [7, 0, 3, 34], [8, 0, 3, 35], [9, 0, 3, 36], [10, 0, 3, 37],\n-            [11, 0, 3, 38], [1, 0, 4, 1], [2, 0, 4, 1]\n-          ],\n-          [[0, 0, 2, 13], [1, 0, 2, 14]],\n-          [[0, 0, 3, 3]],\n-          [\n-            [0, 0, 3, 5], [2, 0, 1, 1], [11, 0, 1, 10], [12, 0, 1, 11], [14, 0, 1, 12],\n-            [3, 0, 2, 13], [4, 0, 2, 14], [5, 0, 4, 1]\n-          ],\n-          [\n-            [0, 0, 4, 13], [5, 0, 1, 20], [7, 0, 1, 22], [12, 0, 1, 27], [14, 0, 1, 28],\n-            [15, 0, 1, 29], [9, 0, 2, 13], [10, 0, 2, 14]\n-          ],\n-          [[0, 0, 4, 2]],\n-          [],\n-          [\n-            [0, 0, 0, 2], [0, 0, 0, 2], [0, 0, 0, 2], [0, 0, 0, 2], [0, 0, 0, 2], [0, 0, 0, 2],\n-            [0, 0, 0, 2], [0, 0, 0, 2], [0, 0, 2, 2], [0, 0, 2, 2], [0, 0, 2, 2], [0, 0, 2, 2],\n-            [0, 0, 2, 2], [0, 0, 2, 2], [0, 0, 3, 2], [0, 0, 3, 2], [0, 0, 3, 2], [0, 0, 3, 2],\n-            [0, 0, 3, 2], [0, 0, 3, 2], [0, 0, 3, 2], [0, 0, 3, 2], [0, 0, 3, 2], [0, 0, 3, 2],\n-            [0, 0, 4, 2], [0, 0, 4, 2], [0, 0, 2, 2], [0, 0, 2, 2], [0, 0, 1, 2], [0, 0, 1, 2],\n-            [0, 0, 1, 2], [0, 0, 1, 2], [0, 0, 2, 2], [0, 0, 2, 2], [0, 0, 4, 2], [0, 0, 1, 2],\n-            [0, 0, 1, 2], [0, 0, 1, 2], [0, 0, 1, 2], [0, 0, 1, 2], [0, 0, 2, 2], [0, 0, 2, 2]\n-          ],\n-        ]),\n+        'mappings': ';;;;;;;;;;;;;;;;;;;;;;AAAA,AACA,AACA,AACA,AACA,AACA,AACA,AACA,AACA,AACA,AACA',\n         'sourcesContent': [TS_CONTENT.contents],\n       });\n     });\n\n---\n file path A: packages/compiler-cli/package.json | file path B: packages/compiler-cli/package.json\n\n@@ -54,13 +54,13 @@\n   },\n   \"dependencies\": {\n     \"@babel/core\": \"^7.17.2\",\n+    \"@jridgewell/sourcemap-codec\": \"^1.4.14\",\n     \"reflect-metadata\": \"^0.1.2\",\n     \"chokidar\": \"^3.0.0\",\n     \"convert-source-map\": \"^1.5.1\",\n     \"dependency-graph\": \"^0.11.0\",\n     \"magic-string\": \"^0.27.0\",\n     \"semver\": \"^7.0.0\",\n-    \"sourcemap-codec\": \"^1.4.8\",\n     \"tslib\": \"^2.3.0\",\n     \"yargs\": \"^17.2.1\"\n   },\n\n---\n file path A: packages/compiler-cli/src/ngtsc/sourcemaps/BUILD.bazel | file path B: packages/compiler-cli/src/ngtsc/sourcemaps/BUILD.bazel\n\n@@ -10,9 +10,9 @@ ts_library(\n     deps = [\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n         \"//packages/compiler-cli/src/ngtsc/logging\",\n+        \"@npm//@jridgewell/sourcemap-codec\",\n         \"@npm//@types/convert-source-map\",\n         \"@npm//@types/node\",\n         \"@npm//convert-source-map\",\n-        \"@npm//sourcemap-codec\",\n     ],\n )\n\n---\n file path A: packages/compiler-cli/src/ngtsc/sourcemaps/src/source_file.ts | file path B: packages/compiler-cli/src/ngtsc/sourcemaps/src/source_file.ts\n\n@@ -5,8 +5,8 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n+import {decode, encode, SourceMapMappings, SourceMapSegment} from '@jridgewell/sourcemap-codec';\n import mapHelpers from 'convert-source-map';\n-import {decode, encode, SourceMapMappings, SourceMapSegment} from 'sourcemap-codec';\n \n import {AbsoluteFsPath, PathManipulation} from '../../file_system';\n \n\n---\n file path A: packages/compiler-cli/src/ngtsc/sourcemaps/test/BUILD.bazel | file path B: packages/compiler-cli/src/ngtsc/sourcemaps/test/BUILD.bazel\n\n@@ -13,9 +13,9 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/file_system/testing\",\n         \"//packages/compiler-cli/src/ngtsc/logging/testing\",\n         \"//packages/compiler-cli/src/ngtsc/sourcemaps\",\n+        \"@npm//@jridgewell/sourcemap-codec\",\n         \"@npm//@types/convert-source-map\",\n         \"@npm//convert-source-map\",\n-        \"@npm//sourcemap-codec\",\n     ],\n )\n \n\n---\n file path A: packages/compiler-cli/src/ngtsc/sourcemaps/test/source_file_spec.ts | file path B: packages/compiler-cli/src/ngtsc/sourcemaps/test/source_file_spec.ts\n\n@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {encode} from 'sourcemap-codec';\n+import {encode} from '@jridgewell/sourcemap-codec';\n \n import {absoluteFrom, getFileSystem, PathManipulation} from '../../file_system';\n import {runInEachFileSystem} from '../../file_system/testing';\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -245,7 +245,6 @@\n \n \"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#d94cd02db1a276929ff63739d0b5f80a45a14abf\":\n   version \"0.0.0-dd53634ba2a792fce0649c90b30752b7dff6f68a\"\n-  uid d94cd02db1a276929ff63739d0b5f80a45a14abf\n   resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#d94cd02db1a276929ff63739d0b5f80a45a14abf\"\n   dependencies:\n     \"@angular-devkit/build-angular\" \"15.1.0-next.0\"\n@@ -399,7 +398,6 @@\n \n \"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#a2a71f76ee8a4cb4795f8a027d946f620e623b81\":\n   version \"0.0.0-dd53634ba2a792fce0649c90b30752b7dff6f68a\"\n-  uid a2a71f76ee8a4cb4795f8a027d946f620e623b81\n   resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#a2a71f76ee8a4cb4795f8a027d946f620e623b81\"\n   dependencies:\n     \"@yarnpkg/lockfile\" \"^1.1.0\"\n@@ -2424,7 +2422,7 @@\n     \"@jridgewell/gen-mapping\" \"^0.3.0\"\n     \"@jridgewell/trace-mapping\" \"^0.3.9\"\n \n-\"@jridgewell/sourcemap-codec@^1.4.10\", \"@jridgewell/sourcemap-codec@^1.4.13\":\n+\"@jridgewell/sourcemap-codec@^1.4.10\", \"@jridgewell/sourcemap-codec@^1.4.13\", \"@jridgewell/sourcemap-codec@^1.4.14\":\n   version \"1.4.14\"\n   resolved \"https://registry.yarnpkg.com/@jridgewell/sourcemap-codec/-/sourcemap-codec-1.4.14.tgz#add4c98d341472a289190b424efbdb096991bb24\"\n   integrity sha512-XPSJHWmi394fuUuzDnGz1wiKqWfo1yXecHQMRf2l6hztTO+nPru658AyDngaBe7isIxEkRsPR3FZh+s7iVa4Uw==\n\n\n###\n\n", "completion": "refactor(compiler): replace deprecated `sourcemap-codec` (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/testing-components-scenarios.md | file path B: aio/content/guide/testing-components-scenarios.md\n\n@@ -1003,7 +1003,7 @@ In practice you will combine the two techniques in the same setup, as seen in th\n \n <code-example header=\"app/app.component.spec.ts (mixed setup)\" path=\"testing/src/app/app.component.spec.ts\" region=\"mixed-setup\"></code-example>\n \n-The Angular compiler creates the `BannerComponentStub` for the `<app-banner>` element and applies the `RouterLinkStubDirective` to the anchors with the `routerLink` attribute, but it ignores the `<app-welcome>` and `<router-outlet>` tags.\n+The Angular compiler creates the `BannerStubComponent` for the `<app-banner>` element and applies the `RouterLinkStubDirective` to the anchors with the `routerLink` attribute, but it ignores the `<app-welcome>` and `<router-outlet>` tags.\n \n <a id=\"routerlink\"></a>\n \n\n\n###\n\n", "completion": "docs: fix the name of stub component (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,27 @@\n+<a name=\"15.0.3\"></a>\n+# 15.0.3 (2022-12-07)\n+### common\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [50b1c2bf52](https://github.com/angular/angular/commit/50b1c2bf520e88828eadefcb2d0acaf151f8118e) | fix | Don't generate srcsets with very large sources ([#47997](https://github.com/angular/angular/pull/47997)) |\n+| [bf44dc234a](https://github.com/angular/angular/commit/bf44dc234a32069cb297ef7d3a87c2004cad8b00) | fix | Update `Location` to support base href containing `origin` ([#48327](https://github.com/angular/angular/pull/48327)) |\n+### compiler\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [9a5d84249a](https://github.com/angular/angular/commit/9a5d84249a0fd6b5c2a77c7ab6cbf72d90c45ee3) | fix | make sure selectors inside container queries are correctly scoped ([#48353](https://github.com/angular/angular/pull/48353)) |\n+### compiler-cli\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [167bc0d163](https://github.com/angular/angular/commit/167bc0d1638ffd6fe91bcb40f96c2ab90f3e01cb) | fix | Produce diagnostic rather than crash when using invalid hostDirective ([#48314](https://github.com/angular/angular/pull/48314)) |\n+### core\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [e4dcaa513e](https://github.com/angular/angular/commit/e4dcaa513e7d5ccd3a63edf6132792873f01f7c1) | fix | unable to inject ChangeDetectorRef inside host directives ([#48355](https://github.com/angular/angular/pull/48355)) |\n+## Special Thanks\n+Alan Agius, Alex Castle, Andrew Kushnir, Andrew Scott, Bob Watson, Derek Cormier, Joey Perrott, Konstantin Kharitonov, Kristiyan Kostadinov, Paul Gschwendtner, Pawel Kozlowski, dario-piotrowicz and piyush132000\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.1.0-next.1\"></a>\n # 15.1.0-next.1 (2022-11-30)\n ## Deprecations\n\n\n###\n\n", "completion": "docs: release notes for the v15.0.3 release"}
{"prompt": " file path A: packages/common/src/location/location.ts | file path B: packages/common/src/location/location.ts\n\n@@ -57,7 +57,7 @@ export class Location implements OnDestroy {\n   /** @internal */\n   _subject: EventEmitter<any> = new EventEmitter();\n   /** @internal */\n-  _baseHref: string;\n+  _basePath: string;\n   /** @internal */\n   _locationStrategy: LocationStrategy;\n   /** @internal */\n@@ -67,8 +67,8 @@ export class Location implements OnDestroy {\n \n   constructor(locationStrategy: LocationStrategy) {\n     this._locationStrategy = locationStrategy;\n-    const browserBaseHref = this._locationStrategy.getBaseHref();\n-    this._baseHref = stripTrailingSlash(_stripIndexHtml(browserBaseHref));\n+    const baseHref = this._locationStrategy.getBaseHref();\n+    this._basePath = _stripOrigin(stripTrailingSlash(_stripIndexHtml(baseHref)));\n     this._locationStrategy.onPopState((ev) => {\n       this._subject.emit({\n         'url': this.path(true),\n@@ -127,7 +127,7 @@ export class Location implements OnDestroy {\n    * @returns The normalized URL string.\n    */\n   normalize(url: string): string {\n-    return Location.stripTrailingSlash(_stripBaseHref(this._baseHref, _stripIndexHtml(url)));\n+    return Location.stripTrailingSlash(_stripBasePath(this._basePath, _stripIndexHtml(url)));\n   }\n \n   /**\n@@ -294,10 +294,18 @@ export function createLocation() {\n   return new Location(\u0275\u0275inject(LocationStrategy as any));\n }\n \n-function _stripBaseHref(baseHref: string, url: string): string {\n-  return baseHref && url.startsWith(baseHref) ? url.substring(baseHref.length) : url;\n+function _stripBasePath(basePath: string, url: string): string {\n+  return basePath && url.startsWith(basePath) ? url.substring(basePath.length) : url;\n }\n \n function _stripIndexHtml(url: string): string {\n   return url.replace(/\\/index.html$/, '');\n }\n+\n+function _stripOrigin(baseHref: string): string {\n+  if (/^(https?:)?\\/\\//.test(baseHref)) {\n+    const [, pathname] = baseHref.split(/\\/\\/[^\\/]+/);\n+    return pathname;\n+  }\n+  return baseHref;\n+}\n\n---\n file path A: packages/common/test/location/location_spec.ts | file path B: packages/common/test/location/location_spec.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {CommonModule, Location, LocationStrategy, PathLocationStrategy, PlatformLocation} from '@angular/common';\n+import {APP_BASE_HREF, CommonModule, Location, LocationStrategy, PathLocationStrategy, PlatformLocation} from '@angular/common';\n import {MockLocationStrategy, MockPlatformLocation} from '@angular/common/testing';\n import {TestBed} from '@angular/core/testing';\n \n@@ -55,7 +55,7 @@ describe('Location Class', () => {\n               return new MockPlatformLocation();\n             }\n           },\n-          {provide: Location, useClass: Location, deps: [LocationStrategy, PlatformLocation]},\n+          {provide: Location, useClass: Location, deps: [LocationStrategy]},\n         ]\n       });\n \n@@ -147,7 +147,7 @@ describe('Location Class', () => {\n               return new MockPlatformLocation();\n             }\n           },\n-          {provide: Location, useClass: Location, deps: [LocationStrategy, PlatformLocation]},\n+          {provide: Location, useClass: Location, deps: [LocationStrategy]},\n         ]\n       });\n \n@@ -215,4 +215,55 @@ describe('Location Class', () => {\n       expect(notificationCount).toBe(1);\n     });\n   });\n+\n+  describe('location.normalize(url) should return only route', () => {\n+    const basePath = '/en';\n+    const route = '/go/to/there';\n+    const url = basePath + route;\n+    const getBaseHref = (origin: string) => origin + basePath + '/';\n+\n+    it('in case APP_BASE_HREF starts with http:', () => {\n+      const origin = 'http://example.com';\n+      const baseHref = getBaseHref(origin);\n+\n+      TestBed.configureTestingModule({providers: [{provide: APP_BASE_HREF, useValue: baseHref}]});\n+\n+      const location = TestBed.inject(Location);\n+\n+      expect(location.normalize(url)).toBe(route);\n+    });\n+\n+    it('in case APP_BASE_HREF starts with https:', () => {\n+      const origin = 'https://example.com';\n+      const baseHref = getBaseHref(origin);\n+\n+      TestBed.configureTestingModule({providers: [{provide: APP_BASE_HREF, useValue: baseHref}]});\n+\n+      const location = TestBed.inject(Location);\n+\n+      expect(location.normalize(url)).toBe(route);\n+    });\n+\n+    it('in case APP_BASE_HREF starts with no protocol', () => {\n+      const origin = '//example.com';\n+      const baseHref = getBaseHref(origin);\n+\n+      TestBed.configureTestingModule({providers: [{provide: APP_BASE_HREF, useValue: baseHref}]});\n+\n+      const location = TestBed.inject(Location);\n+\n+      expect(location.normalize(url)).toBe(route);\n+    });\n+\n+    it('in case APP_BASE_HREF starts with no origin', () => {\n+      const origin = '';\n+      const baseHref = getBaseHref(origin);\n+\n+      TestBed.configureTestingModule({providers: [{provide: APP_BASE_HREF, useValue: baseHref}]});\n+\n+      const location = TestBed.inject(Location);\n+\n+      expect(location.normalize(url)).toBe(route);\n+    });\n+  });\n });\n\n---\n file path A: packages/common/testing/src/location_mock.ts | file path B: packages/common/testing/src/location_mock.ts\n\n@@ -25,7 +25,7 @@ export class SpyLocation implements Location {\n   /** @internal */\n   _subject: EventEmitter<any> = new EventEmitter();\n   /** @internal */\n-  _baseHref: string = '';\n+  _basePath: string = '';\n   /** @internal */\n   _locationStrategy: LocationStrategy = null!;\n   /** @internal */\n@@ -43,7 +43,7 @@ export class SpyLocation implements Location {\n   }\n \n   setBaseHref(url: string) {\n-    this._baseHref = url;\n+    this._basePath = url;\n   }\n \n   path(): string {\n@@ -81,7 +81,7 @@ export class SpyLocation implements Location {\n     if (url.length > 0 && !url.startsWith('/')) {\n       url = '/' + url;\n     }\n-    return this._baseHref + url;\n+    return this._basePath + url;\n   }\n \n   go(path: string, query: string = '', state: any = null) {\n\n\n###\n\n", "completion": "fix(common): Update `Location` to support base href containing `origin` (#<issue-num>)"}
{"prompt": " file path A: packages/compiler/src/render3/view/template.ts | file path B: packages/compiler/src/render3/view/template.ts\n\n@@ -1393,7 +1393,7 @@ export class TemplateDefinitionBuilder implements t.Visitor<void>, LocalResolver\n       return o.TYPED_NULL_EXPR;\n     }\n \n-    const refsParam = flatten(references.map(reference => {\n+    const refsParam = references.flatMap(reference => {\n       const slot = this.allocateDataSlot();\n       // Generate the update temporary.\n       const variableName = this._bindingScope.freshReferenceName();\n@@ -1410,8 +1410,9 @@ export class TemplateDefinitionBuilder implements t.Visitor<void>, LocalResolver\n             const refExpr = lhs.set(o.importExpr(R3.reference).callFn([o.literal(slot)]));\n             return nextContextStmt.concat(refExpr.toConstDecl());\n           }, true);\n+\n       return [reference.name, reference.value];\n-    }));\n+    });\n \n     return asLiteral(refsParam);\n   }\n@@ -2360,10 +2361,3 @@ export interface ParsedTemplate {\n    */\n   commentNodes?: t.Comment[];\n }\n-\n-function flatten<T>(list: Array<T|T[]>): T[] {\n-  return list.reduce((flat: any[], item: T|T[]): T[] => {\n-    const flatItem = Array.isArray(item) ? flatten(item) : item;\n-    return (<T[]>flat).concat(flatItem);\n-  }, []);\n-}\n\n\n###\n\n", "completion": "refactor(compiler): replace `flatten` and `map` with `flatMap`. (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/scorecard.yml | file path B: .github/workflows/scorecard.yml\n\n@@ -47,6 +47,6 @@ jobs:\n \n       # Upload the results to GitHub's code scanning dashboard.\n       - name: 'Upload to code-scanning'\n-        uses: github/codeql-action/upload-sarif@312e093a1892bd801f026f1090904ee8e460b9b6 # tag=v2.1.34\n+        uses: github/codeql-action/upload-sarif@b2a92eb56d8cb930006a1c6ed86b0782dd8a4297 # tag=v2.1.35\n         with:\n           sarif_file: results.sarif\n\n\n###\n\n", "completion": "build: update github/codeql-action action to v2.1.35 (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/render3/instructions/shared.ts | file path B: packages/core/src/render3/instructions/shared.ts\n\n@@ -1142,6 +1142,16 @@ function instantiateAllDirectives(\n     tView: TView, lView: LView, tNode: TDirectiveHostNode, native: RNode) {\n   const start = tNode.directiveStart;\n   const end = tNode.directiveEnd;\n+\n+  // The component view needs to be created before creating the node injector\n+  // since it is used to inject some special symbols like `ChangeDetectorRef`.\n+  if (isComponentHost(tNode)) {\n+    ngDevMode && assertTNodeType(tNode, TNodeType.AnyRNode);\n+    addComponentLogic(\n+        lView, tNode as TElementNode,\n+        tView.data[start + tNode.componentOffset] as ComponentDef<unknown>);\n+  }\n+\n   if (!tView.firstCreatePass) {\n     getOrCreateNodeInjectorForNode(tNode, lView);\n   }\n@@ -1151,13 +1161,6 @@ function instantiateAllDirectives(\n   const initialInputs = tNode.initialInputs;\n   for (let i = start; i < end; i++) {\n     const def = tView.data[i] as DirectiveDef<any>;\n-    const isComponent = isComponentDef(def);\n-\n-    if (isComponent) {\n-      ngDevMode && assertTNodeType(tNode, TNodeType.AnyRNode);\n-      addComponentLogic(lView, tNode as TElementNode, def as ComponentDef<any>);\n-    }\n-\n     const directive = getNodeInjectable(lView, tView, i, tNode);\n     attachPatchData(directive, lView);\n \n@@ -1165,9 +1168,9 @@ function instantiateAllDirectives(\n       setInputsFromAttrs(lView, i - start, directive, def, tNode, initialInputs!);\n     }\n \n-    if (isComponent) {\n+    if (isComponentDef(def)) {\n       const componentView = getComponentLViewByIndex(tNode.index, lView);\n-      componentView[CONTEXT] = directive;\n+      componentView[CONTEXT] = getNodeInjectable(lView, tView, i, tNode);\n     }\n   }\n }\n\n---\n file path A: packages/core/test/acceptance/host_directives_spec.ts | file path B: packages/core/test/acceptance/host_directives_spec.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {AfterViewChecked, AfterViewInit, Component, Directive, ElementRef, EventEmitter, forwardRef, inject, Inject, InjectionToken, Input, OnChanges, OnInit, Output, SimpleChanges, Type, ViewChild, ViewContainerRef} from '@angular/core';\n+import {AfterViewChecked, AfterViewInit, ChangeDetectorRef, Component, Directive, ElementRef, EventEmitter, forwardRef, inject, Inject, InjectionToken, Input, OnChanges, OnInit, Output, SimpleChanges, Type, ViewChild, ViewContainerRef} from '@angular/core';\n import {TestBed} from '@angular/core/testing';\n import {By} from '@angular/platform-browser';\n \n@@ -919,6 +919,44 @@ describe('host directives', () => {\n          expect(() => TestBed.createComponent(App))\n              .toThrowError(/NG0200: Circular dependency in DI detected for HostDir/);\n        });\n+\n+    it('should inject a valid ChangeDetectorRef when attached to a component', () => {\n+      type InternalChangeDetectorRef = ChangeDetectorRef&{_lView: unknown};\n+\n+      @Directive({standalone: true})\n+      class HostDir {\n+        changeDetectorRef = inject(ChangeDetectorRef) as InternalChangeDetectorRef;\n+      }\n+\n+      @Component({selector: 'my-comp', hostDirectives: [HostDir], template: ''})\n+      class Comp {\n+        changeDetectorRef = inject(ChangeDetectorRef) as InternalChangeDetectorRef;\n+      }\n+\n+      @Component({template: '<my-comp></my-comp>'})\n+      class App {\n+        @ViewChild(HostDir) hostDir!: HostDir;\n+        @ViewChild(Comp) comp!: Comp;\n+      }\n+\n+      TestBed.configureTestingModule({declarations: [App, Comp]});\n+      const fixture = TestBed.createComponent(App);\n+      fixture.detectChanges();\n+\n+      const hostDirectiveCdr = fixture.componentInstance.hostDir.changeDetectorRef;\n+      const componentCdr = fixture.componentInstance.comp.changeDetectorRef;\n+\n+      // We can't assert that the change detectors are the same by comparing\n+      // them directly, because a new one is created each time. Instead of we\n+      // compare that they're associated with the same LView.\n+      expect(hostDirectiveCdr._lView).toBeTruthy();\n+      expect(componentCdr._lView).toBeTruthy();\n+      expect(hostDirectiveCdr._lView).toBe(componentCdr._lView);\n+      expect(() => {\n+        hostDirectiveCdr.markForCheck();\n+        hostDirectiveCdr.detectChanges();\n+      }).not.toThrow();\n+    });\n   });\n \n   describe('outputs', () => {\n\n---\n file path A: packages/core/test/bundling/animations/bundle.golden_symbols.json | file path B: packages/core/test/bundling/animations/bundle.golden_symbols.json\n\n@@ -548,9 +548,6 @@\n   {\n     \"name\": \"addClass\"\n   },\n-  {\n-    \"name\": \"addComponentLogic\"\n-  },\n   {\n     \"name\": \"addPropertyAlias\"\n   },\n\n---\n file path A: packages/core/test/bundling/cyclic_import/bundle.golden_symbols.json | file path B: packages/core/test/bundling/cyclic_import/bundle.golden_symbols.json\n\n@@ -386,9 +386,6 @@\n   {\n     \"name\": \"_wrapInTimeout\"\n   },\n-  {\n-    \"name\": \"addComponentLogic\"\n-  },\n   {\n     \"name\": \"addPropertyAlias\"\n   },\n@@ -743,6 +740,9 @@\n   {\n     \"name\": \"isComponentDef\"\n   },\n+  {\n+    \"name\": \"isComponentHost\"\n+  },\n   {\n     \"name\": \"isContentQueryHost\"\n   },\n\n---\n file path A: packages/core/test/bundling/forms_reactive/bundle.golden_symbols.json | file path B: packages/core/test/bundling/forms_reactive/bundle.golden_symbols.json\n\n@@ -551,9 +551,6 @@\n   {\n     \"name\": \"_wrapInTimeout\"\n   },\n-  {\n-    \"name\": \"addComponentLogic\"\n-  },\n   {\n     \"name\": \"addPropertyAlias\"\n   },\n\n---\n file path A: packages/core/test/bundling/forms_template_driven/bundle.golden_symbols.json | file path B: packages/core/test/bundling/forms_template_driven/bundle.golden_symbols.json\n\n@@ -539,9 +539,6 @@\n   {\n     \"name\": \"_wrapInTimeout\"\n   },\n-  {\n-    \"name\": \"addComponentLogic\"\n-  },\n   {\n     \"name\": \"addPropertyAlias\"\n   },\n\n---\n file path A: packages/core/test/bundling/router/bundle.golden_symbols.json | file path B: packages/core/test/bundling/router/bundle.golden_symbols.json\n\n@@ -710,9 +710,6 @@\n   {\n     \"name\": \"absoluteRedirect\"\n   },\n-  {\n-    \"name\": \"addComponentLogic\"\n-  },\n   {\n     \"name\": \"addPropertyAlias\"\n   },\n\n---\n file path A: packages/core/test/bundling/todo/bundle.golden_symbols.json | file path B: packages/core/test/bundling/todo/bundle.golden_symbols.json\n\n@@ -464,9 +464,6 @@\n   {\n     \"name\": \"_wrapInTimeout\"\n   },\n-  {\n-    \"name\": \"addComponentLogic\"\n-  },\n   {\n     \"name\": \"addPropertyAlias\"\n   },\n\n\n###\n\n", "completion": "fix(core): unable to inject ChangeDetectorRef inside host directives (#<issue-num>)"}
{"prompt": " file path A: packages/forms/src/form_builder.ts | file path B: packages/forms/src/form_builder.ts\n\n@@ -9,7 +9,6 @@\n import {inject, Injectable} from '@angular/core';\n \n import {AsyncValidatorFn, ValidatorFn} from './directives/validators';\n-import {ReactiveFormsModule} from './form_providers';\n import {AbstractControl, AbstractControlOptions, FormHooks} from './model/abstract_model';\n import {FormArray, UntypedFormArray} from './model/form_array';\n import {FormControl, FormControlOptions, FormControlState, UntypedFormControl} from './model/form_control';\n@@ -107,7 +106,7 @@ export type \u0275Element<T, N extends null> =\n  *\n  * @publicApi\n  */\n-@Injectable({providedIn: ReactiveFormsModule})\n+@Injectable({providedIn: 'root'})\n export class FormBuilder {\n   private useNonNullable: boolean = false;\n \n@@ -370,7 +369,7 @@ export class FormBuilder {\n  * @publicApi\n  */\n @Injectable({\n-  providedIn: ReactiveFormsModule,\n+  providedIn: 'root',\n   useFactory: () => inject(FormBuilder).nonNullable,\n })\n export abstract class NonNullableFormBuilder {\n@@ -416,7 +415,7 @@ export abstract class NonNullableFormBuilder {\n /**\n  * UntypedFormBuilder is the same as @see FormBuilder, but it provides untyped controls.\n  */\n-@Injectable({providedIn: ReactiveFormsModule})\n+@Injectable({providedIn: 'root'})\n export class UntypedFormBuilder extends FormBuilder {\n   /**\n    * Like `FormBuilder#group`, except the resulting group is untyped.\n\n\n###\n\n", "completion": "refactor(forms): make FormBuilder classes provided in root (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/di/create_injector.ts | file path B: packages/core/src/di/create_injector.ts\n\n@@ -6,7 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {flatten} from '../util/array_utils';\n import {EMPTY_ARRAY} from '../util/empty';\n import {stringify} from '../util/stringify';\n \n\n---\n file path A: packages/core/src/util/array_utils.ts | file path B: packages/core/src/util/array_utils.ts\n\n@@ -32,27 +32,11 @@ export function arrayEquals<T>(a: T[], b: T[], identityAccessor?: (value: T) =>\n   return true;\n }\n \n-\n /**\n  * Flattens an array.\n  */\n-export function flatten(list: any[], dst?: any[]): any[] {\n-  if (dst === undefined) dst = list;\n-  for (let i = 0; i < list.length; i++) {\n-    let item = list[i];\n-    if (Array.isArray(item)) {\n-      // we need to inline it.\n-      if (dst === list) {\n-        // Our assumption that the list was already flat was wrong and\n-        // we need to clone flat since we need to write to it.\n-        dst = list.slice(0, i);\n-      }\n-      flatten(item, dst);\n-    } else if (dst !== list) {\n-      dst.push(item);\n-    }\n-  }\n-  return dst;\n+export function flatten(list: any[]): any[] {\n+  return list.flat(Number.POSITIVE_INFINITY);\n }\n \n export function deepForEach<T>(input: (T|any[])[], fn: (value: T) => void): void {\n\n---\n file path A: packages/core/test/bundling/router/bundle.golden_symbols.json | file path B: packages/core/test/bundling/router/bundle.golden_symbols.json\n\n@@ -1019,9 +1019,6 @@\n   {\n     \"name\": \"first\"\n   },\n-  {\n-    \"name\": \"flatten\"\n-  },\n   {\n     \"name\": \"flatten2\"\n   },\n\n\n###\n\n", "completion": "refactor(core): simplify array flatten logic (#<issue-num>)"}
{"prompt": " file path A: packages/compiler/src/i18n/digest.ts | file path B: packages/compiler/src/i18n/digest.ts\n\n@@ -152,7 +152,18 @@ export function sha1(str: string): string {\n     e = add32(e, h4);\n   }\n \n-  return bytesToHexString(words32ToByteString([a, b, c, d, e]));\n+  // Convert the output parts to a 160-bit hexadecimal string\n+  return toHexU32(a) + toHexU32(b) + toHexU32(c) + toHexU32(d) + toHexU32(e);\n+}\n+\n+/**\n+ * Convert and format a number as a string representing a 32-bit unsigned hexadecimal number.\n+ * @param value The value to format as a string.\n+ * @returns A hexadecimal string representing the value.\n+ */\n+function toHexU32(value: number): string {\n+  // unsigned right shift of zero ensures an unsigned 32-bit number\n+  return (value >>> 0).toString(16).padStart(8, '0');\n }\n \n function fk(index: number, b: number, c: number, d: number): [number, number] {\n@@ -357,27 +368,6 @@ function wordAt(bytes: Byte[], index: number, endian: Endian): number {\n   return word;\n }\n \n-function words32ToByteString(words32: number[]): Byte[] {\n-  return words32.reduce((bytes, word) => bytes.concat(word32ToByteString(word)), [] as Byte[]);\n-}\n-\n-function word32ToByteString(word: number): Byte[] {\n-  let bytes: Byte[] = [];\n-  for (let i = 0; i < 4; i++) {\n-    bytes.push((word >>> 8 * (3 - i)) & 0xff);\n-  }\n-  return bytes;\n-}\n-\n-function bytesToHexString(bytes: Byte[]): string {\n-  let hex: string = '';\n-  for (let i = 0; i < bytes.length; i++) {\n-    const b = byteAt(bytes, i);\n-    hex += (b >>> 4).toString(16) + (b & 0x0f).toString(16);\n-  }\n-  return hex.toLowerCase();\n-}\n-\n /**\n  * Create a shared exponentiation pool for base-256 computations. This shared pool provides memoized\n  * power-of-256 results with memoized power-of-two computations for efficient multiplication.\n\n\n###\n\n", "completion": "refactor(compiler): reduce complexity for legacy i18n digest string output (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/marketing-first-app/package-lock.json | file path B: aio/content/examples/marketing-first-app/package-lock.json\n\n@@ -26,7 +26,7 @@\n         \"@types/node\": \"^12.11.1\",\n         \"codelyzer\": \"^6.0.0\",\n         \"jasmine-core\": \"~4.5.0\",\n-        \"jasmine-spec-reporter\": \"~5.0.0\",\n+        \"jasmine-spec-reporter\": \"~7.0.0\",\n         \"karma\": \"~6.4.1\",\n         \"karma-chrome-launcher\": \"~3.1.0\",\n         \"karma-coverage\": \"~2.2.0\",\n@@ -7243,9 +7243,9 @@\n       \"dev\": true\n     },\n     \"node_modules/jasmine-spec-reporter\": {\n-      \"version\": \"5.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/jasmine-spec-reporter/-/jasmine-spec-reporter-5.0.2.tgz\",\n-      \"integrity\": \"sha512-6gP1LbVgJ+d7PKksQBc2H0oDGNRQI3gKUsWlswKaQ2fif9X5gzhQcgM5+kiJGCQVurOG09jqNhk7payggyp5+g==\",\n+      \"version\": \"7.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/jasmine-spec-reporter/-/jasmine-spec-reporter-7.0.0.tgz\",\n+      \"integrity\": \"sha512-OtC7JRasiTcjsaCBPtMO0Tl8glCejM4J4/dNuOJdA8lBjz4PmWjYQ6pzb0uzpBNAWJMDudYuj9OdXJWqM2QTJg==\",\n       \"dev\": true,\n       \"dependencies\": {\n         \"colors\": \"1.4.0\"\n@@ -18266,9 +18266,9 @@\n       \"dev\": true\n     },\n     \"jasmine-spec-reporter\": {\n-      \"version\": \"5.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/jasmine-spec-reporter/-/jasmine-spec-reporter-5.0.2.tgz\",\n-      \"integrity\": \"sha512-6gP1LbVgJ+d7PKksQBc2H0oDGNRQI3gKUsWlswKaQ2fif9X5gzhQcgM5+kiJGCQVurOG09jqNhk7payggyp5+g==\",\n+      \"version\": \"7.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/jasmine-spec-reporter/-/jasmine-spec-reporter-7.0.0.tgz\",\n+      \"integrity\": \"sha512-OtC7JRasiTcjsaCBPtMO0Tl8glCejM4J4/dNuOJdA8lBjz4PmWjYQ6pzb0uzpBNAWJMDudYuj9OdXJWqM2QTJg==\",\n       \"dev\": true,\n       \"requires\": {\n         \"colors\": \"1.4.0\"\n\n---\n file path A: aio/content/examples/marketing-first-app/package.json | file path B: aio/content/examples/marketing-first-app/package.json\n\n@@ -29,7 +29,7 @@\n     \"@types/node\": \"^12.11.1\",\n     \"codelyzer\": \"^6.0.0\",\n     \"jasmine-core\": \"~4.5.0\",\n-    \"jasmine-spec-reporter\": \"~5.0.0\",\n+    \"jasmine-spec-reporter\": \"~7.0.0\",\n     \"karma\": \"~6.4.1\",\n     \"karma-chrome-launcher\": \"~3.1.0\",\n     \"karma-coverage\": \"~2.2.0\",\n\n\n###\n\n", "completion": "build: update dependency jasmine-spec-reporter to v7 (#<issue-num>)"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -51,9 +51,9 @@ http_archive(\n # Fetch Aspect lib for utilities like write_source_files\n http_archive(\n     name = \"aspect_bazel_lib\",\n-    sha256 = \"dee6d20f7c250a3808d601044ea187e41369a544f53f440b3bdafe0a7f53e553\",\n-    strip_prefix = \"bazel-lib-1.17.0\",\n-    url = \"https://github.com/aspect-build/bazel-lib/archive/refs/tags/v1.17.0.tar.gz\",\n+    sha256 = \"be236556c7b9c7b91cb370e837fdcec62b6e8893408cd4465ae883c9d7c67024\",\n+    strip_prefix = \"bazel-lib-1.18.0\",\n+    url = \"https://github.com/aspect-build/bazel-lib/archive/refs/tags/v1.18.0.tar.gz\",\n )\n \n # Download cli source from angular/cli-builds for doc generation at a specific tag or commit.\n\n---\n file path A: aio/content/examples/marketing-first-app/package-lock.json | file path B: aio/content/examples/marketing-first-app/package-lock.json\n\n@@ -16,7 +16,7 @@\n         \"@angular/platform-browser-dynamic\": \"15.0.1\",\n         \"rxjs\": \"^7.5.2\",\n         \"tslib\": \"^2.3.1\",\n-        \"zone.js\": \"^0.11.4\"\n+        \"zone.js\": \"^0.12.0\"\n       },\n       \"devDependencies\": {\n         \"@angular-devkit/build-angular\": \"~15.0.1\",\n@@ -29,7 +29,7 @@\n         \"jasmine-spec-reporter\": \"~5.0.0\",\n         \"karma\": \"~6.4.1\",\n         \"karma-chrome-launcher\": \"~3.1.0\",\n-        \"karma-coverage\": \"~2.0.3\",\n+        \"karma-coverage\": \"~2.2.0\",\n         \"karma-jasmine\": \"~5.1.0\",\n         \"karma-jasmine-html-reporter\": \"^2.0.0\",\n         \"protractor\": \"~7.0.0\",\n@@ -7548,16 +7548,16 @@\n       }\n     },\n     \"node_modules/karma-coverage\": {\n-      \"version\": \"2.0.3\",\n-      \"resolved\": \"https://registry.npmjs.org/karma-coverage/-/karma-coverage-2.0.3.tgz\",\n-      \"integrity\": \"sha512-atDvLQqvPcLxhED0cmXYdsPMCQuh6Asa9FMZW1bhNqlVEhJoB9qyZ2BY1gu7D/rr5GLGb5QzYO4siQskxaWP/g==\",\n+      \"version\": \"2.2.0\",\n+      \"resolved\": \"https://registry.npmjs.org/karma-coverage/-/karma-coverage-2.2.0.tgz\",\n+      \"integrity\": \"sha512-gPVdoZBNDZ08UCzdMHHhEImKrw1+PAOQOIiffv1YsvxFhBjqvo/SVXNk4tqn1SYqX0BJZT6S/59zgxiBe+9OuA==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"istanbul-lib-coverage\": \"^3.0.0\",\n-        \"istanbul-lib-instrument\": \"^4.0.1\",\n+        \"istanbul-lib-coverage\": \"^3.2.0\",\n+        \"istanbul-lib-instrument\": \"^5.1.0\",\n         \"istanbul-lib-report\": \"^3.0.0\",\n-        \"istanbul-lib-source-maps\": \"^4.0.0\",\n-        \"istanbul-reports\": \"^3.0.0\",\n+        \"istanbul-lib-source-maps\": \"^4.0.1\",\n+        \"istanbul-reports\": \"^3.0.5\",\n         \"minimatch\": \"^3.0.4\"\n       },\n       \"engines\": {\n@@ -7574,21 +7574,6 @@\n         \"concat-map\": \"0.0.1\"\n       }\n     },\n-    \"node_modules/karma-coverage/node_modules/istanbul-lib-instrument\": {\n-      \"version\": \"4.0.3\",\n-      \"resolved\": \"https://registry.npmjs.org/istanbul-lib-instrument/-/istanbul-lib-instrument-4.0.3.tgz\",\n-      \"integrity\": \"sha512-BXgQl9kf4WTCPCCpmFGoJkz/+uhvm7h7PFKUYxh7qarQd3ER33vHG//qaE8eN25l07YqZPpHXU9I09l/RD5aGQ==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"@babel/core\": \"^7.7.5\",\n-        \"@istanbuljs/schema\": \"^0.1.2\",\n-        \"istanbul-lib-coverage\": \"^3.0.0\",\n-        \"semver\": \"^6.3.0\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n     \"node_modules/karma-coverage/node_modules/minimatch\": {\n       \"version\": \"3.1.2\",\n       \"resolved\": \"https://registry.npmjs.org/minimatch/-/minimatch-3.1.2.tgz\",\n@@ -7601,15 +7586,6 @@\n         \"node\": \"*\"\n       }\n     },\n-    \"node_modules/karma-coverage/node_modules/semver\": {\n-      \"version\": \"6.3.0\",\n-      \"resolved\": \"https://registry.npmjs.org/semver/-/semver-6.3.0.tgz\",\n-      \"integrity\": \"sha512-b39TBaTSfV6yBrapU89p5fKekE2m/NwnDocOVruQFS1/veMgdzuPcnOM34M6CwxW8jH/lxEa5rBoDeUwu5HHTw==\",\n-      \"dev\": true,\n-      \"bin\": {\n-        \"semver\": \"bin/semver.js\"\n-      }\n-    },\n     \"node_modules/karma-jasmine\": {\n       \"version\": \"5.1.0\",\n       \"resolved\": \"https://registry.npmjs.org/karma-jasmine/-/karma-jasmine-5.1.0.tgz\",\n@@ -10614,9 +10590,9 @@\n       }\n     },\n     \"node_modules/rxjs\": {\n-      \"version\": \"7.5.7\",\n-      \"resolved\": \"https://registry.npmjs.org/rxjs/-/rxjs-7.5.7.tgz\",\n-      \"integrity\": \"sha512-z9MzKh/UcOqB3i20H6rtrlaE/CgjLOvheWK/9ILrbhROGTweAi1BaFsTT9FbwZi5Trr1qNRs+MXkhmR06awzQA==\",\n+      \"version\": \"7.6.0\",\n+      \"resolved\": \"https://registry.npmjs.org/rxjs/-/rxjs-7.6.0.tgz\",\n+      \"integrity\": \"sha512-DDa7d8TFNUalGC9VqXvQ1euWNN7sc63TrUCuM9J998+ViviahMIjKSOU7rfcgFOF+FCD71BhDRv4hrFz+ImDLQ==\",\n       \"dependencies\": {\n         \"tslib\": \"^2.1.0\"\n       }\n@@ -12889,9 +12865,9 @@\n       }\n     },\n     \"node_modules/zone.js\": {\n-      \"version\": \"0.11.8\",\n-      \"resolved\": \"https://registry.npmjs.org/zone.js/-/zone.js-0.11.8.tgz\",\n-      \"integrity\": \"sha512-82bctBg2hKcEJ21humWIkXRlLBBmrc3nN7DFh5LGGhcyycO2S7FN8NmdvlcKaGFDNVL4/9kFLmwmInTavdJERA==\",\n+      \"version\": \"0.12.0\",\n+      \"resolved\": \"https://registry.npmjs.org/zone.js/-/zone.js-0.12.0.tgz\",\n+      \"integrity\": \"sha512-XtC+I5dXU14HrzidAKBNMqneIVUykLEAA1x+v4KVrd6AUPWlwYORF8KgsVqvgdHiKZ4BkxxjvYi/ksEixTPR0Q==\",\n       \"dependencies\": {\n         \"tslib\": \"^2.3.0\"\n       }\n@@ -18591,16 +18567,16 @@\n       }\n     },\n     \"karma-coverage\": {\n-      \"version\": \"2.0.3\",\n-      \"resolved\": \"https://registry.npmjs.org/karma-coverage/-/karma-coverage-2.0.3.tgz\",\n-      \"integrity\": \"sha512-atDvLQqvPcLxhED0cmXYdsPMCQuh6Asa9FMZW1bhNqlVEhJoB9qyZ2BY1gu7D/rr5GLGb5QzYO4siQskxaWP/g==\",\n+      \"version\": \"2.2.0\",\n+      \"resolved\": \"https://registry.npmjs.org/karma-coverage/-/karma-coverage-2.2.0.tgz\",\n+      \"integrity\": \"sha512-gPVdoZBNDZ08UCzdMHHhEImKrw1+PAOQOIiffv1YsvxFhBjqvo/SVXNk4tqn1SYqX0BJZT6S/59zgxiBe+9OuA==\",\n       \"dev\": true,\n       \"requires\": {\n-        \"istanbul-lib-coverage\": \"^3.0.0\",\n-        \"istanbul-lib-instrument\": \"^4.0.1\",\n+        \"istanbul-lib-coverage\": \"^3.2.0\",\n+        \"istanbul-lib-instrument\": \"^5.1.0\",\n         \"istanbul-lib-report\": \"^3.0.0\",\n-        \"istanbul-lib-source-maps\": \"^4.0.0\",\n-        \"istanbul-reports\": \"^3.0.0\",\n+        \"istanbul-lib-source-maps\": \"^4.0.1\",\n+        \"istanbul-reports\": \"^3.0.5\",\n         \"minimatch\": \"^3.0.4\"\n       },\n       \"dependencies\": {\n@@ -18614,18 +18590,6 @@\n             \"concat-map\": \"0.0.1\"\n           }\n         },\n-        \"istanbul-lib-instrument\": {\n-          \"version\": \"4.0.3\",\n-          \"resolved\": \"https://registry.npmjs.org/istanbul-lib-instrument/-/istanbul-lib-instrument-4.0.3.tgz\",\n-          \"integrity\": \"sha512-BXgQl9kf4WTCPCCpmFGoJkz/+uhvm7h7PFKUYxh7qarQd3ER33vHG//qaE8eN25l07YqZPpHXU9I09l/RD5aGQ==\",\n-          \"dev\": true,\n-          \"requires\": {\n-            \"@babel/core\": \"^7.7.5\",\n-            \"@istanbuljs/schema\": \"^0.1.2\",\n-            \"istanbul-lib-coverage\": \"^3.0.0\",\n-            \"semver\": \"^6.3.0\"\n-          }\n-        },\n         \"minimatch\": {\n           \"version\": \"3.1.2\",\n           \"resolved\": \"https://registry.npmjs.org/minimatch/-/minimatch-3.1.2.tgz\",\n@@ -18634,12 +18598,6 @@\n           \"requires\": {\n             \"brace-expansion\": \"^1.1.7\"\n           }\n-        },\n-        \"semver\": {\n-          \"version\": \"6.3.0\",\n-          \"resolved\": \"https://registry.npmjs.org/semver/-/semver-6.3.0.tgz\",\n-          \"integrity\": \"sha512-b39TBaTSfV6yBrapU89p5fKekE2m/NwnDocOVruQFS1/veMgdzuPcnOM34M6CwxW8jH/lxEa5rBoDeUwu5HHTw==\",\n-          \"dev\": true\n         }\n       }\n     },\n@@ -20827,9 +20785,9 @@\n       }\n     },\n     \"rxjs\": {\n-      \"version\": \"7.5.7\",\n-      \"resolved\": \"https://registry.npmjs.org/rxjs/-/rxjs-7.5.7.tgz\",\n-      \"integrity\": \"sha512-z9MzKh/UcOqB3i20H6rtrlaE/CgjLOvheWK/9ILrbhROGTweAi1BaFsTT9FbwZi5Trr1qNRs+MXkhmR06awzQA==\",\n+      \"version\": \"7.6.0\",\n+      \"resolved\": \"https://registry.npmjs.org/rxjs/-/rxjs-7.6.0.tgz\",\n+      \"integrity\": \"sha512-DDa7d8TFNUalGC9VqXvQ1euWNN7sc63TrUCuM9J998+ViviahMIjKSOU7rfcgFOF+FCD71BhDRv4hrFz+ImDLQ==\",\n       \"requires\": {\n         \"tslib\": \"^2.1.0\"\n       }\n@@ -22507,9 +22465,9 @@\n       \"dev\": true\n     },\n     \"zone.js\": {\n-      \"version\": \"0.11.8\",\n-      \"resolved\": \"https://registry.npmjs.org/zone.js/-/zone.js-0.11.8.tgz\",\n-      \"integrity\": \"sha512-82bctBg2hKcEJ21humWIkXRlLBBmrc3nN7DFh5LGGhcyycO2S7FN8NmdvlcKaGFDNVL4/9kFLmwmInTavdJERA==\",\n+      \"version\": \"0.12.0\",\n+      \"resolved\": \"https://registry.npmjs.org/zone.js/-/zone.js-0.12.0.tgz\",\n+      \"integrity\": \"sha512-XtC+I5dXU14HrzidAKBNMqneIVUykLEAA1x+v4KVrd6AUPWlwYORF8KgsVqvgdHiKZ4BkxxjvYi/ksEixTPR0Q==\",\n       \"requires\": {\n         \"tslib\": \"^2.3.0\"\n       }\n\n---\n file path A: aio/content/examples/marketing-first-app/package.json | file path B: aio/content/examples/marketing-first-app/package.json\n\n@@ -11,7 +11,7 @@\n     \"@angular/platform-browser-dynamic\": \"15.0.1\",\n     \"rxjs\": \"^7.5.2\",\n     \"tslib\": \"^2.3.1\",\n-    \"zone.js\": \"^0.11.4\"\n+    \"zone.js\": \"^0.12.0\"\n   },\n   \"scripts\": {\n     \"ng\": \"ng\",\n@@ -32,7 +32,7 @@\n     \"jasmine-spec-reporter\": \"~5.0.0\",\n     \"karma\": \"~6.4.1\",\n     \"karma-chrome-launcher\": \"~3.1.0\",\n-    \"karma-coverage\": \"~2.0.3\",\n+    \"karma-coverage\": \"~2.2.0\",\n     \"karma-jasmine\": \"~5.1.0\",\n     \"karma-jasmine-html-reporter\": \"^2.0.0\",\n     \"protractor\": \"~7.0.0\",\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -74,7 +74,7 @@\n     \"@angular/platform-browser-dynamic\": \"15.0.1\",\n     \"@angular/router\": \"15.0.1\",\n     \"@angular/service-worker\": \"15.0.1\",\n-    \"rxjs\": \"~7.5.0\",\n+    \"rxjs\": \"~7.6.0\",\n     \"safevalues\": \"^0.4.2\",\n     \"tslib\": \"^2.3.0\",\n     \"zone.js\": \"~0.12.0\"\n\n---\n file path A: aio/tools/examples/shared/boilerplate/cli-ajs/package.json | file path B: aio/tools/examples/shared/boilerplate/cli-ajs/package.json\n\n@@ -24,7 +24,7 @@\n     \"angular\": \"^1.8.3\",\n     \"angular-in-memory-web-api\": \"~0.15.0\",\n     \"angular-route\": \"1.8.3\",\n-    \"rxjs\": \"~7.5.0\",\n+    \"rxjs\": \"~7.6.0\",\n     \"tslib\": \"^2.3.0\",\n     \"zone.js\": \"~0.12.0\"\n   },\n\n---\n file path A: aio/tools/examples/shared/boilerplate/cli/package.json | file path B: aio/tools/examples/shared/boilerplate/cli/package.json\n\n@@ -22,7 +22,7 @@\n     \"@angular/platform-browser-dynamic\": \"^15.0.0-rc.1\",\n     \"@angular/router\": \"^15.0.0-rc.1\",\n     \"angular-in-memory-web-api\": \"~0.15.0\",\n-    \"rxjs\": \"~7.5.0\",\n+    \"rxjs\": \"~7.6.0\",\n     \"tslib\": \"^2.3.0\",\n     \"zone.js\": \"~0.12.0\"\n   },\n\n---\n file path A: aio/tools/examples/shared/boilerplate/elements/package.json | file path B: aio/tools/examples/shared/boilerplate/elements/package.json\n\n@@ -23,7 +23,7 @@\n     \"@angular/platform-browser-dynamic\": \"^15.0.0-rc.1\",\n     \"@angular/router\": \"^15.0.0-rc.1\",\n     \"angular-in-memory-web-api\": \"~0.15.0\",\n-    \"rxjs\": \"~7.5.0\",\n+    \"rxjs\": \"~7.6.0\",\n     \"tslib\": \"^2.3.0\",\n     \"zone.js\": \"~0.12.0\"\n   },\n\n---\n file path A: aio/tools/examples/shared/boilerplate/i18n/package.json | file path B: aio/tools/examples/shared/boilerplate/i18n/package.json\n\n@@ -25,7 +25,7 @@\n     \"@angular/platform-browser-dynamic\": \"^15.0.0-rc.1\",\n     \"@angular/router\": \"^15.0.0-rc.1\",\n     \"angular-in-memory-web-api\": \"~0.15.0\",\n-    \"rxjs\": \"~7.5.0\",\n+    \"rxjs\": \"~7.6.0\",\n     \"tslib\": \"^2.3.0\",\n     \"zone.js\": \"~0.12.0\"\n   },\n\n---\n file path A: aio/tools/examples/shared/boilerplate/service-worker/package.json | file path B: aio/tools/examples/shared/boilerplate/service-worker/package.json\n\n@@ -23,7 +23,7 @@\n     \"@angular/router\": \"^15.0.0-rc.1\",\n     \"@angular/service-worker\": \"^15.0.0-rc.1\",\n     \"angular-in-memory-web-api\": \"~0.15.0\",\n-    \"rxjs\": \"~7.5.0\",\n+    \"rxjs\": \"~7.6.0\",\n     \"tslib\": \"^2.3.0\",\n     \"zone.js\": \"~0.12.0\"\n   },\n\n---\n file path A: aio/tools/examples/shared/boilerplate/systemjs/package.json | file path B: aio/tools/examples/shared/boilerplate/systemjs/package.json\n\n@@ -35,7 +35,7 @@\n     \"@angular/router\": \"^15.0.0-rc.1\",\n     \"@angular/upgrade\": \"^15.0.0-rc.1\",\n     \"core-js\": \"^2.5.4\",\n-    \"rxjs\": \"~7.5.0\",\n+    \"rxjs\": \"~7.6.0\",\n     \"systemjs\": \"~0.19.39\",\n     \"systemjs-plugin-babel\": \"~0.0.25\",\n     \"tslib\": \"^2.3.0\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/universal/package.json | file path B: aio/tools/examples/shared/boilerplate/universal/package.json\n\n@@ -29,7 +29,7 @@\n     \"@nguniversal/express-engine\": \"^15.0.0-next.0\",\n     \"angular-in-memory-web-api\": \"~0.15.0\",\n     \"express\": \"^4.18.1\",\n-    \"rxjs\": \"~7.5.0\",\n+    \"rxjs\": \"~7.6.0\",\n     \"tslib\": \"^2.3.0\",\n     \"zone.js\": \"~0.12.0\"\n   },\n\n---\n file path A: aio/tools/examples/shared/package.json | file path B: aio/tools/examples/shared/package.json\n\n@@ -39,7 +39,7 @@\n     \"angular-route\": \"1.8.3\",\n     \"core-js\": \"^2.5.4\",\n     \"express\": \"^4.18.1\",\n-    \"rxjs\": \"~7.5.0\",\n+    \"rxjs\": \"~7.6.0\",\n     \"systemjs\": \"~0.19.39\",\n     \"systemjs-plugin-babel\": \"~0.0.25\",\n     \"tslib\": \"^2.3.0\",\n\n---\n file path A: aio/tools/examples/shared/yarn.lock | file path B: aio/tools/examples/shared/yarn.lock\n\n@@ -7204,13 +7204,20 @@ rxjs@^5.5.6:\n   dependencies:\n     symbol-observable \"1.0.1\"\n \n-rxjs@^7.0.0, rxjs@^7.5.5, rxjs@~7.5.0:\n+rxjs@^7.0.0, rxjs@^7.5.5:\n   version \"7.5.6\"\n   resolved \"https://registry.yarnpkg.com/rxjs/-/rxjs-7.5.6.tgz#0446577557862afd6903517ce7cae79ecb9662bc\"\n   integrity sha512-dnyv2/YsXhnm461G+R/Pe5bWP41Nm6LBXEYWI6eiFP4fiwx6WRI/CD0zbdVAudd9xwLEF2IDcKXLHit0FYjUzw==\n   dependencies:\n     tslib \"^2.1.0\"\n \n+rxjs@~7.6.0:\n+  version \"7.6.0\"\n+  resolved \"https://registry.yarnpkg.com/rxjs/-/rxjs-7.6.0.tgz#361da5362b6ddaa691a2de0b4f2d32028f1eb5a2\"\n+  integrity sha512-DDa7d8TFNUalGC9VqXvQ1euWNN7sc63TrUCuM9J998+ViviahMIjKSOU7rfcgFOF+FCD71BhDRv4hrFz+ImDLQ==\n+  dependencies:\n+    tslib \"^2.1.0\"\n+\n safe-buffer@5.1.2, safe-buffer@~5.1.0, safe-buffer@~5.1.1:\n   version \"5.1.2\"\n   resolved \"https://registry.yarnpkg.com/safe-buffer/-/safe-buffer-5.1.2.tgz#991ec69d296e0313747d59bdfd2b745c35f8828d\"\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -12342,13 +12342,20 @@ rxjs@^5.5.6:\n   dependencies:\n     symbol-observable \"1.0.1\"\n \n-rxjs@^7.5.5, rxjs@~7.5.0:\n+rxjs@^7.5.5:\n   version \"7.5.7\"\n   resolved \"https://registry.yarnpkg.com/rxjs/-/rxjs-7.5.7.tgz#2ec0d57fdc89ece220d2e702730ae8f1e49def39\"\n   integrity sha512-z9MzKh/UcOqB3i20H6rtrlaE/CgjLOvheWK/9ILrbhROGTweAi1BaFsTT9FbwZi5Trr1qNRs+MXkhmR06awzQA==\n   dependencies:\n     tslib \"^2.1.0\"\n \n+rxjs@~7.6.0:\n+  version \"7.6.0\"\n+  resolved \"https://registry.yarnpkg.com/rxjs/-/rxjs-7.6.0.tgz#361da5362b6ddaa691a2de0b4f2d32028f1eb5a2\"\n+  integrity sha512-DDa7d8TFNUalGC9VqXvQ1euWNN7sc63TrUCuM9J998+ViviahMIjKSOU7rfcgFOF+FCD71BhDRv4hrFz+ImDLQ==\n+  dependencies:\n+    tslib \"^2.1.0\"\n+\n safe-buffer@5.1.2, safe-buffer@~5.1.0, safe-buffer@~5.1.1:\n   version \"5.1.2\"\n   resolved \"https://registry.yarnpkg.com/safe-buffer/-/safe-buffer-5.1.2.tgz#991ec69d296e0313747d59bdfd2b745c35f8828d\"\n\n---\n file path A: package.json | file path B: package.json\n\n@@ -144,7 +144,7 @@\n     \"karma-jasmine\": \"^5.0.0\",\n     \"karma-requirejs\": \"^1.1.0\",\n     \"karma-sourcemap-loader\": \"^0.3.7\",\n-    \"magic-string\": \"0.26.7\",\n+    \"magic-string\": \"0.27.0\",\n     \"materialize-css\": \"1.0.0\",\n     \"memo-decorator\": \"^2.0.1\",\n     \"ngx-flamegraph\": \"0.0.11\",\n\n---\n file path A: packages/compiler-cli/package.json | file path B: packages/compiler-cli/package.json\n\n@@ -58,7 +58,7 @@\n     \"chokidar\": \"^3.0.0\",\n     \"convert-source-map\": \"^1.5.1\",\n     \"dependency-graph\": \"^0.11.0\",\n-    \"magic-string\": \"^0.26.0\",\n+    \"magic-string\": \"^0.27.0\",\n     \"semver\": \"^7.0.0\",\n     \"sourcemap-codec\": \"^1.4.8\",\n     \"tslib\": \"^2.3.0\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -2604,7 +2604,7 @@\n     \"@jridgewell/gen-mapping\" \"^0.3.0\"\n     \"@jridgewell/trace-mapping\" \"^0.3.9\"\n \n-\"@jridgewell/sourcemap-codec@^1.4.10\":\n+\"@jridgewell/sourcemap-codec@^1.4.10\", \"@jridgewell/sourcemap-codec@^1.4.13\":\n   version \"1.4.14\"\n   resolved \"https://registry.yarnpkg.com/@jridgewell/sourcemap-codec/-/sourcemap-codec-1.4.14.tgz#add4c98d341472a289190b424efbdb096991bb24\"\n   integrity sha512-XPSJHWmi394fuUuzDnGz1wiKqWfo1yXecHQMRf2l6hztTO+nPru658AyDngaBe7isIxEkRsPR3FZh+s7iVa4Uw==\n@@ -11986,6 +11986,13 @@ magic-string@0.26.7, magic-string@^0.26.4:\n   dependencies:\n     sourcemap-codec \"^1.4.8\"\n \n+magic-string@0.27.0:\n+  version \"0.27.0\"\n+  resolved \"https://registry.yarnpkg.com/magic-string/-/magic-string-0.27.0.tgz#e4a3413b4bab6d98d2becffd48b4a257effdbbf3\"\n+  integrity sha512-8UnnX2PeRAPZuN12svgR9j7M1uWMovg/CEnIwIG0LFkXSJJe4PdfUGiTGl8V9bsBHFUtfVINcSyYxd7q+kx9fA==\n+  dependencies:\n+    \"@jridgewell/sourcemap-codec\" \"^1.4.13\"\n+\n magic-string@^0.25.7:\n   version \"0.25.9\"\n   resolved \"https://registry.yarnpkg.com/magic-string/-/magic-string-0.25.9.tgz#de7f9faf91ef8a1c91d02c2e5314c8277dbcdd1c\"\n\n\n###\n\n", "completion": "build: update all non-major dependencies (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/marketing-first-app/package-lock.json | file path B: aio/content/examples/marketing-first-app/package-lock.json\n\n@@ -22,7 +22,7 @@\n         \"@angular-devkit/build-angular\": \"~15.0.1\",\n         \"@angular/cli\": \"~15.0.1\",\n         \"@angular/compiler-cli\": \"~15.0.1\",\n-        \"@types/jasmine\": \"~3.6.0\",\n+        \"@types/jasmine\": \"~4.3.0\",\n         \"@types/node\": \"^12.11.1\",\n         \"codelyzer\": \"^6.0.0\",\n         \"jasmine-core\": \"~4.5.0\",\n@@ -2747,9 +2747,9 @@\n       }\n     },\n     \"node_modules/@types/jasmine\": {\n-      \"version\": \"3.6.11\",\n-      \"resolved\": \"https://registry.npmjs.org/@types/jasmine/-/jasmine-3.6.11.tgz\",\n-      \"integrity\": \"sha512-S6pvzQDvMZHrkBz2Mcn/8Du7cpr76PlRJBAoHnSDNbulULsH5dp0Gns+WRyNX5LHejz/ljxK4/vIHK/caHt6SQ==\",\n+      \"version\": \"4.3.1\",\n+      \"resolved\": \"https://registry.npmjs.org/@types/jasmine/-/jasmine-4.3.1.tgz\",\n+      \"integrity\": \"sha512-Vu8l+UGcshYmV1VWwULgnV/2RDbBaO6i2Ptx7nd//oJPIZGhoI1YLST4VKagD2Pq/Bc2/7zvtvhM7F3p4SN7kQ==\",\n       \"dev\": true\n     },\n     \"node_modules/@types/json-schema\": {\n@@ -14838,9 +14838,9 @@\n       }\n     },\n     \"@types/jasmine\": {\n-      \"version\": \"3.6.11\",\n-      \"resolved\": \"https://registry.npmjs.org/@types/jasmine/-/jasmine-3.6.11.tgz\",\n-      \"integrity\": \"sha512-S6pvzQDvMZHrkBz2Mcn/8Du7cpr76PlRJBAoHnSDNbulULsH5dp0Gns+WRyNX5LHejz/ljxK4/vIHK/caHt6SQ==\",\n+      \"version\": \"4.3.1\",\n+      \"resolved\": \"https://registry.npmjs.org/@types/jasmine/-/jasmine-4.3.1.tgz\",\n+      \"integrity\": \"sha512-Vu8l+UGcshYmV1VWwULgnV/2RDbBaO6i2Ptx7nd//oJPIZGhoI1YLST4VKagD2Pq/Bc2/7zvtvhM7F3p4SN7kQ==\",\n       \"dev\": true\n     },\n     \"@types/json-schema\": {\n\n---\n file path A: aio/content/examples/marketing-first-app/package.json | file path B: aio/content/examples/marketing-first-app/package.json\n\n@@ -25,7 +25,7 @@\n     \"@angular-devkit/build-angular\": \"~15.0.1\",\n     \"@angular/cli\": \"~15.0.1\",\n     \"@angular/compiler-cli\": \"~15.0.1\",\n-    \"@types/jasmine\": \"~3.6.0\",\n+    \"@types/jasmine\": \"~4.3.0\",\n     \"@types/node\": \"^12.11.1\",\n     \"codelyzer\": \"^6.0.0\",\n     \"jasmine-core\": \"~4.5.0\",\n\n\n###\n\n", "completion": "build: update dependency @types/jasmine to v4 (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -100,8 +100,8 @@\n     \"@types/node\": \"^12.7.9\",\n     \"@types/trusted-types\": \"^2.0.2\",\n     \"@types/xregexp\": \"^4.3.0\",\n-    \"@typescript-eslint/eslint-plugin\": \"5.44.0\",\n-    \"@typescript-eslint/parser\": \"5.44.0\",\n+    \"@typescript-eslint/eslint-plugin\": \"5.45.1\",\n+    \"@typescript-eslint/parser\": \"5.45.1\",\n     \"archiver\": \"^5.3.0\",\n     \"assert\": \"^2.0.0\",\n     \"canonical-path\": \"1.0.0\",\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -3429,14 +3429,14 @@\n   dependencies:\n     \"@types/node\" \"*\"\n \n-\"@typescript-eslint/eslint-plugin@5.44.0\":\n-  version \"5.44.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/eslint-plugin/-/eslint-plugin-5.44.0.tgz#105788f299050c917eb85c4d9fd04b089e3740de\"\n-  integrity sha512-j5ULd7FmmekcyWeArx+i8x7sdRHzAtXTkmDPthE4amxZOWKFK7bomoJ4r7PJ8K7PoMzD16U8MmuZFAonr1ERvw==\n-  dependencies:\n-    \"@typescript-eslint/scope-manager\" \"5.44.0\"\n-    \"@typescript-eslint/type-utils\" \"5.44.0\"\n-    \"@typescript-eslint/utils\" \"5.44.0\"\n+\"@typescript-eslint/eslint-plugin@5.45.1\":\n+  version \"5.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/eslint-plugin/-/eslint-plugin-5.45.1.tgz#ee5b51405f6c9ee7e60e4006d68c69450d3b4536\"\n+  integrity sha512-cOizjPlKEh0bXdFrBLTrI/J6B/QMlhwE9auOov53tgB+qMukH6/h8YAK/qw+QJGct/PTbdh2lytGyipxCcEtAw==\n+  dependencies:\n+    \"@typescript-eslint/scope-manager\" \"5.45.1\"\n+    \"@typescript-eslint/type-utils\" \"5.45.1\"\n+    \"@typescript-eslint/utils\" \"5.45.1\"\n     debug \"^4.3.4\"\n     ignore \"^5.2.0\"\n     natural-compare-lite \"^1.4.0\"\n@@ -3444,14 +3444,14 @@\n     semver \"^7.3.7\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/parser@5.44.0\":\n-  version \"5.44.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/parser/-/parser-5.44.0.tgz#99e2c710a2252191e7a79113264f438338b846ad\"\n-  integrity sha512-H7LCqbZnKqkkgQHaKLGC6KUjt3pjJDx8ETDqmwncyb6PuoigYajyAwBGz08VU/l86dZWZgI4zm5k2VaKqayYyA==\n+\"@typescript-eslint/parser@5.45.1\":\n+  version \"5.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/parser/-/parser-5.45.1.tgz#6440ec283fa1373a12652d4e2fef4cb6e7b7e8c6\"\n+  integrity sha512-JQ3Ep8bEOXu16q0ztsatp/iQfDCtvap7sp/DKo7DWltUquj5AfCOpX2zSzJ8YkAVnrQNqQ5R62PBz2UtrfmCkA==\n   dependencies:\n-    \"@typescript-eslint/scope-manager\" \"5.44.0\"\n-    \"@typescript-eslint/types\" \"5.44.0\"\n-    \"@typescript-eslint/typescript-estree\" \"5.44.0\"\n+    \"@typescript-eslint/scope-manager\" \"5.45.1\"\n+    \"@typescript-eslint/types\" \"5.45.1\"\n+    \"@typescript-eslint/typescript-estree\" \"5.45.1\"\n     debug \"^4.3.4\"\n \n \"@typescript-eslint/scope-manager@5.43.0\":\n@@ -3462,13 +3462,13 @@\n     \"@typescript-eslint/types\" \"5.43.0\"\n     \"@typescript-eslint/visitor-keys\" \"5.43.0\"\n \n-\"@typescript-eslint/scope-manager@5.44.0\":\n-  version \"5.44.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/scope-manager/-/scope-manager-5.44.0.tgz#988c3f34b45b3474eb9ff0674c18309dedfc3e04\"\n-  integrity sha512-2pKml57KusI0LAhgLKae9kwWeITZ7IsZs77YxyNyIVOwQ1kToyXRaJLl+uDEXzMN5hnobKUOo2gKntK9H1YL8g==\n+\"@typescript-eslint/scope-manager@5.45.1\":\n+  version \"5.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/scope-manager/-/scope-manager-5.45.1.tgz#5b87d025eec7035d879b99c260f03be5c247883c\"\n+  integrity sha512-D6fCileR6Iai7E35Eb4Kp+k0iW7F1wxXYrOhX/3dywsOJpJAQ20Fwgcf+P/TDtvQ7zcsWsrJaglaQWDhOMsspQ==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.44.0\"\n-    \"@typescript-eslint/visitor-keys\" \"5.44.0\"\n+    \"@typescript-eslint/types\" \"5.45.1\"\n+    \"@typescript-eslint/visitor-keys\" \"5.45.1\"\n \n \"@typescript-eslint/type-utils@5.43.0\":\n   version \"5.43.0\"\n@@ -3480,13 +3480,13 @@\n     debug \"^4.3.4\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/type-utils@5.44.0\":\n-  version \"5.44.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/type-utils/-/type-utils-5.44.0.tgz#bc5a6e8a0269850714a870c9268c038150dfb3c7\"\n-  integrity sha512-A1u0Yo5wZxkXPQ7/noGkRhV4J9opcymcr31XQtOzcc5nO/IHN2E2TPMECKWYpM3e6olWEM63fq/BaL1wEYnt/w==\n+\"@typescript-eslint/type-utils@5.45.1\":\n+  version \"5.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/type-utils/-/type-utils-5.45.1.tgz#cb7d300c3c95802cea9f87c7f8be363cf8f8538c\"\n+  integrity sha512-aosxFa+0CoYgYEl3aptLe1svP910DJq68nwEJzyQcrtRhC4BN0tJAvZGAe+D0tzjJmFXe+h4leSsiZhwBa2vrA==\n   dependencies:\n-    \"@typescript-eslint/typescript-estree\" \"5.44.0\"\n-    \"@typescript-eslint/utils\" \"5.44.0\"\n+    \"@typescript-eslint/typescript-estree\" \"5.45.1\"\n+    \"@typescript-eslint/utils\" \"5.45.1\"\n     debug \"^4.3.4\"\n     tsutils \"^3.21.0\"\n \n@@ -3495,10 +3495,10 @@\n   resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.43.0.tgz#e4ddd7846fcbc074325293515fa98e844d8d2578\"\n   integrity sha512-jpsbcD0x6AUvV7tyOlyvon0aUsQpF8W+7TpJntfCUWU1qaIKu2K34pMwQKSzQH8ORgUrGYY6pVIh1Pi8TNeteg==\n \n-\"@typescript-eslint/types@5.44.0\":\n-  version \"5.44.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.44.0.tgz#f3f0b89aaff78f097a2927fe5688c07e786a0241\"\n-  integrity sha512-Tp+zDnHmGk4qKR1l+Y1rBvpjpm5tGXX339eAlRBDg+kgZkz9Bw+pqi4dyseOZMsGuSH69fYfPJCBKBrbPCxYFQ==\n+\"@typescript-eslint/types@5.45.1\":\n+  version \"5.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.45.1.tgz#8e1883041cee23f1bb7e1343b0139f97f6a17c14\"\n+  integrity sha512-HEW3U0E5dLjUT+nk7b4lLbOherS1U4ap+b9pfu2oGsW3oPu7genRaY9dDv3nMczC1rbnRY2W/D7SN05wYoGImg==\n \n \"@typescript-eslint/typescript-estree@5.43.0\":\n   version \"5.43.0\"\n@@ -3513,13 +3513,13 @@\n     semver \"^7.3.7\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/typescript-estree@5.44.0\":\n-  version \"5.44.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/typescript-estree/-/typescript-estree-5.44.0.tgz#0461b386203e8d383bb1268b1ed1da9bc905b045\"\n-  integrity sha512-M6Jr+RM7M5zeRj2maSfsZK2660HKAJawv4Ud0xT+yauyvgrsHu276VtXlKDFnEmhG+nVEd0fYZNXGoAgxwDWJw==\n+\"@typescript-eslint/typescript-estree@5.45.1\":\n+  version \"5.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/typescript-estree/-/typescript-estree-5.45.1.tgz#b3dc37f0c4f0fe73e09917fc735e6f96eabf9ba4\"\n+  integrity sha512-76NZpmpCzWVrrb0XmYEpbwOz/FENBi+5W7ipVXAsG3OoFrQKJMiaqsBMbvGRyLtPotGqUfcY7Ur8j0dksDJDng==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.44.0\"\n-    \"@typescript-eslint/visitor-keys\" \"5.44.0\"\n+    \"@typescript-eslint/types\" \"5.45.1\"\n+    \"@typescript-eslint/visitor-keys\" \"5.45.1\"\n     debug \"^4.3.4\"\n     globby \"^11.1.0\"\n     is-glob \"^4.0.3\"\n@@ -3540,16 +3540,16 @@\n     eslint-utils \"^3.0.0\"\n     semver \"^7.3.7\"\n \n-\"@typescript-eslint/utils@5.44.0\":\n-  version \"5.44.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/utils/-/utils-5.44.0.tgz#d733da4d79d6c30f1a68b531cdda1e0c1f00d52d\"\n-  integrity sha512-fMzA8LLQ189gaBjS0MZszw5HBdZgVwxVFShCO3QN+ws3GlPkcy9YuS3U4wkT6su0w+Byjq3mS3uamy9HE4Yfjw==\n+\"@typescript-eslint/utils@5.45.1\":\n+  version \"5.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/utils/-/utils-5.45.1.tgz#39610c98bde82c4792f2a858b29b7d0053448be2\"\n+  integrity sha512-rlbC5VZz68+yjAzQBc4I7KDYVzWG2X/OrqoZrMahYq3u8FFtmQYc+9rovo/7wlJH5kugJ+jQXV5pJMnofGmPRw==\n   dependencies:\n     \"@types/json-schema\" \"^7.0.9\"\n     \"@types/semver\" \"^7.3.12\"\n-    \"@typescript-eslint/scope-manager\" \"5.44.0\"\n-    \"@typescript-eslint/types\" \"5.44.0\"\n-    \"@typescript-eslint/typescript-estree\" \"5.44.0\"\n+    \"@typescript-eslint/scope-manager\" \"5.45.1\"\n+    \"@typescript-eslint/types\" \"5.45.1\"\n+    \"@typescript-eslint/typescript-estree\" \"5.45.1\"\n     eslint-scope \"^5.1.1\"\n     eslint-utils \"^3.0.0\"\n     semver \"^7.3.7\"\n@@ -3562,12 +3562,12 @@\n     \"@typescript-eslint/types\" \"5.43.0\"\n     eslint-visitor-keys \"^3.3.0\"\n \n-\"@typescript-eslint/visitor-keys@5.44.0\":\n-  version \"5.44.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/visitor-keys/-/visitor-keys-5.44.0.tgz#10740dc28902bb903d12ee3a005cc3a70207d433\"\n-  integrity sha512-a48tLG8/4m62gPFbJ27FxwCOqPKxsb8KC3HkmYoq2As/4YyjQl1jDbRr1s63+g4FS/iIehjmN3L5UjmKva1HzQ==\n+\"@typescript-eslint/visitor-keys@5.45.1\":\n+  version \"5.45.1\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/visitor-keys/-/visitor-keys-5.45.1.tgz#204428430ad6a830d24c5ac87c71366a1cfe1948\"\n+  integrity sha512-cy9ln+6rmthYWjH9fmx+5FU/JDpjQb586++x2FZlveq7GdGuLLW9a2Jcst2TGekH82bXpfmRNSwP9tyEs6RjvQ==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.44.0\"\n+    \"@typescript-eslint/types\" \"5.45.1\"\n     eslint-visitor-keys \"^3.3.0\"\n \n \"@webassemblyjs/ast@1.11.1\":\n\n\n###\n\n", "completion": "build: update eslint dependencies to v5.45.1 (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/marketing-first-app/package-lock.json | file path B: aio/content/examples/marketing-first-app/package-lock.json\n\n@@ -31,7 +31,7 @@\n         \"karma-chrome-launcher\": \"~3.1.0\",\n         \"karma-coverage\": \"~2.0.3\",\n         \"karma-jasmine\": \"~5.1.0\",\n-        \"karma-jasmine-html-reporter\": \"^1.5.0\",\n+        \"karma-jasmine-html-reporter\": \"^2.0.0\",\n         \"protractor\": \"~7.0.0\",\n         \"ts-node\": \"~10.9.0\",\n         \"tslint\": \"~6.1.0\",\n@@ -7626,14 +7626,14 @@\n       }\n     },\n     \"node_modules/karma-jasmine-html-reporter\": {\n-      \"version\": \"1.7.0\",\n-      \"resolved\": \"https://registry.npmjs.org/karma-jasmine-html-reporter/-/karma-jasmine-html-reporter-1.7.0.tgz\",\n-      \"integrity\": \"sha512-pzum1TL7j90DTE86eFt48/s12hqwQuiD+e5aXx2Dc9wDEn2LfGq6RoAxEZZjFiN0RDSCOnosEKRZWxbQ+iMpQQ==\",\n+      \"version\": \"2.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/karma-jasmine-html-reporter/-/karma-jasmine-html-reporter-2.0.0.tgz\",\n+      \"integrity\": \"sha512-SB8HNNiazAHXM1vGEzf8/tSyEhkfxuDdhYdPBX2Mwgzt0OuF2gicApQ+uvXLID/gXyJQgvrM9+1/2SxZFUUDIA==\",\n       \"dev\": true,\n       \"peerDependencies\": {\n-        \"jasmine-core\": \">=3.8\",\n-        \"karma\": \">=0.9\",\n-        \"karma-jasmine\": \">=1.1\"\n+        \"jasmine-core\": \"^4.0.0\",\n+        \"karma\": \"^6.0.0\",\n+        \"karma-jasmine\": \"^5.0.0\"\n       }\n     },\n     \"node_modules/karma-source-map-support\": {\n@@ -18653,9 +18653,9 @@\n       }\n     },\n     \"karma-jasmine-html-reporter\": {\n-      \"version\": \"1.7.0\",\n-      \"resolved\": \"https://registry.npmjs.org/karma-jasmine-html-reporter/-/karma-jasmine-html-reporter-1.7.0.tgz\",\n-      \"integrity\": \"sha512-pzum1TL7j90DTE86eFt48/s12hqwQuiD+e5aXx2Dc9wDEn2LfGq6RoAxEZZjFiN0RDSCOnosEKRZWxbQ+iMpQQ==\",\n+      \"version\": \"2.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/karma-jasmine-html-reporter/-/karma-jasmine-html-reporter-2.0.0.tgz\",\n+      \"integrity\": \"sha512-SB8HNNiazAHXM1vGEzf8/tSyEhkfxuDdhYdPBX2Mwgzt0OuF2gicApQ+uvXLID/gXyJQgvrM9+1/2SxZFUUDIA==\",\n       \"dev\": true,\n       \"requires\": {}\n     },\n\n---\n file path A: aio/content/examples/marketing-first-app/package.json | file path B: aio/content/examples/marketing-first-app/package.json\n\n@@ -34,7 +34,7 @@\n     \"karma-chrome-launcher\": \"~3.1.0\",\n     \"karma-coverage\": \"~2.0.3\",\n     \"karma-jasmine\": \"~5.1.0\",\n-    \"karma-jasmine-html-reporter\": \"^1.5.0\",\n+    \"karma-jasmine-html-reporter\": \"^2.0.0\",\n     \"protractor\": \"~7.0.0\",\n     \"ts-node\": \"~10.9.0\",\n     \"tslint\": \"~6.1.0\",\n\n\n###\n\n", "completion": "build: update dependency karma-jasmine-html-reporter to v2 (#<issue-num>)"}
{"prompt": " file path A: packages/compiler/src/shadow_css.ts | file path B: packages/compiler/src/shadow_css.ts\n\n@@ -571,7 +571,8 @@ export class ShadowCss {\n             this._scopeSelector(rule.selector, scopeSelector, hostSelector, this.strictStyling);\n       } else if (\n           rule.selector.startsWith('@media') || rule.selector.startsWith('@supports') ||\n-          rule.selector.startsWith('@document') || rule.selector.startsWith('@layer')) {\n+          rule.selector.startsWith('@document') || rule.selector.startsWith('@layer') ||\n+          rule.selector.startsWith('@container')) {\n         content = this._scopeSelectors(rule.content, scopeSelector, hostSelector);\n       } else if (rule.selector.startsWith('@font-face') || rule.selector.startsWith('@page')) {\n         content = this._stripScopingSelectors(rule.content);\n\n---\n file path A: None | file path B: packages/compiler/test/shadow_css/container_queries_spec.ts\n\n@@ -0,0 +1,55 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {ShadowCss} from '@angular/compiler/src/shadow_css';\n+\n+describe('ShadowCss, container queries', () => {\n+  function s(css: string, contentAttr: string, hostAttr: string = '') {\n+    const shadowCss = new ShadowCss();\n+    return shadowCss.shimCssText(css, contentAttr, hostAttr);\n+  }\n+\n+  it('should scope normal selectors inside an unnamed container rules', () => {\n+    const css = `@container max(max-width: 500px) {\n+             .item {\n+               color: red;\n+             }\n+           }`;\n+    const result = s(css, 'host-a');\n+    expect(noIndentation(result)).toEqual(noIndentation(`@container max(max-width: 500px) {\n+         .item[host-a] {\n+           color: red;\n+         }\n+       }`));\n+  });\n+\n+  it('should scope normal selectors inside a named container rules', () => {\n+    const css = `@container container max(max-width: 500px) {\n+             .item {\n+               color: red;\n+             }\n+           }`;\n+    const result = s(css, 'host-a');\n+    // Note that for the time being we are not scoping the container name itself,\n+    // this is something that may or may not be done in the future depending\n+    // on how the css specs evolve. Currently as of Chrome 107 it looks like shadowDom\n+    // boundaries don't effect container queries (thus the scoping wouldn't be needed)\n+    // and this aspect of container queries seems to be still under active discussion:\n+    // https://github.com/w3c/csswg-drafts/issues/5984\n+    expect(noIndentation(result))\n+        .toEqual(noIndentation(`@container container max(max-width: 500px) {\n+       .item[host-a] {\n+         color: red;\n+       }\n+     }`));\n+  });\n+});\n+\n+function noIndentation(str: string): string {\n+  return str.replace(/\\n\\s+/g, '\\n');\n+}\n\n\n###\n\n", "completion": "fix(compiler): make sure selectors inside container queries are correctly scoped (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/build.md | file path B: aio/content/guide/build.md\n\n@@ -234,7 +234,7 @@ Define your size boundaries in the CLI configuration file, `angular.json`, in a\n   \"configurations\": {\n     \"production\": {\n       &hellip;\n-      budgets: []\n+      \"budgets\": []\n     }\n   }\n }\n\n\n###\n\n", "completion": "docs: wrap json property in double quotes (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/render3/node_manipulation.ts | file path B: packages/core/src/render3/node_manipulation.ts\n\n@@ -15,26 +15,21 @@ import {escapeCommentText} from '../util/dom';\n import {assertLContainer, assertLView, assertParentView, assertProjectionSlots, assertTNodeForLView} from './assert';\n import {attachPatchData} from './context_discovery';\n import {icuContainerIterate} from './i18n/i18n_tree_shaking';\n-import {CONTAINER_HEADER_OFFSET, HAS_TRANSPLANTED_VIEWS, LContainer, MOVED_VIEWS, NATIVE, unusedValueExportToPlacateAjd as unused1} from './interfaces/container';\n+import {CONTAINER_HEADER_OFFSET, HAS_TRANSPLANTED_VIEWS, LContainer, MOVED_VIEWS, NATIVE} from './interfaces/container';\n import {ComponentDef} from './interfaces/definition';\n import {NodeInjectorFactory} from './interfaces/injector';\n import {unregisterLView} from './interfaces/lview_tracking';\n-import {TElementNode, TIcuContainerNode, TNode, TNodeFlags, TNodeType, TProjectionNode, unusedValueExportToPlacateAjd as unused2} from './interfaces/node';\n-import {unusedValueExportToPlacateAjd as unused3} from './interfaces/projection';\n-import {Renderer, unusedValueExportToPlacateAjd as unused4} from './interfaces/renderer';\n+import {TElementNode, TIcuContainerNode, TNode, TNodeFlags, TNodeType, TProjectionNode} from './interfaces/node';\n+import {Renderer} from './interfaces/renderer';\n import {RComment, RElement, RNode, RTemplate, RText} from './interfaces/renderer_dom';\n import {isLContainer, isLView} from './interfaces/type_checks';\n-import {CHILD_HEAD, CLEANUP, DECLARATION_COMPONENT_VIEW, DECLARATION_LCONTAINER, DestroyHookData, FLAGS, HookData, HookFn, HOST, LView, LViewFlags, NEXT, PARENT, QUERIES, RENDERER, T_HOST, TVIEW, TView, TViewType, unusedValueExportToPlacateAjd as unused5} from './interfaces/view';\n+import {CHILD_HEAD, CLEANUP, DECLARATION_COMPONENT_VIEW, DECLARATION_LCONTAINER, DestroyHookData, FLAGS, HookData, HookFn, HOST, LView, LViewFlags, NEXT, PARENT, QUERIES, RENDERER, T_HOST, TVIEW, TView, TViewType} from './interfaces/view';\n import {assertTNodeType} from './node_assert';\n import {profiler, ProfilerEvent} from './profiler';\n import {setUpAttributes} from './util/attrs_utils';\n import {getLViewParent} from './util/view_traversal_utils';\n import {getNativeByTNode, unwrapRNode, updateTransplantedViewCount} from './util/view_utils';\n \n-\n-\n-const unusedValueToPlacateAjd = unused1 + unused2 + unused3 + unused4 + unused5;\n-\n const enum WalkTNodeTreeAction {\n   /** node create in the native environment. Run on initial creation. */\n   Create = 0,\n\n---\n file path A: packages/core/src/render3/node_selector_matcher.ts | file path B: packages/core/src/render3/node_selector_matcher.ts\n\n@@ -10,13 +10,11 @@ import '../util/ng_dev_mode';\n \n import {assertDefined, assertEqual, assertNotEqual} from '../util/assert';\n \n-import {AttributeMarker, TAttributes, TNode, TNodeType, unusedValueExportToPlacateAjd as unused1} from './interfaces/node';\n-import {CssSelector, CssSelectorList, SelectorFlags, unusedValueExportToPlacateAjd as unused2} from './interfaces/projection';\n+import {AttributeMarker, TAttributes, TNode, TNodeType} from './interfaces/node';\n+import {CssSelector, CssSelectorList, SelectorFlags} from './interfaces/projection';\n import {classIndexOf} from './styling/class_differ';\n import {isNameOnlyAttributeMarker} from './util/attrs_utils';\n \n-const unusedValueToPlacateAjd = unused1 + unused2;\n-\n const NG_TEMPLATE_SELECTOR = 'ng-template';\n \n /**\n\n---\n file path A: packages/core/src/render3/query.ts | file path B: packages/core/src/render3/query.ts\n\n@@ -16,21 +16,18 @@ import {createTemplateRef, TemplateRef as ViewEngine_TemplateRef} from '../linke\n import {createContainerRef, ViewContainerRef} from '../linker/view_container_ref';\n import {assertDefined, assertIndexInRange, assertNumber, throwError} from '../util/assert';\n import {stringify} from '../util/stringify';\n+\n import {assertFirstCreatePass, assertLContainer} from './assert';\n import {getNodeInjectable, locateDirectiveOrProvider} from './di';\n import {storeCleanupWithContext} from './instructions/shared';\n import {CONTAINER_HEADER_OFFSET, LContainer, MOVED_VIEWS} from './interfaces/container';\n-import {unusedValueExportToPlacateAjd as unused1} from './interfaces/definition';\n-import {unusedValueExportToPlacateAjd as unused2} from './interfaces/injector';\n-import {TContainerNode, TElementContainerNode, TElementNode, TNode, TNodeType, unusedValueExportToPlacateAjd as unused3} from './interfaces/node';\n-import {LQueries, LQuery, QueryFlags, TQueries, TQuery, TQueryMetadata, unusedValueExportToPlacateAjd as unused4} from './interfaces/query';\n+import {TContainerNode, TElementContainerNode, TElementNode, TNode, TNodeType} from './interfaces/node';\n+import {LQueries, LQuery, QueryFlags, TQueries, TQuery, TQueryMetadata} from './interfaces/query';\n import {DECLARATION_LCONTAINER, LView, PARENT, QUERIES, TVIEW, TView} from './interfaces/view';\n import {assertTNodeType} from './node_assert';\n import {getCurrentQueryIndex, getCurrentTNode, getLView, getTView, setCurrentQueryIndex} from './state';\n import {isCreationMode} from './util/view_utils';\n \n-const unusedValueToPlacateAjd = unused1 + unused2 + unused3 + unused4;\n-\n class LQuery_<T> implements LQuery<T> {\n   matches: (T|null)[]|null = null;\n   constructor(public queryList: QueryList<T>) {}\n\n\n###\n\n", "completion": "refactor(core): remove old AJD workaround for G3 (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/marketing-first-app/package-lock.json | file path B: aio/content/examples/marketing-first-app/package-lock.json\n\n@@ -33,7 +33,7 @@\n         \"karma-jasmine\": \"~5.1.0\",\n         \"karma-jasmine-html-reporter\": \"^1.5.0\",\n         \"protractor\": \"~7.0.0\",\n-        \"ts-node\": \"~8.3.0\",\n+        \"ts-node\": \"~10.9.0\",\n         \"tslint\": \"~6.1.0\",\n         \"typescript\": \"~4.8.4\"\n       }\n@@ -2184,6 +2184,28 @@\n         \"node\": \">=0.1.90\"\n       }\n     },\n+    \"node_modules/@cspotcode/source-map-support\": {\n+      \"version\": \"0.8.1\",\n+      \"resolved\": \"https://registry.npmjs.org/@cspotcode/source-map-support/-/source-map-support-0.8.1.tgz\",\n+      \"integrity\": \"sha512-IchNf6dN4tHoMFIn/7OE8LWZ19Y6q/67Bmf6vnGREv8RSbBVb9LPJxEcnwrcwX6ixSvaiGoomAUvu4YSxXrVgw==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"@jridgewell/trace-mapping\": \"0.3.9\"\n+      },\n+      \"engines\": {\n+        \"node\": \">=12\"\n+      }\n+    },\n+    \"node_modules/@cspotcode/source-map-support/node_modules/@jridgewell/trace-mapping\": {\n+      \"version\": \"0.3.9\",\n+      \"resolved\": \"https://registry.npmjs.org/@jridgewell/trace-mapping/-/trace-mapping-0.3.9.tgz\",\n+      \"integrity\": \"sha512-3Belt6tdc8bPgAtbcmdtNJlirVoTmEb5e2gC94PnkwEW9jI6CAHUeoG85tjWP5WquqfavoMtMwiG4P926ZKKuQ==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"@jridgewell/resolve-uri\": \"^3.0.3\",\n+        \"@jridgewell/sourcemap-codec\": \"^1.4.10\"\n+      }\n+    },\n     \"node_modules/@discoveryjs/json-ext\": {\n       \"version\": \"0.5.7\",\n       \"resolved\": \"https://registry.npmjs.org/@discoveryjs/json-ext/-/json-ext-0.5.7.tgz\",\n@@ -2592,6 +2614,30 @@\n         \"node\": \">= 10\"\n       }\n     },\n+    \"node_modules/@tsconfig/node10\": {\n+      \"version\": \"1.0.9\",\n+      \"resolved\": \"https://registry.npmjs.org/@tsconfig/node10/-/node10-1.0.9.tgz\",\n+      \"integrity\": \"sha512-jNsYVVxU8v5g43Erja32laIDHXeoNvFEpX33OK4d6hljo3jDhCBDhx5dhCCTMWUojscpAagGiRkBKxpdl9fxqA==\",\n+      \"dev\": true\n+    },\n+    \"node_modules/@tsconfig/node12\": {\n+      \"version\": \"1.0.11\",\n+      \"resolved\": \"https://registry.npmjs.org/@tsconfig/node12/-/node12-1.0.11.tgz\",\n+      \"integrity\": \"sha512-cqefuRsh12pWyGsIoBKJA9luFu3mRxCA+ORZvA4ktLSzIuCUtWVxGIuXigEwO5/ywWFMZ2QEGKWvkZG1zDMTag==\",\n+      \"dev\": true\n+    },\n+    \"node_modules/@tsconfig/node14\": {\n+      \"version\": \"1.0.3\",\n+      \"resolved\": \"https://registry.npmjs.org/@tsconfig/node14/-/node14-1.0.3.tgz\",\n+      \"integrity\": \"sha512-ysT8mhdixWK6Hw3i1V2AeRqZ5WfXg1G43mqoYlM2nc6388Fq5jcXyr5mRsqViLx/GJYdoL0bfXD8nmF+Zn/Iow==\",\n+      \"dev\": true\n+    },\n+    \"node_modules/@tsconfig/node16\": {\n+      \"version\": \"1.0.3\",\n+      \"resolved\": \"https://registry.npmjs.org/@tsconfig/node16/-/node16-1.0.3.tgz\",\n+      \"integrity\": \"sha512-yOlFc+7UtL/89t2ZhjPvvB/DeAr3r+Dq58IgzsFkOAvVC6NMJXmCGjbptdXdR9qsX7pKcTL+s87FtYREi2dEEQ==\",\n+      \"dev\": true\n+    },\n     \"node_modules/@types/body-parser\": {\n       \"version\": \"1.19.2\",\n       \"resolved\": \"https://registry.npmjs.org/@types/body-parser/-/body-parser-1.19.2.tgz\",\n@@ -3007,6 +3053,15 @@\n         \"acorn\": \"^8\"\n       }\n     },\n+    \"node_modules/acorn-walk\": {\n+      \"version\": \"8.2.0\",\n+      \"resolved\": \"https://registry.npmjs.org/acorn-walk/-/acorn-walk-8.2.0.tgz\",\n+      \"integrity\": \"sha512-k+iyHEuPgSw6SbuDpGQM+06HQUa04DZ3o+F6CSzXMvvI5KMvnaEqXe+YVe555R9nn6GPt404fos4wcgpw12SDA==\",\n+      \"dev\": true,\n+      \"engines\": {\n+        \"node\": \">=0.4.0\"\n+      }\n+    },\n     \"node_modules/adjust-sourcemap-loader\": {\n       \"version\": \"4.0.0\",\n       \"resolved\": \"https://registry.npmjs.org/adjust-sourcemap-loader/-/adjust-sourcemap-loader-4.0.0.tgz\",\n@@ -4382,6 +4437,12 @@\n         \"node\": \">=10\"\n       }\n     },\n+    \"node_modules/create-require\": {\n+      \"version\": \"1.1.1\",\n+      \"resolved\": \"https://registry.npmjs.org/create-require/-/create-require-1.1.1.tgz\",\n+      \"integrity\": \"sha512-dcKFX3jn0MpIaXjisoRvexIJVEKzaq7z2rZKxf+MSr9TkdmHmsU4m2lcLojrj/FHl8mk5VxMmYA+ftRkP/3oKQ==\",\n+      \"dev\": true\n+    },\n     \"node_modules/critters\": {\n       \"version\": \"0.0.16\",\n       \"resolved\": \"https://registry.npmjs.org/critters/-/critters-0.0.16.tgz\",\n@@ -11751,25 +11812,46 @@\n       }\n     },\n     \"node_modules/ts-node\": {\n-      \"version\": \"8.3.0\",\n-      \"resolved\": \"https://registry.npmjs.org/ts-node/-/ts-node-8.3.0.tgz\",\n-      \"integrity\": \"sha512-dyNS/RqyVTDcmNM4NIBAeDMpsAdaQ+ojdf0GOLqE6nwJOgzEkdRNzJywhDfwnuvB10oa6NLVG1rUJQCpRN7qoQ==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n+      \"version\": \"10.9.1\",\n+      \"resolved\": \"https://registry.npmjs.org/ts-node/-/ts-node-10.9.1.tgz\",\n+      \"integrity\": \"sha512-NtVysVPkxxrwFGUUxGYhfux8k78pQB3JqYBXlLRZgdGUqTO5wU/UyHop5p70iEbGhB7q5KmiZiU0Y3KlJrScEw==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"@cspotcode/source-map-support\": \"^0.8.0\",\n+        \"@tsconfig/node10\": \"^1.0.7\",\n+        \"@tsconfig/node12\": \"^1.0.7\",\n+        \"@tsconfig/node14\": \"^1.0.0\",\n+        \"@tsconfig/node16\": \"^1.0.2\",\n+        \"acorn\": \"^8.4.1\",\n+        \"acorn-walk\": \"^8.1.1\",\n         \"arg\": \"^4.1.0\",\n+        \"create-require\": \"^1.1.0\",\n         \"diff\": \"^4.0.1\",\n         \"make-error\": \"^1.1.1\",\n-        \"source-map-support\": \"^0.5.6\",\n-        \"yn\": \"^3.0.0\"\n+        \"v8-compile-cache-lib\": \"^3.0.1\",\n+        \"yn\": \"3.1.1\"\n       },\n       \"bin\": {\n-        \"ts-node\": \"dist/bin.js\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=4.2.0\"\n+        \"ts-node\": \"dist/bin.js\",\n+        \"ts-node-cwd\": \"dist/bin-cwd.js\",\n+        \"ts-node-esm\": \"dist/bin-esm.js\",\n+        \"ts-node-script\": \"dist/bin-script.js\",\n+        \"ts-node-transpile-only\": \"dist/bin-transpile.js\",\n+        \"ts-script\": \"dist/bin-script-deprecated.js\"\n       },\n       \"peerDependencies\": {\n-        \"typescript\": \">=2.0\"\n+        \"@swc/core\": \">=1.2.50\",\n+        \"@swc/wasm\": \">=1.2.50\",\n+        \"@types/node\": \"*\",\n+        \"typescript\": \">=2.7\"\n+      },\n+      \"peerDependenciesMeta\": {\n+        \"@swc/core\": {\n+          \"optional\": true\n+        },\n+        \"@swc/wasm\": {\n+          \"optional\": true\n+        }\n       }\n     },\n     \"node_modules/tslib\": {\n@@ -12100,6 +12182,12 @@\n         \"uuid\": \"bin/uuid\"\n       }\n     },\n+    \"node_modules/v8-compile-cache-lib\": {\n+      \"version\": \"3.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/v8-compile-cache-lib/-/v8-compile-cache-lib-3.0.1.tgz\",\n+      \"integrity\": \"sha512-wa7YjyUGfNZngI/vtK0UHAN+lgDCxBPCylVXGp0zu59Fz5aiGtNXaq3DhIov063MorB+VfufLh3JlF2KdTK3xg==\",\n+      \"dev\": true\n+    },\n     \"node_modules/validate-npm-package-license\": {\n       \"version\": \"3.0.4\",\n       \"resolved\": \"https://registry.npmjs.org/validate-npm-package-license/-/validate-npm-package-license-3.0.4.tgz\",\n@@ -14301,6 +14389,27 @@\n       \"integrity\": \"sha512-ooWCrlZP11i8GImSjTHYHLkvFDP48nS4+204nGb1RiX/WXYHmJA2III9/e2DWVabCESdW7hBAEzHRqUn9OUVvQ==\",\n       \"dev\": true\n     },\n+    \"@cspotcode/source-map-support\": {\n+      \"version\": \"0.8.1\",\n+      \"resolved\": \"https://registry.npmjs.org/@cspotcode/source-map-support/-/source-map-support-0.8.1.tgz\",\n+      \"integrity\": \"sha512-IchNf6dN4tHoMFIn/7OE8LWZ19Y6q/67Bmf6vnGREv8RSbBVb9LPJxEcnwrcwX6ixSvaiGoomAUvu4YSxXrVgw==\",\n+      \"dev\": true,\n+      \"requires\": {\n+        \"@jridgewell/trace-mapping\": \"0.3.9\"\n+      },\n+      \"dependencies\": {\n+        \"@jridgewell/trace-mapping\": {\n+          \"version\": \"0.3.9\",\n+          \"resolved\": \"https://registry.npmjs.org/@jridgewell/trace-mapping/-/trace-mapping-0.3.9.tgz\",\n+          \"integrity\": \"sha512-3Belt6tdc8bPgAtbcmdtNJlirVoTmEb5e2gC94PnkwEW9jI6CAHUeoG85tjWP5WquqfavoMtMwiG4P926ZKKuQ==\",\n+          \"dev\": true,\n+          \"requires\": {\n+            \"@jridgewell/resolve-uri\": \"^3.0.3\",\n+            \"@jridgewell/sourcemap-codec\": \"^1.4.10\"\n+          }\n+        }\n+      }\n+    },\n     \"@discoveryjs/json-ext\": {\n       \"version\": \"0.5.7\",\n       \"resolved\": \"https://registry.npmjs.org/@discoveryjs/json-ext/-/json-ext-0.5.7.tgz\",\n@@ -14596,6 +14705,30 @@\n       \"integrity\": \"sha512-XCuKFP5PS55gnMVu3dty8KPatLqUoy/ZYzDzAGCQ8JNFCkLXzmI7vNHCR+XpbZaMWQK/vQubr7PkYq8g470J/A==\",\n       \"dev\": true\n     },\n+    \"@tsconfig/node10\": {\n+      \"version\": \"1.0.9\",\n+      \"resolved\": \"https://registry.npmjs.org/@tsconfig/node10/-/node10-1.0.9.tgz\",\n+      \"integrity\": \"sha512-jNsYVVxU8v5g43Erja32laIDHXeoNvFEpX33OK4d6hljo3jDhCBDhx5dhCCTMWUojscpAagGiRkBKxpdl9fxqA==\",\n+      \"dev\": true\n+    },\n+    \"@tsconfig/node12\": {\n+      \"version\": \"1.0.11\",\n+      \"resolved\": \"https://registry.npmjs.org/@tsconfig/node12/-/node12-1.0.11.tgz\",\n+      \"integrity\": \"sha512-cqefuRsh12pWyGsIoBKJA9luFu3mRxCA+ORZvA4ktLSzIuCUtWVxGIuXigEwO5/ywWFMZ2QEGKWvkZG1zDMTag==\",\n+      \"dev\": true\n+    },\n+    \"@tsconfig/node14\": {\n+      \"version\": \"1.0.3\",\n+      \"resolved\": \"https://registry.npmjs.org/@tsconfig/node14/-/node14-1.0.3.tgz\",\n+      \"integrity\": \"sha512-ysT8mhdixWK6Hw3i1V2AeRqZ5WfXg1G43mqoYlM2nc6388Fq5jcXyr5mRsqViLx/GJYdoL0bfXD8nmF+Zn/Iow==\",\n+      \"dev\": true\n+    },\n+    \"@tsconfig/node16\": {\n+      \"version\": \"1.0.3\",\n+      \"resolved\": \"https://registry.npmjs.org/@tsconfig/node16/-/node16-1.0.3.tgz\",\n+      \"integrity\": \"sha512-yOlFc+7UtL/89t2ZhjPvvB/DeAr3r+Dq58IgzsFkOAvVC6NMJXmCGjbptdXdR9qsX7pKcTL+s87FtYREi2dEEQ==\",\n+      \"dev\": true\n+    },\n     \"@types/body-parser\": {\n       \"version\": \"1.19.2\",\n       \"resolved\": \"https://registry.npmjs.org/@types/body-parser/-/body-parser-1.19.2.tgz\",\n@@ -15000,6 +15133,12 @@\n       \"dev\": true,\n       \"requires\": {}\n     },\n+    \"acorn-walk\": {\n+      \"version\": \"8.2.0\",\n+      \"resolved\": \"https://registry.npmjs.org/acorn-walk/-/acorn-walk-8.2.0.tgz\",\n+      \"integrity\": \"sha512-k+iyHEuPgSw6SbuDpGQM+06HQUa04DZ3o+F6CSzXMvvI5KMvnaEqXe+YVe555R9nn6GPt404fos4wcgpw12SDA==\",\n+      \"dev\": true\n+    },\n     \"adjust-sourcemap-loader\": {\n       \"version\": \"4.0.0\",\n       \"resolved\": \"https://registry.npmjs.org/adjust-sourcemap-loader/-/adjust-sourcemap-loader-4.0.0.tgz\",\n@@ -16053,6 +16192,12 @@\n         \"yaml\": \"^1.10.0\"\n       }\n     },\n+    \"create-require\": {\n+      \"version\": \"1.1.1\",\n+      \"resolved\": \"https://registry.npmjs.org/create-require/-/create-require-1.1.1.tgz\",\n+      \"integrity\": \"sha512-dcKFX3jn0MpIaXjisoRvexIJVEKzaq7z2rZKxf+MSr9TkdmHmsU4m2lcLojrj/FHl8mk5VxMmYA+ftRkP/3oKQ==\",\n+      \"dev\": true\n+    },\n     \"critters\": {\n       \"version\": \"0.0.16\",\n       \"resolved\": \"https://registry.npmjs.org/critters/-/critters-0.0.16.tgz\",\n@@ -21602,16 +21747,24 @@\n       \"dev\": true\n     },\n     \"ts-node\": {\n-      \"version\": \"8.3.0\",\n-      \"resolved\": \"https://registry.npmjs.org/ts-node/-/ts-node-8.3.0.tgz\",\n-      \"integrity\": \"sha512-dyNS/RqyVTDcmNM4NIBAeDMpsAdaQ+ojdf0GOLqE6nwJOgzEkdRNzJywhDfwnuvB10oa6NLVG1rUJQCpRN7qoQ==\",\n-      \"dev\": true,\n-      \"requires\": {\n+      \"version\": \"10.9.1\",\n+      \"resolved\": \"https://registry.npmjs.org/ts-node/-/ts-node-10.9.1.tgz\",\n+      \"integrity\": \"sha512-NtVysVPkxxrwFGUUxGYhfux8k78pQB3JqYBXlLRZgdGUqTO5wU/UyHop5p70iEbGhB7q5KmiZiU0Y3KlJrScEw==\",\n+      \"dev\": true,\n+      \"requires\": {\n+        \"@cspotcode/source-map-support\": \"^0.8.0\",\n+        \"@tsconfig/node10\": \"^1.0.7\",\n+        \"@tsconfig/node12\": \"^1.0.7\",\n+        \"@tsconfig/node14\": \"^1.0.0\",\n+        \"@tsconfig/node16\": \"^1.0.2\",\n+        \"acorn\": \"^8.4.1\",\n+        \"acorn-walk\": \"^8.1.1\",\n         \"arg\": \"^4.1.0\",\n+        \"create-require\": \"^1.1.0\",\n         \"diff\": \"^4.0.1\",\n         \"make-error\": \"^1.1.1\",\n-        \"source-map-support\": \"^0.5.6\",\n-        \"yn\": \"^3.0.0\"\n+        \"v8-compile-cache-lib\": \"^3.0.1\",\n+        \"yn\": \"3.1.1\"\n       }\n     },\n     \"tslib\": {\n@@ -21840,6 +21993,12 @@\n       \"integrity\": \"sha512-HjSDRw6gZE5JMggctHBcjVak08+KEVhSIiDzFnT9S9aegmp85S/bReBVTb4QTFaRNptJ9kuYaNhnbNEOkbKb/A==\",\n       \"dev\": true\n     },\n+    \"v8-compile-cache-lib\": {\n+      \"version\": \"3.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/v8-compile-cache-lib/-/v8-compile-cache-lib-3.0.1.tgz\",\n+      \"integrity\": \"sha512-wa7YjyUGfNZngI/vtK0UHAN+lgDCxBPCylVXGp0zu59Fz5aiGtNXaq3DhIov063MorB+VfufLh3JlF2KdTK3xg==\",\n+      \"dev\": true\n+    },\n     \"validate-npm-package-license\": {\n       \"version\": \"3.0.4\",\n       \"resolved\": \"https://registry.npmjs.org/validate-npm-package-license/-/validate-npm-package-license-3.0.4.tgz\",\n\n---\n file path A: aio/content/examples/marketing-first-app/package.json | file path B: aio/content/examples/marketing-first-app/package.json\n\n@@ -36,7 +36,7 @@\n     \"karma-jasmine\": \"~5.1.0\",\n     \"karma-jasmine-html-reporter\": \"^1.5.0\",\n     \"protractor\": \"~7.0.0\",\n-    \"ts-node\": \"~8.3.0\",\n+    \"ts-node\": \"~10.9.0\",\n     \"tslint\": \"~6.1.0\",\n     \"typescript\": \"~4.8.4\"\n   }\n\n\n###\n\n", "completion": "build: update dependency ts-node to v10 (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/marketing-first-app/package-lock.json | file path B: aio/content/examples/marketing-first-app/package-lock.json\n\n@@ -30,7 +30,7 @@\n         \"karma\": \"~6.4.1\",\n         \"karma-chrome-launcher\": \"~3.1.0\",\n         \"karma-coverage\": \"~2.0.3\",\n-        \"karma-jasmine\": \"~4.0.0\",\n+        \"karma-jasmine\": \"~5.1.0\",\n         \"karma-jasmine-html-reporter\": \"^1.5.0\",\n         \"protractor\": \"~7.0.0\",\n         \"ts-node\": \"~8.3.0\",\n@@ -7550,18 +7550,18 @@\n       }\n     },\n     \"node_modules/karma-jasmine\": {\n-      \"version\": \"4.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/karma-jasmine/-/karma-jasmine-4.0.2.tgz\",\n-      \"integrity\": \"sha512-ggi84RMNQffSDmWSyyt4zxzh2CQGwsxvYYsprgyR1j8ikzIduEdOlcLvXjZGwXG/0j41KUXOWsUCBfbEHPWP9g==\",\n+      \"version\": \"5.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/karma-jasmine/-/karma-jasmine-5.1.0.tgz\",\n+      \"integrity\": \"sha512-i/zQLFrfEpRyQoJF9fsCdTMOF5c2dK7C7OmsuKg2D0YSsuZSfQDiLuaiktbuio6F2wiCsZSnSnieIQ0ant/uzQ==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"jasmine-core\": \"^3.6.0\"\n+        \"jasmine-core\": \"^4.1.0\"\n       },\n       \"engines\": {\n-        \"node\": \">= 10\"\n+        \"node\": \">=12\"\n       },\n       \"peerDependencies\": {\n-        \"karma\": \"*\"\n+        \"karma\": \"^6.0.0\"\n       }\n     },\n     \"node_modules/karma-jasmine-html-reporter\": {\n@@ -7575,12 +7575,6 @@\n         \"karma-jasmine\": \">=1.1\"\n       }\n     },\n-    \"node_modules/karma-jasmine/node_modules/jasmine-core\": {\n-      \"version\": \"3.99.1\",\n-      \"resolved\": \"https://registry.npmjs.org/jasmine-core/-/jasmine-core-3.99.1.tgz\",\n-      \"integrity\": \"sha512-Hu1dmuoGcZ7AfyynN3LsfruwMbxMALMka+YtZeGoLuDEySVmVAPaonkNoBRIw/ectu8b9tVQCJNgp4a4knp+tg==\",\n-      \"dev\": true\n-    },\n     \"node_modules/karma-source-map-support\": {\n       \"version\": \"1.4.0\",\n       \"resolved\": \"https://registry.npmjs.org/karma-source-map-support/-/karma-source-map-support-1.4.0.tgz\",\n@@ -18505,20 +18499,12 @@\n       }\n     },\n     \"karma-jasmine\": {\n-      \"version\": \"4.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/karma-jasmine/-/karma-jasmine-4.0.2.tgz\",\n-      \"integrity\": \"sha512-ggi84RMNQffSDmWSyyt4zxzh2CQGwsxvYYsprgyR1j8ikzIduEdOlcLvXjZGwXG/0j41KUXOWsUCBfbEHPWP9g==\",\n+      \"version\": \"5.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/karma-jasmine/-/karma-jasmine-5.1.0.tgz\",\n+      \"integrity\": \"sha512-i/zQLFrfEpRyQoJF9fsCdTMOF5c2dK7C7OmsuKg2D0YSsuZSfQDiLuaiktbuio6F2wiCsZSnSnieIQ0ant/uzQ==\",\n       \"dev\": true,\n       \"requires\": {\n-        \"jasmine-core\": \"^3.6.0\"\n-      },\n-      \"dependencies\": {\n-        \"jasmine-core\": {\n-          \"version\": \"3.99.1\",\n-          \"resolved\": \"https://registry.npmjs.org/jasmine-core/-/jasmine-core-3.99.1.tgz\",\n-          \"integrity\": \"sha512-Hu1dmuoGcZ7AfyynN3LsfruwMbxMALMka+YtZeGoLuDEySVmVAPaonkNoBRIw/ectu8b9tVQCJNgp4a4knp+tg==\",\n-          \"dev\": true\n-        }\n+        \"jasmine-core\": \"^4.1.0\"\n       }\n     },\n     \"karma-jasmine-html-reporter\": {\n\n---\n file path A: aio/content/examples/marketing-first-app/package.json | file path B: aio/content/examples/marketing-first-app/package.json\n\n@@ -33,7 +33,7 @@\n     \"karma\": \"~6.4.1\",\n     \"karma-chrome-launcher\": \"~3.1.0\",\n     \"karma-coverage\": \"~2.0.3\",\n-    \"karma-jasmine\": \"~4.0.0\",\n+    \"karma-jasmine\": \"~5.1.0\",\n     \"karma-jasmine-html-reporter\": \"^1.5.0\",\n     \"protractor\": \"~7.0.0\",\n     \"ts-node\": \"~8.3.0\",\n\n\n###\n\n", "completion": "build: update dependency karma-jasmine to v5 (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/marketing-first-app/package-lock.json | file path B: aio/content/examples/marketing-first-app/package-lock.json\n\n@@ -25,7 +25,7 @@\n         \"@types/jasmine\": \"~3.6.0\",\n         \"@types/node\": \"^12.11.1\",\n         \"codelyzer\": \"^6.0.0\",\n-        \"jasmine-core\": \"~3.6.0\",\n+        \"jasmine-core\": \"~4.5.0\",\n         \"jasmine-spec-reporter\": \"~5.0.0\",\n         \"karma\": \"~6.4.1\",\n         \"karma-chrome-launcher\": \"~3.1.0\",\n@@ -7176,9 +7176,9 @@\n       }\n     },\n     \"node_modules/jasmine-core\": {\n-      \"version\": \"3.6.0\",\n-      \"resolved\": \"https://registry.npmjs.org/jasmine-core/-/jasmine-core-3.6.0.tgz\",\n-      \"integrity\": \"sha512-8uQYa7zJN8hq9z+g8z1bqCfdC8eoDAeVnM5sfqs7KHv9/ifoJ500m018fpFc7RDaO6SWCLCXwo/wPSNcdYTgcw==\",\n+      \"version\": \"4.5.0\",\n+      \"resolved\": \"https://registry.npmjs.org/jasmine-core/-/jasmine-core-4.5.0.tgz\",\n+      \"integrity\": \"sha512-9PMzyvhtocxb3aXJVOPqBDswdgyAeSB81QnLop4npOpbqnheaTEwPc9ZloQeVswugPManznQBjD8kWDTjlnHuw==\",\n       \"dev\": true\n     },\n     \"node_modules/jasmine-spec-reporter\": {\n@@ -7575,6 +7575,12 @@\n         \"karma-jasmine\": \">=1.1\"\n       }\n     },\n+    \"node_modules/karma-jasmine/node_modules/jasmine-core\": {\n+      \"version\": \"3.99.1\",\n+      \"resolved\": \"https://registry.npmjs.org/jasmine-core/-/jasmine-core-3.99.1.tgz\",\n+      \"integrity\": \"sha512-Hu1dmuoGcZ7AfyynN3LsfruwMbxMALMka+YtZeGoLuDEySVmVAPaonkNoBRIw/ectu8b9tVQCJNgp4a4knp+tg==\",\n+      \"dev\": true\n+    },\n     \"node_modules/karma-source-map-support\": {\n       \"version\": \"1.4.0\",\n       \"resolved\": \"https://registry.npmjs.org/karma-source-map-support/-/karma-source-map-support-1.4.0.tgz\",\n@@ -18139,9 +18145,9 @@\n       }\n     },\n     \"jasmine-core\": {\n-      \"version\": \"3.6.0\",\n-      \"resolved\": \"https://registry.npmjs.org/jasmine-core/-/jasmine-core-3.6.0.tgz\",\n-      \"integrity\": \"sha512-8uQYa7zJN8hq9z+g8z1bqCfdC8eoDAeVnM5sfqs7KHv9/ifoJ500m018fpFc7RDaO6SWCLCXwo/wPSNcdYTgcw==\",\n+      \"version\": \"4.5.0\",\n+      \"resolved\": \"https://registry.npmjs.org/jasmine-core/-/jasmine-core-4.5.0.tgz\",\n+      \"integrity\": \"sha512-9PMzyvhtocxb3aXJVOPqBDswdgyAeSB81QnLop4npOpbqnheaTEwPc9ZloQeVswugPManznQBjD8kWDTjlnHuw==\",\n       \"dev\": true\n     },\n     \"jasmine-spec-reporter\": {\n@@ -18505,6 +18511,14 @@\n       \"dev\": true,\n       \"requires\": {\n         \"jasmine-core\": \"^3.6.0\"\n+      },\n+      \"dependencies\": {\n+        \"jasmine-core\": {\n+          \"version\": \"3.99.1\",\n+          \"resolved\": \"https://registry.npmjs.org/jasmine-core/-/jasmine-core-3.99.1.tgz\",\n+          \"integrity\": \"sha512-Hu1dmuoGcZ7AfyynN3LsfruwMbxMALMka+YtZeGoLuDEySVmVAPaonkNoBRIw/ectu8b9tVQCJNgp4a4knp+tg==\",\n+          \"dev\": true\n+        }\n       }\n     },\n     \"karma-jasmine-html-reporter\": {\n\n---\n file path A: aio/content/examples/marketing-first-app/package.json | file path B: aio/content/examples/marketing-first-app/package.json\n\n@@ -28,7 +28,7 @@\n     \"@types/jasmine\": \"~3.6.0\",\n     \"@types/node\": \"^12.11.1\",\n     \"codelyzer\": \"^6.0.0\",\n-    \"jasmine-core\": \"~3.6.0\",\n+    \"jasmine-core\": \"~4.5.0\",\n     \"jasmine-spec-reporter\": \"~5.0.0\",\n     \"karma\": \"~6.4.1\",\n     \"karma-chrome-launcher\": \"~3.1.0\",\n\n\n###\n\n", "completion": "build: update dependency jasmine-core to v4 (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/aio-preview-build.yml | file path B: .github/workflows/aio-preview-build.yml\n\n@@ -19,8 +19,8 @@ jobs:\n     # We only want to build and deploy the AIO app if the `aio: preview` label has been\n     # added, or if the label is already applied and new changes have been made in the PR.\n     if: |\n-      (github.event.action == 'labeled' && github.event.label.name == 'test preview') ||\n-      (github.event.action == 'synchronize' && contains(github.event.pull_request.labels.*.name, 'test preview'))\n+      (github.event.action == 'labeled' && github.event.label.name == 'aio: preview') ||\n+      (github.event.action == 'synchronize' && contains(github.event.pull_request.labels.*.name, 'aio: preview'))\n     steps:\n       - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n       - uses: ./.github/actions/yarn-install\n\n\n###\n\n", "completion": "build: switch new AIO preview action to use `aio: preview` label (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/render3/assert.ts | file path B: packages/core/src/render3/assert.ts\n\n@@ -73,12 +73,6 @@ export function assertHasParent(tNode: TNode|null) {\n   assertDefined(tNode!.parent, 'currentTNode should have a parent');\n }\n \n-export function assertDataNext(lView: LView, index: number, arr?: any[]) {\n-  if (arr == null) arr = lView;\n-  assertEqual(\n-      arr.length, index, `index ${index} expected to be at the end of arr (length ${arr.length})`);\n-}\n-\n export function assertLContainer(value: any): asserts value is LContainer {\n   assertDefined(value, 'LContainer must be defined');\n   assertEqual(isLContainer(value), true, 'Expecting LContainer');\n\n---\n file path A: packages/core/src/render3/namespaces.ts | file path B: packages/core/src/render3/namespaces.ts\n\n@@ -7,12 +7,4 @@\n  */\n \n export const SVG_NAMESPACE = 'svg';\n-export const SVG_NAMESPACE_URI = 'http://www.w3.org/2000/svg';\n export const MATH_ML_NAMESPACE = 'math';\n-export const MATH_ML_NAMESPACE_URI = 'http://www.w3.org/1998/MathML/';\n-\n-export function getNamespaceUri(namespace: string): string|null {\n-  const name = namespace.toLowerCase();\n-  return name === SVG_NAMESPACE ? SVG_NAMESPACE_URI :\n-                                  (name === MATH_ML_NAMESPACE ? MATH_ML_NAMESPACE_URI : null);\n-}\n\n---\n file path A: packages/core/src/render3/state.ts | file path B: packages/core/src/render3/state.ts\n\n@@ -338,9 +338,6 @@ export function isCurrentTNodeParent(): boolean {\n export function setCurrentTNodeAsNotParent(): void {\n   instructionState.lFrame.isParent = false;\n }\n-export function setCurrentTNodeAsParent(): void {\n-  instructionState.lFrame.isParent = true;\n-}\n \n export function getContextLView(): LView {\n   const contextLView = instructionState.lFrame.contextLView;\n\n---\n file path A: packages/core/src/render3/util/view_utils.ts | file path B: packages/core/src/render3/util/view_utils.ts\n\n@@ -58,20 +58,6 @@ export function unwrapLView(value: RNode|LView|LContainer): LView|null {\n   return null;\n }\n \n-/**\n- * Returns `LContainer` or `null` if not found.\n- * @param value wrapped value of `RNode`, `LView`, `LContainer`\n- */\n-export function unwrapLContainer(value: RNode|LView|LContainer): LContainer|null {\n-  while (Array.isArray(value)) {\n-    // This check is same as `isLContainer()` but we don't call at as we don't want to call\n-    // `Array.isArray()` twice and give JITer more work for inlining.\n-    if (value[TYPE] === true) return value as LContainer;\n-    value = value[HOST] as any;\n-  }\n-  return null;\n-}\n-\n /**\n  * Retrieves an element value from the provided `viewData`, by unwrapping\n  * from any containers, component views, or style contexts.\n\n---\n file path A: packages/core/src/util/array_utils.ts | file path B: packages/core/src/util/array_utils.ts\n\n@@ -8,18 +8,6 @@\n \n import {assertEqual, assertLessThanOrEqual} from './assert';\n \n-/**\n- * Equivalent to ES6 spread, add each item to an array.\n- *\n- * @param items The items to add\n- * @param arr The array to which you want to add the items\n- */\n-export function addAllToArray(items: any[], arr: any[]) {\n-  for (let i = 0; i < items.length; i++) {\n-    arr.push(items[i]);\n-  }\n-}\n-\n /**\n  * Determines if the contents of two arrays is identical\n  *\n@@ -180,48 +168,6 @@ export function arrayInsert2(array: any[], index: number, value1: any, value2: a\n   }\n }\n \n-/**\n- * Insert a `value` into an `array` so that the array remains sorted.\n- *\n- * NOTE:\n- * - Duplicates are not allowed, and are ignored.\n- * - This uses binary search algorithm for fast inserts.\n- *\n- * @param array A sorted array to insert into.\n- * @param value The value to insert.\n- * @returns index of the inserted value.\n- */\n-export function arrayInsertSorted(array: string[], value: string): number {\n-  let index = arrayIndexOfSorted(array, value);\n-  if (index < 0) {\n-    // if we did not find it insert it.\n-    index = ~index;\n-    arrayInsert(array, index, value);\n-  }\n-  return index;\n-}\n-\n-/**\n- * Remove `value` from a sorted `array`.\n- *\n- * NOTE:\n- * - This uses binary search algorithm for fast removals.\n- *\n- * @param array A sorted array to remove from.\n- * @param value The value to remove.\n- * @returns index of the removed value.\n- *   - positive index if value found and removed.\n- *   - negative index if value not found. (`~index` to get the value where it should have been\n- *     inserted)\n- */\n-export function arrayRemoveSorted(array: string[], value: string): number {\n-  const index = arrayIndexOfSorted(array, value);\n-  if (index >= 0) {\n-    arraySplice(array, index, 1);\n-  }\n-  return index;\n-}\n-\n \n /**\n  * Get an index of an `value` in a sorted `array`.\n\n---\n file path A: packages/core/test/util/array_utils_spec.ts | file path B: packages/core/test/util/array_utils_spec.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {arrayIndexOfSorted, arrayInsert, arrayInsert2, arrayInsertSorted, arrayRemoveSorted, arraySplice, flatten, KeyValueArray, keyValueArrayDelete, keyValueArrayGet, keyValueArrayIndexOf, keyValueArraySet} from '../../src/util/array_utils';\n+import {arrayIndexOfSorted, arrayInsert, arrayInsert2, arraySplice, flatten, KeyValueArray, keyValueArrayDelete, keyValueArrayGet, keyValueArrayIndexOf, keyValueArraySet} from '../../src/util/array_utils';\n \n describe('array_utils', () => {\n   describe('flatten', () => {\n@@ -76,59 +76,6 @@ describe('array_utils', () => {\n     });\n   });\n \n-  describe('arrayInsertSorted', () => {\n-    it('should insert items don\\'t allow duplicates', () => {\n-      let a;\n-      a = ['a', 'c', 'e', 'g', 'i'];\n-      expect(arrayInsertSorted(a, 'a')).toEqual(0);\n-      expect(a).toEqual(['a', 'c', 'e', 'g', 'i']);\n-\n-      a = ['a', 'c', 'e', 'g', 'i'];\n-      expect(arrayInsertSorted(a, 'b')).toEqual(1);\n-      expect(a).toEqual(['a', 'b', 'c', 'e', 'g', 'i']);\n-\n-      a = ['a', 'c', 'e', 'g', 'i'];\n-      expect(arrayInsertSorted(a, 'c')).toEqual(1);\n-      expect(a).toEqual(['a', 'c', 'e', 'g', 'i']);\n-\n-      a = ['a', 'c', 'e', 'g', 'i'];\n-      expect(arrayInsertSorted(a, 'd')).toEqual(2);\n-      expect(a).toEqual(['a', 'c', 'd', 'e', 'g', 'i']);\n-\n-      a = ['a', 'c', 'e', 'g', 'i'];\n-      expect(arrayInsertSorted(a, 'e')).toEqual(2);\n-      expect(a).toEqual(['a', 'c', 'e', 'g', 'i']);\n-    });\n-  });\n-\n-\n-\n-  describe('arrayRemoveSorted', () => {\n-    it('should remove items', () => {\n-      let a;\n-      a = ['a', 'b', 'c', 'd', 'e'];\n-      expect(arrayRemoveSorted(a, 'a')).toEqual(0);\n-      expect(a).toEqual(['b', 'c', 'd', 'e']);\n-\n-      a = ['a', 'b', 'c', 'd', 'e'];\n-      expect(arrayRemoveSorted(a, 'b')).toEqual(1);\n-      expect(a).toEqual(['a', 'c', 'd', 'e']);\n-\n-      a = ['a', 'b', 'c', 'd', 'e'];\n-      expect(arrayRemoveSorted(a, 'c')).toEqual(2);\n-      expect(a).toEqual(['a', 'b', 'd', 'e']);\n-\n-      a = ['a', 'b', 'c', 'd', 'e'];\n-      expect(arrayRemoveSorted(a, 'd')).toEqual(3);\n-      expect(a).toEqual(['a', 'b', 'c', 'e']);\n-\n-      a = ['a', 'b', 'c', 'd', 'e'];\n-      expect(arrayRemoveSorted(a, 'e')).toEqual(4);\n-      expect(a).toEqual(['a', 'b', 'c', 'd']);\n-    });\n-  });\n-\n-\n   describe('arrayIndexOfSorted', () => {\n     it('should get index of', () => {\n       const a = ['a', 'b', 'c', 'd', 'e'];\n\n\n###\n\n", "completion": "refactor(core): remove several private utils and APIs (#<issue-num>)"}
{"prompt": " file path A: packages/compiler/src/render3/view/i18n/context.ts | file path B: packages/compiler/src/render3/view/i18n/context.ts\n\n@@ -198,7 +198,6 @@ function findTemplateFn(ctx: number, templateIndex: number|null) {\n function serializePlaceholderValue(value: any): string {\n   const element = (data: any, closed?: boolean) => wrapTag('#', data, closed);\n   const template = (data: any, closed?: boolean) => wrapTag('*', data, closed);\n-  const projection = (data: any, closed?: boolean) => wrapTag('!', data, closed);\n \n   switch (value.type) {\n     case TagType.ELEMENT:\n\n\n###\n\n", "completion": "refactor(compiler): remove unused `projection` const (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/dom_adapter.ts | file path B: packages/common/src/dom_adapter.ts\n\n@@ -12,10 +12,6 @@ export function getDOM(): DomAdapter {\n   return _DOM;\n }\n \n-export function setDOM(adapter: DomAdapter) {\n-  _DOM = adapter;\n-}\n-\n export function setRootDomAdapter(adapter: DomAdapter) {\n   if (!_DOM) {\n     _DOM = adapter;\n\n\n###\n\n", "completion": "refactor(common): remove unused `setDOM` (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -75,6 +75,14 @@ const ASPECT_RATIO_TOLERANCE = .1;\n  */\n const OVERSIZED_IMAGE_TOLERANCE = 1000;\n \n+/**\n+ * Used to limit automatic srcset generation of very large sources for\n+ * fixed-size images. In pixels.\n+ */\n+const FIXED_SRCSET_WIDTH_LIMIT = 1920;\n+const FIXED_SRCSET_HEIGHT_LIMIT = 1080;\n+\n+\n /** Info about built-in loaders we can test for. */\n export const BUILT_IN_LOADERS = [imgixLoaderInfo, imageKitLoaderInfo, cloudinaryLoaderInfo];\n \n@@ -422,8 +430,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n \n     if (this.ngSrcset) {\n       rewrittenSrcset = this.getRewrittenSrcset();\n-    } else if (\n-        !this._disableOptimizedSrcset && !this.srcset && this.imageLoader !== noopImageLoader) {\n+    } else if (this.shouldGenerateAutomaticSrcset()) {\n       rewrittenSrcset = this.getAutomaticSrcset();\n     }\n \n@@ -517,6 +524,11 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n     return finalSrcs.join(', ');\n   }\n \n+  private shouldGenerateAutomaticSrcset(): boolean {\n+    return !this._disableOptimizedSrcset && !this.srcset && this.imageLoader !== noopImageLoader &&\n+        !(this.width! > FIXED_SRCSET_WIDTH_LIMIT || this.height! > FIXED_SRCSET_HEIGHT_LIMIT);\n+  }\n+\n   /** @nodoc */\n   ngOnDestroy() {\n     if (ngDevMode) {\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -1496,6 +1496,30 @@ describe('Image directive', () => {\n             .toBe(`${IMG_BASE_URL}/img?w=100 1x, ${IMG_BASE_URL}/img?w=200 2x`);\n       });\n \n+      it('should not add a fixed srcset to the img element if height is too large', () => {\n+        setupTestingModule({imageLoader});\n+\n+        const template = `<img ngSrc=\"img\" width=\"1100\" height=\"2400\">`;\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+\n+        const nativeElement = fixture.nativeElement as HTMLElement;\n+        const img = nativeElement.querySelector('img')!;\n+        expect(img.getAttribute('srcset')).toBeNull();\n+      });\n+\n+      it('should not add a fixed srcset to the img element if width is too large', () => {\n+        setupTestingModule({imageLoader});\n+\n+        const template = `<img ngSrc=\"img\" width=\"3000\" height=\"400\">`;\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+\n+        const nativeElement = fixture.nativeElement as HTMLElement;\n+        const img = nativeElement.querySelector('img')!;\n+        expect(img.getAttribute('srcset')).toBeNull();\n+      });\n+\n       it('should use a custom breakpoint set if one is provided', () => {\n         const imageConfig = {\n           breakpoints: [16, 32, 48, 64, 96, 128, 256, 384, 640, 1280, 3840],\n\n\n###\n\n", "completion": "fix(common): Don't generate srcsets with very large sources (#<issue-num>)"}
{"prompt": " file path A: .ng-dev/github.mts | file path B: .ng-dev/github.mts\n\n@@ -8,4 +8,5 @@ export const github: GithubConfig = {\n   owner: 'angular',\n   name: 'angular',\n   mainBranchName: 'main',\n+  useNgDevAuthService: true,\n };\n\n\n###\n\n", "completion": "build: enable the ng-dev auth service (#<issue-num>)"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -678,6 +678,16 @@ jobs:\n             - *cache_key_win\n             - *cache_key_win_fallback\n \n+      - run:\n+          name: Debug information for flakiness of Windows job\n+          command: |\n+            node -v\n+            yarn -v\n+            which node\n+            which yarn\n+            echo \"Path: $PATH\"\n+            yarn node -v\n+\n       # Install project dependencies, and install Bazelisk globally. This is necessary as\n       # Windows might error when `bazel` is invoked from the project node modules. The Bazel\n       # invocation might modify the symlinked project `node_modules` again, causing failures.\n\n\n###\n\n", "completion": "build: add more debug information for occasional windows flakiness (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/animations/src/app/about.component.ts | file path B: aio/content/examples/animations/src/app/about.component.ts\n\n@@ -1,15 +1,10 @@\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n \n @Component({\n   selector: 'app-about',\n   templateUrl: './about.component.html',\n   styleUrls: ['./about.component.css']\n })\n-export class AboutComponent implements OnInit {\n-\n-  constructor() { }\n-\n-  ngOnInit() {\n-  }\n+export class AboutComponent {\n \n }\n\n---\n file path A: aio/content/examples/attribute-directives/src/app/highlight.directive.0.ts | file path B: aio/content/examples/attribute-directives/src/app/highlight.directive.0.ts\n\n@@ -5,5 +5,5 @@ import { Directive } from '@angular/core';\n   selector: '[appHighlight]'\n })\n export class HighlightDirective {\n-  constructor() { }\n+\n }\n\n---\n file path A: aio/content/examples/dependency-injection/src/app/heroes/hero.service.0.ts | file path B: aio/content/examples/dependency-injection/src/app/heroes/hero.service.0.ts\n\n@@ -4,5 +4,5 @@ import { Injectable } from '@angular/core';\n   providedIn: 'root',\n })\n export class HeroService {\n-  constructor() { }\n+\n }\n\n\n###\n\n", "completion": "docs: removed empty methods (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/upgrade-module/BUILD.bazel | file path B: aio/content/examples/upgrade-module/BUILD.bazel\n\n@@ -5,6 +5,7 @@ package(default_visibility = [\"//visibility:public\"])\n \n docs_example(\n     name = \"upgrade-module\",\n+    flaky = True,  # TODO: figure out why this is flaky or times out\n     # This example downloads and inlines resources\n     test_exec_properties = ENABLE_NETWORK,\n     test_tags = [\"requires-network\"],\n\n\n###\n\n", "completion": "build(bazel): mark an AIO sjs e2e test as flakey (#<issue-num>)"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -338,7 +338,9 @@ jobs:\n       - run: yarn --cwd aio payload-size\n \n   deploy_aio:\n-    executor: test-browser-executor\n+    executor:\n+      name: test-browser-executor\n+      resource_class: 2xlarge+\n     steps:\n       - custom_attach_workspace\n       - init_environment\n@@ -363,7 +365,9 @@ jobs:\n \n   # This job should only be run on PR builds, where `CI_PULL_REQUEST` is not `false`.\n   aio_preview:\n-    executor: default-executor\n+    executor:\n+      name: default-executor\n+      resource_class: 2xlarge+\n     environment:\n       AIO_SNAPSHOT_ARTIFACT_PATH: &aio_preview_artifact_path 'aio/tmp/snapshot.tgz'\n     steps:\n\n\n###\n\n", "completion": "build(bazel): set ci steps that build aio to 2xlarge+ (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/aio-preview-deploy.yml | file path B: .github/workflows/aio-preview-deploy.yml\n\n@@ -16,6 +16,10 @@ permissions:\n   # Needed in order to be able to comment on the pull request.\n   pull-requests: write\n \n+env:\n+  # TODO(pgschwendtner): use a different project for framework previews here.\n+  PREVIEW_PROJECT: ng-comp-dev\n+\n jobs:\n   aio-deploy:\n     runs-on: ubuntu-latest\n@@ -27,9 +31,9 @@ jobs:\n         working-directory: aio/\n         run: |\n           # We can use `npx` as the Firebase deploy actions uses it too.\n-          npx -y firebase-tools@latest use ng-comp-dev\n-          npx -y firebase-tools@latest target:clear hosting aio\n-          npx -y firebase-tools@latest target:apply hosting aio ng-comp-dev\n+          # The default site is used as we don't use multi-sites in the project.\n+          npx -y firebase-tools@latest target:clear --project ${{env.PREVIEW_PROJECT}} hosting aio\n+          npx -y firebase-tools@latest target:apply --project ${{env.PREVIEW_PROJECT}} hosting aio ${{env.PREVIEW_PROJECT}}\n \n       - uses: angular/dev-infra/github-actions/deploy-previews/upload-artifacts-to-firebase@3bc93449e11b733260d0294305bf57240d7e0a81\n         with:\n@@ -37,6 +41,5 @@ jobs:\n           workflow-artifact-name: 'aio'\n           firebase-config-dir: './aio/'\n           firebase-public-dir: './aio/dist'\n-          # TODO(pgschwendtner): use a different project for framework previews here / or combine.\n-          firebase-project-id: 'ng-comp-dev'\n+          firebase-project-id: '${{env.PREVIEW_PROJECT}}'\n           firebase-service-key: '${{secrets.FIREBASE_PREVIEW_SERVICE_TOKEN}}'\n\n\n###\n\n", "completion": "build: set target firebase project when setting deploy target (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/aio-preview-deploy.yml | file path B: .github/workflows/aio-preview-deploy.yml\n\n@@ -27,6 +27,7 @@ jobs:\n         working-directory: aio/\n         run: |\n           # We can use `npx` as the Firebase deploy actions uses it too.\n+          npx -y firebase-tools@latest use ng-comp-dev\n           npx -y firebase-tools@latest target:clear hosting aio\n           npx -y firebase-tools@latest target:apply hosting aio ng-comp-dev\n \n\n\n###\n\n", "completion": "build: check out project before setting AIO preview targets (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/aio-preview-deploy.yml | file path B: .github/workflows/aio-preview-deploy.yml\n\n@@ -24,9 +24,11 @@ jobs:\n       - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3\n \n       - name: Configure Firebase deploy target\n+        working-directory: aio/\n         run: |\n-          yarn --cwd aio firebase target:clear hosting aio\n-          yarn --cwd aio firebase target:apply hosting aio ng-comp-dev\n+          # We can use `npx` as the Firebase deploy actions uses it too.\n+          npx -y firebase-tools@latest target:clear hosting aio\n+          npx -y firebase-tools@latest target:apply hosting aio ng-comp-dev\n \n       - uses: angular/dev-infra/github-actions/deploy-previews/upload-artifacts-to-firebase@3bc93449e11b733260d0294305bf57240d7e0a81\n         with:\n\n\n###\n\n", "completion": "build: use npx for setting firebase deploy targets in AIO preview (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/aio-preview-deploy.yml | file path B: .github/workflows/aio-preview-deploy.yml\n\n@@ -22,6 +22,12 @@ jobs:\n     if: ${{ github.event.workflow_run.conclusion == 'success' }}\n     steps:\n       - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3\n+\n+      - name: Configure Firebase deploy target\n+        run: |\n+          yarn --cwd aio firebase target:clear hosting aio\n+          yarn --cwd aio firebase target:apply hosting aio ng-comp-dev\n+\n       - uses: angular/dev-infra/github-actions/deploy-previews/upload-artifacts-to-firebase@3bc93449e11b733260d0294305bf57240d7e0a81\n         with:\n           github-token: '${{secrets.GITHUB_TOKEN}}'\n\n\n###\n\n", "completion": "build: set firebase deploy target when deploying AIO preview (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/aio-preview-build.yml | file path B: .github/workflows/aio-preview-build.yml\n\n@@ -22,7 +22,7 @@ jobs:\n       (github.event.action == 'labeled' && github.event.label.name == 'test preview') ||\n       (github.event.action == 'synchronize' && contains(github.event.pull_request.labels.*.name, 'test preview'))\n     steps:\n-      - uses: actions/checkout@722adc63f1aa60a57ec37892e133b1d319cae598 # tag=v2.0.0\n+      - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n       - uses: ./.github/actions/yarn-install\n \n       - uses: angular/dev-infra/github-actions/setup-bazel-remote-exec@3bc93449e11b733260d0294305bf57240d7e0a81\n\n---\n file path A: .github/workflows/aio-preview-deploy.yml | file path B: .github/workflows/aio-preview-deploy.yml\n\n@@ -21,7 +21,7 @@ jobs:\n     runs-on: ubuntu-latest\n     if: ${{ github.event.workflow_run.conclusion == 'success' }}\n     steps:\n-      - uses: actions/checkout@e2f20e631ae6d7dd3b768f56a5d2af784dd54791 # tag=v2\n+      - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3\n       - uses: angular/dev-infra/github-actions/deploy-previews/upload-artifacts-to-firebase@3bc93449e11b733260d0294305bf57240d7e0a81\n         with:\n           github-token: '${{secrets.GITHUB_TOKEN}}'\n\n\n###\n\n", "completion": "build: update actions/checkout action to v3 (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/aio-preview-build.yml | file path B: .github/workflows/aio-preview-build.yml\n\n@@ -22,7 +22,7 @@ jobs:\n       (github.event.action == 'labeled' && github.event.label.name == 'test preview') ||\n       (github.event.action == 'synchronize' && contains(github.event.pull_request.labels.*.name, 'test preview'))\n     steps:\n-      - uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579 # renovate: tag=v2.0.0\n+      - uses: actions/checkout@722adc63f1aa60a57ec37892e133b1d319cae598 # tag=v2.0.0\n       - uses: ./.github/actions/yarn-install\n \n       - uses: angular/dev-infra/github-actions/setup-bazel-remote-exec@3bc93449e11b733260d0294305bf57240d7e0a81\n\n---\n file path A: .github/workflows/aio-preview-deploy.yml | file path B: .github/workflows/aio-preview-deploy.yml\n\n@@ -21,7 +21,7 @@ jobs:\n     runs-on: ubuntu-latest\n     if: ${{ github.event.workflow_run.conclusion == 'success' }}\n     steps:\n-      - uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579 # renovate: tag=v2\n+      - uses: actions/checkout@e2f20e631ae6d7dd3b768f56a5d2af784dd54791 # tag=v2\n       - uses: angular/dev-infra/github-actions/deploy-previews/upload-artifacts-to-firebase@3bc93449e11b733260d0294305bf57240d7e0a81\n         with:\n           github-token: '${{secrets.GITHUB_TOKEN}}'\n\n\n###\n\n", "completion": "build: update actions/checkout digest (#<issue-num>)"}
{"prompt": " file path A: None | file path B: .github/workflows/aio-preview-build.yml\n\n@@ -0,0 +1,42 @@\n+# This workflow builds the AIO previews for pull requests when a certain label is applied.\n+# The actual deployment happens as part of a dedicated second workflow to avoid security\n+# issues where the building would otherwise occur in an authorized context where secrets\n+# could be leaked. More details can be found here:\n+\n+# https://securitylab.github.com/research/github-actions-preventing-pwn-requests/.\n+\n+name: Build AIO app for preview deployment\n+\n+on:\n+  pull_request:\n+    types: [synchronize, labeled]\n+\n+permissions: read-all\n+\n+jobs:\n+  aio-build:\n+    runs-on: ubuntu-latest\n+    # We only want to build and deploy the AIO app if the `aio: preview` label has been\n+    # added, or if the label is already applied and new changes have been made in the PR.\n+    if: |\n+      (github.event.action == 'labeled' && github.event.label.name == 'test preview') ||\n+      (github.event.action == 'synchronize' && contains(github.event.pull_request.labels.*.name, 'test preview'))\n+    steps:\n+      - uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579 # renovate: tag=v2.0.0\n+      - uses: ./.github/actions/yarn-install\n+\n+      - uses: angular/dev-infra/github-actions/setup-bazel-remote-exec@3bc93449e11b733260d0294305bf57240d7e0a81\n+        with:\n+          bazelrc: ./.bazelrc.user\n+\n+      # Build the web package. Note: We run Bazel from a low-resource Github action container,\n+      # so we manually need to instruct Bazel to run more actions concurrently as by default\n+      # the number of concurrent actions is determined based on the host resources.\n+      - run: bazel build //aio:build --jobs=32 --announce_rc --verbose_failures\n+\n+      - uses: angular/dev-infra/github-actions/deploy-previews/pack-and-upload-artifact@3bc93449e11b733260d0294305bf57240d7e0a81\n+        with:\n+          workflow-artifact-name: 'aio'\n+          pull-number: '${{github.event.pull_request.number}}'\n+          artifact-build-revision: '${{github.event.pull_request.head.sha}}'\n+          deploy-directory: './dist/bin/aio/build'\n\n---\n file path A: None | file path B: .github/workflows/aio-preview-deploy.yml\n\n@@ -0,0 +1,33 @@\n+# This workflow runs whenever the AIO build workflow has completed. Deployment happens\n+# as part of a dedicated second workflow to avoid security issues where the building would\n+# otherwise occur in an authorized context where secrets could be leaked.\n+#\n+# More details can be found here:\n+# https://securitylab.github.com/research/github-actions-preventing-pwn-requests/.\n+\n+name: Deploying AIO preview to Firebase\n+\n+on:\n+  workflow_run:\n+    workflows: ['Build AIO app for preview deployment']\n+    types: [completed]\n+\n+permissions:\n+  # Needed in order to be able to comment on the pull request.\n+  pull-requests: write\n+\n+jobs:\n+  aio-deploy:\n+    runs-on: ubuntu-latest\n+    if: ${{ github.event.workflow_run.conclusion == 'success' }}\n+    steps:\n+      - uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579 # renovate: tag=v2\n+      - uses: angular/dev-infra/github-actions/deploy-previews/upload-artifacts-to-firebase@3bc93449e11b733260d0294305bf57240d7e0a81\n+        with:\n+          github-token: '${{secrets.GITHUB_TOKEN}}'\n+          workflow-artifact-name: 'aio'\n+          firebase-config-dir: './aio/'\n+          firebase-public-dir: './aio/dist'\n+          # TODO(pgschwendtner): use a different project for framework previews here / or combine.\n+          firebase-project-id: 'ng-comp-dev'\n+          firebase-service-key: '${{secrets.FIREBASE_PREVIEW_SERVICE_TOKEN}}'\n\n\n###\n\n", "completion": "build: setup github actions for preview deployment of AIO (#<issue-num>)"}
{"prompt": " file path A: None | file path B: .github/actions/yarn-install/action.yml\n\n@@ -0,0 +1,17 @@\n+name: 'Installing Yarn dependencies'\n+description: 'Installs the dependencies using Yarn'\n+\n+runs:\n+  using: 'composite'\n+  steps:\n+    - uses: actions/cache@9b0c1fce7a93df8e3bb8926b0d6e9d89e92f20a7 # tag=v3\n+      with:\n+        path: |\n+          ./node_modules/\n+        # If just `WORKSPACE` or `yarn.lock` is changed, the most recent cache can be restored.\n+        # See: https://docs.github.com/en/actions/guides/caching-dependencies-to-speed-up-workflows#example-using-the-cache-action.\n+        key: v1-angular-main-deps-${{hashFiles('WORKSPACE')}}-${{hashFiles('yarn.lock')}}\n+        restore-keys: v1-angular-main-deps-\n+\n+    - run: yarn install --frozen-lockfile --non-interactive\n+      shell: bash\n\n\n###\n\n", "completion": "build: introduce common action for installing dependencies w/ cache in actions (#<issue-num>)"}
{"prompt": " file path A: .circleci/env.windows.sh | file path B: .circleci/env.windows.sh\n\n@@ -3,6 +3,9 @@\n ####################################################################################################\n cp \"${PROJECT_ROOT}/.circleci/bazel.windows.rc\" \".bazelrc.user\";\n \n+# Override the `PATH` environment variable so that the windows-nvm NodeJS version\n+# always has precedence over potential existing NodeJS versions from the image.\n+setPublicVar PATH \"/c/Program Files/nodejs/:$PATH\"\n \n # Expose the Bazelisk version. We need to run Bazelisk globally since Windows has problems launching\n # Bazel from a node modules directoy that might be modified by the Bazel Yarn install then.\n\n\n###\n\n", "completion": "build: attempt to avoid nodejs version flakiness in `test_win` job (#<issue-num>)"}
{"prompt": " file path A: None | file path B: aio/content/extended-diagnostics/NG8105.md\n\n@@ -0,0 +1,48 @@\n+@name Missing `let` keyword in an *ngFor expression\n+\n+@description\n+\n+This diagnostic is emitted when an expression used in `*ngFor` is missing the `let` keyword.\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+\n+import {Component} from '&commat;angular/core';\n+\n+&commat;Component({\n+  // The `let` keyword is missing in the `*ngFor` expression.\n+  template: `&lt;div *ngFor=\"item of items\"&gt;{{ item }}&lt;/div&gt;`,\n+  // &hellip;\n+})\n+class MyComponent {\n+  items = [1, 2, 3];\n+}\n+\n+</code-example>\n+\n+## How to resolve the problem\n+\n+Add the missing `let` keyword.\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+\n+import {Component} from '&commat;angular/core';\n+\n+&commat;Component({\n+  // The `let` keyword is now present in the `*ngFor` expression,\n+  // no diagnostic messages are emitted in this case.\n+  template: `&lt;div *ngFor=\"let item of items\"&gt;{{ item }}&lt;/div&gt;`,\n+  // &hellip;\n+})\n+class MyComponent {\n+  items = [1, 2, 3];\n+}\n+\n+</code-example>\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-12-01\n\n---\n file path A: aio/content/extended-diagnostics/index.md | file path B: aio/content/extended-diagnostics/index.md\n\n@@ -11,6 +11,7 @@ Currently, Angular supports the following extended diagnostics:\n *   [NG8101 - `invalidBananaInBox`](extended-diagnostics/NG8101)\n *   [NG8102 - `nullishCoalescingNotNullable`](extended-diagnostics/NG8102)\n *   [NG8103 - `missingControlFlowDirective`](extended-diagnostics/NG8103)\n+*   [NG8105 - `missingNgForOfLet`](extended-diagnostics/NG8105)\n *   [NG8106 - `suffixNotSupported`](extended-diagnostics/NG8106)\n \n ## Configuration\n\n\n###\n\n", "completion": "docs: added `missingNgForOfLet` extended diagnostics details page (#<issue-num>)"}
{"prompt": " file path A: None | file path B: aio/content/extended-diagnostics/NG8103.md\n\n@@ -0,0 +1,68 @@\n+@name Missing control flow directive\n+\n+@description\n+\n+This diagnostics ensures that a standalone component which uses known control flow directives\n+(such as `*ngIf`, `*ngFor`, `*ngSwitch`) in a template, also imports those directives either\n+individually or by importing the `CommonModule`.\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+\n+import {Component} from '&commat;angular/core';\n+\n+&commat;Component({\n+  standalone: true,\n+  // Template uses `*ngIf`, but no corresponding directive imported.\n+  template: `&lt;div *ngIf=\"visible\"&gt;Hi&lt;/div&gt;`,\n+  // &hellip;\n+})\n+class MyComponent {}\n+\n+</code-example>\n+\n+## How to fix the problem\n+\n+Make sure that a corresponding control flow directive is imported.\n+\n+A directive can be imported individually:\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+\n+import {Component} from '&commat;angular/core';\n+import {NgIf} from '&commat;angular/common';\n+\n+&commat;Component({\n+  standalone: true,\n+  imports: [NgIf],\n+  template: `&lt;div *ngIf=\"visible\"&gt;Hi&lt;/div&gt;`,\n+  // &hellip;\n+})\n+class MyComponent {}\n+\n+</code-example>\n+\n+or you could import the entire `CommonModule`, which contains all control flow directives:\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+\n+import {Component} from '&commat;angular/core';\n+import {CommonModule} from '&commat;angular/common';\n+\n+&commat;Component({\n+  standalone: true,\n+  imports: [CommonModule],\n+  template: `&lt;div *ngIf=\"visible\"&gt;Hi&lt;/div&gt;`,\n+  // &hellip;\n+})\n+class MyComponent {}\n+\n+</code-example>\n+\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-02-28\n\n---\n file path A: aio/content/extended-diagnostics/index.md | file path B: aio/content/extended-diagnostics/index.md\n\n@@ -10,6 +10,7 @@ Currently, Angular supports the following extended diagnostics:\n \n *   [NG8101 - `invalidBananaInBox`](extended-diagnostics/NG8101)\n *   [NG8102 - `nullishCoalescingNotNullable`](extended-diagnostics/NG8102)\n+*   [NG8103 - `missingControlFlowDirective`](extended-diagnostics/NG8103)\n *   [NG8106 - `suffixNotSupported`](extended-diagnostics/NG8106)\n \n ## Configuration\n\n\n###\n\n", "completion": "docs: added `missingControlFlowDirective` extended diagnostics details page (#<issue-num>)"}
{"prompt": " file path A: packages/platform-browser/src/dom/dom_renderer.ts | file path B: packages/platform-browser/src/dom/dom_renderer.ts\n\n@@ -35,19 +35,10 @@ export function shimHostAttribute(componentShortId: string): string {\n   return HOST_ATTR.replace(COMPONENT_REGEX, componentShortId);\n }\n \n-export function flattenStyles(\n-    compId: string, styles: Array<any|any[]>, target: string[]): string[] {\n-  for (let i = 0; i < styles.length; i++) {\n-    let style = styles[i];\n-\n-    if (Array.isArray(style)) {\n-      flattenStyles(compId, style, target);\n-    } else {\n-      style = style.replace(COMPONENT_REGEX, compId);\n-      target.push(style);\n-    }\n-  }\n-  return target;\n+export function flattenStyles(compId: string, styles: Array<string|string[]>): string[] {\n+  // Cannot use `Infinity` as depth as `infinity` is not a number literal in TypeScript.\n+  // See: https://github.com/microsoft/TypeScript/issues/32277\n+  return styles.flat(100).map(s => s.replace(COMPONENT_REGEX, compId));\n }\n \n function decoratePreventDefault(eventHandler: Function): Function {\n@@ -105,7 +96,7 @@ export class DomRendererFactory2 implements RendererFactory2 {\n         return new ShadowDomRenderer(this.eventManager, this.sharedStylesHost, element, type);\n       default: {\n         if (!this.rendererByCompId.has(type.id)) {\n-          const styles = flattenStyles(type.id, type.styles, []);\n+          const styles = flattenStyles(type.id, type.styles);\n           this.sharedStylesHost.addStyles(styles);\n           this.rendererByCompId.set(type.id, this.defaultRenderer);\n         }\n@@ -286,7 +277,7 @@ class EmulatedEncapsulationDomRenderer2 extends DefaultDomRenderer2 {\n       eventManager: EventManager, sharedStylesHost: DomSharedStylesHost,\n       private component: RendererType2, appId: string) {\n     super(eventManager);\n-    const styles = flattenStyles(appId + '-' + component.id, component.styles, []);\n+    const styles = flattenStyles(appId + '-' + component.id, component.styles);\n     sharedStylesHost.addStyles(styles);\n \n     this.contentAttr = shimContentAttribute(appId + '-' + component.id);\n@@ -313,7 +304,7 @@ class ShadowDomRenderer extends DefaultDomRenderer2 {\n     super(eventManager);\n     this.shadowRoot = (hostEl as any).attachShadow({mode: 'open'});\n     this.sharedStylesHost.addHost(this.shadowRoot);\n-    const styles = flattenStyles(component.id, component.styles, []);\n+    const styles = flattenStyles(component.id, component.styles);\n     for (let i = 0; i < styles.length; i++) {\n       const styleEl = document.createElement('style');\n       styleEl.textContent = styles[i];\n\n---\n file path A: packages/platform-server/src/server_renderer.ts | file path B: packages/platform-server/src/server_renderer.ts\n\n@@ -45,7 +45,7 @@ export class ServerRendererFactory2 implements RendererFactory2 {\n       }\n       default: {\n         if (!this.rendererByCompId.has(type.id)) {\n-          const styles = flattenStyles(type.id, type.styles, []);\n+          const styles = flattenStyles(type.id, type.styles);\n           this.sharedStylesHost.addStyles(styles);\n           this.rendererByCompId.set(type.id, this.defaultRenderer);\n         }\n@@ -257,7 +257,7 @@ class EmulatedEncapsulationServerRenderer2 extends DefaultServerRenderer2 {\n     super(eventManager, document, ngZone, schema);\n     // Add a 's' prefix to style attributes to indicate server.\n     const componentId = 's' + component.id;\n-    const styles = flattenStyles(componentId, component.styles, []);\n+    const styles = flattenStyles(componentId, component.styles);\n     sharedStylesHost.addStyles(styles);\n \n     this.contentAttr = shimContentAttribute(componentId);\n\n\n###\n\n", "completion": "refactor(platform-browser): simplify `flattenStyles` method (#<issue-num>)"}
{"prompt": " file path A: aio/tools/examples/BUILD.bazel | file path B: aio/tools/examples/BUILD.bazel\n\n@@ -17,7 +17,6 @@ js_library(\n         \"example-boilerplate.js\",\n     ],\n     deps = [\n-        \"//aio/content/examples\",\n         \"//aio/tools/examples/shared\",\n         \"@aio_npm//canonical-path\",\n         \"@aio_npm//fs-extra\",\n\n\n###\n\n", "completion": "build: fix unnecessary large runfiles in AIO when composing boilerplate (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/examples.bzl | file path B: aio/content/examples/examples.bzl\n\n@@ -115,7 +115,10 @@ def docs_example(name, test = True, test_tags = [], test_exec_properties = {}, f\n \n     native.filegroup(\n         name = \"files\",\n-        srcs = native.glob([\"**\"], exclude = [\"BUILD.bazel\"]),\n+        srcs = native.glob([\"**\"], exclude = [\n+            \"BUILD.bazel\",\n+            \"**/node_modules/**\",  # Node modules may exist from the legacy setup.\n+        ]),\n     )\n \n     # Generate example boilerplate\n\n---\n file path A: aio/tools/examples/shared/BUILD.bazel | file path B: aio/tools/examples/shared/BUILD.bazel\n\n@@ -4,6 +4,9 @@ filegroup(\n     name = \"shared\",\n     srcs = glob(\n         [\"**\"],\n-        exclude = [\"BUILD.bazel\"],\n+        exclude = [\n+            \"BUILD.bazel\",\n+            \"**/node_modules/**\",  # Node modules may exist from the legacy setup.\n+        ],\n     ),\n )\n\n\n###\n\n", "completion": "build: always ensure `node_modules` folders are not picked up in AIO (#<issue-num>)"}
{"prompt": " file path A: aio/README.md | file path B: aio/README.md\n\n@@ -14,7 +14,8 @@ You should run all these tasks from the `angular/aio` folder.\n Here are the most important tasks you might need to use:\n \n * `yarn` - install all the dependencies.\n-* `yarn build` - create a production build of the application.\n+* `yarn build` - create a development build of the application.\n+* `yarn build-prod` - create a production build of the application.\n * `yarn build-local` - same as `build`, but uses locally built Angular packages from source code rather than from npm.\n * `yarn start` - run a development web server that watches, rebuilds, and reloads the page when there are changes to the source code or docs.\n * `yarn start-local` - same as `start`, but uses local Angular packages.\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -8,7 +8,8 @@\n   \"scripts\": {\n     \"postinstall\": \"node tools/cli-patches/patch.js\",\n     \"prebuild\": \"yarn setup\",\n-    \"build\": \"bazel build //aio:build --config=release\",\n+    \"build\": \"bazel build //aio:build\",\n+    \"build-prod\": \"yarn build --config=release\",\n     \"build-local\": \"yarn build --config=aio_local_deps\",\n     \"lint\": \"yarn check-env && yarn docs-lint && ng lint && yarn example-lint && yarn tools-lint && yarn security-lint\",\n     \"test\": \"bazel test //aio:test --test_output=streamed\",\n\n---\n file path A: aio/scripts/build-artifacts.sh | file path B: aio/scripts/build-artifacts.sh\n\n@@ -13,7 +13,7 @@ readonly deployedUrl=https://pr${prNumber}-${prLastSha:0:7}.ngbuilds.io/\n   cd $PROJECT_ROOT/aio\n \n   # Build and store the app\n-  yarn build\n+  yarn build-prod\n \n   # Remove write protection from the opensearch.xml in the Bazel\n   # output tree so that the url can be substituted.\n\n---\n file path A: aio/scripts/deploy-to-firebase/pre-deploy-actions.mjs | file path B: aio/scripts/deploy-to-firebase/pre-deploy-actions.mjs\n\n@@ -35,7 +35,7 @@ export default exp;\n // Helpers\n function build({deployedUrl, deployEnv}) {\n   u.logSectionHeader('Build the AIO app.');\n-  u.yarn(`build --aio_build_config=${deployEnv}`);\n+  u.yarn(`build-prod --aio_build_config=${deployEnv}`);\n \n   u.logSectionHeader('Remove write protection on the Bazel AIO distribution.');\n   sh.chmod('-R', 'u+w', BAZEL_DIST_DIR);\n\n---\n file path A: aio/scripts/deploy-to-firebase/pre-deploy-actions.spec.mjs | file path B: aio/scripts/deploy-to-firebase/pre-deploy-actions.spec.mjs\n\n@@ -30,7 +30,7 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n \n     it('should build the app for the appropriate mode', () => {\n       pre.build({deployedUrl: 'http://example.com/foo/', deployEnv: 'bar'});\n-      expect(yarnSpy).toHaveBeenCalledWith('build --aio_build_config=bar');\n+      expect(yarnSpy).toHaveBeenCalledWith('build-prod --aio_build_config=bar');\n     });\n \n     it('should remove write protection from the dist folder', () => {\n@@ -64,7 +64,7 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n \n       pre.build({deployedUrl: 'http://example.com/foo/', deployEnv: 'bar'});\n       expect(logs).toEqual([\n-        'yarn build --aio_build_config=bar',\n+        'yarn build-prod --aio_build_config=bar',\n         'chmod -R u+w ../dist/bin/aio/build',\n         'yarn set-opensearch-url http://example.com/foo/',\n         'cp -rf ../dist/bin/aio/build dist',\n\n\n###\n\n", "completion": "build: do not use `--config=release` when building AIO for development (#<issue-num>)"}
{"prompt": " file path A: .bazelignore | file path B: .bazelignore\n\n@@ -9,7 +9,6 @@ aio/node_modules\n aio/content/example-playground\n aio/tools/examples/shared/node_modules\n aio/tools/examples/shared/example-scaffold\n-packages/bazel/node_modules\n \n # All integration test node_modules folders\n integration/cli-elements-universal/node_modules\n@@ -39,32 +38,3 @@ integration/side-effects/node_modules\n integration/terser/node_modules\n integration/typings_test_ts36/node_modules\n integration/typings_test_ts37/node_modules\n-\n-# All integration test .yarn_local_cache folders\n-integration/cli-elements-universal/.yarn_local_cache\n-integration/cli-hello-world/.yarn_local_cache\n-integration/cli-hello-world-ivy-compat/.yarn_local_cache\n-integration/cli-hello-world-ivy-i18n/.yarn_local_cache\n-integration/cli-hello-world-ivy-minimal/.yarn_local_cache\n-integration/cli-hello-world-lazy/.yarn_local_cache\n-integration/cli-hello-world-ts-47/.yarn_local_cache\n-integration/dynamic-compiler/.yarn_local_cache\n-integration/hello_world__closure/.yarn_local_cache\n-integration/hello_world__systemjs_umd/.yarn_local_cache\n-integration/i18n/.yarn_local_cache\n-integration/injectable-def/.yarn_local_cache\n-integration/ivy-i18n/.yarn_local_cache\n-integration/ng-add-localize/.yarn_local_cache\n-integration/trusted-types/.yarn_local_cache\n-integration/forms/.yarn_local_cache\n-integration/ng_elements/.yarn_local_cache\n-integration/ng_elements_schematics/.yarn_local_cache\n-integration/ng_update/.yarn_local_cache\n-integration/ng_update_migrations/.yarn_local_cache\n-integration/ngcc/.yarn_local_cache\n-integration/platform-server/.yarn_local_cache\n-integration/service-worker-schema/.yarn_local_cache\n-integration/side-effects/.yarn_local_cache\n-integration/terser/.yarn_local_cache\n-integration/typings_test_ts36/.yarn_local_cache\n-integration/typings_test_ts37/.yarn_local_cache\n\n\n###\n\n", "completion": "build: cleanup bazelignore file (#<issue-num>)"}
{"prompt": " file path A: .gitignore | file path B: .gitignore\n\n@@ -4,7 +4,7 @@\n /bazel-out\n /integration/bazel/bazel-*\n *.log\n-node_modules\n+/node_modules/\n \n # CircleCI temporary file for cache key computation.\n # See `save_month_to_file` in `.circleci/config.yml`.\n\n---\n file path A: aio/.gitignore | file path B: aio/.gitignore\n\n@@ -8,6 +8,7 @@\n \n # Node\n /node_modules\n+/tools/examples/shared/node_modules\n npm-debug.log\n yarn-error.log\n \n\n\n###\n\n", "completion": "build: avoid common `node_modules/` bazel slowness pitfall (#<issue-num>)"}
{"prompt": " file path A: None | file path B: aio/content/extended-diagnostics/NG8106.md\n\n@@ -0,0 +1,65 @@\n+@name Suffix not supported\n+\n+@description\n+\n+This diagnostic detects when the `.px`, `.%`, and `.em` suffixes are used with an attribute\n+binding. These suffixes are only available for style bindings.\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+\n+import {Component} from '&commat;angular/core';\n+\n+&commat;Component({\n+  // This will result in &commat;div width.px=\"5\">&commat;/div> in the DOM when the likely\n+  // intent is &commat;div width=\"5px\">&commat;/div> \n+  template: `<div [attr.width.px]=\"5\"></div>`,\n+})\n+class MyComponent {\n+}\n+\n+</code-example>\n+\n+## What should I do instead?\n+\n+Rather than using the `.px`, `.%`, or `.em` suffixes that are only supported in style bindings,\n+move this to the value assignment of the binding.\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+\n+import {Component} from '&commat;angular/core';\n+\n+&commat;Component({\n+  template: `<div [attr.width]=\"'5px'\"></div>`,\n+})\n+class MyComponent {\n+}\n+\n+</code-example>\n+\n+## What if I can't avoid this?\n+\n+This diagnostic can be disabled by editing the project's `tsconfig.json` file:\n+\n+<code-example format=\"json\" language=\"json\">\n+\n+{\n+  \"angularCompilerOptions\": {\n+    \"extendedDiagnostics\": {\n+      \"checks\": {\n+        \"suffixNotSupported\": \"suppress\"\n+      }\n+    }\n+  }\n+}\n+\n+</code-example>\n+\n+See [extended diagnostic configuration](extended-diagnostics#configuration) for more info.\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-02-28\n\n---\n file path A: aio/content/extended-diagnostics/index.md | file path B: aio/content/extended-diagnostics/index.md\n\n@@ -10,6 +10,7 @@ Currently, Angular supports the following extended diagnostics:\n \n *   [NG8101 - `invalidBananaInBox`](extended-diagnostics/NG8101)\n *   [NG8102 - `nullishCoalescingNotNullable`](extended-diagnostics/NG8102)\n+*   [NG8106 - `suffixNotSupported`](extended-diagnostics/NG8106)\n \n ## Configuration\n \n\n\n###\n\n", "completion": "docs: Add page for 'suffixNotSupported' diagnostic (#<issue-num>)"}
{"prompt": " file path A: aio/src/app/app.component.html | file path B: aio/src/app/app.component.html\n\n@@ -54,7 +54,7 @@\n \n <mat-sidenav-container class=\"sidenav-container\" [class.no-animations]=\"disableAnimations\" [class.has-floating-toc]=\"hasFloatingToc\">\n \n-  <mat-sidenav [ngClass]=\"{'collapsed': !dockSideNav}\" #sidenav class=\"sidenav\" [mode]=\"mode\" [opened]=\"isOpened\" (openedChange)=\"updateHostClasses()\">\n+  <mat-sidenav [class.collapsed]=\"!dockSideNav\" #sidenav class=\"sidenav\" [mode]=\"mode\" [opened]=\"isOpened\" (openedChange)=\"updateHostClasses()\">\n     <aio-nav-menu *ngIf=\"!showTopMenu\" [nodes]=\"topMenuNarrowNodes\" [currentNode]=\"currentNodes.TopBarNarrow\" [isWide]=\"dockSideNav\" navLabel=\"primary\"></aio-nav-menu>\n     <aio-nav-menu [nodes]=\"sideNavNodes\" [currentNode]=\"currentNodes.SideNav\" [isWide]=\"dockSideNav\" navLabel=\"guides and docs\"></aio-nav-menu>\n \n\n---\n file path A: aio/src/app/custom-elements/code/code-example.component.spec.ts | file path B: aio/src/app/custom-elements/code/code-example.component.spec.ts\n\n@@ -43,20 +43,19 @@ describe('CodeExampleComponent', () => {\n   it('should change aio-code classes based on header presence', () => {\n     expect(codeExampleComponent.header).toBe('Great Example');\n     expect(fixture.nativeElement.querySelector('header')).toBeTruthy();\n-    expect(codeExampleComponent.classes).toEqual({\n-      'headed-code': true,\n-      'simple-code': false\n-    });\n+\n+    const aioCodeEl = fixture.nativeElement.querySelector('aio-code');\n+\n+    expect(aioCodeEl).toHaveClass('headed-code');\n+    expect(aioCodeEl).not.toHaveClass('simple-code');\n \n     codeExampleComponent.header = '';\n     fixture.detectChanges();\n \n     expect(codeExampleComponent.header).toBe('');\n     expect(fixture.nativeElement.querySelector('header')).toBeFalsy();\n-    expect(codeExampleComponent.classes).toEqual({\n-      'headed-code': false,\n-      'simple-code': true\n-    });\n+    expect(aioCodeEl).not.toHaveClass('headed-code');\n+    expect(aioCodeEl).toHaveClass('simple-code');\n   });\n \n   it('should set avoidFile class if path has .avoid.', () => {\n\n---\n file path A: aio/src/app/custom-elements/code/code-example.component.ts | file path B: aio/src/app/custom-elements/code/code-example.component.ts\n\n@@ -22,7 +22,8 @@ import { CodeComponent } from './code.component';\n \n     <header *ngIf=\"header\">{{header}}</header>\n \n-    <aio-code [ngClass]=\"classes\"\n+    <aio-code [class.headed-code]=\"!!this.header\"\n+              [class.simple-code]=\"!this.header\"\n               [language]=\"language\"\n               [linenums]=\"linenums\"\n               [path]=\"path\"\n@@ -41,16 +42,7 @@ export class CodeExampleComponent implements AfterViewInit {\n \n   @Input() region: string;\n \n-  @Input()\n-  set header(header: string) {\n-    this._header = header;\n-    this.classes = {\n-      'headed-code': !!this.header,\n-      'simple-code': !this.header,\n-    };\n-  }\n-  get header(): string { return this._header; }\n-  private _header: string;\n+  @Input() header: string;\n \n   @Input()\n   set path(path: string) {\n\n---\n file path A: aio/src/app/layout/nav-item/nav-item.component.html | file path B: aio/src/app/layout/nav-item/nav-item.component.html\n\n@@ -1,25 +1,25 @@\n <div *ngIf=\"!node.children\">\n-  <a href=\"{{node.url}}\" [ngClass]=\"classes\" title=\"{{node.tooltip}}\"\n+  <a href=\"{{node.url}}\" [class]=\"classes\" title=\"{{node.tooltip}}\"\n     class=\"vertical-menu-item\">\n     <span class=\"vertical-menu-item-text\">{{node.title}}</span>\n   </a>\n </div>\n \n <div *ngIf=\"node.children\">\n-  <a *ngIf=\"node.url != null\" href=\"{{node.url}}\" [ngClass]=\"classes\" title=\"{{node.tooltip}}\"\n+  <a *ngIf=\"node.url != null\" href=\"{{node.url}}\" [class]=\"classes\" title=\"{{node.tooltip}}\"\n     (click)=\"headerClicked()\" class=\"vertical-menu-item heading\">\n     <span>{{node.title}}</span>\n     <mat-icon class=\"rotating-icon\" svgIcon=\"keyboard_arrow_right\"></mat-icon>\n   </a>\n \n-  <button *ngIf=\"node.url == null\" type=\"button\" [ngClass]=\"classes\" title=\"{{node.tooltip}}\"\n+  <button *ngIf=\"node.url == null\" type=\"button\" [class]=\"classes\" title=\"{{node.tooltip}}\"\n     (click)=\"headerClicked()\" class=\"vertical-menu-item heading\"\n     [attr.aria-pressed]=\"isExpanded\">\n     <span>{{node.title}}</span>\n     <mat-icon class=\"rotating-icon\" svgIcon=\"keyboard_arrow_right\"></mat-icon>\n   </button>\n \n-  <div class=\"heading-children\" [ngClass]=\"classes\">\n+  <div class=\"heading-children\" [class]=\"classes\">\n     <aio-nav-item *ngFor=\"let node of nodeChildren\" [level]=\"level + 1\" [isWide]=\"isWide\"\n     [isParentExpanded]=\"isExpanded\"\n     [node]=\"node\" [selectedNodes]=\"selectedNodes\"></aio-nav-item>\n\n---\n file path A: aio/src/app/layout/nav-item/nav-item.component.spec.ts | file path B: aio/src/app/layout/nav-item/nav-item.component.spec.ts\n\n@@ -15,7 +15,6 @@ describe('NavItemComponent', () => {\n     let component: NavItemComponent;\n \n     let selectedNodes: NavigationNode[];\n-    let setClassesSpy: jasmine.Spy;\n \n     function initialize(nd: NavigationNode) {\n       component.node = nd;\n@@ -30,7 +29,6 @@ describe('NavItemComponent', () => {\n     beforeEach(() => {\n \n       component = new NavItemComponent();\n-      setClassesSpy = spyOn(component, 'setClasses').and.callThrough();\n \n       // Selected nodes is the selected node and its header ancestors\n       selectedNodes = [\n@@ -44,25 +42,19 @@ describe('NavItemComponent', () => {\n     describe('should have expected classes when initialized', () => {\n       it('with selected node', () => {\n         initialize(selectedNodes[0]);\n-        expect(component.classes).toEqual(\n-          // selected node should be expanded even if is a header.\n-          { 'level-1': true, collapsed: false, expanded: true, selected: true }\n-        );\n+        // selected node should be expanded even if is a header.\n+        expect(component.classes).toBe('level-1 expanded selected');\n       });\n \n       it('with selected node ancestor', () => {\n         initialize(selectedNodes[1]);\n-        expect(component.classes).toEqual(\n-          // ancestor is a header and should be expanded\n-          { 'level-1': true, collapsed: false, expanded: true, selected: true }\n-        );\n+        // ancestor is a header and should be expanded\n+        expect(component.classes).toBe('level-1 expanded selected');\n       });\n \n       it('with other than a selected node or ancestor', () => {\n         initialize({ title: 'x' });\n-        expect(component.classes).toEqual(\n-          { 'level-1': true, collapsed: true, expanded: false, selected: false }\n-        );\n+        expect(component.classes).toBe('level-1 collapsed');\n       });\n     });\n \n@@ -161,9 +153,10 @@ describe('NavItemComponent', () => {\n         expect(component.isSelected).withContext('remains not selected').toBe(false);\n       });\n \n-      it('should set classes', () => {\n+      it('should set expanded classes', () => {\n         component.headerClicked();\n-        expect(setClassesSpy).toHaveBeenCalled();\n+        expect(component.classes).toContain('expanded');\n+        expect(component.classes).not.toContain('collapsed');\n       });\n     });\n   });\n\n---\n file path A: aio/src/app/layout/nav-item/nav-item.component.ts | file path B: aio/src/app/layout/nav-item/nav-item.component.ts\n\n@@ -1,5 +1,5 @@\n-import { Component, Input, OnChanges} from '@angular/core';\n-import { NavigationNode } from 'app/navigation/navigation.model';\n+import {Component, Input, OnChanges} from '@angular/core';\n+import {NavigationNode} from 'app/navigation/navigation.model';\n \n @Component({\n   selector: 'aio-nav-item',\n@@ -10,41 +10,38 @@ export class NavItemComponent implements OnChanges {\n   @Input() level = 1;\n   @Input() node: NavigationNode;\n   @Input() isParentExpanded = true;\n-  @Input() selectedNodes: NavigationNode[] | undefined;\n+  @Input() selectedNodes: NavigationNode[]|undefined;\n \n   isExpanded = false;\n   isSelected = false;\n-  classes: {[index: string]: boolean };\n+  classes: string;\n   nodeChildren: NavigationNode[];\n \n   ngOnChanges() {\n-    this.nodeChildren = this.node && this.node.children ? this.node.children.filter(n => !n.hidden) : [];\n+    this.nodeChildren =\n+        this.node && this.node.children ? this.node.children.filter(n => !n.hidden) : [];\n \n     if (this.selectedNodes) {\n       const ix = this.selectedNodes.indexOf(this.node);\n-      this.isSelected = ix !== -1; // this node is the selected node or its ancestor\n+      this.isSelected = ix !== -1;  // this node is the selected node or its ancestor\n       this.isExpanded = this.isParentExpanded &&\n-        (this.isSelected || // expand if selected or ...\n-        // preserve expanded state when display is wide; collapse in mobile.\n-        (this.isWide && this.isExpanded));\n+          (this.isSelected ||  // expand if selected or ...\n+                               // preserve expanded state when display is wide; collapse in mobile.\n+           (this.isWide && this.isExpanded));\n     } else {\n       this.isSelected = false;\n     }\n \n-    this.setClasses();\n-  }\n-\n-  setClasses() {\n-    this.classes = {\n-      ['level-' + this.level]: true,\n-      collapsed: !this.isExpanded,\n-      expanded: this.isExpanded,\n-      selected: this.isSelected\n-    };\n+    this._updateClasses();\n   }\n \n   headerClicked() {\n     this.isExpanded = !this.isExpanded;\n-    this.setClasses();\n+    this._updateClasses();\n+  }\n+\n+  private _updateClasses() {\n+    this.classes = `level-${this.level} ${this.isExpanded ? 'expanded' : 'collapsed'}${\n+        this.isSelected ? ' selected' : ''}`;\n   }\n }\n\n---\n file path A: aio/src/app/layout/top-menu/top-menu.component.ts | file path B: aio/src/app/layout/top-menu/top-menu.component.ts\n\n@@ -6,7 +6,7 @@ import { CurrentNode, NavigationNode } from 'app/navigation/navigation.service';\n   template: `\n     <nav aria-label=\"primary\">\n       <ul>\n-        <li *ngFor=\"let node of nodes\" [ngClass]=\"{selected: node.url === currentUrl}\">\n+        <li *ngFor=\"let node of nodes\" [class.selected]=\"node.url === currentUrl\">\n           <a class=\"nav-link\" [href]=\"node.url\" [title]=\"node.tooltip\">\n             <span class=\"nav-link-inner\">{{ node.title }}</span>\n           </a>\n\n\n###\n\n", "completion": "perf(docs-infra): remove usage of the NgClass directive (#<issue-num>)"}
{"prompt": " file path A: .circleci/bazel.common.rc | file path B: .circleci/bazel.common.rc\n\n@@ -1,8 +1,5 @@\n # Settings in this file should be OS agnostic. Use the bazel.<OS>.rc files for OS specific settings.\n \n-# Don't be spammy in the logs\n-build --noshow_progress\n-\n # Print all the options that apply to the build.\n # This helps us diagnose which options override others\n # (e.g. /etc/bazel.bazelrc vs. tools/bazel.rc)\n\n\n###\n\n", "completion": "build: enable progress messages for Bazel in CircleCI (#<issue-num>)"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -25,6 +25,10 @@ http_archive(\n \n http_archive(\n     name = \"build_bazel_rules_nodejs\",\n+    patches = [\n+        # TODO(devversion): remove when https://github.com/bazelbuild/rules_nodejs/pull/3605 is available.\n+        \"//tools:bazel-repo-patches/rules_nodejs__#3605.patch\",\n+    ],\n     sha256 = \"c29944ba9b0b430aadcaf3bf2570fece6fc5ebfb76df145c6cdad40d65c20811\",\n     urls = [\"https://github.com/bazelbuild/rules_nodejs/releases/download/5.7.0/rules_nodejs-5.7.0.tar.gz\"],\n )\n\n---\n file path A: None | file path B: tools/bazel-repo-patches/rules_nodejs__#3605.patch\n\n@@ -0,0 +1,48 @@\n+diff --git internal/node/node.bzl internal/node/node.bzl\n+index 18d7ce4..3b8ce74 100755\n+--- internal/node/node.bzl\n++++ internal/node/node.bzl\n+@@ -353,10 +353,22 @@ if (process.cwd() !== __dirname) {\n+     else:\n+         executable = ctx.outputs.launcher_sh\n+\n+-    # syntax sugar: allows you to avoid repeating the entry point in data\n+-    # entry point is only needed in runfiles if it is a javascript file\n+-    if len(ctx.files.entry_point) == 1 and is_javascript_file(ctx.files.entry_point[0]):\n+-        runfiles.extend(ctx.files.entry_point)\n++    # Note: `to_list()` is expensive and should only be called once.\n++    sources_list = sources.to_list()\n++    entry_point_input_short_path = _ts_to_js(_get_entry_point_file(ctx).short_path)\n++    entry_point_script = None\n++\n++    for f in sources_list:\n++        if f.short_path == entry_point_input_short_path:\n++            entry_point_script = f\n++            break\n++\n++    if not entry_point_script and len(ctx.files.entry_point) == 1 and is_javascript_file(ctx.files.entry_point[0]):\n++        entry_point_script = ctx.files.entry_point[0]\n++\n++        # Convenience: We add the entry point to the runfiles. This means that users would not\n++        # need to explicitly repeat the entry point in the `data` attribute.\n++        runfiles.append(entry_point_script)\n+\n+     return [\n+         DefaultInfo(\n+@@ -371,14 +383,14 @@ if (process.cwd() !== __dirname) {\n+                         # Calling the .to_list() method may have some perfs hits,\n+                         # so we should be running this method only once per rule.\n+                         # see: https://docs.bazel.build/versions/main/skylark/depsets.html#performance\n+-                        node_modules.to_list() + sources.to_list(),\n++                        node_modules.to_list() + sources_list,\n+                 collect_data = True,\n+             ),\n+         ),\n+         # TODO(alexeagle): remove sources and node_modules from the runfiles\n+         # when downstream usage is ready to rely on linker\n+         NodeRuntimeDepsInfo(\n+-            deps = depset(ctx.files.entry_point, transitive = [node_modules, sources]),\n++            deps = depset([entry_point_script], transitive = [node_modules, sources]),\n+             pkgs = data,\n+         ),\n+         # indicates that the this binary should be instrumented by coverage\n\n\n###\n\n", "completion": "build: patch `rules_nodejs` to ensure `nodejs_binary` targets can be used as tools in RBE (#<issue-num>)"}
{"prompt": " file path A: .bazelrc | file path B: .bazelrc\n\n@@ -71,7 +71,7 @@ build:snapshot-build --stamp\n build --flag_alias=aio_build_config=//aio:flag_aio_build_config\n \n ####################################\n-# AIO first party dep substitution # \n+# AIO first party dep substitution #\n # Turn on with                     #\n #  --config=aio_local_deps         #\n ####################################\n@@ -173,4 +173,4 @@ build --flag_alias=ng_perf=//packages/compiler-cli:ng_perf\n \n # Load any settings which are specific to the current user. Needs to be *last* statement\n # in this config, as the user configuration should be able to overwrite flags from this file.\n-try-import .bazelrc.user\n+try-import %workspace%/.bazelrc.user\n\n\n###\n\n", "completion": "build: fix AIO jobs not running with RBE and CircleCI Bazel settings (#<issue-num>)"}
{"prompt": " file path A: packages/compiler/src/i18n/digest.ts | file path B: packages/compiler/src/i18n/digest.ts\n\n@@ -181,10 +181,11 @@ function fk(index: number, b: number, c: number, d: number): [number, number] {\n  */\n export function fingerprint(str: string): [number, number] {\n   textEncoder ??= new TextEncoder();\n-  const utf8 = [...textEncoder.encode(str)];\n+  const utf8 = textEncoder.encode(str);\n+  const view = new DataView(utf8.buffer, utf8.byteOffset, utf8.byteLength);\n \n-  let hi = hash32(utf8, 0);\n-  let lo = hash32(utf8, 102072);\n+  let hi = hash32(view, utf8.length, 0);\n+  let lo = hash32(view, utf8.length, 102072);\n \n   if (hi == 0 && (lo == 0 || lo == 1)) {\n     hi = hi ^ 0x130f9bef;\n@@ -208,40 +209,81 @@ export function computeMsgId(msg: string, meaning: string = ''): string {\n   return wordsToDecimalString(hi & 0x7fffffff, lo);\n }\n \n-function hash32(bytes: Byte[], c: number): number {\n+function hash32(view: DataView, length: number, c: number): number {\n   let a = 0x9e3779b9, b = 0x9e3779b9;\n-  let i: number;\n-\n-  const len = bytes.length;\n+  let index = 0;\n \n-  for (i = 0; i + 12 <= len; i += 12) {\n-    a = add32(a, wordAt(bytes, i, Endian.Little));\n-    b = add32(b, wordAt(bytes, i + 4, Endian.Little));\n-    c = add32(c, wordAt(bytes, i + 8, Endian.Little));\n+  const end = length - 12;\n+  for (; index <= end; index += 12) {\n+    a += view.getUint32(index, true);\n+    b += view.getUint32(index + 4, true);\n+    c += view.getUint32(index + 8, true);\n     const res = mix(a, b, c);\n     a = res[0], b = res[1], c = res[2];\n   }\n \n-  a = add32(a, wordAt(bytes, i, Endian.Little));\n-  b = add32(b, wordAt(bytes, i + 4, Endian.Little));\n+  const remainder = length - index;\n+\n   // the first byte of c is reserved for the length\n-  c = add32(c, len);\n-  c = add32(c, wordAt(bytes, i + 8, Endian.Little) << 8);\n+  c += length;\n+\n+  if (remainder >= 4) {\n+    a += view.getUint32(index, true);\n+    index += 4;\n+\n+    if (remainder >= 8) {\n+      b += view.getUint32(index, true);\n+      index += 4;\n+\n+      // Partial 32-bit word for c\n+      if (remainder >= 9) {\n+        c += view.getUint8(index++) << 8;\n+      }\n+      if (remainder >= 10) {\n+        c += view.getUint8(index++) << 16;\n+      }\n+      if (remainder === 11) {\n+        c += view.getUint8(index++) << 24;\n+      }\n+    } else {\n+      // Partial 32-bit word for b\n+      if (remainder >= 5) {\n+        b += view.getUint8(index++);\n+      }\n+      if (remainder >= 6) {\n+        b += view.getUint8(index++) << 8;\n+      }\n+      if (remainder === 7) {\n+        b += view.getUint8(index++) << 16;\n+      }\n+    }\n+  } else {\n+    // Partial 32-bit word for a\n+    if (remainder >= 1) {\n+      a += view.getUint8(index++);\n+    }\n+    if (remainder >= 2) {\n+      a += view.getUint8(index++) << 8;\n+    }\n+    if (remainder === 3) {\n+      a += view.getUint8(index++) << 16;\n+    }\n+  }\n \n   return mix(a, b, c)[2];\n }\n \n // clang-format off\n function mix(a: number, b: number, c: number): [number, number, number] {\n-  a = sub32(a, b); a = sub32(a, c); a ^= c >>> 13;\n-  b = sub32(b, c); b = sub32(b, a); b ^= a << 8;\n-  c = sub32(c, a); c = sub32(c, b); c ^= b >>> 13;\n-  a = sub32(a, b); a = sub32(a, c); a ^= c >>> 12;\n-  b = sub32(b, c); b = sub32(b, a); b ^= a << 16;\n-  c = sub32(c, a); c = sub32(c, b); c ^= b >>> 5;\n-  a = sub32(a, b); a = sub32(a, c); a ^= c >>> 3;\n-  b = sub32(b, c); b = sub32(b, a); b ^= a << 10;\n-  c = sub32(c, a); c = sub32(c, b); c ^= b >>> 15;\n+  a -= b; a -= c; a ^= c >>> 13;\n+  b -= c; b -= a; b ^= a << 8;\n+  c -= a; c -= b; c ^= b >>> 13;\n+  a -= b; a -= c; a ^= c >>> 12;\n+  b -= c; b -= a; b ^= a << 16;\n+  c -= a; c -= b; c ^= b >>> 5;\n+  a -= b; a -= c; a ^= c >>> 3;\n+  b -= c; b -= a; b ^= a << 10;\n+  c -= a; c -= b; c ^= b >>> 15;\n   return [a, b, c];\n }\n // clang-format on\n@@ -273,12 +315,6 @@ function add64(a: [number, number], b: [number, number]): [number, number] {\n   return [h, l];\n }\n \n-function sub32(a: number, b: number): number {\n-  const low = (a & 0xffff) - (b & 0xffff);\n-  const high = (a >> 16) - (b >> 16) + (low >> 16);\n-  return (high << 16) | (low & 0xffff);\n-}\n-\n // Rotate a 32b number left `count` position\n function rol32(a: number, count: number): number {\n   return (a << count) | (a >>> (32 - count));\n\n\n###\n\n", "completion": "refactor(compiler): use TypedArrays and DataViews to calculate i18n message IDs (#<issue-num>)"}
{"prompt": " file path A: packages/compiler/src/i18n/digest.ts | file path B: packages/compiler/src/i18n/digest.ts\n\n@@ -6,11 +6,16 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Byte, newArray, utf8Encode} from '../util';\n-import {BigIntExponentiation} from './big_integer';\n+import {Byte} from '../util';\n \n+import {BigIntExponentiation} from './big_integer';\n import * as i18n from './i18n_ast';\n \n+/**\n+ * A lazily created TextEncoder instance for converting strings into UTF-8 bytes\n+ */\n+let textEncoder: TextEncoder|undefined;\n+\n /**\n  * Return the message id or compute it using the XLIFF1 digest.\n  */\n@@ -109,11 +114,12 @@ class _SerializerIgnoreIcuExpVisitor extends _SerializerVisitor {\n  *          DO NOT USE IT IN A SECURITY SENSITIVE CONTEXT.\n  */\n export function sha1(str: string): string {\n-  const utf8 = utf8Encode(str);\n+  textEncoder ??= new TextEncoder();\n+  const utf8 = [...textEncoder.encode(str)];\n   const words32 = bytesToWords32(utf8, Endian.Big);\n   const len = utf8.length * 8;\n \n-  const w = newArray(80);\n+  const w = new Uint32Array(80);\n   let a = 0x67452301, b = 0xefcdab89, c = 0x98badcfe, d = 0x10325476, e = 0xc3d2e1f0;\n \n   words32[len >> 5] |= 0x80 << (24 - len % 32);\n@@ -174,7 +180,8 @@ function fk(index: number, b: number, c: number, d: number): [number, number] {\n  * https://github.com/google/closure-compiler/blob/master/src/com/google/javascript/jscomp/GoogleJsMessageIdGenerator.java\n  */\n export function fingerprint(str: string): [number, number] {\n-  const utf8 = utf8Encode(str);\n+  textEncoder ??= new TextEncoder();\n+  const utf8 = [...textEncoder.encode(str)];\n \n   let hi = hash32(utf8, 0);\n   let lo = hash32(utf8, 102072);\n\n\n###\n\n", "completion": "refactor(compiler): use native UTF-8 text encoding when calculating i18n IDs (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/metadata/src/host_directives_resolver.ts | file path B: packages/compiler-cli/src/ngtsc/metadata/src/host_directives_resolver.ts\n\n@@ -43,12 +43,9 @@ export class HostDirectivesResolver {\n     for (const current of directives) {\n       const hostMeta = flattenInheritedDirectiveMetadata(this.metaReader, current.directive);\n \n-      // This case has been checked for already, but we keep the assertion here so that the\n-      // user gets a better error message than \"Cannot read property foo of null\" in case\n-      // something slipped through.\n+      // This case has been checked for already and produces a diagnostic\n       if (hostMeta === null) {\n-        throw new Error(\n-            `Could not resolve host directive metadata of ${current.directive.debugName}`);\n+        continue;\n       }\n \n       if (hostMeta.hostDirectives) {\n\n---\n file path A: packages/compiler-cli/src/ngtsc/metadata/src/inheritance.ts | file path B: packages/compiler-cli/src/ngtsc/metadata/src/inheritance.ts\n\n@@ -21,10 +21,10 @@ import {ClassPropertyMapping, ClassPropertyName} from './property_mapping';\n  * followed.\n  */\n export function flattenInheritedDirectiveMetadata(\n-    reader: MetadataReader, dir: Reference<ClassDeclaration>): DirectiveMeta {\n+    reader: MetadataReader, dir: Reference<ClassDeclaration>): DirectiveMeta|null {\n   const topMeta = reader.getDirectiveMetadata(dir);\n   if (topMeta === null) {\n-    throw new Error(`Metadata not found for directive: ${dir.debugName}`);\n+    return null;\n   }\n   if (topMeta.baseClass === null) {\n     return topMeta;\n\n---\n file path A: packages/compiler-cli/src/ngtsc/scope/src/typecheck.ts | file path B: packages/compiler-cli/src/ngtsc/scope/src/typecheck.ts\n\n@@ -99,6 +99,9 @@ export class TypeCheckScopeRegistry {\n     for (const meta of dependencies) {\n       if (meta.kind === MetaKind.Directive && meta.selector !== null) {\n         const extMeta = this.getTypeCheckDirectiveMetadata(meta.ref);\n+        if (extMeta === null) {\n+          continue;\n+        }\n         matcher.addSelectables(\n             CssSelector.parse(meta.selector),\n             [...this.hostDirectivesResolver.resolve(extMeta), extMeta]);\n@@ -125,13 +128,16 @@ export class TypeCheckScopeRegistry {\n     return typeCheckScope;\n   }\n \n-  getTypeCheckDirectiveMetadata(ref: Reference<ClassDeclaration>): DirectiveMeta {\n+  getTypeCheckDirectiveMetadata(ref: Reference<ClassDeclaration>): DirectiveMeta|null {\n     const clazz = ref.node;\n     if (this.flattenedDirectiveMetaCache.has(clazz)) {\n       return this.flattenedDirectiveMetaCache.get(clazz)!;\n     }\n \n     const meta = flattenInheritedDirectiveMetadata(this.metaReader, ref);\n+    if (meta === null) {\n+      return null;\n+    }\n     this.flattenedDirectiveMetaCache.set(clazz, meta);\n     return meta;\n   }\n\n---\n file path A: packages/compiler-cli/test/ngtsc/host_directives_spec.ts | file path B: packages/compiler-cli/test/ngtsc/host_directives_spec.ts\n\n@@ -451,6 +451,24 @@ runInEachFileSystem(() => {\n         expect(messages).toEqual(['Host directive HostDir must be standalone']);\n       });\n \n+      it('should produce a diagnostic if a host directive is not a directive', () => {\n+        env.write('test.ts', `\n+          import {Directive, Pipe, Component, NgModule} from '@angular/core';\n+\n+          @Pipe({name: 'hostDir'})\n+          export class HostDir {}\n+\n+          @Directive({\n+            hostDirectives: [HostDir],\n+          })\n+          export class Dir {}\n+        `);\n+\n+        const messages = env.driveDiagnostics().map(extractMessage);\n+        expect(messages).toEqual(\n+            ['HostDir must be a standalone directive to be used as a host directive']);\n+      });\n+\n       it('should produce a diagnostic if a host directive is a component', () => {\n         env.write('test.ts', `\n           import {Directive, Component, NgModule} from '@angular/core';\n\n\n###\n\n", "completion": "fix(compiler-cli): Produce diagnostic rather than crash when using invalid hostDirective (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/core/index.md | file path B: goldens/public-api/core/index.md\n\n@@ -787,6 +787,9 @@ export interface InputDecorator {\n // @public\n export function isDevMode(): boolean;\n \n+// @public\n+export function isStandalone(type: Type<unknown>): boolean;\n+\n // @public\n export interface IterableChangeRecord<V> {\n     readonly currentIndex: number | null;\n\n---\n file path A: packages/core/src/core.ts | file path B: packages/core/src/core.ts\n\n@@ -38,6 +38,7 @@ export {SecurityContext} from './sanitization/security';\n export {Sanitizer} from './sanitization/sanitizer';\n export {createNgModule, createNgModuleRef, createEnvironmentInjector} from './render3/ng_module_ref';\n export {createComponent, reflectComponentType, ComponentMirror} from './render3/component';\n+export {isStandalone} from './render3/definition';\n \n import {global} from './util/global';\n if (typeof ngDevMode !== 'undefined' && ngDevMode) {\n\n---\n file path A: packages/core/src/core_render3_private_export.ts | file path B: packages/core/src/core_render3_private_export.ts\n\n@@ -248,7 +248,6 @@ export {\n export {\n   compilePipe as \u0275compilePipe,\n } from './render3/jit/pipe';\n-export { isStandalone as \u0275isStandalone} from './render3/definition';\n export { Profiler as \u0275Profiler, ProfilerEvent as \u0275ProfilerEvent } from './render3/profiler';\n export {\n   publishDefaultGlobalUtils as \u0275publishDefaultGlobalUtils\n\n---\n file path A: packages/core/src/render3/definition.ts | file path B: packages/core/src/render3/definition.ts\n\n@@ -7,7 +7,6 @@\n  */\n \n import {ChangeDetectionStrategy} from '../change_detection/constants';\n-import {NG_PROV_DEF} from '../di/interface/defs';\n import {Mutable, Type} from '../interface/type';\n import {NgModuleDef} from '../metadata/ng_module_def';\n import {SchemaMetadata} from '../metadata/schema';\n@@ -741,7 +740,15 @@ export function getPipeDef<T>(type: any): PipeDef<T>|null {\n   return type[NG_PIPE_DEF] || null;\n }\n \n-export function isStandalone<T>(type: Type<T>): boolean {\n+/**\n+ * Checks whether a given Component, Directive or Pipe is marked as standalone.\n+ * This will return false if passed anything other than a Component, Directive, or Pipe class\n+ * See this guide for additional information: https://angular.io/guide/standalone-components\n+ *\n+ * @param type A reference to a Component, Directive or Pipe.\n+ * @publicApi\n+ */\n+export function isStandalone(type: Type<unknown>): boolean {\n   const def = getComponentDef(type) || getDirectiveDef(type) || getPipeDef(type);\n   return def !== null ? def.standalone : false;\n }\n\n---\n file path A: packages/core/src/render3/jit/module.ts | file path B: packages/core/src/render3/jit/module.ts\n\n@@ -173,9 +173,7 @@ export function compileNgModuleDefs(\n   Object.defineProperty(moduleType, NG_INJ_DEF, {\n     get: () => {\n       if (ngInjectorDef === null) {\n-        ngDevMode &&\n-            verifySemanticsOfNgModuleDef(\n-                moduleType as any as NgModuleType, allowDuplicateDeclarationsInRoot);\n+        ngDevMode && verifySemanticsOfNgModuleDef(moduleType, allowDuplicateDeclarationsInRoot);\n         const meta: R3InjectorMetadataFacade = {\n           name: moduleType.name,\n           type: moduleType,\n\n---\n file path A: packages/core/test/acceptance/standalone_spec.ts | file path B: packages/core/test/acceptance/standalone_spec.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {CommonModule} from '@angular/common';\n-import {Component, createEnvironmentInjector, Directive, EnvironmentInjector, forwardRef, Injector, Input, NgModule, NO_ERRORS_SCHEMA, OnInit, Pipe, PipeTransform, ViewChild, ViewContainerRef} from '@angular/core';\n+import {Component, createEnvironmentInjector, Directive, EnvironmentInjector, forwardRef, Injector, Input, isStandalone, NgModule, NO_ERRORS_SCHEMA, OnInit, Pipe, PipeTransform, ViewChild, ViewContainerRef} from '@angular/core';\n import {TestBed} from '@angular/core/testing';\n \n describe('standalone components, directives, and pipes', () => {\n@@ -847,4 +847,68 @@ describe('standalone components, directives, and pipes', () => {\n       expect(fixture.nativeElement.textContent).toBe('');\n     });\n   });\n+\n+  describe('isStandalone()', () => {\n+    it('should return `true` if component is standalone', () => {\n+      @Component({selector: 'standalone-cmp', standalone: true})\n+      class StandaloneCmp {\n+      }\n+\n+      expect(isStandalone(StandaloneCmp)).toBeTrue();\n+    });\n+\n+    it('should return `false` if component is not standalone', () => {\n+      @Component({selector: 'standalone-cmp', standalone: false})\n+      class StandaloneCmp {\n+      }\n+\n+      expect(isStandalone(StandaloneCmp)).toBeFalse();\n+    });\n+\n+    it('should return `true` if directive is standalone', () => {\n+      @Directive({selector: '[standaloneDir]', standalone: true})\n+      class StandAloneDirective {\n+      }\n+\n+      expect(isStandalone(StandAloneDirective)).toBeTrue();\n+    });\n+\n+    it('should return `false` if directive is standalone', () => {\n+      @Directive({selector: '[standaloneDir]', standalone: false})\n+      class StandAloneDirective {\n+      }\n+\n+      expect(isStandalone(StandAloneDirective)).toBeFalse();\n+    });\n+\n+    it('should return `true` if pipe is standalone', () => {\n+      @Pipe({name: 'standalonePipe', standalone: true})\n+      class StandAlonePipe {\n+      }\n+\n+      expect(isStandalone(StandAlonePipe)).toBeTrue();\n+    });\n+\n+    it('should return `false` if pipe is standalone', () => {\n+      @Pipe({name: 'standalonePipe', standalone: false})\n+      class StandAlonePipe {\n+      }\n+\n+      expect(isStandalone(StandAlonePipe)).toBeFalse();\n+    });\n+\n+    it('should return `false` if the class is not annotated', () => {\n+      class NonAnnotatedClass {}\n+\n+      expect(isStandalone(NonAnnotatedClass)).toBeFalse();\n+    });\n+\n+    it('should return `false` if the class is an NgModule', () => {\n+      @NgModule({})\n+      class Module {\n+      }\n+\n+      expect(isStandalone(Module)).toBeFalse();\n+    });\n+  });\n });\n\n---\n file path A: packages/router/src/utils/config.ts | file path B: packages/router/src/utils/config.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {createEnvironmentInjector, EnvironmentInjector, Type, \u0275isStandalone as isStandalone, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {createEnvironmentInjector, EnvironmentInjector, isStandalone, Type, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {EmptyOutletComponent} from '../components/empty_outlet';\n import {RuntimeErrorCode} from '../errors';\n\n\n###\n\n", "completion": "feat(core): Make the `isStandalone()` function available in public API (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/built-in-directives/src/app/item-detail/item-detail.component.ts | file path B: aio/content/examples/built-in-directives/src/app/item-detail/item-detail.component.ts\n\n@@ -9,9 +9,6 @@ import { Item } from '../item';\n })\n export class ItemDetailComponent {\n \n-\n   @Input() item!: Item;\n \n-  constructor() { }\n-\n }\n\n---\n file path A: aio/content/examples/dependency-injection-in-action/src/app/hero-of-the-month.component.1.ts | file path B: aio/content/examples/dependency-injection-in-action/src/app/hero-of-the-month.component.1.ts\n\n@@ -23,4 +23,4 @@ export class HeroOfTheMonthComponent {\n @NgModule({\n   declarations: [ HeroOfTheMonthComponent ]\n })\n-class NoopModule {}\n+export class NoopModule {}\n\n\n###\n\n", "completion": "docs: removed empty method (#<issue-num>)"}
{"prompt": " file path A: goldens/size-tracking/integration-payloads.json | file path B: goldens/size-tracking/integration-payloads.json\n\n@@ -33,7 +33,7 @@\n   \"cli-hello-world-lazy\": {\n     \"uncompressed\": {\n       \"runtime\": 2835,\n-      \"main\": 226537,\n+      \"main\": 225991,\n       \"polyfills\": 33842,\n       \"src_app_lazy_lazy_routes_ts\": 487\n     }\n\n---\n file path A: packages/router/src/private_export.ts | file path B: packages/router/src/private_export.ts\n\n@@ -10,6 +10,5 @@\n export {\u0275EmptyOutletComponent} from './components/empty_outlet';\n export {RestoredState as \u0275RestoredState} from './navigation_transition';\n export {withPreloading as \u0275withPreloading} from './provide_router';\n-export {assignExtraOptionsToRouter as \u0275assignExtraOptionsToRouter} from './router';\n export {ROUTER_PROVIDERS as \u0275ROUTER_PROVIDERS} from './router_module';\n export {flatten as \u0275flatten} from './utils/collection';\n\n---\n file path A: packages/router/src/provide_router.ts | file path B: packages/router/src/provide_router.ts\n\n@@ -67,10 +67,6 @@ export function provideRouter(routes: Routes, ...features: RouterFeatures[]): En\n     {provide: ActivatedRoute, useFactory: rootRoute, deps: [Router]},\n     {provide: APP_BOOTSTRAP_LISTENER, multi: true, useFactory: getBootstrapListener},\n     features.map(feature => feature.\u0275providers),\n-    // TODO: All options used by the `assignExtraOptionsToRouter` factory need to be reviewed for\n-    // how we want them to be configured. This API doesn't currently have a way to configure them\n-    // and we should decide what the _best_ way to do that is rather than just sticking with the\n-    // status quo of how it's done today.\n   ]);\n }\n \n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -61,32 +61,6 @@ export const subsetMatchOptions: IsActiveMatchOptions = {\n   queryParams: 'subset'\n };\n \n-export function assignExtraOptionsToRouter(opts: ExtraOptions, router: Router): void {\n-  if (opts.errorHandler) {\n-    router.errorHandler = opts.errorHandler;\n-  }\n-\n-  if (opts.malformedUriErrorHandler) {\n-    router.malformedUriErrorHandler = opts.malformedUriErrorHandler;\n-  }\n-\n-  if (opts.onSameUrlNavigation) {\n-    router.onSameUrlNavigation = opts.onSameUrlNavigation;\n-  }\n-\n-  if (opts.paramsInheritanceStrategy) {\n-    router.paramsInheritanceStrategy = opts.paramsInheritanceStrategy;\n-  }\n-\n-  if (opts.urlUpdateStrategy) {\n-    router.urlUpdateStrategy = opts.urlUpdateStrategy;\n-  }\n-\n-  if (opts.canceledNavigationResolution) {\n-    router.canceledNavigationResolution = opts.canceledNavigationResolution;\n-  }\n-}\n-\n /**\n  * @description\n  *\n@@ -200,12 +174,14 @@ export class Router {\n    */\n   public readonly routerState: RouterState;\n \n+  private options = inject(ROUTER_CONFIGURATION, {optional: true}) || {};\n+\n   /**\n    * A handler for navigation errors in this NgModule.\n    *\n    * @deprecated Subscribe to the `Router` events and watch for `NavigationError` instead.\n    */\n-  errorHandler: ErrorHandler = defaultErrorHandler;\n+  errorHandler = this.options.errorHandler || defaultErrorHandler;\n \n   /**\n    * A handler for errors thrown by `Router.parseUrl(url)`\n@@ -217,9 +193,8 @@ export class Router {\n    *   `RouterModule.forRoot(routes, {malformedUriErrorHandler: myHandler})`\n    * @see `RouterModule`\n    */\n-  malformedUriErrorHandler:\n-      (error: URIError, urlSerializer: UrlSerializer,\n-       url: string) => UrlTree = defaultMalformedUriErrorHandler;\n+  malformedUriErrorHandler =\n+      this.options.malformedUriErrorHandler || defaultMalformedUriErrorHandler;\n \n   /**\n    * True if at least one navigation event has occurred,\n@@ -270,7 +245,7 @@ export class Router {\n    * @see `provideRouter`\n    * @see `RouterModule`\n    */\n-  onSameUrlNavigation: OnSameUrlNavigation = 'ignore';\n+  onSameUrlNavigation: OnSameUrlNavigation = this.options.onSameUrlNavigation || 'ignore';\n \n   /**\n    * How to merge parameters, data, resolved data, and title from parent to child\n@@ -286,7 +261,8 @@ export class Router {\n    * @see `provideRouter`\n    * @see `RouterModule`\n    */\n-  paramsInheritanceStrategy: 'emptyOnly'|'always' = 'emptyOnly';\n+  paramsInheritanceStrategy: 'emptyOnly'|'always' =\n+      this.options.paramsInheritanceStrategy || 'emptyOnly';\n \n   /**\n    * Determines when the router updates the browser URL.\n@@ -300,7 +276,7 @@ export class Router {\n    * @see `provideRouter`\n    * @see `RouterModule`\n    */\n-  urlUpdateStrategy: 'deferred'|'eager' = 'deferred';\n+  urlUpdateStrategy: 'deferred'|'eager' = this.options.urlUpdateStrategy || 'deferred';\n \n   /**\n    * Configures how the Router attempts to restore state when a navigation is cancelled.\n@@ -328,7 +304,8 @@ export class Router {\n    * @see `provideRouter`\n    * @see `RouterModule`\n    */\n-  canceledNavigationResolution: 'replace'|'computed' = 'replace';\n+  canceledNavigationResolution: 'replace'|'computed' =\n+      this.options.canceledNavigationResolution || 'replace';\n \n   config: Routes = flatten(inject(ROUTES, {optional: true}) ?? []);\n \n@@ -340,9 +317,6 @@ export class Router {\n   rootComponentType: Type<any>|null = null;\n \n   constructor() {\n-    const opts = inject(ROUTER_CONFIGURATION, {optional: true}) ?? {};\n-    assignExtraOptionsToRouter(opts, this);\n-\n     this.isNgZoneEnabled = inject(NgZone) instanceof NgZone && NgZone.isInAngularZone();\n \n     this.resetConfig(this.config);\n\n---\n file path A: packages/router/testing/src/router_testing_module.ts | file path B: packages/router/testing/src/router_testing_module.ts\n\n@@ -9,7 +9,7 @@\n import {Location} from '@angular/common';\n import {provideLocationMocks} from '@angular/common/testing';\n import {Compiler, inject, Injector, ModuleWithProviders, NgModule} from '@angular/core';\n-import {ChildrenOutletContexts, ExtraOptions, NoPreloading, Route, Router, ROUTER_CONFIGURATION, RouteReuseStrategy, RouterModule, ROUTES, Routes, TitleStrategy, UrlHandlingStrategy, UrlSerializer, \u0275assignExtraOptionsToRouter as assignExtraOptionsToRouter, \u0275flatten as flatten, \u0275ROUTER_PROVIDERS as ROUTER_PROVIDERS, \u0275withPreloading as withPreloading} from '@angular/router';\n+import {ChildrenOutletContexts, ExtraOptions, NoPreloading, Route, Router, ROUTER_CONFIGURATION, RouteReuseStrategy, RouterModule, ROUTES, Routes, TitleStrategy, UrlHandlingStrategy, UrlSerializer, \u0275flatten as flatten, \u0275ROUTER_PROVIDERS as ROUTER_PROVIDERS, \u0275withPreloading as withPreloading} from '@angular/router';\n \n import {EXTRA_ROUTER_TESTING_PROVIDERS} from './extra_router_testing_providers';\n \n@@ -42,7 +42,6 @@ export function setupTestingRouter(\n   // in g3). It appears this function was exposed as publicApi by mistake and should not be used\n   // externally either. However, if it is, the documented intent is to be used as a factory function\n   // and parameter values should always match what's available in DI.\n-  const router = new Router();\n   if (urlSerializer !== inject(UrlSerializer)) {\n     throwInvalidConfigError('urlSerializer');\n   }\n@@ -64,24 +63,29 @@ export function setupTestingRouter(\n   if (opts) {\n     // Handle deprecated argument ordering.\n     if (isUrlHandlingStrategy(opts)) {\n-      router.urlHandlingStrategy = opts;\n+      if (opts !== inject(UrlHandlingStrategy)) {\n+        throwInvalidConfigError('opts (UrlHandlingStrategy)');\n+      }\n     } else {\n-      // Handle ExtraOptions\n-      assignExtraOptionsToRouter(opts, router);\n+      if (opts !== inject(ROUTER_CONFIGURATION)) {\n+        throwInvalidConfigError('opts (ROUTER_CONFIGURATION)');\n+      }\n     }\n   }\n \n-  if (urlHandlingStrategy) {\n-    router.urlHandlingStrategy = urlHandlingStrategy;\n+  if (urlHandlingStrategy !== inject(UrlHandlingStrategy)) {\n+    throwInvalidConfigError('urlHandlingStrategy');\n   }\n \n-  if (routeReuseStrategy) {\n-    router.routeReuseStrategy = routeReuseStrategy;\n+  if (routeReuseStrategy !== inject(RouteReuseStrategy)) {\n+    throwInvalidConfigError('routeReuseStrategy');\n   }\n \n-  router.titleStrategy = titleStrategy;\n+  if (titleStrategy !== inject(TitleStrategy)) {\n+    throwInvalidConfigError('titleStrategy');\n+  }\n \n-  return router;\n+  return new Router();\n }\n \n /**\n\n\n###\n\n", "completion": "refactor(router): Remove assignExtraOptionsToRouter helper function (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -16,7 +16,6 @@ import { EventEmitter } from '@angular/core';\n import * as i0 from '@angular/core';\n import { InjectionToken } from '@angular/core';\n import { Injector } from '@angular/core';\n-import { Location as Location_2 } from '@angular/common';\n import { LocationStrategy } from '@angular/common';\n import { ModuleWithProviders } from '@angular/core';\n import { NgModuleFactory } from '@angular/core';\n@@ -655,11 +654,7 @@ export class RouteConfigLoadStart {\n \n // @public\n export class Router {\n-    constructor(\n-    rootComponentType: Type<any> | null,\n-    urlSerializer: UrlSerializer,\n-    rootContexts: ChildrenOutletContexts,\n-    location: Location_2, injector: Injector, compiler: Compiler, config: Routes);\n+    constructor();\n     // @deprecated\n     canceledNavigationResolution: 'replace' | 'computed';\n     // (undocumented)\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -87,22 +87,6 @@ export function assignExtraOptionsToRouter(opts: ExtraOptions, router: Router):\n   }\n }\n \n-export function setupRouter() {\n-  const urlSerializer = inject(UrlSerializer);\n-  const contexts = inject(ChildrenOutletContexts);\n-  const location = inject(Location);\n-  const injector = inject(Injector);\n-  const compiler = inject(Compiler);\n-  const config = inject(ROUTES, {optional: true}) ?? [];\n-  const opts = inject(ROUTER_CONFIGURATION, {optional: true}) ?? {};\n-  const router =\n-      new Router(null, urlSerializer, contexts, location, injector, compiler, flatten(config));\n-\n-  assignExtraOptionsToRouter(opts, router);\n-\n-  return router;\n-}\n-\n /**\n  * @description\n  *\n@@ -115,10 +99,7 @@ export function setupRouter() {\n  *\n  * @publicApi\n  */\n-@Injectable({\n-  providedIn: 'root',\n-  useFactory: setupRouter,\n-})\n+@Injectable({providedIn: 'root'})\n export class Router {\n   /**\n    * Represents the activated `UrlTree` that the `Router` is configured to handle (through\n@@ -201,7 +182,7 @@ export class Router {\n   private get browserPageId(): number|undefined {\n     return (this.location.getState() as RestoredState | null)?.\u0275routerPageId;\n   }\n-  private console: Console;\n+  private console = inject(Console);\n   private isNgZoneEnabled: boolean = false;\n \n   /**\n@@ -349,27 +330,22 @@ export class Router {\n    */\n   canceledNavigationResolution: 'replace'|'computed' = 'replace';\n \n+  config: Routes = flatten(inject(ROUTES, {optional: true}) ?? []);\n+\n   private readonly navigationTransitions = inject(NavigationTransitions);\n+  private readonly urlSerializer = inject(UrlSerializer);\n+  private readonly location = inject(Location);\n \n-  /**\n-   * Creates the router service.\n-   */\n-  // TODO: vsavkin make internal after the final is out.\n-  constructor(\n-      /** @internal */\n-      public rootComponentType: Type<any>|null,\n-      private readonly urlSerializer: UrlSerializer,\n-      private readonly rootContexts: ChildrenOutletContexts,\n-      private readonly location: Location,\n-      injector: Injector,\n-      compiler: Compiler,\n-      public config: Routes,\n-  ) {\n-    this.console = injector.get(Console);\n-    const ngZone = injector.get(NgZone);\n-    this.isNgZoneEnabled = ngZone instanceof NgZone && NgZone.isInAngularZone();\n-\n-    this.resetConfig(config);\n+  /** @internal */\n+  rootComponentType: Type<any>|null = null;\n+\n+  constructor() {\n+    const opts = inject(ROUTER_CONFIGURATION, {optional: true}) ?? {};\n+    assignExtraOptionsToRouter(opts, this);\n+\n+    this.isNgZoneEnabled = inject(NgZone) instanceof NgZone && NgZone.isInAngularZone();\n+\n+    this.resetConfig(this.config);\n     this.currentUrlTree = new UrlTree();\n     this.rawUrlTree = this.currentUrlTree;\n     this.browserUrlTree = this.currentUrlTree;\n@@ -386,10 +362,7 @@ export class Router {\n         });\n   }\n \n-  /**\n-   * @internal\n-   * TODO: this should be removed once the constructor of the router made internal\n-   */\n+  /** @internal */\n   resetRootComponentType(rootComponentType: Type<any>): void {\n     this.rootComponentType = rootComponentType;\n     // TODO: vsavkin router 4.0 should make the root component set to null\n\n---\n file path A: packages/router/src/router_module.ts | file path B: packages/router/src/router_module.ts\n\n@@ -17,7 +17,7 @@ import {RuntimeErrorCode} from './errors';\n import {Routes} from './models';\n import {NavigationTransitions} from './navigation_transition';\n import {getBootstrapListener, rootRoute, ROUTER_IS_PROVIDED, withDebugTracing, withDisabledInitialNavigation, withEnabledBlockingInitialNavigation, withPreloading} from './provide_router';\n-import {Router, setupRouter} from './router';\n+import {Router} from './router';\n import {ExtraOptions, ROUTER_CONFIGURATION} from './router_config';\n import {RouterConfigLoader, ROUTES} from './router_config_loader';\n import {ChildrenOutletContexts} from './router_outlet_context';\n@@ -45,7 +45,7 @@ export const ROUTER_FORROOT_GUARD = new InjectionToken<void>(\n export const ROUTER_PROVIDERS: Provider[] = [\n   Location,\n   {provide: UrlSerializer, useClass: DefaultUrlSerializer},\n-  {provide: Router, useFactory: setupRouter},\n+  Router,\n   ChildrenOutletContexts,\n   {provide: ActivatedRoute, useFactory: rootRoute, deps: [Router]},\n   RouterConfigLoader,\n\n---\n file path A: packages/router/testing/src/router_testing_module.ts | file path B: packages/router/testing/src/router_testing_module.ts\n\n@@ -8,7 +8,7 @@\n \n import {Location} from '@angular/common';\n import {provideLocationMocks} from '@angular/common/testing';\n-import {Compiler, Injector, ModuleWithProviders, NgModule, Optional} from '@angular/core';\n+import {Compiler, inject, Injector, ModuleWithProviders, NgModule} from '@angular/core';\n import {ChildrenOutletContexts, ExtraOptions, NoPreloading, Route, Router, ROUTER_CONFIGURATION, RouteReuseStrategy, RouterModule, ROUTES, Routes, TitleStrategy, UrlHandlingStrategy, UrlSerializer, \u0275assignExtraOptionsToRouter as assignExtraOptionsToRouter, \u0275flatten as flatten, \u0275ROUTER_PROVIDERS as ROUTER_PROVIDERS, \u0275withPreloading as withPreloading} from '@angular/router';\n \n import {EXTRA_ROUTER_TESTING_PROVIDERS} from './extra_router_testing_providers';\n@@ -20,6 +20,12 @@ function isUrlHandlingStrategy(opts: ExtraOptions|\n   return 'shouldProcessUrl' in opts;\n }\n \n+function throwInvalidConfigError(parameter: string): never {\n+  throw new Error(\n+      `Parameter ${parameter} does not match the one available in the injector. ` +\n+      '`setupTestingRouter` is meant to be used as a factory function with dependencies coming from DI.');\n+}\n+\n /**\n  * Router setup factory function used for testing.\n  *\n@@ -31,8 +37,30 @@ export function setupTestingRouter(\n     compiler: Compiler, injector: Injector, routes: Route[][],\n     opts?: ExtraOptions|UrlHandlingStrategy|null, urlHandlingStrategy?: UrlHandlingStrategy,\n     routeReuseStrategy?: RouteReuseStrategy, titleStrategy?: TitleStrategy) {\n-  const router =\n-      new Router(null!, urlSerializer, contexts, location, injector, compiler, flatten(routes));\n+  // Note: The checks below are to detect misconfigured providers and invalid uses of\n+  // `setupTestingRouter`. This function is not used internally (neither in router code or anywhere\n+  // in g3). It appears this function was exposed as publicApi by mistake and should not be used\n+  // externally either. However, if it is, the documented intent is to be used as a factory function\n+  // and parameter values should always match what's available in DI.\n+  const router = new Router();\n+  if (urlSerializer !== inject(UrlSerializer)) {\n+    throwInvalidConfigError('urlSerializer');\n+  }\n+  if (contexts !== inject(ChildrenOutletContexts)) {\n+    throwInvalidConfigError('contexts');\n+  }\n+  if (location !== inject(Location)) {\n+    throwInvalidConfigError('location');\n+  }\n+  if (compiler !== inject(Compiler)) {\n+    throwInvalidConfigError('compiler');\n+  }\n+  if (injector !== inject(Injector)) {\n+    throwInvalidConfigError('injector');\n+  }\n+  if (routes !== inject(ROUTES)) {\n+    throwInvalidConfigError('routes');\n+  }\n   if (opts) {\n     // Handle deprecated argument ordering.\n     if (isUrlHandlingStrategy(opts)) {\n\n\n###\n\n", "completion": "refactor(router): Eliminate constructor parameters in Router class (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,14 @@\n+<a name=\"15.0.2\"></a>\n+# 15.0.2 (2022-11-30)\n+### compiler-cli\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [86a21f5569](https://github.com/angular/angular/commit/86a21f5569bc4b8060a882bd3d542a6c002438c7) | fix | accept inheriting the constructor from a class in a library ([#48156](https://github.com/angular/angular/pull/48156)) |\n+## Special Thanks\n+Alan Agius, Andrew Scott, Aristeidis Bampakos, Bob Watson, Derek Cormier, JoostK, Kristiyan Kostadinov, Matthieu Riegler, Paul Gschwendtner, Pawel Kozlowski, Rokas Brazd\u017eionis, mgechev and piyush132000\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.0.1\"></a>\n # 15.0.1 (2022-11-22)\n ### common\n\n\n###\n\n", "completion": "docs: release notes for the v15.0.2 release"}
{"prompt": " file path A: package.json | file path B: package.json\n\n@@ -104,7 +104,7 @@\n     \"@types/semver\": \"^7.3.4\",\n     \"@types/shelljs\": \"^0.8.6\",\n     \"@types/systemjs\": \"0.19.32\",\n-    \"@types/uuid\": \"^8.3.1\",\n+    \"@types/uuid\": \"^9.0.0\",\n     \"@types/yargs\": \"^17.0.3\",\n     \"@webcomponents/custom-elements\": \"^1.1.0\",\n     \"angular-1.5\": \"npm:angular@1.5\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -4360,6 +4360,11 @@\n   resolved \"https://registry.yarnpkg.com/@types/uuid/-/uuid-8.3.4.tgz#bd86a43617df0594787d38b735f55c805becf1bc\"\n   integrity sha512-c/I8ZRb51j+pYGAu5CrFMRxqZ2ke4y2grEBO5AUjgSkSk+qT2Ea+OdWElz/OiMf5MNpn2b17kuVBwZLQJXzihw==\n \n+\"@types/uuid@^9.0.0\":\n+  version \"9.0.0\"\n+  resolved \"https://registry.yarnpkg.com/@types/uuid/-/uuid-9.0.0.tgz#53ef263e5239728b56096b0a869595135b7952d2\"\n+  integrity sha512-kr90f+ERiQtKWMz5rP32ltJ/BtULDI5RVO0uavn1HQUOwjx0R1h0rnDYNL0CepF1zL5bSY6FISAfd9tOdDhU5Q==\n+\n \"@types/which@^1.3.2\":\n   version \"1.3.2\"\n   resolved \"https://registry.yarnpkg.com/@types/which/-/which-1.3.2.tgz#9c246fc0c93ded311c8512df2891fb41f6227fdf\"\n\n\n###\n\n", "completion": "build: update dependency @types/uuid to v9 (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -361,7 +361,7 @@ export interface IsActiveMatchOptions {\n }\n \n // @public\n-export type LoadChildren = LoadChildrenCallback | \u0275DeprecatedLoadChildren;\n+export type LoadChildren = LoadChildrenCallback;\n \n // @public\n export type LoadChildrenCallback = () => Type<any> | NgModuleFactory<any> | Routes | Observable<Type<any> | Routes | DefaultExport<Type<any>> | DefaultExport<Routes>> | Promise<NgModuleFactory<any> | Type<any> | Routes | DefaultExport<Type<any>> | DefaultExport<Routes>>;\n\n---\n file path A: packages/router/src/deprecated_load_children.ts | file path B: packages/router/src/deprecated_load_children.ts\n\n@@ -12,14 +12,6 @@ import {Observable} from 'rxjs';\n // This file exists to support the legacy `loadChildren: string` behavior being patched back into\n // Angular.\n \n-/**\n- * Deprecated `loadChildren` value types.\n- *\n- * @publicApi\n- * @deprecated represents the deprecated type side of `LoadChildren`.\n- */\n-export type DeprecatedLoadChildren = never;\n-\n export function deprecatedLoadChildrenString(\n     injector: Injector, loadChildren: unknown): Observable<NgModuleFactory<any>>|null {\n   return null;\n\n---\n file path A: packages/router/src/models.ts | file path B: packages/router/src/models.ts\n\n@@ -9,7 +9,6 @@\n import {EnvironmentInjector, EnvironmentProviders, InjectionToken, NgModuleFactory, Provider, Type} from '@angular/core';\n import {Observable} from 'rxjs';\n \n-import {DeprecatedLoadChildren} from './deprecated_load_children';\n import {ActivatedRouteSnapshot, RouterStateSnapshot} from './router_state';\n import {UrlSegment, UrlSegmentGroup, UrlTree} from './url_tree';\n \n@@ -175,7 +174,7 @@ export type LoadChildrenCallback = () => Type<any>|NgModuleFactory<any>|Routes|\n  * @see `LoadChildrenCallback`\n  * @publicApi\n  */\n-export type LoadChildren = LoadChildrenCallback|DeprecatedLoadChildren;\n+export type LoadChildren = LoadChildrenCallback;\n \n /**\n  *\n\n---\n file path A: packages/router/src/private_export.ts | file path B: packages/router/src/private_export.ts\n\n@@ -8,7 +8,6 @@\n \n \n export {\u0275EmptyOutletComponent} from './components/empty_outlet';\n-export {DeprecatedLoadChildren as \u0275DeprecatedLoadChildren} from './deprecated_load_children';\n export {RestoredState as \u0275RestoredState} from './navigation_transition';\n export {withPreloading as \u0275withPreloading} from './provide_router';\n export {assignExtraOptionsToRouter as \u0275assignExtraOptionsToRouter} from './router';\n\n\n###\n\n", "completion": "refactor(router): Remove DeprecatedLoadChildren (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/navigation_transition.ts | file path B: packages/router/src/navigation_transition.ts\n\n@@ -266,7 +266,6 @@ interface InternalRouterInterface {\n   browserUrlTree: UrlTree;\n   currentUrlTree: UrlTree;\n   rawUrlTree: UrlTree;\n-  navigationId: number;\n   readonly routerState: RouterState;\n   errorHandler: ErrorHandler;\n   titleStrategy?: TitleStrategy;\n@@ -297,10 +296,11 @@ export class NavigationTransitions {\n   private readonly environmentInjector = inject(EnvironmentInjector);\n   private readonly urlSerializer = inject(UrlSerializer);\n   private readonly rootContexts = inject(ChildrenOutletContexts);\n-  private _transitions?: BehaviorSubject<NavigationTransition>;\n-  get transitions(): BehaviorSubject<NavigationTransition>|undefined {\n-    return this._transitions;\n+  navigationId = 0;\n+  get hasRequestedNavigation() {\n+    return this.navigationId !== 0;\n   }\n+  private transitions?: BehaviorSubject<NavigationTransition>;\n \n   constructor() {\n     const onLoadStart = (r: Route) => this.events.next(new RouteConfigLoadStart(r));\n@@ -309,8 +309,21 @@ export class NavigationTransitions {\n     this.configLoader.onLoadStartListener = onLoadStart;\n   }\n \n+  complete() {\n+    this.transitions?.complete();\n+  }\n+\n+  handleNavigationRequest(\n+      request: Pick<\n+          NavigationTransition,\n+          'targetPageId'|'source'|'restoredState'|'currentUrlTree'|'currentRawUrl'|'rawUrl'|\n+          'extras'|'resolve'|'reject'|'promise'|'currentSnapshot'|'currentRouterState'>) {\n+    const id = ++this.navigationId;\n+    this.transitions?.next({...this.transitions.value, ...request, id});\n+  }\n+\n   setupNavigations(router: InternalRouterInterface): Observable<NavigationTransition> {\n-    this._transitions = new BehaviorSubject<NavigationTransition>({\n+    this.transitions = new BehaviorSubject<NavigationTransition>({\n       id: 0,\n       targetPageId: 0,\n       currentUrlTree: router.currentUrlTree,\n@@ -331,7 +344,7 @@ export class NavigationTransitions {\n       guards: {canActivateChecks: [], canDeactivateChecks: []},\n       guardsResult: null,\n     });\n-    return this._transitions.pipe(\n+    return this.transitions.pipe(\n                filter(t => t.id !== 0),\n \n                // Extract URL\n@@ -662,7 +675,7 @@ export class NavigationTransitions {\n                                  `Navigation ID ${\n                                      overallTransitionState\n                                          .id} is not equal to the current navigation id ${\n-                                     router.navigationId}` :\n+                                     this.navigationId}` :\n                                  '';\n                              this.cancelNavigationTransition(\n                                  overallTransitionState, cancelationReason,\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -178,8 +178,11 @@ export class Router {\n   private disposed = false;\n \n   private locationSubscription?: SubscriptionLike;\n-  /** @internal */\n-  navigationId: number = 0;\n+  // TODO(b/260747083): This should not exist and navigationId should be private in\n+  // `NavigationTransitions`\n+  private get navigationId() {\n+    return this.navigationTransitions.navigationId;\n+  }\n \n   /**\n    * The id of the currently active page in the router.\n@@ -394,17 +397,12 @@ export class Router {\n     this.routerState.root.component = this.rootComponentType;\n   }\n \n-  private setTransition(t: Partial<NavigationTransition>): void {\n-    this.navigationTransitions.transitions?.next(\n-        {...this.navigationTransitions.transitions?.value, ...t});\n-  }\n-\n   /**\n    * Sets up the location change listener and performs the initial navigation.\n    */\n   initialNavigation(): void {\n     this.setUpLocationChangeListener();\n-    if (this.navigationId === 0) {\n+    if (!this.navigationTransitions.hasRequestedNavigation) {\n       this.navigateByUrl(this.location.path(true), {replaceUrl: true});\n     }\n   }\n@@ -499,7 +497,7 @@ export class Router {\n \n   /** Disposes of the router. */\n   dispose(): void {\n-    this.navigationTransitions.transitions?.complete();\n+    this.navigationTransitions.complete();\n     if (this.locationSubscription) {\n       this.locationSubscription.unsubscribe();\n       this.locationSubscription = undefined;\n@@ -736,7 +734,6 @@ export class Router {\n       });\n     }\n \n-    const id = ++this.navigationId;\n     let targetPageId: number;\n     if (this.canceledNavigationResolution === 'computed') {\n       const isInitialPage = this.currentPageId === 0;\n@@ -762,12 +759,12 @@ export class Router {\n       targetPageId = 0;\n     }\n \n-    this.setTransition({\n-      id,\n+    this.navigationTransitions.handleNavigationRequest({\n       targetPageId,\n       source,\n       restoredState,\n       currentUrlTree: this.currentUrlTree,\n+      currentRawUrl: this.currentUrlTree,\n       rawUrl,\n       extras,\n       resolve,\n\n---\n file path A: packages/router/src/navigation_transition.ts | file path B: packages/router/src/navigation_transition.ts\n\n@@ -266,7 +266,6 @@ interface InternalRouterInterface {\n   browserUrlTree: UrlTree;\n   currentUrlTree: UrlTree;\n   rawUrlTree: UrlTree;\n-  navigationId: number;\n   readonly routerState: RouterState;\n   errorHandler: ErrorHandler;\n   titleStrategy?: TitleStrategy;\n@@ -297,10 +296,11 @@ export class NavigationTransitions {\n   private readonly environmentInjector = inject(EnvironmentInjector);\n   private readonly urlSerializer = inject(UrlSerializer);\n   private readonly rootContexts = inject(ChildrenOutletContexts);\n-  private _transitions?: BehaviorSubject<NavigationTransition>;\n-  get transitions(): BehaviorSubject<NavigationTransition>|undefined {\n-    return this._transitions;\n+  private navigationId = 0;\n+  get hasRequestedNavigation() {\n+    return this.navigationId !== 0;\n   }\n+  private transitions?: BehaviorSubject<NavigationTransition>;\n \n   constructor() {\n     const onLoadStart = (r: Route) => this.events.next(new RouteConfigLoadStart(r));\n@@ -309,8 +309,21 @@ export class NavigationTransitions {\n     this.configLoader.onLoadStartListener = onLoadStart;\n   }\n \n+  complete() {\n+    this.transitions?.complete();\n+  }\n+\n+  handleNavigationRequest(\n+      request: Pick<\n+          NavigationTransition,\n+          'targetPageId'|'source'|'restoredState'|'currentUrlTree'|'currentRawUrl'|'rawUrl'|\n+          'extras'|'resolve'|'reject'|'promise'|'currentSnapshot'|'currentRouterState'>) {\n+    const id = ++this.navigationId;\n+    this.transitions?.next({...this.transitions.value, ...request, id});\n+  }\n+\n   setupNavigations(router: InternalRouterInterface): Observable<NavigationTransition> {\n-    this._transitions = new BehaviorSubject<NavigationTransition>({\n+    this.transitions = new BehaviorSubject<NavigationTransition>({\n       id: 0,\n       targetPageId: 0,\n       currentUrlTree: router.currentUrlTree,\n@@ -331,7 +344,7 @@ export class NavigationTransitions {\n       guards: {canActivateChecks: [], canDeactivateChecks: []},\n       guardsResult: null,\n     });\n-    return this._transitions.pipe(\n+    return this.transitions.pipe(\n                filter(t => t.id !== 0),\n \n                // Extract URL\n@@ -662,7 +675,7 @@ export class NavigationTransitions {\n                                  `Navigation ID ${\n                                      overallTransitionState\n                                          .id} is not equal to the current navigation id ${\n-                                     router.navigationId}` :\n+                                     this.navigationId}` :\n                                  '';\n                              this.cancelNavigationTransition(\n                                  overallTransitionState, cancelationReason,\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -178,8 +178,6 @@ export class Router {\n   private disposed = false;\n \n   private locationSubscription?: SubscriptionLike;\n-  /** @internal */\n-  navigationId: number = 0;\n \n   /**\n    * The id of the currently active page in the router.\n@@ -394,17 +392,12 @@ export class Router {\n     this.routerState.root.component = this.rootComponentType;\n   }\n \n-  private setTransition(t: Partial<NavigationTransition>): void {\n-    this.navigationTransitions.transitions?.next(\n-        {...this.navigationTransitions.transitions?.value, ...t});\n-  }\n-\n   /**\n    * Sets up the location change listener and performs the initial navigation.\n    */\n   initialNavigation(): void {\n     this.setUpLocationChangeListener();\n-    if (this.navigationId === 0) {\n+    if (!this.navigationTransitions.hasRequestedNavigation) {\n       this.navigateByUrl(this.location.path(true), {replaceUrl: true});\n     }\n   }\n@@ -499,7 +492,7 @@ export class Router {\n \n   /** Disposes of the router. */\n   dispose(): void {\n-    this.navigationTransitions.transitions?.complete();\n+    this.navigationTransitions.complete();\n     if (this.locationSubscription) {\n       this.locationSubscription.unsubscribe();\n       this.locationSubscription = undefined;\n@@ -736,7 +729,6 @@ export class Router {\n       });\n     }\n \n-    const id = ++this.navigationId;\n     let targetPageId: number;\n     if (this.canceledNavigationResolution === 'computed') {\n       const isInitialPage = this.currentPageId === 0;\n@@ -762,12 +754,12 @@ export class Router {\n       targetPageId = 0;\n     }\n \n-    this.setTransition({\n-      id,\n+    this.navigationTransitions.handleNavigationRequest({\n       targetPageId,\n       source,\n       restoredState,\n       currentUrlTree: this.currentUrlTree,\n+      currentRawUrl: this.currentUrlTree,\n       rawUrl,\n       extras,\n       resolve,\n\n\n###\n\n", "completion": "refactor(router): Move navigationId handling to the transition manager (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/navigation_transition.ts | file path B: packages/router/src/navigation_transition.ts\n\n@@ -239,6 +239,7 @@ export interface NavigationTransition {\n   targetPageId: number;\n   currentUrlTree: UrlTree;\n   extractedUrl: UrlTree;\n+  currentRawUrl: UrlTree;\n   urlAfterRedirects?: UrlTree;\n   rawUrl: UrlTree;\n   extras: NavigationExtras;\n@@ -265,7 +266,6 @@ interface InternalRouterInterface {\n   browserUrlTree: UrlTree;\n   currentUrlTree: UrlTree;\n   rawUrlTree: UrlTree;\n-  transitions: BehaviorSubject<NavigationTransition>;\n   navigationId: number;\n   readonly routerState: RouterState;\n   errorHandler: ErrorHandler;\n@@ -297,6 +297,10 @@ export class NavigationTransitions {\n   private readonly environmentInjector = inject(EnvironmentInjector);\n   private readonly urlSerializer = inject(UrlSerializer);\n   private readonly rootContexts = inject(ChildrenOutletContexts);\n+  private _transitions?: BehaviorSubject<NavigationTransition>;\n+  get transitions(): BehaviorSubject<NavigationTransition>|undefined {\n+    return this._transitions;\n+  }\n \n   constructor() {\n     const onLoadStart = (r: Route) => this.events.next(new RouteConfigLoadStart(r));\n@@ -305,9 +309,29 @@ export class NavigationTransitions {\n     this.configLoader.onLoadStartListener = onLoadStart;\n   }\n \n-  setupNavigations(transitions: Observable<NavigationTransition>, router: InternalRouterInterface):\n-      Observable<NavigationTransition> {\n-    return transitions.pipe(\n+  setupNavigations(router: InternalRouterInterface): Observable<NavigationTransition> {\n+    this._transitions = new BehaviorSubject<NavigationTransition>({\n+      id: 0,\n+      targetPageId: 0,\n+      currentUrlTree: router.currentUrlTree,\n+      currentRawUrl: router.currentUrlTree,\n+      extractedUrl: router.urlHandlingStrategy.extract(router.currentUrlTree),\n+      urlAfterRedirects: router.urlHandlingStrategy.extract(router.currentUrlTree),\n+      rawUrl: router.currentUrlTree,\n+      extras: {},\n+      resolve: null,\n+      reject: null,\n+      promise: Promise.resolve(true),\n+      source: 'imperative',\n+      restoredState: null,\n+      currentSnapshot: router.routerState.snapshot,\n+      targetSnapshot: null,\n+      currentRouterState: router.routerState,\n+      targetRouterState: null,\n+      guards: {canActivateChecks: [], canDeactivateChecks: []},\n+      guardsResult: null,\n+    });\n+    return this._transitions.pipe(\n                filter(t => t.id !== 0),\n \n                // Extract URL\n@@ -370,11 +394,11 @@ export class NavigationTransitions {\n                              return of(t).pipe(\n                                  // Fire NavigationStart event\n                                  switchMap(t => {\n-                                   const transition = router.transitions.getValue();\n+                                   const transition = this.transitions?.getValue();\n                                    this.events.next(new NavigationStart(\n                                        t.id, this.urlSerializer.serialize(t.extractedUrl), t.source,\n                                        t.restoredState));\n-                                   if (transition !== router.transitions.getValue()) {\n+                                   if (transition !== this.transitions?.getValue()) {\n                                      return EMPTY;\n                                    }\n \n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -175,9 +175,6 @@ export class Router {\n    * @internal\n    */\n   browserUrlTree: UrlTree;\n-  /** @internal */\n-  readonly transitions: BehaviorSubject<NavigationTransition>;\n-  private navigations: Observable<NavigationTransition>;\n   private disposed = false;\n \n   private locationSubscription?: SubscriptionLike;\n@@ -208,7 +205,11 @@ export class Router {\n    * An event stream for routing events.\n    */\n   public get events(): Observable<Event> {\n-    return this.navigationTransitions.events.asObservable();\n+    // TODO(atscott): This _should_ be events.asObservable(). However, this change requires internal\n+    // cleanup: tests are doing `(route.events as Subject<Event>).next(...)`. This isn't\n+    // allowed/supported but we still have to fix these or file bugs against the teams before making\n+    // the change.\n+    return this.navigationTransitions.events;\n   }\n   /**\n    * The current state of routing in this NgModule.\n@@ -372,29 +373,14 @@ export class Router {\n \n     this.routerState = createEmptyState(this.currentUrlTree, this.rootComponentType);\n \n-    this.transitions = new BehaviorSubject<NavigationTransition>({\n-      id: 0,\n-      targetPageId: 0,\n-      currentUrlTree: this.currentUrlTree,\n-      extractedUrl: this.urlHandlingStrategy.extract(this.currentUrlTree),\n-      urlAfterRedirects: this.urlHandlingStrategy.extract(this.currentUrlTree),\n-      rawUrl: this.currentUrlTree,\n-      extras: {},\n-      resolve: null,\n-      reject: null,\n-      promise: Promise.resolve(true),\n-      source: 'imperative',\n-      restoredState: null,\n-      currentSnapshot: this.routerState.snapshot,\n-      targetSnapshot: null,\n-      currentRouterState: this.routerState,\n-      targetRouterState: null,\n-      guards: {canActivateChecks: [], canDeactivateChecks: []},\n-      guardsResult: null,\n-    });\n-    this.navigations = this.navigationTransitions.setupNavigations(this.transitions, this);\n-\n-    this.processNavigations();\n+    this.navigationTransitions.setupNavigations(this).subscribe(\n+        t => {\n+          this.lastSuccessfulId = t.id;\n+          this.currentPageId = t.targetPageId;\n+        },\n+        e => {\n+          this.console.warn(`Unhandled Navigation Error: ${e}`);\n+        });\n   }\n \n   /**\n@@ -409,7 +395,8 @@ export class Router {\n   }\n \n   private setTransition(t: Partial<NavigationTransition>): void {\n-    this.transitions.next({...this.transitions.value, ...t});\n+    this.navigationTransitions.transitions?.next(\n+        {...this.navigationTransitions.transitions?.value, ...t});\n   }\n \n   /**\n@@ -512,7 +499,7 @@ export class Router {\n \n   /** Disposes of the router. */\n   dispose(): void {\n-    this.transitions.complete();\n+    this.navigationTransitions.transitions?.complete();\n     if (this.locationSubscription) {\n       this.locationSubscription.unsubscribe();\n       this.locationSubscription = undefined;\n@@ -726,17 +713,6 @@ export class Router {\n     }, {});\n   }\n \n-  private processNavigations(): void {\n-    this.navigations.subscribe(\n-        t => {\n-          this.lastSuccessfulId = t.id;\n-          this.currentPageId = t.targetPageId;\n-        },\n-        e => {\n-          this.console.warn(`Unhandled Navigation Error: ${e}`);\n-        });\n-  }\n-\n   /** @internal */\n   scheduleNavigation(\n       rawUrl: UrlTree, source: NavigationTrigger, restoredState: RestoredState|null,\n\n---\n file path A: packages/router/src/navigation_transition.ts | file path B: packages/router/src/navigation_transition.ts\n\n@@ -239,6 +239,7 @@ export interface NavigationTransition {\n   targetPageId: number;\n   currentUrlTree: UrlTree;\n   extractedUrl: UrlTree;\n+  currentRawUrl: UrlTree;\n   urlAfterRedirects?: UrlTree;\n   rawUrl: UrlTree;\n   extras: NavigationExtras;\n@@ -265,7 +266,6 @@ interface InternalRouterInterface {\n   browserUrlTree: UrlTree;\n   currentUrlTree: UrlTree;\n   rawUrlTree: UrlTree;\n-  transitions: BehaviorSubject<NavigationTransition>;\n   navigationId: number;\n   readonly routerState: RouterState;\n   errorHandler: ErrorHandler;\n@@ -297,6 +297,10 @@ export class NavigationTransitions {\n   private readonly environmentInjector = inject(EnvironmentInjector);\n   private readonly urlSerializer = inject(UrlSerializer);\n   private readonly rootContexts = inject(ChildrenOutletContexts);\n+  private _transitions?: BehaviorSubject<NavigationTransition>;\n+  get transitions(): BehaviorSubject<NavigationTransition>|undefined {\n+    return this._transitions;\n+  }\n \n   constructor() {\n     const onLoadStart = (r: Route) => this.events.next(new RouteConfigLoadStart(r));\n@@ -305,9 +309,29 @@ export class NavigationTransitions {\n     this.configLoader.onLoadStartListener = onLoadStart;\n   }\n \n-  setupNavigations(transitions: Observable<NavigationTransition>, router: InternalRouterInterface):\n-      Observable<NavigationTransition> {\n-    return transitions.pipe(\n+  setupNavigations(router: InternalRouterInterface): Observable<NavigationTransition> {\n+    this._transitions = new BehaviorSubject<NavigationTransition>({\n+      id: 0,\n+      targetPageId: 0,\n+      currentUrlTree: router.currentUrlTree,\n+      currentRawUrl: router.currentUrlTree,\n+      extractedUrl: router.urlHandlingStrategy.extract(router.currentUrlTree),\n+      urlAfterRedirects: router.urlHandlingStrategy.extract(router.currentUrlTree),\n+      rawUrl: router.currentUrlTree,\n+      extras: {},\n+      resolve: null,\n+      reject: null,\n+      promise: Promise.resolve(true),\n+      source: 'imperative',\n+      restoredState: null,\n+      currentSnapshot: router.routerState.snapshot,\n+      targetSnapshot: null,\n+      currentRouterState: router.routerState,\n+      targetRouterState: null,\n+      guards: {canActivateChecks: [], canDeactivateChecks: []},\n+      guardsResult: null,\n+    });\n+    return this._transitions.pipe(\n                filter(t => t.id !== 0),\n \n                // Extract URL\n@@ -354,8 +378,8 @@ export class NavigationTransitions {\n                                      t.rawUrl} was ignored because it is the same as the current Router URL.` :\n                                  '';\n                              this.events.next(new NavigationSkipped(\n-                                 t.id, router.serializeUrl(overallTransitionState.rawUrl),\n-                                 reason, NavigationSkippedCode.IgnoredSameUrlNavigation));\n+                                 t.id, router.serializeUrl(overallTransitionState.rawUrl), reason,\n+                                 NavigationSkippedCode.IgnoredSameUrlNavigation));\n                              router.rawUrlTree = t.rawUrl;\n                              t.resolve(null);\n                              return EMPTY;\n@@ -370,11 +394,11 @@ export class NavigationTransitions {\n                              return of(t).pipe(\n                                  // Fire NavigationStart event\n                                  switchMap(t => {\n-                                   const transition = router.transitions.getValue();\n+                                   const transition = this.transitions?.getValue();\n                                    this.events.next(new NavigationStart(\n                                        t.id, this.urlSerializer.serialize(t.extractedUrl), t.source,\n                                        t.restoredState));\n-                                   if (transition !== router.transitions.getValue()) {\n+                                   if (transition !== this.transitions?.getValue()) {\n                                      return EMPTY;\n                                    }\n \n@@ -425,19 +449,17 @@ export class NavigationTransitions {\n                                  }));\n                            } else if (\n                                urlTransition &&\n-                               router.urlHandlingStrategy.shouldProcessUrl(\n-                                   router.rawUrlTree)) {\n+                               router.urlHandlingStrategy.shouldProcessUrl(router.rawUrlTree)) {\n                              /* When the current URL shouldn't be processed, but the previous one\n                               * was, we handle this \"error condition\" by navigating to the\n                               * previously successful URL, but leaving the URL intact.*/\n-                               const {id, extractedUrl, source, restoredState, extras} = t;\n-                               const navStart = new NavigationStart(\n-                                   id, this.urlSerializer.serialize(extractedUrl), source,\n-                                   restoredState);\n-                               this.events.next(navStart);\n-                               const targetSnapshot =\n-                                   createEmptyState(extractedUrl, router.rootComponentType)\n-                                       .snapshot;\n+                             const {id, extractedUrl, source, restoredState, extras} = t;\n+                             const navStart = new NavigationStart(\n+                                 id, this.urlSerializer.serialize(extractedUrl), source,\n+                                 restoredState);\n+                             this.events.next(navStart);\n+                             const targetSnapshot =\n+                                 createEmptyState(extractedUrl, router.rootComponentType).snapshot;\n \n                              overallTransitionState = {\n                                ...t,\n@@ -459,8 +481,7 @@ export class NavigationTransitions {\n                                          t.rawUrl} should be processed.` :\n                                  '';\n                              this.events.next(new NavigationSkipped(\n-                                 t.id,\n-                                 router.serializeUrl(overallTransitionState.extractedUrl),\n+                                 t.id, router.serializeUrl(overallTransitionState.extractedUrl),\n                                  reason, NavigationSkippedCode.IgnoredByUrlHandlingStrategy));\n                              router.rawUrlTree = t.rawUrl;\n                              t.resolve(null);\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -175,9 +175,6 @@ export class Router {\n    * @internal\n    */\n   browserUrlTree: UrlTree;\n-  /** @internal */\n-  readonly transitions: BehaviorSubject<NavigationTransition>;\n-  private navigations: Observable<NavigationTransition>;\n   private disposed = false;\n \n   private locationSubscription?: SubscriptionLike;\n@@ -208,7 +205,11 @@ export class Router {\n    * An event stream for routing events.\n    */\n   public get events(): Observable<Event> {\n-    return this.navigationTransitions.events.asObservable();\n+    // TODO(atscott): This _should_ be events.asObservable(). However, this change requires internal\n+    // cleanup: tests are doing `(route.events as Subject<Event>).next(...)`. This isn't\n+    // allowed/supported but we still have to fix these or file bugs against the teams before making\n+    // the change.\n+    return this.navigationTransitions.events;\n   }\n   /**\n    * The current state of routing in this NgModule.\n@@ -372,29 +373,14 @@ export class Router {\n \n     this.routerState = createEmptyState(this.currentUrlTree, this.rootComponentType);\n \n-    this.transitions = new BehaviorSubject<NavigationTransition>({\n-      id: 0,\n-      targetPageId: 0,\n-      currentUrlTree: this.currentUrlTree,\n-      extractedUrl: this.urlHandlingStrategy.extract(this.currentUrlTree),\n-      urlAfterRedirects: this.urlHandlingStrategy.extract(this.currentUrlTree),\n-      rawUrl: this.currentUrlTree,\n-      extras: {},\n-      resolve: null,\n-      reject: null,\n-      promise: Promise.resolve(true),\n-      source: 'imperative',\n-      restoredState: null,\n-      currentSnapshot: this.routerState.snapshot,\n-      targetSnapshot: null,\n-      currentRouterState: this.routerState,\n-      targetRouterState: null,\n-      guards: {canActivateChecks: [], canDeactivateChecks: []},\n-      guardsResult: null,\n-    });\n-    this.navigations = this.navigationTransitions.setupNavigations(this.transitions, this);\n-\n-    this.processNavigations();\n+    this.navigationTransitions.setupNavigations(this).subscribe(\n+        t => {\n+          this.lastSuccessfulId = t.id;\n+          this.currentPageId = t.targetPageId;\n+        },\n+        e => {\n+          this.console.warn(`Unhandled Navigation Error: ${e}`);\n+        });\n   }\n \n   /**\n@@ -409,7 +395,8 @@ export class Router {\n   }\n \n   private setTransition(t: Partial<NavigationTransition>): void {\n-    this.transitions.next({...this.transitions.value, ...t});\n+    this.navigationTransitions.transitions?.next(\n+        {...this.navigationTransitions.transitions?.value, ...t});\n   }\n \n   /**\n@@ -512,7 +499,7 @@ export class Router {\n \n   /** Disposes of the router. */\n   dispose(): void {\n-    this.transitions.complete();\n+    this.navigationTransitions.transitions?.complete();\n     if (this.locationSubscription) {\n       this.locationSubscription.unsubscribe();\n       this.locationSubscription = undefined;\n@@ -726,17 +713,6 @@ export class Router {\n     }, {});\n   }\n \n-  private processNavigations(): void {\n-    this.navigations.subscribe(\n-        t => {\n-          this.lastSuccessfulId = t.id;\n-          this.currentPageId = t.targetPageId;\n-        },\n-        e => {\n-          this.console.warn(`Unhandled Navigation Error: ${e}`);\n-        });\n-  }\n-\n   /** @internal */\n   scheduleNavigation(\n       rawUrl: UrlTree, source: NavigationTrigger, restoredState: RestoredState|null,\n\n\n###\n\n", "completion": "refactor(router): Move transition subject into transition handler (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/navigation_transition.ts | file path B: packages/router/src/navigation_transition.ts\n\n@@ -6,7 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Location} from '@angular/common';\n import {EnvironmentInjector, inject, Injectable, Type} from '@angular/core';\n import {BehaviorSubject, combineLatest, EMPTY, Observable, of, Subject} from 'rxjs';\n import {catchError, defaultIfEmpty, filter, finalize, map, switchMap, take, tap} from 'rxjs/operators';\n@@ -281,9 +280,6 @@ interface InternalRouterInterface {\n   serializeUrl(url: UrlTree): string;\n   config: Routes;\n   rootComponentType: Type<any>|null;\n-  urlSerializer: UrlSerializer;\n-  rootContexts: ChildrenOutletContexts;\n-  location: Location;\n   setBrowserUrl(url: UrlTree, t: NavigationTransition): void;\n   restoreHistory(t: NavigationTransition, restoringFromCaughtError?: boolean): void;\n   scheduleNavigation(\n@@ -299,6 +295,8 @@ export class NavigationTransitions {\n   readonly events = new Subject<Event>();\n   private readonly configLoader = inject(RouterConfigLoader);\n   private readonly environmentInjector = inject(EnvironmentInjector);\n+  private readonly urlSerializer = inject(UrlSerializer);\n+  private readonly rootContexts = inject(ChildrenOutletContexts);\n \n   constructor() {\n     const onLoadStart = (r: Route) => this.events.next(new RouteConfigLoadStart(r));\n@@ -356,8 +354,8 @@ export class NavigationTransitions {\n                                      t.rawUrl} was ignored because it is the same as the current Router URL.` :\n                                  '';\n                              this.events.next(new NavigationSkipped(\n-                                 t.id, router.serializeUrl(overallTransitionState.rawUrl),\n-                                 reason, NavigationSkippedCode.IgnoredSameUrlNavigation));\n+                                 t.id, router.serializeUrl(overallTransitionState.rawUrl), reason,\n+                                 NavigationSkippedCode.IgnoredSameUrlNavigation));\n                              router.rawUrlTree = t.rawUrl;\n                              t.resolve(null);\n                              return EMPTY;\n@@ -374,7 +372,7 @@ export class NavigationTransitions {\n                                  switchMap(t => {\n                                    const transition = router.transitions.getValue();\n                                    this.events.next(new NavigationStart(\n-                                       t.id, router.serializeUrl(t.extractedUrl), t.source,\n+                                       t.id, this.urlSerializer.serialize(t.extractedUrl), t.source,\n                                        t.restoredState));\n                                    if (transition !== router.transitions.getValue()) {\n                                      return EMPTY;\n@@ -388,7 +386,7 @@ export class NavigationTransitions {\n                                  // ApplyRedirects\n                                  applyRedirects(\n                                      this.environmentInjector, this.configLoader,\n-                                     router.urlSerializer, router.config),\n+                                     this.urlSerializer, router.config),\n \n                                  // Update the currentNavigation\n                                  // `urlAfterRedirects` is guaranteed to be set after this point\n@@ -403,7 +401,7 @@ export class NavigationTransitions {\n                                  // Recognize\n                                  recognize(\n                                      this.environmentInjector, router.rootComponentType,\n-                                     router.config, router.urlSerializer,\n+                                     router.config, this.urlSerializer,\n                                      router.paramsInheritanceStrategy),\n \n                                  // Update URL if in `eager` update mode\n@@ -420,25 +418,24 @@ export class NavigationTransitions {\n \n                                    // Fire RoutesRecognized\n                                    const routesRecognized = new RoutesRecognized(\n-                                       t.id, router.serializeUrl(t.extractedUrl),\n-                                       router.serializeUrl(t.urlAfterRedirects!),\n+                                       t.id, this.urlSerializer.serialize(t.extractedUrl),\n+                                       this.urlSerializer.serialize(t.urlAfterRedirects!),\n                                        t.targetSnapshot!);\n                                    this.events.next(routesRecognized);\n                                  }));\n                            } else if (\n                                urlTransition &&\n-                               router.urlHandlingStrategy.shouldProcessUrl(\n-                                   router.rawUrlTree)) {\n-                             // When the current URL shouldn't be processed, but the previous one\n-                             // was, we handle this by navigating from the current URL to an empty\n-                             // state so deactivate guards can run.\n+                               router.urlHandlingStrategy.shouldProcessUrl(router.rawUrlTree)) {\n+                             /* When the current URL shouldn't be processed, but the previous one\n+                              * was, we handle this \"error condition\" by navigating to the\n+                              * previously successful URL, but leaving the URL intact.*/\n                              const {id, extractedUrl, source, restoredState, extras} = t;\n                              const navStart = new NavigationStart(\n-                                 id, router.serializeUrl(extractedUrl), source, restoredState);\n+                                 id, this.urlSerializer.serialize(extractedUrl), source,\n+                                 restoredState);\n                              this.events.next(navStart);\n                              const targetSnapshot =\n-                                 createEmptyState(extractedUrl, router.rootComponentType)\n-                                     .snapshot;\n+                                 createEmptyState(extractedUrl, router.rootComponentType).snapshot;\n \n                              overallTransitionState = {\n                                ...t,\n@@ -460,8 +457,7 @@ export class NavigationTransitions {\n                                          t.rawUrl} should be processed.` :\n                                  '';\n                              this.events.next(new NavigationSkipped(\n-                                 t.id,\n-                                 router.serializeUrl(overallTransitionState.extractedUrl),\n+                                 t.id, router.serializeUrl(overallTransitionState.extractedUrl),\n                                  reason, NavigationSkippedCode.IgnoredByUrlHandlingStrategy));\n                              router.rawUrlTree = t.rawUrl;\n                              t.resolve(null);\n@@ -472,8 +468,9 @@ export class NavigationTransitions {\n                          // --- GUARDS ---\n                          tap(t => {\n                            const guardsStart = new GuardsCheckStart(\n-                               t.id, router.serializeUrl(t.extractedUrl),\n-                               router.serializeUrl(t.urlAfterRedirects!), t.targetSnapshot!);\n+                               t.id, this.urlSerializer.serialize(t.extractedUrl),\n+                               this.urlSerializer.serialize(t.urlAfterRedirects!),\n+                               t.targetSnapshot!);\n                            this.events.next(guardsStart);\n                          }),\n \n@@ -481,7 +478,7 @@ export class NavigationTransitions {\n                            overallTransitionState = {\n                              ...t,\n                              guards: getAllRouteGuards(\n-                                 t.targetSnapshot!, t.currentSnapshot, router.rootContexts)\n+                                 t.targetSnapshot!, t.currentSnapshot, this.rootContexts)\n                            };\n                            return overallTransitionState;\n                          }),\n@@ -491,13 +488,13 @@ export class NavigationTransitions {\n                          tap(t => {\n                            overallTransitionState.guardsResult = t.guardsResult;\n                            if (isUrlTree(t.guardsResult)) {\n-                             throw redirectingNavigationError(router.urlSerializer, t.guardsResult);\n+                             throw redirectingNavigationError(this.urlSerializer, t.guardsResult);\n                            }\n \n                            const guardsEnd = new GuardsCheckEnd(\n-                               t.id, router.serializeUrl(t.extractedUrl),\n-                               router.serializeUrl(t.urlAfterRedirects!), t.targetSnapshot!,\n-                               !!t.guardsResult);\n+                               t.id, this.urlSerializer.serialize(t.extractedUrl),\n+                               this.urlSerializer.serialize(t.urlAfterRedirects!),\n+                               t.targetSnapshot!, !!t.guardsResult);\n                            this.events.next(guardsEnd);\n                          }),\n \n@@ -517,8 +514,8 @@ export class NavigationTransitions {\n                              return of(t).pipe(\n                                  tap(t => {\n                                    const resolveStart = new ResolveStart(\n-                                       t.id, router.serializeUrl(t.extractedUrl),\n-                                       router.serializeUrl(t.urlAfterRedirects!),\n+                                       t.id, this.urlSerializer.serialize(t.extractedUrl),\n+                                       this.urlSerializer.serialize(t.urlAfterRedirects!),\n                                        t.targetSnapshot!);\n                                    this.events.next(resolveStart);\n                                  }),\n@@ -547,8 +544,8 @@ export class NavigationTransitions {\n                                  }),\n                                  tap(t => {\n                                    const resolveEnd = new ResolveEnd(\n-                                       t.id, router.serializeUrl(t.extractedUrl),\n-                                       router.serializeUrl(t.urlAfterRedirects!),\n+                                       t.id, this.urlSerializer.serialize(t.extractedUrl),\n+                                       this.urlSerializer.serialize(t.urlAfterRedirects!),\n                                        t.targetSnapshot!);\n                                    this.events.next(resolveEnd);\n                                  }));\n@@ -611,7 +608,7 @@ export class NavigationTransitions {\n                          }),\n \n                          activateRoutes(\n-                             router.rootContexts, router.routeReuseStrategy,\n+                             this.rootContexts, router.routeReuseStrategy,\n                              (evt: Event) => this.events.next(evt)),\n \n                          tap({\n@@ -620,8 +617,8 @@ export class NavigationTransitions {\n                              this.lastSuccessfulNavigation = this.currentNavigation;\n                              router.navigated = true;\n                              this.events.next(new NavigationEnd(\n-                                 t.id, router.serializeUrl(t.extractedUrl),\n-                                 router.serializeUrl(router.currentUrlTree)));\n+                                 t.id, this.urlSerializer.serialize(t.extractedUrl),\n+                                 this.urlSerializer.serialize(router.currentUrlTree)));\n                              router.titleStrategy?.updateTitle(t.targetRouterState!.snapshot);\n                              t.resolve(true);\n                            },\n@@ -670,7 +667,7 @@ export class NavigationTransitions {\n                              }\n                              const navCancel = new NavigationCancel(\n                                  overallTransitionState.id,\n-                                 router.serializeUrl(overallTransitionState.extractedUrl),\n+                                 this.urlSerializer.serialize(overallTransitionState.extractedUrl),\n                                  e.message, e.cancellationCode);\n                              this.events.next(navCancel);\n \n@@ -705,8 +702,8 @@ export class NavigationTransitions {\n                              router.restoreHistory(overallTransitionState, true);\n                              const navError = new NavigationError(\n                                  overallTransitionState.id,\n-                                 router.serializeUrl(overallTransitionState.extractedUrl), e,\n-                                 overallTransitionState.targetSnapshot ?? undefined);\n+                                 this.urlSerializer.serialize(overallTransitionState.extractedUrl),\n+                                 e, overallTransitionState.targetSnapshot ?? undefined);\n                              this.events.next(navError);\n                              try {\n                                overallTransitionState.resolve(router.errorHandler(e));\n@@ -723,7 +720,8 @@ export class NavigationTransitions {\n   private cancelNavigationTransition(\n       t: NavigationTransition, reason: string, code: NavigationCancellationCode,\n       router: InternalRouterInterface) {\n-    const navCancel = new NavigationCancel(t.id, router.serializeUrl(t.extractedUrl), reason, code);\n+    const navCancel =\n+        new NavigationCancel(t.id, this.urlSerializer.serialize(t.extractedUrl), reason, code);\n     this.events.next(navCancel);\n     t.resolve(false);\n   }\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -354,12 +354,9 @@ export class Router {\n   constructor(\n       /** @internal */\n       public rootComponentType: Type<any>|null,\n-      /** @internal */\n-      readonly urlSerializer: UrlSerializer,\n-      /** @internal */\n-      readonly rootContexts: ChildrenOutletContexts,\n-      /** @internal */\n-      readonly location: Location,\n+      private readonly urlSerializer: UrlSerializer,\n+      private readonly rootContexts: ChildrenOutletContexts,\n+      private readonly location: Location,\n       injector: Injector,\n       compiler: Compiler,\n       public config: Routes,\n\n---\n file path A: packages/router/src/navigation_transition.ts | file path B: packages/router/src/navigation_transition.ts\n\n@@ -6,7 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Location} from '@angular/common';\n import {EnvironmentInjector, inject, Injectable, Type} from '@angular/core';\n import {BehaviorSubject, combineLatest, EMPTY, Observable, of, Subject} from 'rxjs';\n import {catchError, defaultIfEmpty, filter, finalize, map, switchMap, take, tap} from 'rxjs/operators';\n@@ -281,9 +280,6 @@ interface InternalRouterInterface {\n   serializeUrl(url: UrlTree): string;\n   config: Routes;\n   rootComponentType: Type<any>|null;\n-  urlSerializer: UrlSerializer;\n-  rootContexts: ChildrenOutletContexts;\n-  location: Location;\n   setBrowserUrl(url: UrlTree, t: NavigationTransition): void;\n   restoreHistory(t: NavigationTransition, restoringFromCaughtError?: boolean): void;\n   scheduleNavigation(\n@@ -299,6 +295,8 @@ export class NavigationTransitions {\n   readonly events = new Subject<Event>();\n   private readonly configLoader = inject(RouterConfigLoader);\n   private readonly environmentInjector = inject(EnvironmentInjector);\n+  private readonly urlSerializer = inject(UrlSerializer);\n+  private readonly rootContexts = inject(ChildrenOutletContexts);\n \n   constructor() {\n     const onLoadStart = (r: Route) => this.events.next(new RouteConfigLoadStart(r));\n@@ -374,7 +372,7 @@ export class NavigationTransitions {\n                                  switchMap(t => {\n                                    const transition = router.transitions.getValue();\n                                    this.events.next(new NavigationStart(\n-                                       t.id, router.serializeUrl(t.extractedUrl), t.source,\n+                                       t.id, this.urlSerializer.serialize(t.extractedUrl), t.source,\n                                        t.restoredState));\n                                    if (transition !== router.transitions.getValue()) {\n                                      return EMPTY;\n@@ -388,7 +386,7 @@ export class NavigationTransitions {\n                                  // ApplyRedirects\n                                  applyRedirects(\n                                      this.environmentInjector, this.configLoader,\n-                                     router.urlSerializer, router.config),\n+                                     this.urlSerializer, router.config),\n \n                                  // Update the currentNavigation\n                                  // `urlAfterRedirects` is guaranteed to be set after this point\n@@ -403,7 +401,7 @@ export class NavigationTransitions {\n                                  // Recognize\n                                  recognize(\n                                      this.environmentInjector, router.rootComponentType,\n-                                     router.config, router.urlSerializer,\n+                                     router.config, this.urlSerializer,\n                                      router.paramsInheritanceStrategy),\n \n                                  // Update URL if in `eager` update mode\n@@ -420,8 +418,8 @@ export class NavigationTransitions {\n \n                                    // Fire RoutesRecognized\n                                    const routesRecognized = new RoutesRecognized(\n-                                       t.id, router.serializeUrl(t.extractedUrl),\n-                                       router.serializeUrl(t.urlAfterRedirects!),\n+                                       t.id, this.urlSerializer.serialize(t.extractedUrl),\n+                                       this.urlSerializer.serialize(t.urlAfterRedirects!),\n                                        t.targetSnapshot!);\n                                    this.events.next(routesRecognized);\n                                  }));\n@@ -429,16 +427,17 @@ export class NavigationTransitions {\n                                urlTransition &&\n                                router.urlHandlingStrategy.shouldProcessUrl(\n                                    router.rawUrlTree)) {\n-                             // When the current URL shouldn't be processed, but the previous one\n-                             // was, we handle this by navigating from the current URL to an empty\n-                             // state so deactivate guards can run.\n-                             const {id, extractedUrl, source, restoredState, extras} = t;\n-                             const navStart = new NavigationStart(\n-                                 id, router.serializeUrl(extractedUrl), source, restoredState);\n-                             this.events.next(navStart);\n-                             const targetSnapshot =\n-                                 createEmptyState(extractedUrl, router.rootComponentType)\n-                                     .snapshot;\n+                             /* When the current URL shouldn't be processed, but the previous one\n+                              * was, we handle this \"error condition\" by navigating to the\n+                              * previously successful URL, but leaving the URL intact.*/\n+                               const {id, extractedUrl, source, restoredState, extras} = t;\n+                               const navStart = new NavigationStart(\n+                                   id, this.urlSerializer.serialize(extractedUrl), source,\n+                                   restoredState);\n+                               this.events.next(navStart);\n+                               const targetSnapshot =\n+                                   createEmptyState(extractedUrl, router.rootComponentType)\n+                                       .snapshot;\n \n                              overallTransitionState = {\n                                ...t,\n@@ -472,8 +471,9 @@ export class NavigationTransitions {\n                          // --- GUARDS ---\n                          tap(t => {\n                            const guardsStart = new GuardsCheckStart(\n-                               t.id, router.serializeUrl(t.extractedUrl),\n-                               router.serializeUrl(t.urlAfterRedirects!), t.targetSnapshot!);\n+                               t.id, this.urlSerializer.serialize(t.extractedUrl),\n+                               this.urlSerializer.serialize(t.urlAfterRedirects!),\n+                               t.targetSnapshot!);\n                            this.events.next(guardsStart);\n                          }),\n \n@@ -481,7 +481,7 @@ export class NavigationTransitions {\n                            overallTransitionState = {\n                              ...t,\n                              guards: getAllRouteGuards(\n-                                 t.targetSnapshot!, t.currentSnapshot, router.rootContexts)\n+                                 t.targetSnapshot!, t.currentSnapshot, this.rootContexts)\n                            };\n                            return overallTransitionState;\n                          }),\n@@ -491,13 +491,13 @@ export class NavigationTransitions {\n                          tap(t => {\n                            overallTransitionState.guardsResult = t.guardsResult;\n                            if (isUrlTree(t.guardsResult)) {\n-                             throw redirectingNavigationError(router.urlSerializer, t.guardsResult);\n+                             throw redirectingNavigationError(this.urlSerializer, t.guardsResult);\n                            }\n \n                            const guardsEnd = new GuardsCheckEnd(\n-                               t.id, router.serializeUrl(t.extractedUrl),\n-                               router.serializeUrl(t.urlAfterRedirects!), t.targetSnapshot!,\n-                               !!t.guardsResult);\n+                               t.id, this.urlSerializer.serialize(t.extractedUrl),\n+                               this.urlSerializer.serialize(t.urlAfterRedirects!),\n+                               t.targetSnapshot!, !!t.guardsResult);\n                            this.events.next(guardsEnd);\n                          }),\n \n@@ -517,8 +517,8 @@ export class NavigationTransitions {\n                              return of(t).pipe(\n                                  tap(t => {\n                                    const resolveStart = new ResolveStart(\n-                                       t.id, router.serializeUrl(t.extractedUrl),\n-                                       router.serializeUrl(t.urlAfterRedirects!),\n+                                       t.id, this.urlSerializer.serialize(t.extractedUrl),\n+                                       this.urlSerializer.serialize(t.urlAfterRedirects!),\n                                        t.targetSnapshot!);\n                                    this.events.next(resolveStart);\n                                  }),\n@@ -547,8 +547,8 @@ export class NavigationTransitions {\n                                  }),\n                                  tap(t => {\n                                    const resolveEnd = new ResolveEnd(\n-                                       t.id, router.serializeUrl(t.extractedUrl),\n-                                       router.serializeUrl(t.urlAfterRedirects!),\n+                                       t.id, this.urlSerializer.serialize(t.extractedUrl),\n+                                       this.urlSerializer.serialize(t.urlAfterRedirects!),\n                                        t.targetSnapshot!);\n                                    this.events.next(resolveEnd);\n                                  }));\n@@ -611,7 +611,7 @@ export class NavigationTransitions {\n                          }),\n \n                          activateRoutes(\n-                             router.rootContexts, router.routeReuseStrategy,\n+                             this.rootContexts, router.routeReuseStrategy,\n                              (evt: Event) => this.events.next(evt)),\n \n                          tap({\n@@ -620,8 +620,8 @@ export class NavigationTransitions {\n                              this.lastSuccessfulNavigation = this.currentNavigation;\n                              router.navigated = true;\n                              this.events.next(new NavigationEnd(\n-                                 t.id, router.serializeUrl(t.extractedUrl),\n-                                 router.serializeUrl(router.currentUrlTree)));\n+                                 t.id, this.urlSerializer.serialize(t.extractedUrl),\n+                                 this.urlSerializer.serialize(router.currentUrlTree)));\n                              router.titleStrategy?.updateTitle(t.targetRouterState!.snapshot);\n                              t.resolve(true);\n                            },\n@@ -670,7 +670,7 @@ export class NavigationTransitions {\n                              }\n                              const navCancel = new NavigationCancel(\n                                  overallTransitionState.id,\n-                                 router.serializeUrl(overallTransitionState.extractedUrl),\n+                                 this.urlSerializer.serialize(overallTransitionState.extractedUrl),\n                                  e.message, e.cancellationCode);\n                              this.events.next(navCancel);\n \n@@ -705,8 +705,8 @@ export class NavigationTransitions {\n                              router.restoreHistory(overallTransitionState, true);\n                              const navError = new NavigationError(\n                                  overallTransitionState.id,\n-                                 router.serializeUrl(overallTransitionState.extractedUrl), e,\n-                                 overallTransitionState.targetSnapshot ?? undefined);\n+                                 this.urlSerializer.serialize(overallTransitionState.extractedUrl),\n+                                 e, overallTransitionState.targetSnapshot ?? undefined);\n                              this.events.next(navError);\n                              try {\n                                overallTransitionState.resolve(router.errorHandler(e));\n@@ -723,7 +723,8 @@ export class NavigationTransitions {\n   private cancelNavigationTransition(\n       t: NavigationTransition, reason: string, code: NavigationCancellationCode,\n       router: InternalRouterInterface) {\n-    const navCancel = new NavigationCancel(t.id, router.serializeUrl(t.extractedUrl), reason, code);\n+    const navCancel =\n+        new NavigationCancel(t.id, this.urlSerializer.serialize(t.extractedUrl), reason, code);\n     this.events.next(navCancel);\n     t.resolve(false);\n   }\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -354,12 +354,9 @@ export class Router {\n   constructor(\n       /** @internal */\n       public rootComponentType: Type<any>|null,\n-      /** @internal */\n-      readonly urlSerializer: UrlSerializer,\n-      /** @internal */\n-      readonly rootContexts: ChildrenOutletContexts,\n-      /** @internal */\n-      readonly location: Location,\n+      private readonly urlSerializer: UrlSerializer,\n+      private readonly rootContexts: ChildrenOutletContexts,\n+      private readonly location: Location,\n       injector: Injector,\n       compiler: Compiler,\n       public config: Routes,\n\n\n###\n\n", "completion": "refactor(router): directly inject internal properties from DI (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/navigation_transition.ts | file path B: packages/router/src/navigation_transition.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {Location} from '@angular/common';\n-import {inject, Injectable, NgModuleRef, Type} from '@angular/core';\n+import {EnvironmentInjector, inject, Injectable, Type} from '@angular/core';\n import {BehaviorSubject, combineLatest, EMPTY, Observable, of, Subject} from 'rxjs';\n import {catchError, defaultIfEmpty, filter, finalize, map, switchMap, take, tap} from 'rxjs/operators';\n \n@@ -268,7 +268,6 @@ interface InternalRouterInterface {\n   rawUrlTree: UrlTree;\n   transitions: BehaviorSubject<NavigationTransition>;\n   navigationId: number;\n-  ngModule: NgModuleRef<any>;\n   readonly routerState: RouterState;\n   errorHandler: ErrorHandler;\n   titleStrategy?: TitleStrategy;\n@@ -299,6 +298,7 @@ export class NavigationTransitions {\n   lastSuccessfulNavigation: Navigation|null = null;\n   readonly events = new Subject<Event>();\n   private readonly configLoader = inject(RouterConfigLoader);\n+  private readonly environmentInjector = inject(EnvironmentInjector);\n \n   constructor() {\n     const onLoadStart = (r: Route) => this.events.next(new RouteConfigLoadStart(r));\n@@ -387,7 +387,7 @@ export class NavigationTransitions {\n \n                                  // ApplyRedirects\n                                  applyRedirects(\n-                                     router.ngModule.injector, this.configLoader,\n+                                     this.environmentInjector, this.configLoader,\n                                      router.urlSerializer, router.config),\n \n                                  // Update the currentNavigation\n@@ -402,7 +402,7 @@ export class NavigationTransitions {\n \n                                  // Recognize\n                                  recognize(\n-                                     router.ngModule.injector, router.rootComponentType,\n+                                     this.environmentInjector, router.rootComponentType,\n                                      router.config, router.urlSerializer,\n                                      router.paramsInheritanceStrategy),\n \n@@ -487,7 +487,7 @@ export class NavigationTransitions {\n                          }),\n \n                          checkGuards(\n-                             router.ngModule.injector, (evt: Event) => this.events.next(evt)),\n+                             this.environmentInjector, (evt: Event) => this.events.next(evt)),\n                          tap(t => {\n                            overallTransitionState.guardsResult = t.guardsResult;\n                            if (isUrlTree(t.guardsResult)) {\n@@ -527,7 +527,7 @@ export class NavigationTransitions {\n                                    return of(t).pipe(\n                                        resolveData(\n                                            router.paramsInheritanceStrategy,\n-                                           router.ngModule.injector),\n+                                           this.environmentInjector),\n                                        tap({\n                                          next: () => dataResolved = true,\n                                          complete: () => {\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {Location} from '@angular/common';\n-import {Compiler, inject, Injectable, Injector, NgModuleRef, NgZone, Type, \u0275Console as Console, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {Compiler, inject, Injectable, Injector, NgZone, Type, \u0275Console as Console, \u0275RuntimeError as RuntimeError} from '@angular/core';\n import {BehaviorSubject, Observable, of, SubscriptionLike} from 'rxjs';\n \n import {createUrlTree} from './create_url_tree';\n@@ -201,8 +201,6 @@ export class Router {\n   private get browserPageId(): number|undefined {\n     return (this.location.getState() as RestoredState | null)?.\u0275routerPageId;\n   }\n-  /** @internal */\n-  ngModule: NgModuleRef<any>;\n   private console: Console;\n   private isNgZoneEnabled: boolean = false;\n \n@@ -366,7 +364,6 @@ export class Router {\n       compiler: Compiler,\n       public config: Routes,\n   ) {\n-    this.ngModule = injector.get(NgModuleRef);\n     this.console = injector.get(Console);\n     const ngZone = injector.get(NgZone);\n     this.isNgZoneEnabled = ngZone instanceof NgZone && NgZone.isInAngularZone();\n\n---\n file path A: packages/router/src/navigation_transition.ts | file path B: packages/router/src/navigation_transition.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {Location} from '@angular/common';\n-import {inject, Injectable, NgModuleRef, Type} from '@angular/core';\n+import {EnvironmentInjector, inject, Injectable, Type} from '@angular/core';\n import {BehaviorSubject, combineLatest, EMPTY, Observable, of, Subject} from 'rxjs';\n import {catchError, defaultIfEmpty, filter, finalize, map, switchMap, take, tap} from 'rxjs/operators';\n \n@@ -268,7 +268,6 @@ interface InternalRouterInterface {\n   rawUrlTree: UrlTree;\n   transitions: BehaviorSubject<NavigationTransition>;\n   navigationId: number;\n-  ngModule: NgModuleRef<any>;\n   readonly routerState: RouterState;\n   errorHandler: ErrorHandler;\n   titleStrategy?: TitleStrategy;\n@@ -299,6 +298,7 @@ export class NavigationTransitions {\n   lastSuccessfulNavigation: Navigation|null = null;\n   readonly events = new Subject<Event>();\n   private readonly configLoader = inject(RouterConfigLoader);\n+  private readonly environmentInjector = inject(EnvironmentInjector);\n \n   constructor() {\n     const onLoadStart = (r: Route) => this.events.next(new RouteConfigLoadStart(r));\n@@ -387,7 +387,7 @@ export class NavigationTransitions {\n \n                                  // ApplyRedirects\n                                  applyRedirects(\n-                                     router.ngModule.injector, this.configLoader,\n+                                     this.environmentInjector, this.configLoader,\n                                      router.urlSerializer, router.config),\n \n                                  // Update the currentNavigation\n@@ -402,7 +402,7 @@ export class NavigationTransitions {\n \n                                  // Recognize\n                                  recognize(\n-                                     router.ngModule.injector, router.rootComponentType,\n+                                     this.environmentInjector, router.rootComponentType,\n                                      router.config, router.urlSerializer,\n                                      router.paramsInheritanceStrategy),\n \n@@ -487,7 +487,7 @@ export class NavigationTransitions {\n                          }),\n \n                          checkGuards(\n-                             router.ngModule.injector, (evt: Event) => this.events.next(evt)),\n+                             this.environmentInjector, (evt: Event) => this.events.next(evt)),\n                          tap(t => {\n                            overallTransitionState.guardsResult = t.guardsResult;\n                            if (isUrlTree(t.guardsResult)) {\n@@ -527,7 +527,7 @@ export class NavigationTransitions {\n                                    return of(t).pipe(\n                                        resolveData(\n                                            router.paramsInheritanceStrategy,\n-                                           router.ngModule.injector),\n+                                           this.environmentInjector),\n                                        tap({\n                                          next: () => dataResolved = true,\n                                          complete: () => {\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {Location} from '@angular/common';\n-import {Compiler, inject, Injectable, Injector, NgModuleRef, NgZone, Type, \u0275Console as Console, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {Compiler, inject, Injectable, Injector, NgZone, Type, \u0275Console as Console, \u0275RuntimeError as RuntimeError} from '@angular/core';\n import {BehaviorSubject, Observable, of, SubscriptionLike} from 'rxjs';\n \n import {createUrlTree} from './create_url_tree';\n@@ -201,8 +201,6 @@ export class Router {\n   private get browserPageId(): number|undefined {\n     return (this.location.getState() as RestoredState | null)?.\u0275routerPageId;\n   }\n-  /** @internal */\n-  ngModule: NgModuleRef<any>;\n   private console: Console;\n   private isNgZoneEnabled: boolean = false;\n \n@@ -366,7 +364,6 @@ export class Router {\n       compiler: Compiler,\n       public config: Routes,\n   ) {\n-    this.ngModule = injector.get(NgModuleRef);\n     this.console = injector.get(Console);\n     const ngZone = injector.get(NgZone);\n     this.isNgZoneEnabled = ngZone instanceof NgZone && NgZone.isInAngularZone();\n\n\n###\n\n", "completion": "refactor(router): Get EnvironmentInjector directly in transition handler (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/navigation_transition.ts | file path B: packages/router/src/navigation_transition.ts\n\n@@ -7,13 +7,13 @@\n  */\n \n import {Location} from '@angular/common';\n-import {Injectable, NgModuleRef, Type} from '@angular/core';\n+import {inject, Injectable, NgModuleRef, Type} from '@angular/core';\n import {BehaviorSubject, combineLatest, EMPTY, Observable, of, Subject} from 'rxjs';\n import {catchError, defaultIfEmpty, filter, finalize, map, switchMap, take, tap} from 'rxjs/operators';\n \n import {createRouterState} from './create_router_state';\n-import {Event, GuardsCheckEnd, GuardsCheckStart, NavigationCancel, NavigationCancellationCode, NavigationEnd, NavigationError, NavigationSkipped, NavigationSkippedCode, NavigationStart, NavigationTrigger, ResolveEnd, ResolveStart, RoutesRecognized} from './events';\n-import {NavigationBehaviorOptions, QueryParamsHandling, Routes} from './models';\n+import {Event, GuardsCheckEnd, GuardsCheckStart, NavigationCancel, NavigationCancellationCode, NavigationEnd, NavigationError, NavigationSkipped, NavigationSkippedCode, NavigationStart, NavigationTrigger, ResolveEnd, ResolveStart, RouteConfigLoadEnd, RouteConfigLoadStart, RoutesRecognized} from './events';\n+import {NavigationBehaviorOptions, QueryParamsHandling, Route, Routes} from './models';\n import {isNavigationCancelingError, isRedirectingNavigationCancelingError, redirectingNavigationError} from './navigation_canceling_error';\n import {activateRoutes} from './operators/activate_routes';\n import {applyRedirects} from './operators/apply_redirects';\n@@ -268,7 +268,6 @@ interface InternalRouterInterface {\n   rawUrlTree: UrlTree;\n   transitions: BehaviorSubject<NavigationTransition>;\n   navigationId: number;\n-  configLoader: RouterConfigLoader;\n   ngModule: NgModuleRef<any>;\n   readonly routerState: RouterState;\n   errorHandler: ErrorHandler;\n@@ -299,6 +298,14 @@ export class NavigationTransitions {\n   currentNavigation: Navigation|null = null;\n   lastSuccessfulNavigation: Navigation|null = null;\n   readonly events = new Subject<Event>();\n+  private readonly configLoader = inject(RouterConfigLoader);\n+\n+  constructor() {\n+    const onLoadStart = (r: Route) => this.events.next(new RouteConfigLoadStart(r));\n+    const onLoadEnd = (r: Route) => this.events.next(new RouteConfigLoadEnd(r));\n+    this.configLoader.onLoadEndListener = onLoadEnd;\n+    this.configLoader.onLoadStartListener = onLoadStart;\n+  }\n \n   setupNavigations(transitions: Observable<NavigationTransition>, router: InternalRouterInterface):\n       Observable<NavigationTransition> {\n@@ -380,7 +387,7 @@ export class NavigationTransitions {\n \n                                  // ApplyRedirects\n                                  applyRedirects(\n-                                     router.ngModule.injector, router.configLoader,\n+                                     router.ngModule.injector, this.configLoader,\n                                      router.urlSerializer, router.config),\n \n                                  // Update the currentNavigation\n@@ -556,7 +563,7 @@ export class NavigationTransitions {\n                                  const loaders: Array<Observable<void>> = [];\n                                  if (route.routeConfig?.loadComponent &&\n                                      !route.routeConfig._loadedComponent) {\n-                                   loaders.push(router.configLoader.loadComponent(route.routeConfig)\n+                                   loaders.push(this.configLoader.loadComponent(route.routeConfig)\n                                                     .pipe(\n                                                         tap(loadedComponent => {\n                                                           route.component = loadedComponent;\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -12,13 +12,13 @@ import {BehaviorSubject, Observable, of, SubscriptionLike} from 'rxjs';\n \n import {createUrlTree} from './create_url_tree';\n import {RuntimeErrorCode} from './errors';\n-import {Event, NavigationCancel, NavigationCancellationCode, NavigationTrigger, RouteConfigLoadEnd, RouteConfigLoadStart} from './events';\n-import {NavigationBehaviorOptions, OnSameUrlNavigation, Route, Routes} from './models';\n+import {Event, NavigationTrigger} from './events';\n+import {NavigationBehaviorOptions, OnSameUrlNavigation, Routes} from './models';\n import {Navigation, NavigationExtras, NavigationTransition, NavigationTransitions, RestoredState, UrlCreationOptions} from './navigation_transition';\n import {TitleStrategy} from './page_title_strategy';\n import {RouteReuseStrategy} from './route_reuse_strategy';\n import {ErrorHandler, ExtraOptions, ROUTER_CONFIGURATION} from './router_config';\n-import {RouterConfigLoader, ROUTES} from './router_config_loader';\n+import {ROUTES} from './router_config_loader';\n import {ChildrenOutletContexts} from './router_outlet_context';\n import {createEmptyState, RouterState} from './router_state';\n import {Params} from './shared';\n@@ -202,8 +202,6 @@ export class Router {\n     return (this.location.getState() as RestoredState | null)?.\u0275routerPageId;\n   }\n   /** @internal */\n-  configLoader: RouterConfigLoader;\n-  /** @internal */\n   ngModule: NgModuleRef<any>;\n   private console: Console;\n   private isNgZoneEnabled: boolean = false;\n@@ -368,12 +366,6 @@ export class Router {\n       compiler: Compiler,\n       public config: Routes,\n   ) {\n-    const onLoadStart = (r: Route) => this.triggerEvent(new RouteConfigLoadStart(r));\n-    const onLoadEnd = (r: Route) => this.triggerEvent(new RouteConfigLoadEnd(r));\n-    this.configLoader = injector.get(RouterConfigLoader);\n-    this.configLoader.onLoadEndListener = onLoadEnd;\n-    this.configLoader.onLoadStartListener = onLoadStart;\n-\n     this.ngModule = injector.get(NgModuleRef);\n     this.console = injector.get(Console);\n     const ngZone = injector.get(NgZone);\n@@ -496,10 +488,6 @@ export class Router {\n     return this.navigationTransitions.currentNavigation;\n   }\n \n-  private triggerEvent(event: Event): void {\n-    this.navigationTransitions.events.next(event);\n-  }\n-\n   /**\n    * Resets the route configuration used for navigation and generating links.\n    *\n\n---\n file path A: packages/router/src/navigation_transition.ts | file path B: packages/router/src/navigation_transition.ts\n\n@@ -7,13 +7,13 @@\n  */\n \n import {Location} from '@angular/common';\n-import {Injectable, NgModuleRef, Type} from '@angular/core';\n+import {inject, Injectable, NgModuleRef, Type} from '@angular/core';\n import {BehaviorSubject, combineLatest, EMPTY, Observable, of, Subject} from 'rxjs';\n import {catchError, defaultIfEmpty, filter, finalize, map, switchMap, take, tap} from 'rxjs/operators';\n \n import {createRouterState} from './create_router_state';\n-import {Event, GuardsCheckEnd, GuardsCheckStart, NavigationCancel, NavigationCancellationCode, NavigationEnd, NavigationError, NavigationSkipped, NavigationSkippedCode, NavigationStart, NavigationTrigger, ResolveEnd, ResolveStart, RoutesRecognized} from './events';\n-import {NavigationBehaviorOptions, QueryParamsHandling, Routes} from './models';\n+import {Event, GuardsCheckEnd, GuardsCheckStart, NavigationCancel, NavigationCancellationCode, NavigationEnd, NavigationError, NavigationSkipped, NavigationSkippedCode, NavigationStart, NavigationTrigger, ResolveEnd, ResolveStart, RouteConfigLoadEnd, RouteConfigLoadStart, RoutesRecognized} from './events';\n+import {NavigationBehaviorOptions, QueryParamsHandling, Route, Routes} from './models';\n import {isNavigationCancelingError, isRedirectingNavigationCancelingError, redirectingNavigationError} from './navigation_canceling_error';\n import {activateRoutes} from './operators/activate_routes';\n import {applyRedirects} from './operators/apply_redirects';\n@@ -268,7 +268,6 @@ interface InternalRouterInterface {\n   rawUrlTree: UrlTree;\n   transitions: BehaviorSubject<NavigationTransition>;\n   navigationId: number;\n-  configLoader: RouterConfigLoader;\n   ngModule: NgModuleRef<any>;\n   readonly routerState: RouterState;\n   errorHandler: ErrorHandler;\n@@ -299,6 +298,14 @@ export class NavigationTransitions {\n   currentNavigation: Navigation|null = null;\n   lastSuccessfulNavigation: Navigation|null = null;\n   readonly events = new Subject<Event>();\n+  private readonly configLoader = inject(RouterConfigLoader);\n+\n+  constructor() {\n+    const onLoadStart = (r: Route) => this.events.next(new RouteConfigLoadStart(r));\n+    const onLoadEnd = (r: Route) => this.events.next(new RouteConfigLoadEnd(r));\n+    this.configLoader.onLoadEndListener = onLoadEnd;\n+    this.configLoader.onLoadStartListener = onLoadStart;\n+  }\n \n   setupNavigations(transitions: Observable<NavigationTransition>, router: InternalRouterInterface):\n       Observable<NavigationTransition> {\n@@ -380,7 +387,7 @@ export class NavigationTransitions {\n \n                                  // ApplyRedirects\n                                  applyRedirects(\n-                                     router.ngModule.injector, router.configLoader,\n+                                     router.ngModule.injector, this.configLoader,\n                                      router.urlSerializer, router.config),\n \n                                  // Update the currentNavigation\n@@ -556,7 +563,7 @@ export class NavigationTransitions {\n                                  const loaders: Array<Observable<void>> = [];\n                                  if (route.routeConfig?.loadComponent &&\n                                      !route.routeConfig._loadedComponent) {\n-                                   loaders.push(router.configLoader.loadComponent(route.routeConfig)\n+                                   loaders.push(this.configLoader.loadComponent(route.routeConfig)\n                                                     .pipe(\n                                                         tap(loadedComponent => {\n                                                           route.component = loadedComponent;\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -12,13 +12,13 @@ import {BehaviorSubject, Observable, of, SubscriptionLike} from 'rxjs';\n \n import {createUrlTree} from './create_url_tree';\n import {RuntimeErrorCode} from './errors';\n-import {Event, NavigationCancel, NavigationCancellationCode, NavigationTrigger, RouteConfigLoadEnd, RouteConfigLoadStart} from './events';\n-import {NavigationBehaviorOptions, OnSameUrlNavigation, Route, Routes} from './models';\n+import {Event, NavigationTrigger} from './events';\n+import {NavigationBehaviorOptions, OnSameUrlNavigation, Routes} from './models';\n import {Navigation, NavigationExtras, NavigationTransition, NavigationTransitions, RestoredState, UrlCreationOptions} from './navigation_transition';\n import {TitleStrategy} from './page_title_strategy';\n import {RouteReuseStrategy} from './route_reuse_strategy';\n import {ErrorHandler, ExtraOptions, ROUTER_CONFIGURATION} from './router_config';\n-import {RouterConfigLoader, ROUTES} from './router_config_loader';\n+import {ROUTES} from './router_config_loader';\n import {ChildrenOutletContexts} from './router_outlet_context';\n import {createEmptyState, RouterState} from './router_state';\n import {Params} from './shared';\n@@ -202,8 +202,6 @@ export class Router {\n     return (this.location.getState() as RestoredState | null)?.\u0275routerPageId;\n   }\n   /** @internal */\n-  configLoader: RouterConfigLoader;\n-  /** @internal */\n   ngModule: NgModuleRef<any>;\n   private console: Console;\n   private isNgZoneEnabled: boolean = false;\n@@ -368,12 +366,6 @@ export class Router {\n       compiler: Compiler,\n       public config: Routes,\n   ) {\n-    const onLoadStart = (r: Route) => this.triggerEvent(new RouteConfigLoadStart(r));\n-    const onLoadEnd = (r: Route) => this.triggerEvent(new RouteConfigLoadEnd(r));\n-    this.configLoader = injector.get(RouterConfigLoader);\n-    this.configLoader.onLoadEndListener = onLoadEnd;\n-    this.configLoader.onLoadStartListener = onLoadStart;\n-\n     this.ngModule = injector.get(NgModuleRef);\n     this.console = injector.get(Console);\n     const ngZone = injector.get(NgZone);\n@@ -496,10 +488,6 @@ export class Router {\n     return this.navigationTransitions.currentNavigation;\n   }\n \n-  private triggerEvent(event: Event): void {\n-    this.navigationTransitions.events.next(event);\n-  }\n-\n   /**\n    * Resets the route configuration used for navigation and generating links.\n    *\n\n\n###\n\n", "completion": "refactor(router): Move configLoader to transition handler (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/navigation_transition.ts | file path B: packages/router/src/navigation_transition.ts\n\n@@ -272,7 +272,6 @@ interface InternalRouterInterface {\n   ngModule: NgModuleRef<any>;\n   readonly routerState: RouterState;\n   errorHandler: ErrorHandler;\n-  malformedUriErrorHandler: (error: URIError, urlSerializer: UrlSerializer, url: string) => UrlTree;\n   navigated: boolean;\n   afterPreactivation: () => Observable<void>;\n   urlHandlingStrategy: UrlHandlingStrategy;\n\n---\n file path A: packages/router/src/navigation_transition.ts | file path B: packages/router/src/navigation_transition.ts\n\n@@ -272,7 +272,6 @@ interface InternalRouterInterface {\n   ngModule: NgModuleRef<any>;\n   readonly routerState: RouterState;\n   errorHandler: ErrorHandler;\n-  malformedUriErrorHandler: (error: URIError, urlSerializer: UrlSerializer, url: string) => UrlTree;\n   navigated: boolean;\n   afterPreactivation: () => Observable<void>;\n   urlHandlingStrategy: UrlHandlingStrategy;\n\n\n###\n\n", "completion": "refactor(router): remove malformedUriHandler from interface passed to transitions (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -106,7 +106,6 @@\n     \"canonical-path\": \"1.0.0\",\n     \"chalk\": \"^4.1.0\",\n     \"cjson\": \"^0.5.0\",\n-    \"codelyzer\": \"^6.0.0\",\n     \"cross-spawn\": \"^7.0.3\",\n     \"css-selector-parser\": \"^1.4.1\",\n     \"dgeni\": \"^0.4.14\",\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -390,11 +390,6 @@\n   dependencies:\n     tslib \"^2.3.0\"\n \n-\"@angular/compiler@9.0.0\":\n-  version \"9.0.0\"\n-  resolved \"https://registry.yarnpkg.com/@angular/compiler/-/compiler-9.0.0.tgz#87e0bef4c369b6cadae07e3a4295778fc93799d5\"\n-  integrity sha512-ctjwuntPfZZT2mNj2NDIVu51t9cvbhl/16epc5xEwyzyDt76pX9UgwvY+MbXrf/C/FWwdtmNtfP698BKI+9leQ==\n-\n \"@angular/core@15.0.1\":\n   version \"15.0.1\"\n   resolved \"https://registry.yarnpkg.com/@angular/core/-/core-15.0.1.tgz#5bc910a0db9579114b878fed22c1e09bebf7a69d\"\n@@ -402,11 +397,6 @@\n   dependencies:\n     tslib \"^2.3.0\"\n \n-\"@angular/core@9.0.0\":\n-  version \"9.0.0\"\n-  resolved \"https://registry.yarnpkg.com/@angular/core/-/core-9.0.0.tgz#227dc53e1ac81824f998c6e76000b7efc522641e\"\n-  integrity sha512-6Pxgsrf0qF9iFFqmIcWmjJGkkCaCm6V5QNnxMy2KloO3SDq6QuMVRbN9RtC8Urmo25LP+eZ6ZgYqFYpdD8Hd9w==\n-\n \"@angular/core@^13.0.0 || ^14.0.0-0\":\n   version \"14.2.12\"\n   resolved \"https://registry.yarnpkg.com/@angular/core/-/core-14.2.12.tgz#118467ec4e8ea082931a84e8cefe722a0e110dc9\"\n@@ -3963,11 +3953,6 @@ anymatch@~3.1.2:\n     normalize-path \"^3.0.0\"\n     picomatch \"^2.0.4\"\n \n-app-root-path@^3.0.0:\n-  version \"3.1.0\"\n-  resolved \"https://registry.yarnpkg.com/app-root-path/-/app-root-path-3.1.0.tgz#5971a2fc12ba170369a7a1ef018c71e6e47c2e86\"\n-  integrity sha512-biN3PwB2gUtjaYy/isrU3aNWI5w+fAfvHkSvCKeQGxhmYpwKFUxudR3Yya+KqVRHBmEDYh+/lTozYCFbmzX4nA==\n-\n \"aproba@^1.0.3 || ^2.0.0\":\n   version \"2.0.0\"\n   resolved \"https://registry.yarnpkg.com/aproba/-/aproba-2.0.0.tgz#52520b8ae5b569215b354efc0caa3fe1e45a8adc\"\n@@ -4034,14 +4019,6 @@ aria-query@5.1.3:\n   dependencies:\n     deep-equal \"^2.0.5\"\n \n-aria-query@^3.0.0:\n-  version \"3.0.0\"\n-  resolved \"https://registry.yarnpkg.com/aria-query/-/aria-query-3.0.0.tgz#65b3fcc1ca1155a8c9ae64d6eee297f15d5133cc\"\n-  integrity sha512-majUxHgLehQTeSA+hClx+DY09OVUqG3GtezWkF1krgLGNdlDu9l9V8DaqNMWbq4Eddc8wsyDA0hpDUtnYxQEXw==\n-  dependencies:\n-    ast-types-flow \"0.0.7\"\n-    commander \"^2.11.0\"\n-\n array-flatten@1.1.1:\n   version \"1.1.1\"\n   resolved \"https://registry.yarnpkg.com/array-flatten/-/array-flatten-1.1.1.tgz#9a5f699051b1e7073328f2a008968b64ea2955d2\"\n@@ -4137,11 +4114,6 @@ assert@^2.0.0:\n     object-is \"^1.0.1\"\n     util \"^0.12.0\"\n \n-ast-types-flow@0.0.7:\n-  version \"0.0.7\"\n-  resolved \"https://registry.yarnpkg.com/ast-types-flow/-/ast-types-flow-0.0.7.tgz#f70b735c6bca1a5c9c22d982c3e39e7feba3bdad\"\n-  integrity sha512-eBvWn1lvIApYMhzQMsu9ciLfkBY499mFZlNqG+/9WR7PVlroQw0vG30cOQQbaKz3sCEc44TAOu2ykzqXSNnwag==\n-\n ast-types@^0.13.2:\n   version \"0.13.4\"\n   resolved \"https://registry.yarnpkg.com/ast-types/-/ast-types-0.13.4.tgz#ee0d77b343263965ecc3fb62da16e7222b2b6782\"\n@@ -4215,13 +4187,6 @@ axios@0.21.4:\n   dependencies:\n     follow-redirects \"^1.14.0\"\n \n-axobject-query@2.0.2:\n-  version \"2.0.2\"\n-  resolved \"https://registry.yarnpkg.com/axobject-query/-/axobject-query-2.0.2.tgz#ea187abe5b9002b377f925d8bf7d1c561adf38f9\"\n-  integrity sha512-MCeek8ZH7hKyO1rWUbKNQBbl4l2eY0ntk7OGi+q0RlafrCnfPxC06WZA+uebCfmYp4mNU9jRBP1AhGyf8+W3ww==\n-  dependencies:\n-    ast-types-flow \"0.0.7\"\n-\n axobject-query@3.1.1:\n   version \"3.1.1\"\n   resolved \"https://registry.yarnpkg.com/axobject-query/-/axobject-query-3.1.1.tgz#3b6e5c6d4e43ca7ba51c5babf99d22a9c68485e1\"\n@@ -5031,26 +4996,6 @@ clonedeep@^2.0.0:\n   resolved \"https://registry.yarnpkg.com/clonedeep/-/clonedeep-2.0.0.tgz#8ceca0777f477bbf31fe8c871aaf63a390bbc272\"\n   integrity sha512-dbSwE7z2tJhF3511dzWqyKOKRA+5uQaILERDdQPxe/Eihm3atnkJRaz/t32fQqfmPBdJiICZD9iLSbaT47UbLw==\n \n-codelyzer@^6.0.0:\n-  version \"6.0.2\"\n-  resolved \"https://registry.yarnpkg.com/codelyzer/-/codelyzer-6.0.2.tgz#25d72eae641e8ff13ffd7d99b27c9c7ad5d7e135\"\n-  integrity sha512-v3+E0Ucu2xWJMOJ2fA/q9pDT/hlxHftHGPUay1/1cTgyPV5JTHFdO9hqo837Sx2s9vKBMTt5gO+lhF95PO6J+g==\n-  dependencies:\n-    \"@angular/compiler\" \"9.0.0\"\n-    \"@angular/core\" \"9.0.0\"\n-    app-root-path \"^3.0.0\"\n-    aria-query \"^3.0.0\"\n-    axobject-query \"2.0.2\"\n-    css-selector-tokenizer \"^0.7.1\"\n-    cssauron \"^1.4.0\"\n-    damerau-levenshtein \"^1.0.4\"\n-    rxjs \"^6.5.3\"\n-    semver-dsl \"^1.0.1\"\n-    source-map \"^0.5.7\"\n-    sprintf-js \"^1.1.2\"\n-    tslib \"^1.10.0\"\n-    zone.js \"~0.10.3\"\n-\n collapse-white-space@^1.0.2:\n   version \"1.0.6\"\n   resolved \"https://registry.yarnpkg.com/collapse-white-space/-/collapse-white-space-1.0.6.tgz#e63629c0016665792060dbbeb79c42239d2c5287\"\n@@ -5141,7 +5086,7 @@ comma-separated-tokens@^1.0.0, comma-separated-tokens@^1.0.1:\n   resolved \"https://registry.yarnpkg.com/comma-separated-tokens/-/comma-separated-tokens-1.0.8.tgz#632b80b6117867a158f1080ad498b2fbe7e3f5ea\"\n   integrity sha512-GHuDRO12Sypu2cV70d1dkA2EUmXHgntrzbpvOB+Qy+49ypNfGgFQIC2fhhXbnyrJRynDCAARsT7Ou0M6hirpfw==\n \n-commander@^2.11.0, commander@^2.12.1, commander@^2.2.0, commander@^2.20.0, commander@^2.20.3:\n+commander@^2.12.1, commander@^2.2.0, commander@^2.20.0, commander@^2.20.3:\n   version \"2.20.3\"\n   resolved \"https://registry.yarnpkg.com/commander/-/commander-2.20.3.tgz#fd485e84c03eb4881c20722ba48035e8531aeb33\"\n   integrity sha512-GpVkmM8vF2vQUkj2LvZmD35JxeJOLCwJ9cUkugyk2nuhbv3+mJvpLYYt+0+USMxE+oj+ey/lJEnhZw75x/OMcQ==\n@@ -5513,26 +5458,11 @@ css-selector-parser@^1.4.1:\n   resolved \"https://registry.yarnpkg.com/css-selector-parser/-/css-selector-parser-1.4.1.tgz#03f9cb8a81c3e5ab2c51684557d5aaf6d2569759\"\n   integrity sha512-HYPSb7y/Z7BNDCOrakL4raGO2zltZkbeXyAd6Tg9obzix6QhzxCotdBl6VT0Dv4vZfJGVz3WL/xaEI9Ly3ul0g==\n \n-css-selector-tokenizer@^0.7.1:\n-  version \"0.7.3\"\n-  resolved \"https://registry.yarnpkg.com/css-selector-tokenizer/-/css-selector-tokenizer-0.7.3.tgz#735f26186e67c749aaf275783405cf0661fae8f1\"\n-  integrity sha512-jWQv3oCEL5kMErj4wRnK/OPoBi0D+P1FR2cDCKYPaMeD2eW3/mttav8HT4hT1CKopiJI/psEULjkClhvJo4Lvg==\n-  dependencies:\n-    cssesc \"^3.0.0\"\n-    fastparse \"^1.1.2\"\n-\n css-what@^6.0.1:\n   version \"6.1.0\"\n   resolved \"https://registry.yarnpkg.com/css-what/-/css-what-6.1.0.tgz#fb5effcf76f1ddea2c81bdfaa4de44e79bac70f4\"\n   integrity sha512-HTUrgRJ7r4dsZKU6GjmpfRK1O76h97Z8MfS1G0FozR+oF2kG6Vfe8JE6zwrkbxigziPHinCJ+gCPjA9EaBDtRw==\n \n-cssauron@^1.4.0:\n-  version \"1.4.0\"\n-  resolved \"https://registry.yarnpkg.com/cssauron/-/cssauron-1.4.0.tgz#a6602dff7e04a8306dc0db9a551e92e8b5662ad8\"\n-  integrity sha512-Ht70DcFBh+/ekjVrYS2PlDMdSQEl3OFNmjK6lcn49HptBgilXf/Zwg4uFh9Xn0pX3Q8YOkSjIFOfK2osvdqpBw==\n-  dependencies:\n-    through X.X.X\n-\n cssdb@^7.0.1:\n   version \"7.1.0\"\n   resolved \"https://registry.yarnpkg.com/cssdb/-/cssdb-7.1.0.tgz#574f97235a83eb753a29f0b1f2cbacac0d628bb8\"\n@@ -5582,11 +5512,6 @@ cycle@1.0.x:\n   resolved \"https://registry.yarnpkg.com/cycle/-/cycle-1.0.3.tgz#21e80b2be8580f98b468f379430662b046c34ad2\"\n   integrity sha512-TVF6svNzeQCOpjCqsy0/CSy8VgObG3wXusJ73xW2GbG5rGx7lC8zxDSURicsXI2UsGdi2L0QNRCi745/wUDvsA==\n \n-damerau-levenshtein@^1.0.4:\n-  version \"1.0.8\"\n-  resolved \"https://registry.yarnpkg.com/damerau-levenshtein/-/damerau-levenshtein-1.0.8.tgz#b43d286ccbd36bc5b2f7ed41caf2d0aba1f8a6e7\"\n-  integrity sha512-sdQSFB7+llfUcQHUQO3+B8ERRj0Oa4w9POWMI/puGtuf7gFywGmkaLCElnudfTiKZV+NvHqL0ifzdrI8Ro7ESA==\n-\n dashdash@^1.12.0:\n   version \"1.14.1\"\n   resolved \"https://registry.yarnpkg.com/dashdash/-/dashdash-1.14.1.tgz#853cfa0f7cbe2fed5de20326b8dd581035f6e2f0\"\n@@ -7143,11 +7068,6 @@ fast-url-parser@^1.1.3:\n   dependencies:\n     punycode \"^1.3.2\"\n \n-fastparse@^1.1.2:\n-  version \"1.1.2\"\n-  resolved \"https://registry.yarnpkg.com/fastparse/-/fastparse-1.1.2.tgz#91728c5a5942eced8531283c79441ee4122c35a9\"\n-  integrity sha512-483XLLxTVIwWK3QTrMGRqUfUpoOs/0hbQrl2oz4J0pAcm3A3bu84wxTFqGqkJzewCLdME38xJLJAxBABfQT8sQ==\n-\n fastq@^1.6.0:\n   version \"1.13.0\"\n   resolved \"https://registry.yarnpkg.com/fastq/-/fastq-1.13.0.tgz#616760f88a7526bdfc596b7cab8c18938c36b98c\"\n@@ -12410,7 +12330,7 @@ rx@4.1.0:\n   resolved \"https://registry.yarnpkg.com/rx/-/rx-4.1.0.tgz#a5f13ff79ef3b740fe30aa803fb09f98805d4782\"\n   integrity sha512-CiaiuN6gapkdl+cZUr67W6I8jquN4lkak3vtIsIWCl4XIPP8ffsoyN6/+PuGXnQy8Cu8W2y9Xxh31Rq4M6wUug==\n \n-rxjs@6.6.7, rxjs@^6.5.3:\n+rxjs@6.6.7:\n   version \"6.6.7\"\n   resolved \"https://registry.yarnpkg.com/rxjs/-/rxjs-6.6.7.tgz#90ac018acabf491bf65044235d5863c4dab804c9\"\n   integrity sha512-hTdwr+7yYNIT5n4AMYp85KA6yw2Va0FLa3Rguvbpa4W3I5xynaBZo41cM3XM+4Q6fRMj3sBYIR1VAmZMXYJvRQ==\n@@ -12624,13 +12544,6 @@ semver-diff@^3.1.1:\n   dependencies:\n     semver \"^6.3.0\"\n \n-semver-dsl@^1.0.1:\n-  version \"1.0.1\"\n-  resolved \"https://registry.yarnpkg.com/semver-dsl/-/semver-dsl-1.0.1.tgz#d3678de5555e8a61f629eed025366ae5f27340a0\"\n-  integrity sha512-e8BOaTo007E3dMuQQTnPdalbKTABKNS7UxoBIDnwOqRa+QwMrCPjynB8zAlPF6xlqUfdLPPLIJ13hJNmhtq8Ng==\n-  dependencies:\n-    semver \"^5.3.0\"\n-\n \"semver@2 || 3 || 4 || 5\", semver@^5.0.1, semver@^5.2.0, semver@^5.3.0, semver@^5.5.0, semver@^5.6.0, semver@^5.7.1:\n   version \"5.7.1\"\n   resolved \"https://registry.yarnpkg.com/semver/-/semver-5.7.1.tgz#a954f931aeba508d307bbf069eff0c01c96116f7\"\n@@ -13014,7 +12927,7 @@ source-map@0.7.4, source-map@^0.7.3, source-map@^0.7.4:\n   resolved \"https://registry.yarnpkg.com/source-map/-/source-map-0.7.4.tgz#a9bbe705c9d8846f4e08ff6765acf0f1b0898656\"\n   integrity sha512-l3BikUxvPOcn5E74dZiq5BGsTb5yEwhaTSzccU6t4sDOH8NWJCstKO5QT2CvtFoK6F0saL7p9xHAqHOlCPJygA==\n \n-source-map@^0.5.6, source-map@^0.5.7:\n+source-map@^0.5.6:\n   version \"0.5.7\"\n   resolved \"https://registry.yarnpkg.com/source-map/-/source-map-0.5.7.tgz#8a039d2d1021d22d1ea14c80d8ea468ba2ef3fcc\"\n   integrity sha512-LbrmJOMUSdEVxIKvdcJzQC+nQhe8FUZQTXQy6+I75skNgn3OoQ0DZA8YnFa7gp8tqtL3KPf1kmo0R5DoApeSGQ==\n@@ -13092,11 +13005,6 @@ speedline-core@^1.4.3:\n     image-ssim \"^0.2.0\"\n     jpeg-js \"^0.4.1\"\n \n-sprintf-js@^1.1.2:\n-  version \"1.1.2\"\n-  resolved \"https://registry.yarnpkg.com/sprintf-js/-/sprintf-js-1.1.2.tgz#da1765262bf8c0f571749f2ad6c26300207ae673\"\n-  integrity sha512-VE0SOVEHCk7Qc8ulkWw3ntAzXuqf7S2lvwQaDLRnUeIEaKNQJzV6BwmLKhOqT61aGhfUMrXeaBk+oDGCzvhcug==\n-\n sprintf-js@~1.0.2:\n   version \"1.0.3\"\n   resolved \"https://registry.yarnpkg.com/sprintf-js/-/sprintf-js-1.0.3.tgz#04e6926f662895354f3dd015203633b857297e2c\"\n@@ -13586,7 +13494,7 @@ third-party-web@^0.17.1:\n   resolved \"https://registry.yarnpkg.com/third-party-web/-/third-party-web-0.17.1.tgz#22e03f1ff519a6380bae4594b704b9bb28e15158\"\n   integrity sha512-X9Mha8cVeBwakunlZXkXL6xRzw8VCcDGWqT59EzeTYAJIi8ien3CuufnEGEx4ZUFahumNQdoOwf4H2T9Ca6lBg==\n \n-through@X.X.X, through@^2.3.6, through@^2.3.8:\n+through@^2.3.6, through@^2.3.8:\n   version \"2.3.8\"\n   resolved \"https://registry.yarnpkg.com/through/-/through-2.3.8.tgz#0dd4c9ffaabc357960b1b724115d7e0e86a2e1f5\"\n   integrity sha512-w89qg7PI8wAdvX60bMDP+bFoD5Dvhm9oLheFp5O4a2QF0cSBGsBX4qZmadPMvVqlLJBBci+WqGGOAPvcDeNSVg==\n@@ -13766,7 +13674,7 @@ tslib@2.4.1, tslib@^2.0.1, tslib@^2.1.0, tslib@^2.3.0:\n   resolved \"https://registry.yarnpkg.com/tslib/-/tslib-2.4.1.tgz#0d0bfbaac2880b91e22df0768e55be9753a5b17e\"\n   integrity sha512-tGyy4dAjRIEwI7BzsB0lynWgOpfqjUdq91XXAlIWD2OwKBH7oCl/GZG/HT4BOHrTlPMOASlMQ7veyTqpmRcrNA==\n \n-tslib@^1.10.0, tslib@^1.13.0, tslib@^1.8.1, tslib@^1.9.0, tslib@^1.9.3:\n+tslib@^1.13.0, tslib@^1.8.1, tslib@^1.9.0, tslib@^1.9.3:\n   version \"1.14.1\"\n   resolved \"https://registry.yarnpkg.com/tslib/-/tslib-1.14.1.tgz#cf2d38bdc34a134bcaf1091c41f6619e2f672d00\"\n   integrity sha512-Xni35NKzjgMrwevysHTCArtLDpPvye8zV/0E4EyYn43P7/7qvQwPh9BGkHewbMulVntbigmcT7rdX3BNo9wRJg==\n@@ -15104,11 +15012,6 @@ zip-stream@^4.1.0:\n     compress-commons \"^4.1.0\"\n     readable-stream \"^3.6.0\"\n \n-zone.js@~0.10.3:\n-  version \"0.10.3\"\n-  resolved \"https://registry.yarnpkg.com/zone.js/-/zone.js-0.10.3.tgz#3e5e4da03c607c9dcd92e37dd35687a14a140c16\"\n-  integrity sha512-LXVLVEq0NNOqK/fLJo3d0kfzd4sxwn2/h67/02pjCjfKDxgx1i9QqpvtHD8CrBnSSwMw5+dy11O7FRX5mkO7Cg==\n-\n zone.js@~0.11.4:\n   version \"0.11.8\"\n   resolved \"https://registry.yarnpkg.com/zone.js/-/zone.js-0.11.8.tgz#40dea9adc1ad007b5effb2bfed17f350f1f46a21\"\n\n\n###\n\n", "completion": "build: remove `codelyzer` from aio dependencies (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/scorecard.yml | file path B: .github/workflows/scorecard.yml\n\n@@ -47,6 +47,6 @@ jobs:\n \n       # Upload the results to GitHub's code scanning dashboard.\n       - name: 'Upload to code-scanning'\n-        uses: github/codeql-action/upload-sarif@678fc3afe258fb2e0cdc165ccf77b85719de7b3c # tag=v2.1.33\n+        uses: github/codeql-action/upload-sarif@312e093a1892bd801f026f1090904ee8e460b9b6 # tag=v2.1.34\n         with:\n           sarif_file: results.sarif\n\n\n###\n\n", "completion": "build: update github/codeql-action action to v2.1.34 (#<issue-num>)"}
{"prompt": " file path A: aio/scripts/deploy-to-firebase/index.mjs | file path B: aio/scripts/deploy-to-firebase/index.mjs\n\n@@ -384,10 +384,6 @@ function deploy(data) {\n   u.logSectionHeader('Run pre-deploy actions.');\n   preDeployActions.forEach(fn => fn(data));\n \n-  // Firebase requires that the distributable be in the same folder as firebase.json.\n-  u.logSectionHeader('Copy AIO distributable from Bazel output tree to aio/.');\n-  sh.cp('-rf', pre.DIST_DIR, 'dist');\n-\n   u.logSectionHeader('Deploy AIO to Firebase hosting.');\n   const firebase = cmd => u.yarn(`firebase ${cmd} --token \"${firebaseToken}\"`);\n   firebase(`use \"${projectId}\"`);\n\n---\n file path A: aio/scripts/deploy-to-firebase/pre-deploy-actions.mjs | file path B: aio/scripts/deploy-to-firebase/pre-deploy-actions.mjs\n\n@@ -4,7 +4,8 @@ import u from './utils.mjs';\n \n \n // Constants\n-const DIST_DIR = '../dist/bin/aio/build';\n+const BAZEL_DIST_DIR = '../dist/bin/aio/build';\n+const DIST_DIR = 'dist';\n const FIREBASE_JSON_PATH = 'firebase.json';\n const NGSW_JSON_PATH = `${DIST_DIR}/ngsw.json`;\n const NGSW_JSON_BAK_PATH = `${NGSW_JSON_PATH}.bak`;\n@@ -14,7 +15,6 @@ const exp = {\n   build,\n   checkPayloadSize,\n   disableServiceWorker,\n-  DIST_DIR,\n   undo: {\n     build: undoBuild,\n     checkPayloadSize: undoCheckPayloadSize,\n@@ -38,13 +38,17 @@ function build({deployedUrl, deployEnv}) {\n   u.yarn(`build --aio_build_config=${deployEnv}`);\n \n   u.logSectionHeader('Remove write protection on the Bazel AIO distribution.');\n-  sh.chmod('-R', 'u+w', DIST_DIR);\n-\n-  u.logSectionHeader('Add any mode-specific files into the AIO distribution.');\n-  sh.cp('-rf', `src/extra-files/${deployEnv}/.`, DIST_DIR);\n+  sh.chmod('-R', 'u+w', BAZEL_DIST_DIR);\n \n   u.logSectionHeader('Update opensearch descriptor for AIO with `deployedUrl`.');\n   u.yarn(`set-opensearch-url ${deployedUrl.replace(/[^/]$/, '$&/')}`); // The URL must end with `/`.\n+\n+  // Firebase requires that the distributable be in the same folder as firebase.json.\n+  u.logSectionHeader('Copy AIO distributable from Bazel output tree to aio/dist.');\n+  sh.cp('-rf', BAZEL_DIST_DIR, DIST_DIR);\n+\n+  u.logSectionHeader('Add any mode-specific files into the AIO distribution.');\n+  sh.cp('-rf', `src/extra-files/${deployEnv}/.`, DIST_DIR);\n }\n \n function checkPayloadSize() {\n\n---\n file path A: aio/scripts/deploy-to-firebase/pre-deploy-actions.spec.mjs | file path B: aio/scripts/deploy-to-firebase/pre-deploy-actions.spec.mjs\n\n@@ -40,7 +40,7 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n \n     it('should add mode-specific files into the distribution', () => {\n       pre.build({deployedUrl: 'http://example.com/foo/', deployEnv: 'bar'});\n-      expect(cpSpy).toHaveBeenCalledWith('-rf', 'src/extra-files/bar/.', '../dist/bin/aio/build');\n+      expect(cpSpy).toHaveBeenCalledWith('-rf', 'src/extra-files/bar/.', 'dist');\n     });\n \n     it('should update the opensearch descriptor', () => {\n@@ -59,13 +59,16 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n     it('should execute the operations in the correct order', () => {\n       let logs = [];\n       yarnSpy.and.callFake(cmd => logs.push(`yarn ${cmd}`));\n+      chmodSpy.and.callFake((opts, mode, file) => logs.push(`chmod ${opts} ${mode} ${file}`));\n       cpSpy.and.callFake((opts, from, to) => logs.push(`cp ${opts} ${from} ${to}`));\n \n       pre.build({deployedUrl: 'http://example.com/foo/', deployEnv: 'bar'});\n       expect(logs).toEqual([\n         'yarn build --aio_build_config=bar',\n-        'cp -rf src/extra-files/bar/. ../dist/bin/aio/build',\n+        'chmod -R u+w ../dist/bin/aio/build',\n         'yarn set-opensearch-url http://example.com/foo/',\n+        'cp -rf ../dist/bin/aio/build dist',\n+        'cp -rf src/extra-files/bar/. dist',\n       ]);\n     });\n   });\n@@ -88,8 +91,7 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n \n     it('should disable the ServiceWorker by renaming the `ngsw.json` manifest', () => {\n       pre.disableServiceWorker();\n-      expect(mvSpy).toHaveBeenCalledWith('../dist/bin/aio/build/ngsw.json',\n-          '../dist/bin/aio/build/ngsw.json.bak');\n+      expect(mvSpy).toHaveBeenCalledWith('dist/ngsw.json', 'dist/ngsw.json.bak');\n     });\n   });\n \n@@ -156,7 +158,7 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n \n     it('should undo `build()`', () => {\n       pre.undo.build();\n-      expect(rmSpy).toHaveBeenCalledWith('-rf', '../dist/bin/aio/build');\n+      expect(rmSpy).toHaveBeenCalledWith('-rf', 'dist');\n     });\n   });\n \n@@ -172,8 +174,7 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n \n     it('should undo `disableServiceWorker()`', () => {\n       pre.undo.disableServiceWorker();\n-      expect(mvSpy).toHaveBeenCalledWith('../dist/bin/aio/build/ngsw.json.bak',\n-          '../dist/bin/aio/build/ngsw.json');\n+      expect(mvSpy).toHaveBeenCalledWith('dist/ngsw.json.bak', 'dist/ngsw.json');\n     });\n   });\n \n\n\n###\n\n", "completion": "build(bazel): fix aio deploy script (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/pipes/date_pipe.ts | file path B: packages/common/src/pipes/date_pipe.ts\n\n@@ -75,7 +75,7 @@ export const DATE_PIPE_DEFAULT_OPTIONS =\n  * See the [I18n guide](guide/i18n-common-format-data-locale) for more information.\n  *\n  * The time zone of the formatted value can be specified either by passing it in as the second\n- * parameter of the pipe, or by setting the default through the `DATE_PIPE_DEFAULT_TIMEZONE`\n+ * parameter of the pipe, or by setting the default through the `DATE_PIPE_DEFAULT_OPTIONS`\n  * injection token. The value that is passed in as the second parameter takes precedence over\n  * the one defined using the injection token.\n  *\n\n\n###\n\n", "completion": "docs: update date pipe default timezone injection token reference (#<issue-num>)"}
{"prompt": " file path A: tools/defaults.bzl | file path B: tools/defaults.bzl\n\n@@ -413,6 +413,7 @@ def _apply_esm_import_patch(env, templated_args, data):\n     env = dict(env, **{\"NODE_MODULES_WORKSPACE_NAME\": _node_modules_workspace_name()})\n     templated_args = templated_args + [\n         \"--node_options=--loader=file:///$$(rlocation $(rootpath //tools/esm-loader:esm-loader.mjs))\",\n+        \"--node_options=--no-warnings\",  # `--loader` is an experimental feature with warnings.\n     ]\n     data = data + [\n         \"//tools/esm-loader\",\n\n\n###\n\n", "completion": "build: hide `--loader` warning when ESM import patch is installed (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/doc-build-test.md | file path B: aio/content/guide/doc-build-test.md\n\n@@ -70,11 +70,12 @@ On your local computer, in a command line tool or the **Terminal** pane of your\n \n     </code-example>\n \n-1.  Run this command to start the end-to-end tests.\n+1.  Run these commands to run the end-to-end tests.\n \n     <code-example format=\"shell\" language=\"shell\">\n \n     yarn e2e\n+    yarn docs-test\n \n     </code-example>\n \n\n---\n file path A: aio/content/guide/doc-editing.md | file path B: aio/content/guide/doc-editing.md\n\n@@ -77,7 +77,7 @@ Perform these steps from a command-line tool on your local computer or in the **\n \n     <code-example language=\"shell\">\n \n-    yarn serve-and-sync\n+    yarn start\n \n     </code-example>\n \n@@ -167,7 +167,7 @@ Remember to replace `personal` with your GitHub username.\n \n     <code-example language=\"shell\">\n \n-    yarn serve-and-sync\n+    yarn start\n \n     </code-example>\n \n\n---\n file path A: aio/content/guide/doc-prepare-to-edit.md | file path B: aio/content/guide/doc-prepare-to-edit.md\n\n@@ -286,7 +286,7 @@ After you clone the origin repo on your local computer, run these commands from\n \n         <code-example format=\"shell\" language=\"shell\">\n \n-        yarn install\n+        yarn\n \n         </code-example>\n \n@@ -302,7 +302,7 @@ After you clone the origin repo on your local computer, run these commands from\n \n         <code-example format=\"shell\" language=\"shell\">\n \n-        yarn setup\n+        yarn\n \n         </code-example>\n \n@@ -382,7 +382,7 @@ Perform these steps from a command-line tool on your local computer.\n \n         <code-example format=\"shell\" language=\"shell\">\n \n-        yarn serve-and-sync\n+        yarn start\n \n         </code-example>\n \n@@ -403,13 +403,14 @@ Perform these steps from a command-line tool on your local computer.\n     </code-example>\n \n 1.  If building the documentation returns one or more errors, fix those and build the documentation again before you continue.\n-1.  From the documentation directory, run this command to start the automated tests that verify the docs are consistent.\n+1.  From the documentation directory, run these commands to start the automated tests that verify the docs are consistent.\n     These are most, but not all, of the tests that are performed after you open your pull request.\n     Some tests can only be run in the automated testing environment.\n \n     <code-example format=\"shell\" language=\"shell\">\n \n     yarn e2e\n+    yarn docs-test\n \n     </code-example>\n \n\n\n###\n\n", "completion": "docs: update docs to use new build and test commands (#<issue-num>)"}
{"prompt": " file path A: packages/core/test/acceptance/content_spec.ts | file path B: packages/core/test/acceptance/content_spec.ts\n\n@@ -995,9 +995,7 @@ describe('projection', () => {\n     const fixture = TestBed.createComponent(CardWithTitle);\n     fixture.detectChanges();\n \n-    // Compare the text output, because Ivy and ViewEngine produce slightly different HTML.\n-    expect(fixture.nativeElement.textContent)\n-        .toContain('Title --- Subtitle --- content --- footer');\n+    expect(fixture.nativeElement.textContent).toEqual('Title --- Subtitle --- content --- footer');\n   });\n \n   it('should support ngProjectAs on elements (including <ng-content>)', () => {\n@@ -1037,8 +1035,7 @@ describe('projection', () => {\n     const fixture = TestBed.createComponent(App);\n     fixture.detectChanges();\n \n-    // Compare the text output, because Ivy and ViewEngine produce slightly different HTML.\n-    expect(fixture.nativeElement.textContent).toContain('Title --- content');\n+    expect(fixture.nativeElement.textContent).toEqual('Title --- content');\n   });\n \n   it('should not match multiple selectors in ngProjectAs', () => {\n@@ -1066,8 +1063,7 @@ describe('projection', () => {\n     const fixture = TestBed.createComponent(App);\n     fixture.detectChanges();\n \n-    // Compare the text output, because Ivy and ViewEngine produce slightly different HTML.\n-    expect(fixture.nativeElement.textContent).not.toContain('Title content');\n+    expect(fixture.nativeElement.textContent).not.toEqual('Title content');\n   });\n \n   it('should preserve ngProjectAs and other attributes on projected element', () => {\n\n---\n file path A: packages/core/test/acceptance/integration_spec.ts | file path B: packages/core/test/acceptance/integration_spec.ts\n\n@@ -1119,9 +1119,7 @@ describe('acceptance integration tests', () => {\n \n            const styles = fixture.componentInstance.mockStyleDirective.stylesVal;\n \n-           // Use `toContain` since Ivy and ViewEngine have some slight differences in formatting.\n-           expect(styles).toContain('width: 100px');\n-           expect(styles).toContain('height: 200px');\n+           expect(styles).toEqual('width: 100px; height: 200px;');\n          });\n \n       it('should update `[class]` and bindings in the provided directive if the input is matched',\n@@ -1458,8 +1456,7 @@ describe('acceptance integration tests', () => {\n             .createComponent(SomeComponent);\n       })\n           .toThrowError(\n-              // The ViewEngine error has a typo, whereas the Ivy one fixes it.\n-              /^Unexpected directive 'SomeComponent' imported by the module 'ModuleWithImportedComponent'\\. Please add (a|an) @NgModule annotation\\.$/);\n+              /^Unexpected directive 'SomeComponent' imported by the module 'ModuleWithImportedComponent'\\. Please add an @NgModule annotation\\.$/);\n     });\n \n     it('should throw with descriptive error message when a pipe is passed to imports', () => {\n@@ -1477,8 +1474,7 @@ describe('acceptance integration tests', () => {\n             .createComponent(FixtureComponent);\n       })\n           .toThrowError(\n-              // The ViewEngine error has a typo, whereas the Ivy one fixes it.\n-              /^Unexpected pipe 'SomePipe' imported by the module 'ModuleWithImportedPipe'\\. Please add (a|an) @NgModule annotation\\.$/);\n+              /^Unexpected pipe 'SomePipe' imported by the module 'ModuleWithImportedPipe'\\. Please add an @NgModule annotation\\.$/);\n     });\n \n     it('should throw with descriptive error message when a module is passed to declarations', () => {\n@@ -1530,8 +1526,7 @@ describe('acceptance integration tests', () => {\n                .createComponent(FixtureComponent);\n          })\n              .toThrowError(\n-                 // The ViewEngine error has a typo, whereas the Ivy one fixes it.\n-                 /^Unexpected value 'SomeModule' imported by the module 'ModuleWithImportedModule'\\. Please add (a|an) @NgModule annotation\\.$/);\n+                 /^Unexpected value 'SomeModule' imported by the module 'ModuleWithImportedModule'\\. Please add an @NgModule annotation\\.$/);\n        });\n   });\n \n\n---\n file path A: packages/core/test/acceptance/ng_module_spec.ts | file path B: packages/core/test/acceptance/ng_module_spec.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {CommonModule} from '@angular/common';\n-import {Component, createNgModule, CUSTOM_ELEMENTS_SCHEMA, destroyPlatform, Directive, Injectable, InjectionToken, NgModule, NgModuleRef, NO_ERRORS_SCHEMA, Pipe, \u0275setClassMetadata as setClassMetadata, \u0275\u0275defineComponent as defineComponent, \u0275\u0275defineInjector as defineInjector, \u0275\u0275defineNgModule as defineNgModule, \u0275\u0275element as element, \u0275\u0275property as property} from '@angular/core';\n+import {Component, createNgModule, CUSTOM_ELEMENTS_SCHEMA, destroyPlatform, Directive, Injectable, InjectionToken, NgModule, NgModuleRef, NO_ERRORS_SCHEMA, Pipe, \u0275setClassMetadata as setClassMetadata, \u0275\u0275defineComponent as defineComponent, \u0275\u0275defineInjector as defineInjector, \u0275\u0275defineNgModule as defineNgModule, \u0275\u0275element as element, \u0275\u0275property as property,} from '@angular/core';\n import {KNOWN_CONTROL_FLOW_DIRECTIVES} from '@angular/core/src/render3/instructions/element_validation';\n import {TestBed} from '@angular/core/testing';\n import {BrowserModule} from '@angular/platform-browser';\n@@ -249,10 +249,10 @@ describe('NgModule', () => {\n       @Component({\n         selector: 'my-comp',\n         template: `\n-              <ng-container *ngIf=\"condition\">\n-                <div [unknown-prop]=\"true\"></div>\n-              </ng-container>\n-            `,\n+          <ng-container *ngIf=\"condition\">\n+            <div [unknown-prop]=\"true\"></div>\n+          </ng-container>\n+        `,\n       })\n       class MyComp {\n         condition = true;\n@@ -278,9 +278,7 @@ describe('NgModule', () => {\n     it('should log an error on unknown props of `ng-template` if NO_ERRORS_SCHEMA is absent', () => {\n       @Component({\n         selector: 'my-comp',\n-        template: `\n-              <ng-template *ngIf=\"condition\"></ng-template>\n-            `,\n+        template: ` <ng-template *ngIf=\"condition\"></ng-template> `,\n       })\n       class MyComp {\n         condition = true;\n@@ -306,9 +304,7 @@ describe('NgModule', () => {\n     it('should log an error on unknown props of `ng-container` if NO_ERRORS_SCHEMA is absent', () => {\n       @Component({\n         selector: 'my-comp',\n-        template: `\n-              <ng-container *ngIf=\"condition\"></ng-container>\n-            `,\n+        template: ` <ng-container *ngIf=\"condition\"></ng-container> `,\n       })\n       class MyComp {\n         condition = true;\n@@ -334,9 +330,7 @@ describe('NgModule', () => {\n     it('should log an error on unknown props of `ng-content` if NO_ERRORS_SCHEMA is absent', () => {\n       @Component({\n         selector: 'my-comp',\n-        template: `\n-              <ng-content *ngIf=\"condition\"></ng-content>\n-            `,\n+        template: ` <ng-content *ngIf=\"condition\"></ng-content> `,\n       })\n       class MyComp {\n         condition = true;\n@@ -364,10 +358,10 @@ describe('NgModule', () => {\n          @Component({\n            selector: 'my-comp',\n            template: `\n-              <ng-container *ngIf=\"condition\">\n-                <div [unknown-prop]=\"true\"></div>\n-              </ng-container>\n-            `,\n+          <ng-container *ngIf=\"condition\">\n+            <div [unknown-prop]=\"true\"></div>\n+          </ng-container>\n+        `,\n          })\n          class MyComp {\n            condition = true;\n@@ -483,7 +477,7 @@ describe('NgModule', () => {\n          @Component({\n            template: `<custom-el></custom-el>`,\n            standalone: true,\n-           schemas: [CUSTOM_ELEMENTS_SCHEMA]\n+           schemas: [CUSTOM_ELEMENTS_SCHEMA],\n          })\n          class MyComp {\n          }\n@@ -629,9 +623,9 @@ describe('NgModule', () => {\n         `NG0303: Can't bind to 'unknownProp' since it isn't a known property of 'may-be-web-component' \\\\(used in the 'MyComp' component template\\\\).`,\n         `1. If 'may-be-web-component' is an Angular component and it has the 'unknownProp' input, then verify that it is a part of an @NgModule where this component is declared.`,\n         `2. If 'may-be-web-component' is a Web Component then add 'CUSTOM_ELEMENTS_SCHEMA' to the '@NgModule.schemas' of this component to suppress this message.`,\n-        `3. To allow any property add 'NO_ERRORS_SCHEMA' to the '@NgModule.schemas' of this component.`\n+        `3. To allow any property add 'NO_ERRORS_SCHEMA' to the '@NgModule.schemas' of this component.`,\n       ];\n-      lines.forEach(line => expect(errorMessage).toMatch(line));\n+      lines.forEach((line) => expect(errorMessage).toMatch(line));\n     });\n \n     KNOWN_CONTROL_FLOW_DIRECTIVES.forEach((correspondingImport, directive) => {\n@@ -664,9 +658,9 @@ describe('NgModule', () => {\n                  directive}' since it isn't a known property of 'div' \\\\(used in the 'App' component template\\\\).`,\n              `If the '${directive}' is an Angular control flow directive, please make sure ` +\n                  `that either the '${\n-                     correspondingImport}' directive or the 'CommonModule' is a part of an @NgModule where this component is declared.`\n+                     correspondingImport}' directive or the 'CommonModule' is a part of an @NgModule where this component is declared.`,\n            ];\n-           lines.forEach(line => expect(errorMessage).toMatch(line));\n+           lines.forEach((line) => expect(errorMessage).toMatch(line));\n          });\n \n       it(`should produce a warning when the '${directive}' directive ` +\n@@ -692,9 +686,9 @@ describe('NgModule', () => {\n                  directive}' since it isn't a known property of 'div' \\\\(used in the 'App' component template\\\\).`,\n              `If the '${directive}' is an Angular control flow directive, please make sure ` +\n                  `that either the '${\n-                     correspondingImport}' directive or the 'CommonModule' is included in the '@Component.imports' of this component.`\n+                     correspondingImport}' directive or the 'CommonModule' is included in the '@Component.imports' of this component.`,\n            ];\n-           lines.forEach(line => expect(errorMessage).toMatch(line));\n+           lines.forEach((line) => expect(errorMessage).toMatch(line));\n          });\n     });\n \n@@ -710,16 +704,17 @@ describe('NgModule', () => {\n             vars,\n             consts,\n             template,\n-            encapsulation: 2\n+            encapsulation: 2,\n           });\n         }\n         setClassMetadata(\n-            Comp, [{\n-              type: Component,\n-              args: [\n-                {selector: 'comp', template: '...'},\n-              ]\n-            }],\n+            Comp,\n+            [\n+              {\n+                type: Component,\n+                args: [{selector: 'comp', template: '...'}],\n+              },\n+            ],\n             null, null);\n         return Comp;\n       }\n@@ -730,13 +725,18 @@ describe('NgModule', () => {\n           static \u0275inj = defineInjector({});\n         }\n         setClassMetadata(\n-            Module, [{\n-              type: NgModule,\n-              args: [{\n-                declarations: [Comp],\n-                schemas: [NO_ERRORS_SCHEMA],\n-              }]\n-            }],\n+            Module,\n+            [\n+              {\n+                type: NgModule,\n+                args: [\n+                  {\n+                    declarations: [Comp],\n+                    schemas: [NO_ERRORS_SCHEMA],\n+                  },\n+                ],\n+              },\n+            ],\n             null, null);\n         return Module;\n       }\n@@ -839,7 +839,7 @@ describe('NgModule', () => {\n       TestBed.configureTestingModule({\n         declarations: [MyComp],\n         schemas: [CUSTOM_ELEMENTS_SCHEMA],\n-        errorOnUnknownElements: true\n+        errorOnUnknownElements: true,\n       });\n \n       const fixture = TestBed.createComponent(MyComp);\n@@ -871,8 +871,11 @@ describe('NgModule', () => {\n       }\n \n       const spy = spyOn(console, 'error');\n-      TestBed.configureTestingModule(\n-          {declarations: [MyComp], schemas: [NO_ERRORS_SCHEMA], errorOnUnknownElements: true});\n+      TestBed.configureTestingModule({\n+        declarations: [MyComp],\n+        schemas: [NO_ERRORS_SCHEMA],\n+        errorOnUnknownElements: true,\n+      });\n \n       const fixture = TestBed.createComponent(MyComp);\n       fixture.detectChanges();\n@@ -914,8 +917,10 @@ describe('NgModule', () => {\n       }\n \n       const spy = spyOn(console, 'error');\n-      TestBed.configureTestingModule(\n-          {declarations: [MyComp, CustomEl], errorOnUnknownElements: true});\n+      TestBed.configureTestingModule({\n+        declarations: [MyComp, CustomEl],\n+        errorOnUnknownElements: true,\n+      });\n \n       const fixture = TestBed.createComponent(MyComp);\n       fixture.detectChanges();\n@@ -982,17 +987,13 @@ describe('NgModule', () => {\n       const TOKEN_A = new InjectionToken('A');\n       const TOKEN_B = new InjectionToken('B');\n       @NgModule({\n-        providers: [\n-          {provide: TOKEN_A, useValue: 'TokenValueA'},\n-        ]\n+        providers: [{provide: TOKEN_A, useValue: 'TokenValueA'}],\n       })\n       class AppModule {\n       }\n \n       @NgModule({\n-        providers: [\n-          {provide: TOKEN_B, useValue: 'TokenValueB'},\n-        ]\n+        providers: [{provide: TOKEN_B, useValue: 'TokenValueB'}],\n       })\n       class ChildModule {\n       }\n@@ -1039,7 +1040,6 @@ describe('NgModule', () => {\n        @NgModule({\n          declarations: [TestCmp],\n          exports: [TestCmp],\n-         entryComponents: [TestCmp]  // Only necessary for ViewEngine\n        })\n        class MyModule {\n          constructor(ngModuleRef: NgModuleRef<any>) {\n\n\n###\n\n", "completion": "test(core): remove some ViewEngine related test code (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/router_scroller.ts | file path B: packages/router/src/router_scroller.ts\n\n@@ -19,10 +19,8 @@ export const ROUTER_SCROLLER = new InjectionToken<RouterScroller>('');\n \n @Injectable()\n export class RouterScroller implements OnDestroy {\n-  // TODO(issue/24571): remove '!'.\n-  private routerEventsSubscription!: Unsubscribable;\n-  // TODO(issue/24571): remove '!'.\n-  private scrollEventsSubscription!: Unsubscribable;\n+  private routerEventsSubscription?: Unsubscribable;\n+  private scrollEventsSubscription?: Unsubscribable;\n \n   private lastId = 0;\n   private lastSource: 'imperative'|'popstate'|'hashchange'|undefined = 'imperative';\n@@ -105,11 +103,7 @@ export class RouterScroller implements OnDestroy {\n \n   /** @nodoc */\n   ngOnDestroy() {\n-    if (this.routerEventsSubscription) {\n-      this.routerEventsSubscription.unsubscribe();\n-    }\n-    if (this.scrollEventsSubscription) {\n-      this.scrollEventsSubscription.unsubscribe();\n-    }\n+    this.routerEventsSubscription?.unsubscribe();\n+    this.scrollEventsSubscription?.unsubscribe();\n   }\n }\n\n---\n file path A: packages/router/src/router_state.ts | file path B: packages/router/src/router_state.ts\n\n@@ -115,9 +115,9 @@ export class ActivatedRoute {\n   /** @internal */\n   _routerState!: RouterState;\n   /** @internal */\n-  _paramMap!: Observable<ParamMap>;\n+  _paramMap?: Observable<ParamMap>;\n   /** @internal */\n-  _queryParamMap!: Observable<ParamMap>;\n+  _queryParamMap?: Observable<ParamMap>;\n \n   /** An Observable of the resolved route title */\n   readonly title: Observable<string|undefined> =\n@@ -288,17 +288,13 @@ export class ActivatedRouteSnapshot {\n   /** @internal */\n   _resolve: ResolveData;\n   /** @internal */\n-  // TODO(issue/24571): remove '!'.\n-  _resolvedData!: Data;\n+  _resolvedData?: Data;\n   /** @internal */\n-  // TODO(issue/24571): remove '!'.\n   _routerState!: RouterStateSnapshot;\n   /** @internal */\n-  // TODO(issue/24571): remove '!'.\n-  _paramMap!: ParamMap;\n+  _paramMap?: ParamMap;\n   /** @internal */\n-  // TODO(issue/24571): remove '!'.\n-  _queryParamMap!: ParamMap;\n+  _queryParamMap?: ParamMap;\n \n   /** The resolved route title */\n   get title(): string|undefined {\n\n---\n file path A: packages/router/src/url_tree.ts | file path B: packages/router/src/url_tree.ts\n\n@@ -189,8 +189,7 @@ function matrixParamsMatch(\n  */\n export class UrlTree {\n   /** @internal */\n-  // TODO(issue/24571): remove '!'.\n-  _queryParamMap!: ParamMap;\n+  _queryParamMap?: ParamMap;\n \n   constructor(\n       /** The root segment group of the URL tree */\n@@ -299,8 +298,7 @@ export class UrlSegmentGroup {\n  */\n export class UrlSegment {\n   /** @internal */\n-  // TODO(issue/24571): remove '!'.\n-  _parameterMap!: ParamMap;\n+  _parameterMap?: ParamMap;\n \n   constructor(\n       /** The path part of a URL segment */\n\n---\n file path A: packages/router/test/regression_integration.spec.ts | file path B: packages/router/test/regression_integration.spec.ts\n\n@@ -123,18 +123,18 @@ describe('Integration', () => {\n         `\n          })\n          class ComponentWithRouterLink {\n-           // TODO(issue/24571): remove '!'.\n-           @ViewChild(TemplateRef, {static: true}) templateRef!: TemplateRef<any>;\n-           // TODO(issue/24571): remove '!'.\n+           @ViewChild(TemplateRef, {static: true}) templateRef?: TemplateRef<any>;\n            @ViewChild('container', {read: ViewContainerRef, static: true})\n-           container!: ViewContainerRef;\n+           container?: ViewContainerRef;\n \n            addLink() {\n-             this.container.createEmbeddedView(this.templateRef, {$implicit: '/simple'});\n+             if (this.templateRef) {\n+               this.container?.createEmbeddedView(this.templateRef, {$implicit: '/simple'});\n+             }\n            }\n \n            removeLink() {\n-             this.container.clear();\n+             this.container?.clear();\n            }\n          }\n \n\n\n###\n\n", "completion": "refactor(router): remove non-null assertions (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/navigation_transition.ts | file path B: packages/router/src/navigation_transition.ts\n\n@@ -263,7 +263,6 @@ export interface NavigationTransition {\n  */\n interface InternalRouterInterface {\n   events: Observable<Event>;\n-  lastSuccessfulNavigation: Navigation|null;\n   browserUrlTree: UrlTree;\n   currentUrlTree: UrlTree;\n   rawUrlTree: UrlTree;\n@@ -300,6 +299,7 @@ interface InternalRouterInterface {\n \n export class NavigationTransitions {\n   currentNavigation: Navigation|null = null;\n+  lastSuccessfulNavigation: Navigation|null = null;\n \n   constructor(readonly router: InternalRouterInterface) {}\n \n@@ -328,8 +328,8 @@ export class NavigationTransitions {\n                              extractedUrl: t.extractedUrl,\n                              trigger: t.source,\n                              extras: t.extras,\n-                             previousNavigation: !this.router.lastSuccessfulNavigation ? null : {\n-                               ...this.router.lastSuccessfulNavigation,\n+                             previousNavigation: !this.lastSuccessfulNavigation ? null : {\n+                               ...this.lastSuccessfulNavigation,\n                                previousNavigation: null,\n                              },\n                            };\n@@ -615,10 +615,11 @@ export class NavigationTransitions {\n                              (evt: Event) => this.router.triggerEvent(evt)),\n \n                          tap({\n-                           next() {\n+                           next: () => {\n                              completed = true;\n+                             this.lastSuccessfulNavigation = this.currentNavigation;\n                            },\n-                           complete() {\n+                           complete: () => {\n                              completed = true;\n                            }\n                          }),\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -178,8 +178,6 @@ export class Router {\n   /** @internal */\n   readonly transitions: BehaviorSubject<NavigationTransition>;\n   private navigations: Observable<NavigationTransition>;\n-  /** @internal */\n-  lastSuccessfulNavigation: Navigation|null = null;\n   private disposed = false;\n \n   private locationSubscription?: SubscriptionLike;\n@@ -754,7 +752,6 @@ export class Router {\n           (this.events as Subject<Event>)\n               .next(new NavigationEnd(\n                   t.id, this.serializeUrl(t.extractedUrl), this.serializeUrl(this.currentUrlTree)));\n-          this.lastSuccessfulNavigation = this.getCurrentNavigation();\n           this.titleStrategy?.updateTitle(this.routerState.snapshot);\n           t.resolve(true);\n         },\n\n\n###\n\n", "completion": "refactor(router): move lastSuccesfulNavigation to navigation transitions (#<issue-num>)"}
{"prompt": " file path A: packages/misc/angular-in-memory-web-api/package.json | file path B: packages/misc/angular-in-memory-web-api/package.json\n\n@@ -1,12 +1,12 @@\n {\n   \"name\": \"angular-in-memory-web-api\",\n-  \"version\": \"0.14.0\",\n+  \"version\": \"0.15.0\",\n   \"description\": \"An in-memory web api for Angular demos and tests\",\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"peerDependencies\": {\n-    \"@angular/core\": \"^14.0.0\",\n-    \"@angular/common\": \"^14.0.0\",\n+    \"@angular/core\": \"^15.0.0\",\n+    \"@angular/common\": \"^15.0.0\",\n     \"rxjs\": \"^6.5.3 || ^7.4.0\"\n   },\n   \"dependencies\": {\n@@ -21,4 +21,4 @@\n   \"publishConfig\": {\n     \"registry\": \"https://wombat-dressing-room.appspot.com\"\n   }\n-}\n\\ No newline at end of file\n+}\n\n\n###\n\n", "completion": "build: update angular version of in-memory-web-api (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/feature-modules/src/app/customer-dashboard/customer-dashboard/customer-dashboard.component.ts | file path B: aio/content/examples/feature-modules/src/app/customer-dashboard/customer-dashboard/customer-dashboard.component.ts\n\n@@ -1,15 +1,10 @@\n-import { Component, OnInit } from '@angular/core';\n+import { Component } from '@angular/core';\n \n @Component({\n   selector: 'app-customer-dashboard',\n   templateUrl: './customer-dashboard.component.html',\n   styleUrls: ['./customer-dashboard.component.css']\n })\n-export class CustomerDashboardComponent implements OnInit {\n-\n-  constructor() { }\n-\n-  ngOnInit() {\n-  }\n+export class CustomerDashboardComponent {\n \n }\n\n\n###\n\n", "completion": "docs: removed empty methods (#<issue-num>)"}
{"prompt": " file path A: packages/platform-server/src/server.ts | file path B: packages/platform-server/src/server.ts\n\n@@ -27,7 +27,7 @@ import {TRANSFER_STATE_SERIALIZATION_PROVIDERS} from './transfer_state';\n export const INTERNAL_SERVER_PLATFORM_PROVIDERS: StaticProvider[] = [\n   {provide: DOCUMENT, useFactory: _document, deps: [Injector]},\n   {provide: PLATFORM_ID, useValue: PLATFORM_SERVER_ID},\n-  {provide: PLATFORM_INITIALIZER, useFactory: initDominoAdapter, multi: true, deps: [Injector]}, {\n+  {provide: PLATFORM_INITIALIZER, useFactory: initDominoAdapter, multi: true}, {\n     provide: PlatformLocation,\n     useClass: ServerPlatformLocation,\n     deps: [DOCUMENT, [Optional, INITIAL_CONFIG]]\n@@ -37,7 +37,7 @@ export const INTERNAL_SERVER_PLATFORM_PROVIDERS: StaticProvider[] = [\n   {provide: ALLOW_MULTIPLE_PLATFORMS, useValue: true}\n ];\n \n-function initDominoAdapter(injector: Injector) {\n+function initDominoAdapter() {\n   return () => {\n     DominoAdapter.makeCurrent();\n   };\n\n\n###\n\n", "completion": "refactor(platform-server): remove `Injector` dependency for `initDominoAdapter` factory (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/render/api.ts | file path B: packages/core/src/render/api.ts\n\n@@ -6,7 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {InjectionToken} from '../di/injection_token';\n import {isLView} from '../render3/interfaces/type_checks';\n import {RENDERER} from '../render3/interfaces/view';\n import {getCurrentTNode, getLView} from '../render3/state';\n@@ -15,9 +14,6 @@ import {getComponentLViewByIndex} from '../render3/util/view_utils';\n import {RendererStyleFlags2, RendererType2} from './api_flags';\n \n \n-export const Renderer2Interceptor = new InjectionToken<Renderer2[]>('Renderer2Interceptor');\n-\n-\n /**\n  * Creates and initializes a custom renderer that implements the `Renderer2` base class.\n  *\n\n---\n file path A: packages/core/src/render3/assert.ts | file path B: packages/core/src/render3/assert.ts\n\n@@ -119,11 +119,6 @@ export function assertIndexInDeclRange(lView: LView, index: number) {\n   assertBetween(HEADER_OFFSET, tView.bindingStartIndex, index);\n }\n \n-export function assertIndexInVarsRange(lView: LView, index: number) {\n-  const tView = lView[1];\n-  assertBetween(tView.bindingStartIndex, tView.expandoStartIndex, index);\n-}\n-\n export function assertIndexInExpandoRange(lView: LView, index: number) {\n   const tView = lView[1];\n   assertBetween(tView.expandoStartIndex, lView.length, index);\n\n---\n file path A: packages/core/src/render3/component_ref.ts | file path B: packages/core/src/render3/component_ref.ts\n\n@@ -239,19 +239,6 @@ export class ComponentFactory<T> extends AbstractComponentFactory<T> {\n   }\n }\n \n-const componentFactoryResolver: ComponentFactoryResolver = new ComponentFactoryResolver();\n-\n-/**\n- * Creates a ComponentFactoryResolver and stores it on the injector. Or, if the\n- * ComponentFactoryResolver\n- * already exists, retrieves the existing ComponentFactoryResolver.\n- *\n- * @returns The ComponentFactoryResolver instance to use\n- */\n-export function injectComponentFactoryResolver(): AbstractComponentFactoryResolver {\n-  return componentFactoryResolver;\n-}\n-\n /**\n  * Represents an instance of a Component created via a {@link ComponentFactory}.\n  *\n\n---\n file path A: packages/core/src/render3/index.ts | file path B: packages/core/src/render3/index.ts\n\n@@ -18,7 +18,7 @@ import {\u0275\u0275ComponentDeclaration, \u0275\u0275DirectiveDeclaration, \u0275\u0275FactoryDeclarati\n import {ComponentDebugMetadata, DirectiveDebugMetadata, getComponent, getDirectiveMetadata, getDirectives, getHostElement, getRenderedText} from './util/discovery_utils';\n \n export {NgModuleType} from '../metadata/ng_module_def';\n-export {ComponentFactory, ComponentFactoryResolver, ComponentRef, injectComponentFactoryResolver} from './component_ref';\n+export {ComponentFactory, ComponentFactoryResolver, ComponentRef} from './component_ref';\n export {\u0275\u0275getInheritedFactory} from './di';\n export {getLocaleId, setLocaleId} from './i18n/i18n_locale_id';\n // clang-format off\n\n---\n file path A: packages/core/test/render3/component_ref_spec.ts | file path B: packages/core/test/render3/component_ref_spec.ts\n\n@@ -6,14 +6,14 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {ComponentFactoryResolver} from '@angular/core/src/render3/component_ref';\n import {Renderer} from '@angular/core/src/render3/interfaces/renderer';\n import {RElement} from '@angular/core/src/render3/interfaces/renderer_dom';\n import {TestBed} from '@angular/core/testing';\n \n-import {ChangeDetectionStrategy, Component, Injector, Input, NgModuleRef, OnChanges, Output, RendererType2, SimpleChanges, Type, ViewEncapsulation} from '../../src/core';\n+import {ChangeDetectionStrategy, Component, Injector, Input, NgModuleRef, OnChanges, Output, RendererType2, SimpleChanges, ViewEncapsulation} from '../../src/core';\n import {ComponentFactory} from '../../src/linker/component_factory';\n import {RendererFactory2} from '../../src/render/api';\n-import {injectComponentFactoryResolver} from '../../src/render3/component_ref';\n import {Sanitizer} from '../../src/sanitization/sanitizer';\n \n import {MockRendererFactory} from './instructions/mock_renderer_factory';\n@@ -28,7 +28,7 @@ const THROWING_RENDERER_FACTOR2_PROVIDER = {\n };\n \n describe('ComponentFactory', () => {\n-  const cfr = injectComponentFactoryResolver();\n+  const cfr = new ComponentFactoryResolver();\n \n   describe('constructor()', () => {\n     it('should correctly populate default properties', () => {\n\n\n###\n\n", "completion": "refactor(core): remove unused private APIs (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/deployment.md | file path B: aio/content/guide/deployment.md\n\n@@ -151,7 +151,7 @@ To deploy your Angular application to [GitHub Pages](https://help.github.com/art\n \n 1.  When the build is complete, make a copy of `docs/index.html` and name it `docs/404.html`.\n 1.  Commit your changes and push.\n-1.  On the GitHub project page, go to Settings and scroll down to the GitHub Pages section to configure the site to [publish from the docs folder](https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site#choosing-a-publishing-source).\n+1.  On the GitHub project page, go to Settings and select the Pages option from the left sidebar to configure the site to [publish from the docs folder](https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site#choosing-a-publishing-source).\n 1.  Click Save.\n 1.  Click on the GitHub Pages link at the top of the GitHub Pages section to see your deployed application.\n     The format of the link is `https://<user_name>.github.io/<project_name>`.\n\n\n###\n\n", "completion": "docs: update deployment to GitHub Pages  (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/router/src/app/admin/admin-routing.module.2.ts | file path B: aio/content/examples/router/src/app/admin/admin-routing.module.2.ts\n\n@@ -17,9 +17,6 @@ const adminRoutes: Routes = [{\n   canActivate: [authGuard],\n \n   // #enddocregion admin-route\n-  // #docregion can-match\n-  canMatch: [authGuard],\n-  // #enddocregion can-match\n   // #docregion admin-route\n   children: [{\n     path: '',\n\n---\n file path A: aio/content/examples/router/src/app/app-routing.module.5.ts | file path B: aio/content/examples/router/src/app/app-routing.module.5.ts\n\n@@ -20,7 +20,7 @@ const appRoutes: Routes = [\n     path: 'admin',\n     loadChildren: () => import('./admin/admin.module').then(m => m.AdminModule),\n // #enddocregion admin-1\n-    canLoad: [authGuard]\n+    canMatch: [authGuard]\n // #docregion admin-1\n   },\n // #enddocregion admin, admin-1\n\n---\n file path A: aio/content/examples/router/src/app/app-routing.module.6.ts | file path B: aio/content/examples/router/src/app/app-routing.module.6.ts\n\n@@ -22,7 +22,7 @@ const appRoutes: Routes = [\n   {\n     path: 'admin',\n     loadChildren: () => import('./admin/admin.module').then(m => m.AdminModule),\n-    canLoad: [authGuard]\n+    canMatch: [authGuard]\n   },\n   {\n     path: 'crisis-center',\n\n---\n file path A: aio/content/examples/router/src/app/app-routing.module.ts | file path B: aio/content/examples/router/src/app/app-routing.module.ts\n\n@@ -18,7 +18,7 @@ const appRoutes: Routes = [\n   {\n     path: 'admin',\n     loadChildren: () => import('./admin/admin.module').then(m => m.AdminModule),\n-    canLoad: [authGuard]\n+    canMatch: [authGuard]\n   },\n   // #docregion preload-v2\n   {\n\n---\n file path A: aio/content/examples/router/src/app/auth/auth.guard.1.ts | file path B: aio/content/examples/router/src/app/auth/auth.guard.1.ts\n\n@@ -1,7 +1,6 @@\n // #docregion\n-import { CanActivateFn } from '@angular/router';\n \n-export const authGuard: CanActivateFn = () => {\n+export const authGuard = () => {\n   console.log('authGuard#canActivate called');\n   return true;\n };\n\n---\n file path A: aio/content/examples/router/src/app/auth/auth.guard.2.ts | file path B: aio/content/examples/router/src/app/auth/auth.guard.2.ts\n\n@@ -1,13 +1,10 @@\n // #docregion\n import {inject} from '@angular/core';\n-import {\n-  CanActivateFn, CanMatchFn,\n-  Router, UrlTree\n-} from '@angular/router';\n+import { Router } from '@angular/router';\n \n import {AuthService} from './auth.service';\n \n-export const authGuard: CanMatchFn|CanActivateFn = () => {\n+export const authGuard = () => {\n   const authService = inject(AuthService);\n   const router = inject(Router);\n \n\n---\n file path A: aio/content/examples/router/src/app/auth/auth.guard.3.ts | file path B: aio/content/examples/router/src/app/auth/auth.guard.3.ts\n\n@@ -1,13 +1,8 @@\n-// #docregion can-activate-child\n import { inject } from '@angular/core';\n-import {\n-  CanActivateFn, CanMatchFn, Router,\n-  CanActivateChildFn,\n-  UrlTree\n-} from '@angular/router';\n+import { Router } from '@angular/router';\n import { AuthService } from './auth.service';\n \n-export const authGuard: CanMatchFn|CanActivateFn|CanActivateChildFn = () => {\n+export const authGuard = () => {\n   const authService = inject(AuthService);\n   const router = inject(Router);\n \n\n---\n file path A: aio/content/examples/router/src/app/auth/auth.guard.4.ts | file path B: aio/content/examples/router/src/app/auth/auth.guard.4.ts\n\n@@ -1,15 +1,10 @@\n // #docplaster\n // #docregion\n import { inject } from '@angular/core';\n-import {\n-  CanActivateFn, CanMatchFn, Router,\n-  CanActivateChildFn,\n-  NavigationExtras,\n-  UrlTree\n-} from '@angular/router';\n+import { Router, NavigationExtras } from '@angular/router';\n import { AuthService } from './auth.service';\n \n-export const authGuard: CanMatchFn|CanActivateFn|CanActivateChildFn = () => {\n+export const authGuard = () => {\n   const authService = inject(AuthService);\n   const router = inject(Router);\n \n\n---\n file path A: aio/content/examples/router/src/app/auth/auth.guard.ts | file path B: aio/content/examples/router/src/app/auth/auth.guard.ts\n\n@@ -1,16 +1,12 @@\n // #docplaster\n import { inject } from '@angular/core';\n import {\n-  CanActivateFn, CanMatchFn, Router,\n-  CanActivateChildFn,\n+  Router,\n   NavigationExtras,\n-  CanLoadFn, UrlTree\n } from '@angular/router';\n import { AuthService } from './auth.service';\n \n-// #docregion canLoad\n-export const authGuard: CanMatchFn|CanActivateChildFn|CanActivateFn|CanLoadFn = () => {\n-// #enddocregion canLoad\n+export const authGuard = () => {\n   const router = inject(Router);\n   const authService = inject(AuthService);\n \n\n---\n file path A: aio/content/examples/router/src/app/selective-preloading-strategy.service.ts | file path B: aio/content/examples/router/src/app/selective-preloading-strategy.service.ts\n\n@@ -10,7 +10,7 @@ export class SelectivePreloadingStrategyService implements PreloadingStrategy {\n   preloadedModules: string[] = [];\n \n   preload(route: Route, load: () => Observable<any>): Observable<any> {\n-    if (route.data?.['preload'] && route.path != null) {\n+    if (route.canMatch === undefined && route.data?.['preload'] && route.path != null) {\n       // add the route path to the preloaded module array\n       this.preloadedModules.push(route.path);\n \n\n---\n file path A: aio/content/guide/deprecations.md | file path B: aio/content/guide/deprecations.md\n\n@@ -116,6 +116,7 @@ v15 - v18\n | `@angular/core`                     | NgModule and `'any'` options for [`providedIn`](#core)                                                     | v15           | v17         |\n | `@angular/router`                   | [`RouterLinkWithHref` directive](#router)                                                                  | v15           | v17         |\n | `@angular/router`                   | [Router writeable properties](#router-writable-properties)                                                 | v15.1         | v17         |\n+| `@angular/router`                   | [Router CanLoad guards](#router-can-load)                                                 | v15.1         | v17         |\n \n ### Deprecated features with no planned removal version\n \n@@ -403,6 +404,14 @@ available in `provideRouter`:\n * `errorHandler` - Developers should instead subscribe to `Router.events`\n   and filter for `NavigationError`.\n \n+<a id=\"router-can-load\"></a>\n+\n+`CanLoad` guards in the Router are deprecated in favor of `CanMatch`. These guards execute at the same time\n+in the lifecycle of a navigation. A `CanMatch` guard which returns false will prevent the `Route` from being\n+matched at all and also prevent loading the children of the `Route`. `CanMatch` guards can accomplish the same\n+goals as `CanLoad` but with the addition of allowing the navigation to match other routes when they reject\n+(such as a wildcard route). There is no need to have both types of guards in the API surface.\n+\n <a id=\"relativeLinkResolution\"></a>\n \n The `relativeLinkResolution` option is deprecated and being removed.\n\n---\n file path A: aio/content/guide/router-tutorial-toh.md | file path B: aio/content/guide/router-tutorial-toh.md\n\n@@ -24,7 +24,7 @@ Along the way, it highlights key features of the router such as:\n *   The `canDeactivate` guard \\(ask permission to discard unsaved changes\\)\n *   The `resolve` guard \\(pre-fetching route data\\)\n *   Lazy loading an `NgModule`\n-*   The `canLoad` guard \\(check before loading feature module assets\\)\n+*   The `canMatch` guard \\(check before loading feature module assets\\)\n \n This guide proceeds as a sequence of milestones as if you were building the application step-by-step, but assumes you are familiar with basic [Angular concepts](guide/architecture).\n For a general introduction to angular, see the [Getting Started](start).\n@@ -1673,13 +1673,12 @@ The router supports multiple guard interfaces:\n | [`canActivateChild`](api/router/CanActivateChildFn) | To mediate navigation *to* a child route                            |\n | [`canDeactivate`](api/router/CanDeactivateFn)       | To mediate navigation *away* from the current route                 |\n | [`resolve`](api/router/ResolveFn)                   | To perform route data retrieval *before* route activation           |\n-| [`canLoad`](api/router/CanLoadFn)                   | To mediate navigation *to* a feature module loaded *asynchronously* |\n | [`canMatch`](api/router/CanMatchFn)                 | To control whether a `Route` should be used at all, even if the `path` matches the URL segment. |\n \n You can have multiple guards at every level of a routing hierarchy.\n The router checks the `canDeactivate` guards first, from the deepest child route to the top.\n Then it checks the `canActivate` and `canActivateChild` guards from the top down to the deepest child route.\n-If the feature module is loaded asynchronously, the `canLoad` guard is checked before the module is loaded.\n+If the feature module is loaded asynchronously, the `canMatch` guard is checked before the module is loaded.\n \n With the exception of `canMatch`, if *any* guard returns false, pending guards that have not completed are canceled, and the entire navigation is canceled. If a `canMatch` guard returns `false`, the `Router` continues\n processing the rest of the `Routes` to see if a different `Route` config matches the URL. You can think of this \n@@ -1946,16 +1945,6 @@ In `app.module.ts`, import and add the `AuthModule` to the `AppModule` imports.\n     <code-pane header=\"src/app/auth/auth.module.ts\" path=\"router/src/app/auth/auth.module.ts\"></code-pane>\n </code-tabs>\n \n-<a id=\"can-match-guard\"></a>\n-\n-### `canMatch`: Controlling `Route` matching based on application conditions\n-\n-As an alternative to using a `canActivate` guard which redirects the user to a new page if they do not have access, you can instead\n-use a `canMatch` guard to control whether the `Router` even attempts to activate a `Route`. This allows you to have\n-multiple `Route` configurations which share the same `path` but are matched based on different conditions. In addition, this approach\n-can allow the `Router` to match the wildcard `Route` instead.\n-\n-<code-example path=\"router/src/app/admin/admin-routing.module.2.ts\" header=\"src/app/admin/admin-routing.module.ts (guarded admin route)\" region=\"can-match\"></code-example>\n \n <a id=\"can-activate-child-guard\"></a>\n \n@@ -1968,13 +1957,6 @@ The key difference is that it runs before any child route is activated.\n You protected the admin feature module from unauthorized access.\n You should also protect child routes *within* the feature module.\n \n-Extend the `authGuard` to protect when navigating between the `admin` routes.\n-Open `auth.guard.ts` and add the `CanActivateChildFn` interface to the imported tokens from the router package.\n-\n-Next, indicate the method acts as a `canActivateChild` guard as well by adding `|CanActivateChildFn` to the type.\n-\n-<code-example header=\"src/app/auth/auth.guard.ts (excerpt)\" path=\"router/src/app/auth/auth.guard.3.ts\" region=\"can-activate-child\"></code-example>\n-\n Add the same `authGuard` to the `component-less` admin route to protect all other child routes at one time\n instead of adding the `authGuard` to each route individually.\n \n@@ -2275,9 +2257,9 @@ The root `AppModule` must neither load nor reference the `AdminModule` or its fi\n \n In `app.module.ts`, remove the `AdminModule` import statement from the top of the file and remove the `AdminModule` from the NgModule's `imports` array.\n \n-<a id=\"can-load-guard\"></a>\n+<a id=\"can-match-guard\"></a>\n \n-### `canLoad`: guarding unauthorized loading of feature modules\n+### `canMatch`: guarding unauthorized access of feature modules\n \n You're already protecting the `AdminModule` with a `canActivate` guard that prevents unauthorized users from accessing the admin feature area.\n It redirects to the login page if the user is not authorized.\n@@ -2285,17 +2267,13 @@ It redirects to the login page if the user is not authorized.\n But the router is still loading the `AdminModule` even if the user can't visit any of its components.\n Ideally, you'd only load the `AdminModule` if the user is logged in.\n \n-Add a `canLoad` guard that only loads the `AdminModule` once the user is logged in *and* attempts to access the admin feature area.\n+A `canMatch` guard controls whether the `Router` attempts to match a `Route`. This lets you have\n+multiple `Route` configurations that share the same `path` but are matched based on different conditions. This approach\n+allows the `Router` to match the wildcard `Route` instead.\n \n-The existing `authGuard` already has the essential logic to support the `canLoad` guard.\n+The existing `authGuard` contains the logic to support the `canMatch` guard.\n \n-1.  Open `auth.guard.ts`.\n-1.  Import the `CanLoadFn` interface from `@angular/router`.\n-1.  Add it to the `authGuard` function's type.\n-\n-<code-example header=\"src/app/auth/auth.guard.ts (canLoad guard)\" path=\"router/src/app/auth/auth.guard.ts\" region=\"canLoad\"></code-example>\n-\n-Now add the `authGuard` to the `canLoad` array property for the `admin` route.\n+Finally, add the `authGuard` to the `canMatch` array property for the `admin` route.\n The completed admin route looks like this:\n \n <code-example header=\"app-routing.module.ts (lazy admin route)\" path=\"router/src/app/app-routing.module.5.ts\" region=\"admin\"></code-example>\n@@ -2373,19 +2351,6 @@ This configures the `Router` preloader to immediately load all lazy loaded route\n \n When you visit `http://localhost:4200`, the `/heroes` route loads immediately upon launch and the router starts loading the `CrisisCenterModule` right after the `HeroesModule` loads.\n \n-Currently, the `AdminModule` does not preload because `canLoad` is blocking it.\n-\n-<a id=\"preload-canload\"></a>\n-\n-#### `canLoad` blocks preload of children\n-\n-The `PreloadAllModules` strategy does not load feature areas protected by a [canLoad](#can-load-guard) guard.\n-\n-You added a `canLoad` guard to the route in the `AdminModule` a few steps back to block loading of that module until the user is authorized.\n-That `canLoad` guard takes precedence over the preload strategy for loading children routes.\n-\n-If you want to preload a module as well as guard against unauthorized access, remove the `canLoad()` guard method and rely on the [canActivate()](#can-activate-guard) guard alone.\n-\n <a id=\"custom-preloading\"></a>\n \n ### Custom Preloading Strategy\n@@ -2423,7 +2388,9 @@ An implementation of `preload` must return an `Observable`.\n If the route does preload, it returns the observable returned by calling the loader function.\n If the route does not preload, it returns an `Observable` of `null`.\n \n-In this sample, the  `preload()` method loads the route if the route's `data.preload` flag is truthy.\n+In this sample, the  `preload()` method loads the route if the route's `data.preload` flag is truthy. We also skip loading the\n+`Route` if there is a `canMatch` guard because the user might\n+not have access to it.\n \n As a side effect, `SelectivePreloadingStrategyService` logs the `path` of a selected route in its public `preloadedModules` array.\n \n\n---\n file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -139,13 +139,13 @@ export interface CanDeactivate<T> {\n // @public\n export type CanDeactivateFn<T> = (component: T, currentRoute: ActivatedRouteSnapshot, currentState: RouterStateSnapshot, nextState: RouterStateSnapshot) => Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree;\n \n-// @public\n+// @public @deprecated\n export interface CanLoad {\n     // (undocumented)\n     canLoad(route: Route, segments: UrlSegment[]): Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree;\n }\n \n-// @public\n+// @public @deprecated\n export type CanLoadFn = (route: Route, segments: UrlSegment[]) => Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree;\n \n // @public\n@@ -610,6 +610,7 @@ export interface Route {\n     canActivate?: Array<CanActivateFn | any>;\n     canActivateChild?: Array<CanActivateChildFn | any>;\n     canDeactivate?: Array<CanDeactivateFn<any> | any>;\n+    // @deprecated\n     canLoad?: Array<CanLoadFn | any>;\n     canMatch?: Array<Type<CanMatch> | InjectionToken<CanMatchFn> | CanMatchFn>;\n     children?: Routes;\n\n---\n file path A: packages/router/src/models.ts | file path B: packages/router/src/models.ts\n\n@@ -553,6 +553,7 @@ export interface Route {\n    *\n    * When using a function rather than DI tokens, the function can call `inject` to get any required\n    * dependencies. This `inject` call must be done in a synchronous context.\n+   * @deprecated Use `canMatch` instead\n    */\n   canLoad?: Array<CanLoadFn|any>;\n   /**\n@@ -1196,6 +1197,7 @@ export type ResolveFn<T> = (route: ActivatedRouteSnapshot, state: RouterStateSna\n  * ```\n  *\n  * @publicApi\n+ * @deprecated Use `CanMatch` instead\n  */\n export interface CanLoad {\n   canLoad(route: Route, segments: UrlSegment[]):\n@@ -1208,6 +1210,8 @@ export interface CanLoad {\n  * @publicApi\n  * @see `CanLoad`\n  * @see `Route`\n+ * @see `CanMatchFn`\n+ * @deprecated Use `Route.canMatch` and `CanMatchFn` instead\n  */\n export type CanLoadFn = (route: Route, segments: UrlSegment[]) =>\n     Observable<boolean|UrlTree>|Promise<boolean|UrlTree>|boolean|UrlTree;\n\n\n###\n\n", "completion": "docs(router): Deprecate canLoad guards in favor of canMatch (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -24,7 +24,7 @@\n     \"smoke-tests\": \"protractor tests/deployment/e2e/protractor.conf.js --suite smoke --baseUrl\",\n     \"test-a11y-score\": \"bazel run //aio/scripts:test-aio-a11y\",\n     \"test-a11y-score-localhost\": \"bazel test //aio:test-a11y-score-localhost\",\n-    \"test-pwa-score\": \"sh -c 'bazel run //aio/scripts:audit-web-app ${0} ${1}'\",\n+    \"test-pwa-score\": \"sh -c 'bazel run //aio/scripts:audit-web-app ${0} all:0,pwa:${1}'\",\n     \"test-pwa-score-localhost\": \"bazel test //aio:test-pwa-score-localhost\",\n     \"example-e2e\": \"node --experimental-import-meta-resolve tools/examples/run-filtered-example-e2es.mjs\",\n     \"example-list-overrides\": \"bazel run //aio/tools/examples:example-boilerplate list-overrides\",\n\n\n###\n\n", "completion": "build(bazel): fix pwa test metrics"}
{"prompt": " file path A: aio/firebase.json | file path B: aio/firebase.json\n\n@@ -2,7 +2,7 @@\n   // Docs on Firebase hosting configuration: https://firebase.google.com/docs/hosting/full-config\n   \"hosting\": {\n     \"target\": \"aio\",\n-    \"public\": \"../dist/bin/aio/build\",\n+    \"public\": \"dist\",\n     \"cleanUrls\": true,\n     //////////////////////////////////////////////////////////////////////////////////////////////\n     // ADDING REDIRECTS\n\n---\n file path A: aio/scripts/deploy-to-firebase/index.mjs | file path B: aio/scripts/deploy-to-firebase/index.mjs\n\n@@ -384,6 +384,10 @@ function deploy(data) {\n   u.logSectionHeader('Run pre-deploy actions.');\n   preDeployActions.forEach(fn => fn(data));\n \n+  // Firebase requires that the distributable be in the same folder as firebase.json.\n+  u.logSectionHeader('Copy AIO distributable from Bazel output tree to aio/.');\n+  sh.cp('-rf', pre.DIST_DIR, 'dist');\n+\n   u.logSectionHeader('Deploy AIO to Firebase hosting.');\n   const firebase = cmd => u.yarn(`firebase ${cmd} --token \"${firebaseToken}\"`);\n   firebase(`use \"${projectId}\"`);\n\n---\n file path A: aio/scripts/deploy-to-firebase/pre-deploy-actions.mjs | file path B: aio/scripts/deploy-to-firebase/pre-deploy-actions.mjs\n\n@@ -14,6 +14,7 @@ const exp = {\n   build,\n   checkPayloadSize,\n   disableServiceWorker,\n+  DIST_DIR,\n   undo: {\n     build: undoBuild,\n     checkPayloadSize: undoCheckPayloadSize,\n\n\n###\n\n", "completion": "build(bazel): copy dist folder to aio for firebase deployment"}
{"prompt": " file path A: aio/firebase.json | file path B: aio/firebase.json\n\n@@ -2,7 +2,7 @@\n   // Docs on Firebase hosting configuration: https://firebase.google.com/docs/hosting/full-config\n   \"hosting\": {\n     \"target\": \"aio\",\n-    \"public\": \"dist\",\n+    \"public\": \"../dist/bin/aio/build\",\n     \"cleanUrls\": true,\n     //////////////////////////////////////////////////////////////////////////////////////////////\n     // ADDING REDIRECTS\n\n\n###\n\n", "completion": "build(bazel): point to correct dist folder in firebase config (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/annotations/common/src/diagnostics.ts | file path B: packages/compiler-cli/src/ngtsc/annotations/common/src/diagnostics.ts\n\n@@ -14,7 +14,7 @@ import {DirectiveMeta, flattenInheritedDirectiveMetadata, HostDirectiveMeta, Met\n import {describeResolvedType, DynamicValue, PartialEvaluator, ResolvedValue, traceDynamicValue} from '../../../partial_evaluator';\n import {ClassDeclaration, ReflectionHost} from '../../../reflection';\n import {DeclarationData, LocalModuleScopeRegistry} from '../../../scope';\n-import {identifierOfNode} from '../../../util/src/typescript';\n+import {identifierOfNode, isFromDtsFile} from '../../../util/src/typescript';\n \n import {InjectableClassRegistry} from './injectable_registry';\n import {isAbstractClassDeclaration, readBaseClass} from './util';\n@@ -256,6 +256,14 @@ export function checkInheritanceOfInjectable(\n     return getInheritedUndecoratedCtorDiagnostic(node, classWithCtor.ref, kind);\n   }\n \n+  if (isFromDtsFile(classWithCtor.ref.node)) {\n+    // The inherited class is declared in a declaration file, in which case there is not enough\n+    // information to detect invalid constructors as `@Inject()` metadata is not present in the\n+    // declaration file. Consequently, we have to accept such occurrences, although they might\n+    // still fail at runtime.\n+    return null;\n+  }\n+\n   if (!strictInjectionParameters || isAbstractClassDeclaration(node)) {\n     // An invalid constructor is only reported as error under `strictInjectionParameters` and\n     // only for concrete classes; follow the same exclusions for derived types.\n\n---\n file path A: packages/compiler-cli/test/ngtsc/ngtsc_spec.ts | file path B: packages/compiler-cli/test/ngtsc/ngtsc_spec.ts\n\n@@ -2960,6 +2960,37 @@ function allTests(os: string) {\n                   `or add an explicit constructor to ConcreteDirWithoutCtor.`);\n           expect(getDiagnosticSourceCode(diags[2])).toBe('ConcreteDirWithoutCtor');\n         });\n+\n+        // https://github.com/angular/angular/issues/48152\n+        it('should not give a compile-time error when a class inherits from foreign compilation unit',\n+           () => {\n+             env.tsconfig({strictInjectionParameters: true});\n+             env.write('node_modules/external/index.d.ts', `\n+               import * as i0 from '@angular/core';\n+\n+               export abstract class ExternalClass {\n+                 static \u0275prov: i0.\u0275\u0275InjectableDeclaration<ExternalClass>;\n+                 static \u0275fac: i0.\u0275\u0275FactoryDeclaration<ExternalClass, never>\n+\n+                 constructor(invalid: string) {}\n+               }\n+          `);\n+             env.write('test.ts', `\n+               import {Directive} from '@angular/core';\n+               import {ExternalClass} from 'external';\n+\n+               @Directive()\n+               export abstract class AbstractMiddleDir extends ExternalClass {}\n+\n+               @Directive()\n+               export class ConcreteMiddleDir extends AbstractMiddleDir {}\n+\n+               @Directive()\n+               export class ConcreteDirWithoutCtor extends ConcreteMiddleDir {}\n+             `);\n+\n+             env.driveMain();\n+           });\n       });\n \n       describe('with strictInjectionParameters = false', () => {\n\n\n###\n\n", "completion": "fix(compiler-cli): accept inheriting the constructor from a class in a library (#<issue-num>)"}
{"prompt": " file path A: aio/scripts/deploy-to-firebase/pre-deploy-actions.spec.mjs | file path B: aio/scripts/deploy-to-firebase/pre-deploy-actions.spec.mjs\n\n@@ -19,10 +19,12 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n \n   describe('build()', () => {\n     let cpSpy;\n+    let chmodSpy;\n     let yarnSpy;\n \n     beforeEach(() => {\n       cpSpy = spyOn(sh, 'cp');\n+      chmodSpy = spyOn(sh, 'chmod');\n       yarnSpy = spyOn(u, 'yarn');\n     });\n \n@@ -31,6 +33,11 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n       expect(yarnSpy).toHaveBeenCalledWith('build --aio_build_config=bar');\n     });\n \n+    it('should remove write protection from the dist folder', () => {\n+      pre.build({deployedUrl: 'http://example.com/foo/', deployEnv: 'bar'});\n+      expect(chmodSpy).toHaveBeenCalledWith('-R', 'u+w', '../dist/bin/aio/build');\n+    });\n+\n     it('should add mode-specific files into the distribution', () => {\n       pre.build({deployedUrl: 'http://example.com/foo/', deployEnv: 'bar'});\n       expect(cpSpy).toHaveBeenCalledWith('-rf', 'src/extra-files/bar/.', '../dist/bin/aio/build');\n\n\n###\n\n", "completion": "build(bazel): fix aio deployment unit tests"}
{"prompt": " file path A: aio/scripts/deploy-to-firebase/pre-deploy-actions.mjs | file path B: aio/scripts/deploy-to-firebase/pre-deploy-actions.mjs\n\n@@ -36,6 +36,9 @@ function build({deployedUrl, deployEnv}) {\n   u.logSectionHeader('Build the AIO app.');\n   u.yarn(`build --aio_build_config=${deployEnv}`);\n \n+  u.logSectionHeader('Remove write protection on the Bazel AIO distribution.');\n+  sh.chmod('-R', 'u+w', DIST_DIR);\n+\n   u.logSectionHeader('Add any mode-specific files into the AIO distribution.');\n   sh.cp('-rf', `src/extra-files/${deployEnv}/.`, DIST_DIR);\n \n\n\n###\n\n", "completion": "build(bazel): remove write protection on aio dist folder for deployment"}
{"prompt": " file path A: .github/workflows/scorecard.yml | file path B: .github/workflows/scorecard.yml\n\n@@ -30,7 +30,7 @@ jobs:\n           persist-credentials: false\n \n       - name: 'Run analysis'\n-        uses: ossf/scorecard-action@e363bfca00e752f91de7b7d2a77340e2e523cb18 # tag=v2.0.4\n+        uses: ossf/scorecard-action@99c53751e09b9529366343771cc321ec74e9bd3d # tag=v2.0.6\n         with:\n           results_file: results.sarif\n           results_format: sarif\n@@ -39,7 +39,7 @@ jobs:\n \n       # Upload the results as artifacts.\n       - name: 'Upload artifact'\n-        uses: actions/upload-artifact@3cea5372237819ed00197afe530f5a7ea3e805c8 # tag=v3.1.0\n+        uses: actions/upload-artifact@83fd05a356d7e2593de66fc9913b3002723633cb # tag=v3.1.1\n         with:\n           name: SARIF file\n           path: results.sarif\n@@ -47,6 +47,6 @@ jobs:\n \n       # Upload the results to GitHub's code scanning dashboard.\n       - name: 'Upload to code-scanning'\n-        uses: github/codeql-action/upload-sarif@807578363a7869ca324a79039e6db9c843e0e100 # tag=v2.1.27\n+        uses: github/codeql-action/upload-sarif@678fc3afe258fb2e0cdc165ccf77b85719de7b3c # tag=v2.1.33\n         with:\n           sarif_file: results.sarif\n\n\n###\n\n", "completion": "build: update scorecard action dependencies (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -92,8 +92,8 @@\n     \"@bazel/buildozer\": \"^5.1.0\",\n     \"@bazel/ibazel\": \"^0.16.2\",\n     \"@bazel/jasmine\": \"^5.4.1\",\n-    \"@bazel/runfiles\": \"5.4.2\",\n-    \"@bazel/typescript\": \"5.3.1\",\n+    \"@bazel/runfiles\": \"5.7.1\",\n+    \"@bazel/typescript\": \"5.7.1\",\n     \"@types/jasmine\": \"~4.3.0\",\n     \"@types/lunr\": \"^2.3.3\",\n     \"@types/node\": \"^12.7.9\",\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -1595,32 +1595,21 @@\n   resolved \"https://registry.yarnpkg.com/@bazel/protractor/-/protractor-5.5.4.tgz#f4acd761aa94cecb5799e4eb933570796d9c6773\"\n   integrity sha512-U0j43bxLXSXl0FFyCxT6hGPAfMg9fN9gSkRQnZZiEX2cEoqeJOBP4/6A6qYcl9esAQ4zIiNEzHhmDLpAWImVsA==\n \n-\"@bazel/runfiles@5.4.2\":\n-  version \"5.4.2\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/runfiles/-/runfiles-5.4.2.tgz#85d6ee8ab99c8a1ebe7b320b2bc452135c2ff30f\"\n-  integrity sha512-FfX+GeoeBcFP7JfsZN0T3cfFOpi80Nf9W9/g2U5pjcYay2Q06fmj3Fi3SVg+iyzjo+cbW9Sw/F3otCsvvZYPiw==\n-\n \"@bazel/runfiles@5.5.4\":\n   version \"5.5.4\"\n   resolved \"https://registry.yarnpkg.com/@bazel/runfiles/-/runfiles-5.5.4.tgz#20ce1395062c947dfa083a2ec79c5460e8b013ab\"\n   integrity sha512-LMw+i0VtI//+7lNNR0cKs3UgQlGprDJmh8QUu+2io7++MWt96Mqww08QOEvnuyuGpTEEgfU4EE14n4jSSZl2Aw==\n \n+\"@bazel/runfiles@5.7.1\":\n+  version \"5.7.1\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/runfiles/-/runfiles-5.7.1.tgz#1929078bebafcea7a813a0ea8db8720dcf67a6dd\"\n+  integrity sha512-lMovXi/ENs+I8OWcUwAiV+0ZAv5pZJfKM70i2KdVZ5vU3Roc+pgPntH77ArEcPfFh0bJjuiSAgidr6KAMdTZiQ==\n+\n \"@bazel/terser@5.5.4\":\n   version \"5.5.4\"\n   resolved \"https://registry.yarnpkg.com/@bazel/terser/-/terser-5.5.4.tgz#4304ca003a6606a22d3d2c0e28e4aa982a4ceb6b\"\n   integrity sha512-M+UncSFXmPo+c2uqFfXUrfpsx0mSb1PaMYWaXi1U484SIbAr135QLRShuPmuQGaAWr6Ec3VrFTJKbDHHgTFpwQ==\n \n-\"@bazel/typescript@5.3.1\":\n-  version \"5.3.1\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/typescript/-/typescript-5.3.1.tgz#f996abebfa57a29a170a83d0c84780286f06cb72\"\n-  integrity sha512-fP0fGzLbsOVdbAn6mlrX1LBAT0TJ+S0VVOap9SSSXCb2PknnKEHZupUww/raVSczy+cqcd/Vfpllzm/AcdOmyw==\n-  dependencies:\n-    \"@bazel/worker\" \"5.3.1\"\n-    protobufjs \"6.8.8\"\n-    semver \"5.6.0\"\n-    source-map-support \"0.5.9\"\n-    tsutils \"3.21.0\"\n-\n \"@bazel/typescript@5.5.4\":\n   version \"5.5.4\"\n   resolved \"https://registry.yarnpkg.com/@bazel/typescript/-/typescript-5.5.4.tgz#0e1ed2b930a98e88e471235fb90acd82121e0520\"\n@@ -1631,12 +1620,15 @@\n     source-map-support \"0.5.9\"\n     tsutils \"3.21.0\"\n \n-\"@bazel/worker@5.3.1\":\n-  version \"5.3.1\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/worker/-/worker-5.3.1.tgz#87d850fdfc22cde24f380961f66daa5cbfd4acf7\"\n-  integrity sha512-KB+Xs198NLhN01zhlOPr/VEmz/tzwGq/pI1gdnCTLDMTCspV6LnJaIeGgicXuKrzz0V1LhvlvsI5lqJt9yuGYw==\n+\"@bazel/typescript@5.7.1\":\n+  version \"5.7.1\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/typescript/-/typescript-5.7.1.tgz#e585bcdc54a4ccb23d99c3e1206abf4853cf0682\"\n+  integrity sha512-MAnAtFxA2znadm81+rbYXcyWX1DEF/urzZ1F4LBq+w27EQ4PGyqIqCM5om7JcoSZJwjjMoBJc3SflRsMrZZ6+g==\n   dependencies:\n-    google-protobuf \"^3.6.1\"\n+    \"@bazel/worker\" \"5.7.1\"\n+    semver \"5.6.0\"\n+    source-map-support \"0.5.9\"\n+    tsutils \"3.21.0\"\n \n \"@bazel/worker@5.5.4\":\n   version \"5.5.4\"\n@@ -1645,6 +1637,13 @@\n   dependencies:\n     google-protobuf \"^3.6.1\"\n \n+\"@bazel/worker@5.7.1\":\n+  version \"5.7.1\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/worker/-/worker-5.7.1.tgz#2c4a9bd0e0ef75e496aec9599ff64a87307e7dad\"\n+  integrity sha512-UndmQVRqK0t0NMNl8I1P5XmxzdPvMA0X6jufszpfwy5gyzjOxeiOIzmC0ALCOx78CuJqOB/8WOI1pwTRmhd0tg==\n+  dependencies:\n+    google-protobuf \"^3.6.1\"\n+\n \"@bcoe/v8-coverage@^0.2.3\":\n   version \"0.2.3\"\n   resolved \"https://registry.yarnpkg.com/@bcoe/v8-coverage/-/v8-coverage-0.2.3.tgz#75a2e8b51cb758a7553d6804a5932d7aace75c39\"\n\n---\n file path A: package.json | file path B: package.json\n\n@@ -68,14 +68,14 @@\n     \"@babel/template\": \"7.18.10\",\n     \"@babel/traverse\": \"7.19.4\",\n     \"@babel/types\": \"7.19.4\",\n-    \"@bazel/concatjs\": \"5.7.0\",\n-    \"@bazel/esbuild\": \"5.7.0\",\n-    \"@bazel/jasmine\": \"5.7.0\",\n-    \"@bazel/protractor\": \"5.7.0\",\n-    \"@bazel/rollup\": \"5.7.0\",\n-    \"@bazel/runfiles\": \"5.7.0\",\n-    \"@bazel/terser\": \"5.7.0\",\n-    \"@bazel/worker\": \"5.7.0\",\n+    \"@bazel/concatjs\": \"5.7.1\",\n+    \"@bazel/esbuild\": \"5.7.1\",\n+    \"@bazel/jasmine\": \"5.7.1\",\n+    \"@bazel/protractor\": \"5.7.1\",\n+    \"@bazel/rollup\": \"5.7.1\",\n+    \"@bazel/runfiles\": \"5.7.1\",\n+    \"@bazel/terser\": \"5.7.1\",\n+    \"@bazel/worker\": \"5.7.1\",\n     \"@microsoft/api-extractor\": \"^7.24.2\",\n     \"@rollup/plugin-babel\": \"^6.0.0\",\n     \"@rollup/plugin-commonjs\": \"^23.0.0\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -1899,10 +1899,10 @@\n     source-map-support \"0.5.9\"\n     tsutils \"3.21.0\"\n \n-\"@bazel/concatjs@5.7.0\":\n-  version \"5.7.0\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/concatjs/-/concatjs-5.7.0.tgz#ee9e2369ceabca7fdba9ee1539ddcdf0fc57a283\"\n-  integrity sha512-FlUthrDl9oq8HYP6mXVvhJ1dGCEgZ9TOsHJ6aab56bwBJWNDRwWuCYElozZO/Lgu7NB6GkD3CGG8HBjxYM+ZZg==\n+\"@bazel/concatjs@5.7.1\":\n+  version \"5.7.1\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/concatjs/-/concatjs-5.7.1.tgz#fe76bf0064382d7640651b210a97d5af35e50e39\"\n+  integrity sha512-h6PHntgP8PY5DOjl73zt4zeXcbRYX1Zk3vwpP/QYUk0APlwCHE3ZU+u7whrsV3LPAhlPg1c+t9cmHBxfmb2q7w==\n   dependencies:\n     protobufjs \"6.8.8\"\n     source-map-support \"0.5.9\"\n@@ -1913,20 +1913,20 @@\n   resolved \"https://registry.yarnpkg.com/@bazel/esbuild/-/esbuild-5.5.4.tgz#d08b3f8127d3efb1085dce2f7039969fcb61b113\"\n   integrity sha512-C9R5hTgYmP/GU7yNzgOus6SaS7tyS5J5ptWruM3ERKaw5CIEPTi0hlBLmPpM9Wo8xIDNlF0BhGvM59T7bKs2iQ==\n \n-\"@bazel/esbuild@5.7.0\":\n-  version \"5.7.0\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/esbuild/-/esbuild-5.7.0.tgz#8eb01e18994553f24e08df175fd43d0298bfc51d\"\n-  integrity sha512-5QQVa9gZ7sOVA7b9HdSXLvDuZ8crqubGJkEsNUjSh1pSzHuyMIqKYbYaEhCFrhfk4M/XoTy/BkIER0bJSZYjMw==\n+\"@bazel/esbuild@5.7.1\":\n+  version \"5.7.1\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/esbuild/-/esbuild-5.7.1.tgz#3e72ad6d71ab868429a7f02f914bba8958c2e05e\"\n+  integrity sha512-mNi5AaXQ5h6kwIkgXCtwZIvzhf+iEgj54PS4riHyWmk3qwFa+XqgLK+b//9tdjNVtisrIoyiZ0+J2Q6dU5YQsA==\n \n \"@bazel/ibazel@^0.16.0\":\n   version \"0.16.2\"\n   resolved \"https://registry.yarnpkg.com/@bazel/ibazel/-/ibazel-0.16.2.tgz#05dd7f06659759fda30f87b15534f1e42f1201bb\"\n   integrity sha512-KgqAWMH0emL6f3xH6nqyTryoBMqlJ627LBIe9PT1PRRQPz2FtHib3FIHJPukp1slzF3hJYZvdiVwgPnHbaSOOA==\n \n-\"@bazel/jasmine@5.7.0\":\n-  version \"5.7.0\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/jasmine/-/jasmine-5.7.0.tgz#85b136f0e671e17d7907ab7bc725648c3267dc1d\"\n-  integrity sha512-ZUFyNk1PxMtbeQkF3JshuOpdEpNczKLP2es70Kp7oLZfPQ5DySpGX07utuM/o3gkawdZGVtRMFF+UbQa/wG5mA==\n+\"@bazel/jasmine@5.7.1\":\n+  version \"5.7.1\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/jasmine/-/jasmine-5.7.1.tgz#114797c8c2871255d32e2c154f7e354028efbdcc\"\n+  integrity sha512-OZ3u8CuC1HBv7Ph3Io46A1sRA9pSGHrbrFE/VbZGzPPLd2epyi4EvKnhrrRXpw1/jZ+0z5DXeLbnk6uJOvIuRw==\n   dependencies:\n     c8 \"~7.5.0\"\n     jasmine-reporters \"~2.5.0\"\n@@ -1936,37 +1936,37 @@\n   resolved \"https://registry.yarnpkg.com/@bazel/protractor/-/protractor-5.5.4.tgz#f4acd761aa94cecb5799e4eb933570796d9c6773\"\n   integrity sha512-U0j43bxLXSXl0FFyCxT6hGPAfMg9fN9gSkRQnZZiEX2cEoqeJOBP4/6A6qYcl9esAQ4zIiNEzHhmDLpAWImVsA==\n \n-\"@bazel/protractor@5.7.0\":\n-  version \"5.7.0\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/protractor/-/protractor-5.7.0.tgz#b367a5c24bad3dbfe833ab4747013cb741602130\"\n-  integrity sha512-I5N9SFf5xY8XQyIiBRGKAsTn284+pRVWqdrtICk8KehPjcRjEX/sB78Tsw02XB3ZmMw7pIrofu2HPXlGftzQIg==\n+\"@bazel/protractor@5.7.1\":\n+  version \"5.7.1\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/protractor/-/protractor-5.7.1.tgz#4f9e95ea7b54e02910efdc52807bfaf226cb303e\"\n+  integrity sha512-zskjl1yBVNTUPcdxmvi13h2+KT9YY/1+7SSaG/PkutmZVeJhp9JL2s43Rdp2DQhjVaWhTDWNHyRur6dSMImmVg==\n \n-\"@bazel/rollup@5.7.0\":\n-  version \"5.7.0\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/rollup/-/rollup-5.7.0.tgz#13ac4e739465ffd0898d5d5f821c03fc2d4e6f4d\"\n-  integrity sha512-v53T4uixMzFFRtjZ25T66OQBG9/eB/TU0/0ELSed77yiVwD+9APgK2U54vVCcDQB7y83uCi+xORpZxmET1OGqw==\n+\"@bazel/rollup@5.7.1\":\n+  version \"5.7.1\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/rollup/-/rollup-5.7.1.tgz#6f644c2d493a5bd9cd3724a6f239e609585c6e37\"\n+  integrity sha512-LLNogoK2Qx9GIJVywQ+V/czjud8236mnaRX//g7qbOyXoWZDQvAEgsxRHq+lS/XX9USbh+zJJlfb+Dfp/PXx4A==\n   dependencies:\n-    \"@bazel/worker\" \"5.7.0\"\n+    \"@bazel/worker\" \"5.7.1\"\n \n \"@bazel/runfiles@5.5.4\":\n   version \"5.5.4\"\n   resolved \"https://registry.yarnpkg.com/@bazel/runfiles/-/runfiles-5.5.4.tgz#20ce1395062c947dfa083a2ec79c5460e8b013ab\"\n   integrity sha512-LMw+i0VtI//+7lNNR0cKs3UgQlGprDJmh8QUu+2io7++MWt96Mqww08QOEvnuyuGpTEEgfU4EE14n4jSSZl2Aw==\n \n-\"@bazel/runfiles@5.7.0\":\n-  version \"5.7.0\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/runfiles/-/runfiles-5.7.0.tgz#e0ea75267808f78d0dedaff5e772e6a088250d8f\"\n-  integrity sha512-BfmbGuMpqkBNtAmllCrl70YAHo6OrCtcGzakV6KMBUBXzeGl22qRWHFhDvoWgeMKTjhbcywMooPg2Udq9MoVfQ==\n+\"@bazel/runfiles@5.7.1\":\n+  version \"5.7.1\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/runfiles/-/runfiles-5.7.1.tgz#1929078bebafcea7a813a0ea8db8720dcf67a6dd\"\n+  integrity sha512-lMovXi/ENs+I8OWcUwAiV+0ZAv5pZJfKM70i2KdVZ5vU3Roc+pgPntH77ArEcPfFh0bJjuiSAgidr6KAMdTZiQ==\n \n \"@bazel/terser@5.5.4\":\n   version \"5.5.4\"\n   resolved \"https://registry.yarnpkg.com/@bazel/terser/-/terser-5.5.4.tgz#4304ca003a6606a22d3d2c0e28e4aa982a4ceb6b\"\n   integrity sha512-M+UncSFXmPo+c2uqFfXUrfpsx0mSb1PaMYWaXi1U484SIbAr135QLRShuPmuQGaAWr6Ec3VrFTJKbDHHgTFpwQ==\n \n-\"@bazel/terser@5.7.0\":\n-  version \"5.7.0\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/terser/-/terser-5.7.0.tgz#0b47c950fd1f7355ba98eb013683d399f1f5f106\"\n-  integrity sha512-oCsRtQjkCXJlisXXuM5bQjrvS12Y5HUWPAEOP1E3PjobTsMf9wxUpvrTMYi+vDt9F+6qpU25ooiPegY6SFV5qA==\n+\"@bazel/terser@5.7.1\":\n+  version \"5.7.1\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/terser/-/terser-5.7.1.tgz#2f247472d65fd53350f1366009b8c5245e23f705\"\n+  integrity sha512-WAy2LG7lU6M4CLHBe7UWAFpILCb0k4KpLnBp8uiQFCovSYgmhB7kThWGNwkx/dgmr8mI+aSZ8tBcv0CQc+C0ZQ==\n \n \"@bazel/typescript@5.5.4\":\n   version \"5.5.4\"\n@@ -1985,10 +1985,10 @@\n   dependencies:\n     google-protobuf \"^3.6.1\"\n \n-\"@bazel/worker@5.7.0\":\n-  version \"5.7.0\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/worker/-/worker-5.7.0.tgz#d121261ee1833c5f5858f818f0e4d9a2d8e2c3c5\"\n-  integrity sha512-VqTG+0gsgXM07q+HiQcSAggNnAzjLei8lzlJQ+mey12KGI4AbNJ1vxlk2pnw9BZdckfe2rRzwkF44B5SNqIgSQ==\n+\"@bazel/worker@5.7.1\":\n+  version \"5.7.1\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/worker/-/worker-5.7.1.tgz#2c4a9bd0e0ef75e496aec9599ff64a87307e7dad\"\n+  integrity sha512-UndmQVRqK0t0NMNl8I1P5XmxzdPvMA0X6jufszpfwy5gyzjOxeiOIzmC0ALCOx78CuJqOB/8WOI1pwTRmhd0tg==\n   dependencies:\n     google-protobuf \"^3.6.1\"\n \n\n\n###\n\n", "completion": "build: update bazel setup to v5.7.1 (#<issue-num>)"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -210,10 +210,10 @@ cldr_xml_data_repository(\n # sass rules\n http_archive(\n     name = \"io_bazel_rules_sass\",\n-    sha256 = \"0cde2dd9ff34994f27ba4d5c74d34cca3c727bf41bc6024cf66ad298a1f5e5c2\",\n-    strip_prefix = \"rules_sass-f6ceac7f5e11424880ae41f9c1a5cfd02968376c\",\n+    sha256 = \"618f0b7aae019c149ac2ff4142a66c110de116fb5c173dbeccedbaee06fc5f6d\",\n+    strip_prefix = \"rules_sass-a2fce75bcf103750f7accbf7f966ad48bcbca2d4\",\n     urls = [\n-        \"https://github.com/bazelbuild/rules_sass/archive/f6ceac7f5e11424880ae41f9c1a5cfd02968376c.zip\",\n+        \"https://github.com/bazelbuild/rules_sass/archive/a2fce75bcf103750f7accbf7f966ad48bcbca2d4.zip\",\n     ],\n )\n \n\n\n###\n\n", "completion": "build: update io_bazel_rules_sass digest to a2fce75 (#<issue-num>)"}
{"prompt": " file path A: aio/scripts/deploy-to-firebase/pre-deploy-actions.spec.mjs | file path B: aio/scripts/deploy-to-firebase/pre-deploy-actions.spec.mjs\n\n@@ -33,7 +33,7 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n \n     it('should add mode-specific files into the distribution', () => {\n       pre.build({deployedUrl: 'http://example.com/foo/', deployEnv: 'bar'});\n-      expect(cpSpy).toHaveBeenCalledWith('-rf', 'src/extra-files/bar/.', 'dist/bin/aio/build');\n+      expect(cpSpy).toHaveBeenCalledWith('-rf', 'src/extra-files/bar/.', '../dist/bin/aio/build');\n     });\n \n     it('should update the opensearch descriptor', () => {\n@@ -57,7 +57,7 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n       pre.build({deployedUrl: 'http://example.com/foo/', deployEnv: 'bar'});\n       expect(logs).toEqual([\n         'yarn build --aio_build_config=bar',\n-        'cp -rf src/extra-files/bar/. dist/bin/aio/build',\n+        'cp -rf src/extra-files/bar/. ../dist/bin/aio/build',\n         'yarn set-opensearch-url http://example.com/foo/',\n       ]);\n     });\n@@ -81,8 +81,8 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n \n     it('should disable the ServiceWorker by renaming the `ngsw.json` manifest', () => {\n       pre.disableServiceWorker();\n-      expect(mvSpy).toHaveBeenCalledWith('dist/bin/aio/build/ngsw.json',\n-          'dist/bin/aio/build/ngsw.json.bak');\n+      expect(mvSpy).toHaveBeenCalledWith('../dist/bin/aio/build/ngsw.json',\n+          '../dist/bin/aio/build/ngsw.json.bak');\n     });\n   });\n \n@@ -149,7 +149,7 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n \n     it('should undo `build()`', () => {\n       pre.undo.build();\n-      expect(rmSpy).toHaveBeenCalledWith('-rf', 'dist/bin/aio/build');\n+      expect(rmSpy).toHaveBeenCalledWith('-rf', '../dist/bin/aio/build');\n     });\n   });\n \n@@ -165,8 +165,8 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n \n     it('should undo `disableServiceWorker()`', () => {\n       pre.undo.disableServiceWorker();\n-      expect(mvSpy).toHaveBeenCalledWith('dist/bin/aio/build/ngsw.json.bak',\n-          'dist/bin/aio/build/ngsw.json');\n+      expect(mvSpy).toHaveBeenCalledWith('../dist/bin/aio/build/ngsw.json.bak',\n+          '../dist/bin/aio/build/ngsw.json');\n     });\n   });\n \n\n\n###\n\n", "completion": "build(bazel): fix AIO deployment unit tests (#<issue-num>)"}
{"prompt": " file path A: aio/scripts/deploy-to-firebase/pre-deploy-actions.mjs | file path B: aio/scripts/deploy-to-firebase/pre-deploy-actions.mjs\n\n@@ -4,7 +4,7 @@ import u from './utils.mjs';\n \n \n // Constants\n-const DIST_DIR = 'dist/bin/aio/build';\n+const DIST_DIR = '../dist/bin/aio/build';\n const FIREBASE_JSON_PATH = 'firebase.json';\n const NGSW_JSON_PATH = `${DIST_DIR}/ngsw.json`;\n const NGSW_JSON_BAK_PATH = `${NGSW_JSON_PATH}.bak`;\n\n\n###\n\n", "completion": "build(bazel): fix dist dir in AIO deploy script (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -74,7 +74,7 @@\n     \"@angular/router\": \"15.0.0\",\n     \"@angular/service-worker\": \"15.0.0\",\n     \"rxjs\": \"~7.5.0\",\n-    \"safevalues\": \"^0.3.1\",\n+    \"safevalues\": \"^0.4.2\",\n     \"tslib\": \"^2.3.0\",\n     \"zone.js\": \"~0.11.4\"\n   },\n\n---\n file path A: aio/src/app/shared/custom-icon-registry.spec.ts | file path B: aio/src/app/shared/custom-icon-registry.spec.ts\n\n@@ -2,8 +2,7 @@ import { HttpClient } from '@angular/common/http';\n import { ErrorHandler } from '@angular/core';\n import { MatIconRegistry } from '@angular/material/icon';\n import { DomSanitizer } from '@angular/platform-browser';\n-import { unwrapHtml } from 'safevalues';\n-import { concatHtmls } from 'safevalues/builders/html_builders';\n+import { unwrapHtml, concatHtmls } from 'safevalues';\n import { CustomIconRegistry, SvgIconInfo } from './custom-icon-registry';\n import { svg } from './security';\n \n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -11769,10 +11769,10 @@ safeps@7.0.1:\n   resolved \"https://registry.yarnpkg.com/safer-buffer/-/safer-buffer-2.1.2.tgz#44fa161b0187b9549dd84bb91802f9bd8385cd6a\"\n   integrity sha512-YZo3K82SD7Riyi0E1EQPojLz7kpepnSQI9IyPbHHg1XXXevb5dJI7tpyN2ADxGcQbHG7vcyRHk0cbwqcQriUtg==\n \n-safevalues@^0.3.1:\n-  version \"0.3.4\"\n-  resolved \"https://registry.yarnpkg.com/safevalues/-/safevalues-0.3.4.tgz#82e846a02b6956d7d40bf9f41e92e13fce0186db\"\n-  integrity sha512-LRneZZRXNgjzwG4bDQdOTSbze3fHm1EAKN/8bePxnlEZiBmkYEDggaHbuvHI9/hoqHbGfsEA7tWS9GhYHZBBsw==\n+safevalues@^0.4.2:\n+  version \"0.4.2\"\n+  resolved \"https://registry.yarnpkg.com/safevalues/-/safevalues-0.4.2.tgz#d2fdb3bcf15b2040868bcc4a6d9aa89958514cda\"\n+  integrity sha512-TYFWXLvMchkKd0Kwt2nMTWUeNqCfnUFBr93khoOGcXRsimtHtwe+RAsy5Diib2gD8saSRf5ABILQNARv7Q3q5Q==\n \n sass-loader@13.0.2:\n   version \"13.0.2\"\n\n---\n file path A: goldens/size-tracking/aio-payloads.json | file path B: goldens/size-tracking/aio-payloads.json\n\n@@ -2,7 +2,7 @@\n   \"aio\": {\n     \"uncompressed\": {\n       \"runtime\": 4325,\n-      \"main\": 471785,\n+      \"main\": 455845,\n       \"polyfills\": 33922,\n       \"styles\": 73964,\n       \"light-theme\": 78157,\n@@ -12,7 +12,7 @@\n   \"aio-local\": {\n     \"uncompressed\": {\n       \"runtime\": 4325,\n-      \"main\": 471633,\n+      \"main\": 455789,\n       \"polyfills\": 33952,\n       \"styles\": 73964,\n       \"light-theme\": 78157,\n\n\n###\n\n", "completion": "build: update `safevalues` to `0.4.2` (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/typecheck/api/scope.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/api/scope.ts\n\n@@ -50,7 +50,7 @@ export interface PotentialDirective {\n   /**\n    * The selector for the directive or component.\n    */\n-  selector: string;\n+  selector: string|null;\n \n   /**\n    * `true` if this directive is a component.\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/src/checker.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/src/checker.ts\n\n@@ -611,6 +611,10 @@ export class TemplateTypeCheckerImpl implements TemplateTypeChecker {\n     const scope = this.getScopeData(component);\n     if (scope !== null) {\n       for (const directive of scope.directives) {\n+        if (directive.selector === null) {\n+          continue;\n+        }\n+\n         for (const selector of CssSelector.parse(directive.selector)) {\n           if (selector.element === null || tagMap.has(selector.element)) {\n             // Skip this directive if it doesn't match an element tag, or if another directive has\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/src/template_symbol_builder.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/src/template_symbol_builder.ts\n\n@@ -180,9 +180,7 @@ export class SymbolBuilder {\n           tsSymbol: symbol.tsSymbol,\n           exposedInputs: current.inputs,\n           exposedOutputs: current.outputs,\n-          // TODO(crisbeto): rework `DirectiveSymbol` to make\n-          // `selector` nullable and remove the `|| ''` here.\n-          selector: meta.selector || '',\n+          selector: meta.selector,\n           isComponent: meta.isComponent,\n           ngModule: this.getDirectiveModule(current.directive.node),\n           kind: SymbolKind.Directive,\n\n---\n file path A: packages/language-service/src/utils.ts | file path B: packages/language-service/src/utils.ts\n\n@@ -10,7 +10,7 @@ import {NgCompiler} from '@angular/compiler-cli/src/ngtsc/core';\n import {absoluteFrom, absoluteFromSourceFile, AbsoluteFsPath} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {isExternalResource} from '@angular/compiler-cli/src/ngtsc/metadata';\n import {DeclarationNode} from '@angular/compiler-cli/src/ngtsc/reflection';\n-import {DirectiveSymbol, PotentialDirective, TemplateTypeChecker} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n+import {DirectiveSymbol, TemplateTypeChecker} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n import * as e from '@angular/compiler/src/expression_parser/ast';  // e for expression AST\n import * as t from '@angular/compiler/src/render3/r3_ast';         // t for template AST\n import ts from 'typescript';\n@@ -224,7 +224,7 @@ function difference<T>(left: Set<T>, right: Set<T>): Set<T> {\n  * @returns The list of directives matching the tag name via the strategy described above.\n  */\n // TODO(atscott): Add unit tests for this and the one for attributes\n-export function getDirectiveMatchesForElementTag<T extends {selector: string}>(\n+export function getDirectiveMatchesForElementTag<T extends {selector: string | null}>(\n     element: t.Template|t.Element, directives: T[]): Set<T> {\n   const attributes = getAttributes(element);\n   const allAttrs = attributes.map(toAttributeCssSelector);\n@@ -269,7 +269,7 @@ export function getDirectiveMatchesForAttribute(\n  * Given a list of directives and a text to use as a selector, returns the directives which match\n  * for the selector.\n  */\n-function getDirectiveMatchesForSelector<T extends {selector: string}>(\n+function getDirectiveMatchesForSelector<T extends {selector: string | null}>(\n     directives: T[], selector: string): Set<T> {\n   try {\n     const selectors = CssSelector.parse(selector);\n\n\n###\n\n", "completion": "refactor(language-service): make selector nullable (#<issue-num>)"}
{"prompt": " file path A: .bazelrc | file path B: .bazelrc\n\n@@ -61,6 +61,15 @@ build:aio_local_deps --workspace_status_command=\"yarn -s --cwd aio local-workspa\n build:snapshot-build --workspace_status_command=\"yarn -s ng-dev release build-env-stamp --mode=snapshot\"\n build:snapshot-build --stamp\n \n+##########################################################\n+# AIO architect build configuration                      #\n+# See aio/angular.json for available configurations.     #\n+# To build with a partiular configuration:               #\n+#   bazel build //aio:build --aio_build_config=<config>  #\n+# Default config is `stable``.                           #\n+##########################################################\n+build --flag_alias=aio_build_config=//aio:flag_aio_build_config\n+\n ####################################\n # AIO first party dep substitution # \n # Turn on with                     #\n\n---\n file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -3,7 +3,7 @@ load(\"@build_bazel_rules_nodejs//:index.bzl\", \"copy_to_bin\", \"npm_package_bin\")\n load(\"//tools:defaults.bzl\", \"nodejs_binary\")\n load(\"@aspect_bazel_lib//lib:copy_to_directory.bzl\", \"copy_to_directory\")\n load(\":local_packages_util.bzl\", \"link_local_packages\", \"substitute_local_package_deps\")\n-load(\"@bazel_skylib//rules:common_settings.bzl\", \"bool_flag\")\n+load(\"@bazel_skylib//rules:common_settings.bzl\", \"bool_flag\", \"string_flag\")\n load(\"//aio/scripts:local_server_test.bzl\", \"local_server_test\")\n load(\"@aio_npm//@angular/build-tooling/bazel/remote-execution:index.bzl\", \"ENABLE_NETWORK\")\n load(\":aio_targets.bzl\", \"aio_test\")\n@@ -29,6 +29,46 @@ config_setting(\n     },\n )\n \n+# Config setting controlling the AIO architect configuration to build with\n+string_flag(\n+    name = \"flag_aio_build_config\",\n+    build_setting_default = \"stable\",\n+    values = [\n+        \"stable\",\n+        \"rc\",\n+        \"next\",\n+        \"archive\",\n+    ],\n+)\n+\n+config_setting(\n+    name = \"aio_build_config_stable\",\n+    flag_values = {\n+        \":flag_aio_build_config\": \"stable\",\n+    },\n+)\n+\n+config_setting(\n+    name = \"aio_build_config_rc\",\n+    flag_values = {\n+        \":flag_aio_build_config\": \"rc\",\n+    },\n+)\n+\n+config_setting(\n+    name = \"aio_build_config_next\",\n+    flag_values = {\n+        \":flag_aio_build_config\": \"next\",\n+    },\n+)\n+\n+config_setting(\n+    name = \"aio_build_config_archive\",\n+    flag_values = {\n+        \":flag_aio_build_config\": \"archive\",\n+    },\n+)\n+\n # Run dgeni generation\n npm_package_bin(\n     name = \"dgeni\",\n@@ -186,8 +226,12 @@ copy_to_bin(\n \n architect(\n     name = \"build-app\",\n-    args = [\n-        \"site:build:stable\",\n+    args = select({\n+        \":aio_build_config_stable\": [\"site:build:stable\"],\n+        \":aio_build_config_next\": [\"site:build:next\"],\n+        \":aio_build_config_rc\": [\"site:build:rc\"],\n+        \":aio_build_config_archive\": [\"site:build:archive\"],\n+    }) + [\n         \"--output-path=build-app\",\n     ],\n     chdir = \"$(RULEDIR)\",\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -30,7 +30,7 @@\n     \"example-list-overrides\": \"bazel run //aio/tools/examples:example-boilerplate list-overrides\",\n     \"example-lint\": \"eslint content/examples\",\n     \"example-playground\": \"node ./tools/examples/create-example-playground-wrapper.mjs\",\n-    \"deploy-production\": \"bazel run //aio/scripts/deploy-to-firebase --config=release\",\n+    \"deploy-production\": \"node ./scripts/deploy-to-firebase/index.mjs\",\n     \"check-env\": \"yarn ~~check-env\",\n     \"payload-size\": \"scripts/payload.sh\",\n     \"predocs\": \"node scripts/contributors/validate-data && bazel build -- //aio:stackblitz //aio:example-zips\",\n@@ -169,4 +169,4 @@\n     \"xregexp\": \"^5.0.2\",\n     \"yargs\": \"^17.0.0\"\n   }\n-}\n\\ No newline at end of file\n+}\n\n---\n file path A: aio/scripts/deploy-to-firebase/BUILD.bazel | file path B: aio/scripts/deploy-to-firebase/BUILD.bazel\n\n@@ -1,7 +1,5 @@\n load(\"@aio_npm//@bazel/jasmine:index.bzl\", \"jasmine_node_test\")\n-load(\"//tools:defaults.bzl\", \"nodejs_binary\")\n load(\"@aio_npm//@angular/build-tooling/bazel/remote-execution:index.bzl\", \"ENABLE_NETWORK\")\n-load(\"//:yarn.bzl\", \"YARN_LABEL\")\n \n DEPLOY_TO_FIREBASE_SOURCES = glob(\n     [\"**/*.mjs\"],\n@@ -12,18 +10,8 @@ DEPLOY_TO_FIREBASE_DEPS = [\n     \"@aio_npm//shelljs\",\n     \"//aio:build\",\n     \"//:package.json\",\n-    YARN_LABEL,\n ]\n \n-nodejs_binary(\n-    name = \"deploy-to-firebase\",\n-    data = DEPLOY_TO_FIREBASE_SOURCES + DEPLOY_TO_FIREBASE_DEPS,\n-    entry_point = \"index.mjs\",\n-    env = {\n-        \"YARN_BIN\": \"$(rootpath %s)\" % YARN_LABEL,\n-    },\n-)\n-\n jasmine_node_test(\n     name = \"test\",\n     srcs = glob([\"**/*.spec.mjs\"]),\n\n---\n file path A: aio/scripts/deploy-to-firebase/index.mjs | file path B: aio/scripts/deploy-to-firebase/index.mjs\n\n@@ -50,6 +50,7 @@\n \n import path from 'path';\n import sh from 'shelljs';\n+import {fileURLToPath} from 'url';\n import post from './post-deploy-actions.mjs';\n import pre from './pre-deploy-actions.mjs';\n import u from './utils.mjs';\n@@ -58,9 +59,11 @@ sh.set('-e');\n \n \n // Constants\n-const RUNFILES_ROOT = process.cwd();\n-const DIRNAME = path.join(RUNFILES_ROOT, 'aio', 'scripts', 'deploy-to-firebase');\n-const ROOT_PKG_PATH = path.join(RUNFILES_ROOT, 'package.json');\n+const inBazelTest = !!process.env.TEST_SRCDIR;\n+const DIRNAME = !inBazelTest\n+  ? u.getDirname(import.meta.url)\n+  : path.join('.', 'aio', 'scripts', 'deploy-to-firebase');\n+const ROOT_PKG_PATH = `${DIRNAME}/../../../package.json`;\n \n // Exports\n export {\n@@ -75,7 +78,9 @@ export {\n // references the full file path (including the file extension).\n // See https://stackoverflow.com/questions/45136831/node-js-require-main-module#answer-60309682 for\n // more details.\n-if (path.resolve(DIRNAME, 'index.mjs') === process.argv[1]) {\n+const isMain = inBazelTest ||\n+  (fileURLToPath(import.meta.url) === process.argv[1]);\n+if (isMain) {\n   const isDryRun = process.argv[2] === '--dry-run';\n   const inputVars = computeInputVars(process.env);\n   const deploymentsInfo = computeDeploymentsInfo(inputVars);\n\n---\n file path A: aio/scripts/deploy-to-firebase/index.spec.mjs | file path B: aio/scripts/deploy-to-firebase/index.spec.mjs\n\n@@ -585,7 +585,11 @@ describe('deploy-to-firebase:', () => {\n       CI_BRANCH: '4.4.x',\n       CI_STABLE_BRANCH: mostRecentMinorBranch,\n       CI_COMMIT: latestCommits['4.4.x'],\n+      // Pass along this Bazel test env var as it's used\n+      // by the script to determine if it's in a test.\n+      TEST_SRCDIR: process.env.TEST_SRCDIR,\n     };\n+\n     const result = execSync(cmd, {encoding: 'utf8', env}).trim();\n     expect(result).toBe(\n         'Deployments (1): archive\\n' +\n\n---\n file path A: aio/scripts/deploy-to-firebase/pre-deploy-actions.mjs | file path B: aio/scripts/deploy-to-firebase/pre-deploy-actions.mjs\n\n@@ -4,7 +4,7 @@ import u from './utils.mjs';\n \n \n // Constants\n-const DIST_DIR = 'dist';\n+const DIST_DIR = 'dist/bin/aio/build';\n const FIREBASE_JSON_PATH = 'firebase.json';\n const NGSW_JSON_PATH = `${DIST_DIR}/ngsw.json`;\n const NGSW_JSON_BAK_PATH = `${NGSW_JSON_PATH}.bak`;\n@@ -34,7 +34,7 @@ export default exp;\n // Helpers\n function build({deployedUrl, deployEnv}) {\n   u.logSectionHeader('Build the AIO app.');\n-  u.yarn(`build --configuration=${deployEnv} --progress=false`);\n+  u.yarn(`build --aio_build_config=${deployEnv}`);\n \n   u.logSectionHeader('Add any mode-specific files into the AIO distribution.');\n   sh.cp('-rf', `src/extra-files/${deployEnv}/.`, DIST_DIR);\n\n---\n file path A: aio/scripts/deploy-to-firebase/pre-deploy-actions.spec.mjs | file path B: aio/scripts/deploy-to-firebase/pre-deploy-actions.spec.mjs\n\n@@ -28,12 +28,12 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n \n     it('should build the app for the appropriate mode', () => {\n       pre.build({deployedUrl: 'http://example.com/foo/', deployEnv: 'bar'});\n-      expect(yarnSpy).toHaveBeenCalledWith('build --configuration=bar --progress=false');\n+      expect(yarnSpy).toHaveBeenCalledWith('build --aio_build_config=bar');\n     });\n \n     it('should add mode-specific files into the distribution', () => {\n       pre.build({deployedUrl: 'http://example.com/foo/', deployEnv: 'bar'});\n-      expect(cpSpy).toHaveBeenCalledWith('-rf', 'src/extra-files/bar/.', 'dist');\n+      expect(cpSpy).toHaveBeenCalledWith('-rf', 'src/extra-files/bar/.', 'dist/bin/aio/build');\n     });\n \n     it('should update the opensearch descriptor', () => {\n@@ -56,8 +56,8 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n \n       pre.build({deployedUrl: 'http://example.com/foo/', deployEnv: 'bar'});\n       expect(logs).toEqual([\n-        'yarn build --configuration=bar --progress=false',\n-        'cp -rf src/extra-files/bar/. dist',\n+        'yarn build --aio_build_config=bar',\n+        'cp -rf src/extra-files/bar/. dist/bin/aio/build',\n         'yarn set-opensearch-url http://example.com/foo/',\n       ]);\n     });\n@@ -81,7 +81,8 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n \n     it('should disable the ServiceWorker by renaming the `ngsw.json` manifest', () => {\n       pre.disableServiceWorker();\n-      expect(mvSpy).toHaveBeenCalledWith('dist/ngsw.json', 'dist/ngsw.json.bak');\n+      expect(mvSpy).toHaveBeenCalledWith('dist/bin/aio/build/ngsw.json',\n+          'dist/bin/aio/build/ngsw.json.bak');\n     });\n   });\n \n@@ -148,7 +149,7 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n \n     it('should undo `build()`', () => {\n       pre.undo.build();\n-      expect(rmSpy).toHaveBeenCalledWith('-rf', 'dist');\n+      expect(rmSpy).toHaveBeenCalledWith('-rf', 'dist/bin/aio/build');\n     });\n   });\n \n@@ -164,7 +165,8 @@ describe('deploy-to-firebase/pre-deploy-actions:', () => {\n \n     it('should undo `disableServiceWorker()`', () => {\n       pre.undo.disableServiceWorker();\n-      expect(mvSpy).toHaveBeenCalledWith('dist/ngsw.json.bak', 'dist/ngsw.json');\n+      expect(mvSpy).toHaveBeenCalledWith('dist/bin/aio/build/ngsw.json.bak',\n+          'dist/bin/aio/build/ngsw.json');\n     });\n   });\n \n\n---\n file path A: aio/scripts/deploy-to-firebase/utils.mjs | file path B: aio/scripts/deploy-to-firebase/utils.mjs\n\n@@ -105,5 +105,5 @@ function yarn(cmd) {\n   // This is not strictly necessary, since CircleCI will mask secret environment variables in the\n   // output (see https://circleci.com/docs/2.0/env-vars/#secrets-masking), but is an extra\n   // precaution.\n-  return sh.exec(`${process.env.YARN_BIN} --silent ${cmd}`, {cwd: 'aio'});\n+  return sh.exec(`yarn --silent ${cmd}`);\n }\n\n---\n file path A: aio/scripts/deploy-to-firebase/utils.spec.mjs | file path B: aio/scripts/deploy-to-firebase/utils.spec.mjs\n\n@@ -284,13 +284,6 @@ describe('deploy-to-firebase/utils:', () => {\n \n     beforeEach(() => execSpy = spyOn(sh, 'exec'));\n \n-    it('should execute the yarn binary in process.env.YARN_BIN', () => {\n-      process.env.YARN_BIN = '/foo/yarn';\n-      u.yarn('foo --bar');\n-      const cmd = execSpy.calls.argsFor(0)[0];\n-      expect(cmd.startsWith('/foo/yarn')).toEqual(true);\n-    });\n-\n     it('should execute yarn in silent mode', () => {\n       u.yarn('foo --bar');\n \n@@ -298,13 +291,6 @@ describe('deploy-to-firebase/utils:', () => {\n       expect(cmd.endsWith('--silent foo --bar')).toEqual(true);\n     });\n \n-    it('should cd into aio', () => {\n-      u.yarn('foo --bar');\n-\n-      const options = execSpy.calls.argsFor(0)[1];\n-      expect(options.cwd).toEqual('aio');\n-    });\n-\n     it('should return the output from the command\\'s execution', () => {\n       execSpy.and.returnValue('command output\\n');\n       expect(u.yarn('foo --bar')).toBe('command output\\n');\n\n\n###\n\n", "completion": "build(bazel): fix AIO deployment script (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -379,6 +379,7 @@ export interface Navigation {\n \n // @public\n export interface NavigationBehaviorOptions {\n+    onSameUrlNavigation?: Extract<OnSameUrlNavigation, 'reload'>;\n     replaceUrl?: boolean;\n     skipLocationChange?: boolean;\n     state?: {\n@@ -493,6 +494,9 @@ export class NoPreloading implements PreloadingStrategy {\n     static \u0275prov: i0.\u0275\u0275InjectableDeclaration<NoPreloading>;\n }\n \n+// @public\n+export type OnSameUrlNavigation = 'reload' | 'ignore';\n+\n // @public\n export class OutletContext {\n     // (undocumented)\n@@ -677,7 +681,7 @@ export class Router {\n     // (undocumented)\n     ngOnDestroy(): void;\n     // @deprecated\n-    onSameUrlNavigation: 'reload' | 'ignore';\n+    onSameUrlNavigation: OnSameUrlNavigation;\n     // @deprecated\n     paramsInheritanceStrategy: 'emptyOnly' | 'always';\n     parseUrl(url: string): UrlTree;\n@@ -709,7 +713,7 @@ export const ROUTER_INITIALIZER: InjectionToken<(compRef: ComponentRef<any>) =>\n // @public\n export interface RouterConfigOptions {\n     canceledNavigationResolution?: 'replace' | 'computed';\n-    onSameUrlNavigation?: 'reload' | 'ignore';\n+    onSameUrlNavigation?: OnSameUrlNavigation;\n     paramsInheritanceStrategy?: 'emptyOnly' | 'always';\n     urlUpdateStrategy?: 'deferred' | 'eager';\n }\n\n---\n file path A: packages/router/src/index.ts | file path B: packages/router/src/index.ts\n\n@@ -12,7 +12,7 @@ export {RouterLink, RouterLinkWithHref} from './directives/router_link';\n export {RouterLinkActive} from './directives/router_link_active';\n export {RouterOutlet, RouterOutletContract} from './directives/router_outlet';\n export {ActivationEnd, ActivationStart, ChildActivationEnd, ChildActivationStart, Event, EventType, GuardsCheckEnd, GuardsCheckStart, NavigationCancel, NavigationCancellationCode as NavigationCancellationCode, NavigationEnd, NavigationError, NavigationSkipped, NavigationSkippedCode, NavigationStart, ResolveEnd, ResolveStart, RouteConfigLoadEnd, RouteConfigLoadStart, RouterEvent, RoutesRecognized, Scroll} from './events';\n-export {CanActivate, CanActivateChild, CanActivateChildFn, CanActivateFn, CanDeactivate, CanDeactivateFn, CanLoad, CanLoadFn, CanMatch, CanMatchFn, Data, DefaultExport, LoadChildren, LoadChildrenCallback, NavigationBehaviorOptions, QueryParamsHandling, Resolve, ResolveData, ResolveFn, Route, Routes, RunGuardsAndResolvers, UrlMatcher, UrlMatchResult} from './models';\n+export {CanActivate, CanActivateChild, CanActivateChildFn, CanActivateFn, CanDeactivate, CanDeactivateFn, CanLoad, CanLoadFn, CanMatch, CanMatchFn, Data, DefaultExport, LoadChildren, LoadChildrenCallback, NavigationBehaviorOptions, OnSameUrlNavigation, QueryParamsHandling, Resolve, ResolveData, ResolveFn, Route, Routes, RunGuardsAndResolvers, UrlMatcher, UrlMatchResult} from './models';\n export {Navigation, NavigationExtras, UrlCreationOptions} from './navigation_transition';\n export {DefaultTitleStrategy, TitleStrategy} from './page_title_strategy';\n export {DebugTracingFeature, DisabledInitialNavigationFeature, EnabledBlockingInitialNavigationFeature, InitialNavigationFeature, InMemoryScrollingFeature, PreloadingFeature, provideRouter, provideRoutes, RouterConfigurationFeature, RouterFeature, RouterFeatures, withDebugTracing, withDisabledInitialNavigation, withEnabledBlockingInitialNavigation, withInMemoryScrolling, withPreloading, withRouterConfig} from './provide_router';\n\n---\n file path A: packages/router/src/models.ts | file path B: packages/router/src/models.ts\n\n@@ -13,6 +13,31 @@ import {DeprecatedLoadChildren} from './deprecated_load_children';\n import {ActivatedRouteSnapshot, RouterStateSnapshot} from './router_state';\n import {UrlSegment, UrlSegmentGroup, UrlTree} from './url_tree';\n \n+/**\n+ * How to handle a navigation request to the current URL. One of:\n+ *\n+ * - `'ignore'` :  The router ignores the request it is the same as the current state.\n+ * - `'reload'` : The router processes the URL even if it is not different from the current state.\n+ * One example of when you might want this option is if a `canMatch` guard depends on\n+ * application state and initially rejects navigation to a route. After fixing the state, you want\n+ * to re-navigate to the same URL so the route with the `canMatch` guard can activate.\n+ *\n+ * Note that this only configures whether the Route reprocesses the URL and triggers related\n+ * action and events like redirects, guards, and resolvers. By default, the router re-uses a\n+ * component instance when it re-navigates to the same component type without visiting a different\n+ * component first. This behavior is configured by the `RouteReuseStrategy`. In order to reload\n+ * routed components on same url navigation, you need to set `onSameUrlNavigation` to `'reload'`\n+ * _and_ provide a `RouteReuseStrategy` which returns `false` for `shouldReuseRoute`. Additionally,\n+ * resolvers and most guards for routes do not run unless the path or path params changed\n+ * (configured by `runGuardsAndResolvers`).\n+ *\n+ * @publicApi\n+ * @see RouteReuseStrategy\n+ * @see RunGuardsAndResolvers\n+ * @see NavigationBehaviorOptions\n+ * @see RouterConfigOptions\n+ */\n+export type OnSameUrlNavigation = 'reload'|'ignore';\n \n /**\n  * Represents a route configuration for the Router service.\n@@ -550,11 +575,19 @@ export interface Route {\n   loadChildren?: LoadChildren;\n \n   /**\n-   * Defines when guards and resolvers will be run. One of\n-   * - `paramsOrQueryParamsChange` : Run when query parameters change.\n+   * A policy for when to run guards and resolvers on a route.\n+   *\n+   * Guards and/or resolvers will always run when a route is activated or deactivated. When a route\n+   * is unchanged, the default behavior is the same as `paramsChange`.\n+   *\n+   * `paramsChange` : Rerun the guards and resolvers when path or\n+   * path param changes. This does not include query parameters. This option is the default.\n    * - `always` : Run on every execution.\n-   * By default, guards and resolvers run only when the matrix\n-   * parameters of the route change.\n+   * - `pathParamsChange` : Rerun guards and resolvers when the path params\n+   * change. This does not compare matrix or query parameters.\n+   * - `paramsOrQueryParamsChange` : Run when path, matrix, or query parameters change.\n+   * - `pathParamsOrQueryParamsChange` : Rerun guards and resolvers when the path params\n+   * change or query params have changed. This does not include matrix parameters.\n    *\n    * @see RunGuardsAndResolvers\n    */\n@@ -1194,6 +1227,17 @@ export type CanLoadFn = (route: Route, segments: UrlSegment[]) =>\n  * @publicApi\n  */\n export interface NavigationBehaviorOptions {\n+  /**\n+   * How to handle a navigation request to the current URL.\n+   *\n+   * This value is a subset of the options available in `OnSameUrlNavigation` and\n+   * will take precedence over the default value set for the `Router`.\n+   *\n+   * @see `OnSameUrlNavigation`\n+   * @see `RouterConfigOptions`\n+   */\n+  onSameUrlNavigation?: Extract<OnSameUrlNavigation, 'reload'>;\n+\n   /**\n    * When true, navigates without pushing a new state into history.\n    *\n\n---\n file path A: packages/router/src/navigation_transition.ts | file path B: packages/router/src/navigation_transition.ts\n\n@@ -344,7 +344,10 @@ export class NavigationTransitions {\n                                // try processing the URL again.\n                                browserUrlTree !== this.router.currentUrlTree.toString();\n \n-                           if (!urlTransition && this.router.onSameUrlNavigation !== 'reload') {\n+\n+                           const onSameUrlNavigation =\n+                               t.extras.onSameUrlNavigation ?? this.router.onSameUrlNavigation;\n+                           if (!urlTransition && onSameUrlNavigation !== 'reload') {\n                              const reason = NG_DEV_MODE ?\n                                  `Navigation to ${\n                                      t.rawUrl} was ignored because it is the same as the current Router URL.` :\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -13,7 +13,7 @@ import {BehaviorSubject, Observable, of, Subject, SubscriptionLike} from 'rxjs';\n import {createUrlTree} from './create_url_tree';\n import {RuntimeErrorCode} from './errors';\n import {Event, NavigationCancel, NavigationCancellationCode, NavigationEnd, NavigationTrigger, RouteConfigLoadEnd, RouteConfigLoadStart} from './events';\n-import {NavigationBehaviorOptions, Route, Routes} from './models';\n+import {NavigationBehaviorOptions, OnSameUrlNavigation, Route, Routes} from './models';\n import {Navigation, NavigationExtras, NavigationTransition, NavigationTransitions, RestoredState, UrlCreationOptions} from './navigation_transition';\n import {TitleStrategy} from './page_title_strategy';\n import {RouteReuseStrategy} from './route_reuse_strategy';\n@@ -281,24 +281,15 @@ export class Router {\n   titleStrategy?: TitleStrategy = inject(TitleStrategy);\n \n   /**\n-   * How to handle a navigation request to the current URL. One of:\n+   * How to handle a navigation request to the current URL.\n    *\n-   * - `'ignore'` :  The router ignores the request.\n-   * - `'reload'` : The router reloads the URL. Use to implement a \"refresh\" feature.\n-   *\n-   * Note that this only configures whether the Route reprocesses the URL and triggers related\n-   * action and events like redirects, guards, and resolvers. By default, the router re-uses a\n-   * component instance when it re-navigates to the same component type without visiting a different\n-   * component first. This behavior is configured by the `RouteReuseStrategy`. In order to reload\n-   * routed components on same url navigation, you need to set `onSameUrlNavigation` to `'reload'`\n-   * _and_ provide a `RouteReuseStrategy` which returns `false` for `shouldReuseRoute`.\n    *\n    * @deprecated Configure this through `provideRouter` or `RouterModule.forRoot` instead.\n    * @see `withRouterConfig`\n    * @see `provideRouter`\n    * @see `RouterModule`\n    */\n-  onSameUrlNavigation: 'reload'|'ignore' = 'ignore';\n+  onSameUrlNavigation: OnSameUrlNavigation = 'ignore';\n \n   /**\n    * How to merge parameters, data, resolved data, and title from parent to child\n\n---\n file path A: packages/router/src/router_config.ts | file path B: packages/router/src/router_config.ts\n\n@@ -8,6 +8,7 @@\n \n import {InjectionToken} from '@angular/core';\n \n+import {OnSameUrlNavigation} from './models';\n import {UrlSerializer, UrlTree} from './url_tree';\n \n const NG_DEV_MODE = typeof ngDevMode === 'undefined' || !!ngDevMode;\n@@ -74,13 +75,13 @@ export interface RouterConfigOptions {\n   canceledNavigationResolution?: 'replace'|'computed';\n \n   /**\n-   * Define what the router should do if it receives a navigation request to the current URL.\n-   * Default is `ignore`, which causes the router ignores the navigation.\n-   * This can disable features such as a \"refresh\" button.\n-   * Use this option to configure the behavior when navigating to the\n-   * current URL. Default is 'ignore'.\n+   * Configures the default for handling a navigation request to the current URL.\n+   *\n+   * If unset, the `Router` will use `'ignore'`.\n+   *\n+   * @see `OnSameUrlNavigation`\n    */\n-  onSameUrlNavigation?: 'reload'|'ignore';\n+  onSameUrlNavigation?: OnSameUrlNavigation;\n \n   /**\n    * Defines how the router merges parameters, data, and resolved data from parent to child\n\n---\n file path A: packages/router/test/integration.spec.ts | file path B: packages/router/test/integration.spec.ts\n\n@@ -60,14 +60,18 @@ describe('Integration', () => {\n      })));\n \n   describe('navigation', function() {\n-    it('should navigate to the current URL', fakeAsync(inject([Router], (router: Router) => {\n-         router.onSameUrlNavigation = 'reload';\n+    it('should navigate to the current URL', fakeAsync(() => {\n+         TestBed.configureTestingModule({\n+           providers: [\n+             provideRouter([], withRouterConfig({onSameUrlNavigation: 'reload'})),\n+           ]\n+         });\n+         const router = TestBed.inject(Router);\n          router.resetConfig([\n            {path: '', component: SimpleCmp},\n            {path: 'simple', component: SimpleCmp},\n          ]);\n \n-         const fixture = createRoot(router, RootCmp);\n          const events: Event[] = [];\n          router.events.subscribe(e => onlyNavigationStartAndEnd(e) && events.push(e));\n \n@@ -81,8 +85,34 @@ describe('Integration', () => {\n            [NavigationStart, '/simple'], [NavigationEnd, '/simple'], [NavigationStart, '/simple'],\n            [NavigationEnd, '/simple']\n          ]);\n-       })));\n+       }));\n \n+    it('should override default onSameUrlNavigation with extras', async () => {\n+      TestBed.configureTestingModule({\n+        providers: [\n+          provideRouter([], withRouterConfig({onSameUrlNavigation: 'ignore'})),\n+        ]\n+      });\n+      const router = TestBed.inject(Router);\n+      router.resetConfig([\n+        {path: '', component: SimpleCmp},\n+        {path: 'simple', component: SimpleCmp},\n+      ]);\n+\n+      const events: Event[] = [];\n+      router.events.subscribe(e => onlyNavigationStartAndEnd(e) && events.push(e));\n+\n+      await router.navigateByUrl('/simple');\n+      await router.navigateByUrl('/simple');\n+      // By default, the second navigation is ignored\n+      expectEvents(events, [[NavigationStart, '/simple'], [NavigationEnd, '/simple']]);\n+      await router.navigateByUrl('/simple', {onSameUrlNavigation: 'reload'});\n+      // We overrode the `onSameUrlNavigation` value. This navigation should be processed.\n+      expectEvents(events, [\n+        [NavigationStart, '/simple'], [NavigationEnd, '/simple'], [NavigationStart, '/simple'],\n+        [NavigationEnd, '/simple']\n+      ]);\n+    });\n \n     it('should ignore empty paths in relative links',\n        fakeAsync(inject([Router], (router: Router) => {\n\n\n###\n\n", "completion": "feat(router): Add ability to override `onSameUrlNavigation` default per-navigation (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,30 @@\n+<a name=\"15.0.1\"></a>\n+# 15.0.1 (2022-11-22)\n+### common\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [930af9dd26](https://github.com/angular/angular/commit/930af9dd2607754e778922a4bb31055123229e24) | fix | Fix MockPlatformLocation events and missing onPopState implementation ([#48113](https://github.com/angular/angular/pull/48113)) |\n+### forms\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [b342e55509](https://github.com/angular/angular/commit/b342e5550928c14ddfb33861189f67b39e163d05) | fix | don't mutate validators array ([#47830](https://github.com/angular/angular/pull/47830)) |\n+| [a12a120272](https://github.com/angular/angular/commit/a12a120272024e49bd3d80d9ed1ae30dcf8622f8) | fix | FormBuilder.group return right type with shorthand parameters. ([#48084](https://github.com/angular/angular/pull/48084)) |\n+### language-service\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [cc8b76ef7c](https://github.com/angular/angular/commit/cc8b76ef7cb908d2c95229f39bf82a13ca59570b) | fix | correctly handle host directive inputs/outputs ([#48147](https://github.com/angular/angular/pull/48147)) |\n+| [a8c33bf931](https://github.com/angular/angular/commit/a8c33bf93132425a617381e4aa9a6f0e8e0ddf5b) | fix | update packages/language-service/build.sh script to work with vscode-ng-language-service's new Bazel build ([#48120](https://github.com/angular/angular/pull/48120)) |\n+### router\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [e4309d57d8](https://github.com/angular/angular/commit/e4309d57d893e111bda3744a61630d1888ddbc02) | fix | correct type of nextState parameter in canDeactivate ([#48038](https://github.com/angular/angular/pull/48038)) |\n+| [9baefd085f](https://github.com/angular/angular/commit/9baefd085fb079c312c4c03d79775a0fcff933b9) | fix | Ensure renavigating in component init works with enabledBlocking ([#48063](https://github.com/angular/angular/pull/48063)) |\n+| [fa5528fb5f](https://github.com/angular/angular/commit/fa5528fb5f0fe6e4e6ea85d39e43262018520c43) | fix | restore 'history.state' on popstate even if navigationId missing ([#48033](https://github.com/angular/angular/pull/48033)) |\n+## Special Thanks\n+Alan Agius, Andrew Scott, Bjarki, Bob Watson, Brooke, Derek Cormier, Dylan Hunn, George Kalpakas, Greg Magolan, Ikko Ashimine, Ivan Rodriguez, Jessica Janiuk, Joe Roxbury, Joey Perrott, Kristiyan Kostadinov, Matthieu Riegler, Mikhail Savchuk, Nebojsa Cvetkovic, Pawel Kozlowski, Volodymyr and Wooshaah\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.1.0-next.0\"></a>\n # 15.1.0-next.0 (2022-11-22)\n ## Deprecations\n\n\n###\n\n", "completion": "docs: release notes for the v15.0.1 release"}
{"prompt": " file path A: goldens/public-api/core/testing/index.md | file path B: goldens/public-api/core/testing/index.md\n\n@@ -160,6 +160,7 @@ export interface TestBed {\n     resetTestEnvironment(): void;\n     // (undocumented)\n     resetTestingModule(): TestBed;\n+    runInInjectionContext<T>(fn: () => T): T;\n }\n \n // @public\n\n---\n file path A: packages/core/test/test_bed_spec.ts | file path B: packages/core/test/test_bed_spec.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {APP_INITIALIZER, ChangeDetectorRef, Compiler, Component, Directive, ElementRef, ErrorHandler, getNgModuleById, Inject, Injectable, InjectFlags, InjectionToken, InjectOptions, Injector, Input, LOCALE_ID, ModuleWithProviders, NgModule, Optional, Pipe, Type, ViewChild, \u0275setClassMetadata as setClassMetadata, \u0275\u0275defineComponent as defineComponent, \u0275\u0275defineInjector as defineInjector, \u0275\u0275defineNgModule as defineNgModule, \u0275\u0275elementEnd as elementEnd, \u0275\u0275elementStart as elementStart, \u0275\u0275setNgModuleScope as setNgModuleScope, \u0275\u0275text as text} from '@angular/core';\n+import {APP_INITIALIZER, ChangeDetectorRef, Compiler, Component, Directive, ElementRef, ErrorHandler, getNgModuleById, inject, Inject, Injectable, InjectFlags, InjectionToken, InjectOptions, Injector, Input, LOCALE_ID, ModuleWithProviders, NgModule, Optional, Pipe, Type, ViewChild, \u0275setClassMetadata as setClassMetadata, \u0275\u0275defineComponent as defineComponent, \u0275\u0275defineInjector as defineInjector, \u0275\u0275defineNgModule as defineNgModule, \u0275\u0275elementEnd as elementEnd, \u0275\u0275elementStart as elementStart, \u0275\u0275setNgModuleScope as setNgModuleScope, \u0275\u0275text as text} from '@angular/core';\n import {TestBed, TestBedImpl} from '@angular/core/testing/src/test_bed';\n import {By} from '@angular/platform-browser';\n import {expect} from '@angular/platform-browser/testing/src/matchers';\n@@ -1893,6 +1893,20 @@ describe('TestBed', () => {\n       });\n     });\n   });\n+\n+  it('should be able to call Testbed.runInInjectionContext in tests', () => {\n+    const expectedValue = 'testValue';\n+    @Injectable({providedIn: 'root'})\n+    class SomeInjectable {\n+      readonly instanceValue = expectedValue;\n+    }\n+\n+    function functionThatUsesInject(): string {\n+      return inject(SomeInjectable).instanceValue;\n+    }\n+\n+    expect(TestBed.runInInjectionContext(functionThatUsesInject)).toEqual(expectedValue);\n+  });\n });\n \n \n\n---\n file path A: packages/core/testing/src/test_bed.ts | file path B: packages/core/testing/src/test_bed.ts\n\n@@ -14,6 +14,7 @@\n import {\n   Component,\n   Directive,\n+  EnvironmentInjector,\n   InjectFlags,\n   InjectionToken,\n   InjectOptions,\n@@ -104,6 +105,13 @@ export interface TestBed {\n   /** @deprecated from v9.0.0 use TestBed.inject */\n   get(token: any, notFoundValue?: any): any;\n \n+  /**\n+   * Runs the given function in the `EnvironmentInjector` context of `TestBed`.\n+   *\n+   * @see EnvironmentInjector#runInContext\n+   */\n+  runInInjectionContext<T>(fn: () => T): T;\n+\n   execute(tokens: any[], fn: Function, context?: any): any;\n \n   overrideModule(ngModule: Type<any>, override: MetadataOverride<NgModule>): TestBed;\n@@ -325,6 +333,15 @@ export class TestBedImpl implements TestBed {\n     return TestBedImpl.INSTANCE.inject(token, notFoundValue, flags);\n   }\n \n+  /**\n+   * Runs the given function in the `EnvironmentInjector` context of `TestBed`.\n+   *\n+   * @see EnvironmentInjector#runInContext\n+   */\n+  static runInInjectionContext<T>(fn: () => T): T {\n+    return TestBedImpl.INSTANCE.runInInjectionContext(fn);\n+  }\n+\n   static createComponent<T>(component: Type<T>): ComponentFixture<T> {\n     return TestBedImpl.INSTANCE.createComponent(component);\n   }\n@@ -516,6 +533,10 @@ export class TestBedImpl implements TestBed {\n     return this.inject(token, notFoundValue, flags);\n   }\n \n+  runInInjectionContext<T>(fn: () => T): T {\n+    return this.inject(EnvironmentInjector).runInContext(fn);\n+  }\n+\n   execute(tokens: any[], fn: Function, context?: any): any {\n     const params = tokens.map(t => this.inject(t));\n     return fn.apply(context, params);\n\n\n###\n\n", "completion": "feat(core): Add `TestBed.runInInjectionContext` to help test functions which use `inject` (#<issue-num>)"}
{"prompt": " file path A: aio/content/images/bios/bravery_pic.png | file path B: aio/content/images/bios/bravery_pic.png\n\nBinary files /dev/null and b/aio/content/images/bios/bravery_pic.png differ\n\n---\n file path A: aio/content/marketing/contributors.json | file path B: aio/content/marketing/contributors.json\n\n@@ -178,6 +178,14 @@\n     \"bio\": \"Bob is the documentation lead for angular.io. When he's not obsessing over the i-dotting and t-crossing of documentation, he enjoys seeing the world from up in the air and below the sea.\",\n     \"groups\": [\"Angular\"]\n   },\n+  \"bravery08\": {\n+    \"name\": \"Brooke Avery\",\n+    \"picture\": \"bravery_pic.png\",\n+    \"twitter\": \"JediBravery\",\n+    \"website\": \"https://devlife.show\",\n+    \"bio\": \"Brooke is a software engineer, GDE, & community builder. She is the director of the Angular Community Meetup, a co-producer/host of the Dev.Life Podcast, & has been a co-organizer for ng-conf. Brooke has a strong passion for education & helping others find success in their developer journeys. Outside of programming, Brooke loves to geek out on Star Wars and the Disney Parks.\",\n+    \"groups\": [\"GDE\"]\n+  },\n   \"brocco\": {\n     \"name\": \"Mike Brocchi\",\n     \"picture\": \"mike-brocchi.jpg\",\n\n\n###\n\n", "completion": "docs: add brooke avery to GDE resources (#<issue-num>)"}
{"prompt": " file path A: aio/scripts/deploy-to-firebase/BUILD.bazel | file path B: aio/scripts/deploy-to-firebase/BUILD.bazel\n\n@@ -1,6 +1,7 @@\n load(\"@aio_npm//@bazel/jasmine:index.bzl\", \"jasmine_node_test\")\n load(\"//tools:defaults.bzl\", \"nodejs_binary\")\n load(\"@aio_npm//@angular/build-tooling/bazel/remote-execution:index.bzl\", \"ENABLE_NETWORK\")\n+load(\"//:yarn.bzl\", \"YARN_LABEL\")\n \n DEPLOY_TO_FIREBASE_SOURCES = glob(\n     [\"**/*.mjs\"],\n@@ -11,12 +12,16 @@ DEPLOY_TO_FIREBASE_DEPS = [\n     \"@aio_npm//shelljs\",\n     \"//aio:build\",\n     \"//:package.json\",\n+    YARN_LABEL,\n ]\n \n nodejs_binary(\n     name = \"deploy-to-firebase\",\n     data = DEPLOY_TO_FIREBASE_SOURCES + DEPLOY_TO_FIREBASE_DEPS,\n     entry_point = \"index.mjs\",\n+    env = {\n+        \"YARN_BIN\": \"$(rootpath %s)\" % YARN_LABEL,\n+    },\n )\n \n jasmine_node_test(\n\n---\n file path A: aio/scripts/deploy-to-firebase/utils.mjs | file path B: aio/scripts/deploy-to-firebase/utils.mjs\n\n@@ -105,5 +105,5 @@ function yarn(cmd) {\n   // This is not strictly necessary, since CircleCI will mask secret environment variables in the\n   // output (see https://circleci.com/docs/2.0/env-vars/#secrets-masking), but is an extra\n   // precaution.\n-  return sh.exec(`yarn --silent ${cmd}`);\n+  return sh.exec(`${process.env.YARN_BIN} --silent ${cmd}`, {cwd: 'aio'});\n }\n\n---\n file path A: aio/scripts/deploy-to-firebase/utils.spec.mjs | file path B: aio/scripts/deploy-to-firebase/utils.spec.mjs\n\n@@ -284,9 +284,25 @@ describe('deploy-to-firebase/utils:', () => {\n \n     beforeEach(() => execSpy = spyOn(sh, 'exec'));\n \n+    it('should execute the yarn binary in process.env.YARN_BIN', () => {\n+      process.env.YARN_BIN = '/foo/yarn';\n+      u.yarn('foo --bar');\n+      const cmd = execSpy.calls.argsFor(0)[0];\n+      expect(cmd.startsWith('/foo/yarn')).toEqual(true);\n+    });\n+\n     it('should execute yarn in silent mode', () => {\n       u.yarn('foo --bar');\n-      expect(execSpy).toHaveBeenCalledWith('yarn --silent foo --bar');\n+\n+      const cmd = execSpy.calls.argsFor(0)[0];\n+      expect(cmd.endsWith('--silent foo --bar')).toEqual(true);\n+    });\n+\n+    it('should cd into aio', () => {\n+      u.yarn('foo --bar');\n+\n+      const options = execSpy.calls.argsFor(0)[1];\n+      expect(options.cwd).toEqual('aio');\n     });\n \n     it('should return the output from the command\\'s execution', () => {\n\n\n###\n\n", "completion": "build(bazel): fix yarn call in aio deploy script (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,12 +1,12 @@\n <a name=\"12.2.17\"></a>\n-# 12.2.17 (2022-11-21)\n+# 12.2.17 (2022-11-22)\n ## Breaking Changes\n ### core\n - Existing iframe usages may have security-sensitive attributes applied as an attribute or property binding in a template or via host bindings in a directive. Such usages would require an update to ensure compliance with the new stricter rules around iframe bindings.\n ### core\n | Commit | Type | Description |\n | -- | -- | -- |\n-| [b1d7b79ff4](https://github.com/angular/angular/commit/b1d7b79ff4619d6e7967455d7cda72754f5dab9a) | fix | hardening attribute and property binding rules for <iframe> elements ([#48029](https://github.com/angular/angular/pull/48029)) |\n+| [b871db57da](https://github.com/angular/angular/commit/b871db57daab10ef6d4d92041177458f19fd3ebd) | fix | hardening attribute and property binding rules for <iframe> elements ([#48059](https://github.com/angular/angular/pull/48059)) |\n ## Special Thanks\n Andrew Kushnir, Andrew Scott, George Looshch, Joey Perrott and Paul Gschwendtner\n \n\n\n###\n\n", "completion": "docs: fix errors in 12.2.17 changelog"}
{"prompt": " file path A: aio/src/assets/BUILD.bazel | file path B: aio/src/assets/BUILD.bazel\n\n@@ -4,6 +4,5 @@ filegroup(\n     name = \"assets\",\n     srcs = glob([\n         \"images/**\",\n-        \"opensearch.xml\",\n-    ]),\n+    ]) + [\"opensearch.xml\"],\n )\n\n---\n file path A: aio/tools/transforms/angular-base-package/BUILD.bazel | file path B: aio/tools/transforms/angular-base-package/BUILD.bazel\n\n@@ -5,11 +5,10 @@ js_library(\n     name = \"angular-base-package\",\n     srcs = glob(\n         [\n-            \"ignore-words.json\",\n             \"**/*.js\",\n         ],\n         exclude = [\"**/*.spec.js\"],\n-    ),\n+    ) + [\"ignore-words.json\"],\n     visibility = [\"//aio/tools/transforms:__subpackages__\"],\n     deps = [\n         \"//:package_json\",\n\n---\n file path A: packages/animations/browser/BUILD.bazel | file path B: packages/animations/browser/BUILD.bazel\n\n@@ -23,6 +23,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/animations/browser/testing/BUILD.bazel | file path B: packages/animations/browser/testing/BUILD.bazel\n\n@@ -18,6 +18,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/common/http/BUILD.bazel | file path B: packages/common/http/BUILD.bazel\n\n@@ -24,6 +24,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/common/http/testing/BUILD.bazel | file path B: packages/common/http/testing/BUILD.bazel\n\n@@ -24,6 +24,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/common/testing/BUILD.bazel | file path B: packages/common/testing/BUILD.bazel\n\n@@ -19,6 +19,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/common/upgrade/BUILD.bazel | file path B: packages/common/upgrade/BUILD.bazel\n\n@@ -25,6 +25,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/core/testing/BUILD.bazel | file path B: packages/core/testing/BUILD.bazel\n\n@@ -24,6 +24,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/localize/BUILD.bazel | file path B: packages/localize/BUILD.bazel\n\n@@ -69,6 +69,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/localize/init/BUILD.bazel | file path B: packages/localize/init/BUILD.bazel\n\n@@ -22,6 +22,5 @@ filegroup(\n     name = \"files_for_docgen\",\n     srcs = glob([\n         \"*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/platform-browser-dynamic/testing/BUILD.bazel | file path B: packages/platform-browser-dynamic/testing/BUILD.bazel\n\n@@ -23,6 +23,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/platform-browser/animations/BUILD.bazel | file path B: packages/platform-browser/animations/BUILD.bazel\n\n@@ -32,6 +32,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/platform-browser/testing/BUILD.bazel | file path B: packages/platform-browser/testing/BUILD.bazel\n\n@@ -21,6 +21,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/platform-server/init/BUILD.bazel | file path B: packages/platform-server/init/BUILD.bazel\n\n@@ -28,6 +28,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/platform-server/testing/BUILD.bazel | file path B: packages/platform-server/testing/BUILD.bazel\n\n@@ -20,6 +20,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/router/testing/BUILD.bazel | file path B: packages/router/testing/BUILD.bazel\n\n@@ -21,6 +21,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/router/upgrade/BUILD.bazel | file path B: packages/router/upgrade/BUILD.bazel\n\n@@ -25,6 +25,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/upgrade/static/BUILD.bazel | file path B: packages/upgrade/static/BUILD.bazel\n\n@@ -24,6 +24,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n---\n file path A: packages/upgrade/static/testing/BUILD.bazel | file path B: packages/upgrade/static/testing/BUILD.bazel\n\n@@ -23,6 +23,5 @@ filegroup(\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n-        \"PACKAGE.md\",\n-    ]),\n+    ]) + [\"PACKAGE.md\"],\n )\n\n\n###\n\n", "completion": "build: reformat BUILD files (#<issue-num>)"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -334,8 +334,6 @@ jobs:\n           command: yarn --cwd aio test:ci\n           no_output_timeout: 20m\n \n-        # TODO: run the following tests under bazel\n-\n         # Check the bundle sizes.\n       - run: yarn --cwd aio payload-size\n \n@@ -360,8 +358,6 @@ jobs:\n           command: yarn --cwd aio test-local:ci\n           no_output_timeout: 20m\n \n-        # TODO: run the following tests under bazel\n-\n         # Check the bundle sizes.\n       - run: yarn --cwd aio payload-size aio-local\n \n\n---\n file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -172,6 +172,9 @@ E2E_DEPS = APPLICATION_DEPS + [\n     \"//aio/tools:windows-chromium-path\",\n ]\n \n+# Poll period for architect rules that watch for changes\n+ARCHITECT_POLL_MS = 1000\n+\n # Stamp npm_link targets for all dependencies that correspond to a\n # first-party equivalent pacakge in angular.\n link_local_packages(all_aio_deps = collections.uniq(APPLICATION_DEPS + TEST_DEPS + E2E_DEPS))\n@@ -188,7 +191,6 @@ architect(\n         \"--output-path=build-app\",\n     ],\n     chdir = \"$(RULEDIR)\",\n-    configuration_env_vars = [\"NG_BUILD_CACHE\"],\n     data = [\":application_files_bin\"] + select({\n         \":aio_local_deps\": substitute_local_package_deps(APPLICATION_DEPS),\n         \"//conditions:default\": APPLICATION_DEPS,\n@@ -247,7 +249,7 @@ aio_test(\n     args = [\n         \"site:test\",\n         \"--watch\",\n-        \"--poll=1000\",\n+        \"--poll=%d\" % ARCHITECT_POLL_MS,\n     ],\n     data = TEST_DATA,\n     tags = [\n@@ -265,7 +267,6 @@ architect_test(\n         \"--port=0\",\n     ],\n     chdir = package_name(),\n-    configuration_env_vars = [\"NG_BUILD_CACHE\"],\n     data = E2E_FILES + select({\n         \":aio_local_deps\": substitute_local_package_deps(E2E_DEPS),\n         \"//conditions:default\": E2E_DEPS,\n@@ -285,7 +286,7 @@ architect(\n     args = [\n         \"site:serve\",\n         \"--open\",\n-        \"--poll=1000\",\n+        \"--poll=%d\" % ARCHITECT_POLL_MS,\n         \"--live-reload\",\n         \"--watch\",\n     ],\n\n---\n file path A: aio/aio_targets.bzl | file path B: aio/aio_targets.bzl\n\n@@ -5,7 +5,6 @@ def aio_test(name, data, args, **kwargs):\n         name = name,\n         args = args,\n         chdir = native.package_name(),\n-        configuration_env_vars = [\"NG_BUILD_CACHE\"],\n         data = data,\n         env = {\n             \"CHROME_BIN\": \"../$(CHROMIUM)\",\n\n---\n file path A: aio/angular.json | file path B: aio/angular.json\n\n@@ -6,7 +6,12 @@\n     \"warnings\": {\n       \"typescriptMismatch\": false\n     },\n-    \"analytics\": false\n+    \"analytics\": false,\n+    \"cache\": {\n+      // Disable build caching as the cache folder will just be dropped\n+      // when run under Bazel sandboxed execution.\n+      \"enabled\": false\n+    }\n   },\n   \"newProjectRoot\": \"projects\",\n   \"projects\": {\n\n---\n file path A: aio/content/examples/examples.bzl | file path B: aio/content/examples/examples.bzl\n\n@@ -206,7 +206,6 @@ def docs_example(name, test = True, test_tags = [], test_exec_properties = {}, f\n                 \"//aio:aio_local_deps\": LOCAL_PACKAGE_ARGS,\n                 \"//conditions:default\": [],\n             }),\n-            configuration_env_vars = [\"NG_BUILD_CACHE\"],\n             entry_point = \"//aio/tools/examples:run-example-e2e.mjs\",\n             env = {\n                 \"CHROME_BIN\": \"$(CHROMIUM)\",\n\n---\n file path A: aio/content/examples/view-encapsulation/e2e/src/app.e2e-spec.ts | file path B: aio/content/examples/view-encapsulation/e2e/src/app.e2e-spec.ts\n\n@@ -92,8 +92,7 @@ describe('View Encapsulation App', () => {\n async function findShadowDomElement(shadowHostSelector: string, shadowElementSelector: string): Promise<WebElement> {\n   const shadowHost = browser.findElement(by.css(shadowHostSelector));\n   const shadowRoot: any = await browser.executeScript('return arguments[0].shadowRoot', shadowHost);\n-  // TODO: Using this solution to find the shadow element after Chrome 97: https://stackoverflow.com/a/70611425.\n-  // Is there a better way to do this?\n+  // Using this solution to find the shadow element after Chrome 97: https://stackoverflow.com/a/70611425.\n   const rootKey = Object.keys(shadowRoot)[0];\n   const rootId = shadowRoot[rootKey];\n   return new WebElement(browser, rootId).findElement(by.css(shadowElementSelector));\n\n---\n file path A: aio/scripts/local-workspace-status.mjs | file path B: aio/scripts/local-workspace-status.mjs\n\n@@ -14,7 +14,7 @@ const __dirname = url.fileURLToPath(new URL('.', import.meta.url));\n const pkgJsonPath = path.join(__dirname, '..', 'package.json');\n const pkgJson = JSON.parse(fs.readFileSync(pkgJsonPath, 'utf8'));\n \n-const aioAngularVersion = pkgJson.dependencies['@angular/core'].replace(/^[\\^~]/, '') + \"+locallySubstituted\";\n+const aioAngularVersion = pkgJson.dependencies['@angular/core'].replace(/^[\\^~]/, '') + \"+forAIOLocalBuildToAvoidMismatch\";\n \n // Output the workspace status variable format to stdout so Bazel can read it\n console.log(`\\\n\n---\n file path A: aio/scripts/run-with-local-server.mjs | file path B: aio/scripts/run-with-local-server.mjs\n\n@@ -36,19 +36,16 @@ async function main(args) {\n     '--quiet'\n   ];\n   const lightserverProcess = sh.exec(lightserverCmd.join(' '), {async: true, silent: true});\n-    \n   const command = [\n     testScript,\n     ...testScriptArgs\n   ].join(' ').replace('LOCALHOST_URL', `http://localhost:${port}`);\n \n-  sh.exec(command);\n-  \n+  const returnCode = sh.exec(command).code;\n+\n   await killProcess(lightserverProcess);\n \n-  // TODO: On Windows something remains unresolved and node does not exit.\n-  // It does not appear to be the lightserver process.\n-  process.exit(0);\n+  process.exit(returnCode);\n }\n \n (async() => await main(process.argv.slice(2)))();\n@@ -63,4 +60,4 @@ function killProcess(childProcess) {\n       resolve();\n     });\n   });\n-}\n\\ No newline at end of file\n+}\n\n---\n file path A: aio/tools/examples/BUILD.bazel | file path B: aio/tools/examples/BUILD.bazel\n\n@@ -10,58 +10,61 @@ exports_files([\n     \"run-example-e2e.mjs\",\n ])\n \n-EXAMPLE_BOILERPLATE_SRCS = [\n-    \"example-boilerplate.js\",\n-    \"constants.js\",\n-    \"//aio/tools/examples/shared\",\n-    \"//aio/content/examples\",\n-]\n-\n-EXAMPLE_BOILERPLATE_DEPS = [\n-    \"@aio_npm//canonical-path\",\n-    \"@aio_npm//fs-extra\",\n-    \"@aio_npm//ignore\",\n-    \"@aio_npm//shelljs\",\n-    \"@aio_npm//yargs\",\n-]\n+js_library(\n+    name = \"example-boilerplate-lib\",\n+    srcs = [\n+        \"constants.js\",\n+        \"example-boilerplate.js\",\n+    ],\n+    deps = [\n+        \"//aio/content/examples\",\n+        \"//aio/tools/examples/shared\",\n+        \"@aio_npm//canonical-path\",\n+        \"@aio_npm//fs-extra\",\n+        \"@aio_npm//ignore\",\n+        \"@aio_npm//shelljs\",\n+        \"@aio_npm//yargs\",\n+    ],\n+)\n \n nodejs_binary(\n     name = \"example-boilerplate\",\n-    data = EXAMPLE_BOILERPLATE_SRCS + EXAMPLE_BOILERPLATE_DEPS,\n+    data = [\":example-boilerplate-lib\"],\n     entry_point = \"example-boilerplate.js\",\n )\n \n jasmine_node_test(\n     name = \"example-boilerplate-test\",\n     srcs = [\"example-boilerplate.spec.js\"],\n-    deps = EXAMPLE_BOILERPLATE_SRCS + EXAMPLE_BOILERPLATE_DEPS,\n+    deps = [\":example-boilerplate-lib\"],\n )\n \n-CREATE_EXAMPLE_SRCS = [\n-    \"create-example.js\",\n-    \"constants.js\",\n-] + glob([\"shared/**\"])\n-\n-CREATE_EXAMPLE_DEPS = [\n-    \"@aio_npm//@bazel/buildozer\",\n-    \"@aio_npm//canonical-path\",\n-    \"@aio_npm//fs-extra\",\n-    \"@aio_npm//ignore\",\n-    \"@aio_npm//shelljs\",\n-    \"@aio_npm//yargs\",\n-]\n+js_library(\n+    name = \"create-example-lib\",\n+    srcs = [\n+        \"create-example.js\",\n+        \"constants.js\",\n+    ] + glob([\"shared/**\"]),\n+    deps = [\n+        \"@aio_npm//@bazel/buildozer\",\n+        \"@aio_npm//canonical-path\",\n+        \"@aio_npm//fs-extra\",\n+        \"@aio_npm//ignore\",\n+        \"@aio_npm//shelljs\",\n+        \"@aio_npm//yargs\",\n+    ],\n+)\n \n nodejs_binary(\n     name = \"create-example\",\n-    data = CREATE_EXAMPLE_SRCS + CREATE_EXAMPLE_DEPS,\n+    data = [\":create-example-lib\"],\n     entry_point = \"create-example.js\",\n )\n \n jasmine_node_test(\n     name = \"create-example-test\",\n     srcs = [\"create-example.spec.js\"],\n-    deps =\n-        CREATE_EXAMPLE_SRCS + CREATE_EXAMPLE_DEPS,\n+    deps = [\":create-example-lib\"],\n )\n \n js_library(\n\n---\n file path A: aio/tools/examples/create-example.js | file path B: aio/tools/examples/create-example.js\n\n@@ -56,11 +56,20 @@ if (require.main === module) {\n  * Create the directory and marker files for the new example.\n  */\n function createEmptyExample(exampleName, examplePath) {\n+  validateExampleName(exampleName);\n   ensureExamplePath(examplePath);\n   writeExampleConfigFile(examplePath);\n   writeStackBlitzFile(exampleName, examplePath);\n }\n \n+function validateExampleName(exampleName) {\n+  if (/\\s/.test(exampleName)) {\n+    throw new Error(\n+      `Unable to create example. The example name contains spaces: '${exampleName}'`\n+    )\n+  }\n+}\n+\n /**\n  * Ensure that the new example directory exists.\n  */\n@@ -144,4 +153,4 @@ exports.ensureExamplePath = ensureExamplePath;\n exports.writeExampleConfigFile = writeExampleConfigFile;\n exports.writeStackBlitzFile = writeStackBlitzFile;\n exports.copyExampleFiles = copyExampleFiles;\n-exports.titleize = titleize;\n\\ No newline at end of file\n+exports.titleize = titleize;\n\n---\n file path A: aio/tools/examples/create-example.spec.js | file path B: aio/tools/examples/create-example.spec.js\n\n@@ -30,6 +30,12 @@ describe('create-example tool', () => {\n           .toHaveBeenCalledWith(\n               path.resolve(`/path/to/foo-bar/${STACKBLITZ_CONFIG_FILENAME}`), jasmine.any(String));\n     });\n+\n+    it('should fail if the example name contains spaces', () => {\n+        expect(() => createEmptyExample('foo bar', '/path/to/foo-bar')).toThrowError(\n+            `Unable to create example. The example name contains spaces: 'foo bar'`\n+      );\n+    });\n   });\n \n   describe('ensureExamplePath', () => {\n\n---\n file path A: aio/tools/transforms/cli-docs-package/index.js | file path B: aio/tools/transforms/cli-docs-package/index.js\n\n@@ -20,7 +20,7 @@ function resolveCliSourcePath() {\n     return path;\n   }\n   // Case: bazel test, find in runfiles\n-  return runfiles.resolveWorkspaceRelative('../angular_cli_src');\n+  return runfiles.resolve('angular_cli_src');\n }\n \n // Define the dgeni package for generating the docs\n\n\n###\n\n", "completion": "build(bazel): remaining AIO Bazel migration fixes"}
{"prompt": " file path A: aio/scripts/deploy-to-firebase/BUILD.bazel | file path B: aio/scripts/deploy-to-firebase/BUILD.bazel\n\n@@ -10,6 +10,7 @@ DEPLOY_TO_FIREBASE_SOURCES = glob(\n DEPLOY_TO_FIREBASE_DEPS = [\n     \"@aio_npm//shelljs\",\n     \"//aio:build\",\n+    \"//:package.json\",\n ]\n \n nodejs_binary(\n\n\n###\n\n", "completion": "build(bazel): add missing dependency to deploy script"}
{"prompt": " file path A: aio/content/examples/upgrade-phonecat-2-hybrid/BUILD.bazel | file path B: aio/content/examples/upgrade-phonecat-2-hybrid/BUILD.bazel\n\n@@ -5,6 +5,7 @@ package(default_visibility = [\"//visibility:public\"])\n \n docs_example(\n     name = \"upgrade-phonecat-2-hybrid\",\n+    flaky = True,  # TODO: figure out why this is flaky or times out\n     # This example downloads and inlines resources\n     test_exec_properties = ENABLE_NETWORK,\n     test_tags = [\"requires-network\"],\n\n---\n file path A: aio/content/examples/upgrade-phonecat-3-final/BUILD.bazel | file path B: aio/content/examples/upgrade-phonecat-3-final/BUILD.bazel\n\n@@ -4,4 +4,5 @@ package(default_visibility = [\"//visibility:public\"])\n \n docs_example(\n     name = \"upgrade-phonecat-3-final\",\n+    flaky = True,  # TODO: figure out why this is flaky or times out\n )\n\n\n###\n\n", "completion": "build(bazel): mark a couple of aio example tests as flaky"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -55,7 +55,7 @@ http_archive(\n # Download cli source from angular/cli-builds for doc generation at a specific tag or commit.\n # If the ref is a commit sha, use the full sha instead of the abbreviated form. Tags, which\n # hold an abbreviated sha by convention in cli-builds, can continue to use the short form.\n-CLI_SRC_REF = \"4a6e62d467dc20d4e5c3513fc6b3aa252f227697\"\n+CLI_SRC_REF = \"6ccbc6b4cba4fde7898b67d2e195a1ea3bf4553e\"\n \n http_archive(\n     name = \"angular_cli_src\",\n@@ -73,7 +73,7 @@ filegroup(\n     # Run the following command to calculate the sha256, substituting the CLI_SRC_REF\n     # wget -O- -q https://github.com/angular/cli-builds/archive/{CLI_SRC_REF}.tar.gz | sha256sum\n     # Alternatively, just remove the parameter and bazel debug will output the sha as a suggestion.\n-    sha256 = \"8cc176a6a0fec4902d9893e39594c69a3356f9caaf084f246a829578781ff406\",\n+    sha256 = \"6558e1774904719d0615f01b88368d7fe3a927ea1e54cb0436e7957bc8f6d0a6\",\n     strip_prefix = \"cli-builds-%s\" % CLI_SRC_REF,\n     url = \"https://github.com/angular/cli-builds/archive/%s.tar.gz\" % CLI_SRC_REF,\n )\n\n\n###\n\n", "completion": "build(bazel): update workspace cli sources ref"}
{"prompt": " file path A: .bazelrc | file path B: .bazelrc\n\n@@ -104,6 +104,10 @@ build:remote --remote_timeout=600\n build:remote --jobs=150\n build:remote --google_default_credentials\n \n+# Limit the number of test jobs for on an AIO local deps build. The example tests running\n+# concurrently pushes the circleci executor RAM usage to its limits.\n+test:aio_local_deps --jobs=24\n+\n # Force remote exeuctions to consider the entire run as linux\n build:remote --cpu=k8\n build:remote --host_cpu=k8\n\n---\n file path A: aio/content/examples/examples.bzl | file path B: aio/content/examples/examples.bzl\n\n@@ -99,7 +99,7 @@ EXAMPLES = {\n     \"what-is-angular\": {\"stackblitz\": True, \"zip\": True},\n }\n \n-def docs_example(name, test = True, test_tags = [], test_exec_properties = {}):\n+def docs_example(name, test = True, test_tags = [], test_exec_properties = {}, flaky = False):\n     \"\"\"Stamp targets for adding boilerplate to examples, creating live examples, and creating zips.\n \n     Args:\n@@ -216,6 +216,7 @@ def docs_example(name, test = True, test_tags = [], test_exec_properties = {}):\n                 \"@aio_npm//@angular/build-tooling/bazel/browsers/chromium:toolchain_alias\",\n             ],\n             exec_properties = test_exec_properties,\n+            flaky = flaky,\n             # RBE complains about superseeding the max inputs limit (70,000) due to the\n             # size of the input tree.\n             tags = [\"no-remote-exec\"] + test_tags,\n\n\n###\n\n", "completion": "build(bazel): tweak parallel jobs for AIO local deps ci"}
{"prompt": " file path A: aio/tools/examples/example-sandbox.mjs | file path B: aio/tools/examples/example-sandbox.mjs\n\n@@ -73,7 +73,7 @@ async function linkLocalDeps(exampleDepsNodeModules, linkedNodeModules, localPac\n \n   return Promise.all(Object.keys(localPackages).filter((pkgName, i) => hasNpmDepForPkg[i])\n     .map(pkgName => {\n-      const pkgJsonPath = path.join(LOCAL_PACKAGES[pkgName], 'package.json');\n+      const pkgJsonPath = path.join(localPackages[pkgName], 'package.json');\n       const pkgJson = JSON.parse(fs.readFileSync(pkgJsonPath, 'utf8'));\n       const linkedPkgPath = path.join(linkedNodeModules, pkgName);\n \n@@ -83,12 +83,12 @@ async function linkLocalDeps(exampleDepsNodeModules, linkedNodeModules, localPac\n       // into node_modules as a way of linking it. Currently, only the `upgrade-phonecat-hybrid-2`\n       // which calls `ngc` seems to need this.\n       if (pkgJson.bin) {\n-        fs.copySync(LOCAL_PACKAGES[pkgName], linkedPkgPath);\n+        fs.copySync(localPackages[pkgName], linkedPkgPath);\n         return;\n       }\n \n       // Standard case: just symlink the local package.\n-      fs.ensureSymlinkSync(LOCAL_PACKAGES[pkgName], linkedPkgPath, 'dir')\n+      fs.ensureSymlinkSync(localPackages[pkgName], linkedPkgPath, 'dir')\n     }));\n }\n \n\n\n###\n\n", "completion": "build(bazel): fix a regression when linking local packages for AIO example"}
{"prompt": " file path A: .bazelrc | file path B: .bazelrc\n\n@@ -52,6 +52,11 @@ build --enable_runfiles\n build:release --workspace_status_command=\"yarn -s ng-dev release build-env-stamp --mode=release\"\n build:release --stamp\n \n+# Building AIO against local Angular deps requires stamping\n+# versions in Angular packages due to CLI version checks.\n+build:aio_local_deps --stamp\n+build:aio_local_deps --workspace_status_command=\"yarn -s --cwd aio local-workspace-status\"\n+\n # Snapshots should also be stamped with version control information.\n build:snapshot-build --workspace_status_command=\"yarn -s ng-dev release build-env-stamp --mode=snapshot\"\n build:snapshot-build --stamp\n\n---\n file path A: .circleci/bazel.linux.rc | file path B: .circleci/bazel.linux.rc\n\n@@ -12,10 +12,10 @@ build --repository_cache=/home/circleci/bazel_repository_cache\n \n # Workaround https://github.com/bazelbuild/bazel/issues/3645\n # Bazel doesn't calculate the memory ceiling correctly when running under Docker.\n-# Limit Bazel to consuming resources that fit in CircleCI \"xlarge\" class\n+# Limit Bazel to consuming resources that fit in CircleCI \"2xlarge+\" class\n # https://circleci.com/docs/2.0/configuration-reference/#resource_class\n build --local_cpu_resources=20\n-build --local_ram_resources=32768\n+build --local_ram_resources=40960\n \n # All build executed remotely should be done using our RBE configuration.\n build:remote --google_default_credentials\n\n---\n file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -2,11 +2,12 @@ load(\"@aio_npm//@angular-devkit/architect-cli:index.bzl\", \"architect\", \"architec\n load(\"@build_bazel_rules_nodejs//:index.bzl\", \"copy_to_bin\", \"npm_package_bin\")\n load(\"//tools:defaults.bzl\", \"nodejs_binary\")\n load(\"@aspect_bazel_lib//lib:copy_to_directory.bzl\", \"copy_to_directory\")\n-load(\":local_packages_util.bzl\", \"link_local_packages\", \"substitute_local_packages\")\n+load(\":local_packages_util.bzl\", \"link_local_packages\", \"substitute_local_package_deps\")\n load(\"@bazel_skylib//rules:common_settings.bzl\", \"bool_flag\")\n load(\"//aio/scripts:local_server_test.bzl\", \"local_server_test\")\n load(\"@aio_npm//@angular/build-tooling/bazel/remote-execution:index.bzl\", \"ENABLE_NETWORK\")\n load(\":aio_targets.bzl\", \"aio_test\")\n+load(\"@bazel_skylib//lib:collections.bzl\", \"collections\")\n \n exports_files([\n     \"firebase.json\",\n@@ -115,6 +116,7 @@ APPLICATION_DEPS = [\n     \"@aio_npm//@angular/cli\",\n     \"@aio_npm//@angular/common\",\n     \"@aio_npm//@angular/compiler\",\n+    \"@aio_npm//@angular/compiler-cli\",\n     \"@aio_npm//@angular/core\",\n     \"@aio_npm//@angular/elements\",\n     \"@aio_npm//@angular/forms\",\n@@ -172,7 +174,7 @@ E2E_DEPS = APPLICATION_DEPS + [\n \n # Stamp npm_link targets for all dependencies that correspond to a\n # first-party equivalent pacakge in angular.\n-link_local_packages(deps = APPLICATION_DEPS)\n+link_local_packages(all_aio_deps = collections.uniq(APPLICATION_DEPS + TEST_DEPS + E2E_DEPS))\n \n copy_to_bin(\n     name = \"application_files_bin\",\n@@ -188,7 +190,7 @@ architect(\n     chdir = \"$(RULEDIR)\",\n     configuration_env_vars = [\"NG_BUILD_CACHE\"],\n     data = [\":application_files_bin\"] + select({\n-        \":aio_local_deps\": substitute_local_packages(APPLICATION_DEPS),\n+        \":aio_local_deps\": substitute_local_package_deps(APPLICATION_DEPS),\n         \"//conditions:default\": APPLICATION_DEPS,\n     }),\n     output_dir = True,\n@@ -227,7 +229,7 @@ copy_to_directory(\n )\n \n TEST_DATA = TEST_FILES + select({\n-    \":aio_local_deps\": substitute_local_packages(TEST_DEPS),\n+    \":aio_local_deps\": substitute_local_package_deps(TEST_DEPS),\n     \"//conditions:default\": TEST_DEPS,\n })\n \n@@ -265,7 +267,7 @@ architect_test(\n     chdir = package_name(),\n     configuration_env_vars = [\"NG_BUILD_CACHE\"],\n     data = E2E_FILES + select({\n-        \":aio_local_deps\": substitute_local_packages(E2E_DEPS),\n+        \":aio_local_deps\": substitute_local_package_deps(E2E_DEPS),\n         \"//conditions:default\": E2E_DEPS,\n     }),\n     env = {\n@@ -289,7 +291,7 @@ architect(\n     ],\n     chdir = package_name(),\n     data = APPLICATION_FILES + select({\n-        \":aio_local_deps\": substitute_local_packages(APPLICATION_DEPS),\n+        \":aio_local_deps\": substitute_local_package_deps(APPLICATION_DEPS),\n         \"//conditions:default\": APPLICATION_DEPS,\n     }),\n     tags = [\"ibazel_notify_changes\"],\n@@ -306,7 +308,7 @@ nodejs_binary(\n     data = APPLICATION_FILES + [\n         \"//aio/scripts:fast-serve-and-watch\",\n     ] + select({\n-        \":aio_local_deps\": substitute_local_packages(APPLICATION_DEPS),\n+        \":aio_local_deps\": substitute_local_package_deps(APPLICATION_DEPS),\n         \"//conditions:default\": APPLICATION_DEPS,\n     }),\n     enable_linker = True,\n\n---\n file path A: aio/local_packages_util.bzl | file path B: aio/local_packages_util.bzl\n\n@@ -1,47 +1,130 @@\n load(\"//:packages.bzl\", \"ALL_PACKAGES\", \"to_package_label\")\n load(\"@build_bazel_rules_nodejs//internal/linker:npm_link.bzl\", \"npm_link\")\n+load(\"@build_bazel_rules_nodejs//:providers.bzl\", \"LinkablePackageInfo\")\n+load(\"@build_bazel_rules_nodejs//internal/linker:link_node_modules.bzl\", \"LinkerPackageMappingInfo\")\n \n-def link_local_packages(deps):\n-    \"\"\"Stamp npm_link targets for packages in deps that has a local package equivalent.\n+def _is_angular_dep(dep):\n+    \"\"\"Check if a dep , e.g., @aio_npm//@angular/core corresonds to a local Angular pacakge.\"\"\"\n+    return dep.startswith(\"@aio_npm//\") and _angular_dep_to_pkg_name(dep) in ALL_PACKAGES\n+\n+def _angular_dep_to_pkg_name(dep):\n+    \"\"\"E.g., @aio_npm//@angular/core => '@angular/core'\"\"\"\n+    label = Label(dep)\n+    return label.package\n+\n+def link_local_packages(all_aio_deps):\n+    \"\"\"Create targets needed for building AIO against local angular packages.\n+\n+    Creates targets that link Angular packages, as well as targets to be used\n+    in place of any deps required to build and test AIO. These targets filter\n+    out any transitive deps on the npm packages and must be used in place of\n+    any original list of deps.\n+\n+    Use the helper `substitute_local_package_deps()` to translate a list of deps\n+    to the equivalent \"filtered\" target that this rule creates.\n \n     Args:\n-        deps: list of npm dependency labels\n+        all_aio_deps: label list of all deps required to build and test AIO\n     \"\"\"\n-    for dep in deps:\n-        if dep.startswith(\"@aio_npm//\"):\n-            label = Label(dep)\n-            if label.package in ALL_PACKAGES:\n-                npm_link(\n-                    name = _npm_link_name(dep),\n-                    target = to_package_label(label.package),\n-                    package_name = label.package,\n-                    package_path = native.package_name(),\n-                    tags = [\"manual\"],\n-                )\n-\n-def substitute_local_packages(deps):\n-    \"\"\"Substitute npm dependencies for their local npm_link equivalent.\n-\n-    Assumes that link_local_packages() was already called on these dependencies.\n-    Dependencies that are not associated with a local package are left alone.\n+\n+    aio_angular_deps = [dep for dep in all_aio_deps if _is_angular_dep(dep)]\n+    angular_packages = [_angular_dep_to_pkg_name(dep) for dep in aio_angular_deps]\n+\n+    # Link local angular packages in place of their npm equivalent\n+    for dep in aio_angular_deps:\n+        pkg_name = _angular_dep_to_pkg_name(dep)\n+        npm_link(\n+            name = _npm_link_name(pkg_name),\n+            target = to_package_label(pkg_name),\n+            package_name = pkg_name,\n+            package_path = native.package_name(),\n+            tags = [\"manual\"],\n+        )\n+\n+    # Special case deps that must be testonly\n+    testonly_deps = [\n+        \"@aio_npm//@angular/build-tooling/bazel/browsers/chromium\",\n+    ]\n+\n+    # Stamp a corresponding target for each AIO dep that filters out transitive\n+    # dependencies on angular npm packages. This help the rules_nodejs linker,\n+    # which fails to link local packages a transitive dependency on the npm\n+    # package exists.\n+    for dep in all_aio_deps:\n+        target = dep\n+        if dep in aio_angular_deps:\n+            pkg_name = _angular_dep_to_pkg_name(dep)\n+\n+            # We don't need to filter transitives on local packages as they depend\n+            # on each other locally.\n+            native.alias(\n+                name = _filtered_transitives_name(dep),\n+                actual = \":%s\" % _npm_link_name(pkg_name),\n+                tags = [\"manual\"],\n+            )\n+        else:\n+            filter_transitive_angular_deps(\n+                name = _filtered_transitives_name(dep),\n+                target = target,\n+                angular_packages = angular_packages,\n+                testonly = True if dep in testonly_deps else False,\n+                tags = [\"manual\"],\n+            )\n+\n+def substitute_local_package_deps(deps):\n+    \"\"\"Substitute AIO dependencies with an equivalent target that filters\n+    out any transitive npm dependencies. You should call link_local_packages()\n+    to actually stamp the targets first.\n \n     Args:\n-        deps: list of npm dependency labels\n+        deps: list of AIO dependencies\n \n     Returns:\n         substituted list of dependencies\n     \"\"\"\n-    substituted = []\n-    for dep in deps:\n-        if dep.startswith(\"@aio_npm//\"):\n-            label = Label(dep)\n-            if label.package in ALL_PACKAGES:\n-                substituted.append(_npm_link_name(dep))\n-                continue\n-\n-        substituted.append(dep)\n-    return substituted\n-\n-def _npm_link_name(dep):\n-    label = Label(dep)\n-    return \"local_%s\" % label.package.replace(\"@\", \"_\").replace(\"/\", \"_\")\n+\n+    return [\":%s\" % _filtered_transitives_name(dep) for dep in deps]\n+\n+def _npm_link_name(pkg_name):\n+    return \"local_%s\" % pkg_name.replace(\"@\", \"_\").replace(\"/\", \"_\")\n+\n+def _filtered_transitives_name(dep):\n+    if dep.startswith(\":\"):\n+        return \"%s_filtered\" % dep[1:]\n+    else:\n+        label = Label(dep)\n+        return \"%s_filtered\" % label.package.replace(\"@\", \"_\").replace(\"/\", \"_\")\n+\n+def _filter_transitive_angular_deps_impl(ctx):\n+    paths = [\"external/aio_npm/node_modules/%s\" % pkg for pkg in ctx.attr.angular_packages]\n+\n+    filtered_deps = []\n+\n+    # Note: to_list() is expensive; we need to invoke it here to get the path\n+    # of each transitive dependency to check if it's an angular npm package.\n+    for file in ctx.attr.target[DefaultInfo].default_runfiles.files.to_list():\n+        if not any([file.path.startswith(path) for path in paths]):\n+            filtered_deps.append(file)\n+\n+    filtered_depset = depset(filtered_deps)\n+    providers = [\n+        DefaultInfo(\n+            files = filtered_depset,\n+        ),\n+    ]\n+\n+    if LinkerPackageMappingInfo in ctx.attr.target:\n+        providers.append(ctx.attr.target[LinkerPackageMappingInfo])\n+    if LinkablePackageInfo in ctx.attr.target:\n+        providers.append(ctx.attr.target[LinkablePackageInfo])\n+\n+    return providers\n+\n+filter_transitive_angular_deps = rule(\n+    doc = \"Filter out transitive angular dependencies from a target\",\n+    implementation = _filter_transitive_angular_deps_impl,\n+    attrs = {\n+        \"target\": attr.label(mandatory = True, doc = \"Target to filter\"),\n+        \"angular_packages\": attr.string_list(default = [], doc = \"Angular packages to filter\"),\n+    },\n+)\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -50,7 +50,8 @@\n     \"security-lint\": \"tsec -p tsconfig.app.json\",\n     \"~~audit-web-app\": \"node scripts/audit-web-app.mjs\",\n     \"~~check-env\": \"node scripts/check-environment\",\n-    \"~~light-server\": \"light-server --bind=localhost --historyindex=/index.html --no-reload\"\n+    \"~~light-server\": \"light-server --bind=localhost --historyindex=/index.html --no-reload\",\n+    \"local-workspace-status\": \"node scripts/local-workspace-status.mjs\"\n   },\n   \"//engines-comment\": \"If applicable, also update /package.json and /aio/tools/examples/shared/package.json\",\n   \"engines\": {\n\n---\n file path A: None | file path B: aio/scripts/local-workspace-status.mjs\n\n@@ -0,0 +1,22 @@\n+import fs from 'node:fs';\n+import path from 'node:path';\n+import url from 'node:url';\n+\n+/*\n+  Script to use as a Bazel workspace status command (https://bazel.build/docs/user-manual#workspace-status)\n+  when building AIO against local Angular packages (--config=aio_local_deps). This provides an Angular version\n+  stamp variable used to stamp the locally built Angular packages. We stamp the packages with whatever version\n+  of Angular AIO is currently using. In order for the architect build to succeed, we need to trick architect\n+  into thinking it's using compatible Angular versions even if the Angular version is actually futher ahead.\n+*/\n+\n+const __dirname = url.fileURLToPath(new URL('.', import.meta.url));\n+const pkgJsonPath = path.join(__dirname, '..', 'package.json');\n+const pkgJson = JSON.parse(fs.readFileSync(pkgJsonPath, 'utf8'));\n+\n+const aioAngularVersion = pkgJson.dependencies['@angular/core'].replace(/^[\\^~]/, '') + \"+locallySubstituted\";\n+\n+// Output the workspace status variable format to stdout so Bazel can read it\n+console.log(`\\\n+BUILD_SCM_VERSION ${aioAngularVersion}\n+`);\n\n\n###\n\n", "completion": "build(bazel): fix linking of local angular packages"}
{"prompt": " file path A: aio/README.md | file path B: aio/README.md\n\n@@ -32,6 +32,7 @@ Here are the most important tasks you might need to use:\n * `yarn create-example` - create a new example directory containing initial source files.\n * `yarn example-playground <exampleName>` - set up a playground to manually test an example combined with its boilerplate files\n   - `--local` - link locally build Angular packages as deps\n+  - `--watch` - update the playground when sources change\n \n * `yarn example-e2e` - run all e2e tests for examples. Available options:\n   - `--local`: run e2e tests against locally built Angular packages.\n\n---\n file path A: aio/tools/examples/BUILD.bazel | file path B: aio/tools/examples/BUILD.bazel\n\n@@ -93,8 +93,6 @@ js_library(\n     ],\n )\n \n-EXAMPLES_WITH_BOILERPLATE = [\"//aio/content/examples/%s\" % example for example in EXAMPLES]\n-\n LOCAL_PACKAGE_DEPS = [to_package_label(dep) for dep in AIO_EXAMPLE_PACKAGES]\n \n LOCAL_PACKAGE_ARGS = [\"--localPackage=%s#$(rootpath %s)\" % (\n@@ -102,20 +100,22 @@ LOCAL_PACKAGE_ARGS = [\"--localPackage=%s#$(rootpath %s)\" % (\n     to_package_label(dep),\n ) for dep in AIO_EXAMPLE_PACKAGES]\n \n-nodejs_binary(\n-    name = \"create-example-playground\",\n+[nodejs_binary(\n+    name = \"create-example-playground-%s\" % example,\n     args = select({\n         # Hardcode package names/paths in args\n         \"//aio:aio_local_deps\": LOCAL_PACKAGE_ARGS,\n         \"//conditions:default\": [],\n-    }),\n+    }) + [\"--example=%s\" % example],\n     data = [\n         \":example-sandbox\",\n         \"@aio_example_deps//:node_modules_files\",\n         \"@aio_npm//yargs\",\n-    ] + EXAMPLES_WITH_BOILERPLATE + select({\n+        \"//aio/content/examples/%s\" % example,\n+    ] + select({\n         \"//aio:aio_local_deps\": LOCAL_PACKAGE_DEPS,\n         \"//conditions:default\": [],\n     }),\n     entry_point = \"create-example-playground.mjs\",\n-)\n+    tags = [\"manual\"],\n+) for example in EXAMPLES]\n\n---\n file path A: aio/tools/examples/create-example-playground-wrapper.mjs | file path B: aio/tools/examples/create-example-playground-wrapper.mjs\n\n@@ -2,6 +2,7 @@ import shelljs from 'shelljs';\n import yargs from 'yargs'\n import {hideBin} from 'yargs/helpers';\n import {getNativeBinary as getNativeBazelBinary} from '@bazel/bazelisk';\n+import {getNativeBinary as getNativeIBazelBinary} from '@bazel/ibazel';\n \n shelljs.set('-e')\n shelljs.set('-v')\n@@ -19,21 +20,21 @@ shelljs.set('-v')\n  * \n  * Flags:\n  *  --local: use locally built angular packages\n+ *  --watch: update playground when source files change\n  */\n \n const options = yargs(hideBin(process.argv))\n   .command('$0 <example>', 'Set up a playground for <example> in the source tree for manual testing')\n   .option('local', {default: false, type: 'boolean'})\n+  .option('watch', {default: false, type: 'boolean'})\n   .version(false)\n   .strict()\n   .argv;\n \n const cmd = [\n-  getNativeBazelBinary(),\n+  options.watch ? getNativeIBazelBinary() : getNativeBazelBinary(),\n   'run',\n-  '//aio/tools/examples:create-example-playground',\n-  '--',\n-  `--example=${options.example}`,\n+  `//aio/tools/examples:create-example-playground-${options.example}`,\n ];\n \n if (options.local) {\n\n---\n file path A: aio/tools/examples/create-example-playground.mjs | file path B: aio/tools/examples/create-example-playground.mjs\n\n@@ -17,12 +17,10 @@ const playgroundRoot = path.join(sourceRoot, 'aio', 'content', 'example-playgrou\n  * Create an example playground with shared example deps and optionally linked local\n  * angular packages in the source tree under content/examples/example-playground. This\n  * script is intended to only be run under bazel as it has the localPackage arguments\n- * hardcoded into the binary via starlark.\n+ * and example hardcoded into the binary via starlark.\n  *\n- * Usage: bazel run //aio/tools/examples:create-example-playground -- --example=<example>\n+ * Usage: bazel run //aio/tools/examples:create-example-playground-{EXAMPLE}\n  *\n- * Args:\n- *  example: name of the example\n  */\n \n async function main(args) {\n\n---\n file path A: aio/tools/examples/example-sandbox.mjs | file path B: aio/tools/examples/example-sandbox.mjs\n\n@@ -7,10 +7,15 @@ import os from 'node:os';\n // Construct a sandbox environment for an example, linking in shared example node_modules\n // and optionally linking in locally-built angular packages.\n export async function constructExampleSandbox(examplePath, destPath, nodeModulesPath, localPackages) {\n-  fs.rmSync(destPath, {\n-    recursive: true,\n-    force: true\n-  });\n+  // If the sandbox folder exists delete the contents but not the folder itself. If cd'ed\n+  // into the sandbox then bash will lose the reference and be stuck in a stray deleted folder,\n+  // creating a confusing experience. This is relevant for developer experience with ibazel.\n+  globbySync(`${destPath}/*`, {onlyFiles: false}).forEach(file => {\n+    fs.rmSync(file, {\n+      recursive: true,\n+      force: true\n+    });\n+  })\n   fs.copySync(examplePath, destPath);\n \n   // Remove write protection as the example was copied from bazel output tree\n\n\n###\n\n", "completion": "build(bazel): support ibazel for AIO example playgrounds"}
{"prompt": " file path A: aio/tools/examples/example-sandbox.mjs | file path B: aio/tools/examples/example-sandbox.mjs\n\n@@ -67,7 +67,24 @@ async function linkLocalDeps(exampleDepsNodeModules, linkedNodeModules, localPac\n     .map(pkgName => fs.pathExists(path.join(exampleDepsNodeModules, pkgName))));\n \n   return Promise.all(Object.keys(localPackages).filter((pkgName, i) => hasNpmDepForPkg[i])\n-    .map(pkgName => fs.ensureSymlinkSync(localPackages[pkgName], path.join(linkedNodeModules, pkgName), 'dir')));\n+    .map(pkgName => {\n+      const pkgJsonPath = path.join(LOCAL_PACKAGES[pkgName], 'package.json');\n+      const pkgJson = JSON.parse(fs.readFileSync(pkgJsonPath, 'utf8'));\n+      const linkedPkgPath = path.join(linkedNodeModules, pkgName);\n+\n+      // If a local package has bin entries and an example invokes one, then entrypoint\n+      // resolution escapes out of the sandboxed folder into the package folder in the output\n+      // tree and the bin cannot resolve its deps. To prevent this, copy the full local package\n+      // into node_modules as a way of linking it. Currently, only the `upgrade-phonecat-hybrid-2`\n+      // which calls `ngc` seems to need this.\n+      if (pkgJson.bin) {\n+        fs.copySync(LOCAL_PACKAGES[pkgName], linkedPkgPath);\n+        return;\n+      }\n+\n+      // Standard case: just symlink the local package.\n+      fs.ensureSymlinkSync(LOCAL_PACKAGES[pkgName], linkedPkgPath, 'dir')\n+    }));\n }\n \n // The .bin folder is copied over from the original yarn_install repository, so the\n@@ -85,12 +102,6 @@ function pointBinSymlinksToLocalPackages(linkedNodeModules, exampleDepsNodeModul\n     onlyFiles: true\n   });\n   allNodeModuleBins.forEach(bin => {\n-    // TODO: Swapping the symlink to ngc with the local package equivalent\n-    // doesn't seem to work. When ngc runs in upgrade-phonecat-2-hybrid via\n-    // the build:aot yarn script, node cannot resolve @angular/compiler.\n-    if (bin === 'ngc') {\n-      return;\n-    }\n     const symlinkTarget = fs.readlinkSync(path.join(linkedNodeModules, '.bin', bin));\n     for (const pkgName of Object.keys(localPackages)) {\n       const binMightBeInLocalPackage = symlinkTarget.includes(path.join(exampleDepsNodeModules, pkgName) + path\n\n\n###\n\n", "completion": "build(bazel): fix a bug where local ngc couldn't be linked into AIO example tests"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -302,6 +302,7 @@ architect(\n \n nodejs_binary(\n     name = \"docs-watch\",\n+    chdir = package_name(),\n     data = APPLICATION_FILES + [\n         \"//aio/scripts:fast-serve-and-watch\",\n     ] + select({\n\n---\n file path A: aio/scripts/fast-serve-and-watch.js | file path B: aio/scripts/fast-serve-and-watch.js\n\n@@ -7,7 +7,7 @@ const spawn = require(\"cross-spawn\");\n const watchr = require(\"../tools/transforms/authors-package/watchr.js\");\n const architectCli = require.resolve(\"@angular-devkit/architect-cli/bin/architect\");\n \n-const serve = spawn(architectCli, [\"site:serve\", \"--open\", \"--poll=1000\", \"--live-reload\", \"--watch\"], {stdio: \"inherit\"});\n+const serve = spawn(process.execPath, ['--preserve-symlinks', architectCli, \"site:serve\", \"--open\", \"--poll=1000\", \"--live-reload\", \"--watch\"], {stdio: \"inherit\"});\n serve.on(\"error\", error => {\n     console.error(\"architect serve script failed\");\n     console.error(error);\n\n---\n file path A: aio/tools/transforms/config.js | file path B: aio/tools/transforms/config.js\n\n@@ -5,10 +5,10 @@ const { readdirSync } = require('fs');\n // directory (TEST_TMPDIR) that bazel provides for tests.\n const BAZEL_OUTPUT_PATH = process.env.BAZEL_DGENI_OUTPUT_PATH || process.env.TEST_TMPDIR;\n \n-// The current directory is always the correct project root. During a build, this evalutates\n-// to the exec root. During the \"fast-serve\" bazel run mode, it resolves to the runfiles root\n-// of the fast serve binary.\n-const PROJECT_ROOT = resolve('.');\n+// During a build the project root resolves to the execroot. During docs-watch,\n+// we set the project root to the root of the source tree so that we can watch\n+// changes to docs files.\n+const PROJECT_ROOT = process.env.BUILD_WORKSPACE_DIRECTORY || resolve('.');\n \n const AIO_PATH = resolve(PROJECT_ROOT, 'aio');\n const TEMPLATES_PATH = resolve(AIO_PATH, 'tools/transforms/templates');\n\n\n###\n\n", "completion": "build(bazel): fix regressions for docs-watch"}
{"prompt": " file path A: aio/tools/transforms/angular-api-package/processors/fixupProjectRelativePath.js | file path B: aio/tools/transforms/angular-api-package/processors/fixupProjectRelativePath.js\n\n@@ -4,7 +4,7 @@ module.exports = function fixupProjectRelativePath(API_DOC_TYPES) {\n     $runBefore: ['processing-docs'],\n     $process(docs) {\n       docs.forEach(doc => {\n-        if (API_DOC_TYPES.indexOf(doc.docType) !== -1 && doc.fileInfo && doc.fileInfo.projectRelativePath) {\n+        if (API_DOC_TYPES.indexOf(doc.docType) !== -1 && doc.fileInfo && doc.fileInfo.realFilePath) {\n           // this is an API doc - so fix up its real path\n           doc.fileInfo.projectRelativePath = 'packages/' + doc.fileInfo.projectRelativePath;\n         }\n\n---\n file path A: aio/tools/transforms/angular-api-package/processors/fixupProjectRelativePath.spec.js | file path B: aio/tools/transforms/angular-api-package/processors/fixupProjectRelativePath.spec.js\n\n@@ -16,18 +16,18 @@ describe('fixupProjectRelativePath processor', () => {\n   it('should add `packages` segment to the start of `projectRelativePath` for API docs', () => {\n     const processor = processorFactory(['class', 'member']);\n     const docs = [\n-      { docType: 'class', fileInfo: { projectRelativePath: 'a/b/c' } },\n-      { docType: 'member', fileInfo: { projectRelativePath: 'a/b/c/d' } },\n-      { docType: 'cli-command', fileInfo: { projectRelativePath: 'a/b/c' } },\n+      { docType: 'class', fileInfo: { projectRelativePath: 'a/b/c', realFilePath: '/root/a/b/c' } },\n+      { docType: 'member', fileInfo: { projectRelativePath: 'a/b/c/d', realFilePath: '/root/a/b/c/d' } },\n+      { docType: 'cli-command', fileInfo: { projectRelativePath: 'a/b/c', realFilePath: '/root/a/b/c' } },\n       { docType: 'class', fileInfo: { } },\n       { docType: 'class' },\n     ];\n     processor.$process(docs);\n \n     expect(docs).toEqual([\n-      { docType: 'class', fileInfo: { projectRelativePath: 'packages/a/b/c' } },\n-      { docType: 'member', fileInfo: { projectRelativePath: 'packages/a/b/c/d' } },\n-      { docType: 'cli-command', fileInfo: { projectRelativePath: 'a/b/c' } },\n+      { docType: 'class', fileInfo: { projectRelativePath: 'packages/a/b/c', realFilePath: '/root/a/b/c' } },\n+      { docType: 'member', fileInfo: { projectRelativePath: 'packages/a/b/c/d', realFilePath: '/root/a/b/c/d' } },\n+      { docType: 'cli-command', fileInfo: { projectRelativePath: 'a/b/c', realFilePath: '/root/a/b/c' } },\n       { docType: 'class', fileInfo: { } },\n       { docType: 'class' },\n     ]);\n\n\n###\n\n", "completion": "build(bazel): fix a regression where github links were incorrectly"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -33,7 +33,12 @@ npm_package_bin(\n     name = \"dgeni\",\n     # angular.io-package is a js_library target, which copies sources to $(BINDIR)\n     args = [\"./$(BINDIR)/aio/tools/transforms/angular.io-package\"],\n-    data = [\"//aio/tools/transforms/angular.io-package\"],\n+    data = [\n+        \"//aio/tools/transforms/angular.io-package\",\n+        # Dgeni typescript package crawls type definitions for Angular dependencies\n+        \"@npm//rxjs\",\n+        \"@npm//@types/node\",\n+    ],\n     env = {\n         \"BAZEL_DGENI_OUTPUT_PATH\": \"$(@D)\",\n         \"GIT_BIN\": \"$(GIT_BIN_PATH)\",\n@@ -42,7 +47,9 @@ npm_package_bin(\n     output_dir = True,\n     stamp = \"@rules_nodejs//nodejs/stamp:always\",\n     # Makes remote git calls to get previous versions\n-    tags = [\"requires-network\"],\n+    tags = [\n+        \"requires-network\",\n+    ],\n     tool = \"@aio_npm//dgeni/bin:dgeni\",\n     toolchains = [\n         \"@npm//@angular/build-tooling/bazel/git-toolchain:current_git_toolchain\",\n\n---\n file path A: packages.bzl | file path B: packages.bzl\n\n@@ -57,6 +57,7 @@ DOCS_ENTRYPOINTS = [\n     \"common/http/testing\",\n     \"common/testing\",\n     \"common/upgrade\",\n+    \"compiler\",\n     \"core\",\n     \"core/src/compiler\",\n     \"core/src/di/interface\",\n\n---\n file path A: packages/compiler/BUILD.bazel | file path B: packages/compiler/BUILD.bazel\n\n@@ -41,3 +41,11 @@ ng_package(\n         \"//packages/compiler/testing\",\n     ],\n )\n+\n+filegroup(\n+    name = \"files_for_docgen\",\n+    srcs = glob([\n+        \"*.ts\",\n+        \"src/**/*.ts\",\n+    ]),\n+)\n\n\n###\n\n", "completion": "build(bazel): fix missing dgeni dependencies"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -25,11 +25,8 @@ http_archive(\n \n http_archive(\n     name = \"build_bazel_rules_nodejs\",\n-    patches = [\n-        \"//:tools/bazel-repo-patches/rules_nodejs__b02128b178.patch\",\n-    ],\n-    sha256 = \"b011d6206e4e76696eda8287618a2b6375ff862317847cdbe38f8d0cd206e9ce\",\n-    urls = [\"https://github.com/bazelbuild/rules_nodejs/releases/download/5.6.0/rules_nodejs-5.6.0.tar.gz\"],\n+    sha256 = \"c29944ba9b0b430aadcaf3bf2570fece6fc5ebfb76df145c6cdad40d65c20811\",\n+    urls = [\"https://github.com/bazelbuild/rules_nodejs/releases/download/5.7.0/rules_nodejs-5.7.0.tar.gz\"],\n )\n \n load(\"@build_bazel_rules_nodejs//:repositories.bzl\", \"build_bazel_rules_nodejs_dependencies\")\n\n---\n file path A: tools/bazel-repo-patches/rules_nodejs__b02128b178.patch | file path B: None\n\n@@ -1,148 +0,0 @@\n-diff --git internal/node/launcher.sh internal/node/launcher.sh\n-index d0e8df9..a830907 100755\n---- internal/node/launcher.sh\n-+++ internal/node/launcher.sh\n-@@ -14,7 +14,7 @@\n- # limitations under the License.\n- \n- # It helps to determine if we are running on a Windows environment (excludes WSL as it acts like Unix)\n--function isWindows {\n-+function is_windows {\n-   case \"$(uname -s)\" in\n-       CYGWIN*)    local IS_WINDOWS=1 ;;\n-       MINGW*)     local IS_WINDOWS=1 ;;\n-@@ -29,14 +29,13 @@ function isWindows {\n- # It helps to normalizes paths when running on Windows.\n- #\n- # Example:\n--# C:/Users/XUser/_bazel_XUser/7q7kkv32/execroot/A/b/C -> /c/users/xuser/_bazel_xuser/7q7kkv32/execroot/a/b/c\n--function normalizeWindowsPath {\n--  # Apply the followings paths transformations to normalize paths on Windows\n--  # -process driver letter\n--  # -convert path separator\n--  # -lowercase everything\n--  echo $(sed -e 's#^\\(.\\):#/\\L\\1#' -e 's#\\\\#/#g' -e 's/[A-Z]/\\L&/g' <<< \"$1\")\n--  return\n-+# C:/Users/XUser/_bazel_XUser/7q7kkv32/execroot/A/b/C -> /c/Users/XUser/_bazel_XUser/7q7kkv32/execroot/A/b/C\n-+function normalize_windows_path {\n-+    # Apply the followings paths transformations to normalize paths on Windows\n-+    # -process driver letter\n-+    # -convert path separator\n-+    sed -e 's#^\\(.\\):#/\\L\\1#' -e 's#\\\\#/#g' <<< \"$1\"\n-+    return\n- }\n- \n- # --- begin runfiles.bash initialization v2 ---\n-@@ -73,51 +72,71 @@ source \"${RUNFILES_DIR:-/dev/null}/$f\" 2>/dev/null || \\\n- # blaze.\n- # Case 5a is handled like case 1.\n- # Case 6a is handled like case 3.\n--if [[ -n \"${RUNFILES_MANIFEST_ONLY:-}\" ]]; then\n--  # Windows only has a manifest file instead of symlinks.\n--  if [[ $(isWindows) -eq \"1\" ]]; then\n--    # If Windows normalizing the path and case insensitive removing the `/MANIFEST` part of the path\n--    NORMALIZED_RUNFILES_MANIFEST_FILE_PATH=$(normalizeWindowsPath $RUNFILES_MANIFEST_FILE)\n--    RUNFILES=$(sed 's|\\/MANIFEST$||i' <<< $NORMALIZED_RUNFILES_MANIFEST_FILE_PATH)\n--  else\n--    RUNFILES=${RUNFILES_MANIFEST_FILE%/MANIFEST}\n--  fi\n--elif [[ -n \"${TEST_SRCDIR:-}\" ]]; then\n--  # Case 4, bazel has identified runfiles for us.\n--  RUNFILES=\"${TEST_SRCDIR:-}\"\n--else\n--  case \"$0\" in\n--  /*) self=\"$0\" ;;\n--  *) self=\"$PWD/$0\" ;;\n--  esac\n--  while true; do\n--    if [[ -e \"$self.runfiles\" ]]; then\n--      RUNFILES=\"$self.runfiles\"\n--      break\n--    fi\n--\n--    if [[ $self == *.runfiles/* ]]; then\n--      RUNFILES=\"${self%%.runfiles/*}.runfiles\"\n--      # don't break; this is a last resort for case 6b\n-+if [ \"${TEST_SRCDIR:-}\" ]; then\n-+    # Case 4, bazel has identified runfiles for us.\n-+    if [ \"$(is_windows)\" -eq \"1\" ]; then\n-+        # If Windows, normalize the path\n-+        RUNFILES=$(normalize_windows_path \"$TEST_SRCDIR\")\n-+    else\n-+        RUNFILES=\"$TEST_SRCDIR\"\n-     fi\n--\n--    if [[ ! -L \"$self\" ]]; then\n--      break;\n-+elif [ \"${RUNFILES_MANIFEST_FILE:-}\" ]; then\n-+    if [ \"$(is_windows)\" -eq \"1\" ]; then\n-+        # If Windows, normalize the path\n-+        NORMALIZED_RUNFILES_MANIFEST_FILE=$(normalize_windows_path \"$RUNFILES_MANIFEST_FILE\")\n-+    else\n-+        NORMALIZED_RUNFILES_MANIFEST_FILE=\"$RUNFILES_MANIFEST_FILE\"\n-     fi\n--\n--    readlink=\"$(readlink \"$self\")\"\n--    if [[ \"$readlink\" = /* ]]; then\n--      self=\"$readlink\"\n-+    if [[ \"${NORMALIZED_RUNFILES_MANIFEST_FILE}\" == *.runfiles_manifest ]]; then\n-+        # Newer versions of Bazel put the manifest besides the runfiles with the suffix .runfiles_manifest.\n-+        # For example, the runfiles directory is named my_binary.runfiles then the manifest is beside the\n-+        # runfiles directory and named my_binary.runfiles_manifest\n-+        RUNFILES=${NORMALIZED_RUNFILES_MANIFEST_FILE%_manifest}\n-+    elif [[ \"${NORMALIZED_RUNFILES_MANIFEST_FILE}\" == */MANIFEST ]]; then\n-+        # Older versions of Bazel put the manifest file named MANIFEST in the runfiles directory\n-+        RUNFILES=${NORMALIZED_RUNFILES_MANIFEST_FILE%/MANIFEST}\n-     else\n--      # resolve relative symlink\n--      self=\"${self%%/*}/$readlink\"\n-+        echo \"\\n>>>> FAIL: Unexpected RUNFILES_MANIFEST_FILE value $RUNFILES_MANIFEST_FILE. <<<<\\n\\n\" >&2\n-+        exit 1\n-     fi\n--  done\n--\n--  if [[ -z \"$RUNFILES\" ]]; then\n--    echo \" >>>> FAIL: RUNFILES environment variable is not set. <<<<\" >&2\n--    exit 1\n--  fi\n-+else\n-+    case \"$0\" in\n-+    /*) self=\"$0\" ;;\n-+    *) self=\"$PWD/$0\" ;;\n-+    esac\n-+    while true; do\n-+        if [ -e \"$self.runfiles\" ]; then\n-+            RUNFILES=\"$self.runfiles\"\n-+            break\n-+        fi\n-+\n-+        if [[ \"$self\" == *.runfiles/* ]]; then\n-+            RUNFILES=\"${self%%.runfiles/*}.runfiles\"\n-+            # don't break; this is a last resort for case 6b\n-+        fi\n-+\n-+        if [ ! -L \"$self\" ]; then\n-+            break;\n-+        fi\n-+\n-+        readlink=\"$(readlink \"$self\")\"\n-+        if [[ \"$readlink\" == /* ]]; then\n-+            self=\"$readlink\"\n-+        else\n-+            # resolve relative symlink\n-+            self=\"${self%%/*}/$readlink\"\n-+        fi\n-+    done\n-+\n-+    if [ -z \"${RUNFILES:-}\" ]; then\n-+        echo \"\\n>>>> FAIL: RUNFILES environment variable is not set. <<<<\\n\\n\" >&2\n-+        exit 1\n-+    fi\n-+fi\n-+if [ \"${RUNFILES:0:1}\" != \"/\" ]; then\n-+    # Ensure RUNFILES set above is an absolute path. It may be a path relative\n-+    # to the PWD in case where RUNFILES_MANIFEST_FILE is used above.\n-+    RUNFILES=\"$PWD/$RUNFILES\"\n- fi\n- export RUNFILES\n- # --- end RUNFILES initialization ---\n\n\n###\n\n", "completion": "build(bazel): update rnj and remove launcher patch"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -145,6 +145,7 @@ TEST_DEPS = APPLICATION_DEPS + [\n     \"@aio_npm//karma-coverage\",\n     \"@aio_npm//karma-jasmine\",\n     \"@aio_npm//karma-jasmine-html-reporter\",\n+    \"//aio/tools:windows-chromium-path\",\n ]\n \n # All sources, specs, and config files required to serve the app\n@@ -159,6 +160,7 @@ E2E_DEPS = APPLICATION_DEPS + [\n     \"@aio_npm//jasmine-spec-reporter\",\n     \"@aio_npm//protractor\",\n     \"@aio_npm//ts-node\",\n+    \"//aio/tools:windows-chromium-path\",\n ]\n \n # Stamp npm_link targets for all dependencies that correspond to a\n\n---\n file path A: aio/content/examples/examples.bzl | file path B: aio/content/examples/examples.bzl\n\n@@ -191,6 +191,7 @@ def docs_example(name, test = True, test_tags = [], test_exec_properties = {}):\n                 YARN_LABEL,\n                 \"@aio_npm//@angular/build-tooling/bazel/browsers/chromium\",\n                 \"//aio/tools/examples:run-example-e2e\",\n+                \"//aio/tools:windows-chromium-path\",\n                 # We install the whole node modules for runtime deps of e2e tests\n                 \"@{workspace}//:node_modules_files\".format(workspace = EXAMPLE_DEPS_WORKSPACE_NAME),\n             ] + select({\n\n---\n file path A: aio/karma.conf.js | file path B: aio/karma.conf.js\n\n@@ -1,28 +1,9 @@\n // Karma configuration file, see link for more information\n // https://karma-runner.github.io/1.0/config/configuration-file.html\n \n-const os = require('os');\n+const {getAdjustedChromeBinPathForWindows} = require('./tools/windows-chromium-path');\n \n-if (os.platform() === 'win32') {\n-  /*\n-    For some unknown reason, the symlinked copy of chromium under runfiles won't run under\n-    karma on Windows. Instead, modify the CHROME_BIN env var to point to the chrome binary\n-    under external/ in the execroot.\n-\n-    CHROME_BIN is set to the make var $(CHROMIUM) in aio/BUILD.bazel, which points to chrome\n-    under runfiles and thus starts with ../. Because we run architect with a chdir into aio,\n-    $(CHROMIUM) additionally has a second ../.\n-\n-    First, back out of\n-        bazel-out/x64_windows-fastbuild/bin/aio/test.bat.runfiles/angular/aio\n-    Then go into\n-        external/\n-    and then into\n-        org_chromium_chromium_windows/chrome-win\n-    to cancel out the leading ../../\n-  */\n-  process.env.CHROME_BIN = `../../../../../../../external/org_chromium_chromium_windows/chrome-win/${process.env.CHROME_BIN}`;\n-}\n+process.env.CHROME_BIN = getAdjustedChromeBinPathForWindows();\n \n module.exports = function (config) {\n   config.set({\n\n---\n file path A: aio/scripts/BUILD.bazel | file path B: aio/scripts/BUILD.bazel\n\n@@ -39,6 +39,7 @@ nodejs_binary(\n     name = \"audit-web-app\",\n     testonly = True,\n     data = [\n+        \"//aio/tools:windows-chromium-path\",\n         \"@aio_npm//@angular/build-tooling/bazel/browsers/chromium\",\n         \"@aio_npm//lighthouse\",\n         \"@aio_npm//lighthouse-logger\",\n\n---\n file path A: aio/scripts/audit-web-app.mjs | file path B: aio/scripts/audit-web-app.mjs\n\n@@ -27,9 +27,9 @@\n import lighthouse from 'lighthouse';\n import * as printer from 'lighthouse/lighthouse-cli/printer.js';\n import logger from 'lighthouse-logger';\n-import os from 'os';\n import puppeteer from 'puppeteer-core';\n import path from 'path';\n+import {getAdjustedChromeBinPathForWindows} from '../tools/windows-chromium-path.js';\n \n // Constants\n const AUDIT_CATEGORIES = ['accessibility', 'best-practices', 'performance', 'pwa', 'seo'];\n@@ -37,7 +37,7 @@ const LIGHTHOUSE_FLAGS = {logLevel: process.env.CI ? 'error' : 'info'};  // Be l\n const VIEWER_URL = 'https://googlechrome.github.io/lighthouse/viewer';\n const WAIT_FOR_SW_DELAY = 5000;\n \n-process.env.CHROME_BIN = adjustChromeBinPathForWindows();\n+process.env.CHROME_BIN = getAdjustedChromeBinPathForWindows();\n \n // Run\n _main(process.argv.slice(2));\n@@ -169,30 +169,3 @@ async function runLighthouse(browser, url, flags, config) {\n     await browser.close();\n   }\n }\n-\n-// TODO: this is a hack; the root cause should be found and fixed\n-function adjustChromeBinPathForWindows() {\n-  if (os.platform() === 'win32') {\n-    /*\n-      For some unknown reason, the symlinked copy of chromium under runfiles won't run under\n-      karma on Windows. Instead, modify the CHROME_BIN env var to point to the chrome binary\n-      under external/ in the execroot.\n-\n-      CHROME_BIN is equal to the make var $(CHROMIUM), which points to chrome relative\n-      to the runfiles root.\n-\n-      The org_chromium_chromium_windows/ in the path below is needed to cancel out the\n-      leading ../ in CHROME_BIN.\n-\n-      First, back out of\n-          bazel-out/x64_windows-fastbuild/bin/aio/scripts/audit-web-app.bat.runfiles/angular\n-      Then go into`\n-          external/\n-      and then into\n-          org_chromium_chromium_windows/\n-      to cancel out the leading ../ in CHROME_BIN\n-    */\n-   return path.resolve(`../../../../../../external/org_chromium_chromium_windows/${process.env.CHROME_BIN}`);\n-  }\n-  return process.env.CHROME_BIN;\n-}\n\n---\n file path A: aio/tests/e2e/protractor.conf.js | file path B: aio/tests/e2e/protractor.conf.js\n\n@@ -4,28 +4,9 @@\n \n const { SpecReporter, StacktraceOption } = require('jasmine-spec-reporter');\n const path = require('path')\n-const os = require('os');\n+const {getAdjustedChromeBinPathForWindows} = require('../../tools/windows-chromium-path');\n \n-if (os.platform() === 'win32') {\n-  /*\n-    For some unknown reason, the symlinked copy of chromium under runfiles won't run under\n-    karma on Windows. Instead, modify the CHROME_BIN env var to point to the chrome binary\n-    under external/ in the execroot.\n-\n-    CHROME_BIN is set to the make var $(CHROMIUM) in aio/BUILD.bazel, which points to chrome\n-    under runfiles and thus starts with ../. Because we run architect with a chdir into aio,\n-    $(CHROMIUM) additionally has a second ../.\n-\n-    First, back out of\n-        bazel-out/x64_windows-fastbuild/bin/aio/e2e.bat.runfiles/angular/aio\n-    Then go into\n-        external/\n-    and then into\n-        org_chromium_chromium_windows/chrome-win\n-    to cancel out the leading ../../\n-  */\n-  process.env.CHROME_BIN = `../../../../../../../external/org_chromium_chromium_windows/chrome-win/${process.env.CHROME_BIN}`;\n-}\n+process.env.CHROME_BIN = getAdjustedChromeBinPathForWindows();\n \n /**\n  * @type { import(\"protractor\").Config }\n\n---\n file path A: aio/tools/BUILD.bazel | file path B: aio/tools/BUILD.bazel\n\n@@ -0,0 +1,10 @@\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n+\n+package(default_visibility = [\"//aio:__subpackages__\"])\n+\n+js_library(\n+    name = \"windows-chromium-path\",\n+    srcs = [\n+        \"windows-chromium-path.js\",\n+    ],\n+)\n\n---\n file path A: aio/tools/examples/run-example-e2e.mjs | file path B: aio/tools/examples/run-example-e2e.mjs\n\n@@ -9,10 +9,11 @@ import yargs from 'yargs';\n import {hideBin} from 'yargs/helpers'\n import getPort from 'get-port';\n import {constructExampleSandbox} from \"./example-sandbox.mjs\";\n+import { getAdjustedChromeBinPathForWindows } from '../windows-chromium-path.js';\n \n shelljs.set('-e');\n \n-process.env.CHROME_BIN = adjustChromeBinPathForWindows();\n+process.env.CHROME_BIN = getAdjustedChromeBinPathForWindows();\n \n // Resolve CHROME_BIN and CHROMEDRIVER_BIN from relative paths to absolute paths within the\n // runfiles tree so that subprocesses spawned in a different working directory can still find them.\n@@ -329,31 +330,4 @@ function loadExampleConfig(exampleFolder) {\n   return config;\n }\n \n-// TODO: this is a hack; the root cause should be found and fixed\n-function adjustChromeBinPathForWindows() {\n-  if (os.platform() === 'win32') {\n-    /*\n-      For some unknown reason, the symlinked copy of chromium under runfiles won't run under\n-      karma on Windows. Instead, modify the CHROME_BIN env var to point to the chrome binary\n-      under external/ in the execroot.\n-\n-      CHROME_BIN is equal to the make var $(CHROMIUM), which points to chrome relative\n-      to the runfiles root.\n-\n-      The org_chromium_chromium_windows/ in the path below is needed to cancel out the\n-      leading ../ in CHROME_BIN.\n-\n-      First, back out of\n-          bazel-out/x64_windows-fastbuild/bin/aio/content/examples/{EXAMPLE}/e2e.bat.runfiles/angular\n-      Then go into\n-          external/\n-      and then into\n-          org_chromium_chromium_windows/\n-      to cancel out the leading ../ in CHROME_BIN\n-    */\n-   return path.join(`../../../../../../../../../external/org_chromium_chromium_windows/${process.env.CHROME_BIN}`);\n-  }\n-  return process.env.CHROME_BIN;\n-}\n-\n runE2e(EXAMPLE_PATH);\n\n---\n file path A: None | file path B: aio/tools/windows-chromium-path.js\n\n@@ -0,0 +1,41 @@\n+const os = require('os');\n+const path = require('path');\n+\n+/*\n+  TODO: this is a hack; the root cause should be found and fixed.\n+\n+  For some unknown reason, the symlinked copy of chromium under runfiles won't run under\n+  karma on Windows. To work around this, use chromium under the execroot in the external\n+  folder and point to that instead.\n+\n+  Return:\n+    The adjusted absolute chromium path to use on Windows. On other platforms this is a\n+    noop and returns the existing process.env.CHROME_BIN.\n+*/\n+exports.getAdjustedChromeBinPathForWindows = function() {\n+    if (os.platform() === 'win32') {\n+        const runfilesWorkspaceRoot = path.join(process.env.RUNFILES, 'angular');\n+\n+        // Get the path to chromium from the runfiles base folder. By default, the Bazel make var\n+        // $(CHROMIUM) (which CHROME_BIN is set to) has a preceeding '../' to escape the workspace\n+        // root within runfiles. Additional '../' may have been prepended to cancel out any chdirs.\n+        const chromiumPath = process.env.CHROME_BIN.replace(/^(\\.\\.\\/)*/, '');\n+\n+        // Escape from runfiles to the exec root\n+        const execRootSlashWorkspace = 'execroot' + path.sep + 'angular';\n+        const index = runfilesWorkspaceRoot.indexOf(execRootSlashWorkspace);\n+        const execRootPath = runfilesWorkspaceRoot.substring(0, index + execRootSlashWorkspace.length);\n+        const runfilesToExecRoot = path.relative(runfilesWorkspaceRoot, execRootPath);\n+\n+        // Resolve the path to chromium under the execroot\n+        const chromiumExecRootPath = path.resolve(\n+            runfilesWorkspaceRoot,\n+            runfilesToExecRoot,\n+            'external',\n+            chromiumPath\n+        );\n+\n+        return chromiumExecRootPath;\n+    }\n+    return process.env.CHROME_BIN;\n+}\n\n\n###\n\n", "completion": "build(bazel): consolidate windows chromium path workaround"}
{"prompt": " file path A: aio/angular.json | file path B: aio/angular.json\n\n@@ -49,9 +49,29 @@\n             \"sourceMap\": true,\n             \"namedChunks\": true,\n             \"assets\": [\n-              \"src/assets\",\n-              \"src/pwa-manifest.json\",\n-              \"src/google385281288605d160.html\",\n+              // Architect on Windows has difficulty service assets files within a\n+              // Bazel runfiles symlink forest. Using \"followSymlinks\" seems to\n+              // fix this. Note that the assets below don't need this workaround as\n+              // symlinked tree artifacts pointing to the output tree don't appear\n+              // to have the same issue.\n+              {\n+                \"followSymlinks\": true,\n+                \"input\": \"src/assets\",\n+                \"glob\": \"**/*\",\n+                \"output\": \"/assets/\"\n+              },\n+              {\n+                \"followSymlinks\": true,\n+                \"input\": \"src/\",\n+                \"glob\": \"**/pwa-manifest.json\",\n+                \"output\": \"/\"\n+              },\n+              {\n+                \"followSymlinks\": true,\n+                \"input\": \"src/\",\n+                \"glob\": \"**/google385281288605d160.html\",\n+                \"output\": \"/\"\n+              },\n               {\n                 \"input\": \"stackblitz/generated\",\n                 \"output\": \"generated\",\n\n\n###\n\n", "completion": "build(bazel): fix an AIO bug where symlinked assets were not loaded on"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -9,11 +9,7 @@\n     \"postinstall\": \"node tools/cli-patches/patch.js\",\n     \"prebuild\": \"yarn setup\",\n     \"build\": \"bazel build //aio:build --config=release\",\n-    \"prebuild-local\": \"yarn setup-local\",\n     \"build-local\": \"yarn build --config=aio_local_deps\",\n-    \"prebuild-local-ci\": \"yarn setup-local-ci\",\n-    \"build-local-ci\": \"yarn ~~build --progress=false\",\n-    \"extract-cli-command-docs\": \"node tools/transforms/cli-docs-package/extract-cli-commands.js 6ccbc6b4c\",\n     \"lint\": \"yarn check-env && yarn docs-lint && ng lint && yarn example-lint && yarn tools-lint && yarn security-lint\",\n     \"test\": \"bazel test //aio:test --test_output=streamed\",\n     \"test-and-watch\": \"ibazel test //aio:test-and-watch --test_output=streamed\",\n@@ -50,12 +46,10 @@\n     \"start-local\": \"yarn start --config=aio_local_deps\",\n     \"boilerplate:test\": \"bazel test //aio/tools/examples:example-boilerplate-test\",\n     \"create-example\": \"bazel run //aio/tools/examples:create-example\",\n-    \"build-404-page\": \"node scripts/build-404-page\",\n     \"update-webdriver\": \"node ../scripts/webdriver-manager-update.js\",\n     \"security-lint\": \"tsec -p tsconfig.app.json\",\n     \"~~audit-web-app\": \"node scripts/audit-web-app.mjs\",\n     \"~~check-env\": \"node scripts/check-environment\",\n-    \"post~~build\": \"yarn build-404-page\",\n     \"~~light-server\": \"light-server --bind=localhost --historyindex=/index.html --no-reload\"\n   },\n   \"//engines-comment\": \"If applicable, also update /package.json and /aio/tools/examples/shared/package.json\",\n\n\n###\n\n", "completion": "build(bazel): remove unused AIO package.json scripts"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -58,7 +58,7 @@ http_archive(\n # Download cli source from angular/cli-builds for doc generation at a specific tag or commit.\n # If the ref is a commit sha, use the full sha instead of the abbreviated form. Tags, which\n # hold an abbreviated sha by convention in cli-builds, can continue to use the short form.\n-CLI_SRC_REF = \"14d4d528c7c33df5b252d1f08b7420b2715d4218\"\n+CLI_SRC_REF = \"4a6e62d467dc20d4e5c3513fc6b3aa252f227697\"\n \n http_archive(\n     name = \"angular_cli_src\",\n@@ -76,7 +76,7 @@ filegroup(\n     # Run the following command to calculate the sha256, substituting the CLI_SRC_REF\n     # wget -O- -q https://github.com/angular/cli-builds/archive/{CLI_SRC_REF}.tar.gz | sha256sum\n     # Alternatively, just remove the parameter and bazel debug will output the sha as a suggestion.\n-    sha256 = \"d379afc2809076c8b5c669304f24f83e09e3d247351065000e813db055b140f3\",\n+    sha256 = \"8cc176a6a0fec4902d9893e39594c69a3356f9caaf084f246a829578781ff406\",\n     strip_prefix = \"cli-builds-%s\" % CLI_SRC_REF,\n     url = \"https://github.com/angular/cli-builds/archive/%s.tar.gz\" % CLI_SRC_REF,\n )\n\n\n###\n\n", "completion": "build(bazel): update CLI sources ref for aio build"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -40,6 +40,7 @@ npm_package_bin(\n     },\n     exec_properties = ENABLE_NETWORK,\n     output_dir = True,\n+    stamp = \"@rules_nodejs//nodejs/stamp:always\",\n     # Makes remote git calls to get previous versions\n     tags = [\"requires-network\"],\n     tool = \"@aio_npm//dgeni/bin:dgeni\",\n@@ -213,6 +214,7 @@ copy_to_directory(\n     replace_prefixes = {\n         \"build-app\": \"\",\n     },\n+    visibility = [\"//aio/scripts/deploy-to-firebase:__pkg__\"],\n )\n \n TEST_DATA = TEST_FILES + select({\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -8,7 +8,7 @@\n   \"scripts\": {\n     \"postinstall\": \"node tools/cli-patches/patch.js\",\n     \"prebuild\": \"yarn setup\",\n-    \"build\": \"bazel build //aio:build\",\n+    \"build\": \"bazel build //aio:build --config=release\",\n     \"prebuild-local\": \"yarn setup-local\",\n     \"build-local\": \"yarn build --config=aio_local_deps\",\n     \"prebuild-local-ci\": \"yarn setup-local-ci\",\n@@ -34,19 +34,19 @@\n     \"example-list-overrides\": \"bazel run //aio/tools/examples:example-boilerplate list-overrides\",\n     \"example-lint\": \"eslint content/examples\",\n     \"example-playground\": \"node ./tools/examples/create-example-playground-wrapper.mjs\",\n-    \"deploy-production\": \"bazel run //aio/scripts/deploy-to-firebase\",\n+    \"deploy-production\": \"bazel run //aio/scripts/deploy-to-firebase --config=release\",\n     \"check-env\": \"yarn ~~check-env\",\n     \"payload-size\": \"scripts/payload.sh\",\n     \"predocs\": \"node scripts/contributors/validate-data && bazel build -- //aio:stackblitz //aio:example-zips\",\n-    \"docs-watch\": \"bazel run //aio:docs-watch\",\n-    \"docs\": \"bazel build //aio:dgeni\",\n+    \"docs-watch\": \"bazel run //aio:docs-watch --config=release\",\n+    \"docs\": \"bazel build //aio:dgeni --config=release\",\n     \"docs-lint\": \"eslint --ignore-path=\\\"tools/transforms/.eslintignore\\\" tools/transforms\",\n     \"docs-test\": \"bazel test //aio/tools/transforms/...\",\n     \"redirects-test\": \"bazel test //aio/tests/deployment/unit:test\",\n     \"firebase-utils-test\": \"bazel test //aio/tools/firebase-test-utils:test\",\n     \"tools-lint\": \"eslint --ext=.mjs scripts/deploy-to-firebase && eslint tools/firebase-test-utils\",\n     \"tools-test\": \"bazel test -- //aio/tools/... //aio/scripts/deploy-to-firebase:test\",\n-    \"start\": \"ibazel run //aio:serve\",\n+    \"start\": \"ibazel run //aio:serve --config=release\",\n     \"start-local\": \"yarn start --config=aio_local_deps\",\n     \"boilerplate:test\": \"bazel test //aio/tools/examples:example-boilerplate-test\",\n     \"create-example\": \"bazel run //aio/tools/examples:create-example\",\n\n---\n file path A: aio/scripts/deploy-to-firebase/BUILD.bazel | file path B: aio/scripts/deploy-to-firebase/BUILD.bazel\n\n@@ -9,6 +9,7 @@ DEPLOY_TO_FIREBASE_SOURCES = glob(\n \n DEPLOY_TO_FIREBASE_DEPS = [\n     \"@aio_npm//shelljs\",\n+    \"//aio:build\",\n ]\n \n nodejs_binary(\n\n---\n file path A: aio/src/app/navigation/navigation.model.ts | file path B: aio/src/app/navigation/navigation.model.ts\n\n@@ -43,16 +43,6 @@ export interface CurrentNodes {\n }\n \n export interface VersionInfo {\n-  raw: string;\n   major: number;\n-  minor: number;\n-  patch: number;\n-  prerelease: string[];\n-  build: string;\n-  version: string;\n-  codeName: string;\n-  isSnapshot: boolean;\n   full: string;\n-  branch: string;\n-  commitSHA: string;\n }\n\n---\n file path A: aio/src/app/navigation/navigation.service.spec.ts | file path B: aio/src/app/navigation/navigation.service.spec.ts\n\n@@ -223,7 +223,7 @@ describe('NavigationService', () => {\n   });\n \n   describe('versionInfo', () => {\n-    const expectedVersionInfo = { raw: '4.0.0' } as VersionInfo;\n+    const expectedVersionInfo = { major: 4 } as VersionInfo;\n     let versionInfo: VersionInfo;\n \n     beforeEach(() => {\n\n---\n file path A: aio/tools/transforms/angular-base-package/index.js | file path B: aio/tools/transforms/angular-base-package/index.js\n\n@@ -43,6 +43,7 @@ module.exports = new Package('angular-base', [\n   .factory('packageInfo', function() { return require(path.resolve(PROJECT_ROOT, 'package.json')); })\n   .factory(require('./readers/json'))\n   .factory(require('./services/copyFolder'))\n+  .factory(require('./services/bazelStampedProperties'))\n   .factory(require('./services/getImageDimensions'))\n   .factory(require('./services/getPreviousMajorVersions'))\n   .factory(require('./services/auto-link-filters/filterPipes'))\n\n---\n file path A: None | file path B: aio/tools/transforms/angular-base-package/services/bazelStampedProperties.js\n\n@@ -0,0 +1,24 @@\n+'use strict';\n+\n+const fs = require('fs');\n+\n+/**\n+ * Provide stamped Bazel variables from the workspace status command.\n+ * \n+ * (see https://bazel.build/docs/user-manual#workspace-status)\n+ *\n+ * @returns a map of key-value pairs\n+ */\n+module.exports = function bazelStampedProperties() {\n+  const volatileStatus = fs.readFileSync(process.env.BAZEL_VERSION_FILE, 'utf8');\n+  const properties = {};\n+  for (const match of `\\n${volatileStatus}`.matchAll(/^([^\\s]+)\\s+(.*)/gm)) {\n+      // Lines which go unmatched define an index value of `0` and should be skipped.\n+      if (match.index === 0) {\n+          continue;\n+      }\n+      properties[match[1]] = match[2];\n+  }\n+\n+  return properties;\n+};\n\\ No newline at end of file\n\n---\n file path A: aio/tools/transforms/angular.io-package/processors/processNavigationMap.js | file path B: aio/tools/transforms/angular.io-package/processors/processNavigationMap.js\n\n@@ -1,4 +1,4 @@\n-module.exports = function processNavigationMap(versionInfo, getPreviousMajorVersions, log) {\n+module.exports = function processNavigationMap(versionInfo, bazelStampedProperties, getPreviousMajorVersions, log) {\n   return {\n     $runAfter: ['paths-computed'],\n     $runBefore: ['rendering-docs'],\n@@ -26,8 +26,15 @@ module.exports = function processNavigationMap(versionInfo, getPreviousMajorVers\n       navigationDoc.data['docVersions'] = getPreviousMajorVersions().map(\n           v => ({title: `v${v.major}`, url: `https://v${v.major}.angular.io/`}));\n \n-      // Add in the version data in a \"secret\" field to be extracted in the docs app\n-      navigationDoc.data['__versionInfo'] = versionInfo.currentVersion;\n+      // Add in version data in a \"secret\" field to be extracted in the docs app\n+      navigationDoc.data['__versionInfo'] = {\n+        major: versionInfo.currentVersion.major,\n+\n+        // The 'full' version needs the source tree SHA but this is not available in\n+        // the execroot where Bazel runs this build. Get the SHA from Bazel-stamped\n+        // workspace status information.\n+        full: `${versionInfo.currentVersion.version}+sha.${bazelStampedProperties.BUILD_SCM_ABBREV_HASH}`\n+      };\n     }\n   };\n };\n\n\n###\n\n", "completion": "build(bazel): use workspace status command for AIO version stamping"}
{"prompt": " file path A: packages.bzl | file path B: packages.bzl\n\n@@ -45,3 +45,60 @@ INTEGRATION_PACKAGES = _exclude_pkgs(ALL_PACKAGES, \"angular-in-memory-web-api\")\n \n # Packages used by example e2e tests\n AIO_EXAMPLE_PACKAGES = _exclude_pkgs(ALL_PACKAGES, \"@angular/benchpress\")\n+\n+# Package names under //packages that have `files_for_docgen` targets\n+# including files needed for AIO doc generation.\n+DOCS_ENTRYPOINTS = [\n+    \"animations\",\n+    \"animations/browser\",\n+    \"animations/browser/testing\",\n+    \"common\",\n+    \"common/http\",\n+    \"common/http/testing\",\n+    \"common/testing\",\n+    \"common/upgrade\",\n+    \"core\",\n+    \"core/src/compiler\",\n+    \"core/src/di/interface\",\n+    \"core/src/interface\",\n+    \"core/src/reflection\",\n+    \"core/src/util\",\n+    \"core/testing\",\n+    \"elements\",\n+    \"examples/common\",\n+    \"examples/core\",\n+    \"examples/core/di/ts/forward_ref\",\n+    \"examples/core/testing/ts\",\n+    \"examples/forms\",\n+    \"examples/platform-browser\",\n+    \"examples/router/activated-route\",\n+    \"examples/service-worker/push\",\n+    \"examples/service-worker/registration-options\",\n+    \"examples/test-utils\",\n+    \"examples/testing\",\n+    \"examples/upgrade/static/ts/full\",\n+    \"examples/upgrade/static/ts/lite\",\n+    \"examples/upgrade/static/ts/lite-multi\",\n+    \"examples/upgrade/static/ts/lite-multi-shared\",\n+    \"forms\",\n+    \"localize\",\n+    \"localize/init\",\n+    \"localize/src/localize\",\n+    \"localize/src/utils\",\n+    \"platform-browser\",\n+    \"platform-browser-dynamic\",\n+    \"platform-browser-dynamic/testing\",\n+    \"platform-browser/animations\",\n+    \"platform-browser/testing\",\n+    \"platform-server\",\n+    \"platform-server/init\",\n+    \"platform-server/testing\",\n+    \"router\",\n+    \"router/testing\",\n+    \"router/upgrade\",\n+    \"service-worker\",\n+    \"upgrade\",\n+    \"upgrade/src/common\",\n+    \"upgrade/static\",\n+    \"upgrade/static/testing\",\n+]\n\n---\n file path A: packages/BUILD.bazel | file path B: packages/BUILD.bazel\n\n@@ -1,4 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ts_config\", \"ts_library\")\n+load(\"//:packages.bzl\", \"DOCS_ENTRYPOINTS\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -37,62 +38,8 @@ exports_files([\n     \"examples\",\n ])\n \n-# Run the following command to regenerate this list of all files_for_docgen targets.\n-# bazel query 'attr(\"name\", \"files_for_docgen\", //packages/... -//packages:files_for_docgen)' --output=label 2> /dev/null | sort | sed -e \"s/\\(.*\\)/\\\"\\1\\\",/\"\n+# All docgen targets for AIO. Add package entrypoints to DOCS_ENTRYPOINTS in `packages.bzl`.\n filegroup(\n     name = \"files_for_docgen\",\n-    srcs = [\n-        \"//packages/animations:files_for_docgen\",\n-        \"//packages/animations/browser:files_for_docgen\",\n-        \"//packages/animations/browser/testing:files_for_docgen\",\n-        \"//packages/common:files_for_docgen\",\n-        \"//packages/common/http:files_for_docgen\",\n-        \"//packages/common/http/testing:files_for_docgen\",\n-        \"//packages/common/testing:files_for_docgen\",\n-        \"//packages/common/upgrade:files_for_docgen\",\n-        \"//packages/core:files_for_docgen\",\n-        \"//packages/core/src/compiler:files_for_docgen\",\n-        \"//packages/core/src/di/interface:files_for_docgen\",\n-        \"//packages/core/src/interface:files_for_docgen\",\n-        \"//packages/core/src/reflection:files_for_docgen\",\n-        \"//packages/core/src/util:files_for_docgen\",\n-        \"//packages/core/testing:files_for_docgen\",\n-        \"//packages/elements:files_for_docgen\",\n-        \"//packages/examples/common:files_for_docgen\",\n-        \"//packages/examples/core:files_for_docgen\",\n-        \"//packages/examples/core/di/ts/forward_ref:files_for_docgen\",\n-        \"//packages/examples/core/testing/ts:files_for_docgen\",\n-        \"//packages/examples/forms:files_for_docgen\",\n-        \"//packages/examples/platform-browser:files_for_docgen\",\n-        \"//packages/examples/router/activated-route:files_for_docgen\",\n-        \"//packages/examples/service-worker/push:files_for_docgen\",\n-        \"//packages/examples/service-worker/registration-options:files_for_docgen\",\n-        \"//packages/examples/test-utils:files_for_docgen\",\n-        \"//packages/examples/testing:files_for_docgen\",\n-        \"//packages/examples/upgrade/static/ts/full:files_for_docgen\",\n-        \"//packages/examples/upgrade/static/ts/lite:files_for_docgen\",\n-        \"//packages/examples/upgrade/static/ts/lite-multi:files_for_docgen\",\n-        \"//packages/examples/upgrade/static/ts/lite-multi-shared:files_for_docgen\",\n-        \"//packages/forms:files_for_docgen\",\n-        \"//packages/localize:files_for_docgen\",\n-        \"//packages/localize/init:files_for_docgen\",\n-        \"//packages/localize/src/localize:files_for_docgen\",\n-        \"//packages/localize/src/utils:files_for_docgen\",\n-        \"//packages/platform-browser:files_for_docgen\",\n-        \"//packages/platform-browser-dynamic:files_for_docgen\",\n-        \"//packages/platform-browser-dynamic/testing:files_for_docgen\",\n-        \"//packages/platform-browser/animations:files_for_docgen\",\n-        \"//packages/platform-browser/testing:files_for_docgen\",\n-        \"//packages/platform-server:files_for_docgen\",\n-        \"//packages/platform-server/init:files_for_docgen\",\n-        \"//packages/platform-server/testing:files_for_docgen\",\n-        \"//packages/router:files_for_docgen\",\n-        \"//packages/router/testing:files_for_docgen\",\n-        \"//packages/router/upgrade:files_for_docgen\",\n-        \"//packages/service-worker:files_for_docgen\",\n-        \"//packages/upgrade:files_for_docgen\",\n-        \"//packages/upgrade/src/common:files_for_docgen\",\n-        \"//packages/upgrade/static:files_for_docgen\",\n-        \"//packages/upgrade/static/testing:files_for_docgen\",\n-    ],\n+    srcs = [\"//packages/%s:files_for_docgen\" % entrypoint for entrypoint in DOCS_ENTRYPOINTS],\n )\n\n\n###\n\n", "completion": "build(bazel): list docs entrypoints under packages to simplify docgen"}
{"prompt": " file path A: tools/esm-loader/esm-loader.mjs | file path B: tools/esm-loader/esm-loader.mjs\n\n@@ -25,7 +25,7 @@ export async function resolve(specifier, context, defaultResolve) {\n       return defaultResolve(specifier, context, defaultResolve);\n     }\n \n-    const runfilesRoot = path.resolve(process.env.RUNFILES, 'angular');\n+    const runfilesRoot = path.resolve(process.env.RUNFILES);\n     const nodeModules = path.join(runfilesRoot, process.env.NODE_MODULES_WORKSPACE_NAME, 'node_modules');\n     const packageImport = parsePackageImport(specifier);\n     const pathToNodeModule = path.join(nodeModules, packageImport.packageName);\n\n\n###\n\n", "completion": "build(bazel): fix a bug where the esm loader did not point to"}
{"prompt": " file path A: .bazelrc | file path B: .bazelrc\n\n@@ -118,7 +118,7 @@ build:remote --remote_executor=remotebuildexecution.googleapis.com\n \n # Ensure that tags like \"no-remote-exec\" get propagated to actions created by rules.\n # https://bazel.build/reference/command-line-reference#flag--experimental_allow_tags_propagation\n-build:remote --experimental_allow_tags_propagation\n+build --experimental_allow_tags_propagation\n \n # Disable network access in the sandbox by default. To enable network access\n # for a particular target, use:\n\n\n###\n\n", "completion": "build(bazel): allow tag propagation on host machine"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -93,7 +93,7 @@\n     \"@angular-eslint/eslint-plugin\": \"^14.0.0\",\n     \"@angular-eslint/eslint-plugin-template\": \"^14.0.0\",\n     \"@angular-eslint/template-parser\": \"^14.0.0\",\n-    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#12e037fc9c26bb6aaa06e00ba654a79f4932c2f6\",\n+    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#6df2d555d326fe6282de28db80c49dd439b42af3\",\n     \"@angular/cli\": \"15.0.0-rc.0\",\n     \"@angular/compiler-cli\": \"15.0.0-rc.0\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n\n---\n file path A: aio/scripts/BUILD.bazel | file path B: aio/scripts/BUILD.bazel\n\n@@ -1,5 +1,5 @@\n load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n-load(\"@aio_npm//@angular/build-tooling/bazel:filter_outputs.bzl\", \"filter_outputs\")\n+load(\"@aio_npm//@angular/build-tooling/bazel:filter_outputs.bzl\", \"filter_first_output\")\n load(\"//tools:defaults.bzl\", \"nodejs_binary\", \"nodejs_test\")\n \n package(default_visibility = [\"//visibility:public\"])\n@@ -55,10 +55,14 @@ nodejs_binary(\n \n # Extract the executable audit script from DefaultInfo so that we can use\n # $(rootpath) on it.\n-filter_outputs(\n+filter_first_output(\n     name = \"audit-web-app-script\",\n     testonly = True,\n-    filters = [\"audit-web-app.sh\"],\n+    filters = [\n+        # On Windows select the batch script\n+        \"audit-web-app.bat\",\n+        \"audit-web-app.sh\",\n+    ],\n     target = \":audit-web-app\",\n )\n \n@@ -86,5 +90,7 @@ nodejs_test(\n     env = {\n         \"AUDIT_SCRIPT_PATH\": \"$(rootpath :audit-web-app-script)\",\n     },\n-    tags = [\"manual\"],\n+    tags = [\n+        \"manual\",\n+    ],\n )\n\n---\n file path A: aio/scripts/audit-web-app.mjs | file path B: aio/scripts/audit-web-app.mjs\n\n@@ -27,6 +27,7 @@\n import lighthouse from 'lighthouse';\n import * as printer from 'lighthouse/lighthouse-cli/printer.js';\n import logger from 'lighthouse-logger';\n+import os from 'os';\n import puppeteer from 'puppeteer-core';\n import path from 'path';\n \n@@ -36,6 +37,8 @@ const LIGHTHOUSE_FLAGS = {logLevel: process.env.CI ? 'error' : 'info'};  // Be l\n const VIEWER_URL = 'https://googlechrome.github.io/lighthouse/viewer';\n const WAIT_FOR_SW_DELAY = 5000;\n \n+process.env.CHROME_BIN = adjustChromeBinPathForWindows();\n+\n // Run\n _main(process.argv.slice(2));\n \n@@ -166,3 +169,30 @@ async function runLighthouse(browser, url, flags, config) {\n     await browser.close();\n   }\n }\n+\n+// TODO: this is a hack; the root cause should be found and fixed\n+function adjustChromeBinPathForWindows() {\n+  if (os.platform() === 'win32') {\n+    /*\n+      For some unknown reason, the symlinked copy of chromium under runfiles won't run under\n+      karma on Windows. Instead, modify the CHROME_BIN env var to point to the chrome binary\n+      under external/ in the execroot.\n+\n+      CHROME_BIN is equal to the make var $(CHROMIUM), which points to chrome relative\n+      to the runfiles root.\n+\n+      The org_chromium_chromium_windows/ in the path below is needed to cancel out the\n+      leading ../ in CHROME_BIN.\n+\n+      First, back out of\n+          bazel-out/x64_windows-fastbuild/bin/aio/scripts/audit-web-app.bat.runfiles/angular\n+      Then go into`\n+          external/\n+      and then into\n+          org_chromium_chromium_windows/\n+      to cancel out the leading ../ in CHROME_BIN\n+    */\n+   return path.resolve(`../../../../../../external/org_chromium_chromium_windows/${process.env.CHROME_BIN}`);\n+  }\n+  return process.env.CHROME_BIN;\n+}\n\n---\n file path A: aio/scripts/local_server_test.bzl | file path B: aio/scripts/local_server_test.bzl\n\n@@ -1,6 +1,6 @@\n load(\"//tools:defaults.bzl\", \"nodejs_test\")\n \n-def local_server_test(name, entry_point, serve_target, data = [], args = []):\n+def local_server_test(name, entry_point, serve_target, data = [], args = [], **kwargs):\n     \"\"\"Run a test script alongside a locally running http server.\n \n     Args:\n@@ -10,6 +10,7 @@ def local_server_test(name, entry_point, serve_target, data = [], args = []):\n         data: Additional data required by the test script\n         args: Args to pass to the test script. Note: The special argument LOCALHOST_URL\n           will be substituted with the url pointing to the served contents.\n+        **kwargs: remaining args to pass to test\n     \"\"\"\n     nodejs_test(\n         name = name,\n@@ -29,4 +30,5 @@ def local_server_test(name, entry_point, serve_target, data = [], args = []):\n             \"@aio_npm//tree-kill\",\n         ] + data,\n         entry_point = \"//aio/scripts:run-with-local-server.mjs\",\n+        **kwargs\n     )\n\n---\n file path A: aio/scripts/run-with-local-server.mjs | file path B: aio/scripts/run-with-local-server.mjs\n\n@@ -1,7 +1,10 @@\n import getPort from 'get-port';\n+import path from 'node:path';\n import sh from 'shelljs';\n import treeKill from 'tree-kill';\n \n+const RUNFILES_ROOT = path.resolve('.');\n+\n sh.set('-e');\n \n // Serve contents over http while running an abitrary script. This is an\n@@ -15,16 +18,16 @@ sh.set('-e');\n //      will be substituted with the url of the served contents\n \n async function main(args) {\n-  const lightserver = args[0];\n-  const distDir = args[1];\n-  const testScript = args[2];\n+  const lightserver = path.join(RUNFILES_ROOT, args[0]);\n+  const distDir = path.join(RUNFILES_ROOT, args[1]);\n+  const testScript = path.join(RUNFILES_ROOT, args[2]);\n   const testScriptArgs = args.slice(3);\n   const port = await getPort();\n \n   const lightserverCmd = [\n     lightserver,\n     '--bind=localhost',\n-    '--historyindex=/index.html',\n+    `--historyindex=${path.sep}index.html`,\n     '--no-reload',\n     '-s',\n     distDir,\n@@ -40,8 +43,12 @@ async function main(args) {\n   ].join(' ').replace('LOCALHOST_URL', `http://localhost:${port}`);\n \n   sh.exec(command);\n-    \n+  \n   await killProcess(lightserverProcess);\n+\n+  // TODO: On Windows something remains unresolved and node does not exit.\n+  // It does not appear to be the lightserver process.\n+  process.exit(0);\n }\n \n (async() => await main(process.argv.slice(2)))();\n@@ -51,6 +58,7 @@ function killProcess(childProcess) {\n     treeKill(childProcess.pid, error => {\n       if (error) {\n         reject(error);\n+        return;\n       }\n       resolve();\n     });\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -292,9 +292,9 @@\n     \"@angular/core\" \"^13.0.0 || ^14.0.0-0\"\n     reflect-metadata \"^0.1.13\"\n \n-\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#12e037fc9c26bb6aaa06e00ba654a79f4932c2f6\":\n-  version \"0.0.0-4165870dc0579d1497a80f3138aa04e6455ce646\"\n-  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#12e037fc9c26bb6aaa06e00ba654a79f4932c2f6\"\n+\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#6df2d555d326fe6282de28db80c49dd439b42af3\":\n+  version \"0.0.0-40aaf3831425d472965dd61e58cbd5854abd7214\"\n+  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#6df2d555d326fe6282de28db80c49dd439b42af3\"\n   dependencies:\n     \"@angular-devkit/build-angular\" \"15.0.0-next.0\"\n     \"@angular/benchpress\" \"0.3.0\"\n\n\n###\n\n", "completion": "build(bazel): fix a11y and pwa tests on Windows"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -25,9 +25,6 @@ http_archive(\n \n http_archive(\n     name = \"build_bazel_rules_nodejs\",\n-    patches = [\n-        \"//:tools/bazel-repo-patches/rules_nodejs__pr_3538.patch\",\n-    ],\n     sha256 = \"b011d6206e4e76696eda8287618a2b6375ff862317847cdbe38f8d0cd206e9ce\",\n     urls = [\"https://github.com/bazelbuild/rules_nodejs/releases/download/5.6.0/rules_nodejs-5.6.0.tar.gz\"],\n )\n\n---\n file path A: tools/bazel-repo-patches/rules_nodejs__pr_3538.patch | file path B: None\n\n@@ -1,44 +0,0 @@\n-diff --git internal/npm_install/index.js internal/npm_install/index.js\n-index 4bd9fda7e..706e95713 100644\n---- internal/npm_install/index.js\n-+++ internal/npm_install/index.js\n-@@ -23,6 +23,7 @@ let config = {\n-     strict_visibility: true,\n-     workspace_rerooted_path: '',\n-     workspace: '',\n-+    all_node_modules_target_name: 'node_modules',\n- };\n- function generateBuildFileHeader(visibility = PUBLIC_VISIBILITY) {\n-     return `# Generated file from ${config.rule_type} rule.\n-@@ -208,7 +209,7 @@ ${exportsStarlark}])\n- # there are many files in target.\n- # See https://github.com/bazelbuild/bazel/issues/5153.\n- js_library(\n--    name = \"node_modules\",\n-+    name = \"${config.all_node_modules_target_name}\",\n-     package_name = \"${LEGACY_NODE_MODULES_PACKAGE_NAME}\",\n-     package_path = \"${config.package_path}\",${pkgFilesStarlark}${depsStarlark}\n- )\n-diff --git internal/npm_install/npm_install.bzl internal/npm_install/npm_install.bzl\n-index 5f268165c..5a1060e0a 100644\n---- internal/npm_install/npm_install.bzl\n-+++ internal/npm_install/npm_install.bzl\n-@@ -359,6 +359,10 @@ Using managed_directories will mean that\n-         default = 3600,\n-         doc = \"\"\"Maximum duration of the package manager execution in seconds.\"\"\",\n-     ),\n-+    \"all_node_modules_target_name\": attr.string(\n-+        default = \"node_modules\",\n-+        doc = \"\"\"The target name of the node_modules directory in one catch-all js_library target.\"\"\",\n-+    ),\n-     \"generate_build_files_concurrency_limit\": attr.int(\n-         default = 64,\n-         doc = \"\"\"Limit the maximum concurrency of npm package processing when generating\n-@@ -486,6 +490,7 @@ def _create_build_files(repository_ctx, rule_type, node, lock_file, generate_loc\n-             workspace = repository_ctx.attr.name,\n-             workspace_rerooted_package_json_dir = paths.normalize(paths.join(_WORKSPACE_REROOTED_PATH, package_json_dir)),\n-             workspace_rerooted_path = _WORKSPACE_REROOTED_PATH,\n-+            all_node_modules_target_name = repository_ctx.attr.all_node_modules_target_name,\n-         ),\n-     )\n-     repository_ctx.file(\"generate_config.json\", generate_config_json)\n\\ No newline at end of file\n\n\n###\n\n", "completion": "build(bazel): remove old patch rules_nodejs patch"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -28,8 +28,8 @@ http_archive(\n     patches = [\n         \"//:tools/bazel-repo-patches/rules_nodejs__pr_3538.patch\",\n     ],\n-    sha256 = \"f10a3a12894fc3c9bf578ee5a5691769f6805c4be84359681a785a0c12e8d2b6\",\n-    urls = [\"https://github.com/bazelbuild/rules_nodejs/releases/download/5.5.3/rules_nodejs-5.5.3.tar.gz\"],\n+    sha256 = \"b011d6206e4e76696eda8287618a2b6375ff862317847cdbe38f8d0cd206e9ce\",\n+    urls = [\"https://github.com/bazelbuild/rules_nodejs/releases/download/5.6.0/rules_nodejs-5.6.0.tar.gz\"],\n )\n \n load(\"@build_bazel_rules_nodejs//:repositories.bzl\", \"build_bazel_rules_nodejs_dependencies\")\n\n\n###\n\n", "completion": "build(bazel): fix a bug where $(GIT_BIN_PATH) wasn't providing a correct path on"}
{"prompt": " file path A: tools/defaults.bzl | file path B: tools/defaults.bzl\n\n@@ -412,7 +412,7 @@ def _apply_esm_import_patch(env, templated_args, data):\n \n     env = dict(env, **{\"NODE_MODULES_WORKSPACE_NAME\": _node_modules_workspace_name()})\n     templated_args = templated_args + [\n-        \"--node_options=--loader=$$(rlocation $(rootpath //tools/esm-loader:esm-loader.mjs))\",\n+        \"--node_options=--loader=file:///$$(rlocation $(rootpath //tools/esm-loader:esm-loader.mjs))\",\n     ]\n     data = data + [\n         \"//tools/esm-loader\",\n\n\n###\n\n", "completion": "build(bazel): fix windows regression caused by absolute esm loader path"}
{"prompt": " file path A: aio/tools/transforms/angular-api-package/index.js | file path B: aio/tools/transforms/angular-api-package/index.js\n\n@@ -42,7 +42,7 @@ module.exports =\n         .processor(require('./processors/collectPackageContentDocs'))\n         .processor(require('./processors/processPackages'))\n         .processor(require('./processors/processNgModuleDocs'))\n-        .processor(require('./processors/fixupRealProjectRelativePath'))\n+        .processor(require('./processors/fixupProjectRelativePath'))\n         .processor(require('./processors/processAliasDocs'))\n         .processor(require('./processors/mergeOverriddenImplementation'))\n \n\n---\n file path A: aio/tools/transforms/angular-api-package/processors/fixupRealProjectRelativePath.js | file path B: aio/tools/transforms/angular-api-package/processors/fixupProjectRelativePath.js\n\n@@ -1,12 +1,12 @@\n-module.exports = function fixupRealProjectRelativePath(API_DOC_TYPES) {\n+module.exports = function fixupProjectRelativePath(API_DOC_TYPES) {\n   return {\n     $runAfter: ['readTypeScriptModules'],\n     $runBefore: ['processing-docs'],\n     $process(docs) {\n       docs.forEach(doc => {\n-        if (API_DOC_TYPES.indexOf(doc.docType) !== -1 && doc.fileInfo && doc.fileInfo.realProjectRelativePath) {\n+        if (API_DOC_TYPES.indexOf(doc.docType) !== -1 && doc.fileInfo && doc.fileInfo.projectRelativePath) {\n           // this is an API doc - so fix up its real path\n-          doc.fileInfo.realProjectRelativePath = 'packages/' + doc.fileInfo.realProjectRelativePath;\n+          doc.fileInfo.projectRelativePath = 'packages/' + doc.fileInfo.projectRelativePath;\n         }\n       });\n     }\n\n---\n file path A: None | file path B: aio/tools/transforms/angular-api-package/processors/fixupProjectRelativePath.spec.js\n\n@@ -0,0 +1,36 @@\n+const testPackage = require('../../helpers/test-package');\n+const processorFactory = require('./fixupProjectRelativePath');\n+const Dgeni = require('dgeni');\n+\n+describe('fixupProjectRelativePath processor', () => {\n+\n+  it('should be available on the injector', () => {\n+    const dgeni = new Dgeni([testPackage('angular-api-package')]);\n+    const injector = dgeni.configureInjector();\n+    const processor = injector.get('fixupProjectRelativePath');\n+    expect(processor.$process).toBeDefined();\n+    expect(processor.$runAfter).toContain('readTypeScriptModules');\n+    expect(processor.$runBefore).toContain('processing-docs');\n+  });\n+\n+  it('should add `packages` segment to the start of `projectRelativePath` for API docs', () => {\n+    const processor = processorFactory(['class', 'member']);\n+    const docs = [\n+      { docType: 'class', fileInfo: { projectRelativePath: 'a/b/c' } },\n+      { docType: 'member', fileInfo: { projectRelativePath: 'a/b/c/d' } },\n+      { docType: 'cli-command', fileInfo: { projectRelativePath: 'a/b/c' } },\n+      { docType: 'class', fileInfo: { } },\n+      { docType: 'class' },\n+    ];\n+    processor.$process(docs);\n+\n+    expect(docs).toEqual([\n+      { docType: 'class', fileInfo: { projectRelativePath: 'packages/a/b/c' } },\n+      { docType: 'member', fileInfo: { projectRelativePath: 'packages/a/b/c/d' } },\n+      { docType: 'cli-command', fileInfo: { projectRelativePath: 'a/b/c' } },\n+      { docType: 'class', fileInfo: { } },\n+      { docType: 'class' },\n+    ]);\n+  });\n+});\n+\n\n---\n file path A: aio/tools/transforms/angular-api-package/processors/fixupRealProjectRelativePath.spec.js | file path B: None\n\n@@ -1,36 +0,0 @@\n-const testPackage = require('../../helpers/test-package');\n-const processorFactory = require('./fixupRealProjectRelativePath');\n-const Dgeni = require('dgeni');\n-\n-describe('fixupRealProjectRelativePath processor', () => {\n-\n-  it('should be available on the injector', () => {\n-    const dgeni = new Dgeni([testPackage('angular-api-package')]);\n-    const injector = dgeni.configureInjector();\n-    const processor = injector.get('fixupRealProjectRelativePath');\n-    expect(processor.$process).toBeDefined();\n-    expect(processor.$runAfter).toContain('readTypeScriptModules');\n-    expect(processor.$runBefore).toContain('processing-docs');\n-  });\n-\n-  it('should add `packages` segment to the start of `realProjectRelativePath` for API docs', () => {\n-    const processor = processorFactory(['class', 'member']);\n-    const docs = [\n-      { docType: 'class', fileInfo: { realProjectRelativePath: 'a/b/c' } },\n-      { docType: 'member', fileInfo: { realProjectRelativePath: 'a/b/c/d' } },\n-      { docType: 'cli-command', fileInfo: { realProjectRelativePath: 'a/b/c' } },\n-      { docType: 'class', fileInfo: { } },\n-      { docType: 'class' },\n-    ];\n-    processor.$process(docs);\n-\n-    expect(docs).toEqual([\n-      { docType: 'class', fileInfo: { realProjectRelativePath: 'packages/a/b/c' } },\n-      { docType: 'member', fileInfo: { realProjectRelativePath: 'packages/a/b/c/d' } },\n-      { docType: 'cli-command', fileInfo: { realProjectRelativePath: 'a/b/c' } },\n-      { docType: 'class', fileInfo: { } },\n-      { docType: 'class' },\n-    ]);\n-  });\n-});\n-\n\n---\n file path A: aio/tools/transforms/cli-docs-package/readers/cli-command.js | file path B: aio/tools/transforms/cli-docs-package/readers/cli-command.js\n\n@@ -64,7 +64,7 @@ module.exports = function cliCommandFileReader() {\n         docType: 'content',\n         startingLine: 0,\n         fileInfo: {\n-          realProjectRelativePath: doc.longDescriptionRelativePath.replace(/^@/, 'packages/'),\n+          projectRelativePath: doc.longDescriptionRelativePath.replace(/^@/, 'packages/'),\n         },\n       };\n     }\n\n---\n file path A: aio/tools/transforms/cli-docs-package/readers/cli-command.spec.js | file path B: aio/tools/transforms/cli-docs-package/readers/cli-command.spec.js\n\n@@ -106,7 +106,7 @@ describe('cli-command reader', () => {\n       expect(doc.longDescriptionDoc).toEqual({\n         docType: 'content',\n         startingLine: 0,\n-        fileInfo: {realProjectRelativePath: 'packages/angular/cli/src/commands/add/long-description.md'}\n+        fileInfo: {projectRelativePath: 'packages/angular/cli/src/commands/add/long-description.md'}\n       });\n     });\n   });\n\n---\n file path A: aio/tools/transforms/templates/lib/githubLinks.html | file path B: aio/tools/transforms/templates/lib/githubLinks.html\n\n@@ -1,5 +1,5 @@\n {% macro projectRelativePath(fileInfo) -%}\n-{$ fileInfo.realProjectRelativePath if fileInfo.realProjectRelativePath else fileInfo.projectRelativePath $}\n+{$ fileInfo.projectRelativePath $}\n {%- endmacro %}\n \n {% macro githubBaseUrl(versionInfo) -%}\n\n\n###\n\n", "completion": "build(bazel): fix broken aio github links on Windows"}
{"prompt": " file path A: aio/content/examples/angular-compiler-options/tsconfig.app.json | file path B: aio/content/examples/angular-compiler-options/tsconfig.app.json\n\n@@ -38,6 +38,6 @@\n       \"sourceMap\": true,\n       \"declaration\": false\n       // #docregion angular-compiler-options-app\n-    },\n+    }\n   }\n   // #enddocregion angular-compiler-options-app\n\n---\n file path A: aio/content/examples/examples.bzl | file path B: aio/content/examples/examples.bzl\n\n@@ -2,7 +2,7 @@ load(\"@build_bazel_rules_nodejs//:index.bzl\", \"npm_package_bin\")\n load(\"@aspect_bazel_lib//lib:copy_to_directory.bzl\", \"copy_to_directory\")\n load(\"//tools:defaults.bzl\", \"nodejs_test\")\n load(\"//:yarn.bzl\", \"YARN_LABEL\")\n-load(\"//:packages.bzl\", \"ALL_PACKAGES\", \"to_package_label\")\n+load(\"//:packages.bzl\", \"AIO_EXAMPLE_PACKAGES\", \"to_package_label\")\n \n # This map controls which examples are included and whether or not to generate\n # a stackblitz live examples and zip archives. Keys are the example name, and values\n@@ -181,11 +181,11 @@ def docs_example(name, test = True, test_tags = [], test_exec_properties = {}):\n     if test:\n         EXAMPLE_DEPS_WORKSPACE_NAME = \"aio_example_deps\"\n \n-        LOCAL_PACKAGE_DEPS = [to_package_label(dep) for dep in ALL_PACKAGES]\n+        LOCAL_PACKAGE_DEPS = [to_package_label(dep) for dep in AIO_EXAMPLE_PACKAGES]\n \n         # Local package deps are passed as args to the test script in the form \"@package/name#path/to/package\"\n         # for the script's convenience.\n-        LOCAL_PACKAGE_ARGS = [\"%s#$(rootpath %s)\" % (dep, to_package_label(dep)) for dep in ALL_PACKAGES]\n+        LOCAL_PACKAGE_ARGS = [\"%s#$(rootpath %s)\" % (dep, to_package_label(dep)) for dep in AIO_EXAMPLE_PACKAGES]\n \n         nodejs_test(\n             name = \"e2e\",\n\n---\n file path A: aio/tools/examples/run-example-e2e.mjs | file path B: aio/tools/examples/run-example-e2e.mjs\n\n@@ -118,6 +118,8 @@ function isCliTest(examplePath) {\n async function runE2eTestsSystemJS(exampleName, appDir) {\n   const config = loadExampleConfig(appDir);\n \n+  preserveSymlinksWhenUsingLocalPackages(LOCAL_PACKAGES, appDir);\n+\n   const runArgs = await overrideSystemJsExampleToUseRandomPort(config, appDir);\n \n   const appBuildSpawnInfo = spawnExt(NODE, [VENDORED_YARN, config.build], {cwd: appDir});\n@@ -244,6 +246,12 @@ function pointBinSymlinksToLocalPackages(linkedNodeModules) {\n   }\n   const allNodeModuleBins = globbySync(['**'], {cwd: path.join(linkedNodeModules, '.bin'), onlyFiles: true});\n   allNodeModuleBins.forEach(bin => {\n+    // TODO: Swapping the symlink to ngc with the local package equivalent\n+    // doesn't seem to work. When ngc runs in upgrade-phonecat-2-hybrid via\n+    // the build:aot yarn script, node cannot resolve @angular/compiler.\n+    if (bin === \"ngc\") {\n+      return;\n+    }\n     const symlinkTarget = fs.readlinkSync(path.join(linkedNodeModules, '.bin', bin));\n     for (const pkgName of Object.keys(LOCAL_PACKAGES)) {\n       const binMightBeInLocalPackage = symlinkTarget.includes(path.join(EXAMPLE_DEPS_WORKSPACE_NAME, 'node_modules', pkgName) + path.sep);\n@@ -307,15 +315,7 @@ function runE2eTestsCLI(exampleName, appDir) {\n     }\n   }\n \n-  // When local packages are symlinked in, node has trouble resolving some peer deps. Setting\n-  // preserveSymlinks: true in angular.json fixes this. This isn't required without local\n-  // packages because in the worst case we would leak into the original Bazel repository\n-  // and it would still find a node_modules folder for resolution.\n-  if (Object.keys(LOCAL_PACKAGES).length > 0) {\n-    const angularJson = jsonc.load(path.join(appDir, 'angular.json'), {encoding: 'utf-8'});\n-    angularJson.projects['angular.io-example'].architect.build.options.preserveSymlinks = true;\n-    fs.writeFileSync(path.join(appDir, 'angular.json'), JSON.stringify(angularJson));\n-  }\n+  preserveSymlinksWhenUsingLocalPackages(LOCAL_PACKAGES, appDir);\n \n   // `--no-webdriver-update` is needed to preserve the ChromeDriver version already installed.\n   const testCommands = config.tests || [{\n@@ -435,5 +435,43 @@ function adjustChromeBinPathForWindows() {\n   return process.env.CHROME_BIN;\n }\n \n+// When local packages are symlinked in, node has trouble resolving some peer deps. Setting\n+// preserveSymlinks in relevant files fixes this. This isn't required without local packages\n+// because in the worst case we would leak into the original Bazel repository and it would\n+// still find a node_modules folder for resolution. Add the preserveSymlinks options to various\n+// files that are used by the cli and systemjs tests (and sometimes both).\n+function preserveSymlinksWhenUsingLocalPackages(LOCAL_PACKAGES, appDir) {\n+  if (Object.keys(LOCAL_PACKAGES).length == 0) {\n+    return;\n+  }\n+\n+  // Set preserveSymlinks in angular.json\n+  const angularJsonPath = path.join(appDir, 'angular.json');\n+  if (fs.existsSync(angularJsonPath)) {\n+    const angularJson = jsonc.load(angularJsonPath, {encoding: 'utf-8'});\n+    angularJson.projects['angular.io-example'].architect.build.options.preserveSymlinks = true;\n+    fs.writeFileSync(angularJsonPath, JSON.stringify(angularJson, undefined, 2));\n+  }\n+\n+  // Set preserveSymlinks in any tsconfig.json files\n+  const tsConfigPaths = globbySync([path.join(appDir, 'tsconfig*.json')]);\n+  for (let tsConfigPath of tsConfigPaths) {\n+    const tsConfig = jsonc.load(tsConfigPath, {encoding: 'utf-8'});\n+    const isRootConfig = !tsConfig.extends;\n+    if (isRootConfig) {\n+      tsConfig.compilerOptions.preserveSymlinks = true;\n+      fs.writeFileSync(tsConfigPath, JSON.stringify(tsConfig, undefined, 2));\n+    }\n+  }\n+\n+  // Call rollup with --preserveSymlinks\n+  const packageJsonPath = path.join(appDir, 'package.json');\n+  const packageJson = jsonc.load(packageJsonPath, {encoding: 'utf-8'});\n+  if ('rollup' in packageJson.dependencies || 'rollup' in packageJson.devDependencies) {\n+    packageJson.scripts['rollup'] = 'rollup --preserveSymlinks';\n+    fs.writeFileSync(packageJsonPath, JSON.stringify(packageJson, undefined, 2));\n+  }\n+}\n+\n runE2e(EXAMPLE_PATH);\n \n\n---\n file path A: aio/tools/examples/shared/boilerplate/systemjs/package.json | file path B: aio/tools/examples/shared/boilerplate/systemjs/package.json\n\n@@ -19,7 +19,7 @@\n     \"test:once\": \"karma start karma.conf.js --single-run\",\n     \"build:upgrade\": \"tsc\",\n     \"serve:upgrade\": \"http-server\",\n-    \"build:aot\": \"ngc -p tsconfig-aot.json && rollup -c rollup-config.js\",\n+    \"build:aot\": \"ngc -p tsconfig-aot.json && yarn rollup -c rollup-config.js\",\n     \"serve:aot\": \"lite-server -c bs-config.aot.json\",\n     \"copy-dist-files\": \"node ./copy-dist-files.js\"\n   },\n\n\n###\n\n", "completion": "build(bazel): fix aio example systemjs tests for locally linked packages"}
{"prompt": " file path A: aio/scripts/build-artifacts.sh | file path B: aio/scripts/build-artifacts.sh\n\n@@ -15,6 +15,10 @@ readonly deployedUrl=https://pr${prNumber}-${prLastSha:0:7}.ngbuilds.io/\n   # Build and store the app\n   yarn build\n \n+  # Remove write protection from the opensearch.xml in the Bazel\n+  # output tree so that the url can be substituted.\n+  chmod u+w ../dist/bin/aio/build/assets/opensearch.xml\n+\n   # Set deployedUrl as parameter in the opensearch description\n   # deployedUrl must end with /\n   yarn set-opensearch-url $deployedUrl\n\n\n###\n\n", "completion": "build(bazel): fix a bug where the opensearch url coudln't be substituted"}
{"prompt": " file path A: tools/esm-loader/esm-loader.mjs | file path B: tools/esm-loader/esm-loader.mjs\n\n@@ -25,7 +25,8 @@ export async function resolve(specifier, context, defaultResolve) {\n       return defaultResolve(specifier, context, defaultResolve);\n     }\n \n-    const nodeModules = path.resolve(process.env.RUNFILES_DIR, process.env.NODE_MODULES_WORKSPACE_NAME, 'node_modules');\n+    const runfilesWorkspaceRoot = path.resolve(process.env.RUNFILES_DIR || path.join(process.env.RUNFILES, 'angular'));\n+    const nodeModules = path.join(runfilesWorkspaceRoot, process.env.NODE_MODULES_WORKSPACE_NAME, 'node_modules');\n     const packageImport = parsePackageImport(specifier);\n     const pathToNodeModule = path.join(nodeModules, packageImport.packageName);\n \n\n\n###\n\n", "completion": "build(bazel): fix a bug where the esm loader could not determine the"}
{"prompt": " file path A: aio/scripts/payload.sh | file path B: aio/scripts/payload.sh\n\n@@ -12,4 +12,4 @@ source ../scripts/ci/payload-size.sh\n # Provide node_modules from aio\n NODE_MODULES_BIN=$PROJECT_ROOT/aio/node_modules/.bin/\n \n-trackPayloadSize \"$target\" \"dist/*.css dist/*.js\" true \"$PROJECT_ROOT/goldens/size-tracking/aio-payloads.json\"\n+trackPayloadSize \"$target\" \"../dist/bin/aio/build/*.css ../dist/bin/aio/build/*.js\" true \"$PROJECT_ROOT/goldens/size-tracking/aio-payloads.json\"\n\n---\n file path A: scripts/ci/payload-size.sh | file path B: scripts/ci/payload-size.sh\n\n@@ -31,7 +31,7 @@ NODE_MODULES_BIN=$PROJECT_ROOT/node_modules/.bin/\n getGzipSize() {\n   local filePath=$1\n   local compLevel=$2\n-  local compPath=$1$2.gz\n+  local compPath=\"$(mktemp).gz\"\n   local size=-1\n \n   gzip -c -$compLevel \"$filePath\" >> \"$compPath\"\n\n\n###\n\n", "completion": "build(bazel): fix aio payload test to work with bazel output"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -1163,6 +1163,7 @@ groups:\n           'tools/bazel-repo-patches/**/{*,.*}',\n           'tools/circular_dependency_test/**/{*,.*}',\n           'tools/contributing-stats/**/{*,.*}',\n+          'tools/esm-loader/**/{*,.*}',\n           'tools/gulp-tasks/**/{*,.*}',\n           'tools/legacy-saucelabs/**/{*,.*}',\n           'tools/rxjs/**/{*,.*}',\n\n---\n file path A: tools/esm-loader/esm-loader.mjs | file path B: tools/esm-loader/esm-loader.mjs\n\n@@ -1,3 +1,11 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n import fs from 'fs';\n import path from 'path';\n import {pathToFileURL} from 'url';\n@@ -52,4 +60,4 @@ function resolvePackageLocalFilepath(packageImport, packageJson) {\n     }\n \n     return packageImport.pathInPackage || packageJson.module || packageJson.main || 'index.js';\n-}\n\\ No newline at end of file\n+}\n\n---\n file path A: tslint.json | file path B: tslint.json\n\n@@ -132,7 +132,10 @@\n       \"./packages/zone.js/**/*\",\n \n       \"./devtools/bazel-out/**/*\",\n-      \"./devtools/projects/ng-devtools/src/lib/vendor/**/*\"\n+      \"./devtools/projects/ng-devtools/src/lib/vendor/**/*\",\n+\n+      // Ignore vendored code\n+      \"./third_party/**/*\"\n     ]\n   }\n }\n\n\n###\n\n", "completion": "build(bazel): fix linting errors"}
{"prompt": " file path A: aio/local_packages_util.bzl | file path B: aio/local_packages_util.bzl\n\n@@ -37,8 +37,9 @@ def substitute_local_packages(deps):\n             label = Label(dep)\n             if label.package in ALL_PACKAGES:\n                 substituted.append(_npm_link_name(dep))\n-            else:\n-                substituted.append(dep)\n+                continue\n+\n+        substituted.append(dep)\n     return substituted\n \n def _npm_link_name(dep):\n\n\n###\n\n", "completion": "build(bazel): fix a bug where deps in aio local build were not included"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -226,3 +226,11 @@ load(\"@io_bazel_rules_sass//sass:sass_repositories.bzl\", \"sass_repositories\")\n sass_repositories(\n     yarn_script = YARN_LABEL,\n )\n+\n+# Register git toolchains\n+register_toolchains(\n+    \"@npm//@angular/build-tooling/bazel/git-toolchain:git_linux_toolchain\",\n+    \"@npm//@angular/build-tooling/bazel/git-toolchain:git_macos_x86_toolchain\",\n+    \"@npm//@angular/build-tooling/bazel/git-toolchain:git_macos_arm64_toolchain\",\n+    \"@npm//@angular/build-tooling/bazel/git-toolchain:git_windows_toolchain\",\n+)\n\n---\n file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -31,13 +31,16 @@ npm_package_bin(\n     name = \"dgeni\",\n     # angular.io-package is a js_library target, which copies sources to $(BINDIR)\n     args = [\"./$(BINDIR)/aio/tools/transforms/angular.io-package\"],\n-    configuration_env_vars = [\"PATH\"],  # Need PATH for dgeni package that invokes git\n     data = [\"//aio/tools/transforms/angular.io-package\"],\n     env = {\n         \"BAZEL_DGENI_OUTPUT_PATH\": \"$(@D)\",\n+        \"GIT_BIN\": \"$(GIT_BIN_PATH)\",\n     },\n     output_dir = True,\n     tool = \"@aio_npm//dgeni/bin:dgeni\",\n+    toolchains = [\n+        \"@npm//@angular/build-tooling/bazel/git-toolchain:current_git_toolchain\",\n+    ],\n     visibility = [\"//aio/tests/deployment:__subpackages__\"],\n )\n \n\n---\n file path A: aio/tools/transforms/angular-api-package/BUILD.bazel | file path B: aio/tools/transforms/angular-api-package/BUILD.bazel\n\n@@ -19,7 +19,13 @@ js_library(\n jasmine_node_test(\n     name = \"test\",\n     srcs = glob([\"**/*.spec.js\"]),\n+    env = {\n+        \"GIT_BIN\": \"$(GIT_BIN_PATH)\",\n+    },\n     shard_count = 8,\n+    toolchains = [\n+        \"@npm//@angular/build-tooling/bazel/git-toolchain:current_git_toolchain\",\n+    ],\n     deps = [\n         \":angular-api-package\",\n         \"//aio/tools/transforms/helpers\",\n\n---\n file path A: aio/tools/transforms/angular-base-package/BUILD.bazel | file path B: aio/tools/transforms/angular-base-package/BUILD.bazel\n\n@@ -35,7 +35,13 @@ js_library(\n jasmine_node_test(\n     name = \"test\",\n     srcs = glob([\"**/*.spec.js\"]),\n+    env = {\n+        \"GIT_BIN\": \"$(GIT_BIN_PATH)\",\n+    },\n     shard_count = 8,\n+    toolchains = [\n+        \"@npm//@angular/build-tooling/bazel/git-toolchain:current_git_toolchain\",\n+    ],\n     deps = [\n         \":angular-base-package\",\n         \"//aio/tools/transforms/angular-api-package\",\n\n---\n file path A: aio/tools/transforms/angular-base-package/services/getPreviousMajorVersions.js | file path B: aio/tools/transforms/angular-base-package/services/getPreviousMajorVersions.js\n\n@@ -3,6 +3,7 @@\n const child = require('child_process');\n const semver = require('semver');\n const versionMatcher = /refs\\/tags\\/(\\d+.+)$/mg;\n+const GIT = process.env.GIT_BIN; // Path provided via bazel git toolchain\n \n /**\n  * Get a collection of all the previous \"last major\" versions sorted by semantic version.\n@@ -16,7 +17,7 @@ module.exports = function getPreviousMajorVersions(packageInfo, versionInfo) {\n     // always use the remote tags as the local clone might not contain all commits when cloned with\n     // `git clone --depth=...`\n     const repoUrl = packageInfo.repository.url;\n-    const tagResults = child.spawnSync('git', ['ls-remote', '--tags', repoUrl], {encoding: 'utf8'});\n+    const tagResults = child.spawnSync(GIT, ['ls-remote', '--tags', repoUrl], {encoding: 'utf8'});\n \n     if (tagResults.status !== 0) {\n       return [];\n\n---\n file path A: aio/tools/transforms/angular-base-package/services/getPreviousMajorVersions.spec.js | file path B: aio/tools/transforms/angular-base-package/services/getPreviousMajorVersions.spec.js\n\n@@ -19,7 +19,7 @@ describe('getPreviousMajorVersions', () => {\n   it('should spawn a child process to git', () => {\n     spyOn(child, 'spawnSync').and.returnValue({status: 0, stdout: ''});\n     getPreviousMajorVersions();\n-    expect(child.spawnSync).toHaveBeenCalledWith('git', ['ls-remote', '--tags', 'SOME_GIT_URL'], {\n+    expect(child.spawnSync).toHaveBeenCalledWith(process.env.GIT_BIN, ['ls-remote', '--tags', 'SOME_GIT_URL'], {\n       encoding: 'utf8'\n     });\n   });\n\n---\n file path A: aio/tools/transforms/angular-errors-package/BUILD.bazel | file path B: aio/tools/transforms/angular-errors-package/BUILD.bazel\n\n@@ -23,7 +23,13 @@ js_library(\n jasmine_node_test(\n     name = \"test\",\n     srcs = glob([\"**/*.spec.js\"]),\n+    env = {\n+        \"GIT_BIN\": \"$(GIT_BIN_PATH)\",\n+    },\n     shard_count = 8,\n+    toolchains = [\n+        \"@npm//@angular/build-tooling/bazel/git-toolchain:current_git_toolchain\",\n+    ],\n     deps = [\n         \":angular-errors-package\",\n         \"//aio/tools/transforms/helpers\",\n\n---\n file path A: aio/tools/transforms/angular-extended-diagnostics-package/BUILD.bazel | file path B: aio/tools/transforms/angular-extended-diagnostics-package/BUILD.bazel\n\n@@ -23,7 +23,13 @@ js_library(\n jasmine_node_test(\n     name = \"test\",\n     srcs = glob([\"**/*.spec.js\"]),\n+    env = {\n+        \"GIT_BIN\": \"$(GIT_BIN_PATH)\",\n+    },\n     shard_count = 8,\n+    toolchains = [\n+        \"@npm//@angular/build-tooling/bazel/git-toolchain:current_git_toolchain\",\n+    ],\n     deps = [\n         \":angular-extended-diagnostics-package\",\n         \"//aio/tools/transforms/helpers\",\n\n---\n file path A: aio/tools/transforms/authors-package/BUILD.bazel | file path B: aio/tools/transforms/authors-package/BUILD.bazel\n\n@@ -36,7 +36,13 @@ js_library(\n jasmine_node_test(\n     name = \"test\",\n     srcs = glob([\"**/*.spec.js\"]),\n+    env = {\n+        \"GIT_BIN\": \"$(GIT_BIN_PATH)\",\n+    },\n     shard_count = 8,\n+    toolchains = [\n+        \"@npm//@angular/build-tooling/bazel/git-toolchain:current_git_toolchain\",\n+    ],\n     deps = [\n         \":authors-package\",\n         \"//aio/tools/transforms\",\n\n---\n file path A: aio/tools/transforms/cli-docs-package/BUILD.bazel | file path B: aio/tools/transforms/cli-docs-package/BUILD.bazel\n\n@@ -27,7 +27,13 @@ js_library(\n jasmine_node_test(\n     name = \"test\",\n     srcs = glob([\"**/*.spec.js\"]),\n+    env = {\n+        \"GIT_BIN\": \"$(GIT_BIN_PATH)\",\n+    },\n     shard_count = 8,\n+    toolchains = [\n+        \"@npm//@angular/build-tooling/bazel/git-toolchain:current_git_toolchain\",\n+    ],\n     deps = [\n         \":cli-docs-package\",\n         \"//aio/tools/transforms/helpers\",\n\n\n###\n\n", "completion": "build(bazel): use git toolchain for dgeni build"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -136,8 +136,6 @@ TEST_DEPS = APPLICATION_DEPS + [\n     \"@aio_npm//karma-coverage\",\n     \"@aio_npm//karma-jasmine\",\n     \"@aio_npm//karma-jasmine-html-reporter\",\n-    \"@aio_npm//puppeteer\",\n-    \"@aio_npm//timezone-mock\",\n ]\n \n # All sources, specs, and config files required to serve the app\n\n---\n file path A: aio/scripts/deploy-to-firebase/BUILD.bazel | file path B: aio/scripts/deploy-to-firebase/BUILD.bazel\n\n@@ -1,5 +1,5 @@\n load(\"@aio_npm//@bazel/jasmine:index.bzl\", \"jasmine_node_test\")\n-load(\"//aio/tools:defaults.bzl\", \"nodejs_binary\")\n+load(\"//tools:defaults.bzl\", \"nodejs_binary\")\n \n DEPLOY_TO_FIREBASE_SOURCES = glob(\n     [\"**/*.mjs\"],\n\n---\n file path A: aio/scripts/local_server_test.bzl | file path B: aio/scripts/local_server_test.bzl\n\n@@ -1,4 +1,4 @@\n-load(\"//aio/tools:defaults.bzl\", \"nodejs_test\")\n+load(\"//tools:defaults.bzl\", \"nodejs_test\")\n \n def local_server_test(name, entry_point, serve_target, data = [], args = []):\n     \"\"\"Run a test script alongside a locally running http server.\n\n---\n file path A: aio/src/generated/BUILD.bazel | file path B: aio/src/generated/BUILD.bazel\n\n@@ -1,6 +1,6 @@\n load(\"@build_bazel_rules_nodejs//:index.bzl\", \"npm_package_bin\")\n \n-package(default_visibility = [\"//aio:__pkg__\"])\n+package(default_visibility = [\"//aio:__subpackages__\"])\n \n # Generate ngsw-config\n npm_package_bin(\n\n---\n file path A: aio/tests/deployment/shared/helpers.ts | file path B: aio/tests/deployment/shared/helpers.ts\n\n@@ -19,7 +19,7 @@ export function getRedirector() {\n }\n \n export function getSwNavigationUrlChecker() {\n-  const config = loadJson(`${AIO_DIR}/ngsw-config.json`);\n+  const config = loadJson(`${AIO_DIR}/src/generated/ngsw-config.json`);\n   const navigationUrlSpecs = processNavigationUrls('', config.navigationUrls);\n \n   const includePatterns = navigationUrlSpecs\n\n---\n file path A: aio/tests/deployment/unit/BUILD.bazel | file path B: aio/tests/deployment/unit/BUILD.bazel\n\n@@ -8,8 +8,8 @@ nodejs_test(\n         \"tsconfig.json\",\n         \"//aio:dgeni\",\n         \"//aio:firebase.json\",\n-        \"//aio:ngsw-config.json\",\n         \"//aio:tsconfig.json\",\n+        \"//aio/src/generated:ngsw-config\",\n         \"//aio/tests/deployment/shared\",\n         \"//aio/tools/firebase-test-utils:sources\",\n         \"//packages/service-worker/config:sources\",\n\n\n###\n\n", "completion": "build(bazel): fix some regressions"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -176,8 +176,7 @@ architect(\n         \"//conditions:default\": APPLICATION_DEPS,\n     }),\n     output_dir = True,\n-    # AIO build makes a network call to download fonts, which is prohibited on remote executors.\n-    # Further, when building with local packages (--config=aio_local_deps), RBE complains about\n+    # When building with local packages (--config=aio_local_deps), RBE complains about\n     # the input tree being too large (> 70,000 files).\n     tags = [\"no-remote-exec\"],\n )\n\n---\n file path A: aio/angular.json | file path B: aio/angular.json\n\n@@ -36,7 +36,9 @@\n             \"tsConfig\": \"tsconfig.app.json\",\n             \"webWorkerTsConfig\": \"tsconfig.worker.json\",\n             \"optimization\": {\n-              \"fonts\": true,\n+              \"fonts\": {\n+                \"inline\": false\n+              },\n               \"scripts\": true,\n               \"styles\": {\n                 \"inlineCritical\": false,\n\n\n###\n\n", "completion": "build(bazel): avoid network call during aio build by not inlining fonts"}
{"prompt": " file path A: aio/.gitignore | file path B: aio/.gitignore\n\n@@ -5,7 +5,6 @@\n /tmp\n /out-tsc\n /bazel-out\n-/src/generated\n \n # Node\n /node_modules\n\n---\n file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -6,10 +6,6 @@ load(\":local_packages_util.bzl\", \"link_local_packages\", \"substitute_local_packag\n load(\"@bazel_skylib//rules:common_settings.bzl\", \"bool_flag\")\n load(\"//aio/scripts:local_server_test.bzl\", \"local_server_test\")\n \n-# The write_source_files macro is used to write bazel outputs to the source tree and test that they are up to date.\n-# See: https://docs.aspect.build/aspect-build/bazel-lib/v0.5.0/docs/docs/write_source_files-docgen.html\n-load(\"@aspect_bazel_lib//lib:write_source_files.bzl\", generated_files_test = \"write_source_files\")\n-\n exports_files([\n     \"firebase.json\",\n     \"ngsw-config.json\",\n@@ -30,22 +26,6 @@ config_setting(\n     },\n )\n \n-# Generate ngsw-config\n-npm_package_bin(\n-    name = \"ngsw-config\",\n-    outs = [\"ngsw-config_generated.json\"],\n-    args = [\"$@\"],\n-    tool = \"//aio/scripts:build-ngsw-config\",\n-)\n-\n-# Write ngsw-config to the source directory and test that it's up to date\n-generated_files_test(\n-    name = \"write-ngsw-config\",\n-    files = {\n-        \"ngsw-config.json\": \":ngsw-config\",\n-    },\n-)\n-\n # Run dgeni generation\n npm_package_bin(\n     name = \"dgeni\",\n@@ -88,7 +68,6 @@ copy_to_directory(\n # All source and configuration files required to build the docs app\n APPLICATION_FILES = [\n     \"angular.json\",\n-    \"ngsw-config.json\",\n     \"package.json\",\n     \"tsconfig.app.json\",\n     \"tsconfig.json\",\n@@ -112,6 +91,7 @@ APPLICATION_DEPS = [\n     \":dgeni\",\n     \":stackblitz\",\n     \":example-zips\",\n+    \"//aio/src/generated:ngsw-config\",\n     \"@aio_npm//@angular-devkit/build-angular\",\n     \"@aio_npm//@angular-eslint/builder\",\n     \"@aio_npm//@angular/animations\",\n\n---\n file path A: aio/angular.json | file path B: aio/angular.json\n\n@@ -32,7 +32,7 @@\n             \"index\": \"src/index.html\",\n             \"main\": \"src/main.ts\",\n             \"polyfills\": \"src/polyfills.ts\",\n-            \"ngswConfigPath\": \"ngsw-config.json\",\n+            \"ngswConfigPath\": \"src/generated/ngsw-config.json\",\n             \"tsConfig\": \"tsconfig.app.json\",\n             \"webWorkerTsConfig\": \"tsconfig.worker.json\",\n             \"optimization\": {\n\n---\n file path A: None | file path B: aio/src/generated/BUILD.bazel\n\n@@ -0,0 +1,11 @@\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"npm_package_bin\")\n+\n+package(default_visibility = [\"//aio:__pkg__\"])\n+\n+# Generate ngsw-config\n+npm_package_bin(\n+    name = \"ngsw-config\",\n+    outs = [\"ngsw-config.json\"],\n+    args = [\"$@\"],\n+    tool = \"//aio/scripts:build-ngsw-config\",\n+)\n\n\n###\n\n", "completion": "build(bazel): avoid writing ngsw-config to the source tree"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -187,7 +187,7 @@ architect(\n     name = \"build-app\",\n     args = [\n         \"site:build:stable\",\n-        \"--output-path=build\",\n+        \"--output-path=build-app\",\n     ],\n     chdir = \"$(RULEDIR)\",\n     configuration_env_vars = [\"NG_BUILD_CACHE\"],\n@@ -207,12 +207,12 @@ npm_package_bin(\n     outs = [\"404.html\"],\n     args = [\n         \"$(execpath src/404-body.html)\",\n-        \"$(execpath :build)\",\n+        \"$(execpath :build-app)\",\n         \"$@\",\n     ],\n     data = [\n         \"src/404-body.html\",\n-        \":build\",\n+        \":build-app\",\n     ],\n     tool = \"//aio/scripts:build-404-page\",\n )\n@@ -226,7 +226,7 @@ copy_to_directory(\n         \":build-app\",\n     ],\n     replace_prefixes = {\n-        \"build\": \"\",\n+        \"build-app\": \"\",\n     },\n )\n \n\n\n###\n\n", "completion": "build(bazel): fix a circular dep in aio"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -1,6 +1,6 @@\n load(\"@aio_npm//@angular-devkit/architect-cli:index.bzl\", \"architect\", \"architect_test\")\n load(\"@build_bazel_rules_nodejs//:index.bzl\", \"copy_to_bin\", \"npm_package_bin\")\n-load(\"//aio/tools:defaults.bzl\", \"nodejs_binary\")\n+load(\"//tools:defaults.bzl\", \"nodejs_binary\")\n load(\"@aspect_bazel_lib//lib:copy_to_directory.bzl\", \"copy_to_directory\")\n load(\":local_packages_util.bzl\", \"link_local_packages\", \"substitute_local_packages\")\n load(\"@bazel_skylib//rules:common_settings.bzl\", \"bool_flag\")\n\n---\n file path A: aio/content/examples/examples.bzl | file path B: aio/content/examples/examples.bzl\n\n@@ -1,6 +1,6 @@\n load(\"@build_bazel_rules_nodejs//:index.bzl\", \"npm_package_bin\")\n load(\"@aspect_bazel_lib//lib:copy_to_directory.bzl\", \"copy_to_directory\")\n-load(\"//aio/tools:defaults.bzl\", \"nodejs_test\")\n+load(\"//tools:defaults.bzl\", \"nodejs_test\")\n load(\"//:yarn.bzl\", \"YARN_LABEL\")\n load(\"//:packages.bzl\", \"ALL_PACKAGES\", \"to_package_label\")\n \n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -160,6 +160,7 @@\n     \"rimraf\": \"^3.0.2\",\n     \"semver\": \"^7.3.5\",\n     \"shelljs\": \"^0.8.5\",\n+    \"source-map-support\": \"0.5.21\",\n     \"stemmer\": \"^2.0.0\",\n     \"tree-kill\": \"^1.1.0\",\n     \"ts-node\": \"^10.8.1\",\n\n---\n file path A: aio/scripts/BUILD.bazel | file path B: aio/scripts/BUILD.bazel\n\n@@ -1,6 +1,6 @@\n load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n-load(\"//aio/tools:defaults.bzl\", \"nodejs_binary\", \"nodejs_test\")\n load(\"@aio_npm//@angular/build-tooling/bazel:filter_outputs.bzl\", \"filter_outputs\")\n+load(\"//tools:defaults.bzl\", \"nodejs_binary\", \"nodejs_test\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n\n---\n file path A: aio/tests/deployment/unit/BUILD.bazel | file path B: aio/tests/deployment/unit/BUILD.bazel\n\n@@ -1,4 +1,4 @@\n-load(\"//aio/tools:defaults.bzl\", \"nodejs_test\")\n+load(\"//tools:defaults.bzl\", \"nodejs_test\")\n \n nodejs_test(\n     name = \"test\",\n\n---\n file path A: aio/tools/defaults.bzl | file path B: None\n\n@@ -1,68 +0,0 @@\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", _nodejs_binary = \"nodejs_binary\", _nodejs_test = \"nodejs_test\")\n-\n-def nodejs_binary(data = [], env = {}, templated_args = [], chdir = \"\", enable_linker = False, **kwargs):\n-    data = data + [\n-        \"//aio/tools/esm-loader\",\n-        \"//aio/tools/esm-loader:esm-loader.mjs\",\n-    ]\n-\n-    env = dict(env, **{\"NODE_MODULES_WORKSPACE_NAME\": \"aio_npm\"})\n-\n-    if not enable_linker:\n-        templated_args = templated_args + [\n-            # Disable the linker and rely on patched resolution which works better on Windows\n-            # and is less prone to race conditions when targets build concurrently.\n-            \"--nobazel_run_linker\",\n-        ]\n-\n-    templated_args = templated_args + [\n-        # Provide a custom esm loader to resolve third-party depenencies. Unlike for cjs\n-        # modules, rules_nodejs doesn't patch imports when the linker is disabled.\n-        \"--node_options=--loader=%s\" % _esm_loader_path(chdir),\n-    ]\n-\n-    _nodejs_binary(\n-        data = data,\n-        env = env,\n-        templated_args = templated_args,\n-        chdir = chdir,\n-        **kwargs\n-    )\n-\n-def nodejs_test(data = [], env = {}, templated_args = [], chdir = \"\", enable_linker = False, **kwargs):\n-    data = data + [\n-        \"//aio/tools/esm-loader\",\n-        \"//aio/tools/esm-loader:esm-loader.mjs\",\n-    ]\n-\n-    env = dict(env, **{\"NODE_MODULES_WORKSPACE_NAME\": \"aio_npm\"})\n-\n-    if not enable_linker:\n-        templated_args = templated_args + [\n-            # Disable the linker and rely on patched resolution which works better on Windows\n-            # and is less prone to race conditions when targets build concurrently.\n-            \"--nobazel_run_linker\",\n-        ]\n-\n-    templated_args = templated_args + [\n-        # Provide a custom esm loader to resolve third-party depenencies. Unlike for cjs\n-        # modules, rules_nodejs doesn't patch imports when the linker is disabled.\n-        \"--node_options=--loader=%s\" % _esm_loader_path(chdir),\n-    ]\n-\n-    _nodejs_test(\n-        data = data,\n-        env = env,\n-        templated_args = templated_args,\n-        chdir = chdir,\n-        **kwargs\n-    )\n-\n-def _esm_loader_path(chdir):\n-    \"\"\"Adjust the path provided for the esm loader node option which\n-    depends on the value of chdir.\"\"\"\n-    esm_loader_path_prefix = \"./\"\n-    if chdir and len(chdir) > 0:\n-        esm_loader_path_prefix = \"\".join([\"../\" for segment in chdir.split(\"/\")])\n-\n-    return \"%s$(rootpath //aio/tools/esm-loader:esm-loader.mjs)\" % esm_loader_path_prefix\n\n---\n file path A: aio/tools/example-zipper/BUILD.bazel | file path B: aio/tools/example-zipper/BUILD.bazel\n\n@@ -1,4 +1,4 @@\n-load(\"//aio/tools:defaults.bzl\", \"nodejs_binary\")\n+load(\"//tools:defaults.bzl\", \"nodejs_binary\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n\n---\n file path A: aio/tools/examples/BUILD.bazel | file path B: aio/tools/examples/BUILD.bazel\n\n@@ -1,4 +1,4 @@\n-load(\"//aio/tools:defaults.bzl\", \"nodejs_binary\")\n+load(\"//tools:defaults.bzl\", \"nodejs_binary\")\n load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n load(\"@aio_npm//@bazel/jasmine:index.bzl\", \"jasmine_node_test\")\n \n\n---\n file path A: aio/tools/firebase-test-utils/BUILD.bazel | file path B: aio/tools/firebase-test-utils/BUILD.bazel\n\n@@ -1,4 +1,4 @@\n-load(\"//aio/tools:defaults.bzl\", \"nodejs_test\")\n+load(\"//tools:defaults.bzl\", \"nodejs_test\")\n \n filegroup(\n     name = \"sources\",\n\n---\n file path A: aio/tools/stackblitz-builder/BUILD.bazel | file path B: aio/tools/stackblitz-builder/BUILD.bazel\n\n@@ -1,4 +1,4 @@\n-load(\"//aio/tools:defaults.bzl\", \"nodejs_binary\")\n+load(\"//tools:defaults.bzl\", \"nodejs_binary\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n\n---\n file path A: packages/bazel/src/types_bundle/BUILD.bazel | file path B: packages/bazel/src/types_bundle/BUILD.bazel\n\n@@ -20,9 +20,6 @@ nodejs_binary(\n     name = \"types_bundler\",\n     data = [\":lib\"],\n     entry_point = \":index.ts\",\n-    # Disable the linker and rely on patched resolution which works better on Windows\n-    # and is less prone to race conditions when targets build concurrently.\n-    templated_args = [\"--nobazel_run_linker\"],\n     visibility = [\"//visibility:public\"],\n )\n \n\n---\n file path A: packages/common/locales/generate-locales-tool/bin/BUILD.bazel | file path B: packages/common/locales/generate-locales-tool/bin/BUILD.bazel\n\n@@ -26,8 +26,4 @@ ts_library(\n         \"@cldr_xml_data//:all_xml\",\n     ],\n     entry_point = \":%s.ts\" % entrypoint,\n-    # We need to patch the NodeJS module resolution as this binary runs as\n-    # part of a genrule where the linker does not work as expected.\n-    # See: https://github.com/bazelbuild/rules_nodejs/issues/2600.\n-    templated_args = [\"--nobazel_run_linker\"],\n ) for entrypoint in BIN_ENTRYPOINTS]\n\n---\n file path A: packages/common/locales/index.bzl | file path B: packages/common/locales/index.bzl\n\n@@ -1,4 +1,5 @@\n load(\"@cldr_json_data//:index.bzl\", _ALL_CLDR_LOCALES = \"LOCALES\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"npm_package_bin\")\n \n # List of locales the tool can generate files for.\n LOCALES = _ALL_CLDR_LOCALES\n@@ -54,11 +55,12 @@ def generate_all_locale_files(name, **kwargs):\n             \"extra/%s.ts\" % locale,\n         ]\n \n-    native.genrule(\n+    npm_package_bin(\n         name = name,\n         outs = locale_files,\n-        srcs = [],\n-        exec_tools = [WRITE_LOCALE_FILES_TO_DIST_BIN],\n-        cmd = \"\"\"$(location %s) $(@D)\"\"\" % WRITE_LOCALE_FILES_TO_DIST_BIN,\n+        tool = WRITE_LOCALE_FILES_TO_DIST_BIN,\n+        args = [\n+            \"$(@D)\",\n+        ],\n         **kwargs\n     )\n\n---\n file path A: third_party/github.com/lukeed/resolve.exports/BUILD.bazel | file path B: third_party/github.com/lukeed/resolve.exports/BUILD.bazel\n\n@@ -11,6 +11,6 @@ filegroup(\n         \"index.mjs\",\n     ],\n     visibility = [\n-        \"//aio/tools/esm-loader:__pkg__\",\n+        \"//tools/esm-loader:__pkg__\",\n     ],\n )\n\n---\n file path A: tools/defaults.bzl | file path B: tools/defaults.bzl\n\n@@ -364,23 +364,63 @@ def protractor_web_test_suite(**kwargs):\n         **kwargs\n     )\n \n-def nodejs_binary(data = [], templated_args = [], **kwargs):\n+def nodejs_binary(data = [], env = {}, templated_args = [], enable_linker = False, **kwargs):\n+    data = data + [\n+        \"@%s//source-map-support\" % _node_modules_workspace_name(),\n+    ]\n+\n+    if not enable_linker:\n+        templated_args = templated_args + [\n+            # Disable the linker and rely on patched resolution which works better on Windows\n+            # and is less prone to race conditions when targets build concurrently.\n+            \"--nobazel_run_linker\",\n+        ]\n+\n+        (env, templated_args, data) = _apply_esm_import_patch(env, templated_args, data)\n+\n     _nodejs_binary(\n-        data = data + [\"@npm//source-map-support\"],\n-        # Disable the linker and rely on patched resolution which works better on Windows\n-        # and is less prone to race conditions when targets build concurrently.\n-        templated_args = [\"--nobazel_run_linker\"] + templated_args,\n+        data = data,\n+        env = env,\n+        templated_args = templated_args,\n         **kwargs\n     )\n \n-def nodejs_test(templated_args = [], **kwargs):\n+def nodejs_test(data = [], env = {}, templated_args = [], enable_linker = False, **kwargs):\n+    if not enable_linker:\n+        templated_args = templated_args + [\n+            # Disable the linker and rely on patched resolution which works better on Windows\n+            # and is less prone to race conditions when targets build concurrently.\n+            \"--nobazel_run_linker\",\n+        ]\n+\n+        (env, templated_args, data) = _apply_esm_import_patch(env, templated_args, data)\n+\n     _nodejs_test(\n-        # Disable the linker and rely on patched resolution which works better on Windows\n-        # and is less prone to race conditions when targets build concurrently.\n-        templated_args = [\"--nobazel_run_linker\"] + templated_args,\n+        data = data,\n+        env = env,\n+        templated_args = templated_args,\n         **kwargs\n     )\n \n+def _node_modules_workspace_name():\n+    return \"npm\" if not native.package_name().startswith(\"aio\") else \"aio_npm\"\n+\n+def _apply_esm_import_patch(env, templated_args, data):\n+    \"\"\"Adjust properties from a nodejs_binary/test to provide a custom esm loader\n+    to resolve third-party deps. Unlike for cjs modules, rules_nodejs doesn't patch\n+    imports when the linker is disabled.\"\"\"\n+\n+    env = dict(env, **{\"NODE_MODULES_WORKSPACE_NAME\": _node_modules_workspace_name()})\n+    templated_args = templated_args + [\n+        \"--node_options=--loader=$$(rlocation $(rootpath //tools/esm-loader:esm-loader.mjs))\",\n+    ]\n+    data = data + [\n+        \"//tools/esm-loader\",\n+        \"//tools/esm-loader:esm-loader.mjs\",\n+    ]\n+\n+    return (env, templated_args, data)\n+\n def npm_package_bin(args = [], **kwargs):\n     _npm_package_bin(\n         # Disable the linker and rely on patched resolution which works better on Windows\n\n---\n file path A: aio/tools/esm-loader/BUILD.bazel | file path B: tools/esm-loader/BUILD.bazel\n\n@@ -1,4 +1,4 @@\n-package(default_visibility = [\"//aio:__subpackages__\"])\n+package(default_visibility = [\"//visibility:public\"])\n \n exports_files([\n     \"esm-loader.mjs\",\n\n---\n file path A: aio/tools/esm-loader/esm-loader.mjs | file path B: tools/esm-loader/esm-loader.mjs\n\n@@ -1,7 +1,7 @@\n import fs from 'fs';\n import path from 'path';\n import {pathToFileURL} from 'url';\n-import {resolve as resolveExports} from '../../../third_party/github.com/lukeed/resolve.exports/index.mjs';\n+import {resolve as resolveExports} from '../../third_party/github.com/lukeed/resolve.exports/index.mjs';\n \n /*\n   Custom module loader (see https://nodejs.org/api/cli.html#--experimental-loadermodule) to support\n@@ -17,13 +17,7 @@ export async function resolve(specifier, context, defaultResolve) {\n       return defaultResolve(specifier, context, defaultResolve);\n     }\n \n-    let nodeModules;\n-    if (isBazelRunOrTestAction()) {\n-      nodeModules = path.resolve('../', process.env.NODE_MODULES_WORKSPACE_NAME, 'node_modules');\n-    } else {\n-      nodeModules = path.resolve('external', process.env.NODE_MODULES_WORKSPACE_NAME, 'node_modules');\n-    }\n-\n+    const nodeModules = path.resolve(process.env.RUNFILES_DIR, process.env.NODE_MODULES_WORKSPACE_NAME, 'node_modules');\n     const packageImport = parsePackageImport(specifier);\n     const pathToNodeModule = path.join(nodeModules, packageImport.packageName);\n \n@@ -58,8 +52,4 @@ function resolvePackageLocalFilepath(packageImport, packageJson) {\n     }\n \n     return packageImport.pathInPackage || packageJson.module || packageJson.main || 'index.js';\n-}\n-\n-function isBazelRunOrTestAction() {\n-  return process.env.TEST_WORKSPACE || process.env.BUILD_WORKSPACE_DIRECTORY;\n-}\n+}\n\\ No newline at end of file\n\n\n###\n\n", "completion": "build(bazel): merge aio/tools/defaults.bzl and tools/defaults.bzl"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -124,6 +124,7 @@ yarn_install(\n     data = [\n         YARN_LABEL,\n         \"//:.yarnrc\",\n+        \"//aio:tools/cli-patches/bazel-architect-output.patch\",\n         \"//aio:tools/cli-patches/patch.js\",\n     ],\n     # Currently disabled due to:\n\n---\n file path A: aio/tools/cli-patches/README.md | file path B: aio/tools/cli-patches/README.md\n\n@@ -2,4 +2,6 @@\n \n The AIO application is built using the Angular CLI tool. We are often trialling new features for the CLI, which we apply to the library after it is installed.  This folder contains git patch files that contain these new features and a utility to apply those patches to the CLI library.\n \n-**Currently, we have no patches to run.**\n+# Patches\n+\n+1. [bazel-architect-output.patch](./bazel-architect-output.patch) - Patch architect to not clear the console before reporting the result of an operation. This makes it easier when working in bazel so that the cause of build and test errors can be seen in the console without needing to search through the command or test logs.\n\\ No newline at end of file\n\n---\n file path A: None | file path B: aio/tools/cli-patches/bazel-architect-output.patch\n\n@@ -0,0 +1,13 @@\n+diff --git node_modules/@angular-devkit/architect-cli/bin/architect.js node_modules/@angular-devkit/architect-cli/bin/architect.js\n+index 27b74b3..96b16a4 100644\n+--- node_modules/@angular-devkit/architect-cli/bin/architect.js\n++++ node_modules/@angular-devkit/architect-cli/bin/architect.js\n+@@ -198,8 +198,6 @@ async function main(args) {\n+     // Show usage of deprecated options\n+     registry.useXDeprecatedProvider((msg) => logger.warn(msg));\n+     const { workspace } = await core_1.workspaces.readWorkspace(configFilePath, core_1.workspaces.createWorkspaceHost(new node_2.NodeJsSyncHost()));\n+-    // Clear the console.\n+-    process.stdout.write('\\u001Bc');\n+     return await _executeTarget(logger, workspace, root, argv, registry);\n+ }\n+ main(process.argv.slice(2)).then((code) => {\n\n\n###\n\n", "completion": "build(bazel): patch architect to not clear output"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -30,8 +30,7 @@\n     \"test-a11y-score-localhost\": \"bazel test //aio:test-a11y-score-localhost\",\n     \"test-pwa-score\": \"sh -c 'bazel run //aio/scripts:audit-web-app ${0} ${1}'\",\n     \"test-pwa-score-localhost\": \"bazel test //aio:test-pwa-score-localhost\",\n-    \"example-e2e\": \"bazel test //aio/content/examples/...\",\n-    \"example-e2e-local\": \"yarn example-e2e --config=aio_local_deps\",\n+    \"example-e2e\": \"node --experimental-import-meta-resolve tools/examples/run-filtered-example-e2es.mjs\",\n     \"example-lint\": \"eslint content/examples\",\n     \"deploy-production\": \"bazel run //aio/scripts/deploy-to-firebase\",\n     \"check-env\": \"yarn ~~check-env\",\n\n---\n file path A: None | file path B: aio/tools/examples/run-filtered-example-e2es.mjs\n\n@@ -0,0 +1,70 @@\n+import {spawnSync} from 'child_process';\n+import { fileURLToPath } from 'url';\n+import yargs from 'yargs';\n+import {hideBin} from 'yargs/helpers';\n+\n+/**\n+ * Run Protractor End-to-End Tests for Doc Examples\n+ *\n+ * Flags\n+ *  --filter to filter/select example app subdir names\n+ *    Can be used multiple times to include multiple patterns.\n+ *    e.g. --filter=foo  // all example apps with 'foo' in their folder names.\n+ *\n+ *  --exclude to exclude example app subdir names\n+ *    Can be used multiple times to exclude multiple patterns.\n+ *    NOTE: `--exclude` is always considered after `--filter`.\n+ *    e.g. --exclude=bar  // Exclude all example apps with 'bar' in their folder names.\n+ * \n+ *  --local to use the locally built Angular packages, rather than versions from npm\n+ */\n+async function main(args) {\n+  const bazel = fileURLToPath(await import.meta.resolve(\"@bazel/bazelisk\"));\n+  const labels = queryAllE2eLabels(bazel);\n+    \n+  const includeFilters = getFiltersFromArg(args.filter);\n+  const excludeFilters = getFiltersFromArg(args.exclude);\n+    \n+  const includedTestLabels = filterTestLabels(labels, includeFilters, excludeFilters);\n+    \n+  runE2eTests(bazel, includedTestLabels, !!args.local);\n+}\n+\n+function queryAllE2eLabels(bazel) {\n+  const stdout = spawnSync(bazel, [\n+    'query',\n+    'kind(\\'nodejs_test\\',//aio/content/examples/...)',\n+    '--output=label',\n+  ], {stdio: 'pipe', encoding: 'utf-8'}).stdout;\n+    \n+  const labels = stdout.split('\\n').filter(line => line.startsWith('//') && line.endsWith(':e2e'));\n+  return labels;\n+}\n+\n+function runE2eTests(bazel, labels, local) {\n+  const args = ['test', '--', ...labels];\n+  if (local) {\n+    args.splice(1, 0, '--config=aio_local_deps');\n+  }\n+  spawnSync(bazel, args, {stdio: 'inherit'});\n+}\n+\n+function getFiltersFromArg(arg) {\n+  if (!arg) {\n+    return [];\n+  }\n+  return Array.isArray(arg) ? arg : [arg];\n+}\n+\n+function filterTestLabels(testLabels, includeFilters, excludeFilters) {\n+  let includedTestLabels = testLabels;\n+  if (includeFilters.length) {\n+    includedTestLabels = includedTestLabels.filter(label =>\n+      includeFilters.some(str => label.includes(str))\n+    );\n+  }\n+  includedTestLabels = includedTestLabels.filter(label => !excludeFilters.some(str => label.includes(str)));\n+  return includedTestLabels;\n+}\n+\n+(async() => await main(yargs(hideBin(process.argv)).argv))();\n\\ No newline at end of file\n\n\n###\n\n", "completion": "build(bazel): restore filtering for example e2e tests"}
{"prompt": " file path A: integration/index.bzl | file path B: integration/index.bzl\n\n@@ -6,7 +6,7 @@\n \"\"\"\n \n load(\"//integration:npm_package_archives.bzl\", \"NPM_PACKAGE_ARCHIVES\", \"npm_package_archive_label\")\n-load(\"@npm//@angular/dev-infra-private/bazel/integration:index.bzl\", \"integration_test\")\n+load(\"@npm//@angular/build-tooling/bazel/integration:index.bzl\", \"integration_test\")\n load(\"//:packages.bzl\", \"INTEGRATION_PACKAGES\")\n \n def _ng_integration_test(name, setup_chromium = False, **kwargs):\n\n\n###\n\n", "completion": "build(bazel): fix load statement to point to new dev-infra package"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -184,7 +184,7 @@ copy_to_bin(\n )\n \n architect(\n-    name = \"build\",\n+    name = \"build-app\",\n     args = [\n         \"site:build:stable\",\n         \"--output-path=build\",\n@@ -217,11 +217,13 @@ npm_package_bin(\n     tool = \"//aio/scripts:build-404-page\",\n )\n \n+# Prepare the final build artifact which substitutes a generated 404 page\n+# into the architect output.\n copy_to_directory(\n-    name = \"build-with-404\",\n+    name = \"build\",\n     srcs = [\n         \":404-page\",\n-        \":build\",\n+        \":build-app\",\n     ],\n     replace_prefixes = {\n         \"build\": \"\",\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -10,7 +10,6 @@\n     \"start\": \"yarn check-env && ng serve\",\n     \"prebuild\": \"yarn setup\",\n     \"build\": \"bazel build //aio:build\",\n-    \"build:bazel\": \"bazelisk build //aio:build\",\n     \"prebuild-local\": \"yarn setup-local\",\n     \"build-local\": \"yarn build --config=aio_local_deps\",\n     \"prebuild-local-ci\": \"yarn setup-local-ci\",\n@@ -24,7 +23,7 @@\n     \"e2e\": \"bazel test //aio:e2e\",\n     \"e2e-local\": \"yarn e2e --config=aio_local_deps\",\n     \"setup\": \"yarn --cwd .. install && yarn install --frozen-lockfile && yarn ~~check-env\",\n-    \"set-opensearch-url\": \"node --eval \\\"const sh = require('shelljs'); sh.set('-e'); sh.sed('-i', /PLACEHOLDER_URL/g, process.argv[1], 'dist/assets/opensearch.xml');\\\"\",\n+    \"set-opensearch-url\": \"node --eval \\\"const sh = require('shelljs'); sh.set('-e'); sh.sed('-i', /PLACEHOLDER_URL/g, process.argv[1], '../dist/bin/aio/build/assets/opensearch.xml');\\\"\",\n     \"presmoke-tests\": \"yarn update-webdriver\",\n     \"smoke-tests\": \"protractor tests/deployment/e2e/protractor.conf.js --suite smoke --baseUrl\",\n     \"test-a11y-score\": \"bazel run //aio/scripts:test-aio-a11y\",\n\n---\n file path A: aio/scripts/build-artifacts.sh | file path B: aio/scripts/build-artifacts.sh\n\n@@ -5,7 +5,7 @@ set -eu -o pipefail\n readonly relativeOutputPath=$1\n readonly prNumber=$2\n readonly prLastSha=$3\n-readonly inputDir=dist/\n+readonly inputDir=../dist/bin/aio/build\n readonly outputFile=$PROJECT_ROOT/$relativeOutputPath\n readonly deployedUrl=https://pr${prNumber}-${prLastSha:0:7}.ngbuilds.io/\n \n@@ -13,7 +13,7 @@ readonly deployedUrl=https://pr${prNumber}-${prLastSha:0:7}.ngbuilds.io/\n   cd $PROJECT_ROOT/aio\n \n   # Build and store the app\n-  yarn build --progress=false\n+  yarn build\n \n   # Set deployedUrl as parameter in the opensearch description\n   # deployedUrl must end with /\n\n\n###\n\n", "completion": "build(bazel): adjust aio opensearch substitution with bazel paths"}
{"prompt": " file path A: aio/tests/deployment/unit/BUILD.bazel | file path B: aio/tests/deployment/unit/BUILD.bazel\n\n@@ -11,6 +11,7 @@ nodejs_test(\n         \"//aio:ngsw-config.json\",\n         \"//aio:tsconfig.json\",\n         \"//aio/tests/deployment/shared\",\n+        \"//aio/tools/firebase-test-utils:sources\",\n         \"//packages/service-worker/config:sources\",\n         \"@aio_npm//@types/jasmine\",\n         \"@aio_npm//canonical-path\",\n@@ -19,5 +20,8 @@ nodejs_test(\n         \"@aio_npm//ts-node\",\n         \"@aio_npm//xregexp\",\n     ],\n+    # This test script runs ts-node which seems to bypass rules_nodejs require\n+    # patching and cannot find deps. Enable the linker for this target.\n+    enable_linker = True,\n     entry_point = \"test.js\",\n )\n\n---\n file path A: aio/tests/deployment/unit/test.js | file path B: aio/tests/deployment/unit/test.js\n\n@@ -14,9 +14,12 @@ const Jasmine = require('jasmine');\n const {join} = require('path');\n const {register} = require('ts-node');\n \n-register({project: join(__dirname, 'tsconfig.json')});\n+const runfilesRoot = process.cwd();\n+const dirname = join(runfilesRoot, 'aio', 'tests', 'deployment', 'unit');\n \n-const runner = new Jasmine({projectBaseDir: __dirname});\n+register({project: join(dirname, 'tsconfig.json')});\n+\n+const runner = new Jasmine({projectBaseDir: dirname});\n runner.loadConfig({spec_files: ['**/*.spec.ts']});\n runner.execute().catch((error) => {\n   // Something broke so non-zero exit to prevent the process from succeeding.\n\n---\n file path A: aio/tools/firebase-test-utils/BUILD.bazel | file path B: aio/tools/firebase-test-utils/BUILD.bazel\n\n@@ -1,14 +1,24 @@\n load(\"//aio/tools:defaults.bzl\", \"nodejs_test\")\n \n+filegroup(\n+    name = \"sources\",\n+    srcs = glob([\"*.ts\"]),\n+    visibility = [\"//aio/tests/deployment/unit:__pkg__\"],\n+)\n+\n nodejs_test(\n     name = \"test\",\n     data = [\n         \"tsconfig.json\",\n+        \":sources\",\n         \"//aio:tsconfig.json\",\n         \"@aio_npm//@types/jasmine\",\n         \"@aio_npm//jasmine\",\n         \"@aio_npm//ts-node\",\n         \"@aio_npm//xregexp\",\n-    ] + glob([\"*.ts\"]),\n+    ],\n+    # This test script runs ts-node which seems to bypass rules_nodejs require\n+    # patching and cannot find deps. Enable the linker for this target.\n+    enable_linker = True,\n     entry_point = \"test.js\",\n )\n\n---\n file path A: aio/tools/firebase-test-utils/FirebaseRedirectSource.spec.ts | file path B: aio/tools/firebase-test-utils/FirebaseRedirectSource.spec.ts\n\n@@ -361,5 +361,5 @@ function testSourceMatch(\n     matches: { [url: string]: unknown|undefined }) {\n   expect(source.namedGroups).toEqual(captures.named || []);\n   expect(source.restNamedGroups).toEqual(captures.rest || []);\n-  Object.keys(matches).forEach(url => expect(source.match(url)).toEqual(matches[url]));\n+  Object.keys(matches).forEach(url => expect(source.match(url) as any).toEqual(matches[url]));\n }\n\n---\n file path A: aio/tools/firebase-test-utils/test.js | file path B: aio/tools/firebase-test-utils/test.js\n\n@@ -14,9 +14,12 @@ const Jasmine = require('jasmine');\n const {join} = require('path');\n const {register} = require('ts-node');\n \n-register({project: join(__dirname, 'tsconfig.json')});\n+const runfilesRoot = process.cwd();\n+const dirname = join(runfilesRoot, 'aio', 'tools', 'firebase-test-utils');\n \n-const runner = new Jasmine({projectBaseDir: __dirname});\n+register({project: join(dirname, 'tsconfig.json')});\n+\n+const runner = new Jasmine({projectBaseDir: dirname});\n runner.loadConfig({spec_files: ['**/*.spec.ts']});\n runner.execute().catch((error) => {\n   // Something broke so non-zero exit to prevent the process from succeeding.\n\n\n###\n\n", "completion": "build(bazel): fix a bug where aio firebase utils tests could not link"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -34,7 +34,7 @@\n     \"example-e2e\": \"bazel test //aio/content/examples/...\",\n     \"example-e2e-local\": \"yarn example-e2e --config=aio_local_deps\",\n     \"example-lint\": \"eslint content/examples\",\n-    \"deploy-production\": \"node scripts/deploy-to-firebase/index.mjs\",\n+    \"deploy-production\": \"bazel run //aio/scripts/deploy-to-firebase\",\n     \"check-env\": \"yarn ~~check-env\",\n     \"payload-size\": \"scripts/payload.sh\",\n     \"predocs\": \"node scripts/contributors/validate-data && bazel build -- //aio:stackblitz //aio:example-zips\",\n@@ -46,7 +46,7 @@\n     \"redirects-test\": \"bazel test //aio/tests/deployment/unit:test\",\n     \"firebase-utils-test\": \"bazel test //aio/tools/firebase-test-utils:test\",\n     \"tools-lint\": \"eslint --ext=.mjs scripts/deploy-to-firebase && eslint tools/firebase-test-utils\",\n-    \"tools-test\": \"bazel test //aio/tools/... && jasmine scripts/deploy-to-firebase/**/*.spec.mjs\",\n+    \"tools-test\": \"bazel test -- //aio/tools/... //aio/scripts/deploy-to-firebase:test\",\n     \"serve\": \"bazel run //aio:serve\",\n     \"serve-local\": \"yarn serve --config=aio_local_deps\",\n     \"serve-and-sync\": \"bazel run //aio:fast-serve\",\n\n---\n file path A: None | file path B: aio/scripts/deploy-to-firebase/BUILD.bazel\n\n@@ -0,0 +1,24 @@\n+load(\"@aio_npm//@bazel/jasmine:index.bzl\", \"jasmine_node_test\")\n+load(\"//aio/tools:defaults.bzl\", \"nodejs_binary\")\n+\n+DEPLOY_TO_FIREBASE_SOURCES = glob(\n+    [\"**/*.mjs\"],\n+    [\"**/*.spec.mjs\"],\n+)\n+\n+DEPLOY_TO_FIREBASE_DEPS = [\n+    \"@aio_npm//shelljs\",\n+]\n+\n+nodejs_binary(\n+    name = \"deploy-to-firebase\",\n+    data = DEPLOY_TO_FIREBASE_SOURCES + DEPLOY_TO_FIREBASE_DEPS,\n+    entry_point = \"index.mjs\",\n+)\n+\n+jasmine_node_test(\n+    name = \"test\",\n+    srcs = glob([\"**/*.spec.mjs\"]),\n+    data = DEPLOY_TO_FIREBASE_SOURCES,\n+    deps = DEPLOY_TO_FIREBASE_DEPS,\n+)\n\n---\n file path A: aio/scripts/deploy-to-firebase/index.mjs | file path B: aio/scripts/deploy-to-firebase/index.mjs\n\n@@ -48,8 +48,8 @@\n  *     in human-readable format to stdout).)\n  */\n \n+import path from 'path';\n import sh from 'shelljs';\n-import {fileURLToPath} from 'url';\n import post from './post-deploy-actions.mjs';\n import pre from './pre-deploy-actions.mjs';\n import u from './utils.mjs';\n@@ -58,8 +58,9 @@ sh.set('-e');\n \n \n // Constants\n-const DIRNAME = u.getDirname(import.meta.url);\n-const ROOT_PKG_PATH = `${DIRNAME}/../../../package.json`;\n+const RUNFILES_ROOT = process.cwd();\n+const DIRNAME = path.join(RUNFILES_ROOT, 'aio', 'scripts', 'deploy-to-firebase');\n+const ROOT_PKG_PATH = path.join(RUNFILES_ROOT, 'package.json');\n \n // Exports\n export {\n@@ -74,7 +75,7 @@ export {\n // references the full file path (including the file extension).\n // See https://stackoverflow.com/questions/45136831/node-js-require-main-module#answer-60309682 for\n // more details.\n-if (fileURLToPath(import.meta.url) === process.argv[1]) {\n+if (path.resolve(DIRNAME, 'index.mjs') === process.argv[1]) {\n   const isDryRun = process.argv[2] === '--dry-run';\n   const inputVars = computeInputVars(process.env);\n   const deploymentsInfo = computeDeploymentsInfo(inputVars);\n\n---\n file path A: aio/scripts/deploy-to-firebase/index.spec.mjs | file path B: aio/scripts/deploy-to-firebase/index.spec.mjs\n\n@@ -1,4 +1,5 @@\n import {execSync} from 'child_process';\n+import path from 'path';\n import {\n   computeDeploymentsInfo,\n   computeInputVars,\n@@ -575,7 +576,7 @@ describe('deploy-to-firebase:', () => {\n     // and thus does not share the `getRemoteRefs()` cache. To improve stability, we use an older\n     // branch (`4.4.x`) that is unlikely to receive any new commits (so the one retrieved at the\n     // beginning of the tests will still be the latest one for that branch).\n-    const scriptPath = `${u.getDirname(import.meta.url)}/index.mjs`;\n+    const scriptPath = path.join('aio', 'scripts', 'deploy-to-firebase', 'index.mjs');\n     const cmd = `\"${process.execPath}\" \"${scriptPath}\" --dry-run`;\n     const env = {\n       CI_REPO_OWNER: 'angular',\n\n\n###\n\n", "completion": "build(bazel): run firebase deployment tests under bazel"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -336,8 +336,6 @@ jobs:\n \n         # TODO: run the following tests under bazel\n \n-        # Run PWA-score tests\n-      - run: yarn --cwd aio test-pwa-score-localhost $CI_AIO_MIN_PWA_SCORE\n         # Check the bundle sizes.\n       - run: yarn --cwd aio payload-size\n \n@@ -364,8 +362,6 @@ jobs:\n \n         # TODO: run the following tests under bazel\n \n-        # Run PWA-score tests\n-      - run: yarn --cwd aio test-pwa-score-localhost $CI_AIO_MIN_PWA_SCORE\n         # Check the bundle sizes.\n       - run: yarn --cwd aio payload-size aio-local\n \n\n---\n file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -1,9 +1,10 @@\n load(\"@aio_npm//@angular-devkit/architect-cli:index.bzl\", \"architect\", \"architect_test\")\n load(\"@build_bazel_rules_nodejs//:index.bzl\", \"copy_to_bin\", \"npm_package_bin\")\n-load(\"//aio/tools:defaults.bzl\", \"nodejs_binary\", \"nodejs_test\")\n+load(\"//aio/tools:defaults.bzl\", \"nodejs_binary\")\n load(\"@aspect_bazel_lib//lib:copy_to_directory.bzl\", \"copy_to_directory\")\n load(\":local_packages_util.bzl\", \"link_local_packages\", \"substitute_local_packages\")\n load(\"@bazel_skylib//rules:common_settings.bzl\", \"bool_flag\")\n+load(\"//aio/scripts:local_server_test.bzl\", \"local_server_test\")\n \n # The write_source_files macro is used to write bazel outputs to the source tree and test that they are up to date.\n # See: https://docs.aspect.build/aspect-build/bazel-lib/v0.5.0/docs/docs/write_source_files-docgen.html\n@@ -314,20 +315,22 @@ nodejs_binary(\n     },\n )\n \n-nodejs_test(\n+local_server_test(\n     name = \"test-a11y-score-localhost\",\n+    args = [\"LOCALHOST_URL\"],\n+    entry_point = \"//aio/scripts:test-aio-a11y\",\n+    serve_target = \":build\",\n+)\n+\n+local_server_test(\n+    name = \"test-pwa-score-localhost\",\n     args = [\n-        \"$(rootpath @aio_npm//light-server/bin:light-server)\",\n-        \"$(rootpath :build)\",\n-        \"$(rootpath //aio/scripts:test-aio-a11y)\",\n+        \"LOCALHOST_URL\",\n+        \"all:0,pwa:100\",\n     ],\n     data = [\n-        \":build\",\n-        \"//aio/scripts:test-aio-a11y\",\n-        \"@aio_npm//get-port\",\n-        \"@aio_npm//light-server/bin:light-server\",\n-        \"@aio_npm//shelljs\",\n-        \"@aio_npm//tree-kill\",\n+        \"//aio/scripts:audit-web-app\",\n     ],\n-    entry_point = \"//aio/scripts:test-aio-a11y-localhost.mjs\",\n+    entry_point = \"//aio/scripts:audit-web-app-script\",\n+    serve_target = \":build\",\n )\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -29,8 +29,8 @@\n     \"smoke-tests\": \"protractor tests/deployment/e2e/protractor.conf.js --suite smoke --baseUrl\",\n     \"test-a11y-score\": \"bazel run //aio/scripts:test-aio-a11y\",\n     \"test-a11y-score-localhost\": \"bazel test //aio:test-a11y-score-localhost\",\n-    \"test-pwa-score\": \"run-s \\\"~~audit-web-app {1} all:0,pwa:{2} {3}\\\" --\",\n-    \"test-pwa-score-localhost\": \"run-p --race \\\"~~light-server -s dist -p 4200 --quiet\\\" \\\"test-pwa-score http://localhost:4200 {1} {2}\\\" --\",\n+    \"test-pwa-score\": \"sh -c 'bazel run //aio/scripts:audit-web-app ${0} ${1}'\",\n+    \"test-pwa-score-localhost\": \"bazel test //aio:test-pwa-score-localhost\",\n     \"example-e2e\": \"bazel test //aio/content/examples/...\",\n     \"example-e2e-local\": \"yarn example-e2e --config=aio_local_deps\",\n     \"example-lint\": \"eslint content/examples\",\n\n---\n file path A: aio/scripts/BUILD.bazel | file path B: aio/scripts/BUILD.bazel\n\n@@ -5,7 +5,7 @@ load(\"@aio_npm//@angular/build-tooling/bazel:filter_outputs.bzl\", \"filter_output\n package(default_visibility = [\"//visibility:public\"])\n \n exports_files([\n-    \"test-aio-a11y-localhost.mjs\",\n+    \"run-with-local-server.mjs\",\n ])\n \n nodejs_binary(\n\n---\n file path A: None | file path B: aio/scripts/local_server_test.bzl\n\n@@ -0,0 +1,32 @@\n+load(\"//aio/tools:defaults.bzl\", \"nodejs_test\")\n+\n+def local_server_test(name, entry_point, serve_target, data = [], args = []):\n+    \"\"\"Run a test script alongside a locally running http server.\n+\n+    Args:\n+        name: Name of the test target\n+        entry_point: The test script to run\n+        serve_target: The contents to serve\n+        data: Additional data required by the test script\n+        args: Args to pass to the test script. Note: The special argument LOCALHOST_URL\n+          will be substituted with the url pointing to the served contents.\n+    \"\"\"\n+    nodejs_test(\n+        name = name,\n+        testonly = True,\n+        args = [\n+            \"$(rootpath @aio_npm//light-server/bin:light-server)\",\n+            \"$(rootpath %s)\" % serve_target,\n+            \"$(rootpath %s)\" % entry_point,\n+        ] + args,\n+        data = [\n+            entry_point,\n+            serve_target,\n+            \"//aio/scripts:run-with-local-server.mjs\",\n+            \"@aio_npm//get-port\",\n+            \"@aio_npm//light-server/bin:light-server\",\n+            \"@aio_npm//shelljs\",\n+            \"@aio_npm//tree-kill\",\n+        ] + data,\n+        entry_point = \"//aio/scripts:run-with-local-server.mjs\",\n+    )\n\n---\n file path A: aio/scripts/test-aio-a11y-localhost.mjs | file path B: aio/scripts/run-with-local-server.mjs\n\n@@ -4,24 +4,21 @@ import treeKill from 'tree-kill';\n \n sh.set('-e');\n \n-// Serve AIO locally on an unused port and run a11y audit tests against it.\n-// \n-// This script is a wrapper around the existing test-aio-a11y.mjs script,\n-// but additionally acquires an unused port and sets up a local http server\n-// prior to running the audit so that it can be run concurrently with other\n-// tests under bazel without port contention.\n+// Serve contents over http while running an abitrary script. This is an\n+// implementation for the bazel macro local_server_test.\n //\n-// Arguments: <lightserverScript> <distDir> <testAioA11yScript>\n+// Arguments: <lightserverScript> <distDir> <testScript> [testScriptArg ...]\n //    lightserverScript - path light-server binary\n-//    distDir - path to aio dist folder\n-//    testAioA11yScript - path to the nodejs_binary bash script wrapping\n-//     the test-aio-a11y.mjs script\n+//    distDir - path to the contents to serve\n+//    testScript - path to a script to run\n+//    ...testScriptArg - arguments to pass to the test script. The argument LOCALHOST_URL\n+//      will be substituted with the url of the served contents\n \n async function main(args) {\n   const lightserver = args[0];\n   const distDir = args[1];\n-  const testAioA11y = args[2];\n-\n+  const testScript = args[2];\n+  const testScriptArgs = args.slice(3);\n   const port = await getPort();\n \n   const lightserverCmd = [\n@@ -36,9 +33,13 @@ async function main(args) {\n     '--quiet'\n   ];\n   const lightserverProcess = sh.exec(lightserverCmd.join(' '), {async: true, silent: true});\n+    \n+  const command = [\n+    testScript,\n+    ...testScriptArgs\n+  ].join(' ').replace('LOCALHOST_URL', `http://localhost:${port}`);\n \n-  const testAioA11yCmd = `${testAioA11y} http://localhost:${port}`;\n-  sh.exec(testAioA11yCmd);\n+  sh.exec(command);\n     \n   await killProcess(lightserverProcess);\n }\n@@ -54,4 +55,4 @@ function killProcess(childProcess) {\n       resolve();\n     });\n   });\n-}\n+}\n\\ No newline at end of file\n\n\n###\n\n", "completion": "build(bazel): test aio pwa score under bazel"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -338,8 +338,6 @@ jobs:\n \n         # Run PWA-score tests\n       - run: yarn --cwd aio test-pwa-score-localhost $CI_AIO_MIN_PWA_SCORE\n-        # Run accessibility tests\n-      - run: yarn --cwd aio test-a11y-score-localhost\n         # Check the bundle sizes.\n       - run: yarn --cwd aio payload-size\n \n\n---\n file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -1,6 +1,6 @@\n load(\"@aio_npm//@angular-devkit/architect-cli:index.bzl\", \"architect\", \"architect_test\")\n load(\"@build_bazel_rules_nodejs//:index.bzl\", \"copy_to_bin\", \"npm_package_bin\")\n-load(\"//aio/tools:defaults.bzl\", \"nodejs_binary\")\n+load(\"//aio/tools:defaults.bzl\", \"nodejs_binary\", \"nodejs_test\")\n load(\"@aspect_bazel_lib//lib:copy_to_directory.bzl\", \"copy_to_directory\")\n load(\":local_packages_util.bzl\", \"link_local_packages\", \"substitute_local_packages\")\n load(\"@bazel_skylib//rules:common_settings.bzl\", \"bool_flag\")\n@@ -313,3 +313,21 @@ nodejs_binary(\n         \"BAZEL_DGENI_OUTPUT_PATH\": \"dgeni-fast\",\n     },\n )\n+\n+nodejs_test(\n+    name = \"test-a11y-score-localhost\",\n+    args = [\n+        \"$(rootpath @aio_npm//light-server/bin:light-server)\",\n+        \"$(rootpath :build)\",\n+        \"$(rootpath //aio/scripts:test-aio-a11y)\",\n+    ],\n+    data = [\n+        \":build\",\n+        \"//aio/scripts:test-aio-a11y\",\n+        \"@aio_npm//get-port\",\n+        \"@aio_npm//light-server/bin:light-server\",\n+        \"@aio_npm//shelljs\",\n+        \"@aio_npm//tree-kill\",\n+    ],\n+    entry_point = \"//aio/scripts:test-aio-a11y-localhost.mjs\",\n+)\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -27,8 +27,8 @@\n     \"set-opensearch-url\": \"node --eval \\\"const sh = require('shelljs'); sh.set('-e'); sh.sed('-i', /PLACEHOLDER_URL/g, process.argv[1], 'dist/assets/opensearch.xml');\\\"\",\n     \"presmoke-tests\": \"yarn update-webdriver\",\n     \"smoke-tests\": \"protractor tests/deployment/e2e/protractor.conf.js --suite smoke --baseUrl\",\n-    \"test-a11y-score\": \"node scripts/test-aio-a11y.mjs\",\n-    \"test-a11y-score-localhost\": \"run-p --race \\\"~~light-server -s dist -p 4200 --quiet\\\" \\\"test-a11y-score http://localhost:4200\\\" --\",\n+    \"test-a11y-score\": \"bazel run //aio/scripts:test-aio-a11y\",\n+    \"test-a11y-score-localhost\": \"bazel test //aio:test-a11y-score-localhost\",\n     \"test-pwa-score\": \"run-s \\\"~~audit-web-app {1} all:0,pwa:{2} {3}\\\" --\",\n     \"test-pwa-score-localhost\": \"run-p --race \\\"~~light-server -s dist -p 4200 --quiet\\\" \\\"test-pwa-score http://localhost:4200 {1} {2}\\\" --\",\n     \"example-e2e\": \"bazel test //aio/content/examples/...\",\n@@ -91,11 +91,11 @@\n   \"devDependencies\": {\n     \"@angular-devkit/architect-cli\": \"0.1500.0-rc.0\",\n     \"@angular-devkit/build-angular\": \"15.0.0-rc.0\",\n-    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#57f54ed3b9b00a7fdf4d537994d3143bbefb3585\",\n     \"@angular-eslint/builder\": \"^14.0.0\",\n     \"@angular-eslint/eslint-plugin\": \"^14.0.0\",\n     \"@angular-eslint/eslint-plugin-template\": \"^14.0.0\",\n     \"@angular-eslint/template-parser\": \"^14.0.0\",\n+    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#57f54ed3b9b00a7fdf4d537994d3143bbefb3585\",\n     \"@angular/cli\": \"15.0.0-rc.0\",\n     \"@angular/compiler-cli\": \"15.0.0-rc.0\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n@@ -155,6 +155,7 @@\n     \"lunr\": \"^2.3.9\",\n     \"npm-run-all\": \"^4.1.5\",\n     \"protractor\": \"~7.0.0\",\n+    \"puppeteer-core\": \"10.2.0\",\n     \"rehype-slug\": \"^4.0.1\",\n     \"remark\": \"^12.0.0\",\n     \"remark-html\": \"^13.0.0\",\n\n---\n file path A: aio/scripts/BUILD.bazel | file path B: aio/scripts/BUILD.bazel\n\n@@ -1,8 +1,13 @@\n load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n-load(\"//aio/tools:defaults.bzl\", \"nodejs_binary\")\n+load(\"//aio/tools:defaults.bzl\", \"nodejs_binary\", \"nodejs_test\")\n+load(\"@aio_npm//@angular/build-tooling/bazel:filter_outputs.bzl\", \"filter_outputs\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n+exports_files([\n+    \"test-aio-a11y-localhost.mjs\",\n+])\n+\n nodejs_binary(\n     name = \"build-ngsw-config\",\n     data = [\n@@ -29,3 +34,57 @@ nodejs_binary(\n     name = \"build-404-page\",\n     entry_point = \"build-404-page.js\",\n )\n+\n+nodejs_binary(\n+    name = \"audit-web-app\",\n+    testonly = True,\n+    data = [\n+        \"@aio_npm//@angular/build-tooling/bazel/browsers/chromium\",\n+        \"@aio_npm//lighthouse\",\n+        \"@aio_npm//lighthouse-logger\",\n+        \"@aio_npm//puppeteer-core\",\n+    ],\n+    entry_point = \"audit-web-app.mjs\",\n+    env = {\n+        \"CHROME_BIN\": \"$(CHROMIUM)\",\n+    },\n+    toolchains = [\n+        \"@aio_npm//@angular/build-tooling/bazel/browsers/chromium:toolchain_alias\",\n+    ],\n+)\n+\n+# Extract the executable audit script from DefaultInfo so that we can use\n+# $(rootpath) on it.\n+filter_outputs(\n+    name = \"audit-web-app-script\",\n+    testonly = True,\n+    filters = [\"audit-web-app.sh\"],\n+    target = \":audit-web-app\",\n+)\n+\n+# This should be a nodejs_binary, however calling \"bazel run\" on this target\n+# on OSX causes the runfiles build to fail due to bazel-provided chromium having\n+# files with spaces in the name. However, it works when run in the sandbox when\n+# called using \"bazel test\".\n+#\n+# On Windows/Linux, call with:\n+#\n+#    bazel run //aio/scripts:test-aio-a11y [targetUrl]\n+#\n+# On OXS call with:\n+#\n+#    bazel test //aio/scripts:test-aio-a11y --test_arg=[targetUrl]\n+nodejs_test(\n+    name = \"test-aio-a11y\",\n+    testonly = True,\n+    data = [\n+        \":audit-web-app\",\n+        \":audit-web-app-script\",\n+        \"@aio_npm//shelljs\",\n+    ],\n+    entry_point = \"test-aio-a11y.mjs\",\n+    env = {\n+        \"AUDIT_SCRIPT_PATH\": \"$(rootpath :audit-web-app-script)\",\n+    },\n+    tags = [\"manual\"],\n+)\n\n---\n file path A: aio/scripts/audit-web-app.mjs | file path B: aio/scripts/audit-web-app.mjs\n\n@@ -27,7 +27,8 @@\n import lighthouse from 'lighthouse';\n import * as printer from 'lighthouse/lighthouse-cli/printer.js';\n import logger from 'lighthouse-logger';\n-import puppeteer from 'puppeteer';\n+import puppeteer from 'puppeteer-core';\n+import path from 'path';\n \n // Constants\n const AUDIT_CATEGORIES = ['accessibility', 'best-practices', 'performance', 'pwa', 'seo'];\n@@ -57,7 +58,7 @@ async function _main(args) {\n   try {\n     console.log('');\n     const startTime = Date.now();\n-    const browser = await puppeteer.launch();\n+    const browser = await puppeteer.launch({executablePath: path.resolve(process.env.CHROME_BIN), args: ['--no-sandbox', '--headless']});\n     const browserVersion = await browser.version();\n     const results = await runLighthouse(browser, url, lhFlags, lhConfig);\n \n\n---\n file path A: None | file path B: aio/scripts/test-aio-a11y-localhost.mjs\n\n@@ -0,0 +1,57 @@\n+import getPort from 'get-port';\n+import sh from 'shelljs';\n+import treeKill from 'tree-kill';\n+\n+sh.set('-e');\n+\n+// Serve AIO locally on an unused port and run a11y audit tests against it.\n+// \n+// This script is a wrapper around the existing test-aio-a11y.mjs script,\n+// but additionally acquires an unused port and sets up a local http server\n+// prior to running the audit so that it can be run concurrently with other\n+// tests under bazel without port contention.\n+//\n+// Arguments: <lightserverScript> <distDir> <testAioA11yScript>\n+//    lightserverScript - path light-server binary\n+//    distDir - path to aio dist folder\n+//    testAioA11yScript - path to the nodejs_binary bash script wrapping\n+//     the test-aio-a11y.mjs script\n+\n+async function main(args) {\n+  const lightserver = args[0];\n+  const distDir = args[1];\n+  const testAioA11y = args[2];\n+\n+  const port = await getPort();\n+\n+  const lightserverCmd = [\n+    lightserver,\n+    '--bind=localhost',\n+    '--historyindex=/index.html',\n+    '--no-reload',\n+    '-s',\n+    distDir,\n+    '-p',\n+    port,\n+    '--quiet'\n+  ];\n+  const lightserverProcess = sh.exec(lightserverCmd.join(' '), {async: true, silent: true});\n+\n+  const testAioA11yCmd = `${testAioA11y} http://localhost:${port}`;\n+  sh.exec(testAioA11yCmd);\n+    \n+  await killProcess(lightserverProcess);\n+}\n+\n+(async() => await main(process.argv.slice(2)))();\n+\n+function killProcess(childProcess) {\n+  return new Promise((resolve, reject) => {\n+    treeKill(childProcess.pid, error => {\n+      if (error) {\n+        reject(error);\n+      }\n+      resolve();\n+    });\n+  });\n+}\n\n---\n file path A: aio/scripts/test-aio-a11y.mjs | file path B: aio/scripts/test-aio-a11y.mjs\n\n@@ -3,7 +3,7 @@\n /**\n  * Usage:\n  * ```sh\n- * node scripts/test-aio-a11y.mjs <origin>\n+ * bazel run //aio/scripts:test-aio-a11y <origin>\n  * ```\n  *\n  * Runs accessibility audits on several (pre-defined) pages on the specified origin. It fails, if\n@@ -14,9 +14,8 @@\n  */\n \n // Imports\n-import {dirname} from 'path';\n+import path from 'path';\n import sh from 'shelljs';\n-import {fileURLToPath} from 'url';\n \n sh.set('-e');\n \n@@ -33,10 +32,10 @@ const MIN_SCORES_PER_PAGE = {\n   'tutorial': 97,\n };\n \n+const auditScriptPath = path.resolve(process.env.AUDIT_SCRIPT_PATH);\n+\n // Run\n-const __dirname = dirname(fileURLToPath(import.meta.url));\n-const auditWebAppCmd = `\"${process.execPath}\" \"${__dirname}/audit-web-app.mjs\"`;\n const origin = process.argv[2];\n for (const [page, minScore] of Object.entries(MIN_SCORES_PER_PAGE)) {\n-  sh.exec(`${auditWebAppCmd} ${origin}/${page} accessibility:${minScore}`);\n+  sh.exec(`${auditScriptPath} ${origin}/${page} accessibility:${minScore}`);\n }\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -5522,6 +5522,11 @@ dev-ip@^1.0.1:\n   resolved \"https://registry.yarnpkg.com/dev-ip/-/dev-ip-1.0.1.tgz#a76a3ed1855be7a012bb8ac16cb80f3c00dc28f0\"\n   integrity sha512-LmVkry/oDShEgSZPNgqCIp2/TlqtExeGmymru3uCELnfyjY11IzpAproLYs+1X88fXO6DBoYP3ul2Xo2yz2j6A==\n \n+devtools-protocol@0.0.901419:\n+  version \"0.0.901419\"\n+  resolved \"https://registry.yarnpkg.com/devtools-protocol/-/devtools-protocol-0.0.901419.tgz#79b5459c48fe7e1c5563c02bd72f8fec3e0cebcd\"\n+  integrity sha512-4INMPwNm9XRpBukhNbF7OB6fNTTCaI8pzy/fXg0xQzAy5h3zL1P8xT3QazgKqBrb/hAYwIBizqDBZ7GtJE74QQ==\n+\n devtools-protocol@0.0.981744:\n   version \"0.0.981744\"\n   resolved \"https://registry.yarnpkg.com/devtools-protocol/-/devtools-protocol-0.0.981744.tgz#9960da0370284577d46c28979a0b32651022bacf\"\n@@ -7961,6 +7966,14 @@ https-proxy-agent@5, https-proxy-agent@5.0.1, https-proxy-agent@^5.0.0, https-pr\n     agent-base \"6\"\n     debug \"4\"\n \n+https-proxy-agent@5.0.0:\n+  version \"5.0.0\"\n+  resolved \"https://registry.yarnpkg.com/https-proxy-agent/-/https-proxy-agent-5.0.0.tgz#e2a90542abb68a762e0a0850f6c9edadfd8506b2\"\n+  integrity sha512-EkYm5BcKUGiduxzSt3Eppko+PiNWNEpa4ySk9vTC6wDsQJW9rHSa+UhGNJoRYp7bz6Ht1eaRIa6QaJqO5rCFbA==\n+  dependencies:\n+    agent-base \"6\"\n+    debug \"4\"\n+\n https-proxy-agent@^2.2.1:\n   version \"2.2.4\"\n   resolved \"https://registry.yarnpkg.com/https-proxy-agent/-/https-proxy-agent-2.2.4.tgz#4ee7a737abd92678a293d9b34a1af4d0d08c787b\"\n@@ -9950,7 +9963,7 @@ mkdirp-classic@^0.5.2:\n   resolved \"https://registry.yarnpkg.com/mkdirp-classic/-/mkdirp-classic-0.5.3.tgz#fa10c9115cc6d8865be221ba47ee9bed78601113\"\n   integrity sha512-gKLcREMhtuZRwRAfqP3RFW+TK4JqApVBtOIftVgjuABpAtpxhPGaDcfvbhNvD0B8iD1oUr/txX35NjcaY6Ns/A==\n \n-\"mkdirp@>=0.5 0\", mkdirp@^0.5.3, mkdirp@^0.5.5:\n+\"mkdirp@>=0.5 0\", mkdirp@^0.5.1, mkdirp@^0.5.3, mkdirp@^0.5.5:\n   version \"0.5.6\"\n   resolved \"https://registry.yarnpkg.com/mkdirp/-/mkdirp-0.5.6.tgz#7def03d2432dcae4ba1d611445c48396062255f6\"\n   integrity sha512-FP+p8RB8OWpF3YZBCrP5gtADmtXApB5AMLn+vdyA+PyxCjrCs00mjyUozssO33cwDeT3wNGdLxJ5M//YqtHAJw==\n@@ -10077,6 +10090,11 @@ node-emoji@^1.11.0:\n   dependencies:\n     lodash \"^4.17.21\"\n \n+node-fetch@2.6.1:\n+  version \"2.6.1\"\n+  resolved \"https://registry.yarnpkg.com/node-fetch/-/node-fetch-2.6.1.tgz#045bd323631f76ed2e2b55573394416b639a0052\"\n+  integrity sha512-V4aYg89jEoVRxRb2fJdAg8FHvI7cEyYdVAh94HH0UIK8oJxUfkjlDQN9RbMx+bEjP7+ggMiFRprSti032Oipxw==\n+\n node-fetch@2.6.7, node-fetch@^2.6.1, node-fetch@^2.6.7:\n   version \"2.6.7\"\n   resolved \"https://registry.yarnpkg.com/node-fetch/-/node-fetch-2.6.7.tgz#24de9fba827e3b4ae44dc8b20256a379160052ad\"\n@@ -11280,6 +11298,11 @@ process-nextick-args@~2.0.0:\n   resolved \"https://registry.yarnpkg.com/process-nextick-args/-/process-nextick-args-2.0.1.tgz#7820d9b16120cc55ca9ae7792680ae7dba6d7fe2\"\n   integrity sha512-3ouUOpQhtgrbOa17J7+uxOTpITYWaGP7/AhoR3+A+/1e9skrzelGi/dXzEYyvbxubEF6Wn2ypscTKiKJFFn1ag==\n \n+progress@2.0.1:\n+  version \"2.0.1\"\n+  resolved \"https://registry.yarnpkg.com/progress/-/progress-2.0.1.tgz#c9242169342b1c29d275889c95734621b1952e31\"\n+  integrity sha512-OE+a6vzqazc+K6LxJrX5UPyKFvGnL5CYmq2jFGNIBWHpc4QyE49/YOumcrpQFJpfejmvRtbJzgO1zPmMCqlbBg==\n+\n progress@2.0.3, progress@^2.0.3:\n   version \"2.0.3\"\n   resolved \"https://registry.yarnpkg.com/progress/-/progress-2.0.3.tgz#7e8cf8d8f5b8f239c1bc68beb4eb78567d572ef8\"\n@@ -11443,6 +11466,24 @@ pupa@^2.0.1, pupa@^2.1.1:\n   dependencies:\n     escape-goat \"^2.0.0\"\n \n+puppeteer-core@10.2.0:\n+  version \"10.2.0\"\n+  resolved \"https://registry.yarnpkg.com/puppeteer-core/-/puppeteer-core-10.2.0.tgz#8d6606cf345fc0e421bc0612055579ea53234111\"\n+  integrity sha512-c1COxSnfynsE6Mtt+dW0t3TITjF9Ku4dnJbFMDDVhLQuMTYSpz4rkSP37qvzcSo3k02/Ac3GYWk0/ncp6DKZNA==\n+  dependencies:\n+    debug \"4.3.1\"\n+    devtools-protocol \"0.0.901419\"\n+    extract-zip \"2.0.1\"\n+    https-proxy-agent \"5.0.0\"\n+    node-fetch \"2.6.1\"\n+    pkg-dir \"4.2.0\"\n+    progress \"2.0.1\"\n+    proxy-from-env \"1.1.0\"\n+    rimraf \"3.0.2\"\n+    tar-fs \"2.0.0\"\n+    unbzip2-stream \"1.3.3\"\n+    ws \"7.4.6\"\n+\n puppeteer-core@^13.7.0:\n   version \"13.7.0\"\n   resolved \"https://registry.yarnpkg.com/puppeteer-core/-/puppeteer-core-13.7.0.tgz#3344bee3994163f49120a55ddcd144a40575ba5b\"\n@@ -13078,6 +13119,16 @@ tapable@^2.1.1, tapable@^2.2.0:\n   resolved \"https://registry.yarnpkg.com/tapable/-/tapable-2.2.1.tgz#1967a73ef4060a82f12ab96af86d52fdb76eeca0\"\n   integrity sha512-GNzQvQTOIP6RyTfE2Qxb8ZVlNmw0n88vp1szwWRimP02mnTsx3Wtn5qRdqY9w2XduFNUgvOwhNnQsjwCp+kqaQ==\n \n+tar-fs@2.0.0:\n+  version \"2.0.0\"\n+  resolved \"https://registry.yarnpkg.com/tar-fs/-/tar-fs-2.0.0.tgz#677700fc0c8b337a78bee3623fdc235f21d7afad\"\n+  integrity sha512-vaY0obB6Om/fso8a8vakQBzwholQ7v5+uy+tF3Ozvxv1KNezmVQAiWtcNmMHFSFPqL3dJA8ha6gdtFbfX9mcxA==\n+  dependencies:\n+    chownr \"^1.1.1\"\n+    mkdirp \"^0.5.1\"\n+    pump \"^3.0.0\"\n+    tar-stream \"^2.0.0\"\n+\n tar-fs@2.1.1:\n   version \"2.1.1\"\n   resolved \"https://registry.yarnpkg.com/tar-fs/-/tar-fs-2.1.1.tgz#489a15ab85f1f0befabb370b7de4f9eb5cbe8784\"\n@@ -13088,7 +13139,7 @@ tar-fs@2.1.1:\n     pump \"^3.0.0\"\n     tar-stream \"^2.1.4\"\n \n-tar-stream@^2.1.4, tar-stream@^2.2.0, tar-stream@~2.2.0:\n+tar-stream@^2.0.0, tar-stream@^2.1.4, tar-stream@^2.2.0, tar-stream@~2.2.0:\n   version \"2.2.0\"\n   resolved \"https://registry.yarnpkg.com/tar-stream/-/tar-stream-2.2.0.tgz#acad84c284136b060dc3faa64474aa9aebd77287\"\n   integrity sha512-ujeqbceABgwMZxEJnk2HDY2DlnUZ+9oEcb1KzTVfYHio0UE6dG71n60d8D2I4qNvleWrrXpmjpt7vZeF1LnMZQ==\n@@ -13582,6 +13633,14 @@ unbox-primitive@^1.0.2:\n     has-symbols \"^1.0.3\"\n     which-boxed-primitive \"^1.0.2\"\n \n+unbzip2-stream@1.3.3:\n+  version \"1.3.3\"\n+  resolved \"https://registry.yarnpkg.com/unbzip2-stream/-/unbzip2-stream-1.3.3.tgz#d156d205e670d8d8c393e1c02ebd506422873f6a\"\n+  integrity sha512-fUlAF7U9Ah1Q6EieQ4x4zLNejrRvDWUYmxXUpN3uziFYCHapjWFaCAnreY9bGgxzaMCFAPPpYNng57CypwJVhg==\n+  dependencies:\n+    buffer \"^5.2.1\"\n+    through \"^2.3.8\"\n+\n unbzip2-stream@1.4.3:\n   version \"1.4.3\"\n   resolved \"https://registry.yarnpkg.com/unbzip2-stream/-/unbzip2-stream-1.4.3.tgz#b0da04c4371311df771cdc215e87f2130991ace7\"\n@@ -14472,6 +14531,11 @@ write-file-atomic@^3.0.0:\n     signal-exit \"^3.0.2\"\n     typedarray-to-buffer \"^3.1.5\"\n \n+ws@7.4.6:\n+  version \"7.4.6\"\n+  resolved \"https://registry.yarnpkg.com/ws/-/ws-7.4.6.tgz#5654ca8ecdeee47c33a9a4bf6d28e2be2980377c\"\n+  integrity sha512-YmhHDO4MzaDLB+M9ym/mDA5z0naX8j7SIlT8f8z+I0VtzsRbekxEutHSme7NPS2qE8StCYQNUnfWdXta/Yu85A==\n+\n ws@8.5.0:\n   version \"8.5.0\"\n   resolved \"https://registry.yarnpkg.com/ws/-/ws-8.5.0.tgz#bfb4be96600757fe5382de12c670dab984a1ed4f\"\n\n\n###\n\n", "completion": "build(bazel): run aio a11y tests under bazel"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -342,8 +342,6 @@ jobs:\n       - run: yarn --cwd aio test-a11y-score-localhost\n         # Check the bundle sizes.\n       - run: yarn --cwd aio payload-size\n-        # Run unit tests for Firebase redirects\n-      - run: yarn --cwd aio redirects-test\n \n   deploy_aio:\n     executor: test-browser-executor\n\n---\n file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -11,7 +11,9 @@ load(\"@aspect_bazel_lib//lib:write_source_files.bzl\", generated_files_test = \"wr\n \n exports_files([\n     \"firebase.json\",\n+    \"ngsw-config.json\",\n     \"ngsw-config.template.json\",\n+    \"tsconfig.json\",\n ])\n \n # If set will use first party angular deps for aio targets instead of their npm equivalent\n@@ -55,6 +57,7 @@ npm_package_bin(\n     },\n     output_dir = True,\n     tool = \"@aio_npm//dgeni/bin:dgeni\",\n+    visibility = [\"//aio/tests/deployment:__subpackages__\"],\n )\n \n # Copy stackblitz live examples to expected assets location\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -43,10 +43,10 @@\n     \"docs-watch\": \"node tools/transforms/authors-package/watchr.js\",\n     \"docs-lint\": \"eslint --ignore-path=\\\"tools/transforms/.eslintignore\\\" tools/transforms\",\n     \"docs-test\": \"bazel test //aio/tools/transforms/...\",\n-    \"redirects-test\": \"node tests/deployment/unit/test\",\n-    \"firebase-utils-test\": \"node tools/firebase-test-utils/test\",\n+    \"redirects-test\": \"bazel test //aio/tests/deployment/unit:test\",\n+    \"firebase-utils-test\": \"bazel test //aio/tools/firebase-test-utils:test\",\n     \"tools-lint\": \"eslint --ext=.mjs scripts/deploy-to-firebase && eslint tools/firebase-test-utils\",\n-    \"tools-test\": \"bazel test //aio/tools/... && jasmine scripts/deploy-to-firebase/**/*.spec.mjs && yarn firebase-utils-test\",\n+    \"tools-test\": \"bazel test //aio/tools/... && jasmine scripts/deploy-to-firebase/**/*.spec.mjs\",\n     \"serve\": \"bazel run //aio:serve\",\n     \"serve-local\": \"yarn serve --config=aio_local_deps\",\n     \"serve-and-sync\": \"bazel run //aio:fast-serve\",\n\n---\n file path A: None | file path B: aio/tests/deployment/shared/BUILD.bazel\n\n@@ -0,0 +1,10 @@\n+package(default_visibility = [\"//aio/tests/deployment:__subpackages__\"])\n+\n+filegroup(\n+    name = \"shared\",\n+    srcs = [\n+        \"URLS_TO_REDIRECT.txt\",\n+        \"cjson.d.ts\",\n+        \"helpers.ts\",\n+    ],\n+)\n\n---\n file path A: aio/tests/deployment/shared/helpers.ts | file path B: aio/tests/deployment/shared/helpers.ts\n\n@@ -11,7 +11,7 @@ import { processNavigationUrls } from '../../../../packages/service-worker/confi\n import { FirebaseRedirector, FirebaseRedirectConfig } from '../../../tools/firebase-test-utils/FirebaseRedirector';\n \n \n-const AIO_DIR = resolvePath(__dirname, '../../..');\n+const AIO_DIR = resolvePath('aio');\n export const PATH_TO_LEGACY_URLS = resolvePath(__dirname, 'URLS_TO_REDIRECT.txt');\n \n export function getRedirector() {\n@@ -49,7 +49,7 @@ export function loadLegacyUrls() {\n }\n \n export function loadLocalSitemapUrls() {\n-  const pathToSiteMap = `${AIO_DIR}/src/generated/sitemap.xml`;\n+  const pathToSiteMap = `${AIO_DIR}/dgeni/generated/sitemap.xml`;\n   const xml = readFileSync(pathToSiteMap, 'utf8');\n   return extractSitemapUrls(xml);\n }\n\n---\n file path A: None | file path B: aio/tests/deployment/unit/BUILD.bazel\n\n@@ -0,0 +1,23 @@\n+load(\"//aio/tools:defaults.bzl\", \"nodejs_test\")\n+\n+nodejs_test(\n+    name = \"test\",\n+    data = [\n+        \"testFirebaseRedirection.spec.ts\",\n+        \"testServiceWorkerRoutes.spec.ts\",\n+        \"tsconfig.json\",\n+        \"//aio:dgeni\",\n+        \"//aio:firebase.json\",\n+        \"//aio:ngsw-config.json\",\n+        \"//aio:tsconfig.json\",\n+        \"//aio/tests/deployment/shared\",\n+        \"//packages/service-worker/config:sources\",\n+        \"@aio_npm//@types/jasmine\",\n+        \"@aio_npm//canonical-path\",\n+        \"@aio_npm//cjson\",\n+        \"@aio_npm//jasmine\",\n+        \"@aio_npm//ts-node\",\n+        \"@aio_npm//xregexp\",\n+    ],\n+    entry_point = \"test.js\",\n+)\n\n---\n file path A: None | file path B: aio/tools/firebase-test-utils/BUILD.bazel\n\n@@ -0,0 +1,14 @@\n+load(\"//aio/tools:defaults.bzl\", \"nodejs_test\")\n+\n+nodejs_test(\n+    name = \"test\",\n+    data = [\n+        \"tsconfig.json\",\n+        \"//aio:tsconfig.json\",\n+        \"@aio_npm//@types/jasmine\",\n+        \"@aio_npm//jasmine\",\n+        \"@aio_npm//ts-node\",\n+        \"@aio_npm//xregexp\",\n+    ] + glob([\"*.ts\"]),\n+    entry_point = \"test.js\",\n+)\n\n---\n file path A: packages/service-worker/config/BUILD.bazel | file path B: packages/service-worker/config/BUILD.bazel\n\n@@ -7,11 +7,16 @@ exports_files([\n     \"schema.json\",\n ])\n \n-ng_module(\n-    name = \"config\",\n+filegroup(\n+    name = \"sources\",\n     srcs = glob([\n         \"*.ts\",\n         \"src/**/*.ts\",\n     ]),\n+)\n+\n+ng_module(\n+    name = \"config\",\n+    srcs = [\":sources\"],\n     deps = [\"//packages/core\"],\n )\n\n\n###\n\n", "completion": "build(bazel): run aio firebase redirect tests under bazel"}
{"prompt": " file path A: aio/content/examples/examples.bzl | file path B: aio/content/examples/examples.bzl\n\n@@ -99,13 +99,12 @@ EXAMPLES = {\n     \"what-is-angular\": {\"stackblitz\": True, \"zip\": True},\n }\n \n-def docs_example(name, test = True, test_tags = []):\n+def docs_example(name, test = True):\n     \"\"\"Stamp targets for adding boilerplate to examples, creating live examples, and creating zips.\n \n     Args:\n         name: name of the example\n         test: whether to run e2e tests\n-        test_tags: tags to add to e2e tests\n     \"\"\"\n     if name not in EXAMPLES:\n         # buildifier: disable=print\n@@ -218,5 +217,5 @@ def docs_example(name, test = True, test_tags = []):\n             ],\n             # RBE complains about superseeding the max inputs limit (70,000) due to the\n             # size of the input tree.\n-            tags = test_tags + [\"no-remote-exec\"],\n+            tags = [\"no-remote-exec\"],\n         )\n\n---\n file path A: aio/content/examples/upgrade-module/BUILD.bazel | file path B: aio/content/examples/upgrade-module/BUILD.bazel\n\n@@ -4,5 +4,4 @@ package(default_visibility = [\"//visibility:public\"])\n \n docs_example(\n     name = \"upgrade-module\",\n-    test_tags = [\"exclusive\"],  # Cannot run concurrently as it uses a hardcoded port for lite-server\n )\n\n---\n file path A: aio/content/examples/upgrade-phonecat-1-typescript/BUILD.bazel | file path B: aio/content/examples/upgrade-phonecat-1-typescript/BUILD.bazel\n\n@@ -4,5 +4,4 @@ package(default_visibility = [\"//visibility:public\"])\n \n docs_example(\n     name = \"upgrade-phonecat-1-typescript\",\n-    test_tags = [\"exclusive\"],  # Cannot run concurrently as it uses a hardcoded port for lite-server\n )\n\n---\n file path A: aio/content/examples/upgrade-phonecat-1-typescript/e2e-spec.ts | file path B: aio/content/examples/upgrade-phonecat-1-typescript/e2e-spec.ts\n\n@@ -6,7 +6,8 @@ import { browser, element, by, ElementArrayFinder, ElementFinder } from 'protrac\n describe('PhoneCat Application', () => {\n \n   beforeAll(() => {\n-    browser.baseUrl = 'http://localhost:8080/app/';\n+    browser.baseUrl = `${browser.baseUrl}/app/`;\n+\n     // protractor.config.js is set to ng2 mode by default, so we must manually change it\n     browser.rootEl = 'body';\n   });\n\n---\n file path A: aio/content/examples/upgrade-phonecat-2-hybrid/BUILD.bazel | file path B: aio/content/examples/upgrade-phonecat-2-hybrid/BUILD.bazel\n\n@@ -4,5 +4,4 @@ package(default_visibility = [\"//visibility:public\"])\n \n docs_example(\n     name = \"upgrade-phonecat-2-hybrid\",\n-    test_tags = [\"exclusive\"],  # Cannot run concurrently as it uses a hardcoded port for lite-server\n )\n\n---\n file path A: aio/content/examples/upgrade-phonecat-3-final/BUILD.bazel | file path B: aio/content/examples/upgrade-phonecat-3-final/BUILD.bazel\n\n@@ -4,5 +4,4 @@ package(default_visibility = [\"//visibility:public\"])\n \n docs_example(\n     name = \"upgrade-phonecat-3-final\",\n-    test_tags = [\"exclusive\"],  # Cannot run concurrently as it uses a hardcoded port for lite-server\n )\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -130,6 +130,7 @@\n     \"find-free-port\": \"^2.0.0\",\n     \"firebase-tools\": \"^11.0.0\",\n     \"fs-extra\": \"^10.0.0\",\n+    \"get-port\": \"^6.1.2\",\n     \"globby\": \"^13.0.0\",\n     \"hast-util-has-property\": \"^1.0.4\",\n     \"hast-util-is-element\": \"^1.1.0\",\n\n---\n file path A: aio/tools/examples/BUILD.bazel | file path B: aio/tools/examples/BUILD.bazel\n\n@@ -68,6 +68,7 @@ js_library(\n         \"@aio_npm//cjson\",\n         \"@aio_npm//cross-spawn\",\n         \"@aio_npm//fs-extra\",\n+        \"@aio_npm//get-port\",\n         \"@aio_npm//globby\",\n         \"@aio_npm//shelljs\",\n         \"@aio_npm//tree-kill\",\n\n---\n file path A: aio/tools/examples/run-example-e2e.mjs | file path B: aio/tools/examples/run-example-e2e.mjs\n\n@@ -8,6 +8,7 @@ import shelljs from 'shelljs';\n import treeKill from 'tree-kill';\n import yargs from 'yargs';\n import {hideBin} from 'yargs/helpers'\n+import getPort from 'get-port';\n \n shelljs.set('-e');\n \n@@ -114,11 +115,13 @@ function isCliTest(examplePath) {\n   return fs.existsSync(path.join(examplePath, CLI_SPEC_FILENAME));\n }\n \n-function runE2eTestsSystemJS(exampleName, appDir) {\n+async function runE2eTestsSystemJS(exampleName, appDir) {\n   const config = loadExampleConfig(appDir);\n \n+  const runArgs = await overrideSystemJsExampleToUseRandomPort(config, appDir);\n+\n   const appBuildSpawnInfo = spawnExt(NODE, [VENDORED_YARN, config.build], {cwd: appDir});\n-  const appRunSpawnInfo = spawnExt(NODE, [VENDORED_YARN, config.run, '-s'], {cwd: appDir}, true);\n+  const appRunSpawnInfo = spawnExt(NODE, [VENDORED_YARN, ...runArgs, '-s'], {cwd: appDir}, true);\n \n   let run = runProtractorSystemJS(exampleName, appBuildSpawnInfo.promise, appDir, appRunSpawnInfo);\n \n@@ -129,6 +132,40 @@ function runE2eTestsSystemJS(exampleName, appDir) {\n   return run;\n }\n \n+// The SystemJS examples spawn an http server and protractor using a hardcoded\n+// port. In order to run these tests concurrently under bazel without contention,\n+// we need to dynamically acquire a port and overwrite configuration to use that port.\n+// This is further complicated by the SystemJS tests using two different http servers\n+// (http-server, lite-server) depending on the example (and sometimes both),\n+// and the two servers need to be configured differently.\n+async function overrideSystemJsExampleToUseRandomPort(exampleConfig, exampleDir) {\n+  const freePort = await getPort();\n+  let runArgs = [exampleConfig.run];\n+\n+  const isUsingHttpServerLibrary = exampleConfig.run === 'serve:upgrade';\n+  if (isUsingHttpServerLibrary) {\n+    // Override the port in http-server by passing as an argument\n+    runArgs = [...runArgs, \"-p\", freePort];\n+  }\n+\n+  // Override the port in any lite-server config files\n+  const liteServerConfigs = globbySync(['bs-config*.json'], {cwd: exampleDir});\n+  liteServerConfigs.forEach(configFile => {\n+    const config = JSON.parse(fs.readFileSync(path.join(exampleDir, configFile), 'utf8'));\n+    if (config.port) {\n+      config.port = freePort;\n+      fs.writeFileSync(path.join(exampleDir, configFile), JSON.stringify(config));\n+    }\n+  });\n+\n+  // Override hardcoded port in protractor.config.js\n+  let protractorConfig = fs.readFileSync(path.join(exampleDir, 'protractor.config.js'), 'utf8');\n+  protractorConfig = protractorConfig.replaceAll('http://localhost:8080', `http://localhost:${freePort}`);\n+  fs.writeFileSync(path.join(exampleDir, 'protractor.config.js'), protractorConfig);\n+\n+  return runArgs;\n+}\n+\n function runProtractorSystemJS(exampleName, prepPromise, appDir, appRunSpawnInfo) {\n   const specFilename = path.resolve(`${appDir}/${SJS_SPEC_FILENAME}`);\n   return prepPromise\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -7377,6 +7377,11 @@ get-package-type@^0.1.0:\n   resolved \"https://registry.yarnpkg.com/get-package-type/-/get-package-type-0.1.0.tgz#8de2d803cff44df3bc6c456e6668b36c3926e11a\"\n   integrity sha512-pjzuKtY64GYfWizNAJ0fr9VqttZkNiK2iS430LtIHzjBEr6bX8Am2zm4sW4Ro5wjWW5cAlRL1qAMTcXbjNAO2Q==\n \n+get-port@^6.1.2:\n+  version \"6.1.2\"\n+  resolved \"https://registry.yarnpkg.com/get-port/-/get-port-6.1.2.tgz#c1228abb67ba0e17fb346da33b15187833b9c08a\"\n+  integrity sha512-BrGGraKm2uPqurfGVj/z97/zv8dPleC6x9JBNRTrDNtCkkRF4rPwrQXFgL7+I+q8QSdU4ntLQX2D7KIxSy8nGw==\n+\n get-stream@^4.1.0:\n   version \"4.1.0\"\n   resolved \"https://registry.yarnpkg.com/get-stream/-/get-stream-4.1.0.tgz#c1b255575f3dc21d59bfc79cd3d2b46b1c3a54b5\"\n\n\n###\n\n", "completion": "build(bazel): run aio systemjs example e2es concurrently"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -1,5 +1,5 @@\n load(\"@aio_npm//@angular-devkit/architect-cli:index.bzl\", \"architect\", \"architect_test\")\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"npm_package_bin\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"copy_to_bin\", \"npm_package_bin\")\n load(\"//aio/tools:defaults.bzl\", \"nodejs_binary\")\n load(\"@aspect_bazel_lib//lib:copy_to_directory.bzl\", \"copy_to_directory\")\n load(\":local_packages_util.bzl\", \"link_local_packages\", \"substitute_local_packages\")\n@@ -91,9 +91,6 @@ APPLICATION_FILES = [\n     \"tsconfig.worker.json\",\n     \"//aio/src/assets\",\n     \"//aio/src/assets/js\",\n-    \":dgeni\",\n-    \":stackblitz\",\n-    \":example-zips\",\n ] + glob(\n     [\"src/**/*\"],\n     exclude = [\n@@ -105,8 +102,11 @@ APPLICATION_FILES = [\n     ],\n )\n \n-# External dependencies from aio/package.json required to build the docs app.\n+# Dependencies required to build the docs app.\n APPLICATION_DEPS = [\n+    \":dgeni\",\n+    \":stackblitz\",\n+    \":example-zips\",\n     \"@aio_npm//@angular-devkit/build-angular\",\n     \"@aio_npm//@angular/animations\",\n     \"@aio_npm//@angular/cdk\",\n@@ -138,7 +138,7 @@ TEST_FILES = APPLICATION_FILES + [\n     [\"src/**/*.spec.ts\"],\n )\n \n-# External dependencies from aio/package.json required to test the docs app\n+# Dependencies required to test the docs app\n TEST_DEPS = APPLICATION_DEPS + [\n     \"@aio_npm//@angular/dev-infra-private/bazel/browsers/chromium\",\n     \"@aio_npm//@types/jasmine\",\n@@ -158,7 +158,7 @@ TEST_DEPS = APPLICATION_DEPS + [\n # and run e2e tests against it\n E2E_FILES = APPLICATION_FILES + glob([\"tests/e2e/**\"])\n \n-# External dependencies from aio/package.json required by the e2e tests\n+# Dependencies required to run the e2e tests\n E2E_DEPS = APPLICATION_DEPS + [\n     \"@aio_npm//@angular/dev-infra-private/bazel/browsers/chromium\",\n     \"@aio_npm//@types/jasmine\",\n@@ -172,15 +172,20 @@ E2E_DEPS = APPLICATION_DEPS + [\n # first-party equivalent pacakge in angular.\n link_local_packages(deps = APPLICATION_DEPS)\n \n+copy_to_bin(\n+    name = \"application_files_bin\",\n+    srcs = APPLICATION_FILES,\n+)\n+\n architect(\n     name = \"build\",\n     args = [\n         \"site:build:stable\",\n-        \"--output-path=../$(@D)\",\n+        \"--output-path=build\",\n     ],\n-    chdir = package_name(),\n+    chdir = \"$(RULEDIR)\",\n     configuration_env_vars = [\"NG_BUILD_CACHE\"],\n-    data = APPLICATION_FILES + select({\n+    data = [\":application_files_bin\"] + select({\n         \":aio_local_deps\": substitute_local_packages(APPLICATION_DEPS),\n         \"//conditions:default\": APPLICATION_DEPS,\n     }),\n\n---\n file path A: aio/local_packages_util.bzl | file path B: aio/local_packages_util.bzl\n\n@@ -8,15 +8,16 @@ def link_local_packages(deps):\n         deps: list of npm dependency labels\n     \"\"\"\n     for dep in deps:\n-        label = Label(dep)\n-        if label.package in ALL_PACKAGES:\n-            npm_link(\n-                name = _npm_link_name(dep),\n-                target = to_package_label(label.package),\n-                package_name = label.package,\n-                package_path = native.package_name(),\n-                tags = [\"manual\"],\n-            )\n+        if dep.startswith(\"@aio_npm//\"):\n+            label = Label(dep)\n+            if label.package in ALL_PACKAGES:\n+                npm_link(\n+                    name = _npm_link_name(dep),\n+                    target = to_package_label(label.package),\n+                    package_name = label.package,\n+                    package_path = native.package_name(),\n+                    tags = [\"manual\"],\n+                )\n \n def substitute_local_packages(deps):\n     \"\"\"Substitute npm dependencies for their local npm_link equivalent.\n@@ -32,11 +33,12 @@ def substitute_local_packages(deps):\n     \"\"\"\n     substituted = []\n     for dep in deps:\n-        label = Label(dep)\n-        if label.package in ALL_PACKAGES:\n-            substituted.append(_npm_link_name(dep))\n-        else:\n-            substituted.append(dep)\n+        if dep.startswith(\"@aio_npm//\"):\n+            label = Label(dep)\n+            if label.package in ALL_PACKAGES:\n+                substituted.append(_npm_link_name(dep))\n+            else:\n+                substituted.append(dep)\n     return substituted\n \n def _npm_link_name(dep):\n\n\n###\n\n", "completion": "build(bazel): Fix a bug where the aio build artifact didn't include assets."}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -191,6 +191,32 @@ architect(\n     tags = [\"no-remote-exec\"],\n )\n \n+npm_package_bin(\n+    name = \"404-page\",\n+    outs = [\"404.html\"],\n+    args = [\n+        \"$(execpath src/404-body.html)\",\n+        \"$(execpath :build)\",\n+        \"$@\",\n+    ],\n+    data = [\n+        \"src/404-body.html\",\n+        \":build\",\n+    ],\n+    tool = \"//aio/scripts:build-404-page\",\n+)\n+\n+copy_to_directory(\n+    name = \"build-with-404\",\n+    srcs = [\n+        \":404-page\",\n+        \":build\",\n+    ],\n+    replace_prefixes = {\n+        \"build\": \"\",\n+    },\n+)\n+\n architect_test(\n     name = \"test\",\n     args = [\n\n---\n file path A: aio/scripts/BUILD.bazel | file path B: aio/scripts/BUILD.bazel\n\n@@ -24,3 +24,8 @@ js_library(\n         \"@aio_npm//@angular-devkit/architect-cli\",\n     ],\n )\n+\n+nodejs_binary(\n+    name = \"build-404-page\",\n+    entry_point = \"build-404-page.js\",\n+)\n\n---\n file path A: aio/scripts/build-404-page.js | file path B: aio/scripts/build-404-page.js\n\n@@ -5,20 +5,19 @@ const {readFileSync, writeFileSync} = require('fs');\n const {join, resolve} = require('path');\n \n // Constants\n-const SRC_DIR = resolve(__dirname, '../src');\n-const DIST_DIR = resolve(__dirname, '../dist');\n+const SOURCE_404_BODY_PATH = resolve(process.argv[2]);\n+const BUILD_OUTPUT_DIR = resolve(process.argv[3]);\n+const DEST_404_PAGE_PATH = resolve(process.argv[4]);\n \n // Run\n _main();\n \n // Functions - Definitions\n function _main() {\n-  const srcIndexPath = join(DIST_DIR, 'index.html');\n-  const src404BodyPath = join(SRC_DIR, '404-body.html');\n-  const dst404PagePath = join(DIST_DIR, '404.html');\n+  const srcIndexPath = join(BUILD_OUTPUT_DIR, 'index.html');\n \n   const srcIndexContent = readFileSync(srcIndexPath, 'utf8');\n-  const src404BodyContent = readFileSync(src404BodyPath, 'utf8').trim();\n+  const src404BodyContent = readFileSync(SOURCE_404_BODY_PATH, 'utf8').trim();\n   const dst404PageContent = srcIndexContent\n       .replace(/(<body>)[\\s\\S]+(<\\/body>)/, `$1\\n  ${src404BodyContent}\\n$2`);\n \n@@ -28,5 +27,5 @@ function _main() {\n         'The content of \\'index.html\\' does not match the expected pattern.');\n   }\n \n-  writeFileSync(dst404PagePath, dst404PageContent);\n+  writeFileSync(DEST_404_PAGE_PATH, dst404PageContent);\n }\n\n\n###\n\n", "completion": "build(bazel): build aio 404 page under bazel"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -25,8 +25,11 @@ http_archive(\n \n http_archive(\n     name = \"build_bazel_rules_nodejs\",\n-    sha256 = \"c78216f5be5d451a42275b0b7dc809fb9347e2b04a68f68bad620a2b01f5c774\",\n-    urls = [\"https://github.com/bazelbuild/rules_nodejs/releases/download/5.5.2/rules_nodejs-5.5.2.tar.gz\"],\n+    patches = [\n+        \"//:tools/bazel-repo-patches/rules_nodejs__pr_3538.patch\",\n+    ],\n+    sha256 = \"f10a3a12894fc3c9bf578ee5a5691769f6805c4be84359681a785a0c12e8d2b6\",\n+    urls = [\"https://github.com/bazelbuild/rules_nodejs/releases/download/5.5.3/rules_nodejs-5.5.3.tar.gz\"],\n )\n \n load(\"@build_bazel_rules_nodejs//:repositories.bzl\", \"build_bazel_rules_nodejs_dependencies\")\n@@ -138,6 +141,9 @@ yarn_install(\n \n yarn_install(\n     name = \"aio_example_deps\",\n+    # Rename the default js_library target from \"node_modules\" as this obscures the\n+    # the source directory stamped as a filegroup in the manual BUILD contents below.\n+    all_node_modules_target_name = \"node_modules_all\",\n     data = [\n         YARN_LABEL,\n         \"//:.yarnrc\",\n@@ -148,8 +154,8 @@ yarn_install(\n     exports_directories_only = False,\n     manual_build_file_contents = \"\"\"\\\n filegroup(\n-    name = \"node_modules_with_bins\",\n-    srcs = [\"node_modules\", \"node_modules/.bin\"],\n+    name = \"node_modules_files\",\n+    srcs = [\"node_modules\"],\n )\n \"\"\",\n     package_json = \"//aio/tools/examples/shared:package.json\",\n\n---\n file path A: aio/content/examples/examples.bzl | file path B: aio/content/examples/examples.bzl\n\n@@ -194,7 +194,7 @@ def docs_example(name, test = True, test_tags = []):\n                 \"@aio_npm//@angular/dev-infra-private/bazel/browsers/chromium\",\n                 \"//aio/tools/examples:run-example-e2e\",\n                 # We install the whole node modules for runtime deps of e2e tests\n-                \"@{workspace}//:node_modules_with_bins\".format(workspace = EXAMPLE_DEPS_WORKSPACE_NAME),\n+                \"@{workspace}//:node_modules_files\".format(workspace = EXAMPLE_DEPS_WORKSPACE_NAME),\n             ] + select({\n                 \"//aio:aio_local_deps\": LOCAL_PACKAGE_DEPS,\n                 \"//conditions:default\": [],\n\n---\n file path A: None | file path B: tools/bazel-repo-patches/rules_nodejs__pr_3538.patch\n\n@@ -0,0 +1,44 @@\n+diff --git internal/npm_install/index.js internal/npm_install/index.js\n+index 4bd9fda7e..706e95713 100644\n+--- internal/npm_install/index.js\n++++ internal/npm_install/index.js\n+@@ -23,6 +23,7 @@ let config = {\n+     strict_visibility: true,\n+     workspace_rerooted_path: '',\n+     workspace: '',\n++    all_node_modules_target_name: 'node_modules',\n+ };\n+ function generateBuildFileHeader(visibility = PUBLIC_VISIBILITY) {\n+     return `# Generated file from ${config.rule_type} rule.\n+@@ -208,7 +209,7 @@ ${exportsStarlark}])\n+ # there are many files in target.\n+ # See https://github.com/bazelbuild/bazel/issues/5153.\n+ js_library(\n+-    name = \"node_modules\",\n++    name = \"${config.all_node_modules_target_name}\",\n+     package_name = \"${LEGACY_NODE_MODULES_PACKAGE_NAME}\",\n+     package_path = \"${config.package_path}\",${pkgFilesStarlark}${depsStarlark}\n+ )\n+diff --git internal/npm_install/npm_install.bzl internal/npm_install/npm_install.bzl\n+index 5f268165c..5a1060e0a 100644\n+--- internal/npm_install/npm_install.bzl\n++++ internal/npm_install/npm_install.bzl\n+@@ -359,6 +359,10 @@ Using managed_directories will mean that\n+         default = 3600,\n+         doc = \"\"\"Maximum duration of the package manager execution in seconds.\"\"\",\n+     ),\n++    \"all_node_modules_target_name\": attr.string(\n++        default = \"node_modules\",\n++        doc = \"\"\"The target name of the node_modules directory in one catch-all js_library target.\"\"\",\n++    ),\n+     \"generate_build_files_concurrency_limit\": attr.int(\n+         default = 64,\n+         doc = \"\"\"Limit the maximum concurrency of npm package processing when generating\n+@@ -486,6 +490,7 @@ def _create_build_files(repository_ctx, rule_type, node, lock_file, generate_loc\n+             workspace = repository_ctx.attr.name,\n+             workspace_rerooted_package_json_dir = paths.normalize(paths.join(_WORKSPACE_REROOTED_PATH, package_json_dir)),\n+             workspace_rerooted_path = _WORKSPACE_REROOTED_PATH,\n++            all_node_modules_target_name = repository_ctx.attr.all_node_modules_target_name,\n+         ),\n+     )\n+     repository_ctx.file(\"generate_config.json\", generate_config_json)\n\\ No newline at end of file\n\n\n###\n\n", "completion": "build(bazel): clean up manual build contents for aio example deps"}
{"prompt": " file path A: aio/content/examples/view-encapsulation/e2e/src/app.e2e-spec.ts | file path B: aio/content/examples/view-encapsulation/e2e/src/app.e2e-spec.ts\n\n@@ -92,5 +92,9 @@ describe('View Encapsulation App', () => {\n async function findShadowDomElement(shadowHostSelector: string, shadowElementSelector: string): Promise<WebElement> {\n   const shadowHost = browser.findElement(by.css(shadowHostSelector));\n   const shadowRoot: any = await browser.executeScript('return arguments[0].shadowRoot', shadowHost);\n-  return shadowRoot.findElement(by.css(shadowElementSelector));\n+  // TODO: Using this solution to find the shadow element after Chrome 97: https://stackoverflow.com/a/70611425.\n+  // Is there a better way to do this?\n+  const rootKey = Object.keys(shadowRoot)[0];\n+  const rootId = shadowRoot[rootKey];\n+  return new WebElement(browser, rootId).findElement(by.css(shadowElementSelector));\n }\n\n\n###\n\n", "completion": "build(bazel): fix a failing example e2e test that failed to find the"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -322,7 +322,9 @@ jobs:\n           webhook_url_env_var: SLACK_DEV_INFRA_CI_FAILURES_WEBHOOK_URL\n \n   test_aio:\n-    executor: test-browser-executor\n+    executor:\n+      name: test-browser-executor\n+      resource_class: 2xlarge+\n     steps:\n       - custom_attach_workspace\n       - init_environment\n@@ -353,7 +355,9 @@ jobs:\n       - run: yarn --cwd aio deploy-production\n \n   test_aio_local:\n-    executor: test-browser-executor\n+    executor:\n+      name: test-browser-executor\n+      resource_class: 2xlarge+\n     steps:\n       - custom_attach_workspace\n       - init_environment\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -45,7 +45,7 @@\n     \"docs-test\": \"bazel test //aio/tools/transforms/...\",\n     \"redirects-test\": \"node tests/deployment/unit/test\",\n     \"firebase-utils-test\": \"node tools/firebase-test-utils/test\",\n-    \"tools-lint\": \"eslint --ext=.mjs scripts/deploy-to-firebase && eslint tools/firebase-test-utils && eslint tools/ng-packages-installer\",\n+    \"tools-lint\": \"eslint --ext=.mjs scripts/deploy-to-firebase && eslint tools/firebase-test-utils\",\n     \"tools-test\": \"bazel test //aio/tools/... && jasmine scripts/deploy-to-firebase/**/*.spec.mjs && yarn firebase-utils-test\",\n     \"serve\": \"bazel run //aio:serve\",\n     \"serve-local\": \"yarn serve --config=aio_local_deps\",\n\n---\n file path A: aio/tools/examples/constants.js | file path B: aio/tools/examples/constants.js\n\n@@ -9,4 +9,4 @@ exports.SHARED_PATH = path.resolve(this.PROJECT_ROOT, 'aio', 'tools', 'examples'\n \n exports.EXAMPLE_CONFIG_FILENAME = 'example-config.json';\n exports.STACKBLITZ_CONFIG_FILENAME = 'stackblitz.json';\n-exports.BAZEL_EXAMPLE_BOILERPLATE_OUTPUT_PATH = process.env.BAZEL_EXAMPLE_BOILERPLATE_OUTPUT_PATH || 'bazel-test-dist';\n+exports.BAZEL_EXAMPLE_BOILERPLATE_OUTPUT_PATH = process.env.BAZEL_EXAMPLE_BOILERPLATE_OUTPUT_PATH || process.env.TEST_TMPDIR;\n\n---\n file path A: aio/tools/transforms/cli-docs-package/index.js | file path B: aio/tools/transforms/cli-docs-package/index.js\n\n@@ -1,4 +1,4 @@\n-const {runfiles} = require(\"@bazel/runfiles\");\n+const {runfiles} = require('@bazel/runfiles');\n const {resolve} = require('canonical-path');\n const { existsSync } = require('fs');\n const semver = require('semver');\n@@ -15,7 +15,7 @@ const CLI_SOURCE_HELP_PATH = resolve(CLI_SOURCE_PATH, 'help');\n // target or a test target.\n function resolveCliSourcePath() {\n   // Case: build, find in execroot\n-  const path = resolve('external', 'angular_cli_src')\n+  const path = resolve('external', 'angular_cli_src');\n   if (existsSync(path)) {\n     return path;\n   }\n\n---\n file path A: aio/tools/transforms/config.js | file path B: aio/tools/transforms/config.js\n\n@@ -1,14 +1,13 @@\n const { resolve } = require('path');\n const { readdirSync } = require('fs');\n \n-// If the output path isn't set, we are in a test so output to some\n-// directory that gets output to the sandbox and will be thrown away\n-// after the tests run.\n-const BAZEL_OUTPUT_PATH = process.env.BAZEL_DGENI_OUTPUT_PATH || \"bazel-test-dist\";\n+// If the output path isn't set, we are in a test so output a temporary\n+// directory (TEST_TMPDIR) that bazel provides for tests.\n+const BAZEL_OUTPUT_PATH = process.env.BAZEL_DGENI_OUTPUT_PATH || process.env.TEST_TMPDIR;\n \n // During a bazel build this script executes in the execroot, so assume\n // the root is the current directory unless overridden.\n-const PROJECT_ROOT = resolve(process.env.PROJECT_ROOT || \".\");\n+const PROJECT_ROOT = resolve(process.env.PROJECT_ROOT || '.');\n \n const AIO_PATH = resolve(PROJECT_ROOT, 'aio');\n const TEMPLATES_PATH = resolve(AIO_PATH, 'tools/transforms/templates');\n\n\n###\n\n", "completion": "build(bazel): fix some aio linting errors"}
{"prompt": " file path A: .bazelrc | file path B: .bazelrc\n\n@@ -116,6 +116,10 @@ build:remote --project_id=internal-200822\n build:remote --remote_cache=remotebuildexecution.googleapis.com\n build:remote --remote_executor=remotebuildexecution.googleapis.com\n \n+# Ensure that tags like \"no-remote-exec\" get propagated to actions created by rules.\n+# https://bazel.build/reference/command-line-reference#flag--experimental_allow_tags_propagation\n+build:remote --experimental_allow_tags_propagation\n+\n ##################################\n # Saucelabs tests settings       #\n # Turn on these settings with    #\n\n---\n file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -252,6 +252,7 @@ jobs:\n       - init_environment\n \n       - run: yarn -s tslint\n+      - run: yarn -s --cwd aio lint\n       - run: yarn -s ng-dev format changed $CI_GIT_BASE_REVISION --check\n       - run: yarn -s ts-circular-deps:check\n       - run: yarn -s ng-dev pullapprove verify\n@@ -325,14 +326,14 @@ jobs:\n     steps:\n       - custom_attach_workspace\n       - init_environment\n-        # Build aio\n-      - run: yarn --cwd aio build --progress=false\n-        # Lint the code\n-      - run: yarn --cwd aio lint\n-        # Run unit tests\n-      - run: yarn --cwd aio test --progress=false --watch=false\n-        # Run e2e tests\n-      - run: yarn --cwd aio e2e --configuration=ci\n+\n+        # Run all aio tests\n+      - run:\n+          command: yarn --cwd aio test:ci\n+          no_output_timeout: 20m\n+\n+        # TODO: run the following tests under bazel\n+\n         # Run PWA-score tests\n       - run: yarn --cwd aio test-pwa-score-localhost $CI_AIO_MIN_PWA_SCORE\n         # Run accessibility tests\n@@ -356,44 +357,18 @@ jobs:\n     steps:\n       - custom_attach_workspace\n       - init_environment\n-        # Build aio (with local Angular packages)\n-      - run: yarn --cwd aio build-local-ci\n-        # Run unit tests\n-      - run: yarn --cwd aio test --progress=false --watch=false\n-        # Run e2e tests\n-      - run: yarn --cwd aio e2e --configuration=ci\n+        # Run all aio tests (with local Angular packages)\n+      - run:\n+          command: yarn --cwd aio test-local:ci\n+          no_output_timeout: 20m\n+\n+        # TODO: run the following tests under bazel\n+\n         # Run PWA-score tests\n       - run: yarn --cwd aio test-pwa-score-localhost $CI_AIO_MIN_PWA_SCORE\n         # Check the bundle sizes.\n       - run: yarn --cwd aio payload-size aio-local\n \n-  test_aio_tools:\n-    executor: default-executor\n-    steps:\n-      - custom_attach_workspace\n-      - init_environment\n-        # Install\n-      - run: yarn --cwd aio install --frozen-lockfile --non-interactive --cache-folder ~/.cache/yarn\n-      - run: yarn --cwd aio extract-cli-command-docs\n-        # Run tools tests\n-      - run: yarn --cwd aio tools-test\n-      - run: ./aio/aio-builds-setup/scripts/test.sh\n-\n-  test_docs_examples:\n-    executor:\n-      name: test-browser-executor\n-      resource_class: xlarge\n-    parallelism: 5\n-    steps:\n-      - custom_attach_workspace\n-      - init_environment\n-        # Install aio\n-      - run: yarn --cwd aio install --frozen-lockfile --non-interactive --cache-folder ~/.cache/yarn\n-        # Run examples tests. The \"CIRCLE_NODE_INDEX\" will be set if \"parallelism\" is enabled.\n-        # Since the parallelism is set to \"5\", there will be five parallel CircleCI containers.\n-        # with either \"0\", \"1\", etc as node index. This can be passed to the \"--shard\" argument.\n-      - run: yarn --cwd aio example-e2e --setup --local --cliSpecsConcurrency=5 --shard=${CIRCLE_NODE_INDEX}/${CIRCLE_NODE_TOTAL}\n-\n   # This job should only be run on PR builds, where `CI_PULL_REQUEST` is not `false`.\n   aio_preview:\n     executor: default-executor\n@@ -770,13 +745,7 @@ workflows:\n             - test_aio\n       - test_aio_local:\n           requires:\n-            - build-npm-packages\n-      - test_aio_tools:\n-          requires:\n-            - build-npm-packages\n-      - test_docs_examples:\n-          requires:\n-            - build-npm-packages\n+            - setup\n       - aio_preview:\n           # Only run on PR builds. (There can be no previews for non-PR builds.)\n           <<: *only_on_pull_requests\n@@ -795,7 +764,6 @@ workflows:\n             - test\n             # Only publish if `aio`/`docs` tests using the locally built Angular packages pass\n             - test_aio_local\n-            - test_docs_examples\n             # Get the artifacts to publish from the build-packages-dist job\n             # since the publishing script expects the legacy outputs layout.\n             - build-npm-packages\n\n---\n file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -185,6 +185,10 @@ architect(\n         \"//conditions:default\": APPLICATION_DEPS,\n     }),\n     output_dir = True,\n+    # AIO build makes a network call to download fonts, which is prohibited on remote executors.\n+    # Further, when building with local packages (--config=aio_local_deps), RBE complains about\n+    # the input tree being too large (> 70,000 files).\n+    tags = [\"no-remote-exec\"],\n )\n \n architect_test(\n@@ -209,6 +213,7 @@ architect_test(\n \n architect_test(\n     name = \"e2e\",\n+    size = \"large\",\n     args = [\n         \"site:e2e\",\n         \"--no-webdriver-update\",\n\n---\n file path A: aio/content/examples/examples.bzl | file path B: aio/content/examples/examples.bzl\n\n@@ -216,5 +216,7 @@ def docs_example(name, test = True, test_tags = []):\n             toolchains = [\n                 \"@aio_npm//@angular/dev-infra-private/bazel/browsers/chromium:toolchain_alias\",\n             ],\n-            tags = test_tags,\n+            # RBE complains about superseeding the max inputs limit (70,000) due to the\n+            # size of the input tree.\n+            tags = test_tags + [\"no-remote-exec\"],\n         )\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -7,33 +7,23 @@\n   \"license\": \"MIT\",\n   \"scripts\": {\n     \"postinstall\": \"node tools/cli-patches/patch.js\",\n-    \"aio-use-local\": \"node tools/ng-packages-installer overwrite . --debug --force --build-packages\",\n-    \"aio-use-npm\": \"node tools/ng-packages-installer restore .\",\n-    \"aio-check-local\": \"node tools/ng-packages-installer check .\",\n-    \"ng\": \"yarn check-env && ng\",\n     \"start\": \"yarn check-env && ng serve\",\n     \"prebuild\": \"yarn setup\",\n-    \"build\": \"yarn ~~build\",\n+    \"build\": \"bazel build //aio:build\",\n     \"build:bazel\": \"bazelisk build //aio:build\",\n     \"prebuild-local\": \"yarn setup-local\",\n-    \"build-local\": \"yarn ~~build\",\n+    \"build-local\": \"yarn build --config=aio_local_deps\",\n     \"prebuild-local-ci\": \"yarn setup-local-ci\",\n     \"build-local-ci\": \"yarn ~~build --progress=false\",\n     \"extract-cli-command-docs\": \"node tools/transforms/cli-docs-package/extract-cli-commands.js 6ccbc6b4c\",\n     \"lint\": \"yarn check-env && yarn docs-lint && ng lint && yarn example-lint && yarn tools-lint && yarn security-lint\",\n-    \"test\": \"yarn check-env && ng test\",\n-    \"test:bazel\": \"bazelisk test //aio:test\",\n-    \"pree2e\": \"yarn check-env && yarn update-webdriver\",\n-    \"e2e\": \"ng e2e --no-webdriver-update\",\n-    \"presetup\": \"yarn --cwd .. install && yarn install --frozen-lockfile && yarn ~~check-env && yarn ~~clean-generated && yarn boilerplate:remove\",\n-    \"setup\": \"yarn example-use-npm && yarn aio-use-npm\",\n-    \"postsetup\": \"yarn boilerplate:add && yarn extract-cli-command-docs && yarn docs\",\n-    \"presetup-local\": \"yarn presetup\",\n-    \"setup-local\": \"yarn aio-use-local && yarn example-use-local\",\n-    \"postsetup-local\": \"yarn postsetup\",\n-    \"presetup-local-ci\": \"yarn presetup-local\",\n-    \"setup-local-ci\": \"yarn aio-use-local --no-build-packages && yarn example-use-local\",\n-    \"postsetup-local-ci\": \"yarn postsetup-local\",\n+    \"test\": \"bazel test //aio:test\",\n+    \"test-local\": \"yarn test --config=aio_local_deps\",\n+    \"test:ci\": \"bazel test //aio/...\",\n+    \"test-local:ci\": \"yarn test:ci --config=aio_local_deps\",\n+    \"e2e\": \"bazel test //aio:e2e\",\n+    \"e2e-local\": \"yarn e2e --config=aio_local_deps\",\n+    \"setup\": \"yarn --cwd .. install && yarn install --frozen-lockfile && yarn ~~check-env\",\n     \"set-opensearch-url\": \"node --eval \\\"const sh = require('shelljs'); sh.set('-e'); sh.sed('-i', /PLACEHOLDER_URL/g, process.argv[1], 'dist/assets/opensearch.xml');\\\"\",\n     \"presmoke-tests\": \"yarn update-webdriver\",\n     \"smoke-tests\": \"protractor tests/deployment/e2e/protractor.conf.js --suite smoke --baseUrl\",\n@@ -41,41 +31,35 @@\n     \"test-a11y-score-localhost\": \"run-p --race \\\"~~light-server -s dist -p 4200 --quiet\\\" \\\"test-a11y-score http://localhost:4200\\\" --\",\n     \"test-pwa-score\": \"run-s \\\"~~audit-web-app {1} all:0,pwa:{2} {3}\\\" --\",\n     \"test-pwa-score-localhost\": \"run-p --race \\\"~~light-server -s dist -p 4200 --quiet\\\" \\\"test-pwa-score http://localhost:4200 {1} {2}\\\" --\",\n-    \"example-e2e\": \"yarn example-check-local && node ./tools/examples/run-example-e2e.mjs\",\n+    \"example-e2e\": \"bazel test //aio/content/examples/...\",\n+    \"example-e2e-local\": \"yarn example-e2e --config=aio_local_deps\",\n     \"example-lint\": \"eslint content/examples\",\n-    \"example-use-local\": \"node tools/ng-packages-installer overwrite ./tools/examples/shared --debug --force\",\n-    \"example-use-npm\": \"node tools/ng-packages-installer restore ./tools/examples/shared\",\n-    \"example-check-local\": \"node tools/ng-packages-installer check ./tools/examples/shared\",\n     \"deploy-production\": \"node scripts/deploy-to-firebase/index.mjs\",\n     \"check-env\": \"yarn ~~check-env\",\n-    \"postcheck-env\": \"yarn aio-check-local\",\n     \"payload-size\": \"scripts/payload.sh\",\n-    \"predocs\": \"node scripts/contributors/validate-data && yarn generate-stackblitz && yarn generate-zips\",\n+    \"predocs\": \"node scripts/contributors/validate-data && bazel build -- //aio:stackblitz //aio:example-zips\",\n     \"docs\": \"yarn docs-only\",\n-    \"docs-only\": \"dgeni ./tools/transforms/angular.io-package\",\n+    \"docs-only\": \"bazel build //aio:dgeni\",\n     \"docs-watch\": \"node tools/transforms/authors-package/watchr.js\",\n     \"docs-lint\": \"eslint --ignore-path=\\\"tools/transforms/.eslintignore\\\" tools/transforms\",\n-    \"docs-test\": \"node tools/transforms/test.js\",\n+    \"docs-test\": \"bazel test //aio/tools/transforms/...\",\n     \"redirects-test\": \"node tests/deployment/unit/test\",\n     \"firebase-utils-test\": \"node tools/firebase-test-utils/test\",\n     \"tools-lint\": \"eslint --ext=.mjs scripts/deploy-to-firebase && eslint tools/firebase-test-utils && eslint tools/ng-packages-installer\",\n-    \"tools-test\": \"yarn docs-test && yarn boilerplate:test && jasmine tools/ng-packages-installer/index.spec.js && jasmine scripts/deploy-to-firebase/**/*.spec.mjs && yarn firebase-utils-test\",\n-    \"preserve-and-sync\": \"yarn docs\",\n-    \"serve-and-sync\": \"run-p \\\"docs-watch --watch-only\\\" \\\"start {@}\\\" --\",\n-    \"boilerplate:add\": \"node ./tools/examples/example-boilerplate add\",\n-    \"boilerplate:remove\": \"node ./tools/examples/example-boilerplate remove\",\n-    \"boilerplate:test\": \"node tools/examples/test.js\",\n-    \"generate-stackblitz\": \"node ./tools/stackblitz-builder/generateStackblitz.mjs\",\n-    \"generate-zips\": \"node ./tools/example-zipper/generateZips.mjs\",\n-    \"create-example\": \"node ./tools/examples/create-example.js\",\n+    \"tools-test\": \"bazel test //aio/tools/... && jasmine scripts/deploy-to-firebase/**/*.spec.mjs && yarn firebase-utils-test\",\n+    \"serve\": \"bazel run //aio:serve\",\n+    \"serve-local\": \"yarn serve --config=aio_local_deps\",\n+    \"serve-and-sync\": \"bazel run //aio:fast-serve\",\n+    \"serve-and-sync-local\": \"yarn serve-and-sync --config=aio_local_deps\",\n+    \"boilerplate:test\": \"bazel test //aio/tools/examples:example-boilerplate-test\",\n+    \"generate-stackblitz\": \"bazel build //aio:stackblitz\",\n+    \"generate-zips\": \"bazel build //aio:example-zips\",\n+    \"create-example\": \"bazel run //aio/tools/examples:create-example\",\n     \"build-404-page\": \"node scripts/build-404-page\",\n     \"update-webdriver\": \"node ../scripts/webdriver-manager-update.js\",\n     \"security-lint\": \"tsec -p tsconfig.app.json\",\n     \"~~audit-web-app\": \"node scripts/audit-web-app.mjs\",\n     \"~~check-env\": \"node scripts/check-environment\",\n-    \"~~clean-generated\": \"node --eval \\\"require('shelljs').rm('-rf', 'src/generated')\\\"\",\n-    \"pre~~build\": \"node scripts/build-ngsw-config\",\n-    \"~~build\": \"ng build --configuration=stable\",\n     \"post~~build\": \"yarn build-404-page\",\n     \"~~light-server\": \"light-server --bind=localhost --historyindex=/index.html --no-reload\"\n   },\n\n---\n file path A: aio/tools/example-zipper/BUILD.bazel | file path B: aio/tools/example-zipper/BUILD.bazel\n\n@@ -6,8 +6,8 @@ nodejs_binary(\n     name = \"generate-example-zip\",\n     data = [\n         \"exampleZipper.mjs\",\n-        \"//aio/tools/transforms/examples-package\",\n-        \"//aio/tools/transforms/helpers\",\n+        \"//aio/tools/transforms/examples-package:files\",\n+        \"//aio/tools/transforms/helpers:files\",\n         \"@aio_npm//archiver\",\n         \"@aio_npm//canonical-path\",\n         \"@aio_npm//fs-extra\",\n\n---\n file path A: aio/tools/stackblitz-builder/BUILD.bazel | file path B: aio/tools/stackblitz-builder/BUILD.bazel\n\n@@ -6,8 +6,8 @@ nodejs_binary(\n     name = \"generate-stackblitz\",\n     data = [\n         \"builder.mjs\",\n-        \"//aio/tools/transforms/examples-package\",\n-        \"//aio/tools/transforms/helpers\",\n+        \"//aio/tools/transforms/examples-package:files\",\n+        \"//aio/tools/transforms/helpers:files\",\n         \"@aio_npm//canonical-path\",\n         \"@aio_npm//fs-extra\",\n         \"@aio_npm//globby\",\n\n---\n file path A: aio/tools/transforms/examples-package/BUILD.bazel | file path B: aio/tools/transforms/examples-package/BUILD.bazel\n\n@@ -3,10 +3,7 @@ load(\"@aio_npm//@bazel/jasmine:index.bzl\", \"jasmine_node_test\")\n \n js_library(\n     name = \"examples-package\",\n-    srcs = glob(\n-        [\"**/*.js\"],\n-        exclude = [\"**/*.spec.js\"],\n-    ),\n+    srcs = [\":files\"],\n     visibility = [\"//visibility:public\"],\n     deps = [\n         \"//aio/tools/transforms/helpers\",\n@@ -16,6 +13,15 @@ js_library(\n     ],\n )\n \n+filegroup(\n+    name = \"files\",\n+    srcs = glob(\n+        [\"**/*.js\"],\n+        exclude = [\"**/*.spec.js\"],\n+    ),\n+    visibility = [\"//visibility:public\"],\n+)\n+\n jasmine_node_test(\n     name = \"test\",\n     srcs = glob([\"**/*.spec.js\"]),\n\n---\n file path A: aio/tools/transforms/helpers/BUILD.bazel | file path B: aio/tools/transforms/helpers/BUILD.bazel\n\n@@ -3,10 +3,7 @@ load(\"@aio_npm//@bazel/jasmine:index.bzl\", \"jasmine_node_test\")\n \n js_library(\n     name = \"helpers\",\n-    srcs = [\n-        \"test-package.js\",\n-        \"utils.js\",\n-    ],\n+    srcs = [\":files\"],\n     visibility = [\"//aio/tools:__subpackages__\"],\n     deps = [\n         \"//:package_json\",\n@@ -15,6 +12,15 @@ js_library(\n     ],\n )\n \n+filegroup(\n+    name = \"files\",\n+    srcs = [\n+        \"test-package.js\",\n+        \"utils.js\",\n+    ],\n+    visibility = [\"//visibility:public\"],\n+)\n+\n jasmine_node_test(\n     name = \"test\",\n     srcs = glob([\"*.spec.js\"]),\n\n\n###\n\n", "completion": "build(bazel): add aio targets to ci"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -24,12 +24,8 @@ http_archive(\n \n http_archive(\n     name = \"build_bazel_rules_nodejs\",\n-    patch_args = [\"-p1\"],\n-    patches = [\n-        \"//:tools/bazel-repo-patches/rules_nodejs__esm_no_linker_fix.patch\",\n-    ],\n-    sha256 = \"ee3280a7f58aa5c1caa45cb9e08cbb8f4d74300848c508374daf37314d5390d6\",\n-    urls = [\"https://github.com/bazelbuild/rules_nodejs/releases/download/5.5.1/rules_nodejs-5.5.1.tar.gz\"],\n+    sha256 = \"c78216f5be5d451a42275b0b7dc809fb9347e2b04a68f68bad620a2b01f5c774\",\n+    urls = [\"https://github.com/bazelbuild/rules_nodejs/releases/download/5.5.2/rules_nodejs-5.5.2.tar.gz\"],\n )\n \n load(\"@build_bazel_rules_nodejs//:repositories.bzl\", \"build_bazel_rules_nodejs_dependencies\")\n\n---\n file path A: tools/bazel-repo-patches/rules_nodejs__esm_no_linker_fix.patch | file path B: None\n\n@@ -1,164 +0,0 @@\n-diff --git a/internal/node/launcher.sh b/internal/node/launcher.sh\n-index 9d1e8df4..db31cb45 100644\n---- a/internal/node/launcher.sh\n-+++ b/internal/node/launcher.sh\n-@@ -331,26 +331,24 @@ if [ \"$PATCH_REQUIRE\" = true ]; then\n-     *           ) require_patch_script=\"${PWD}/${require_patch_script}\" ;;\n-   esac\n-   LAUNCHER_NODE_OPTIONS+=( \"--require\" \"$require_patch_script\" )\n--  # Change the entry point to be the loader.cjs script so we run code before node\n--  MAIN=$(rlocation \"TEMPLATED_loader_script\")\n--else\n--  # Entry point is the user-supplied script\n--  MAIN=\"${PWD}/\"TEMPLATED_entry_point_execroot_path\n--  # TODO: after we link-all-bins we should not need this extra lookup\n--  if [[ ! -e \"$MAIN\" ]]; then\n--    if [ \"$FROM_EXECROOT\" = true ]; then\n--      MAIN=\"$EXECROOT/\"TEMPLATED_entry_point_execroot_path\n--    else\n--      MAIN=TEMPLATED_entry_point_manifest_path\n--    fi\n--  fi\n--  # Always set up source-map-support using our vendored copy, just like the require_patch_script\n--  register_source_map_support=$(rlocation build_bazel_rules_nodejs/third_party/github.com/source-map-support/register.js)\n--  LAUNCHER_NODE_OPTIONS+=( \"--require\" \"${register_source_map_support}\" )\n--  if [[ -n \"TEMPLATED_entry_point_main\" ]]; then\n--    MAIN=\"${MAIN}/\"TEMPLATED_entry_point_main\n-+fi\n-+\n-+# Entry point is the user-supplied script\n-+MAIN=\"${PWD}/\"TEMPLATED_entry_point_execroot_path\n-+# TODO: after we link-all-bins we should not need this extra lookup\n-+if [[ ! -e \"$MAIN\" ]]; then\n-+  if [ \"$FROM_EXECROOT\" = true ]; then\n-+    MAIN=\"$EXECROOT/\"TEMPLATED_entry_point_execroot_path\n-+  else\n-+    MAIN=TEMPLATED_entry_point_manifest_path\n-   fi\n- fi\n-+# Always set up source-map-support using our vendored copy, just like the require_patch_script\n-+register_source_map_support=$(rlocation build_bazel_rules_nodejs/third_party/github.com/source-map-support/register.js)\n-+LAUNCHER_NODE_OPTIONS+=( \"--require\" \"${register_source_map_support}\" )\n-+if [[ -n \"TEMPLATED_entry_point_main\" ]]; then\n-+  MAIN=\"${MAIN}/\"TEMPLATED_entry_point_main\n-+fi\n- \n- if [ \"${SILENT_ON_SUCCESS:-}\" = true ]; then\n-   if [[ -z \"${STDOUT_CAPTURE}\" ]]; then\n-@@ -484,3 +482,4 @@ if [[ -n \"${EXIT_CODE_CAPTURE}\" ]]; then\n- else\n-   exit ${RESULT}\n- fi\n-+\n-diff --git a/internal/node/loader.cjs b/internal/node/loader.cjs\n-deleted file mode 100644\n-index dd7bc0b4..00000000\n---- a/internal/node/loader.cjs\n-+++ /dev/null\n-@@ -1,39 +0,0 @@\n--/**\n-- * @license\n-- * Copyright 2017 The Bazel Authors. All rights reserved.\n-- *\n-- * Licensed under the Apache License, Version 2.0 (the \"License\");\n-- * you may not use this file except in compliance with the License.\n-- *\n-- * You may obtain a copy of the License at\n-- *     http://www.apache.org/licenses/LICENSE-2.0\n-- *\n-- * Unless required by applicable law or agreed to in writing, software\n-- * distributed under the License is distributed on an \"AS IS\" BASIS,\n-- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-- * See the License for the specific language governing permissions and\n-- * limitations under the License.\n-- */\n--/**\n-- * @fileoverview NodeJS module loader for bazel.\n-- */\n--'use strict';\n--\n--// Ensure that node is added to the path for any subprocess calls\n--process.env.PATH = [require('path').dirname(process.execPath), process.env.PATH].join(\n--    /^win/i.test(process.platform) ? ';' : ':');\n--\n--if (require.main === module) {\n--  // Set the actual entry point in the arguments list.\n--  // argv[0] == node, argv[1] == entry point.\n--  // NB: 'TEMPLATED_entry_point_path' & 'TEMPLATED_entry_point' below are replaced during the build process.\n--  var entryPointPath = 'TEMPLATED_entry_point_path';\n--  var entryPointMain = 'TEMPLATED_entry_point_main';\n--  var mainScript = process.argv[1] = entryPointMain ? `${entryPointPath}/${entryPointMain}` : entryPointPath;\n--  try {\n--    module.constructor._load(mainScript, this, /*isMain=*/true);\n--  } catch (e) {\n--    console.error(e.stack || e);\n--    process.exit(1);\n--  }\n--}\n-diff --git a/internal/node/node.bzl b/internal/node/node.bzl\n-index b4debf8f..d8608c2b 100644\n---- a/internal/node/node.bzl\n-+++ b/internal/node/node.bzl\n-@@ -117,21 +117,6 @@ def _get_entry_point_file(ctx):\n-         return ctx.attr.entry_point[DirectoryFilePathInfo].directory\n-     fail(\"entry_point must either be a file, or provide DirectoryFilePathInfo\")\n- \n--def _write_loader_script(ctx):\n--    substitutions = {}\n--    substitutions[\"TEMPLATED_entry_point_path\"] = _ts_to_js(_to_manifest_path(ctx, _get_entry_point_file(ctx)))\n--    if DirectoryFilePathInfo in ctx.attr.entry_point:\n--        substitutions[\"TEMPLATED_entry_point_main\"] = ctx.attr.entry_point[DirectoryFilePathInfo].path\n--    else:\n--        substitutions[\"TEMPLATED_entry_point_main\"] = \"\"\n--\n--    ctx.actions.expand_template(\n--        template = ctx.file._loader_template,\n--        output = ctx.outputs.loader_script,\n--        substitutions = substitutions,\n--        is_executable = True,\n--    )\n--\n- # Avoid using non-normalized paths (workspace/../other_workspace/path)\n- def _to_manifest_path(ctx, file):\n-     if file.short_path.startswith(\"../\"):\n-@@ -208,8 +193,6 @@ def _nodejs_binary_impl(ctx, data = [], runfiles = [], expanded_args = []):\n-         node_modules_root = \"build_bazel_rules_nodejs/node_modules\"\n-     _write_require_patch_script(ctx, data, node_modules_root)\n- \n--    _write_loader_script(ctx)\n--\n-     # Provide the target name as an environment variable avaiable to all actions for the\n-     # runfiles helpers to use.\n-     env_vars = \"export BAZEL_TARGET=%s\\n\" % ctx.label\n-@@ -276,7 +259,6 @@ fi\n-     runfiles = runfiles[:]\n-     runfiles.extend(node_tool_files)\n-     runfiles.extend(ctx.files._bash_runfile_helper)\n--    runfiles.append(ctx.outputs.loader_script)\n-     runfiles.append(ctx.outputs.require_patch_script)\n- \n-     # First replace any instances of \"$(rlocation \" with \"$$(rlocation \" to preserve\n-@@ -331,7 +313,6 @@ if (process.cwd() !== __dirname) {\n-         \"TEMPLATED_expected_exit_code\": str(expected_exit_code),\n-         \"TEMPLATED_lcov_merger_script\": _to_manifest_path(ctx, ctx.file._lcov_merger_script),\n-         \"TEMPLATED_link_modules_script\": _to_manifest_path(ctx, ctx.file._link_modules_script),\n--        \"TEMPLATED_loader_script\": _to_manifest_path(ctx, ctx.outputs.loader_script),\n-         \"TEMPLATED_modules_manifest\": _to_manifest_path(ctx, node_modules_manifest),\n-         \"TEMPLATED_node_patches_script\": _to_manifest_path(ctx, ctx.file._node_patches_script),\n-         \"TEMPLATED_require_patch_script\": _to_manifest_path(ctx, ctx.outputs.require_patch_script),\n-@@ -378,7 +359,6 @@ if (process.cwd() !== __dirname) {\n-             runfiles = ctx.runfiles(\n-                 transitive_files = depset(runfiles),\n-                 files = node_tool_files + [\n--                            ctx.outputs.loader_script,\n-                             ctx.outputs.require_patch_script,\n-                         ] + ctx.files._source_map_support_files +\n- \n-@@ -642,7 +622,6 @@ Predefined genrule variables are not supported in this context.\n- \n- _NODEJS_EXECUTABLE_OUTPUTS = {\n-     \"launcher_sh\": \"%{name}.sh\",\n--    \"loader_script\": \"%{name}_loader.cjs\",\n-     \"require_patch_script\": \"%{name}_require_patch.cjs\",\n- }\n- \n\\ No newline at end of file\n\n\n###\n\n", "completion": "build(bazel): remove rules_nodejs patch"}
{"prompt": " file path A: aio/content/examples/.gitignore | file path B: aio/content/examples/.gitignore\n\n\n---\n file path A: aio/content/examples/examples.bzl | file path B: aio/content/examples/examples.bzl\n\n@@ -11,6 +11,7 @@ load(\"@aspect_bazel_lib//lib:copy_to_directory.bzl\", \"copy_to_directory\")\n # found in the example. Set \"zip\" to True to generate archives for any stackblitz or\n # zipper configuration file found in the example.\n #\n+# To ignore an example, comment out its row.\n \n EXAMPLES = {\n     \"accessibility\": {\"stackblitz\": True, \"zip\": True},\n@@ -102,7 +103,9 @@ def docs_example(name):\n         name: name of the example\n     \"\"\"\n     if name not in EXAMPLES:\n-        fail(\"Cannot find example %s in the EXAMPLES map in aio/content/examples/examples.bzl. Did you forget to add an entry?\" % name)\n+        # buildifier: disable=print\n+        print(\"WARNING: Example '%s' is being ignored. To include it, add an entry to the EXAMPLES map in aio/content/examples/examples.bzl.\" % name)\n+        return\n \n     native.filegroup(\n         name = \"files\",\n\n---\n file path A: aio/content/guide/docs-style-guide.md | file path B: aio/content/guide/docs-style-guide.md\n\n@@ -328,10 +328,6 @@ Following convention, set the `header` attribute to the file's location within t\n \n Unless otherwise commented, all code snippets in this page are from sample source code located in the `content/examples/docs-style-guide` directory.\n \n-<div class=\"alert is-important\">\n-\n-The documentation tooling reports an error if the file identified in the path does not exist or is in the [`.git-ignore` file](https://github.com/angular/angular/blob/main/aio/content/examples/.gitignore).\n-\n <a id=\"region\"></a>\n \n ### Displaying part of a code file\n\n---\n file path A: aio/tools/examples/create-example.js | file path B: aio/tools/examples/create-example.js\n\n@@ -87,12 +87,11 @@ function writeStackBlitzFile(exampleName, examplePath) {\n }\n \n /**\n- * Copy all the files from the `sourcePath`, which are not ignored by the `.gitignore` file in the\n- * `EXAMPLES_BASE_PATH`, to the `examplePath`.\n+ * Copy all the files from the `sourcePath` to the `examplePath`, except for files\n+ * ignored by the source example.\n  */\n function copyExampleFiles(sourcePath, examplePath, exampleName) {\n   const gitIgnoreSource = getGitIgnore(sourcePath);\n-  const gitIgnoreExamples = getGitIgnore(EXAMPLES_BASE_PATH);\n \n   // Grab the files in the source folder and filter them based on the gitignore rules.\n   const sourceFiles =\n@@ -106,8 +105,6 @@ function copyExampleFiles(sourcePath, examplePath, exampleName) {\n           .filter(filePath => !/\\/$/.test(filePath))\n           // Filter out files that match the source directory .gitignore rules\n           .filter(filePath => !gitIgnoreSource.ignores(filePath))\n-          // Filter out files that match the examples directory .gitignore rules\n-          .filter(filePath => !gitIgnoreExamples.ignores(path.join(exampleName, filePath)));\n \n   for (const sourceFile of sourceFiles) {\n     console.log(' - ', sourceFile);\n\n---\n file path A: aio/tools/examples/create-example.spec.js | file path B: aio/tools/examples/create-example.spec.js\n\n@@ -2,7 +2,7 @@ const path = require('canonical-path');\n const fs = require('fs-extra');\n const {glob} = require('glob');\n \n-const {EXAMPLES_BASE_PATH, EXAMPLE_CONFIG_FILENAME, STACKBLITZ_CONFIG_FILENAME} =\n+const {EXAMPLE_CONFIG_FILENAME, STACKBLITZ_CONFIG_FILENAME} =\n     require('./constants');\n \n const {\n@@ -82,15 +82,12 @@ describe('create-example tool', () => {\n \n   describe('copyExampleFiles', () => {\n     it('should copy over files that are not ignored by git', () => {\n-      const examplesGitIgnorePath = path.resolve(EXAMPLES_BASE_PATH, '.gitignore');\n       const sourceGitIgnorePath = path.resolve('/source/path', '.gitignore');\n \n       spyOn(console, 'log');\n       spyOn(fs, 'existsSync').and.returnValue(true);\n       const readFileSyncSpy = spyOn(fs, 'readFileSync').and.callFake(p => {\n         switch (p) {\n-          case examplesGitIgnorePath:\n-            return '**/a/b/**';\n           case sourceGitIgnorePath:\n             return '**/*.bad';\n           default:\n@@ -98,14 +95,13 @@ describe('create-example tool', () => {\n         }\n       });\n       spyOn(glob, 'sync').and.returnValue([\n-        'a/', 'a/b/', 'a/c', 'x.ts', 'x.bad', 'a/b/y.ts', 'a/b/y.bad'\n+        'a/', 'a/b/', 'a/c', 'x.ts', 'x.bad'\n       ]);\n       const ensureDirSyncSpy = spyOn(fs, 'ensureDirSync');\n       const copySyncSpy = spyOn(fs, 'copySync');\n \n       copyExampleFiles('/source/path', '/path/to/test-example', 'test-example');\n \n-      expect(readFileSyncSpy).toHaveBeenCalledWith(examplesGitIgnorePath, 'utf8');\n       expect(readFileSyncSpy).toHaveBeenCalledWith(sourceGitIgnorePath, 'utf8');\n \n       expect(ensureDirSyncSpy.calls.allArgs()).toEqual([\n\n---\n file path A: aio/tools/examples/shared/boilerplate/.gitignore | file path B: aio/tools/examples/shared/boilerplate/.gitignore\n\n@@ -1,3 +1,4 @@\n **/node_modules/\n **/package-lock.json\n **/yarn.lock\n+**/.vscode\n\n---\n file path A: aio/tools/transforms/angular-content-package/index.js | file path B: aio/tools/transforms/angular-content-package/index.js\n\n@@ -7,8 +7,6 @@\n  */\n const Package = require('dgeni').Package;\n const glob = require('glob');\n-const ignore = require('ignore');\n-const fs = require('fs');\n const path = require('canonical-path');\n const basePackage = require('../angular-base-package');\n const contentPackage = require('../content-package');\n@@ -19,25 +17,12 @@ module.exports = new Package('angular-content', [basePackage, contentPackage])\n \n   // Where do we get the source files?\n   .config(function(readFilesProcessor, collectExamples) {\n-\n-    const gitignoreFilePath = path.resolve(GUIDE_EXAMPLES_PATH, '.gitignore');\n-    const gitignoreFile = fs.readFileSync(gitignoreFilePath, 'utf8');\n-    const gitignore = ignore().add(gitignoreFile);\n-\n     const examplePaths = glob.sync('**/*', { cwd: GUIDE_EXAMPLES_PATH, dot: true, ignore: '**/node_modules/**', mark: true })\n-                            .filter(filePath => filePath !== '.gitignore') // we are not interested in the .gitignore file itself\n                             .filter(filePath => !/\\/$/.test(filePath)); // this filter removes the folders, leaving only files\n-    const ignoredExamplePaths = [];\n     const resolvedExamplePaths = [];\n \n     examplePaths.forEach(filePath => {\n-      // filter out files that match the .gitignore rules\n-      if (gitignore.ignores(filePath)) {\n-        ignoredExamplePaths.push(filePath);\n-      } else {\n-        // we need the full paths for the filereader\n         resolvedExamplePaths.push(path.resolve(GUIDE_EXAMPLES_PATH, filePath));\n-      }\n     });\n \n     readFilesProcessor.sourceFiles = readFilesProcessor.sourceFiles.concat([\n@@ -90,7 +75,6 @@ module.exports = new Package('angular-content', [basePackage, contentPackage])\n     ]);\n \n     collectExamples.exampleFolders.push('examples');\n-    collectExamples.registerIgnoredExamples(ignoredExamplePaths, gitignoreFilePath);\n   })\n \n \n\n---\n file path A: aio/tools/transforms/examples-package/processors/collect-examples.js | file path B: aio/tools/transforms/examples-package/processors/collect-examples.js\n\n@@ -7,24 +7,7 @@ module.exports = function collectExamples(exampleMap, regionParser, log, createD\n     $runBefore: ['parsing-tags'],\n     $validate: {exampleFolders: {presence: true}},\n     exampleFolders: [],\n-    ignoredExamples: {},\n-    /**\n-     * Call this method to indicate to the processor that some files, that actually exist,\n-     * have been filtered out from being processed.\n-     * @param paths an array of relative paths to the examples that have been ignored.\n-     * @param gitIgnorePath the path to the gitignore file that caused this example to be ignored.\n-     */\n-    registerIgnoredExamples(paths, gitIgnorePath) {\n-      paths.forEach(path => { this.ignoredExamples[path] = gitIgnorePath; });\n-    },\n-    /**\n-     * Call this method to find out if an example was ignored.\n-     * @param path a relative path to the example file to test for being ignored.\n-     * @returns the path to the .gitignore file.\n-     */\n-    isExampleIgnored(path) {\n-      return this.ignoredExamples[path];\n-    },\n+\n     $process(docs) {\n       const exampleFolders = this.exampleFolders;\n       exampleFolders.forEach(folder => exampleMap[folder] = exampleMap[folder] || {});\n\n---\n file path A: aio/tools/transforms/examples-package/processors/collect-examples.spec.js | file path B: aio/tools/transforms/examples-package/processors/collect-examples.spec.js\n\n@@ -188,17 +188,6 @@ describe('collectExampleRegions processor', () => {\n       });\n     });\n   });\n-\n-  describe('filtered examples', () => {\n-    it('should indicate if an example was filtered', () => {\n-      processor.registerIgnoredExamples(['c/d/e', 'e/f/g'], 'path/to/gitignore');\n-      processor.registerIgnoredExamples(['x/y/z'], 'path/to/other/gitignore');\n-      expect(processor.isExampleIgnored('a/b/c')).toBeFalsy();\n-      expect(processor.isExampleIgnored('c/d/e')).toEqual('path/to/gitignore');\n-      expect(processor.isExampleIgnored('e/f/g')).toEqual('path/to/gitignore');\n-      expect(processor.isExampleIgnored('x/y/z')).toEqual('path/to/other/gitignore');\n-    });\n-  });\n });\n \n \n\n---\n file path A: aio/tools/transforms/examples-package/services/getExampleRegion.js | file path B: aio/tools/transforms/examples-package/services/getExampleRegion.js\n\n@@ -14,16 +14,9 @@ module.exports = function getExampleRegion(exampleMap, createDocMessage, collect\n \n     // If still no file then we error\n     if (!exampleFile) {\n-      const gitIgnoreFile = collectExamples.isExampleIgnored(relativePath);\n-      if (gitIgnoreFile) {\n-        const message = createDocMessage('Ignored example file... relativePath: \"' + relativePath + '\"', doc) + '\\n' +\n-        'This example file exists but has been ignored by a rule, in \"' + gitIgnoreFile + '\".';\n-        throw new Error(message);\n-      } else {\n         const message = createDocMessage('Missing example file... relativePath: \"' + relativePath + '\".', doc) + '\\n' +\n             'Example files can be found in the following relative paths: ' + EXAMPLES_FOLDERS.map(function(folder) { return '\"' + folder + '\"'; }).join(', ');\n         throw new Error(message);\n-      }\n     }\n \n     var sourceCodeDoc = exampleFile.regions[regionName || ''];\n\n---\n file path A: aio/tools/transforms/examples-package/services/getExampleRegion.spec.js | file path B: aio/tools/transforms/examples-package/services/getExampleRegion.spec.js\n\n@@ -11,7 +11,6 @@ describe('getExampleRegion', () => {\n     collectExamples = injector.get('collectExamples');\n     exampleMap = injector.get('exampleMap');\n     collectExamples.exampleFolders = ['examples'];\n-    collectExamples.registerIgnoredExamples(['filtered/path'], 'some/gitignore');\n     exampleMap['examples'] = {\n       'test/url': { regions: {\n         '': { renderedContent: 'whole file' },\n@@ -37,13 +36,6 @@ describe('getExampleRegion', () => {\n     }).toThrowError('Missing example region... relativePath: \"test/url\", region: \"missing-region\". - doc\\nRegions available are: \"\", \"region-1\"');\n   });\n \n-  it('should throw an error if an example has been filtered out', () => {\n-    expect(() => {\n-      getExampleRegion({}, 'filtered/path', 'any-region');\n-    }).toThrowError('Ignored example file... relativePath: \"filtered/path\" - doc\\n' +\n-                    'This example file exists but has been ignored by a rule, in \"some/gitignore\".');\n-  });\n-\n   it('should mark the example as having been \"used\"', () => {\n     const doc1 = {};\n     const doc2 = {};\n\n\n###\n\n", "completion": "build(bazel): replace ignore example feature with bazel equivalent"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -182,7 +182,7 @@ architect(\n     name = \"build\",\n     args = [\n         \"site:build:stable\",\n-        \"--outputPath=../$(@D)\",\n+        \"--output-path=../$(@D)\",\n     ],\n     chdir = package_name(),\n     configuration_env_vars = [\"NG_BUILD_CACHE\"],\n@@ -211,14 +211,14 @@ architect_test(\n     name = \"e2e\",\n     args = [\n         \"site:e2e\",\n-        \"--no-webdriverUpdate\",\n+        \"--no-webdriver-update\",\n     ],\n     chdir = package_name(),\n     configuration_env_vars = [\"NG_BUILD_CACHE\"],\n     data = E2E_FILES + E2E_DEPS,\n     env = {\n-        \"CHROMEDRIVER_BIN\": \"../$(CHROMEDRIVER)\",\n         \"CHROME_BIN\": \"../$(CHROMIUM)\",\n+        \"CHROMEDRIVER_BIN\": \"../$(CHROMEDRIVER)\",\n     },\n     toolchains = [\n         \"@aio_npm//@angular/dev-infra-private/bazel/browsers/chromium:toolchain_alias\",\n\n---\n file path A: aio/karma.conf.js | file path B: aio/karma.conf.js\n\n@@ -1,6 +1,29 @@\n // Karma configuration file, see link for more information\n // https://karma-runner.github.io/1.0/config/configuration-file.html\n \n+const os = require('os');\n+\n+if (os.platform() === 'win32') {\n+  /*\n+    For some unknown reason, the symlinked copy of chromium under runfiles won't run under\n+    karma on Windows. Instead, modify the CHROME_BIN env var to point to the chrome binary\n+    under external/ in the execroot.\n+\n+    CHROME_BIN is set to the make var $(CHROMIUM) in aio/BUILD.bazel, which points to chrome\n+    under runfiles and thus starts with ../. Because we run architect with a chdir into aio,\n+    $(CHROMIUM) additionally has a second ../.\n+\n+    First, back out of\n+        bazel-out/x64_windows-fastbuild/bin/aio/test.bat.runfiles/angular/aio\n+    Then go into\n+        external/\n+    and then into\n+        org_chromium_chromium_windows/chrome-win\n+    to cancel out the leading ../../\n+  */\n+  process.env.CHROME_BIN = `../../../../../../../external/org_chromium_chromium_windows/chrome-win/${process.env.CHROME_BIN}`;\n+}\n+\n module.exports = function (config) {\n   config.set({\n     basePath: '',\n\n---\n file path A: aio/tests/e2e/protractor.conf.js | file path B: aio/tests/e2e/protractor.conf.js\n\n@@ -4,6 +4,29 @@\n \n const { SpecReporter, StacktraceOption } = require('jasmine-spec-reporter');\n const path = require('path')\n+const os = require('os');\n+\n+if (os.platform() === 'win32') {\n+  /*\n+    For some unknown reason, the symlinked copy of chromium under runfiles won't run under\n+    karma on Windows. Instead, modify the CHROME_BIN env var to point to the chrome binary\n+    under external/ in the execroot.\n+\n+    CHROME_BIN is set to the make var $(CHROMIUM) in aio/BUILD.bazel, which points to chrome\n+    under runfiles and thus starts with ../. Because we run architect with a chdir into aio,\n+    $(CHROMIUM) additionally has a second ../.\n+\n+    First, back out of\n+        bazel-out/x64_windows-fastbuild/bin/aio/e2e.bat.runfiles/angular/aio\n+    Then go into\n+        external/\n+    and then into\n+        org_chromium_chromium_windows/chrome-win\n+    to cancel out the leading ../../\n+  */\n+  process.env.CHROME_BIN = `../../../../../../../external/org_chromium_chromium_windows/chrome-win/${process.env.CHROME_BIN}`;\n+}\n+\n /**\n  * @type { import(\"protractor\").Config }\n  */\n\n---\n file path A: aio/tools/transforms/angular-base-package/services/getImageDimensions.js | file path B: aio/tools/transforms/angular-base-package/services/getImageDimensions.js\n\n@@ -6,7 +6,7 @@ module.exports = function getImageDimensions() {\n     let error;\n     for (const basePath of basePaths) {\n       try {\n-        return sizeOf(resolve(basePath, path));\n+        return sizeOf(join(basePath, path));\n       } catch (e) {\n         // Fall back to next basePath if not found\n         error = e;\n\n\n###\n\n", "completion": "build(bazel): fix bazel aio regressions after rebase"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -150,6 +150,7 @@ TEST_FILES = APPLICATION_FILES + [\n \n # External dependencies from aio/package.json required to test the docs app\n TEST_DEPS = APPLICATION_DEPS + [\n+    \"@aio_npm//@angular/dev-infra-private/bazel/browsers/chromium\",\n     \"@aio_npm//@types/jasmine\",\n     \"@aio_npm//@types/node\",\n     \"@aio_npm//assert\",\n@@ -160,6 +161,7 @@ TEST_DEPS = APPLICATION_DEPS + [\n     \"@aio_npm//karma-jasmine\",\n     \"@aio_npm//karma-jasmine-html-reporter\",\n     \"@aio_npm//puppeteer\",\n+    \"@aio_npm//timezone-mock\",\n ]\n \n # All sources, specs, and config files required to serve the app\n@@ -197,6 +199,12 @@ architect_test(\n     chdir = package_name(),\n     configuration_env_vars = [\"NG_BUILD_CACHE\"],\n     data = TEST_FILES + TEST_DEPS,\n+    env = {\n+        \"CHROME_BIN\": \"../$(CHROMIUM)\",\n+    },\n+    toolchains = [\n+        \"@aio_npm//@angular/dev-infra-private/bazel/browsers/chromium:toolchain_alias\",\n+    ],\n )\n \n architect_test(\n\n---\n file path A: aio/karma.conf.js | file path B: aio/karma.conf.js\n\n@@ -1,6 +1,5 @@\n // Karma configuration file, see link for more information\n // https://karma-runner.github.io/1.0/config/configuration-file.html\n-process.env.CHROME_BIN = require('puppeteer').executablePath();\n \n module.exports = function (config) {\n   config.set({\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -170,7 +170,6 @@\n     \"lunr\": \"^2.3.9\",\n     \"npm-run-all\": \"^4.1.5\",\n     \"protractor\": \"~7.0.0\",\n-    \"puppeteer\": \"10.2.0\",\n     \"rehype-slug\": \"^4.0.1\",\n     \"remark\": \"^12.0.0\",\n     \"remark-html\": \"^13.0.0\",\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -5591,11 +5591,6 @@ dev-ip@^1.0.1:\n   resolved \"https://registry.yarnpkg.com/dev-ip/-/dev-ip-1.0.1.tgz#a76a3ed1855be7a012bb8ac16cb80f3c00dc28f0\"\n   integrity sha512-LmVkry/oDShEgSZPNgqCIp2/TlqtExeGmymru3uCELnfyjY11IzpAproLYs+1X88fXO6DBoYP3ul2Xo2yz2j6A==\n \n-devtools-protocol@0.0.901419:\n-  version \"0.0.901419\"\n-  resolved \"https://registry.yarnpkg.com/devtools-protocol/-/devtools-protocol-0.0.901419.tgz#79b5459c48fe7e1c5563c02bd72f8fec3e0cebcd\"\n-  integrity sha512-4INMPwNm9XRpBukhNbF7OB6fNTTCaI8pzy/fXg0xQzAy5h3zL1P8xT3QazgKqBrb/hAYwIBizqDBZ7GtJE74QQ==\n-\n devtools-protocol@0.0.981744:\n   version \"0.0.981744\"\n   resolved \"https://registry.yarnpkg.com/devtools-protocol/-/devtools-protocol-0.0.981744.tgz#9960da0370284577d46c28979a0b32651022bacf\"\n@@ -8073,14 +8068,6 @@ https-proxy-agent@5, https-proxy-agent@5.0.1, https-proxy-agent@^5.0.0, https-pr\n     agent-base \"6\"\n     debug \"4\"\n \n-https-proxy-agent@5.0.0:\n-  version \"5.0.0\"\n-  resolved \"https://registry.yarnpkg.com/https-proxy-agent/-/https-proxy-agent-5.0.0.tgz#e2a90542abb68a762e0a0850f6c9edadfd8506b2\"\n-  integrity sha512-EkYm5BcKUGiduxzSt3Eppko+PiNWNEpa4ySk9vTC6wDsQJW9rHSa+UhGNJoRYp7bz6Ht1eaRIa6QaJqO5rCFbA==\n-  dependencies:\n-    agent-base \"6\"\n-    debug \"4\"\n-\n https-proxy-agent@^2.2.1:\n   version \"2.2.4\"\n   resolved \"https://registry.yarnpkg.com/https-proxy-agent/-/https-proxy-agent-2.2.4.tgz#4ee7a737abd92678a293d9b34a1af4d0d08c787b\"\n@@ -10113,7 +10100,7 @@ mkdirp-classic@^0.5.2:\n   resolved \"https://registry.yarnpkg.com/mkdirp-classic/-/mkdirp-classic-0.5.3.tgz#fa10c9115cc6d8865be221ba47ee9bed78601113\"\n   integrity sha512-gKLcREMhtuZRwRAfqP3RFW+TK4JqApVBtOIftVgjuABpAtpxhPGaDcfvbhNvD0B8iD1oUr/txX35NjcaY6Ns/A==\n \n-\"mkdirp@>=0.5 0\", mkdirp@^0.5.1, mkdirp@^0.5.3, mkdirp@^0.5.5, mkdirp@^0.5.6:\n+\"mkdirp@>=0.5 0\", mkdirp@^0.5.3, mkdirp@^0.5.5, mkdirp@^0.5.6:\n   version \"0.5.6\"\n   resolved \"https://registry.yarnpkg.com/mkdirp/-/mkdirp-0.5.6.tgz#7def03d2432dcae4ba1d611445c48396062255f6\"\n   integrity sha512-FP+p8RB8OWpF3YZBCrP5gtADmtXApB5AMLn+vdyA+PyxCjrCs00mjyUozssO33cwDeT3wNGdLxJ5M//YqtHAJw==\n@@ -10249,11 +10236,6 @@ node-emoji@^1.11.0:\n   dependencies:\n     lodash \"^4.17.21\"\n \n-node-fetch@2.6.1:\n-  version \"2.6.1\"\n-  resolved \"https://registry.yarnpkg.com/node-fetch/-/node-fetch-2.6.1.tgz#045bd323631f76ed2e2b55573394416b639a0052\"\n-  integrity sha512-V4aYg89jEoVRxRb2fJdAg8FHvI7cEyYdVAh94HH0UIK8oJxUfkjlDQN9RbMx+bEjP7+ggMiFRprSti032Oipxw==\n-\n node-fetch@2.6.7, node-fetch@^2.6.1, node-fetch@^2.6.7:\n   version \"2.6.7\"\n   resolved \"https://registry.yarnpkg.com/node-fetch/-/node-fetch-2.6.7.tgz#24de9fba827e3b4ae44dc8b20256a379160052ad\"\n@@ -11469,11 +11451,6 @@ process-nextick-args@~2.0.0:\n   resolved \"https://registry.yarnpkg.com/process-nextick-args/-/process-nextick-args-2.0.1.tgz#7820d9b16120cc55ca9ae7792680ae7dba6d7fe2\"\n   integrity sha512-3ouUOpQhtgrbOa17J7+uxOTpITYWaGP7/AhoR3+A+/1e9skrzelGi/dXzEYyvbxubEF6Wn2ypscTKiKJFFn1ag==\n \n-progress@2.0.1:\n-  version \"2.0.1\"\n-  resolved \"https://registry.yarnpkg.com/progress/-/progress-2.0.1.tgz#c9242169342b1c29d275889c95734621b1952e31\"\n-  integrity sha512-OE+a6vzqazc+K6LxJrX5UPyKFvGnL5CYmq2jFGNIBWHpc4QyE49/YOumcrpQFJpfejmvRtbJzgO1zPmMCqlbBg==\n-\n progress@2.0.3, progress@^2.0.3:\n   version \"2.0.3\"\n   resolved \"https://registry.yarnpkg.com/progress/-/progress-2.0.3.tgz#7e8cf8d8f5b8f239c1bc68beb4eb78567d572ef8\"\n@@ -11655,24 +11632,6 @@ puppeteer-core@^13.7.0:\n     unbzip2-stream \"1.4.3\"\n     ws \"8.5.0\"\n \n-puppeteer@10.2.0:\n-  version \"10.2.0\"\n-  resolved \"https://registry.yarnpkg.com/puppeteer/-/puppeteer-10.2.0.tgz#7d8d7fda91e19a7cfd56986e0275448e6351849e\"\n-  integrity sha512-OR2CCHRashF+f30+LBOtAjK6sNtz2HEyTr5FqAvhf8lR/qB3uBRoIZOwQKgwoyZnMBsxX7ZdazlyBgGjpnkiMw==\n-  dependencies:\n-    debug \"4.3.1\"\n-    devtools-protocol \"0.0.901419\"\n-    extract-zip \"2.0.1\"\n-    https-proxy-agent \"5.0.0\"\n-    node-fetch \"2.6.1\"\n-    pkg-dir \"4.2.0\"\n-    progress \"2.0.1\"\n-    proxy-from-env \"1.1.0\"\n-    rimraf \"3.0.2\"\n-    tar-fs \"2.0.0\"\n-    unbzip2-stream \"1.3.3\"\n-    ws \"7.4.6\"\n-\n q@1.4.1:\n   version \"1.4.1\"\n   resolved \"https://registry.yarnpkg.com/q/-/q-1.4.1.tgz#55705bcd93c5f3673530c2c2cbc0c2b3addc286e\"\n@@ -13311,16 +13270,6 @@ tapable@^2.1.1, tapable@^2.2.0:\n   resolved \"https://registry.yarnpkg.com/tapable/-/tapable-2.2.1.tgz#1967a73ef4060a82f12ab96af86d52fdb76eeca0\"\n   integrity sha512-GNzQvQTOIP6RyTfE2Qxb8ZVlNmw0n88vp1szwWRimP02mnTsx3Wtn5qRdqY9w2XduFNUgvOwhNnQsjwCp+kqaQ==\n \n-tar-fs@2.0.0:\n-  version \"2.0.0\"\n-  resolved \"https://registry.yarnpkg.com/tar-fs/-/tar-fs-2.0.0.tgz#677700fc0c8b337a78bee3623fdc235f21d7afad\"\n-  integrity sha512-vaY0obB6Om/fso8a8vakQBzwholQ7v5+uy+tF3Ozvxv1KNezmVQAiWtcNmMHFSFPqL3dJA8ha6gdtFbfX9mcxA==\n-  dependencies:\n-    chownr \"^1.1.1\"\n-    mkdirp \"^0.5.1\"\n-    pump \"^3.0.0\"\n-    tar-stream \"^2.0.0\"\n-\n tar-fs@2.1.1:\n   version \"2.1.1\"\n   resolved \"https://registry.yarnpkg.com/tar-fs/-/tar-fs-2.1.1.tgz#489a15ab85f1f0befabb370b7de4f9eb5cbe8784\"\n@@ -13331,7 +13280,7 @@ tar-fs@2.1.1:\n     pump \"^3.0.0\"\n     tar-stream \"^2.1.4\"\n \n-tar-stream@^2.0.0, tar-stream@^2.1.4, tar-stream@^2.2.0, tar-stream@~2.2.0:\n+tar-stream@^2.1.4, tar-stream@^2.2.0, tar-stream@~2.2.0:\n   version \"2.2.0\"\n   resolved \"https://registry.yarnpkg.com/tar-stream/-/tar-stream-2.2.0.tgz#acad84c284136b060dc3faa64474aa9aebd77287\"\n   integrity sha512-ujeqbceABgwMZxEJnk2HDY2DlnUZ+9oEcb1KzTVfYHio0UE6dG71n60d8D2I4qNvleWrrXpmjpt7vZeF1LnMZQ==\n@@ -13837,14 +13786,6 @@ unbox-primitive@^1.0.2:\n     has-symbols \"^1.0.3\"\n     which-boxed-primitive \"^1.0.2\"\n \n-unbzip2-stream@1.3.3:\n-  version \"1.3.3\"\n-  resolved \"https://registry.yarnpkg.com/unbzip2-stream/-/unbzip2-stream-1.3.3.tgz#d156d205e670d8d8c393e1c02ebd506422873f6a\"\n-  integrity sha512-fUlAF7U9Ah1Q6EieQ4x4zLNejrRvDWUYmxXUpN3uziFYCHapjWFaCAnreY9bGgxzaMCFAPPpYNng57CypwJVhg==\n-  dependencies:\n-    buffer \"^5.2.1\"\n-    through \"^2.3.8\"\n-\n unbzip2-stream@1.4.3:\n   version \"1.4.3\"\n   resolved \"https://registry.yarnpkg.com/unbzip2-stream/-/unbzip2-stream-1.4.3.tgz#b0da04c4371311df771cdc215e87f2130991ace7\"\n@@ -14790,11 +14731,6 @@ write-file-atomic@^3.0.0:\n     signal-exit \"^3.0.2\"\n     typedarray-to-buffer \"^3.1.5\"\n \n-ws@7.4.6:\n-  version \"7.4.6\"\n-  resolved \"https://registry.yarnpkg.com/ws/-/ws-7.4.6.tgz#5654ca8ecdeee47c33a9a4bf6d28e2be2980377c\"\n-  integrity sha512-YmhHDO4MzaDLB+M9ym/mDA5z0naX8j7SIlT8f8z+I0VtzsRbekxEutHSme7NPS2qE8StCYQNUnfWdXta/Yu85A==\n-\n ws@8.5.0:\n   version \"8.5.0\"\n   resolved \"https://registry.yarnpkg.com/ws/-/ws-8.5.0.tgz#bfb4be96600757fe5382de12c670dab984a1ed4f\"\n\n\n###\n\n", "completion": "build(bazel): run aio app tests with bazel-provided chromium"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -1,5 +1,5 @@\n load(\"@aio_npm//@angular-devkit/architect-cli:index.bzl\", \"architect\", \"architect_test\")\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"npm_package_bin\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"nodejs_binary\", \"npm_package_bin\")\n load(\"@aspect_bazel_lib//lib:copy_to_directory.bzl\", \"copy_to_directory\")\n \n # The write_source_files macro is used to write bazel outputs to the source tree and test that they are up to date.\n@@ -59,6 +59,14 @@ DGENI_FILES = [\n     \"//packages:files_for_docgen\",\n ]\n \n+# Sources needed to produce a fast low-fi dgeni build\n+DGENI_FASTSERVE_FILES = [\n+    \"//aio/content\",\n+    \"//aio/content/examples\",\n+    \"//:package.json\",\n+    \"//packages:files_for_docgen\",\n+]\n+\n # Run dgeni generation\n npm_package_bin(\n     name = \"dgeni\",\n@@ -216,6 +224,7 @@ architect_test(\n     data = TEST_FILES + TEST_DEPS,\n )\n \n+# Build and serve the app. Run with ibazel to watch for changes and re-serve.\n architect(\n     name = \"serve\",\n     args = [\n@@ -225,3 +234,25 @@ architect(\n     data = APPLICATION_DEPS + APPLICATION_FILES,\n     tags = [\"ibazel_notify_changes\"],\n )\n+\n+# Build and serve the app, watch for changes, and run a fast but low-fidelity\n+# rebuild when docs change. Watching and serving is a part of the node script,\n+# so there is no need to run with ibazel, which would be slow as it would redo\n+# the full dgeni build on each change.\n+nodejs_binary(\n+    name = \"fast-serve\",\n+    chdir = package_name(),\n+    data = APPLICATION_DEPS + APPLICATION_FILES + DGENI_FASTSERVE_FILES + [\n+        \"//aio/scripts:fast-serve-and-watch\",\n+    ],\n+    entry_point = \"//aio/scripts:fast-serve-and-watch.js\",\n+    env = {\n+        # Have the authors package output its low-fi dgeni build\n+        # to a different directory in the runfiles tree because bazel\n+        # write-protects original dgeni runfiles. Then in angular.json\n+        # we list this folder last under assets so that it will\n+        # take precedence over the original dgeni assets, effectively\n+        # overwriting select sources and then serving them.\n+        \"BAZEL_DGENI_OUTPUT_PATH\": \"dgeni-fast\",\n+    },\n+)\n\n---\n file path A: aio/angular.json | file path B: aio/angular.json\n\n@@ -51,17 +51,22 @@\n               \"src/pwa-manifest.json\",\n               \"src/google385281288605d160.html\",\n               {\n-                \"input\": \"dgeni/generated\",\n+                \"input\": \"stackblitz/generated\",\n                 \"output\": \"generated\",\n                 \"glob\": \"**\"\n               },\n               {\n-                \"input\": \"stackblitz/generated\",\n+                \"input\": \"example-zips/generated\",\n                 \"output\": \"generated\",\n                 \"glob\": \"**\"\n               },\n               {\n-                \"input\": \"example-zips/generated\",\n+                \"input\": \"dgeni/generated\",\n+                \"output\": \"generated\",\n+                \"glob\": \"**\"\n+              },\n+              {\n+                \"input\": \"dgeni-fast/generated\",\n                 \"output\": \"generated\",\n                 \"glob\": \"**\"\n               }\n\n---\n file path A: aio/scripts/BUILD.bazel | file path B: aio/scripts/BUILD.bazel\n\n@@ -1,4 +1,4 @@\n-load(\"//tools:defaults.bzl\", \"nodejs_binary\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\", \"nodejs_binary\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -12,3 +12,14 @@ nodejs_binary(\n     ],\n     entry_point = \"build-ngsw-config.js\",\n )\n+\n+js_library(\n+    name = \"fast-serve-and-watch\",\n+    srcs = [\n+        \"fast-serve-and-watch.js\",\n+    ],\n+    deps = [\n+        \"//aio/tools/transforms/authors-package:watchdocs\",\n+        \"@aio_npm//@angular-devkit/architect-cli\",\n+    ],\n+)\n\n---\n file path A: None | file path B: aio/scripts/fast-serve-and-watch.js\n\n@@ -0,0 +1,21 @@\n+/*\n+    This script serves the aio app, watches for changes,\n+    and runs a fast dgeni build on any changed files.\n+*/\n+\n+const spawn = require(\"cross-spawn\");\n+const watchr = require(\"../tools/transforms/authors-package/watchr.js\");\n+const architectCli = require.resolve(\"@angular-devkit/architect-cli/bin/architect\");\n+\n+const serve = spawn(architectCli, [\"site:serve\"], {stdio: \"inherit\"});\n+serve.on(\"error\", error => {\n+    console.error(\"architect serve script failed\");\n+    console.error(error);\n+    process.exit(1);\n+});\n+serve.on(\"close\", code => {\n+    console.error(`architect serve script exited with code ${code}`);\n+    process.exit(1);\n+})\n+\n+watchr.watch(true);\n\\ No newline at end of file\n\n---\n file path A: aio/tools/transforms/BUILD.bazel | file path B: aio/tools/transforms/BUILD.bazel\n\n@@ -12,8 +12,6 @@ filegroup(\n         exclude = [\n             \"test.js\",\n             \"**/*.spec.js\",\n-            # Used only for fast dgeni builds, not required for the high-fidelity dgeni build\n-            \"authors-package\",\n         ],\n     ),\n )\n\n---\n file path A: None | file path B: aio/tools/transforms/authors-package/BUILD.bazel\n\n@@ -0,0 +1,26 @@\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n+\n+package(default_visibility = [\"//visibility:public\"])\n+\n+js_library(\n+    name = \"watchdocs\",\n+    srcs = [\n+        \"api-package.js\",\n+        \"base-authoring-package.js\",\n+        \"errors-package.js\",\n+        \"extended-diagnostics-package.js\",\n+        \"getting-started-package.js\",\n+        \"guide-package.js\",\n+        \"index.js\",\n+        \"marketing-package.js\",\n+        \"tutorial-package.js\",\n+        \"utils.js\",\n+        \"watchr.js\",\n+    ],\n+    deps = [\n+        \"//aio/tools/transforms\",\n+        \"@aio_npm//canonical-path\",\n+        \"@aio_npm//dgeni\",\n+        \"@aio_npm//watchr\",\n+    ],\n+)\n\n---\n file path A: aio/tools/transforms/authors-package/watchr.js | file path B: aio/tools/transforms/authors-package/watchr.js\n\n@@ -20,32 +20,16 @@ function next(error) {\n   }\n }\n \n-let p = Promise.resolve();\n+function watch() {\n+    console.log('============================================================================');\n+    console.log('Started watching files in:');\n+    console.log(' - ', CONTENTS_PATH);\n+    console.log(' - ', API_SOURCE_PATH);\n+    console.log('Doc gen will automatically run on any change to a file in either directory.');\n+    console.log('============================================================================');\n \n-if (process.argv.indexOf('--watch-only') === -1) {\n-  console.log('================================================================');\n-  console.log('Running initial doc generation');\n-  console.log('----------------------------------------------------------------');\n-  console.log('Skip the full doc-gen by running: `yarn docs-watch --watch-only`');\n-  console.log('================================================================');\n-  const {Dgeni} = require('dgeni');\n-  const dgeni = new Dgeni([\n-    // The base-authoring-package will turn off potential failures for this doc-gen one-off run.\n-    // This enables authors to run `docs-watch` while the docs are still in an unstable state.\n-    require('./base-authoring-package'),\n-    require('../angular.io-package')]);\n-  p = dgeni.generate();\n+    watchr.open(CONTENTS_PATH, listener, next);\n+    watchr.open(API_SOURCE_PATH, listener, next);\n }\n \n-p.then(() => {\n-  console.log('===================================================================');\n-  console.log('Started watching files in:');\n-  console.log(' - ', CONTENTS_PATH);\n-  console.log(' - ', API_SOURCE_PATH);\n-  console.log('Doc gen will run when you change a file in either of these folders.');\n-  console.log('===================================================================');\n-\n-  watchr.open(CONTENTS_PATH, listener, next);\n-  watchr.open(API_SOURCE_PATH, listener, next);\n-\n-});\n+exports.watch = watch;\n\\ No newline at end of file\n\n\n###\n\n", "completion": "build(bazel): add an aio fast serve target"}
{"prompt": " file path A: aio/BUILD.bazel | file path B: aio/BUILD.bazel\n\n@@ -34,6 +34,9 @@ APPLICATION_FILES = [\n     \"tsconfig.app.json\",\n     \"tsconfig.json\",\n     \"tsconfig.worker.json\",\n+    \"//aio/src/assets\",\n+    \"//aio/src/assets/js\",\n+    \":dgeni\",\n ] + glob(\n     [\"src/**/*\"],\n     exclude = [\n@@ -137,12 +140,11 @@ DGENI_DEPS = [\n ]\n \n # All transforms and sources needed by dgeni to produce docs\n-DGENI_FILES = glob([\n-    \"content/**\",\n-    \"src/assets/**\",\n-    \"tools/transforms/**\",\n-]) + [\n+DGENI_FILES = [\n     \"@angular_cli_src//:files_for_docgen\",  # Downloaded cli snapshot (see WORKSPACE)\n+    \"//aio/content\",\n+    \"//aio/src/assets\",\n+    \"//aio/tools/transforms\",\n     \"//:package.json\",\n     \"//packages:files_for_docgen\",\n ]\n@@ -159,3 +161,13 @@ npm_package_bin(\n     output_dir = True,\n     tool = \"@aio_npm//dgeni/bin:dgeni\",\n )\n+\n+architect(\n+    name = \"serve\",\n+    args = [\n+        \"site:serve\",\n+    ],\n+    chdir = package_name(),\n+    data = APPLICATION_DEPS + APPLICATION_FILES,\n+    tags = [\"ibazel_notify_changes\"],\n+)\n\n---\n file path A: aio/angular.json | file path B: aio/angular.json\n\n@@ -51,7 +51,7 @@\n               \"src/pwa-manifest.json\",\n               \"src/google385281288605d160.html\",\n               {\n-                \"input\": \"src/generated\",\n+                \"input\": \"dgeni/generated\",\n                 \"output\": \"generated\",\n                 \"glob\": \"**\"\n               }\n\n---\n file path A: None | file path B: aio/content/BUILD.bazel\n\n@@ -0,0 +1,9 @@\n+package(default_visibility = [\"//visibility:public\"])\n+\n+filegroup(\n+    name = \"content\",\n+    srcs = glob(\n+        [\"**\"],\n+        exclude = [\"BUILD.bazel\"],\n+    ),\n+)\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -114,8 +114,8 @@\n     \"@angular/cli\": \"15.0.0-rc.0\",\n     \"@angular/compiler-cli\": \"15.0.0-rc.0\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n+    \"@bazel/typescript\": \"5.3.1\",\n     \"@types/jasmine\": \"~4.3.0\",\n-    \"@bazel/typescript\": \"4.6.2\",\n     \"@types/lunr\": \"^2.3.3\",\n     \"@types/node\": \"^12.7.9\",\n     \"@types/trusted-types\": \"^2.0.2\",\n\n---\n file path A: None | file path B: aio/src/assets/BUILD.bazel\n\n@@ -0,0 +1,9 @@\n+package(default_visibility = [\"//visibility:public\"])\n+\n+filegroup(\n+    name = \"assets\",\n+    srcs = glob([\n+        \"images/**\",\n+        \"opensearch.xml\",\n+    ]),\n+)\n\n---\n file path A: None | file path B: aio/src/assets/js/BUILD.bazel\n\n@@ -0,0 +1,6 @@\n+package(default_visibility = [\"//visibility:public\"])\n+\n+filegroup(\n+    name = \"js\",\n+    srcs = [\"prettify.js\"],\n+)\n\n---\n file path A: None | file path B: aio/tools/transforms/BUILD.bazel\n\n@@ -0,0 +1,19 @@\n+package(default_visibility = [\"//visibility:public\"])\n+\n+filegroup(\n+    name = \"transforms\",\n+    srcs = glob(\n+        [\n+            \"**/*.js\",\n+            \"**/*.html\",\n+            \"**/*.json\",\n+            \"**/*.xml\",\n+        ],\n+        exclude = [\n+            \"test.js\",\n+            \"**/*.spec.js\",\n+            # Used only for fast dgeni builds, not required for the high-fidelity dgeni build\n+            \"authors-package\",\n+        ],\n+    ),\n+)\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -1502,21 +1502,21 @@\n   resolved \"https://registry.yarnpkg.com/@bazel/bazelisk/-/bazelisk-1.12.0.tgz#f08aebbf4afcb12684422450b0845dd6ef5cfe50\"\n   integrity sha512-7oQusq1e4AIyFgotxVV7Pc40Et0QyvoVjujL+7/qV5Vrbfh0Nj3CfqSgl63weEyI4r0+K6RlGVsjfRuBi05p5w==\n \n-\"@bazel/typescript@4.6.2\":\n-  version \"4.6.2\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/typescript/-/typescript-4.6.2.tgz#9f07b6f8cfb6b0a0e228e5971de412911c910a90\"\n-  integrity sha512-AUF7kq82bP6DX9Brihr/eQqvNccxVfSXosFxt80h94og5cmMyoc/euXha6rxlOBP3yWXmSo+/qjzO7o8PWJduQ==\n+\"@bazel/typescript@5.3.1\":\n+  version \"5.3.1\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/typescript/-/typescript-5.3.1.tgz#f996abebfa57a29a170a83d0c84780286f06cb72\"\n+  integrity sha512-fP0fGzLbsOVdbAn6mlrX1LBAT0TJ+S0VVOap9SSSXCb2PknnKEHZupUww/raVSczy+cqcd/Vfpllzm/AcdOmyw==\n   dependencies:\n-    \"@bazel/worker\" \"4.6.2\"\n+    \"@bazel/worker\" \"5.3.1\"\n     protobufjs \"6.8.8\"\n     semver \"5.6.0\"\n     source-map-support \"0.5.9\"\n     tsutils \"3.21.0\"\n \n-\"@bazel/worker@4.6.2\":\n-  version \"4.6.2\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/worker/-/worker-4.6.2.tgz#0bd105344533335327c2edfa3fc65b04c39cdea8\"\n-  integrity sha512-DLpN6iQAH6uiUraAs4CESyqs60u55fcKmYgOOVObGuLSQQuX49Lw7XRIN90NibRPwpbBDQichWE3zfra0yKTTw==\n+\"@bazel/worker@5.3.1\":\n+  version \"5.3.1\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/worker/-/worker-5.3.1.tgz#87d850fdfc22cde24f380961f66daa5cbfd4acf7\"\n+  integrity sha512-KB+Xs198NLhN01zhlOPr/VEmz/tzwGq/pI1gdnCTLDMTCspV6LnJaIeGgicXuKrzz0V1LhvlvsI5lqJt9yuGYw==\n   dependencies:\n     google-protobuf \"^3.6.1\"\n \n\n\n###\n\n", "completion": "build(bazel): add a bazel aio serve target"}
{"prompt": " file path A: aio/content/guide/update-to-version-15.md | file path B: aio/content/guide/update-to-version-15.md\n\n@@ -201,7 +201,7 @@ To maintain the reliability of your Angular application, review these notes and\n \n | Removed | Replacement | Details |\n | :--- | :--- |:--- |\n-| <a id=\"v15-dp-01\"></a>`DATE_PIPE_DEFAULT_TIMEZONE`](api/common/DATE_PIPE_DEFAULT_TIMEZONE) | [`DATE_PIPE_DEFAULT_OPTIONS`](api/common/DATE_PIPE_DEFAULT_OPTIONS) | The `timezone` field in `DATE_PIPE_DEFAULT_OPTIONS` defines the time zone.<br>[PR #43611](https://github.com/angular/angular/pull/43611) |\n+| <a id=\"v15-dp-01\"></a>[`DATE_PIPE_DEFAULT_TIMEZONE`](api/common/DATE_PIPE_DEFAULT_TIMEZONE) | [`DATE_PIPE_DEFAULT_OPTIONS`](api/common/DATE_PIPE_DEFAULT_OPTIONS) | The `timezone` field in `DATE_PIPE_DEFAULT_OPTIONS` defines the time zone.<br>[PR #43611](https://github.com/angular/angular/pull/43611) |\n | <a id=\"v15-dp-02\"></a>[`Injector.get()`](api/core/Injector#get) with the `InjectFlags` parameter | [`Injector.get()`](api/core/Injector#get) with the `InjectOptions` object | [PR #41592](https://github.com/angular/angular/pull/41592) |\n | <a id=\"v15-dp-03\"></a>[`TestBed.inject()`](api/core/testing/TestBed#inject) with the `InjectFlags` parameter | [`TestBed.inject()`](api/core/testing/TestBed#inject) with the `InjectOptions` object.| [PR #46761](https://github.com/angular/angular/pull/46761) |\n | <a id=\"v15-dp-04\"></a>`providedIn: NgModule` for [`@Injectable`](api/core/Injectable) and [`InjectionToken`](api/core/InjectionToken)<br><a id=\"v15-dp-05\"></a>`providedIn: 'any'` for an `@Injectable` or `InjectionToken` | See Details | `providedIn: NgModule` was intended to be a tree-shakable alternative to `NgModule` providers. It does not have wide usage and is often used incorrectly in cases where `providedIn: 'root'` would be preferred. If providers must be scoped to a specific [`NgModule`](api/core/NgModule), use `NgModule.providers` instead. [PR #47616](https://github.com/angular/angular/pull/47616)|\n\n\n###\n\n", "completion": "docs: fix broken link in v15 deprecations table (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/doc-prepare-to-edit.md | file path B: aio/content/guide/doc-prepare-to-edit.md\n\n@@ -49,6 +49,7 @@ For more information about the required software, see [Setting up the local envi\n \n         Angular requires an [active long-term-support (LTS) or maintenance LTS version](https://nodejs.org/about/releases) of Node.js.\n \n+    *   [nvm](https://github.com/nvm-sh/nvm#about)\n     *   [Yarn](https://yarnpkg.com/getting-started/install)\n     *   [Homebrew](https://brew.sh) for macOS or [Chocolatey](https://chocolatey.org/install) for Windows\n     *   [Vale][GithubAngularAngularTreeMainAioToolsDocLinterInstallValeOnYourDevelopmentSystemReadmeMd] \\(see note\\)\n@@ -277,11 +278,11 @@ After you clone the origin repo on your local computer, run these commands from\n \n         <code-example format=\"shell\" language=\"shell\">\n \n-        cd personal/angular/aio\n+        cd personal/angular\n \n         </code-example>\n \n-    1.  Run this command to install the npm modules.\n+    1.  Run this command to install the Angular dependencies.\n \n         <code-example format=\"shell\" language=\"shell\">\n \n@@ -289,6 +290,22 @@ After you clone the origin repo on your local computer, run these commands from\n \n         </code-example>\n \n+    1.  Run this command to navigate to the documentation project.\n+\n+        <code-example format=\"shell\" language=\"shell\">\n+\n+        cd aio\n+\n+        </code-example>\n+\n+    1.  Run this command to install the npm modules for the documentation.\n+\n+        <code-example format=\"shell\" language=\"shell\">\n+\n+        yarn setup\n+\n+        </code-example>\n+\n 1.  Locate `angular/aio/tools/doc-linter/vale.ini` in your working directory to use in the next step as the path to the configuration file in the  **Vale:Config** setting.\n \n 1.  [Install Vale][GithubAngularAngularTreeMainAioToolsDocLinterInstallValeOnYourDevelopmentSystemReadmeMd] to complete the software installation.\n\n---\n file path A: aio/ngsw-config.json | file path B: aio/ngsw-config.json\n\n@@ -130,9 +130,11 @@\n     \"!/guide/set-document-title/{0,1}\",\n     \"!/guide/setup-systemjs-anatomy/{0,1}\",\n     \"!/guide/setup/{0,1}\",\n+    \"!/guide/update-to-latest-version/{0,1}\",\n     \"!/guide/updating-to-version-10/{0,1}\",\n     \"!/guide/updating-to-version-11/{0,1}\",\n     \"!/guide/updating-to-version-12/{0,1}\",\n+    \"!/guide/updating-to-version-13/{0,1}\",\n     \"!/guide/webpack/{0,1}\",\n     \"!/guide/{0,1}\",\n     \"!/news*\",\n\n\n###\n\n", "completion": "docs: add missing documentation setup instructions (#<issue-num>)"}
{"prompt": " file path A: packages/forms/src/model/abstract_model.ts | file path B: packages/forms/src/model/abstract_model.ts\n\n@@ -685,7 +685,7 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n    * const minValidator = Validators.min(3);\n    * const ctrl = new FormControl<string | null>('', minValidator);\n    * expect(ctrl.hasValidator(minValidator)).toEqual(true)\n-   * expect(ctrl.hasValidator(Validators.min(3)).toEqual(false)\n+   * expect(ctrl.hasValidator(Validators.min(3))).toEqual(false)\n    *\n    * ctrl.removeValidators(minValidator);\n    * ```\n@@ -731,7 +731,7 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n    * const minValidator = Validators.min(3);\n    * const ctrl = new FormControl<number | null>(0, minValidator);\n    * expect(ctrl.hasValidator(minValidator)).toEqual(true)\n-   * expect(ctrl.hasValidator(Validators.min(3)).toEqual(false)\n+   * expect(ctrl.hasValidator(Validators.min(3))).toEqual(false)\n    * ```\n    *\n    * @param validator The validator to check for presence. Compared by function reference.\n\n\n###\n\n", "completion": "docs(forms): fix typos in removeValidators and hasValidator usage notes (#<issue-num>)"}
{"prompt": " file path A: packages/platform-browser/src/dom/dom_renderer.ts | file path B: packages/platform-browser/src/dom/dom_renderer.ts\n\n@@ -75,8 +75,6 @@ function decoratePreventDefault(eventHandler: Function): Function {\n   };\n }\n \n-let hasLoggedNativeEncapsulationWarning = false;\n-\n @Injectable()\n export class DomRendererFactory2 implements RendererFactory2 {\n   private rendererByCompId = new Map<string, Renderer2>();\n@@ -103,21 +101,7 @@ export class DomRendererFactory2 implements RendererFactory2 {\n         (<EmulatedEncapsulationDomRenderer2>renderer).applyToHost(element);\n         return renderer;\n       }\n-      // @ts-ignore TODO: Remove as part of FW-2290. TS complains about us dealing with an enum\n-      // value that is not known (but previously was the value for ViewEncapsulation.Native)\n-      case 1:\n       case ViewEncapsulation.ShadowDom:\n-        // TODO(FW-2290): remove the `case 1:` fallback logic and the warning in v12.\n-        if ((typeof ngDevMode === 'undefined' || ngDevMode) &&\n-            // @ts-ignore TODO: Remove as part of FW-2290. TS complains about us dealing with an\n-            // enum value that is not known (but previously was the value for\n-            // ViewEncapsulation.Native)\n-            !hasLoggedNativeEncapsulationWarning && type.encapsulation === 1) {\n-          hasLoggedNativeEncapsulationWarning = true;\n-          console.warn(\n-              'ViewEncapsulation.Native is no longer supported. Falling back to ViewEncapsulation.ShadowDom. The fallback will be removed in v12.');\n-        }\n-\n         return new ShadowDomRenderer(this.eventManager, this.sharedStylesHost, element, type);\n       default: {\n         if (!this.rendererByCompId.has(type.id)) {\n\n\n###\n\n", "completion": "refactor(platform-browser): Remove ViewEncapsulation.Native warning (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/directives/router_outlet.ts | file path B: packages/router/src/directives/router_outlet.ts\n\n@@ -321,7 +321,7 @@ export class RouterOutlet implements OnDestroy, OnInit, RouterOutletContract {\n     }\n     this._activatedRoute = activatedRoute;\n     const location = this.location;\n-    const snapshot = activatedRoute._futureSnapshot;\n+    const snapshot = activatedRoute.snapshot;\n     const component = snapshot.component!;\n     const childContexts = this.parentContexts.getOrCreateContext(this.name).children;\n     const injector = new OutletInjector(activatedRoute, childContexts, location.injector);\n\n\n###\n\n", "completion": "refactor(router): Update RouterOutlet to not read internal route property (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/provide_router.ts | file path B: packages/router/src/provide_router.ts\n\n@@ -314,7 +314,6 @@ export function withEnabledBlockingInitialNavigation(): EnabledBlockingInitialNa\n       useFactory: (injector: Injector) => {\n         const locationInitialized: Promise<any> =\n             injector.get(LOCATION_INITIALIZED, Promise.resolve());\n-        let initNavigation = false;\n \n         /**\n          * Performs the given action once the router finishes its next/current navigation.\n@@ -358,7 +357,6 @@ export function withEnabledBlockingInitialNavigation(): EnabledBlockingInitialNa\n                 // Unblock APP_INITIALIZER in case the initial navigation was canceled or errored\n                 // without a redirect.\n                 resolve(true);\n-                initNavigation = true;\n               });\n \n               router.afterPreactivation = () => {\n@@ -366,13 +364,7 @@ export function withEnabledBlockingInitialNavigation(): EnabledBlockingInitialNa\n                 // assume activation will complete successfully (even though this is not\n                 // guaranteed).\n                 resolve(true);\n-                // only the initial navigation should be delayed until bootstrapping is done.\n-                if (!initNavigation) {\n-                  return bootstrapDone.closed ? of(void 0) : bootstrapDone;\n-                  // subsequent navigations should not be delayed\n-                } else {\n-                  return of(void 0);\n-                }\n+                return bootstrapDone.closed ? of(void 0) : bootstrapDone;\n               };\n               router.initialNavigation();\n             });\n\n---\n file path A: packages/router/test/bootstrap.spec.ts | file path B: packages/router/test/bootstrap.spec.ts\n\n@@ -152,8 +152,9 @@ describe('bootstrap', () => {\n        class TestModule {\n        }\n \n-       await Promise.all(\n-           [platformBrowserDynamic([]).bootstrapModule(TestModule), navigationEndPromise]);\n+       await expectAsync(Promise.all([\n+         platformBrowserDynamic([]).bootstrapModule(TestModule), navigationEndPromise\n+       ])).toBeResolved();\n      });\n \n   it('should wait for redirect when initialNavigation = enabledBlocking', async () => {\n\n\n###\n\n", "completion": "refactor(router): Remove unnecessary logic in enabledBlocking option (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/releases.md | file path B: aio/content/guide/releases.md\n\n@@ -129,8 +129,8 @@ The following table provides the status for Angular versions under support.\n \n | Version | Status | Released   | Active ends | LTS ends   |\n |:---     |:---    |:---        |:---         |:---        |\n-| ^15.0.0 | Active | 2022-11-18 | 2022-05-18  | 2023-05-18 |\n-| ^14.0.0 | LTS    | 2022-06-02 | 2022-12-02  | 2023-11-18 |\n+| ^15.0.0 | Active | 2022-11-18 | 2023-05-18  | 2024-05-18 |\n+| ^14.0.0 | LTS    | 2022-06-02 | 2022-11-18  | 2023-11-18 |\n | ^13.0.0 | LTS    | 2021-11-04 | 2022-06-02  | 2023-05-04 |\n \n Angular versions v2 to v12 are no longer under support.\n\n\n###\n\n", "completion": "docs: fix dates in release guide (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/typecheck/api/api.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/api/api.ts\n\n@@ -10,9 +10,8 @@ import {AbsoluteSourceSpan, BoundTarget, DirectiveMeta, ParseSourceSpan, SchemaM\n import ts from 'typescript';\n \n import {ErrorCode} from '../../diagnostics';\n-import {AbsoluteFsPath} from '../../file_system';\n import {Reference} from '../../imports';\n-import {ClassPropertyMapping, DirectiveTypeCheckMeta} from '../../metadata';\n+import {ClassPropertyMapping, DirectiveTypeCheckMeta, HostDirectiveMeta} from '../../metadata';\n import {ClassDeclaration} from '../../reflection';\n \n \n@@ -26,6 +25,7 @@ export interface TypeCheckableDirectiveMeta extends DirectiveMeta, DirectiveType\n   inputs: ClassPropertyMapping;\n   outputs: ClassPropertyMapping;\n   isStandalone: boolean;\n+  hostDirectives: HostDirectiveMeta[]|null;\n }\n \n export type TemplateId = string&{__brand: 'TemplateId'};\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/api/symbols.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/api/symbols.ts\n\n@@ -258,11 +258,8 @@ export interface TemplateSymbol {\n   templateNode: TmplAstTemplate;\n }\n \n-/**\n- * A representation of a directive/component whose selector matches a node in a component\n- * template.\n- */\n-export interface DirectiveSymbol extends PotentialDirective {\n+/** Interface shared between host and non-host directives. */\n+interface DirectiveSymbolBase extends PotentialDirective {\n   kind: SymbolKind.Directive;\n \n   /** The `ts.Type` for the class declaration. */\n@@ -272,6 +269,16 @@ export interface DirectiveSymbol extends PotentialDirective {\n   tcbLocation: TcbLocation;\n }\n \n+/**\n+ * A representation of a directive/component whose selector matches a node in a component\n+ * template.\n+ */\n+export type DirectiveSymbol = (DirectiveSymbolBase&{isHostDirective: false})|(DirectiveSymbolBase&{\n+  isHostDirective: true;\n+  exposedInputs: Record<string, string>|null;\n+  exposedOutputs: Record<string, string>|null;\n+});\n+\n /**\n  * A representation of an attribute on an element or template. These bindings aren't currently\n  * type-checked (see `checkTypeOfDomBindings`) so they won't have a `ts.Type`, `ts.Symbol`, or shim\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/src/template_symbol_builder.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/src/template_symbol_builder.ts\n\n@@ -11,6 +11,7 @@ import ts from 'typescript';\n \n import {AbsoluteFsPath} from '../../file_system';\n import {Reference} from '../../imports';\n+import {HostDirectiveMeta} from '../../metadata';\n import {ClassDeclaration} from '../../reflection';\n import {ComponentScopeKind, ComponentScopeReader} from '../../scope';\n import {isAssignment, isSymbolWithValueDeclaration} from '../../util/src/typescript';\n@@ -118,38 +119,80 @@ export class SymbolBuilder {\n \n     const nodes = findAllMatchingNodes(\n         this.typeCheckBlock, {withSpan: elementSourceSpan, filter: isDirectiveDeclaration});\n-    return nodes\n-        .map(node => {\n-          const symbol = this.getSymbolOfTsNode(node.parent);\n-          if (symbol === null || !isSymbolWithValueDeclaration(symbol.tsSymbol) ||\n-              !ts.isClassDeclaration(symbol.tsSymbol.valueDeclaration)) {\n-            return null;\n-          }\n-          const meta = this.getDirectiveMeta(element, symbol.tsSymbol.valueDeclaration);\n-          if (meta === null) {\n-            return null;\n-          }\n-\n-          const ngModule = this.getDirectiveModule(symbol.tsSymbol.valueDeclaration);\n-          if (meta.selector === null) {\n-            return null;\n-          }\n-          const isComponent = meta.isComponent ?? null;\n-          const ref = new Reference<ClassDeclaration>(symbol.tsSymbol.valueDeclaration as any);\n-          const directiveSymbol: DirectiveSymbol = {\n-            ...symbol,\n-            ref,\n-            tsSymbol: symbol.tsSymbol,\n-            selector: meta.selector,\n-            isComponent,\n-            ngModule,\n-            kind: SymbolKind.Directive,\n-            isStructural: meta.isStructural,\n-            isInScope: true,\n-          };\n-          return directiveSymbol;\n-        })\n-        .filter((d): d is DirectiveSymbol => d !== null);\n+    const symbols: DirectiveSymbol[] = [];\n+\n+    for (const node of nodes) {\n+      const symbol = this.getSymbolOfTsNode(node.parent);\n+      if (symbol === null || !isSymbolWithValueDeclaration(symbol.tsSymbol) ||\n+          !ts.isClassDeclaration(symbol.tsSymbol.valueDeclaration)) {\n+        continue;\n+      }\n+\n+      const meta = this.getDirectiveMeta(element, symbol.tsSymbol.valueDeclaration);\n+\n+      if (meta !== null && meta.selector !== null) {\n+        const ref = new Reference<ClassDeclaration>(symbol.tsSymbol.valueDeclaration as any);\n+\n+        if (meta.hostDirectives !== null) {\n+          this.addHostDirectiveSymbols(element, meta.hostDirectives, symbols);\n+        }\n+\n+        const directiveSymbol: DirectiveSymbol = {\n+          ...symbol,\n+          ref,\n+          tsSymbol: symbol.tsSymbol,\n+          selector: meta.selector,\n+          isComponent: meta.isComponent,\n+          ngModule: this.getDirectiveModule(symbol.tsSymbol.valueDeclaration),\n+          kind: SymbolKind.Directive,\n+          isStructural: meta.isStructural,\n+          isInScope: true,\n+          isHostDirective: false,\n+        };\n+\n+        symbols.push(directiveSymbol);\n+      }\n+    }\n+\n+    return symbols;\n+  }\n+\n+  private addHostDirectiveSymbols(\n+      host: TmplAstTemplate|TmplAstElement, hostDirectives: HostDirectiveMeta[],\n+      symbols: DirectiveSymbol[]): void {\n+    for (const current of hostDirectives) {\n+      if (!ts.isClassDeclaration(current.directive.node)) {\n+        continue;\n+      }\n+\n+      const symbol = this.getSymbolOfTsNode(current.directive.node);\n+      const meta = this.getDirectiveMeta(host, current.directive.node);\n+\n+      if (meta !== null && symbol !== null && isSymbolWithValueDeclaration(symbol.tsSymbol)) {\n+        if (meta.hostDirectives !== null) {\n+          this.addHostDirectiveSymbols(host, meta.hostDirectives, symbols);\n+        }\n+\n+        const directiveSymbol: DirectiveSymbol = {\n+          ...symbol,\n+          isHostDirective: true,\n+          ref: current.directive,\n+          tsSymbol: symbol.tsSymbol,\n+          exposedInputs: current.inputs,\n+          exposedOutputs: current.outputs,\n+          // TODO(crisbeto): rework `DirectiveSymbol` to make\n+          // `selector` nullable and remove the `|| ''` here.\n+          selector: meta.selector || '',\n+          isComponent: meta.isComponent,\n+          ngModule: this.getDirectiveModule(current.directive.node),\n+          kind: SymbolKind.Directive,\n+          isStructural: meta.isStructural,\n+          isInScope: true,\n+        };\n+\n+        symbols.push(directiveSymbol);\n+      }\n+    }\n   }\n \n   private getDirectiveMeta(\n@@ -376,6 +419,7 @@ export class SymbolBuilder {\n       isStructural,\n       selector,\n       ngModule,\n+      isHostDirective: false,\n       isInScope: true,  // TODO: this should always be in scope in this context, right?\n     };\n   }\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/testing/index.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/testing/index.ts\n\n@@ -228,7 +228,7 @@ export interface TestDirective extends Partial<Pick<\n     Exclude<\n         keyof TypeCheckableDirectiveMeta,\n         'ref'|'coercedInputFields'|'restrictedInputFields'|'stringLiteralInputFields'|\n-        'undeclaredInputFields'|'inputs'|'outputs'>>> {\n+        'undeclaredInputFields'|'inputs'|'outputs'|'hostDirectives'>>> {\n   selector: string;\n   name: string;\n   file?: AbsoluteFsPath;\n\n---\n file path A: packages/language-service/src/attribute_completions.ts | file path B: packages/language-service/src/attribute_completions.ts\n\n@@ -220,7 +220,18 @@ export function buildAttributeCompletionTable(\n         continue;\n       }\n \n-      for (const [classPropertyName, propertyName] of meta.inputs) {\n+      for (const [classPropertyName, rawProperyName] of meta.inputs) {\n+        let propertyName: string;\n+\n+        if (dirSymbol.isHostDirective) {\n+          if (!dirSymbol.exposedInputs?.hasOwnProperty(rawProperyName)) {\n+            continue;\n+          }\n+          propertyName = dirSymbol.exposedInputs[rawProperyName];\n+        } else {\n+          propertyName = rawProperyName;\n+        }\n+\n         if (table.has(propertyName)) {\n           continue;\n         }\n@@ -234,7 +245,18 @@ export function buildAttributeCompletionTable(\n         });\n       }\n \n-      for (const [classPropertyName, propertyName] of meta.outputs) {\n+      for (const [classPropertyName, rawProperyName] of meta.outputs) {\n+        let propertyName: string;\n+\n+        if (dirSymbol.isHostDirective) {\n+          if (!dirSymbol.exposedOutputs?.hasOwnProperty(rawProperyName)) {\n+            continue;\n+          }\n+          propertyName = dirSymbol.exposedOutputs[rawProperyName];\n+        } else {\n+          propertyName = rawProperyName;\n+        }\n+\n         if (table.has(propertyName)) {\n           continue;\n         }\n\n---\n file path A: packages/language-service/test/completions_spec.ts | file path B: packages/language-service/test/completions_spec.ts\n\n@@ -613,6 +613,129 @@ describe('completions', () => {\n               completions, unsafeCastDisplayInfoKindToScriptElementKind(DisplayInfoKind.PROPERTY),\n               ['myInput']);\n         });\n+\n+        it('should return completion for input coming from a host directive', () => {\n+          const {templateFile} = setup(`<input dir my>`, '', {\n+            'Dir': `\n+              @Directive({\n+                standalone: true,\n+                inputs: ['myInput']\n+              })\n+              export class HostDir {\n+                myInput = 'foo';\n+              }\n+\n+              @Directive({\n+                selector: '[dir]',\n+                hostDirectives: [{\n+                  directive: HostDir,\n+                  inputs: ['myInput']\n+                }]\n+              })\n+              export class Dir {\n+              }\n+             `\n+          });\n+          templateFile.moveCursorToText('my\u00a6>');\n+\n+          const completions = templateFile.getCompletionsAtPosition();\n+\n+          expectContain(\n+              completions, unsafeCastDisplayInfoKindToScriptElementKind(DisplayInfoKind.PROPERTY),\n+              ['[myInput]']);\n+        });\n+\n+        it('should not return completion for hidden host directive input', () => {\n+          const {templateFile} = setup(`<input dir my>`, '', {\n+            'Dir': `\n+              @Directive({\n+                standalone: true,\n+                inputs: ['myInput']\n+              })\n+              export class HostDir {\n+                myInput = 'foo';\n+              }\n+\n+              @Directive({\n+                selector: '[dir]',\n+                hostDirectives: [HostDir]\n+              })\n+              export class Dir {\n+              }\n+             `\n+          });\n+          templateFile.moveCursorToText('my\u00a6>');\n+\n+          const completions = templateFile.getCompletionsAtPosition();\n+\n+          expectDoesNotContain(\n+              completions, unsafeCastDisplayInfoKindToScriptElementKind(DisplayInfoKind.PROPERTY),\n+              ['[myInput]']);\n+        });\n+\n+        it('should return completion for aliased host directive input', () => {\n+          const {templateFile} = setup(`<input dir ali>`, '', {\n+            'Dir': `\n+              @Directive({\n+                standalone: true,\n+                inputs: ['myInput']\n+              })\n+              export class HostDir {\n+                myInput = 'foo';\n+              }\n+\n+              @Directive({\n+                selector: '[dir]',\n+                hostDirectives: [{\n+                  directive: HostDir,\n+                  inputs: ['myInput: alias']\n+                }]\n+              })\n+              export class Dir {\n+              }\n+             `\n+          });\n+          templateFile.moveCursorToText('ali\u00a6>');\n+\n+          const completions = templateFile.getCompletionsAtPosition();\n+\n+          expectContain(\n+              completions, unsafeCastDisplayInfoKindToScriptElementKind(DisplayInfoKind.PROPERTY),\n+              ['[alias]']);\n+        });\n+\n+        it('should return completion for aliased host directive input that has a different public name',\n+           () => {\n+             const {templateFile} = setup(`<input dir ali>`, '', {\n+               'Dir': `\n+                  @Directive({\n+                    standalone: true,\n+                    inputs: ['myInput: myPublicInput']\n+                  })\n+                  export class HostDir {\n+                    myInput = 'foo';\n+                  }\n+\n+                  @Directive({\n+                    selector: '[dir]',\n+                    hostDirectives: [{\n+                      directive: HostDir,\n+                      inputs: ['myPublicInput: alias']\n+                    }]\n+                  })\n+                  export class Dir {\n+                  }\n+             `\n+             });\n+             templateFile.moveCursorToText('ali\u00a6>');\n+\n+             const completions = templateFile.getCompletionsAtPosition();\n+\n+             expectContain(\n+                 completions,\n+                 unsafeCastDisplayInfoKindToScriptElementKind(DisplayInfoKind.PROPERTY),\n+                 ['[alias]']);\n+           });\n       });\n \n       describe('structural directive present', () => {\n@@ -868,6 +991,96 @@ describe('completions', () => {\n             completions, unsafeCastDisplayInfoKindToScriptElementKind(DisplayInfoKind.EVENT),\n             ['customModelChange']);\n       });\n+\n+      it('should return completion for output coming from a host directive', () => {\n+        const {templateFile} = setup(`<input dir (my)>`, '', {\n+          'Dir': `\n+            @Directive({\n+              standalone: true,\n+              outputs: ['myOutput']\n+            })\n+            export class HostDir {\n+              myOutput: any;\n+            }\n+\n+            @Directive({\n+              selector: '[dir]',\n+              hostDirectives: [{\n+                directive: HostDir,\n+                outputs: ['myOutput']\n+              }]\n+            })\n+            export class Dir {\n+            }\n+           `\n+        });\n+        templateFile.moveCursorToText('(my\u00a6)');\n+\n+        const completions = templateFile.getCompletionsAtPosition();\n+        expectContain(\n+            completions, unsafeCastDisplayInfoKindToScriptElementKind(DisplayInfoKind.EVENT),\n+            ['myOutput']);\n+        expectReplacementText(completions, templateFile.contents, 'my');\n+      });\n+\n+      it('should not return completion for hidden host directive output', () => {\n+        const {templateFile} = setup(`<input dir (my)>`, '', {\n+          'Dir': `\n+            @Directive({\n+              standalone: true,\n+              outputs: ['myOutput']\n+            })\n+            export class HostDir {\n+              myOutput: any;\n+            }\n+\n+            @Directive({\n+              selector: '[dir]',\n+              hostDirectives: [HostDir]\n+            })\n+            export class Dir {\n+            }\n+           `\n+        });\n+        templateFile.moveCursorToText('(my\u00a6)');\n+\n+        const completions = templateFile.getCompletionsAtPosition();\n+        expectDoesNotContain(\n+            completions, unsafeCastDisplayInfoKindToScriptElementKind(DisplayInfoKind.EVENT),\n+            ['myOutput']);\n+      });\n+\n+      it('should return completion for aliased host directive output that has a different public name',\n+         () => {\n+           const {templateFile} = setup(`<input dir (ali)>`, '', {\n+             'Dir': `\n+            @Directive({\n+              standalone: true,\n+              outputs: ['myOutput: myPublicOutput']\n+            })\n+            export class HostDir {\n+              myOutput: any;\n+            }\n+\n+            @Directive({\n+              selector: '[dir]',\n+              hostDirectives: [{\n+                directive: HostDir,\n+                outputs: ['myPublicOutput: alias']\n+              }]\n+            })\n+            export class Dir {\n+            }\n+           `\n+           });\n+           templateFile.moveCursorToText('(ali\u00a6)');\n+\n+           const completions = templateFile.getCompletionsAtPosition();\n+           expectContain(\n+               completions, unsafeCastDisplayInfoKindToScriptElementKind(DisplayInfoKind.EVENT),\n+               ['alias']);\n+           expectReplacementText(completions, templateFile.contents, 'ali');\n+         });\n     });\n   });\n \n\n\n###\n\n", "completion": "fix(language-service): correctly handle host directive inputs/outputs (#<issue-num>)"}
{"prompt": " file path A: aio/src/app/app.component.html | file path B: aio/src/app/app.component.html\n\n@@ -11,16 +11,11 @@\n <header>\n   <mat-toolbar #appToolbar color=\"primary\" class=\"app-toolbar no-print\" [class.transitioning]=\"isTransitioning\">\n     <mat-toolbar-row class=\"notification-container\">\n-      <aio-notification notificationId=\"war-ukraine\" expirationDate=\"2022-09-26\" [dismissOnContentClick]=\"false\" (dismissed)=\"notificationDismissed()\">\n-        <a class=\"link\" target=\"_blank\" rel=\"noopener\" href=\"https://www.google.org/ukraine-relief/\">\n-          <span class=\"title\">Support Ukraine</span>\n-        <mat-icon class=\"icon\" aria-label=\"Ukraine flag\">\n-          <svg height=\"24\" width=\"24\" version=\"1.1\" viewBox=\"0 0 240 240\" xmlns=\"http://www.w3.org/2000/svg\">\n-            <rect fill=\"#0057b7\" height=\"72\" width=\"240\" x=\"0\" y=\"48\"/>\n-            <rect fill=\"#ffd700\" height=\"72\" width=\"240\" x=\"0\" y=\"120\"/>\n-          </svg>\n-        </mat-icon>\n-          <span class=\"message\">Help Provide Humanitarian Aid to Ukraine.</span>\n+      <aio-notification notificationId=\"survey-november-2022\" expirationDate=\"2023-02-01\" [dismissOnContentClick]=\"true\" (dismissed)=\"notificationDismissed()\">\n+        <a href=\"https://survey.devographics.com/survey/state-of-js/2022\">\n+          <mat-icon class=\"icon\" svgIcon=\"insert_comment\" aria-label=\"Announcement\"></mat-icon>\n+          <span class=\"message\">Share your experience with Angular in <b>The State of JavaScript</b></span>\n+          <span class=\"action-button\">Go to survey</span>\n         </a>\n       </aio-notification>\n     </mat-toolbar-row>\n\n\n###\n\n", "completion": "docs: add state of javascript banner (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,17 @@\n+<a name=\"12.2.17\"></a>\n+# 12.2.17 (2022-11-21)\n+## Breaking Changes\n+### core\n+- Existing iframe usages may have security-sensitive attributes applied as an attribute or property binding in a template or via host bindings in a directive. Such usages would require an update to ensure compliance with the new stricter rules around iframe bindings.\n+### core\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [b1d7b79ff4](https://github.com/angular/angular/commit/b1d7b79ff4619d6e7967455d7cda72754f5dab9a) | fix | hardening attribute and property binding rules for <iframe> elements ([#48029](https://github.com/angular/angular/pull/48029)) |\n+## Special Thanks\n+Andrew Kushnir, Andrew Scott, George Looshch, Joey Perrott and Paul Gschwendtner\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"13.3.12\"></a>\n # 13.3.12 (2022-11-21)\n ## Breaking Changes\n@@ -3617,4 +3631,4 @@ This release contains the same set the of changes as 11.2.0-next.1.\n ### Code Refactoring\n \n * **compiler:** remove support for TypeScript 3.9 ([#39313](https://github.com/angular/angular/issues/39313)) ([736e064](https://github.com/angular/angular/commit/736e0644b02bc4606a7ae0c974d1b06e993708f6))\n-* **router:** adjust type of parameter in `navigateByUrl` and `createUrlTree` to be more accurate ([#38227](https://github.com/angular/angular/issues/38227)) ([e4f4d18](https://github.com/angular/angular/commit/e4f4d18)), closes [#18798](https://github.com/angular/angular/issues/18798)\n\\ No newline at end of file\n+* **router:** adjust type of parameter in `navigateByUrl` and `createUrlTree` to be more accurate ([#38227](https://github.com/angular/angular/issues/38227)) ([e4f4d18](https://github.com/angular/angular/commit/e4f4d18)), closes [#18798](https://github.com/angular/angular/issues/18798)\n\n\n###\n\n", "completion": "docs: release notes for the v12.2.17 release"}
{"prompt": " file path A: packages/common/testing/src/location_mock.ts | file path B: packages/common/testing/src/location_mock.ts\n\n@@ -103,13 +103,15 @@ export class SpyLocation implements Location {\n     path = this.prepareExternalUrl(path);\n \n     const history = this._history[this._historyIndex];\n+\n+    history.state = state;\n+\n     if (history.path == path && history.query == query) {\n       return;\n     }\n \n     history.path = path;\n     history.query = query;\n-    history.state = state;\n \n     const url = path + (query.length > 0 ? ('?' + query) : '');\n     this.urlChanges.push('replace: ' + url);\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -1051,19 +1051,30 @@ export class Router {\n           // hybrid apps.\n           setTimeout(() => {\n             const extras: NavigationExtras = {replaceUrl: true};\n-            // Navigations coming from Angular router have a navigationId state\n-            // property. When this exists, restore the state.\n-            const state = event.state?.navigationId ? event.state : null;\n-            if (state) {\n-              const stateCopy = {...state} as Partial<RestoredState>;\n+\n+            // TODO: restoredState should always include the entire state, regardless\n+            // of navigationId. This requires a breaking change to update the type on\n+            // NavigationStart\u2019s restoredState, which currently requires navigationId\n+            // to always be present. The Router used to only restore history state if\n+            // a navigationId was present.\n+\n+            // The stored navigationId is used by the RouterScroller to retrieve the scroll\n+            // position for the page.\n+            const restoredState = event.state?.navigationId ? event.state : null;\n+\n+            // Separate to NavigationStart.restoredState, we must also restore the state to\n+            // history.state and generate a new navigationId, since it will be overwritten\n+            if (event.state) {\n+              const stateCopy = {...event.state} as Partial<RestoredState>;\n               delete stateCopy.navigationId;\n               delete stateCopy.\u0275routerPageId;\n               if (Object.keys(stateCopy).length !== 0) {\n                 extras.state = stateCopy;\n               }\n             }\n+\n             const urlTree = this.parseUrl(event['url']!);\n-            this.scheduleNavigation(urlTree, source, state, extras);\n+            this.scheduleNavigation(urlTree, source, restoredState, extras);\n           }, 0);\n         }\n       });\n\n---\n file path A: packages/router/test/integration.spec.ts | file path B: packages/router/test/integration.spec.ts\n\n@@ -163,7 +163,7 @@ describe('Integration', () => {\n            }\n          });\n \n-         const state = {foo: 'bar'};\n+         let state: any = {foo: 'bar'};\n          router.navigateByUrl('/simple', {state});\n          tick();\n          location.back();\n@@ -173,6 +173,17 @@ describe('Integration', () => {\n \n          expect(navigation.extras.state).toBeDefined();\n          expect(navigation.extras.state).toEqual(state);\n+\n+         // Manually set state rather than using navigate()\n+         state = {bar: 'foo'};\n+         location.replaceState(location.path(), '', state);\n+         location.back();\n+         tick();\n+         location.forward();\n+         tick();\n+\n+         expect(navigation.extras.state).toBeDefined();\n+         expect(navigation.extras.state).toEqual(state);\n        })));\n \n     it('should navigate correctly when using `Location#historyGo',\n\n\n###\n\n", "completion": "fix(router): restore 'history.state' on popstate even if navigationId missing (#<issue-num>)"}
{"prompt": " file path A: aio/content/navigation.json | file path B: aio/content/navigation.json\n\n@@ -1219,7 +1219,7 @@\n             {\n               \"url\": \"guide/doc-select-issue\",\n               \"title\": \"Select a documentation issue\",\n-              \"tooltip\": \"The procedures used to identify and select a documenation issue.\"\n+              \"tooltip\": \"The procedures used to identify and select a documentation issue.\"\n             },\n             {\n               \"url\": \"guide/doc-update-start\",\n\n\n###\n\n", "completion": "docs: fix typo in navigation.json (#<issue-num>)"}
{"prompt": " file path A: packages/common/testing/src/mock_platform_location.ts | file path B: packages/common/testing/src/mock_platform_location.ts\n\n@@ -105,6 +105,7 @@ export const MOCK_PLATFORM_LOCATION_CONFIG =\n export class MockPlatformLocation implements PlatformLocation {\n   private baseHref: string = '';\n   private hashUpdate = new Subject<LocationChangeEvent>();\n+  private popStateSubject = new Subject<LocationChangeEvent>();\n   private urlChangeIndex: number = 0;\n   private urlChanges: {\n     hostname: string,\n@@ -155,9 +156,8 @@ export class MockPlatformLocation implements PlatformLocation {\n   }\n \n   onPopState(fn: LocationChangeListener): VoidFunction {\n-    // No-op: a state stack is not implemented, so\n-    // no events will ever come.\n-    return () => {};\n+    const subscription = this.popStateSubject.subscribe(fn);\n+    return () => subscription.unsubscribe();\n   }\n \n   onHashChange(fn: LocationChangeListener): VoidFunction {\n@@ -204,7 +204,7 @@ export class MockPlatformLocation implements PlatformLocation {\n     if (this.urlChangeIndex < this.urlChanges.length) {\n       this.urlChangeIndex++;\n     }\n-    this.scheduleHashUpdate(oldHash, oldUrl);\n+    this.emitEvents(oldHash, oldUrl);\n   }\n \n   back(): void {\n@@ -213,7 +213,7 @@ export class MockPlatformLocation implements PlatformLocation {\n     if (this.urlChangeIndex > 0) {\n       this.urlChangeIndex--;\n     }\n-    this.scheduleHashUpdate(oldHash, oldUrl);\n+    this.emitEvents(oldHash, oldUrl);\n   }\n \n   historyGo(relativePosition: number = 0): void {\n@@ -223,22 +223,30 @@ export class MockPlatformLocation implements PlatformLocation {\n     if (nextPageIndex >= 0 && nextPageIndex < this.urlChanges.length) {\n       this.urlChangeIndex = nextPageIndex;\n     }\n-    this.scheduleHashUpdate(oldHash, oldUrl);\n+    this.emitEvents(oldHash, oldUrl);\n   }\n \n   getState(): unknown {\n     return this.state;\n   }\n \n-  private scheduleHashUpdate(oldHash: string, oldUrl: string) {\n+  /**\n+   * Browsers are inconsistent in when they fire events and perform the state updates\n+   * The most easiest thing to do in our mock is synchronous and that happens to match\n+   * Firefox and Chrome, at least somewhat closely\n+   *\n+   * https://github.com/WICG/navigation-api#watching-for-navigations\n+   * https://docs.google.com/document/d/1Pdve-DJ1JCGilj9Yqf5HxRJyBKSel5owgOvUJqTauwU/edit#heading=h.3ye4v71wsz94\n+   * popstate is always sent before hashchange:\n+   * https://developer.mozilla.org/en-US/docs/Web/API/Window/popstate_event#when_popstate_is_sent\n+   */\n+  private emitEvents(oldHash: string, oldUrl: string) {\n+    this.popStateSubject.next(\n+        {type: 'popstate', state: this.getState(), oldUrl, newUrl: this.url} as\n+        LocationChangeEvent);\n     if (oldHash !== this.hash) {\n-      scheduleMicroTask(\n-          () => this.hashUpdate.next(\n-              {type: 'hashchange', state: null, oldUrl, newUrl: this.url} as LocationChangeEvent));\n+      this.hashUpdate.next(\n+          {type: 'hashchange', state: null, oldUrl, newUrl: this.url} as LocationChangeEvent);\n     }\n   }\n }\n-\n-export function scheduleMicroTask(cb: () => any) {\n-  Promise.resolve().then(cb);\n-}\n\n\n###\n\n", "completion": "fix(common): Fix MockPlatformLocation events and missing onPopState implementation (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/cli-builder.md | file path B: aio/content/guide/cli-builder.md\n\n@@ -48,7 +48,7 @@ For example, your `myBuilder` folder could contain the following files.\n | `tsconfig.json`          | [TypeScript configuration](https://www.typescriptlang.org/docs/handbook/tsconfig-json.html).              |\n \n Publish the builder to `npm` \\(see [Publishing your Library](guide/creating-libraries#publishing-your-library)\\).\n-If you publish it as `&commat;example/my-builder`, install it using the following command.\n+If you publish it as `@example/my-builder`, install it using the following command.\n \n <code-example format=\"shell\" language=\"shell\">\n \n\n\n###\n\n", "completion": "docs: fix typo in `cli-builder.mf` (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/reactive-forms.md | file path B: aio/content/guide/reactive-forms.md\n\n@@ -277,6 +277,7 @@ For complete syntax details, see the API reference documentation for the [Forms\n | `FormGroup`       | Manages the value and validity state of a group of `AbstractControl` instances. The group's properties include its child controls. The top-level form in your component is `FormGroup`. |\n | `FormArray`       | Manages the value and validity state of a numerically indexed array of `AbstractControl` instances.                                                                                     |\n | `FormBuilder`     | An injectable service that provides factory methods for creating control instances.                                                                                                     |\n+| `FormRecord`      | Tracks the value and validity state of a collection of `FormControl` instances, each of which has the same value type.                                                                  |\n \n </table>\n \n\n\n###\n\n", "completion": "docs(forms): add FormRecord class to API summary (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/releases.md | file path B: aio/content/guide/releases.md\n\n@@ -112,8 +112,6 @@ Dates are offered as general guidance and are subject to change.\n \n | Version | Date               |\n | :---    | :---               |\n-| v14.1   | Week of 2022-07-18 |\n-| v14.2   | Week of 2022-08-22 |\n | v15.0   | Week of 2022-11-18 |\n \n ### Support window\n@@ -131,7 +129,8 @@ The following table provides the status for Angular versions under support.\n \n | Version | Status | Released   | Active ends | LTS ends   |\n |:---     |:---    |:---        |:---         |:---        |\n-| ^14.0.0 | Active | 2022-06-02 | 2022-12-02  | 2023-12-02 |\n+| ^15.0.0 | Active | 2022-11-18 | 2022-05-18  | 2023-05-18 |\n+| ^14.0.0 | LTS    | 2022-06-02 | 2022-12-02  | 2023-11-18 |\n | ^13.0.0 | LTS    | 2021-11-04 | 2022-06-02  | 2023-05-04 |\n \n Angular versions v2 to v12 are no longer under support.\n@@ -188,4 +187,4 @@ The policies and practices that are described in this document do not apply to A\n \n <!-- end links -->\n \n-@reviewed 2022-11-14\n+@reviewed 2022-11-21\n\n\n###\n\n", "completion": "docs: add version 15 to active version (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,17 @@\n+<a name=\"13.3.12\"></a>\n+# 13.3.12 (2022-11-21)\n+## Breaking Changes\n+### core\n+- Existing iframe usages may have security-sensitive attributes applied as an attribute or property binding in a template or via host bindings in a directive. Such usages would require an update to ensure compliance with the new stricter rules around iframe bindings.\n+### core\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [b1d7b79ff4](https://github.com/angular/angular/commit/b1d7b79ff4619d6e7967455d7cda72754f5dab9a) | fix | hardening attribute and property binding rules for <iframe> elements ([#48029](https://github.com/angular/angular/pull/48029)) |\n+## Special Thanks\n+Andrew Kushnir, Andrew Scott, George Looshch, Joey Perrott and Paul Gschwendtner\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"14.2.12\"></a>\n # 14.2.12 (2022-11-21)\n ## Breaking Changes\n\n\n###\n\n", "completion": "docs: release notes for the v13.3.12 release"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,17 @@\n+<a name=\"14.2.12\"></a>\n+# 14.2.12 (2022-11-21)\n+## Breaking Changes\n+### core\n+- Existing iframe usages may have security-sensitive attributes applied as an attribute or property binding in a template or via host bindings in a directive. Such usages would require an update to ensure compliance with the new stricter rules around iframe bindings.\n+### core\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [54814c8e9b](https://github.com/angular/angular/commit/54814c8e9ba6b82a7f4748ef2b2f47507efd758b) | fix | hardening attribute and property binding rules for <iframe> elements ([#48028](https://github.com/angular/angular/pull/48028)) |\n+## Special Thanks\n+Andrew Kushnir\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.0.0\"></a>\n # 15.0.0 (2022-11-16)\n \n\n\n###\n\n", "completion": "docs: release notes for the v14.2.12 release"}
{"prompt": " file path A: aio/content/guide/image-directive.md | file path B: aio/content/guide/image-directive.md\n\n@@ -93,7 +93,7 @@ When you add the `fill` attribute to your image, you do not need and should not\n \n </code-example>\n \n-You can use the [obect-fit](https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit) CSS property to change how the image will fill its container. If you style your image with `object-fit: \"contain\"`, the image will maintain its aspect ratio and be \"letterboxed\" to fit the element. If you set `object-fit: \"cover\"`, the element will retain its aspect ratio, fully fill the element, and some content may be \"cropped\" off. \n+You can use the [object-fit](https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit) CSS property to change how the image will fill its container. If you style your image with `object-fit: \"contain\"`, the image will maintain its aspect ratio and be \"letterboxed\" to fit the element. If you set `object-fit: \"cover\"`, the element will retain its aspect ratio, fully fill the element, and some content may be \"cropped\" off. \n \n See visual examples of the above at the [MDN object-fit documentation.](https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit)\n \n\n\n###\n\n", "completion": "docs: fix typo in image-directive.md (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/assistant-to-the-branch-manager.yml | file path B: .github/workflows/assistant-to-the-branch-manager.yml\n\n@@ -3,7 +3,7 @@ name: DevInfra\n on:\n   push:\n   pull_request_target:\n-    types: [opened, synchronize, reopened, ready_for_review]\n+    types: [opened, synchronize, reopened, ready_for_review, labeled]\n \n # Declare default permissions as read only.\n permissions:\n\n\n###\n\n", "completion": "build: add labeled trigger for assistant-to-the-branch-manager (#<issue-num>)"}
{"prompt": " file path A: packages/language-service/build.sh | file path B: packages/language-service/build.sh\n\n@@ -13,7 +13,31 @@ if [[ -z \"${extension_repo}\" ]]; then\n   exit 1\n fi\n \n+# sedi makes `sed -i` work on both OSX & Linux\n+# See https://stackoverflow.com/questions/2320564/i-need-my-sed-i-command-for-in-place-editing-to-work-with-both-gnu-sed-and-bsd\n+_sedi () {\n+  case $(uname) in\n+    Darwin*) sedi=('-i' '') ;;\n+    *) sedi=('-i') ;;\n+  esac\n+\n+  sed \"${sedi[@]}\" \"$@\"\n+}\n+\n yarn bazel build --config=release //packages/language-service:npm_package\n pushd \"${extension_repo}\"\n-yarn add @angular/language-service@file:\"${bazel_bin}/packages/language-service/npm_package\"\n+rm -rf .angular_packages/language-service\n+mkdir -p .angular_packages/language-service\n+cp -r \"${bazel_bin}/packages/language-service/npm_package/\" .angular_packages/language-service\n+chmod -R +w .angular_packages/language-service\n+cat <<EOT >> .angular_packages/language-service/BUILD.bazel\n+load(\"@aspect_rules_js//npm:defs.bzl\", \"npm_package\")\n+npm_package(\n+  name = \"language-service\",\n+  srcs = glob([\"**\"], exclude = [\"BUILD.bazel\"]),\n+  visibility = [\"//visibility:public\"],\n+)\n+EOT\n+_sedi 's#\\# PLACE_HOLDER_FOR_packages/language-service/build.sh_IN_angular_REPO#data = [\"//.angular_packages/language-service:package.json\"], \\# FOR TESTING ONLY! DO NOT COMMIT THIS LINE!#' WORKSPACE\n+yarn add @angular/language-service@file:\".angular_packages/language-service\"\n popd\n\n\n###\n\n", "completion": "fix(language-service): update packages/language-service/build.sh script to work with vscode-ng-language-service's new Bazel build (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/core_private_export.ts | file path B: packages/core/src/core_private_export.ts\n\n@@ -16,6 +16,7 @@ export {convertToBitFlags as \u0275convertToBitFlags, setCurrentInjector as \u0275setCur\n export {getInjectableDef as \u0275getInjectableDef, \u0275\u0275InjectableDeclaration, \u0275\u0275InjectorDef} from './di/interface/defs';\n export {InternalEnvironmentProviders as \u0275InternalEnvironmentProviders, isEnvironmentProviders as \u0275isEnvironmentProviders} from './di/interface/provider';\n export {INJECTOR_SCOPE as \u0275INJECTOR_SCOPE} from './di/scope';\n+export {XSS_SECURITY_URL as \u0275XSS_SECURITY_URL} from './error_details_base_url';\n export {formatRuntimeError as \u0275formatRuntimeError, RuntimeError as \u0275RuntimeError} from './errors';\n export {CurrencyIndex as \u0275CurrencyIndex, ExtraLocaleDataIndex as \u0275ExtraLocaleDataIndex, findLocaleData as \u0275findLocaleData, getLocaleCurrencyCode as \u0275getLocaleCurrencyCode, getLocalePluralCase as \u0275getLocalePluralCase, LocaleDataIndex as \u0275LocaleDataIndex, registerLocaleData as \u0275registerLocaleData, unregisterAllLocaleData as \u0275unregisterLocaleData} from './i18n/locale_data_api';\n export {DEFAULT_LOCALE_ID as \u0275DEFAULT_LOCALE_ID} from './i18n/localization';\n\n---\n file path A: packages/core/src/error_details_base_url.ts | file path B: packages/core/src/error_details_base_url.ts\n\n@@ -9,8 +9,13 @@\n /**\n  * Base URL for the error details page.\n  *\n- * Keep the files below in full sync:\n+ * Keep this constant in sync across:\n  *  - packages/compiler-cli/src/ngtsc/diagnostics/src/error_details_base_url.ts\n  *  - packages/core/src/error_details_base_url.ts\n  */\n export const ERROR_DETAILS_PAGE_BASE_URL = 'https://angular.io/errors';\n+\n+/**\n+ * URL for the XSS security documentation.\n+ */\n+export const XSS_SECURITY_URL = 'https://g.co/ng/security#xss';\n\n---\n file path A: packages/core/src/render3/i18n/i18n_parse.ts | file path B: packages/core/src/render3/i18n/i18n_parse.ts\n\n@@ -8,6 +8,7 @@\n import '../../util/ng_dev_mode';\n import '../../util/ng_i18n_closure_mode';\n \n+import {XSS_SECURITY_URL} from '../../error_details_base_url';\n import {getTemplateContent, URI_ATTRS, VALID_ATTRS, VALID_ELEMENTS} from '../../sanitization/html_sanitizer';\n import {getInertBodyHelper} from '../../sanitization/inert_body';\n import {_sanitizeUrl} from '../../sanitization/url_sanitizer';\n@@ -632,7 +633,7 @@ function walkIcuTree(\n                     console.warn(\n                         `WARNING: ignoring unsafe attribute value ` +\n                         `${lowerAttrName} on element ${tagName} ` +\n-                        `(see https://g.co/ng/security#xss)`);\n+                        `(see ${XSS_SECURITY_URL})`);\n               }\n             } else {\n               addCreateAttribute(create, newIndex, attr);\n\n---\n file path A: packages/core/src/sanitization/bypass.ts | file path B: packages/core/src/sanitization/bypass.ts\n\n@@ -6,6 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {XSS_SECURITY_URL} from '../error_details_base_url';\n \n export const enum BypassType {\n   Url = 'URL',\n@@ -65,7 +66,7 @@ abstract class SafeValueImpl implements SafeValue {\n \n   toString() {\n     return `SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity}` +\n-        ` (see https://g.co/ng/security#xss)`;\n+        ` (see ${XSS_SECURITY_URL})`;\n   }\n }\n \n@@ -118,8 +119,7 @@ export function allowSanitizationBypassAndThrow(value: any, type: BypassType): b\n   if (actualType != null && actualType !== type) {\n     // Allow ResourceURLs in URL contexts, they are strictly more trusted.\n     if (actualType === BypassType.ResourceUrl && type === BypassType.Url) return true;\n-    throw new Error(\n-        `Required a safe ${type}, got a ${actualType} (see https://g.co/ng/security#xss)`);\n+    throw new Error(`Required a safe ${type}, got a ${actualType} (see ${XSS_SECURITY_URL})`);\n   }\n   return actualType === type;\n }\n\n---\n file path A: packages/core/src/sanitization/html_sanitizer.ts | file path B: packages/core/src/sanitization/html_sanitizer.ts\n\n@@ -6,6 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {XSS_SECURITY_URL} from '../error_details_base_url';\n import {TrustedHTML} from '../util/security/trusted_type_defs';\n import {trustedHTMLFromString} from '../util/security/trusted_types';\n \n@@ -268,8 +269,7 @@ export function _sanitizeHtml(defaultDoc: any, unsafeHtmlInput: string): Trusted\n     const safeHtml = sanitizer.sanitizeChildren(\n         getTemplateContent(inertBodyElement!) as Element || inertBodyElement);\n     if ((typeof ngDevMode === 'undefined' || ngDevMode) && sanitizer.sanitizedSomething) {\n-      console.warn(\n-          'WARNING: sanitizing HTML stripped some content, see https://g.co/ng/security#xss');\n+      console.warn(`WARNING: sanitizing HTML stripped some content, see ${XSS_SECURITY_URL}`);\n     }\n \n     return trustedHTMLFromString(safeHtml);\n\n---\n file path A: packages/core/src/sanitization/sanitization.ts | file path B: packages/core/src/sanitization/sanitization.ts\n\n@@ -6,6 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {XSS_SECURITY_URL} from '../error_details_base_url';\n import {RuntimeError, RuntimeErrorCode} from '../errors';\n import {getDocument} from '../render3/interfaces/document';\n import {SANITIZER} from '../render3/interfaces/view';\n@@ -120,8 +121,7 @@ export function \u0275\u0275sanitizeResourceUrl(unsafeResourceUrl: any): TrustedScriptUR\n   }\n   throw new RuntimeError(\n       RuntimeErrorCode.UNSAFE_VALUE_IN_RESOURCE_URL,\n-      ngDevMode &&\n-          'unsafe value used in a resource URL context (see https://g.co/ng/security#xss)');\n+      ngDevMode && `unsafe value used in a resource URL context (see ${XSS_SECURITY_URL})`);\n }\n \n /**\n\n---\n file path A: packages/core/src/sanitization/url_sanitizer.ts | file path B: packages/core/src/sanitization/url_sanitizer.ts\n\n@@ -6,6 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {XSS_SECURITY_URL} from '../error_details_base_url';\n \n /**\n  * A pattern that recognizes a commonly useful subset of URLs that are safe.\n@@ -40,7 +41,7 @@ export function _sanitizeUrl(url: string): string {\n   if (url.match(SAFE_URL_PATTERN)) return url;\n \n   if (typeof ngDevMode === 'undefined' || ngDevMode) {\n-    console.warn(`WARNING: sanitizing unsafe URL value ${url} (see https://g.co/ng/security#xss)`);\n+    console.warn(`WARNING: sanitizing unsafe URL value ${url} (see ${XSS_SECURITY_URL})`);\n   }\n \n   return 'unsafe:' + url;\n\n---\n file path A: packages/core/test/sanitization/sanitization_spec.ts | file path B: packages/core/test/sanitization/sanitization_spec.ts\n\n@@ -52,8 +52,7 @@ describe('sanitization', () => {\n   });\n \n   it('should sanitize resourceUrl', () => {\n-    const ERROR =\n-        'NG0904: unsafe value used in a resource URL context (see https://g.co/ng/security#xss)';\n+    const ERROR = /NG0904: unsafe value used in a resource URL context.*/;\n     expect(() => \u0275\u0275sanitizeResourceUrl('http://server')).toThrowError(ERROR);\n     expect(() => \u0275\u0275sanitizeResourceUrl('javascript:true')).toThrowError(ERROR);\n     expect(() => \u0275\u0275sanitizeResourceUrl(bypassSanitizationTrustHtml('javascript:true')))\n@@ -106,8 +105,7 @@ describe('sanitization', () => {\n   });\n \n   it('should sanitize resourceUrls via sanitizeUrlOrResourceUrl', () => {\n-    const ERROR =\n-        'NG0904: unsafe value used in a resource URL context (see https://g.co/ng/security#xss)';\n+    const ERROR = /NG0904: unsafe value used in a resource URL context.*/;\n     expect(() => \u0275\u0275sanitizeUrlOrResourceUrl('http://server', 'iframe', 'src')).toThrowError(ERROR);\n     expect(() => \u0275\u0275sanitizeUrlOrResourceUrl('javascript:true', 'iframe', 'src'))\n         .toThrowError(ERROR);\n\n---\n file path A: packages/platform-browser/src/security/dom_sanitization_service.ts | file path B: packages/platform-browser/src/security/dom_sanitization_service.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {DOCUMENT} from '@angular/common';\n-import {forwardRef, Inject, Injectable, Injector, Sanitizer, SecurityContext, \u0275_sanitizeHtml as _sanitizeHtml, \u0275_sanitizeUrl as _sanitizeUrl, \u0275allowSanitizationBypassAndThrow as allowSanitizationBypassOrThrow, \u0275bypassSanitizationTrustHtml as bypassSanitizationTrustHtml, \u0275bypassSanitizationTrustResourceUrl as bypassSanitizationTrustResourceUrl, \u0275bypassSanitizationTrustScript as bypassSanitizationTrustScript, \u0275bypassSanitizationTrustStyle as bypassSanitizationTrustStyle, \u0275bypassSanitizationTrustUrl as bypassSanitizationTrustUrl, \u0275BypassType as BypassType, \u0275getSanitizationBypassType as getSanitizationBypassType, \u0275unwrapSafeValue as unwrapSafeValue} from '@angular/core';\n+import {forwardRef, Inject, Injectable, Injector, Sanitizer, SecurityContext, \u0275_sanitizeHtml as _sanitizeHtml, \u0275_sanitizeUrl as _sanitizeUrl, \u0275allowSanitizationBypassAndThrow as allowSanitizationBypassOrThrow, \u0275bypassSanitizationTrustHtml as bypassSanitizationTrustHtml, \u0275bypassSanitizationTrustResourceUrl as bypassSanitizationTrustResourceUrl, \u0275bypassSanitizationTrustScript as bypassSanitizationTrustScript, \u0275bypassSanitizationTrustStyle as bypassSanitizationTrustStyle, \u0275bypassSanitizationTrustUrl as bypassSanitizationTrustUrl, \u0275BypassType as BypassType, \u0275getSanitizationBypassType as getSanitizationBypassType, \u0275unwrapSafeValue as unwrapSafeValue, \u0275XSS_SECURITY_URL as XSS_SECURITY_URL} from '@angular/core';\n \n export {SecurityContext};\n \n@@ -182,10 +182,9 @@ export class DomSanitizerImpl extends DomSanitizer {\n         if (allowSanitizationBypassOrThrow(value, BypassType.ResourceUrl)) {\n           return unwrapSafeValue(value);\n         }\n-        throw new Error(\n-            'unsafe value used in a resource URL context (see https://g.co/ng/security#xss)');\n+        throw new Error(`unsafe value used in a resource URL context (see ${XSS_SECURITY_URL})`);\n       default:\n-        throw new Error(`Unexpected SecurityContext ${ctx} (see https://g.co/ng/security#xss)`);\n+        throw new Error(`Unexpected SecurityContext ${ctx} (see ${XSS_SECURITY_URL})`);\n     }\n   }\n \n\n\n###\n\n", "completion": "docs: extract XSS security doc URL into a constant (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/hierarchical-dependency-injection.md | file path B: aio/content/guide/hierarchical-dependency-injection.md\n\n@@ -636,13 +636,18 @@ The `AnimalService` in the logical tree would look like this:\n             &commat;Inject(AnimalService=&gt;\"&#x1F436;\")&gt;\n         &lt;!-- ^^using viewProviders means AnimalService is available in &lt;#VIEW&gt;--&gt;\n         &lt;p&gt;Emoji from AnimalService: {{animal.emoji}} (&#x1F436;)&lt;/p&gt;\n-        &lt;app-inspector&gt;\n-          &lt;p&gt;Emoji from AnimalService: {{animal.emoji}} (&#x1F436;)&lt;/p&gt;\n-        &lt;/app-inspector&gt;\n+  \n+        &lt;div class=\"container\"&gt;\n+          &lt;h3&gt;Content projection&lt;/h3&gt;\n+          &lt;app-inspector &commat;Inject(AnimalService) animal=&gt;\"&#x1F433;\"&gt;\n+            &lt;p&gt;Emoji from AnimalService: {{animal.emoji}} (&#x1F433;)&lt;/p&gt;\n+          &lt;/app-inspector&gt;\n+        &lt;/div&gt;\n+  \n       &lt;/#VIEW&gt;\n       &lt;app-inspector&gt;\n         &lt;#VIEW&gt;\n-          &lt;p&gt;Emoji from AnimalService: {{animal.emoji}} (&#x1F433;)&lt;/p&gt;\n+          &lt;p&gt;Emoji from AnimalService: {{animal.emoji}} (&#x1F436;)&lt;/p&gt;\n         &lt;/#VIEW&gt;\n       &lt;/app-inspector&gt;\n     &lt;/app-child&gt;\n\n\n###\n\n", "completion": "docs: Changed documentation for providers vs. viewProviders (#<issue-num>)"}
{"prompt": " file path A: packages/forms/src/form_builder.ts | file path B: packages/forms/src/form_builder.ts\n\n@@ -38,6 +38,14 @@ type ValidatorConfig = ValidatorFn|AsyncValidatorFn|ValidatorFn[]|AsyncValidator\n  */\n type PermissiveControlConfig<T> = Array<T|FormControlState<T>|ValidatorConfig>;\n \n+/**\n+ * Helper type to allow the compiler to accept [XXXX, { updateOn: string }] as a valid shorthand\n+ * argument for .group()\n+ */\n+interface PermissiveAbstractControlOptions extends Omit<AbstractControlOptions, 'updateOn'> {\n+  updateOn?: string;\n+}\n+\n /**\n  * ControlConfig<T> is a tuple containing a value of type T, plus optional validators and async\n  * validators.\n@@ -82,7 +90,7 @@ export type \u0275Element<T, N extends null> =\n   // FormControlState object container, which produces a nullable control.\n   [T] extends [FormControlState<infer U>] ? FormControl<U|N> :\n   // A ControlConfig tuple, which produces a nullable control.\n-  [T] extends [PermissiveControlConfig<infer U>] ? FormControl<Exclude<U, ValidatorConfig>|N> :\n+  [T] extends [PermissiveControlConfig<infer U>] ? FormControl<Exclude<U, ValidatorConfig| PermissiveAbstractControlOptions>|N> :\n   FormControl<T|N>;\n \n // clang-format on\n\n---\n file path A: packages/forms/test/form_builder_spec.ts | file path B: packages/forms/test/form_builder_spec.ts\n\n@@ -189,6 +189,22 @@ describe('Form Builder', () => {\n     expect(g.asyncValidator).toBe(null);\n   });\n \n+  it('should create groups with shorthand parameters and with right typings', () => {\n+    const form = b.group({\n+      shorthand: [3, Validators.required],\n+      shorthand2: [5, {validators: Validators.required}],\n+    });\n+\n+    expect((form.get('shorthand')?.value)).toEqual(3);\n+    expect(((form.get('shorthand2')!.value ?? 0) + 0)).toEqual(5);\n+\n+\n+    const form2 = b.group({\n+      shorthand2: [5, {updateOn: 'blur'}],\n+    });\n+    expect(((form2.get('shorthand2')!.value ?? 0) + 0)).toEqual(5);\n+  });\n+\n   it('should create control arrays', () => {\n     const c = b.control('three');\n     const e = b.control(null);\n\n\n###\n\n", "completion": "fix(forms): FormBuilder.group return right type with shorthand parameters. (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/provide_router.ts | file path B: packages/router/src/provide_router.ts\n\n@@ -208,8 +208,10 @@ export function getBootstrapListener() {\n     injector.get(ROUTER_PRELOADER, null, InjectFlags.Optional)?.setUpPreloading();\n     injector.get(ROUTER_SCROLLER, null, InjectFlags.Optional)?.init();\n     router.resetRootComponentType(ref.componentTypes[0]);\n-    bootstrapDone.next();\n-    bootstrapDone.complete();\n+    if (!bootstrapDone.closed) {\n+      bootstrapDone.next();\n+      bootstrapDone.unsubscribe();\n+    }\n   };\n }\n \n\n---\n file path A: packages/router/test/bootstrap.spec.ts | file path B: packages/router/test/bootstrap.spec.ts\n\n@@ -11,7 +11,7 @@ import {ApplicationRef, Component, CUSTOM_ELEMENTS_SCHEMA, destroyPlatform, Inje\n import {inject} from '@angular/core/testing';\n import {BrowserModule} from '@angular/platform-browser';\n import {platformBrowserDynamic} from '@angular/platform-browser-dynamic';\n-import {NavigationEnd, provideRouter, Resolve, Router, RouterModule, withEnabledBlockingInitialNavigation} from '@angular/router';\n+import {NavigationEnd, provideRouter, Resolve, Router, RouterModule, RouterOutlet, withEnabledBlockingInitialNavigation} from '@angular/router';\n \n // This is needed, because all files under `packages/` are compiled together as part of the\n // [legacy-unit-tests-saucelabs][1] CI job, including the `lib.webworker.d.ts` typings brought in by\n@@ -112,6 +112,55 @@ describe('bootstrap', () => {\n        });\n      });\n \n+  it('should finish navigation when initial navigation is enabledBlocking and component renavigates on render',\n+     async () => {\n+       @Component({\n+         template: '',\n+         standalone: true,\n+       })\n+       class Renavigate {\n+         constructor(router: Router) {\n+           router.navigateByUrl('/other');\n+         }\n+       }\n+       @Component({\n+         template: '',\n+         standalone: true,\n+       })\n+       class BlankCmp {\n+       }\n+\n+       let resolveFn: () => void;\n+       const navigationEndPromise = new Promise<void>(r => {\n+         resolveFn = r;\n+       });\n+\n+       @NgModule({\n+         imports: [BrowserModule, RouterOutlet],\n+         declarations: [RootCmp],\n+         bootstrap: [RootCmp],\n+         providers: [\n+           {provide: LocationStrategy, useClass: HashLocationStrategy},\n+           provideRouter(\n+               [{path: '', component: Renavigate}, {path: 'other', component: BlankCmp}],\n+               withEnabledBlockingInitialNavigation())\n+         ],\n+       })\n+       class TestModule {\n+         constructor(router: Router) {\n+           router.events.subscribe(e => {\n+             if (e instanceof NavigationEnd) {\n+               resolveFn();\n+               expect(router.url).toEqual('/other');\n+             }\n+           });\n+         }\n+       }\n+\n+       await Promise.all(\n+           [platformBrowserDynamic([]).bootstrapModule(TestModule), navigationEndPromise]);\n+     });\n+\n   it('should wait for redirect when initialNavigation = enabledBlocking', async () => {\n     @Injectable({providedIn: 'root'})\n     class Redirect {\n\n\n###\n\n", "completion": "fix(router): Ensure renavigating in component init works with enabledBlocking (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/metadata/src/api.ts | file path B: packages/compiler-cli/src/ngtsc/metadata/src/api.ts\n\n@@ -254,7 +254,7 @@ export interface MetadataReader {\n  * A MetadataReader which also allows access to the set of all known directive classes.\n  */\n export interface MetadataReaderWithIndex extends MetadataReader {\n-  getKnownDirectives(): Iterable<ClassDeclaration>;\n+  getKnown(kind: MetaKind): Iterable<ClassDeclaration>;\n }\n \n /**\n\n---\n file path A: packages/compiler-cli/src/ngtsc/metadata/src/registry.ts | file path B: packages/compiler-cli/src/ngtsc/metadata/src/registry.ts\n\n@@ -9,7 +9,7 @@\n import {Reference} from '../../imports';\n import {ClassDeclaration} from '../../reflection';\n \n-import {DirectiveMeta, MetadataReaderWithIndex, MetadataRegistry, NgModuleMeta, PipeMeta} from './api';\n+import {DirectiveMeta, MetadataReaderWithIndex, MetadataRegistry, MetaKind, NgModuleMeta, PipeMeta} from './api';\n \n /**\n  * A registry of directive, pipe, and module metadata for types defined in the current compilation\n@@ -40,8 +40,15 @@ export class LocalMetadataRegistry implements MetadataRegistry, MetadataReaderWi\n     this.pipes.set(meta.ref.node, meta);\n   }\n \n-  getKnownDirectives(): Iterable<ClassDeclaration> {\n-    return this.directives.keys();\n+  getKnown(kind: MetaKind): Iterable<ClassDeclaration> {\n+    switch (kind) {\n+      case MetaKind.Directive:\n+        return this.directives.keys();\n+      case MetaKind.Pipe:\n+        return this.pipes.keys();\n+      case MetaKind.NgModule:\n+        return this.ngModules.keys();\n+    }\n   }\n }\n \n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/api/checker.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/api/checker.ts\n\n@@ -135,9 +135,9 @@ export interface TemplateTypeChecker {\n   getPotentialTemplateDirectives(component: ts.ClassDeclaration): PotentialDirective[];\n \n   /**\n-   * Get basic metadata on the pipes which are in scope for the given component.\n+   * Get basic metadata on the pipes which are in scope or can be imported for the given component.\n    */\n-  getPipesInScope(component: ts.ClassDeclaration): PotentialPipe[]|null;\n+  getPotentialPipes(component: ts.ClassDeclaration): PotentialPipe[];\n \n   /**\n    * Retrieve a `Map` of potential template element tags, to either the `PotentialDirective` that\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/api/scope.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/api/scope.ts\n\n@@ -72,6 +72,8 @@ export interface PotentialDirective {\n  * Metadata for a pipe which is available in a template.\n  */\n export interface PotentialPipe {\n+  ref: Reference<ClassDeclaration>;\n+\n   /**\n    * The `ts.Symbol` for the pipe class.\n    */\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/src/checker.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/src/checker.ts\n\n@@ -13,7 +13,7 @@ import {ErrorCode, ngErrorCode} from '../../diagnostics';\n import {absoluteFrom, absoluteFromSourceFile, AbsoluteFsPath, getSourceFileOrError} from '../../file_system';\n import {Reference, ReferenceEmitKind, ReferenceEmitter} from '../../imports';\n import {IncrementalBuild} from '../../incremental/api';\n-import {DirectiveMeta, MetadataReader, MetadataReaderWithIndex, MetaKind, NgModuleMeta} from '../../metadata';\n+import {DirectiveMeta, MetadataReader, MetadataReaderWithIndex, MetaKind, NgModuleMeta, PipeMeta} from '../../metadata';\n import {PerfCheckpoint, PerfEvent, PerfPhase, PerfRecorder} from '../../perf';\n import {ProgramDriver, UpdateMode} from '../../program_driver';\n import {ClassDeclaration, DeclarationNode, isNamedClassDeclaration, ReflectionHost} from '../../reflection';\n@@ -31,7 +31,6 @@ import {TemplateSourceManager} from './source';\n import {findTypeCheckBlock, getTemplateMapping, TemplateSourceResolver} from './tcb_util';\n import {SymbolBuilder} from './template_symbol_builder';\n \n-\n const REGISTRY = new DomElementSchemaRegistry();\n /**\n  * Primary template type-checking engine, which performs type-checking using a\n@@ -561,7 +560,7 @@ export class TemplateTypeCheckerImpl implements TemplateTypeChecker {\n     // Any additional directives found from the global registry can be used, but are not in scope.\n     // In the future, we can also walk other registries for .d.ts files, or traverse the\n     // import/export graph.\n-    for (const directiveClass of this.localMetaReader.getKnownDirectives()) {\n+    for (const directiveClass of this.localMetaReader.getKnown(MetaKind.Directive)) {\n       const directiveMeta = this.metaReader.getDirectiveMetadata(new Reference(directiveClass));\n       if (directiveMeta === null) continue;\n       if (resultingDirectives.has(directiveClass)) continue;\n@@ -572,12 +571,23 @@ export class TemplateTypeCheckerImpl implements TemplateTypeChecker {\n     return Array.from(resultingDirectives.values());\n   }\n \n-  getPipesInScope(component: ts.ClassDeclaration): PotentialPipe[]|null {\n-    const data = this.getScopeData(component);\n-    if (data === null) {\n-      return null;\n+  getPotentialPipes(component: ts.ClassDeclaration): PotentialPipe[] {\n+    // Very similar to the above `getPotentialTemplateDirectives`, but on pipes.\n+    const typeChecker = this.programDriver.getProgram().getTypeChecker();\n+    const inScopePipes = this.getScopeData(component)?.pipes ?? [];\n+    const resultingPipes = new Map<ClassDeclaration<DeclarationNode>, PotentialPipe>();\n+    for (const p of inScopePipes) {\n+      resultingPipes.set(p.ref.node, p);\n+    }\n+    for (const pipeClass of this.localMetaReader.getKnown(MetaKind.Pipe)) {\n+      const pipeMeta = this.metaReader.getPipeMetadata(new Reference(pipeClass));\n+      if (pipeMeta === null) continue;\n+      if (resultingPipes.has(pipeClass)) continue;\n+      const withScope = this.scopeDataOfPipeMeta(typeChecker, pipeMeta);\n+      if (withScope === null) continue;\n+      resultingPipes.set(pipeClass, {...withScope, isInScope: false});\n     }\n-    return data.pipes;\n+    return Array.from(resultingPipes.values());\n   }\n \n   getDirectiveMetadata(dir: ts.ClassDeclaration): TypeCheckableDirectiveMeta|null {\n@@ -747,15 +757,9 @@ export class TemplateTypeCheckerImpl implements TemplateTypeChecker {\n         if (dirScope === null) continue;\n         data.directives.push({...dirScope, isInScope: true});\n       } else if (dep.kind === MetaKind.Pipe) {\n-        const tsSymbol = typeChecker.getSymbolAtLocation(dep.ref.node.name);\n-        if (tsSymbol === undefined) {\n-          continue;\n-        }\n-        data.pipes.push({\n-          name: dep.name,\n-          tsSymbol,\n-          isInScope: true,\n-        });\n+        const pipeScope = this.scopeDataOfPipeMeta(typeChecker, dep);\n+        if (pipeScope === null) continue;\n+        data.pipes.push({...pipeScope, isInScope: true});\n       }\n     }\n \n@@ -789,6 +793,19 @@ export class TemplateTypeCheckerImpl implements TemplateTypeChecker {\n       ngModule,\n     };\n   }\n+\n+  private scopeDataOfPipeMeta(typeChecker: ts.TypeChecker, dep: PipeMeta):\n+      Omit<PotentialPipe, 'isInScope'>|null {\n+    const tsSymbol = typeChecker.getSymbolAtLocation(dep.ref.node.name);\n+    if (tsSymbol === undefined) {\n+      return null;\n+    }\n+    return {\n+      ref: dep.ref,\n+      name: dep.name,\n+      tsSymbol,\n+    };\n+  }\n }\n \n function convertDiagnostic(\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/test/type_checker__completion_spec.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/test/type_checker__completion_spec.ts\n\n@@ -106,7 +106,7 @@ runInEachFileSystem(() => {\n \n       let directives = templateTypeChecker.getPotentialTemplateDirectives(SomeCmp) ?? [];\n       directives = directives.filter(d => d.isInScope);\n-      const pipes = templateTypeChecker.getPipesInScope(SomeCmp) ?? [];\n+      const pipes = templateTypeChecker.getPotentialPipes(SomeCmp) ?? [];\n       expect(directives.map(dir => dir.selector)).toEqual(['other-dir']);\n       expect(pipes.map(pipe => pipe.name)).toEqual(['otherPipe']);\n     });\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/testing/index.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/testing/index.ts\n\n@@ -577,8 +577,13 @@ function getFakeMetadataReader(fakeMetadataRegistry: Map<any, DirectiveMeta|null\n         null {\n           return fakeMetadataRegistry.get(node.debugName) ?? null;\n         },\n-    getKnownDirectives(): Iterable<ClassDeclaration> {\n-      return fakeMetadataRegistry.keys();\n+    getKnown(kind: MetaKind): Iterable<ClassDeclaration> {\n+      switch (kind) {\n+        case MetaKind.Directive:\n+          return fakeMetadataRegistry.keys();\n+        default:\n+          return [];\n+      }\n     }\n   } as MetadataReaderWithIndex;\n }\n\n---\n file path A: packages/compiler-cli/test/ngtsc/ls_typecheck_helpers_spec.ts | file path B: packages/compiler-cli/test/ngtsc/ls_typecheck_helpers_spec.ts\n\n@@ -202,6 +202,37 @@ runInEachFileSystem(() => {\n       });\n     });\n \n+    describe('can retrieve candidate pipes` ', () => {\n+      it('which are out of scope', () => {\n+        env.write('one.ts', `\n+\t\t\t import {Pipe} from '@angular/core';\n+\t \n+\t\t\t @Pipe({\n+\t\t\t\tname: 'foo-pipe',\n+\t\t\t\tstandalone: true,\n+\t\t\t  })\n+\t\t\t  export class OnePipe {\n+\t\t\t  }\n+\t\t\t `);\n+\n+        env.write('two.ts', `\n+\t\t\t import {Component} from '@angular/core';\n+\t \n+\t\t\t @Component({\n+\t\t\t\t standalone: true,\n+\t\t\t\t selector: 'two-cmp',\n+\t\t\t\t template: '<div></div>',\n+\t\t\t })\n+\t\t\t export class TwoCmp {}\n+\t\t\t `);\n+        const {program, checker} = env.driveTemplateTypeChecker();\n+        const sf = program.getSourceFile(_('/one.ts'));\n+        expect(sf).not.toBeNull();\n+        const pipes = checker.getPotentialPipes(getClass(sf!, 'OnePipe'));\n+        expect(pipes.map(p => p.name)).toContain('foo-pipe');\n+      });\n+    });\n+\n     describe('can generate imports` ', () => {\n       it('for out of scope standalone components', () => {\n         env.write('one.ts', `\n\n---\n file path A: packages/language-service/src/completions.ts | file path B: packages/language-service/src/completions.ts\n\n@@ -842,7 +842,8 @@ export class CompletionBuilder<N extends TmplAstNode|AST> {\n \n   private getPipeCompletions(this: PipeCompletionBuilder):\n       ts.WithMetadata<ts.CompletionInfo>|undefined {\n-    const pipes = this.templateTypeChecker.getPipesInScope(this.component);\n+    const pipes =\n+        this.templateTypeChecker.getPotentialPipes(this.component).filter(p => p.isInScope);\n     if (pipes === null) {\n       return undefined;\n     }\n\n\n###\n\n", "completion": "refactor(compiler): Add `getPotentialPipes` API method. (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -369,6 +369,21 @@ export class Router {\n    * rawUrlTree to be a combination of the urlAfterRedirects (again, this might only apply to part\n    * of the initial url) and the rawUrl of the transition (which was the original navigation url in\n    * its full form).\n+   *\n+   * Note that this is _only_ here to support `UrlHandlingStrategy.extract` and\n+   * `UrlHandlingStrategy.shouldProcessUrl`. If those didn't exist, we could get by with\n+   * `currentUrlTree` alone. If a new Router were to be provided (i.e. one that works with the\n+   * browser navigation API), we should think about whether this complexity should be carried over.\n+   *\n+   * - extract: `rawUrlTree` is needed because `extract` may only return part\n+   * of the navigation URL. Thus, `currentUrlTree` may only represent _part_ of the browser URL.\n+   * When a navigation gets cancelled and we need to reset the URL or a new navigation occurs, we\n+   * need to know the _whole_ browser URL, not just the part handled by UrlHandlingStrategy.\n+   * - shouldProcessUrl: When this returns `false`, the router just ignores the navigation but still\n+   * updates the `rawUrlTree` with the assumption that the navigation was caused by the location\n+   * change listener due to a URL update by the AngularJS router. In this case, we still need to\n+   * know what the browser's URL is for future navigations.\n+   *\n    */\n   private rawUrlTree: UrlTree;\n   /**\n\n\n###\n\n", "completion": "docs(router): Further document rawUrlTree (#<issue-num>)"}
{"prompt": " file path A: packages/core/test/bundling/forms_reactive/bundle.golden_symbols.json | file path B: packages/core/test/bundling/forms_reactive/bundle.golden_symbols.json\n\n@@ -632,12 +632,6 @@\n   {\n     \"name\": \"cleanUpView\"\n   },\n-  {\n-    \"name\": \"coerceToAsyncValidator\"\n-  },\n-  {\n-    \"name\": \"coerceToValidator\"\n-  },\n   {\n     \"name\": \"collectNativeNodes\"\n   },\n\n---\n file path A: packages/core/test/bundling/forms_template_driven/bundle.golden_symbols.json | file path B: packages/core/test/bundling/forms_template_driven/bundle.golden_symbols.json\n\n@@ -608,15 +608,9 @@\n   {\n     \"name\": \"cleanUpView\"\n   },\n-  {\n-    \"name\": \"coerceToAsyncValidator\"\n-  },\n   {\n     \"name\": \"coerceToBoolean\"\n   },\n-  {\n-    \"name\": \"coerceToValidator\"\n-  },\n   {\n     \"name\": \"collectNativeNodes\"\n   },\n\n---\n file path A: packages/forms/src/model/abstract_model.ts | file path B: packages/forms/src/model/abstract_model.ts\n\n@@ -372,7 +372,7 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n    *\n    * @internal\n    */\n-  private _composedValidatorFn: ValidatorFn|null;\n+  private _composedValidatorFn!: ValidatorFn|null;\n \n   /**\n    * Contains the result of merging asynchronous validators into a single validator function\n@@ -380,7 +380,7 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n    *\n    * @internal\n    */\n-  private _composedAsyncValidatorFn: AsyncValidatorFn|null;\n+  private _composedAsyncValidatorFn!: AsyncValidatorFn|null;\n \n   /**\n    * Synchronous validators as they were provided:\n@@ -390,7 +390,7 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n    *\n    * @internal\n    */\n-  private _rawValidators: ValidatorFn|ValidatorFn[]|null;\n+  private _rawValidators!: ValidatorFn|ValidatorFn[]|null;\n \n   /**\n    * Asynchronous validators as they were provided:\n@@ -401,7 +401,7 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n    *\n    * @internal\n    */\n-  private _rawAsyncValidators: AsyncValidatorFn|AsyncValidatorFn[]|null;\n+  private _rawAsyncValidators!: AsyncValidatorFn|AsyncValidatorFn[]|null;\n \n   /**\n    * The current value of the control.\n@@ -427,10 +427,8 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n   constructor(\n       validators: ValidatorFn|ValidatorFn[]|null,\n       asyncValidators: AsyncValidatorFn|AsyncValidatorFn[]|null) {\n-    this._rawValidators = validators;\n-    this._rawAsyncValidators = asyncValidators;\n-    this._composedValidatorFn = coerceToValidator(this._rawValidators);\n-    this._composedAsyncValidatorFn = coerceToAsyncValidator(this._rawAsyncValidators);\n+    this._assignValidators(validators);\n+    this._assignAsyncValidators(asyncValidators);\n   }\n \n   /**\n@@ -620,8 +618,7 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n    * using `addValidators()` method instead.\n    */\n   setValidators(validators: ValidatorFn|ValidatorFn[]|null): void {\n-    this._rawValidators = validators;\n-    this._composedValidatorFn = coerceToValidator(validators);\n+    this._assignValidators(validators);\n   }\n \n   /**\n@@ -635,8 +632,7 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n    * using `addAsyncValidators()` method instead.\n    */\n   setAsyncValidators(validators: AsyncValidatorFn|AsyncValidatorFn[]|null): void {\n-    this._rawAsyncValidators = validators;\n-    this._composedAsyncValidatorFn = coerceToAsyncValidator(validators);\n+    this._assignAsyncValidators(validators);\n   }\n \n   /**\n@@ -1377,4 +1373,24 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n   _find(name: string|number): AbstractControl|null {\n     return null;\n   }\n+\n+  /**\n+   * Internal implementation of the `setValidators` method. Needs to be separated out into a\n+   * different method, because it is called in the constructor and it can break cases where\n+   * a control is extended.\n+   */\n+  private _assignValidators(validators: ValidatorFn|ValidatorFn[]|null): void {\n+    this._rawValidators = Array.isArray(validators) ? validators.slice() : validators;\n+    this._composedValidatorFn = coerceToValidator(this._rawValidators);\n+  }\n+\n+  /**\n+   * Internal implementation of the `setAsyncValidators` method. Needs to be separated out into a\n+   * different method, because it is called in the constructor and it can break cases where\n+   * a control is extended.\n+   */\n+  private _assignAsyncValidators(validators: AsyncValidatorFn|AsyncValidatorFn[]|null): void {\n+    this._rawAsyncValidators = Array.isArray(validators) ? validators.slice() : validators;\n+    this._composedAsyncValidatorFn = coerceToAsyncValidator(this._rawAsyncValidators);\n+  }\n }\n\n---\n file path A: packages/forms/test/form_control_spec.ts | file path B: packages/forms/test/form_control_spec.ts\n\n@@ -266,6 +266,16 @@ describe('FormControl', () => {\n       expect(c.valid).toEqual(true);\n     });\n \n+    it('should not mutate the validators array when overriding using setValidators', () => {\n+      const control = new FormControl('');\n+      const originalValidators = [Validators.required];\n+\n+      control.setValidators(originalValidators);\n+      control.addValidators(Validators.minLength(10));\n+\n+      expect(originalValidators.length).toBe(1);\n+    });\n+\n     it('should override validators by setting `control.validator` field value', () => {\n       const c = new FormControl('');\n       expect(c.valid).toEqual(true);\n@@ -357,6 +367,30 @@ describe('FormControl', () => {\n       expect(c.hasValidator(Validators.required)).toEqual(false);\n     });\n \n+    it('should not mutate the validators array when adding/removing sync validators', () => {\n+      const originalValidators = [Validators.required];\n+      const control = new FormControl('', originalValidators);\n+\n+      control.addValidators(Validators.min(10));\n+      expect(originalValidators.length).toBe(1);\n+\n+      control.removeValidators(Validators.required);\n+      expect(originalValidators.length).toBe(1);\n+    });\n+\n+    it('should not mutate the validators array when adding/removing async validators', () => {\n+      const firstValidator = asyncValidator('one');\n+      const secondValidator = asyncValidator('two');\n+      const originalValidators = [firstValidator];\n+      const control = new FormControl('', null, originalValidators);\n+\n+      control.addAsyncValidators(secondValidator);\n+      expect(originalValidators.length).toBe(1);\n+\n+      control.removeAsyncValidators(firstValidator);\n+      expect(originalValidators.length).toBe(1);\n+    });\n+\n     it('should return false when checking presence of a validator not identical by reference',\n        () => {\n          const minValidator = Validators.min(5);\n@@ -518,6 +552,16 @@ describe('FormControl', () => {\n          expect(c.valid).toEqual(true);\n        }));\n \n+    it('should not mutate the validators array when overriding using setValidators', () => {\n+      const control = new FormControl('');\n+      const originalValidators = [asyncValidator('one')];\n+\n+      control.setAsyncValidators(originalValidators);\n+      control.addAsyncValidators(asyncValidator('two'));\n+\n+      expect(originalValidators.length).toBe(1);\n+    });\n+\n     it('should override validators by setting `control.asyncValidator` field value',\n        fakeAsync(() => {\n          const c = new FormControl('');\n\n---\n file path A: packages/core/test/bundling/forms_reactive/bundle.golden_symbols.json | file path B: packages/core/test/bundling/forms_reactive/bundle.golden_symbols.json\n\n@@ -632,12 +632,6 @@\n   {\n     \"name\": \"cleanUpView\"\n   },\n-  {\n-    \"name\": \"coerceToAsyncValidator\"\n-  },\n-  {\n-    \"name\": \"coerceToValidator\"\n-  },\n   {\n     \"name\": \"collectNativeNodes\"\n   },\n\n---\n file path A: packages/core/test/bundling/forms_template_driven/bundle.golden_symbols.json | file path B: packages/core/test/bundling/forms_template_driven/bundle.golden_symbols.json\n\n@@ -608,15 +608,9 @@\n   {\n     \"name\": \"cleanUpView\"\n   },\n-  {\n-    \"name\": \"coerceToAsyncValidator\"\n-  },\n   {\n     \"name\": \"coerceToBoolean\"\n   },\n-  {\n-    \"name\": \"coerceToValidator\"\n-  },\n   {\n     \"name\": \"collectNativeNodes\"\n   },\n\n---\n file path A: packages/forms/src/model/abstract_model.ts | file path B: packages/forms/src/model/abstract_model.ts\n\n@@ -372,7 +372,7 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n    *\n    * @internal\n    */\n-  private _composedValidatorFn: ValidatorFn|null;\n+  private _composedValidatorFn!: ValidatorFn|null;\n \n   /**\n    * Contains the result of merging asynchronous validators into a single validator function\n@@ -380,7 +380,7 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n    *\n    * @internal\n    */\n-  private _composedAsyncValidatorFn: AsyncValidatorFn|null;\n+  private _composedAsyncValidatorFn!: AsyncValidatorFn|null;\n \n   /**\n    * Synchronous validators as they were provided:\n@@ -390,7 +390,7 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n    *\n    * @internal\n    */\n-  private _rawValidators: ValidatorFn|ValidatorFn[]|null;\n+  private _rawValidators!: ValidatorFn|ValidatorFn[]|null;\n \n   /**\n    * Asynchronous validators as they were provided:\n@@ -401,7 +401,7 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n    *\n    * @internal\n    */\n-  private _rawAsyncValidators: AsyncValidatorFn|AsyncValidatorFn[]|null;\n+  private _rawAsyncValidators!: AsyncValidatorFn|AsyncValidatorFn[]|null;\n \n   /**\n    * The current value of the control.\n@@ -427,10 +427,8 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n   constructor(\n       validators: ValidatorFn|ValidatorFn[]|null,\n       asyncValidators: AsyncValidatorFn|AsyncValidatorFn[]|null) {\n-    this._rawValidators = validators;\n-    this._rawAsyncValidators = asyncValidators;\n-    this._composedValidatorFn = coerceToValidator(this._rawValidators);\n-    this._composedAsyncValidatorFn = coerceToAsyncValidator(this._rawAsyncValidators);\n+    this.setValidators(validators);\n+    this.setAsyncValidators(asyncValidators);\n   }\n \n   /**\n@@ -620,8 +618,8 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n    * using `addValidators()` method instead.\n    */\n   setValidators(validators: ValidatorFn|ValidatorFn[]|null): void {\n-    this._rawValidators = validators;\n-    this._composedValidatorFn = coerceToValidator(validators);\n+    this._rawValidators = Array.isArray(validators) ? validators.slice() : validators;\n+    this._composedValidatorFn = coerceToValidator(this._rawValidators);\n   }\n \n   /**\n@@ -635,8 +633,8 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n    * using `addAsyncValidators()` method instead.\n    */\n   setAsyncValidators(validators: AsyncValidatorFn|AsyncValidatorFn[]|null): void {\n-    this._rawAsyncValidators = validators;\n-    this._composedAsyncValidatorFn = coerceToAsyncValidator(validators);\n+    this._rawAsyncValidators = Array.isArray(validators) ? validators.slice() : validators;\n+    this._composedAsyncValidatorFn = coerceToAsyncValidator(this._rawAsyncValidators);\n   }\n \n   /**\n\n---\n file path A: packages/forms/test/form_control_spec.ts | file path B: packages/forms/test/form_control_spec.ts\n\n@@ -266,6 +266,16 @@ describe('FormControl', () => {\n       expect(c.valid).toEqual(true);\n     });\n \n+    it('should not mutate the validators array when overriding using setValidators', () => {\n+      const control = new FormControl('');\n+      const originalValidators = [Validators.required];\n+\n+      control.setValidators(originalValidators);\n+      control.addValidators(Validators.minLength(10));\n+\n+      expect(originalValidators.length).toBe(1);\n+    });\n+\n     it('should override validators by setting `control.validator` field value', () => {\n       const c = new FormControl('');\n       expect(c.valid).toEqual(true);\n@@ -357,6 +367,30 @@ describe('FormControl', () => {\n       expect(c.hasValidator(Validators.required)).toEqual(false);\n     });\n \n+    it('should not mutate the validators array when adding/removing sync validators', () => {\n+      const originalValidators = [Validators.required];\n+      const control = new FormControl('', originalValidators);\n+\n+      control.addValidators(Validators.min(10));\n+      expect(originalValidators.length).toBe(1);\n+\n+      control.removeValidators(Validators.required);\n+      expect(originalValidators.length).toBe(1);\n+    });\n+\n+    it('should not mutate the validators array when adding/removing async validators', () => {\n+      const firstValidator = asyncValidator('one');\n+      const secondValidator = asyncValidator('two');\n+      const originalValidators = [firstValidator];\n+      const control = new FormControl('', null, originalValidators);\n+\n+      control.addAsyncValidators(secondValidator);\n+      expect(originalValidators.length).toBe(1);\n+\n+      control.removeAsyncValidators(firstValidator);\n+      expect(originalValidators.length).toBe(1);\n+    });\n+\n     it('should return false when checking presence of a validator not identical by reference',\n        () => {\n          const minValidator = Validators.min(5);\n@@ -518,6 +552,16 @@ describe('FormControl', () => {\n          expect(c.valid).toEqual(true);\n        }));\n \n+    it('should not mutate the validators array when overriding using setValidators', () => {\n+      const control = new FormControl('');\n+      const originalValidators = [asyncValidator('one')];\n+\n+      control.setAsyncValidators(originalValidators);\n+      control.addAsyncValidators(asyncValidator('two'));\n+\n+      expect(originalValidators.length).toBe(1);\n+    });\n+\n     it('should override validators by setting `control.asyncValidator` field value',\n        fakeAsync(() => {\n          const c = new FormControl('');\n\n\n###\n\n", "completion": "fix(forms): don't mutate validators array (#<issue-num>)"}
{"prompt": " file path A: devtools/projects/shell-browser/src/app/ng-validate.ts | file path B: devtools/projects/shell-browser/src/app/ng-validate.ts\n\n@@ -14,7 +14,9 @@ window.addEventListener('message', (event: MessageEvent) => {\n   }\n });\n \n-const script = document.createElement('script');\n-script.src = chrome.runtime.getURL('app/detect_angular_for_extension_icon_bundle.js');\n-document.documentElement.appendChild(script);\n-document.documentElement.removeChild(script);\n+if (document.contentType === 'text/html') {\n+  const script = document.createElement('script');\n+  script.src = chrome.runtime.getURL('app/detect_angular_for_extension_icon_bundle.js');\n+  document.documentElement.appendChild(script);\n+  document.documentElement.removeChild(script);\n+}\n\n\n###\n\n", "completion": "fix(devtools): prevent devTools to load when not text/html document (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -133,11 +133,11 @@ export type CanActivateFn = (route: ActivatedRouteSnapshot, state: RouterStateSn\n // @public\n export interface CanDeactivate<T> {\n     // (undocumented)\n-    canDeactivate(component: T, currentRoute: ActivatedRouteSnapshot, currentState: RouterStateSnapshot, nextState?: RouterStateSnapshot): Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree;\n+    canDeactivate(component: T, currentRoute: ActivatedRouteSnapshot, currentState: RouterStateSnapshot, nextState: RouterStateSnapshot): Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree;\n }\n \n // @public\n-export type CanDeactivateFn<T> = (component: T, currentRoute: ActivatedRouteSnapshot, currentState: RouterStateSnapshot, nextState?: RouterStateSnapshot) => Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree;\n+export type CanDeactivateFn<T> = (component: T, currentRoute: ActivatedRouteSnapshot, currentState: RouterStateSnapshot, nextState: RouterStateSnapshot) => Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree;\n \n // @public\n export interface CanLoad {\n\n---\n file path A: packages/router/src/models.ts | file path B: packages/router/src/models.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {EnvironmentInjector, EnvironmentProviders, InjectionToken, NgModuleFactory, Provider, ProviderToken, Type} from '@angular/core';\n+import {EnvironmentInjector, EnvironmentProviders, InjectionToken, NgModuleFactory, Provider, Type} from '@angular/core';\n import {Observable} from 'rxjs';\n \n import {DeprecatedLoadChildren} from './deprecated_load_children';\n@@ -851,7 +851,7 @@ export type CanActivateChildFn = (childRoute: ActivatedRouteSnapshot, state: Rou\n export interface CanDeactivate<T> {\n   canDeactivate(\n       component: T, currentRoute: ActivatedRouteSnapshot, currentState: RouterStateSnapshot,\n-      nextState?: RouterStateSnapshot): Observable<boolean|UrlTree>|Promise<boolean|UrlTree>|boolean\n+      nextState: RouterStateSnapshot): Observable<boolean|UrlTree>|Promise<boolean|UrlTree>|boolean\n       |UrlTree;\n }\n \n@@ -864,7 +864,7 @@ export interface CanDeactivate<T> {\n  */\n export type CanDeactivateFn<T> =\n     (component: T, currentRoute: ActivatedRouteSnapshot, currentState: RouterStateSnapshot,\n-     nextState?: RouterStateSnapshot) =>\n+     nextState: RouterStateSnapshot) =>\n         Observable<boolean|UrlTree>|Promise<boolean|UrlTree>|boolean|UrlTree;\n \n /**\n\n\n###\n\n", "completion": "fix(router): correct type of nextState parameter in canDeactivate (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/render3/instructions/listener.ts | file path B: packages/core/src/render3/instructions/listener.ts\n\n@@ -9,7 +9,7 @@\n \n import {assertIndexInRange} from '../../util/assert';\n import {isObservable} from '../../util/lang';\n-import {PropertyAliasValue, TNode, TNodeFlags, TNodeType} from '../interfaces/node';\n+import {PropertyAliasValue, TNode, TNodeType} from '../interfaces/node';\n import {GlobalTargetResolver, Renderer} from '../interfaces/renderer';\n import {RElement} from '../interfaces/renderer_dom';\n import {isDirectiveHost} from '../interfaces/type_checks';\n@@ -31,7 +31,8 @@ import {getOrCreateLViewCleanup, getOrCreateTViewCleanup, handleError, loadCompo\n  *\n  * @param eventName Name of the event\n  * @param listenerFn The function to be called when event emits\n- * @param useCapture Whether or not to use capture in event listener\n+ * @param useCapture Whether or not to use capture in event listener - this argument is a reminder\n+ *     from the Renderer3 infrastructure and should be removed from the instruction arguments\n  * @param eventTargetResolver Function that returns global target information in case this listener\n  * should be attached to a global object like window, document or body\n  *\n@@ -44,8 +45,7 @@ export function \u0275\u0275listener(\n   const tView = getTView();\n   const tNode = getCurrentTNode()!;\n   listenerInternal(\n-      tView, lView, lView[RENDERER], tNode, eventName, listenerFn, !!useCapture,\n-      eventTargetResolver);\n+      tView, lView, lView[RENDERER], tNode, eventName, listenerFn, eventTargetResolver);\n   return \u0275\u0275listener;\n }\n \n@@ -77,7 +77,7 @@ export function \u0275\u0275syntheticHostListener(\n   const tView = getTView();\n   const currentDef = getCurrentDirectiveDef(tView.data);\n   const renderer = loadComponentRenderer(currentDef, tNode, lView);\n-  listenerInternal(tView, lView, renderer, tNode, eventName, listenerFn, false);\n+  listenerInternal(tView, lView, renderer, tNode, eventName, listenerFn);\n   return \u0275\u0275syntheticHostListener;\n }\n \n@@ -115,8 +115,7 @@ function findExistingListener(\n \n function listenerInternal(\n     tView: TView, lView: LView<{}|null>, renderer: Renderer, tNode: TNode, eventName: string,\n-    listenerFn: (e?: any) => any, useCapture: boolean,\n-    eventTargetResolver?: GlobalTargetResolver): void {\n+    listenerFn: (e?: any) => any, eventTargetResolver?: GlobalTargetResolver): void {\n   const isTNodeDirectiveHost = isDirectiveHost(tNode);\n   const firstCreatePass = tView.firstCreatePass;\n   const tCleanup: false|any[] = firstCreatePass && getOrCreateTViewCleanup(tView);\n\n\n###\n\n", "completion": "refactor(core): remove usage of the useCapture arg to the listener instruction (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/render3/node_manipulation.ts | file path B: packages/core/src/render3/node_manipulation.ts\n\n@@ -9,7 +9,7 @@\n import {ViewEncapsulation} from '../metadata/view';\n import {RendererStyleFlags2} from '../render/api_flags';\n import {addToArray, removeFromArray} from '../util/array_utils';\n-import {assertDefined, assertEqual, assertFunction, assertString} from '../util/assert';\n+import {assertDefined, assertEqual, assertFunction, assertNumber, assertString} from '../util/assert';\n import {escapeCommentText} from '../util/dom';\n \n import {assertLContainer, assertLView, assertParentView, assertProjectionSlots, assertTNodeForLView} from './assert';\n@@ -451,24 +451,16 @@ function processCleanups(tView: TView, lView: LView): void {\n   if (tCleanup !== null) {\n     for (let i = 0; i < tCleanup.length - 1; i += 2) {\n       if (typeof tCleanup[i] === 'string') {\n-        // This is a native DOM listener\n-        const idxOrTargetGetter = tCleanup[i + 1];\n-        const target = typeof idxOrTargetGetter === 'function' ?\n-            idxOrTargetGetter(lView) :\n-            unwrapRNode(lView[idxOrTargetGetter]);\n-        const listener = lCleanup[lastLCleanupIndex = tCleanup[i + 2]];\n-        const useCaptureOrSubIdx = tCleanup[i + 3];\n-        if (typeof useCaptureOrSubIdx === 'boolean') {\n-          // native DOM listener registered with Renderer3\n-          target.removeEventListener(tCleanup[i], listener, useCaptureOrSubIdx);\n+        // This is a native DOM listener. It will occupy 4 entries in the TCleanup array (hence i +=\n+        // 2 at the end of this block).\n+        const targetIdx = tCleanup[i + 3];\n+        ngDevMode && assertNumber(targetIdx, 'cleanup target must be a number');\n+        if (targetIdx >= 0) {\n+          // unregister\n+          lCleanup[lastLCleanupIndex = targetIdx]();\n         } else {\n-          if (useCaptureOrSubIdx >= 0) {\n-            // unregister\n-            lCleanup[lastLCleanupIndex = useCaptureOrSubIdx]();\n-          } else {\n-            // Subscription\n-            lCleanup[lastLCleanupIndex = -useCaptureOrSubIdx].unsubscribe();\n-          }\n+          // Subscription\n+          lCleanup[lastLCleanupIndex = -targetIdx].unsubscribe();\n         }\n         i += 2;\n       } else {\n\n\n###\n\n", "completion": "refactor(core): remove Renderer3-related cleanup code paths (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/assistant-to-the-branch-manager.yml | file path B: .github/workflows/assistant-to-the-branch-manager.yml\n\n@@ -16,6 +16,6 @@ jobs:\n       - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3.0.2\n         with:\n           persist-credentials: false\n-      - uses: angular/dev-infra/github-actions/branch-manager@aa4dcc8fa853e6b5f3345e6f1bac5255c7d7a871\n+      - uses: angular/dev-infra/github-actions/branch-manager@0c06b3d1a58ab12f4f9933efc78e33083d008d17\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n\n###\n\n", "completion": "build: update action version (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -19,7 +19,7 @@\n     \"build-local\": \"yarn ~~build\",\n     \"prebuild-local-ci\": \"yarn setup-local-ci\",\n     \"build-local-ci\": \"yarn ~~build --progress=false\",\n-    \"extract-cli-command-docs\": \"node tools/transforms/cli-docs-package/extract-cli-commands.js 23b229e89\",\n+    \"extract-cli-command-docs\": \"node tools/transforms/cli-docs-package/extract-cli-commands.js 6ccbc6b4c\",\n     \"lint\": \"yarn check-env && yarn docs-lint && ng lint && yarn example-lint && yarn tools-lint && yarn security-lint\",\n     \"test\": \"yarn check-env && ng test\",\n     \"test:bazel\": \"bazelisk test //aio:test\",\n\n\n###\n\n", "completion": "build(docs-infra): upgrade cli command docs sources to 6ccbc6b4c (#<issue-num>)"}
{"prompt": " file path A: aio/tools/examples/shared/boilerplate/universal/package.json | file path B: aio/tools/examples/shared/boilerplate/universal/package.json\n\n@@ -37,7 +37,7 @@\n     \"@angular-devkit/build-angular\": \"^15.0.0-rc.1\",\n     \"@angular/cli\": \"^15.0.0-rc.1\",\n     \"@angular/compiler-cli\": \"^15.0.0-rc.1\",\n-    \"@nguniversal/builders\": \"^14.1.0\",\n+    \"@nguniversal/builders\": \"^15.0.0\",\n     \"@types/express\": \"^4.17.13\",\n     \"@types/jasmine\": \"~4.3.0\",\n     \"@types/node\": \"^16.11.35\",\n\n---\n file path A: aio/tools/examples/shared/package.json | file path B: aio/tools/examples/shared/package.json\n\n@@ -50,7 +50,7 @@\n     \"@angular-devkit/build-angular\": \"^15.0.0-rc.1\",\n     \"@angular/cli\": \"^15.0.0-rc.1\",\n     \"@angular/compiler-cli\": \"^15.0.0-rc.1\",\n-    \"@nguniversal/builders\": \"^14.1.0\",\n+    \"@nguniversal/builders\": \"^15.0.0\",\n     \"@rollup/plugin-commonjs\": \"^23.0.0\",\n     \"@rollup/plugin-node-resolve\": \"^13.2.0\",\n     \"@types/angular\": \"^1.8.4\",\n\n---\n file path A: aio/tools/examples/shared/yarn.lock | file path B: aio/tools/examples/shared/yarn.lock\n\n@@ -18,12 +18,12 @@\n     \"@angular-devkit/core\" \"15.0.0-rc.1\"\n     rxjs \"6.6.7\"\n \n-\"@angular-devkit/architect@^0.1401.0\":\n-  version \"0.1401.3\"\n-  resolved \"https://registry.yarnpkg.com/@angular-devkit/architect/-/architect-0.1401.3.tgz#ce1eb086c25051021a12fdf5a6c8351ca8f29443\"\n-  integrity sha512-DQvKfl8Q9c02jpGqZX1nOL4mAnRBU6BSqPlhi1q17ZrB8sQpYtDBb8Epn2DDq48l7SQVFnRg6Zgje9L1LObURg==\n+\"@angular-devkit/architect@^0.1500.0-next.0\":\n+  version \"0.1500.0\"\n+  resolved \"https://registry.yarnpkg.com/@angular-devkit/architect/-/architect-0.1500.0.tgz#50e0037268b5848bef3cb9d4766b0648dba67a87\"\n+  integrity sha512-jruRPfGQ2IU6TALyZcNTZG0MiOg5G/0axcqAmrb/1rJt5qb1vr74HQ8v0nBNQSVnk8swU+nXOdj3lX+xY7y4WA==\n   dependencies:\n-    \"@angular-devkit/core\" \"14.1.3\"\n+    \"@angular-devkit/core\" \"15.0.0\"\n     rxjs \"6.6.7\"\n \n \"@angular-devkit/build-angular@^15.0.0-rc.1\":\n@@ -102,14 +102,14 @@\n     \"@angular-devkit/architect\" \"0.1500.0-rc.1\"\n     rxjs \"6.6.7\"\n \n-\"@angular-devkit/core@14.1.3\", \"@angular-devkit/core@^14.1.0\":\n-  version \"14.1.3\"\n-  resolved \"https://registry.yarnpkg.com/@angular-devkit/core/-/core-14.1.3.tgz#5dc9a7917bed82a02efc20a4847f5eb6a55b699b\"\n-  integrity sha512-YBxhRl7hKgirjcKeurfejVrIgmw31GcfKKCyQiIudoLCYjonnSMdDEx2y8BNMANvxe5YmuZsIYJtgVlqp3mMDg==\n+\"@angular-devkit/core@15.0.0\", \"@angular-devkit/core@^15.0.0-next.0\":\n+  version \"15.0.0\"\n+  resolved \"https://registry.yarnpkg.com/@angular-devkit/core/-/core-15.0.0.tgz#6b6db4ca7998167f1fb58086e9b4349c7774ddc9\"\n+  integrity sha512-2Mg1+eyodO7od2Ax0EaArmm3rDzI2O00pBNU2Upz5hTfHcsqXlPzX5aYjWBiL1lBM0xYLY99dZqSdcQBMZy/Qg==\n   dependencies:\n     ajv \"8.11.0\"\n     ajv-formats \"2.1.1\"\n-    jsonc-parser \"3.1.0\"\n+    jsonc-parser \"3.2.0\"\n     rxjs \"6.6.7\"\n     source-map \"0.7.4\"\n \n@@ -1579,30 +1579,30 @@\n   resolved \"https://registry.yarnpkg.com/@ngtools/webpack/-/webpack-15.0.0-rc.1.tgz#74d1503270b48e35bfe1c45de42ebeedf8c4d791\"\n   integrity sha512-2CXuX78AaR6w6jlLutszd5fDsxQ+TCrJ6v4SRiYUS2jFXtZwxyqlZjTKQJxuRhTYdMVxTZ8/gVQrQ7XwfHF7cg==\n \n-\"@nguniversal/builders@^14.1.0\":\n-  version \"14.1.0\"\n-  resolved \"https://registry.yarnpkg.com/@nguniversal/builders/-/builders-14.1.0.tgz#eaff401cfd2d9886fcf35d0f5f0b5518c77a5782\"\n-  integrity sha512-TOOV7P7+zJ2739Ty7BazV7V9q1sF+kiJmV3c3ZqXFeNoNG6CYtX52cAPM/OkuU9JFER/JNUtNBCDihEdQquI3Q==\n-  dependencies:\n-    \"@angular-devkit/architect\" \"^0.1401.0\"\n-    \"@angular-devkit/core\" \"^14.1.0\"\n-    \"@nguniversal/common\" \"14.1.0\"\n-    browser-sync \"^2.26.7\"\n-    express \"^4.17.1\"\n-    guess-parser \"^0.4.12\"\n-    http-proxy-middleware \"^2.0.0\"\n+\"@nguniversal/builders@^15.0.0\":\n+  version \"15.0.0\"\n+  resolved \"https://registry.yarnpkg.com/@nguniversal/builders/-/builders-15.0.0.tgz#f765f7e98dc6e76d3e4c316035cadf0e2db49651\"\n+  integrity sha512-MEgKIhbbut933InHhogoNKSZXh7NigPIWHBFk7P7tSOfdu55nuO4WlR5lcTC7KbkqMmQOAtJP54XLdKS7hhFxg==\n+  dependencies:\n+    \"@angular-devkit/architect\" \"^0.1500.0-next.0\"\n+    \"@angular-devkit/core\" \"^15.0.0-next.0\"\n+    \"@nguniversal/common\" \"15.0.0\"\n+    browser-sync \"^2.27.10\"\n+    express \"^4.18.2\"\n+    guess-parser \"^0.4.22\"\n+    http-proxy-middleware \"^2.0.6\"\n     ora \"^5.1.0\"\n     piscina \"~3.2.0\"\n     rxjs \"^6.5.5\"\n     tree-kill \"^1.2.2\"\n \n-\"@nguniversal/common@14.1.0\":\n-  version \"14.1.0\"\n-  resolved \"https://registry.yarnpkg.com/@nguniversal/common/-/common-14.1.0.tgz#77029fc0495695cae986b9e569763aa214acbb49\"\n-  integrity sha512-h2GhKrrSIGHDhzhOcYy+MFiFIzl8MbRLs1FBLW3/YdbPpr2Cf5qDPMHIw/d8+FqDT5eHIoYGds35qGruoG4+GA==\n+\"@nguniversal/common@15.0.0\":\n+  version \"15.0.0\"\n+  resolved \"https://registry.yarnpkg.com/@nguniversal/common/-/common-15.0.0.tgz#c8d4ddbdbf1297a3c91cd83f38fdd24446e32194\"\n+  integrity sha512-RSlCSS5HejFoH/T6hpRIkTG1JzYEIxRgxsSxVyyPhGGRS4ouBzy4vEVkuIKwiYgVMBIGljJLelb38IsChTJsRg==\n   dependencies:\n     critters \"0.0.16\"\n-    jsdom \"20.0.0\"\n+    jsdom \"20.0.2\"\n     tslib \"^2.3.0\"\n \n \"@nguniversal/common@15.0.0-next.0\":\n@@ -2669,6 +2669,24 @@ body-parser@1.20.0, body-parser@^1.19.0:\n     type-is \"~1.6.18\"\n     unpipe \"1.0.0\"\n \n+body-parser@1.20.1:\n+  version \"1.20.1\"\n+  resolved \"https://registry.yarnpkg.com/body-parser/-/body-parser-1.20.1.tgz#b1812a8912c195cd371a3ee5e66faa2338a5c668\"\n+  integrity sha512-jWi7abTbYwajOytWCQc37VulmWiRae5RyTpaCyDcS5/lMdtwSz5lOpDE67srw/HYe35f1z3fDQw+3txg7gNtWw==\n+  dependencies:\n+    bytes \"3.1.2\"\n+    content-type \"~1.0.4\"\n+    debug \"2.6.9\"\n+    depd \"2.0.0\"\n+    destroy \"1.2.0\"\n+    http-errors \"2.0.0\"\n+    iconv-lite \"0.4.24\"\n+    on-finished \"2.4.1\"\n+    qs \"6.11.0\"\n+    raw-body \"2.5.1\"\n+    type-is \"~1.6.18\"\n+    unpipe \"1.0.0\"\n+\n bonjour-service@^1.0.11:\n   version \"1.0.13\"\n   resolved \"https://registry.yarnpkg.com/bonjour-service/-/bonjour-service-1.0.13.tgz#4ac003dc1626023252d58adf2946f57e5da450c1\"\n@@ -2734,7 +2752,7 @@ browser-sync-ui@^2.27.10:\n     socket.io-client \"^4.4.1\"\n     stream-throttle \"^0.1.3\"\n \n-browser-sync@^2.26.13, browser-sync@^2.26.7:\n+browser-sync@^2.26.13, browser-sync@^2.27.10:\n   version \"2.27.10\"\n   resolved \"https://registry.yarnpkg.com/browser-sync/-/browser-sync-2.27.10.tgz#3568d4f66afb0f68fee4a10902ecbbe8b2f680dd\"\n   integrity sha512-xKm+6KJmJu6RuMWWbFkKwOCSqQOxYe3nOrFkKI5Tr/ZzjPxyU3pFShKK3tWnazBo/3lYQzN7fzjixG8fwJh1Xw==\n@@ -3493,7 +3511,7 @@ decamelize@^1.2.0:\n   resolved \"https://registry.yarnpkg.com/decamelize/-/decamelize-1.2.0.tgz#f6534d15148269b20352e7bee26f501f9a191290\"\n   integrity sha512-z2S+W9X73hAUUki+N+9Za2lBlun89zigOyGrsax+KUQ6wKW4ZoWpEYBkGhQjwAjjDCkWxhY0VKEhk8wzY7F5cA==\n \n-decimal.js@^10.2.1, decimal.js@^10.3.1:\n+decimal.js@^10.2.1:\n   version \"10.3.1\"\n   resolved \"https://registry.yarnpkg.com/decimal.js/-/decimal.js-10.3.1.tgz#d8c3a444a9c6774ba60ca6ad7261c3a94fd5e783\"\n   integrity sha512-V0pfhfr8suzyPGOx3nmq4aHqabehUZn6Ch9kyFpV79TGDTWFmHqUqXdabR7QHqxzrYolF4+tVmJhUG4OURg5dQ==\n@@ -3829,11 +3847,6 @@ entities@^2.0.0:\n   resolved \"https://registry.yarnpkg.com/entities/-/entities-2.2.0.tgz#098dc90ebb83d8dffa089d55256b351d34c4da55\"\n   integrity sha512-p92if5Nz619I0w+akJrLZH0MX0Pb5DX39XOwQTtXSdQQOaYH03S1uIQp4mhOZtAXrxq4ViO67YTiLBo2638o9A==\n \n-entities@^4.3.0:\n-  version \"4.3.1\"\n-  resolved \"https://registry.yarnpkg.com/entities/-/entities-4.3.1.tgz#c34062a94c865c322f9d67b4384e4169bcede6a4\"\n-  integrity sha512-o4q/dYJlmyjP2zfnaWDUC6A3BQFmVTX+tZPezK7k0GLSU9QYCauscf5Y+qcEPzKL+EixVouYDgLQK5H9GrLpkg==\n-\n entities@^4.4.0:\n   version \"4.4.0\"\n   resolved \"https://registry.yarnpkg.com/entities/-/entities-4.4.0.tgz#97bdaba170339446495e653cfd2db78962900174\"\n@@ -4125,7 +4138,7 @@ exit@^0.1.2:\n   resolved \"https://registry.yarnpkg.com/exit/-/exit-0.1.2.tgz#0632638f8d877cc82107d30a0fff1a17cba1cd0c\"\n   integrity sha512-Zk/eNKV2zbjpKzrsQ+n1G6poVbErQxJ0LBOJXaKZ1EViLzH+hrLu9cdXI4zw9dBQJslwBEpbQ2P1oS7nDxs6jQ==\n \n-express@^4.17.1, express@^4.17.3, express@^4.18.1:\n+express@^4.17.3, express@^4.18.1:\n   version \"4.18.1\"\n   resolved \"https://registry.yarnpkg.com/express/-/express-4.18.1.tgz#7797de8b9c72c857b9cd0e14a5eea80666267caf\"\n   integrity sha512-zZBcOX9TfehHQhtupq57OF8lFZ3UZi08Y97dwFCkD8p9d/d2Y3M+ykKcwaMDEL+4qyUolgBDX6AblpR3fL212Q==\n@@ -4162,6 +4175,43 @@ express@^4.17.1, express@^4.17.3, express@^4.18.1:\n     utils-merge \"1.0.1\"\n     vary \"~1.1.2\"\n \n+express@^4.18.2:\n+  version \"4.18.2\"\n+  resolved \"https://registry.yarnpkg.com/express/-/express-4.18.2.tgz#3fabe08296e930c796c19e3c516979386ba9fd59\"\n+  integrity sha512-5/PsL6iGPdfQ/lKM1UuielYgv3BUoJfz1aUwU9vHZ+J7gyvwdQXFEBIEIaxeGf0GIcreATNyBExtalisDbuMqQ==\n+  dependencies:\n+    accepts \"~1.3.8\"\n+    array-flatten \"1.1.1\"\n+    body-parser \"1.20.1\"\n+    content-disposition \"0.5.4\"\n+    content-type \"~1.0.4\"\n+    cookie \"0.5.0\"\n+    cookie-signature \"1.0.6\"\n+    debug \"2.6.9\"\n+    depd \"2.0.0\"\n+    encodeurl \"~1.0.2\"\n+    escape-html \"~1.0.3\"\n+    etag \"~1.8.1\"\n+    finalhandler \"1.2.0\"\n+    fresh \"0.5.2\"\n+    http-errors \"2.0.0\"\n+    merge-descriptors \"1.0.1\"\n+    methods \"~1.1.2\"\n+    on-finished \"2.4.1\"\n+    parseurl \"~1.3.3\"\n+    path-to-regexp \"0.1.7\"\n+    proxy-addr \"~2.0.7\"\n+    qs \"6.11.0\"\n+    range-parser \"~1.2.1\"\n+    safe-buffer \"5.2.1\"\n+    send \"0.18.0\"\n+    serve-static \"1.15.0\"\n+    setprototypeof \"1.2.0\"\n+    statuses \"2.0.1\"\n+    type-is \"~1.6.18\"\n+    utils-merge \"1.0.1\"\n+    vary \"~1.1.2\"\n+\n extend@^3.0.0, extend@~3.0.2:\n   version \"3.0.2\"\n   resolved \"https://registry.yarnpkg.com/extend/-/extend-3.0.2.tgz#f8b1136b4071fbd8eb140aff858b1019ec2915fa\"\n@@ -4560,7 +4610,7 @@ graceful-fs@^4.1.2, graceful-fs@^4.1.6, graceful-fs@^4.2.0, graceful-fs@^4.2.4,\n   resolved \"https://registry.yarnpkg.com/graceful-fs/-/graceful-fs-4.2.10.tgz#147d3a006da4ca3ce14728c7aefc287c367d7a6c\"\n   integrity sha512-9ByhssR2fPVsNZj478qUUbKfmL0+t5BDVyjShtyZZLiK7ZDAArFFfopyOTj0M05wE2tJPisA4iTnnXl2YoPvOA==\n \n-guess-parser@^0.4.12:\n+guess-parser@^0.4.22:\n   version \"0.4.22\"\n   resolved \"https://registry.yarnpkg.com/guess-parser/-/guess-parser-0.4.22.tgz#c26ab9e21b69bbc761960c5a1511476ae85428eb\"\n   integrity sha512-KcUWZ5ACGaBM69SbqwVIuWGoSAgD+9iJnchR9j/IarVI1jHVeXv+bUXBIMeqVMSKt3zrn0Dgf9UpcOEpPBLbSg==\n@@ -4754,7 +4804,7 @@ http-proxy-agent@^5.0.0:\n     agent-base \"6\"\n     debug \"4\"\n \n-http-proxy-middleware@^2.0.0, http-proxy-middleware@^2.0.3:\n+http-proxy-middleware@^2.0.3, http-proxy-middleware@^2.0.6:\n   version \"2.0.6\"\n   resolved \"https://registry.yarnpkg.com/http-proxy-middleware/-/http-proxy-middleware-2.0.6.tgz#e1a4dd6979572c7ab5a4e4b55095d1f32a74963f\"\n   integrity sha512-ya/UeJ6HVBYxrgYotAZo1KvPWlgB48kUJLDePFeneHsVujFaW5WNj2NgWCAE//B1Dl02BIfYlpNgBy8Kf8Rjmw==\n@@ -5292,18 +5342,18 @@ jsbn@~0.1.0:\n   resolved \"https://registry.yarnpkg.com/jsbn/-/jsbn-0.1.1.tgz#a5e654c2e5a2deb5f201d96cefbca80c0ef2f513\"\n   integrity sha512-UVU9dibq2JcFWxQPA6KCqj5O42VOmAY3zQUfEKxU0KpTGXwNoCjkX1e13eHNvw/xPynt6pU0rZ1htjWTNTSXsg==\n \n-jsdom@20.0.0:\n-  version \"20.0.0\"\n-  resolved \"https://registry.yarnpkg.com/jsdom/-/jsdom-20.0.0.tgz#882825ac9cc5e5bbee704ba16143e1fa78361ebf\"\n-  integrity sha512-x4a6CKCgx00uCmP+QakBDFXwjAJ69IkkIWHmtmjd3wvXPcdOS44hfX2vqkOQrVrq8l9DhNNADZRXaCEWvgXtVA==\n+jsdom@20.0.1:\n+  version \"20.0.1\"\n+  resolved \"https://registry.yarnpkg.com/jsdom/-/jsdom-20.0.1.tgz#d95b4a3b6e1eec6520aa01d9d908eade8c6ba153\"\n+  integrity sha512-pksjj7Rqoa+wdpkKcLzQRHhJCEE42qQhl/xLMUKHgoSejaKOdaXEAnqs6uDNwMl/fciHTzKeR8Wm8cw7N+g98A==\n   dependencies:\n     abab \"^2.0.6\"\n-    acorn \"^8.7.1\"\n-    acorn-globals \"^6.0.0\"\n+    acorn \"^8.8.0\"\n+    acorn-globals \"^7.0.0\"\n     cssom \"^0.5.0\"\n     cssstyle \"^2.3.0\"\n     data-urls \"^3.0.2\"\n-    decimal.js \"^10.3.1\"\n+    decimal.js \"^10.4.1\"\n     domexception \"^4.0.0\"\n     escodegen \"^2.0.0\"\n     form-data \"^4.0.0\"\n@@ -5311,24 +5361,23 @@ jsdom@20.0.0:\n     http-proxy-agent \"^5.0.0\"\n     https-proxy-agent \"^5.0.1\"\n     is-potential-custom-element-name \"^1.0.1\"\n-    nwsapi \"^2.2.0\"\n-    parse5 \"^7.0.0\"\n+    nwsapi \"^2.2.2\"\n+    parse5 \"^7.1.1\"\n     saxes \"^6.0.0\"\n     symbol-tree \"^3.2.4\"\n-    tough-cookie \"^4.0.0\"\n-    w3c-hr-time \"^1.0.2\"\n+    tough-cookie \"^4.1.2\"\n     w3c-xmlserializer \"^3.0.0\"\n     webidl-conversions \"^7.0.0\"\n     whatwg-encoding \"^2.0.0\"\n     whatwg-mimetype \"^3.0.0\"\n     whatwg-url \"^11.0.0\"\n-    ws \"^8.8.0\"\n+    ws \"^8.9.0\"\n     xml-name-validator \"^4.0.0\"\n \n-jsdom@20.0.1:\n-  version \"20.0.1\"\n-  resolved \"https://registry.yarnpkg.com/jsdom/-/jsdom-20.0.1.tgz#d95b4a3b6e1eec6520aa01d9d908eade8c6ba153\"\n-  integrity sha512-pksjj7Rqoa+wdpkKcLzQRHhJCEE42qQhl/xLMUKHgoSejaKOdaXEAnqs6uDNwMl/fciHTzKeR8Wm8cw7N+g98A==\n+jsdom@20.0.2:\n+  version \"20.0.2\"\n+  resolved \"https://registry.yarnpkg.com/jsdom/-/jsdom-20.0.2.tgz#65ccbed81d5e877c433f353c58bb91ff374127db\"\n+  integrity sha512-AHWa+QO/cgRg4N+DsmHg1Y7xnz+8KU3EflM0LVDTdmrYOc1WWTSkOjtpUveQH+1Bqd5rtcVnb/DuxV/UjDO4rA==\n   dependencies:\n     abab \"^2.0.6\"\n     acorn \"^8.8.0\"\n@@ -5435,11 +5484,6 @@ json5@^2.1.2, json5@^2.2.1:\n   resolved \"https://registry.yarnpkg.com/json5/-/json5-2.2.1.tgz#655d50ed1e6f95ad1a3caababd2b0efda10b395c\"\n   integrity sha512-1hqLFMSrGHRHxav9q9gNjJ5EXznIxGVO09xQRrwplcS8qs28pZ8s8hupZAmqDwZUmVZ2Qb2jnyPOWcDH8m8dlA==\n \n-jsonc-parser@3.1.0:\n-  version \"3.1.0\"\n-  resolved \"https://registry.yarnpkg.com/jsonc-parser/-/jsonc-parser-3.1.0.tgz#73b8f0e5c940b83d03476bc2e51a20ef0932615d\"\n-  integrity sha512-DRf0QjnNeCUds3xTjKlQQ3DpJD51GvDjJfnxUVWg6PZTo2otSm+slzNAxU/35hF8/oJIKoG9slq30JYOsF2azg==\n-\n jsonc-parser@3.2.0:\n   version \"3.2.0\"\n   resolved \"https://registry.yarnpkg.com/jsonc-parser/-/jsonc-parser-3.2.0.tgz#31ff3f4c2b9793f89c67212627c51c6394f88e76\"\n@@ -6478,13 +6522,6 @@ parse5@6.0.1, parse5@^6.0.1:\n   resolved \"https://registry.yarnpkg.com/parse5/-/parse5-6.0.1.tgz#e1a1c085c569b3dc08321184f19a39cc27f7c30b\"\n   integrity sha512-Ofn/CTFzRGTTxwpNEs9PP93gXShHcTq255nzRYSKe8AkVpZY7e1fpmTfOyoIvjP5HG7Z2ZM7VS9PPhQGW2pOpw==\n \n-parse5@^7.0.0:\n-  version \"7.0.0\"\n-  resolved \"https://registry.yarnpkg.com/parse5/-/parse5-7.0.0.tgz#51f74a5257f5fcc536389e8c2d0b3802e1bfa91a\"\n-  integrity sha512-y/t8IXSPWTuRZqXc0ajH/UwDj4mnqLEbSttNbThcFhGrZuOyoyvNBO85PBp2jQa55wY9d07PBNjsK8ZP3K5U6g==\n-  dependencies:\n-    entities \"^4.3.0\"\n-\n parse5@^7.1.1:\n   version \"7.1.1\"\n   resolved \"https://registry.yarnpkg.com/parse5/-/parse5-7.1.1.tgz#4649f940ccfb95d8754f37f73078ea20afe0c746\"\n@@ -6817,18 +6854,18 @@ qs@6.10.3:\n   dependencies:\n     side-channel \"^1.0.4\"\n \n-qs@6.2.3:\n-  version \"6.2.3\"\n-  resolved \"https://registry.yarnpkg.com/qs/-/qs-6.2.3.tgz#1cfcb25c10a9b2b483053ff39f5dfc9233908cfe\"\n-  integrity sha512-AY4g8t3LMboim0t6XWFdz6J5OuJ1ZNYu54SXihS/OMpgyCqYmcAJnWqkNSOjSjWmq3xxy+GF9uWQI2lI/7tKIA==\n-\n-qs@^6.4.0:\n+qs@6.11.0, qs@^6.4.0:\n   version \"6.11.0\"\n   resolved \"https://registry.yarnpkg.com/qs/-/qs-6.11.0.tgz#fd0d963446f7a65e1367e01abd85429453f0c37a\"\n   integrity sha512-MvjoMCJwEarSbUYk5O+nmoSzSutSsTwF85zcHPQ9OrlFoZOYIjaqBAJIqIXjptyD5vThxGq52Xu/MaJzRkIk4Q==\n   dependencies:\n     side-channel \"^1.0.4\"\n \n+qs@6.2.3:\n+  version \"6.2.3\"\n+  resolved \"https://registry.yarnpkg.com/qs/-/qs-6.2.3.tgz#1cfcb25c10a9b2b483053ff39f5dfc9233908cfe\"\n+  integrity sha512-AY4g8t3LMboim0t6XWFdz6J5OuJ1ZNYu54SXihS/OMpgyCqYmcAJnWqkNSOjSjWmq3xxy+GF9uWQI2lI/7tKIA==\n+\n qs@~6.5.2:\n   version \"6.5.3\"\n   resolved \"https://registry.yarnpkg.com/qs/-/qs-6.5.3.tgz#3aeeffc91967ef6e35c0e488ef46fb296ab76aad\"\n@@ -8637,11 +8674,6 @@ ws@^8.4.2:\n   resolved \"https://registry.yarnpkg.com/ws/-/ws-8.8.0.tgz#8e71c75e2f6348dbf8d78005107297056cb77769\"\n   integrity sha512-JDAgSYQ1ksuwqfChJusw1LSJ8BizJ2e/vVu5Lxjq3YvNJNlROv1ui4i+c/kUUrPheBvQl4c5UbERhTwKa6QBJQ==\n \n-ws@^8.8.0:\n-  version \"8.8.1\"\n-  resolved \"https://registry.yarnpkg.com/ws/-/ws-8.8.1.tgz#5dbad0feb7ade8ecc99b830c1d77c913d4955ff0\"\n-  integrity sha512-bGy2JzvzkPowEJV++hF07hAD6niYSr0JzBNo/J29WsB57A2r7Wlc1UFcTR9IzrPvuNVO4B8LGqF8qcpsVOhJCA==\n-\n ws@^8.9.0:\n   version \"8.10.0\"\n   resolved \"https://registry.yarnpkg.com/ws/-/ws-8.10.0.tgz#00a28c09dfb76eae4eb45c3b565f771d6951aa51\"\n\n\n###\n\n", "completion": "build: update dependency @nguniversal/builders to v15 (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/deprecations.md | file path B: aio/content/guide/deprecations.md\n\n@@ -115,6 +115,7 @@ v15 - v18\n | `@angular/common`                   | [`DatePipe` - `DATE_PIPE_DEFAULT_TIMEZONE`](api/common/DATE_PIPE_DEFAULT_TIMEZONE)                         | v15           | v17         |\n | `@angular/core`                     | NgModule and `'any'` options for [`providedIn`](#core)                                                     | v15           | v17         |\n | `@angular/router`                   | [`RouterLinkWithHref` directive](#router)                                                                  | v15           | v17         |\n+| `@angular/router`                   | [Router writeable properties](#router-writable-properties)                                                 | v15.1         | v17         |\n \n ### Deprecated features with no planned removal version\n \n@@ -375,6 +376,33 @@ The injector no longer requires the Reflect polyfill, reducing application size\n \n <code-example path=\"deprecation-guide/src/app/app.component.ts\" language=\"typescript\" region=\"static-injector-example\"></code-example>\n \n+<a id=\"router-writable-properties\"></a>\n+\n+None of the public properties of the `Router` are meant to be writeable.\n+They should all be configured using other methods, all of which have been\n+documented.\n+\n+The following strategies are meant to be configured by registering the\n+application strategy in DI via the `providers` in the root `NgModule` or\n+`bootstrapApplication`:\n+* `routeReuseStrategy`\n+* `titleStrategy`\n+* `urlHandlingStrategy`\n+\n+The following options are meant to be configured using the options\n+available in `RouterModule.forRoot` or `provideRouter` and `withRouterConfig`.\n+* `onSameUrlNavigation`\n+* `paramsInheritanceStrategy`\n+* `urlUpdateStrategy`\n+* `canceledNavigationResolution`\n+\n+The following options are available in `RouterModule.forRoot` but not\n+available in `provideRouter`:\n+* `malformedUriErrorHandler` - This was not found to be used by anyone.\n+  There are currently no plans to make this available in `provideRouter`.\n+* `errorHandler` - Developers should instead subscribe to `Router.events`\n+  and filter for `NavigationError`.\n+\n <a id=\"relativeLinkResolution\"></a>\n \n The `relativeLinkResolution` option is deprecated and being removed.\n\n---\n file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -630,11 +630,13 @@ export class RouteConfigLoadStart {\n // @public\n export class Router {\n     constructor(rootComponentType: Type<any> | null, urlSerializer: UrlSerializer, rootContexts: ChildrenOutletContexts, location: Location_2, injector: Injector, compiler: Compiler, config: Routes);\n+    // @deprecated\n     canceledNavigationResolution: 'replace' | 'computed';\n     // (undocumented)\n     config: Routes;\n     createUrlTree(commands: any[], navigationExtras?: UrlCreationOptions): UrlTree;\n     dispose(): void;\n+    // @deprecated\n     errorHandler: ErrorHandler;\n     readonly events: Observable<Event_2>;\n     getCurrentNavigation(): Navigation | null;\n@@ -642,23 +644,30 @@ export class Router {\n     // @deprecated\n     isActive(url: string | UrlTree, exact: boolean): boolean;\n     isActive(url: string | UrlTree, matchOptions: IsActiveMatchOptions): boolean;\n+    // @deprecated\n     malformedUriErrorHandler: (error: URIError, urlSerializer: UrlSerializer, url: string) => UrlTree;\n     navigate(commands: any[], extras?: NavigationExtras): Promise<boolean>;\n     navigateByUrl(url: string | UrlTree, extras?: NavigationBehaviorOptions): Promise<boolean>;\n     navigated: boolean;\n     // (undocumented)\n     ngOnDestroy(): void;\n+    // @deprecated\n     onSameUrlNavigation: 'reload' | 'ignore';\n+    // @deprecated\n     paramsInheritanceStrategy: 'emptyOnly' | 'always';\n     parseUrl(url: string): UrlTree;\n     resetConfig(config: Routes): void;\n+    // @deprecated\n     routeReuseStrategy: RouteReuseStrategy;\n     readonly routerState: RouterState;\n     serializeUrl(url: UrlTree): string;\n     setUpLocationChangeListener(): void;\n+    // @deprecated\n     titleStrategy?: TitleStrategy;\n     get url(): string;\n+    // @deprecated\n     urlHandlingStrategy: UrlHandlingStrategy;\n+    // @deprecated\n     urlUpdateStrategy: 'deferred' | 'eager';\n     // (undocumented)\n     static \u0275fac: i0.\u0275\u0275FactoryDeclaration<Router, never>;\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -429,6 +429,8 @@ export class Router {\n \n   /**\n    * A handler for navigation errors in this NgModule.\n+   *\n+   * @deprecated Subscribe to the `Router` events and watch for `NavigationError` instead.\n    */\n   errorHandler: ErrorHandler = defaultErrorHandler;\n \n@@ -437,6 +439,10 @@ export class Router {\n    * when `url` contains an invalid character.\n    * The most common case is a `%` sign\n    * that's not encoded and is not part of a percent encoded sequence.\n+   *\n+   * @deprecated Configure this through `RouterModule.forRoot` instead:\n+   *   `RouterModule.forRoot(routes, {malformedUriErrorHandler: myHandler})`\n+   * @see `RouterModule`\n    */\n   malformedUriErrorHandler:\n       (error: URIError, urlSerializer: UrlSerializer,\n@@ -460,16 +466,25 @@ export class Router {\n   /**\n    * A strategy for extracting and merging URLs.\n    * Used for AngularJS to Angular migrations.\n+   *\n+   * @deprecated Configure using `providers` instead:\n+   *   `{provide: UrlHandlingStrategy, useClass: MyStrategy}`.\n    */\n   urlHandlingStrategy = inject(UrlHandlingStrategy);\n \n   /**\n    * A strategy for re-using routes.\n+   *\n+   * @deprecated Configure using `providers` instead:\n+   *   `{provide: RouteReuseStrategy, useClass: MyStrategy}`.\n    */\n   routeReuseStrategy = inject(RouteReuseStrategy);\n \n   /**\n    * A strategy for setting the title based on the `routerState`.\n+   *\n+   * @deprecated Configure using `providers` instead:\n+   *   `{provide: TitleStrategy, useClass: MyStrategy}`.\n    */\n   titleStrategy?: TitleStrategy = inject(TitleStrategy);\n \n@@ -485,6 +500,11 @@ export class Router {\n    * component first. This behavior is configured by the `RouteReuseStrategy`. In order to reload\n    * routed components on same url navigation, you need to set `onSameUrlNavigation` to `'reload'`\n    * _and_ provide a `RouteReuseStrategy` which returns `false` for `shouldReuseRoute`.\n+   *\n+   * @deprecated Configure this through `provideRouter` or `RouterModule.forRoot` instead.\n+   * @see `withRouterConfig`\n+   * @see `provideRouter`\n+   * @see `RouterModule`\n    */\n   onSameUrlNavigation: 'reload'|'ignore' = 'ignore';\n \n@@ -496,6 +516,11 @@ export class Router {\n    * for path-less or component-less routes.\n    * - `'always'` : Inherit parent parameters, data, and resolved data\n    * for all child routes.\n+   *\n+   * @deprecated Configure this through `provideRouter` or `RouterModule.forRoot` instead.\n+   * @see `withRouterConfig`\n+   * @see `provideRouter`\n+   * @see `RouterModule`\n    */\n   paramsInheritanceStrategy: 'emptyOnly'|'always' = 'emptyOnly';\n \n@@ -505,6 +530,11 @@ export class Router {\n    * Set to `'eager'` to update the browser URL at the beginning of navigation.\n    * You can choose to update early so that, if navigation fails,\n    * you can show an error message with the URL that failed.\n+   *\n+   * @deprecated Configure this through `provideRouter` or `RouterModule.forRoot` instead.\n+   * @see `withRouterConfig`\n+   * @see `provideRouter`\n+   * @see `RouterModule`\n    */\n   urlUpdateStrategy: 'deferred'|'eager' = 'deferred';\n \n@@ -529,6 +559,10 @@ export class Router {\n    *\n    * The default value is `replace`.\n    *\n+   * @deprecated Configure this through `provideRouter` or `RouterModule.forRoot` instead.\n+   * @see `withRouterConfig`\n+   * @see `provideRouter`\n+   * @see `RouterModule`\n    */\n   canceledNavigationResolution: 'replace'|'computed' = 'replace';\n \n\n\n###\n\n", "completion": "docs(router): Deprecate public members of Router that are meant to be configured elsewhere (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -690,6 +690,10 @@ export abstract class RouteReuseStrategy {\n     abstract shouldDetach(route: ActivatedRouteSnapshot): boolean;\n     abstract shouldReuseRoute(future: ActivatedRouteSnapshot, curr: ActivatedRouteSnapshot): boolean;\n     abstract store(route: ActivatedRouteSnapshot, handle: DetachedRouteHandle | null): void;\n+    // (undocumented)\n+    static \u0275fac: i0.\u0275\u0275FactoryDeclaration<RouteReuseStrategy, never>;\n+    // (undocumented)\n+    static \u0275prov: i0.\u0275\u0275InjectableDeclaration<RouteReuseStrategy>;\n }\n \n // @public\n@@ -941,6 +945,10 @@ export abstract class UrlHandlingStrategy {\n     abstract extract(url: UrlTree): UrlTree;\n     abstract merge(newUrlPart: UrlTree, rawUrl: UrlTree): UrlTree;\n     abstract shouldProcessUrl(url: UrlTree): boolean;\n+    // (undocumented)\n+    static \u0275fac: i0.\u0275\u0275FactoryDeclaration<UrlHandlingStrategy, never>;\n+    // (undocumented)\n+    static \u0275prov: i0.\u0275\u0275InjectableDeclaration<UrlHandlingStrategy>;\n }\n \n // @public\n\n---\n file path A: goldens/size-tracking/integration-payloads.json | file path B: goldens/size-tracking/integration-payloads.json\n\n@@ -33,7 +33,7 @@\n   \"cli-hello-world-lazy\": {\n     \"uncompressed\": {\n       \"runtime\": 2835,\n-      \"main\": 225113,\n+      \"main\": 225766,\n       \"polyfills\": 33842,\n       \"src_app_lazy_lazy_routes_ts\": 487\n     }\n\n---\n file path A: packages/core/test/bundling/router/bundle.golden_symbols.json | file path B: packages/core/test/bundling/router/bundle.golden_symbols.json\n\n@@ -125,9 +125,15 @@\n   {\n     \"name\": \"DefaultIfEmptySubscriber\"\n   },\n+  {\n+    \"name\": \"DefaultRouteReuseStrategy\"\n+  },\n   {\n     \"name\": \"DefaultTitleStrategy\"\n   },\n+  {\n+    \"name\": \"DefaultUrlHandlingStrategy\"\n+  },\n   {\n     \"name\": \"DefaultUrlSerializer\"\n   },\n@@ -464,6 +470,9 @@\n   {\n     \"name\": \"RootViewRef\"\n   },\n+  {\n+    \"name\": \"RouteReuseStrategy\"\n+  },\n   {\n     \"name\": \"RouteTitleKey\"\n   },\n@@ -617,6 +626,9 @@\n   {\n     \"name\": \"UnsubscriptionError\"\n   },\n+  {\n+    \"name\": \"UrlHandlingStrategy\"\n+  },\n   {\n     \"name\": \"UrlParser\"\n   },\n@@ -1088,6 +1100,9 @@\n   {\n     \"name\": \"getFactoryDef\"\n   },\n+  {\n+    \"name\": \"getFactoryOf\"\n+  },\n   {\n     \"name\": \"getFirstLContainer\"\n   },\n@@ -1346,6 +1361,9 @@\n   {\n     \"name\": \"isEnvironmentProviders\"\n   },\n+  {\n+    \"name\": \"isForwardRef\"\n+  },\n   {\n     \"name\": \"isFunction\"\n   },\n@@ -1526,6 +1544,9 @@\n   {\n     \"name\": \"noMatch2\"\n   },\n+  {\n+    \"name\": \"noSideEffects\"\n+  },\n   {\n     \"name\": \"nodeChildrenAsMap\"\n   },\n\n---\n file path A: packages/router/src/route_reuse_strategy.ts | file path B: packages/router/src/route_reuse_strategy.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {ComponentRef} from '@angular/core';\n+import {ComponentRef, inject, Injectable} from '@angular/core';\n \n import {OutletContext} from './router_outlet_context';\n import {ActivatedRoute, ActivatedRouteSnapshot} from './router_state';\n@@ -38,6 +38,7 @@ export type DetachedRouteHandleInternal = {\n  *\n  * @publicApi\n  */\n+@Injectable({providedIn: 'root', useFactory: () => inject(DefaultRouteReuseStrategy)})\n export abstract class RouteReuseStrategy {\n   /** Determines if this route (and its subtree) should be detached to be reused later */\n   abstract shouldDetach(route: ActivatedRouteSnapshot): boolean;\n@@ -110,4 +111,6 @@ export abstract class BaseRouteReuseStrategy implements RouteReuseStrategy {\n   }\n }\n \n-export class DefaultRouteReuseStrategy extends BaseRouteReuseStrategy {}\n+@Injectable({providedIn: 'root'})\n+export class DefaultRouteReuseStrategy extends BaseRouteReuseStrategy {\n+}\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -23,14 +23,14 @@ import {checkGuards} from './operators/check_guards';\n import {recognize} from './operators/recognize';\n import {resolveData} from './operators/resolve_data';\n import {switchTap} from './operators/switch_tap';\n-import {DefaultTitleStrategy, TitleStrategy} from './page_title_strategy';\n-import {DefaultRouteReuseStrategy, RouteReuseStrategy} from './route_reuse_strategy';\n+import {TitleStrategy} from './page_title_strategy';\n+import {RouteReuseStrategy} from './route_reuse_strategy';\n import {ErrorHandler, ExtraOptions, ROUTER_CONFIGURATION} from './router_config';\n import {RouterConfigLoader, ROUTES} from './router_config_loader';\n import {ChildrenOutletContexts} from './router_outlet_context';\n import {ActivatedRoute, ActivatedRouteSnapshot, createEmptyState, RouterState, RouterStateSnapshot} from './router_state';\n import {Params} from './shared';\n-import {DefaultUrlHandlingStrategy, UrlHandlingStrategy} from './url_handling_strategy';\n+import {UrlHandlingStrategy} from './url_handling_strategy';\n import {containsTree, IsActiveMatchOptions, isUrlTree, UrlSerializer, UrlTree} from './url_tree';\n import {flatten} from './utils/collection';\n import {standardizeConfig, validateConfig} from './utils/config';\n@@ -325,23 +325,9 @@ export function setupRouter() {\n   const compiler = inject(Compiler);\n   const config = inject(ROUTES, {optional: true}) ?? [];\n   const opts = inject(ROUTER_CONFIGURATION, {optional: true}) ?? {};\n-  const defaultTitleStrategy = inject(DefaultTitleStrategy);\n-  const titleStrategy = inject(TitleStrategy, {optional: true});\n-  const urlHandlingStrategy = inject(UrlHandlingStrategy, {optional: true});\n-  const routeReuseStrategy = inject(RouteReuseStrategy, {optional: true});\n   const router =\n       new Router(null, urlSerializer, contexts, location, injector, compiler, flatten(config));\n \n-  if (urlHandlingStrategy) {\n-    router.urlHandlingStrategy = urlHandlingStrategy;\n-  }\n-\n-  if (routeReuseStrategy) {\n-    router.routeReuseStrategy = routeReuseStrategy;\n-  }\n-\n-  router.titleStrategy = titleStrategy ?? defaultTitleStrategy;\n-\n   assignExtraOptionsToRouter(opts, router);\n \n   return router;\n@@ -475,17 +461,17 @@ export class Router {\n    * A strategy for extracting and merging URLs.\n    * Used for AngularJS to Angular migrations.\n    */\n-  urlHandlingStrategy: UrlHandlingStrategy = new DefaultUrlHandlingStrategy();\n+  urlHandlingStrategy = inject(UrlHandlingStrategy);\n \n   /**\n    * A strategy for re-using routes.\n    */\n-  routeReuseStrategy: RouteReuseStrategy = new DefaultRouteReuseStrategy();\n+  routeReuseStrategy = inject(RouteReuseStrategy);\n \n   /**\n    * A strategy for setting the title based on the `routerState`.\n    */\n-  titleStrategy?: TitleStrategy;\n+  titleStrategy?: TitleStrategy = inject(TitleStrategy);\n \n   /**\n    * How to handle a navigation request to the current URL. One of:\n\n---\n file path A: packages/router/src/url_handling_strategy.ts | file path B: packages/router/src/url_handling_strategy.ts\n\n@@ -6,6 +6,8 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {inject, Injectable} from '@angular/core';\n+\n import {UrlTree} from './url_tree';\n \n /**\n@@ -15,6 +17,7 @@ import {UrlTree} from './url_tree';\n  *\n  * @publicApi\n  */\n+@Injectable({providedIn: 'root', useFactory: () => inject(DefaultUrlHandlingStrategy)})\n export abstract class UrlHandlingStrategy {\n   /**\n    * Tells the router if this URL should be processed.\n@@ -41,6 +44,7 @@ export abstract class UrlHandlingStrategy {\n /**\n  * @publicApi\n  */\n+@Injectable({providedIn: 'root'})\n export class DefaultUrlHandlingStrategy implements UrlHandlingStrategy {\n   shouldProcessUrl(url: UrlTree): boolean {\n     return true;\n\n\n###\n\n", "completion": "refactor(router): Simplify router defaults by making the defaults Injectable (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -252,7 +252,6 @@ export interface NavigationTransition {\n   id: number;\n   targetPageId: number;\n   currentUrlTree: UrlTree;\n-  currentRawUrl: UrlTree;\n   extractedUrl: UrlTree;\n   urlAfterRedirects?: UrlTree;\n   rawUrl: UrlTree;\n@@ -577,7 +576,6 @@ export class Router {\n       id: 0,\n       targetPageId: 0,\n       currentUrlTree: this.currentUrlTree,\n-      currentRawUrl: this.currentUrlTree,\n       extractedUrl: this.urlHandlingStrategy.extract(this.currentUrlTree),\n       urlAfterRedirects: this.urlHandlingStrategy.extract(this.currentUrlTree),\n       rawUrl: this.currentUrlTree,\n@@ -1332,7 +1330,6 @@ export class Router {\n       resolve = priorPromise.resolve;\n       reject = priorPromise.reject;\n       promise = priorPromise.promise;\n-\n     } else {\n       promise = new Promise<boolean>((res, rej) => {\n         resolve = res;\n@@ -1372,7 +1369,6 @@ export class Router {\n       source,\n       restoredState,\n       currentUrlTree: this.currentUrlTree,\n-      currentRawUrl: this.rawUrlTree,\n       rawUrl,\n       extras,\n       resolve,\n\n\n###\n\n", "completion": "refactor(router): remove unused currentRawUrl property from transition (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -1382,11 +1382,7 @@ export class Router {\n       currentRouterState: this.routerState\n     });\n \n-    // Make sure that the error is propagated even though `processNavigations` catch\n-    // handler does not rethrow\n-    return promise.catch((e: any) => {\n-      return Promise.reject(e);\n-    });\n+    return promise;\n   }\n \n   private setBrowserUrl(url: UrlTree, t: NavigationTransition) {\n\n\n###\n\n", "completion": "refactor(router): Remove promise catch and re-reject (#<issue-num>)"}
{"prompt": " file path A: packages/language-service/src/codefixes/fix_missing_import.ts | file path B: packages/language-service/src/codefixes/fix_missing_import.ts\n\n@@ -12,7 +12,7 @@ import * as t from '@angular/compiler/src/render3/r3_ast';  // t for template AS\n import ts from 'typescript';\n \n import {getTargetAtPosition, TargetNodeKind} from '../template_target';\n-import {ensureArrayWithIdentifier, findAllMatchingNodes, findFirstMatchingNode, generateImport, hasImport, moduleSpecifierPointsToFile, nonCollidingImportName, printNode, updateImport, updateObjectValueForKey} from '../ts_utils';\n+import {standaloneTraitOrNgModule, updateImportsForAngularTrait, updateImportsForTypescriptFile} from '../ts_utils';\n import {getDirectiveMatchesForElementTag} from '../utils';\n \n import {CodeActionContext, CodeActionMeta, FixIdForCodeFixesAll} from './utils';\n@@ -52,19 +52,10 @@ function getCodeActions(\n   }\n   const missingElement = target.context.node;\n \n-  // The class which has an imports array; either a standalone trait or its owning NgModule.\n-  const componentDecorator = checker.getPrimaryAngularDecorator(templateInfo.component);\n-  if (componentDecorator == null) {\n+  const importOn = standaloneTraitOrNgModule(checker, templateInfo.component);\n+  if (importOn === null) {\n     return [];\n   }\n-  const owningNgModule = checker.getOwningNgModule(templateInfo.component);\n-  const isMarkedStandalone = isStandaloneDecorator(componentDecorator);\n-  if (owningNgModule === null && !isMarkedStandalone) {\n-    // TODO(dylhunn): This is a \"moduleless component.\" We should probably suggest the user add\n-    // `standalone: true`.\n-    return [];\n-  }\n-  const importOn = owningNgModule ?? templateInfo.component;\n \n   // Find all possible importable directives with a matching selector.\n   const allPossibleDirectives = checker.getPotentialTemplateDirectives(templateInfo.component);\n@@ -72,20 +63,13 @@ function getCodeActions(\n       getDirectiveMatchesForElementTag(missingElement, allPossibleDirectives);\n   const matches = matchingDirectives.values();\n \n-  // Generate suggestions for each possible match.\n   for (let currMatch of matches) {\n     const currMatchSymbol = currMatch.tsSymbol.valueDeclaration;\n-\n-    // Get possible trait imports corresponding to the recommended directive.\n     const potentialImports = checker.getPotentialImportsFor(currMatch, importOn);\n-\n-    // For each possible import specifier, create a suggestion.\n     for (let potentialImport of potentialImports) {\n-      // Update the imports on the TypeScript file and Angular decorator.\n       let [fileImportChanges, importName] = updateImportsForTypescriptFile(\n           tsChecker, importOn.getSourceFile(), potentialImport, currMatchSymbol.getSourceFile());\n       let traitImportChanges = updateImportsForAngularTrait(checker, importOn, importName);\n-\n       // All quick fixes should always update the trait import; however, the TypeScript import might\n       // already be present.\n       if (traitImportChanges.length === 0) {\n@@ -110,120 +94,3 @@ function getCodeActions(\n \n   return codeActions;\n }\n-\n-/**\n- * Updates the imports on a TypeScript file, by ensuring the provided import is present.\n- * Returns the text changes, as well as the name with which the imported symbol can be referred to.\n- */\n-function updateImportsForTypescriptFile(\n-    tsChecker: ts.TypeChecker, file: ts.SourceFile, newImport: PotentialImport,\n-    tsFileToImport: ts.SourceFile): [ts.TextChange[], string] {\n-  // If the expression is already imported, we can just return its name.\n-  if (newImport.moduleSpecifier === undefined) {\n-    return [[], newImport.symbolName];\n-  }\n-\n-  // The trait might already be imported, possibly under a different name. If so, determine the\n-  // local name of the imported trait.\n-  const allImports = findAllMatchingNodes(file, {filter: ts.isImportDeclaration});\n-  const existingImportName: string|null =\n-      hasImport(tsChecker, allImports, newImport.symbolName, tsFileToImport);\n-  if (existingImportName !== null) {\n-    return [[], existingImportName];\n-  }\n-\n-  // If the trait has not already been imported, we need to insert the new import.\n-  const existingImportDeclaration = allImports.find(\n-      decl => moduleSpecifierPointsToFile(tsChecker, decl.moduleSpecifier, tsFileToImport));\n-  const importName = nonCollidingImportName(allImports, newImport.symbolName);\n-\n-  if (existingImportDeclaration !== undefined) {\n-    // Update an existing import declaration.\n-    const bindings = existingImportDeclaration.importClause?.namedBindings;\n-    if (bindings === undefined || ts.isNamespaceImport(bindings)) {\n-      // This should be impossible. If a namespace import is present, the symbol was already\n-      // considered imported above.\n-      console.error(`Unexpected namespace import ${existingImportDeclaration.getText()}`);\n-      return [[], ''];\n-    }\n-    let span = {start: bindings.getStart(), length: bindings.getWidth()};\n-    const updatedBindings = updateImport(bindings, newImport.symbolName, importName);\n-    const importString = printNode(updatedBindings, file);\n-    return [[{span, newText: importString}], importName];\n-  }\n-\n-  // Find the last import in the file.\n-  let lastImport: ts.ImportDeclaration|null = null;\n-  file.forEachChild(child => {\n-    if (ts.isImportDeclaration(child)) lastImport = child;\n-  });\n-\n-  // Generate a new import declaration, and insert it after the last import declaration, only\n-  // looking at root nodes in the AST. If no import exists, place it at the start of the file.\n-  let span: ts.TextSpan = {start: 0, length: 0};\n-  if (lastImport as any !== null) {  // TODO: Why does the compiler insist this is null?\n-    span.start = lastImport!.getStart() + lastImport!.getWidth();\n-  }\n-  const newImportDeclaration =\n-      generateImport(newImport.symbolName, importName, newImport.moduleSpecifier);\n-  const importString = '\\n' + printNode(newImportDeclaration, file);\n-  return [[{span, newText: importString}], importName];\n-}\n-\n-/**\n- * Updates a given Angular trait, such as an NgModule or standalone Component, by adding\n- * `importName` to the list of imports on the decorator arguments.\n- */\n-function updateImportsForAngularTrait(\n-    checker: TemplateTypeChecker, trait: ts.ClassDeclaration, importName: string): ts.TextChange[] {\n-  // Get the object with arguments passed into the primary Angular decorator for this trait.\n-  const decorator = checker.getPrimaryAngularDecorator(trait);\n-  if (decorator === null) {\n-    return [];\n-  }\n-  const decoratorProps = findFirstMatchingNode(decorator, {filter: ts.isObjectLiteralExpression});\n-  if (decoratorProps === null) {\n-    return [];\n-  }\n-\n-  let updateRequired = true;\n-  // Update the trait's imports.\n-  const newDecoratorProps =\n-      updateObjectValueForKey(decoratorProps, 'imports', (oldValue?: ts.Expression) => {\n-        if (oldValue && !ts.isArrayLiteralExpression(oldValue)) {\n-          return oldValue;\n-        }\n-        const newArr = ensureArrayWithIdentifier(ts.factory.createIdentifier(importName), oldValue);\n-        updateRequired = newArr !== null;\n-        return newArr!;\n-      });\n-\n-  if (!updateRequired) {\n-    return [];\n-  }\n-  return [{\n-    span: {\n-      start: decoratorProps.getStart(),\n-      length: decoratorProps.getEnd() - decoratorProps.getStart()\n-    },\n-    newText: printNode(newDecoratorProps, trait.getSourceFile())\n-  }];\n-}\n-\n-function isStandaloneDecorator(decorator: ts.Decorator): boolean|null {\n-  const decoratorProps = findFirstMatchingNode(decorator, {filter: ts.isObjectLiteralExpression});\n-  if (decoratorProps === null) {\n-    return null;\n-  }\n-\n-  for (const property of decoratorProps.properties) {\n-    if (!ts.isPropertyAssignment(property)) {\n-      continue;\n-    }\n-    // TODO(dylhunn): What if this is a dynamically evaluated expression?\n-    if (property.name.getText() === 'standalone' && property.initializer.getText() === 'true') {\n-      return true;\n-    }\n-  }\n-  return false;\n-}\n\n---\n file path A: packages/language-service/src/ts_utils.ts | file path B: packages/language-service/src/ts_utils.ts\n\n@@ -5,6 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n+import {PotentialImport, TemplateTypeChecker} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n import ts from 'typescript';\n \n /**\n@@ -290,6 +291,147 @@ export function nonCollidingImportName(\n   return name;\n }\n \n+\n+/**\n+ * If the provided trait is standalone, just return it. Otherwise, returns the owning ngModule.\n+ */\n+export function standaloneTraitOrNgModule(\n+    checker: TemplateTypeChecker, trait: ts.ClassDeclaration): ts.ClassDeclaration|null {\n+  const componentDecorator = checker.getPrimaryAngularDecorator(trait);\n+  if (componentDecorator == null) {\n+    return null;\n+  }\n+  const owningNgModule = checker.getOwningNgModule(trait);\n+  const isMarkedStandalone = isStandaloneDecorator(componentDecorator);\n+  if (owningNgModule === null && !isMarkedStandalone) {\n+    // TODO(dylhunn): This is a \"moduleless component.\" We should probably suggest the user add\n+    // `standalone: true`.\n+    return null;\n+  }\n+  return owningNgModule ?? trait;\n+}\n+\n+/**\n+ * Updates the imports on a TypeScript file, by ensuring the provided import is present.\n+ * Returns the text changes, as well as the name with which the imported symbol can be referred to.\n+ */\n+export function updateImportsForTypescriptFile(\n+    tsChecker: ts.TypeChecker, file: ts.SourceFile, newImport: PotentialImport,\n+    tsFileToImport: ts.SourceFile): [ts.TextChange[], string] {\n+  // If the expression is already imported, we can just return its name.\n+  if (newImport.moduleSpecifier === undefined) {\n+    return [[], newImport.symbolName];\n+  }\n+\n+  // The trait might already be imported, possibly under a different name. If so, determine the\n+  // local name of the imported trait.\n+  const allImports = findAllMatchingNodes(file, {filter: ts.isImportDeclaration});\n+  const existingImportName: string|null =\n+      hasImport(tsChecker, allImports, newImport.symbolName, tsFileToImport);\n+  if (existingImportName !== null) {\n+    return [[], existingImportName];\n+  }\n+\n+  // If the trait has not already been imported, we need to insert the new import.\n+  const existingImportDeclaration = allImports.find(\n+      decl => moduleSpecifierPointsToFile(tsChecker, decl.moduleSpecifier, tsFileToImport));\n+  const importName = nonCollidingImportName(allImports, newImport.symbolName);\n+\n+  if (existingImportDeclaration !== undefined) {\n+    // Update an existing import declaration.\n+    const bindings = existingImportDeclaration.importClause?.namedBindings;\n+    if (bindings === undefined || ts.isNamespaceImport(bindings)) {\n+      // This should be impossible. If a namespace import is present, the symbol was already\n+      // considered imported above.\n+      console.error(`Unexpected namespace import ${existingImportDeclaration.getText()}`);\n+      return [[], ''];\n+    }\n+    let span = {start: bindings.getStart(), length: bindings.getWidth()};\n+    const updatedBindings = updateImport(bindings, newImport.symbolName, importName);\n+    const importString = printNode(updatedBindings, file);\n+    return [[{span, newText: importString}], importName];\n+  }\n+\n+  // Find the last import in the file.\n+  let lastImport: ts.ImportDeclaration|null = null;\n+  file.forEachChild(child => {\n+    if (ts.isImportDeclaration(child)) lastImport = child;\n+  });\n+\n+  // Generate a new import declaration, and insert it after the last import declaration, only\n+  // looking at root nodes in the AST. If no import exists, place it at the start of the file.\n+  let span: ts.TextSpan = {start: 0, length: 0};\n+  if (lastImport as any !== null) {  // TODO: Why does the compiler insist this is null?\n+    span.start = lastImport!.getStart() + lastImport!.getWidth();\n+  }\n+  const newImportDeclaration =\n+      generateImport(newImport.symbolName, importName, newImport.moduleSpecifier);\n+  const importString = '\\n' + printNode(newImportDeclaration, file);\n+  return [[{span, newText: importString}], importName];\n+}\n+\n+/**\n+ * Updates a given Angular trait, such as an NgModule or standalone Component, by adding\n+ * `importName` to the list of imports on the decorator arguments.\n+ */\n+export function updateImportsForAngularTrait(\n+    checker: TemplateTypeChecker, trait: ts.ClassDeclaration, importName: string): ts.TextChange[] {\n+  // Get the object with arguments passed into the primary Angular decorator for this trait.\n+  const decorator = checker.getPrimaryAngularDecorator(trait);\n+  if (decorator === null) {\n+    return [];\n+  }\n+  const decoratorProps = findFirstMatchingNode(decorator, {filter: ts.isObjectLiteralExpression});\n+  if (decoratorProps === null) {\n+    return [];\n+  }\n+\n+  let updateRequired = true;\n+  // Update the trait's imports.\n+  const newDecoratorProps =\n+      updateObjectValueForKey(decoratorProps, 'imports', (oldValue?: ts.Expression) => {\n+        if (oldValue && !ts.isArrayLiteralExpression(oldValue)) {\n+          return oldValue;\n+        }\n+        const newArr = ensureArrayWithIdentifier(ts.factory.createIdentifier(importName), oldValue);\n+        updateRequired = newArr !== null;\n+        return newArr!;\n+      });\n+\n+  if (!updateRequired) {\n+    return [];\n+  }\n+  return [{\n+    span: {\n+      start: decoratorProps.getStart(),\n+      length: decoratorProps.getEnd() - decoratorProps.getStart()\n+    },\n+    newText: printNode(newDecoratorProps, trait.getSourceFile())\n+  }];\n+}\n+\n+/**\n+ * Return whether a given Angular decorator specifies `standalone: true`.\n+ */\n+export function isStandaloneDecorator(decorator: ts.Decorator): boolean|null {\n+  const decoratorProps = findFirstMatchingNode(decorator, {filter: ts.isObjectLiteralExpression});\n+  if (decoratorProps === null) {\n+    return null;\n+  }\n+\n+  for (const property of decoratorProps.properties) {\n+    if (!ts.isPropertyAssignment(property)) {\n+      continue;\n+    }\n+    // TODO(dylhunn): What if this is a dynamically evaluated expression?\n+    if (property.name.getText() === 'standalone' && property.initializer.getText() === 'true') {\n+      return true;\n+    }\n+  }\n+  return false;\n+}\n+\n+\n /**\n  * Generate a new import. Follows the format:\n  * ```\n\n\n###\n\n", "completion": "refactor(language-service): Move some quick fix code into a shared file (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,5 +1,8 @@\n <a name=\"15.0.0\"></a>\n # 15.0.0 (2022-11-16)\n+\n+[Blog post \"Angular v15 is now available\"](http://goo.gle/angular-v15).\n+\n ## Breaking Changes\n ### compiler\n - Keyframes names are now prefixed with the component's \"scope name\".\n\n\n###\n\n", "completion": "docs: Add v15 release blog post link to changelog (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,14 @@\n+<a name=\"14.2.11\"></a>\n+# 14.2.11 (2022-11-16)\n+### router\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [aef353c143](https://github.com/angular/angular/commit/aef353c143ea4e31d76f00ae91efe49eecc3a321) | fix | Ensure renavigating in component init works with enabledBlocking ([#48066](https://github.com/angular/angular/pull/48066)) |\n+## Special Thanks\n+Alan Agius, Andrew Scott and Mujo Osmanovic\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.0.0-rc.4\"></a>\n # 15.0.0-rc.4 (2022-11-14)\n ### common\n\n\n###\n\n", "completion": "docs: release notes for the v14.2.11 release"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -325,6 +325,7 @@ groups:\n           'aio/content/guide/two-way-binding.md',\n           'aio/content/examples/two-way-binding/**/{*,.*}',\n           'aio/content/guide/built-in-directives.md',\n+          'aio/content/guide/directive-composition-api.md',\n           'aio/content/examples/built-in-directives/**/{*,.*}',\n           'aio/content/images/guide/built-in-directives/**/{*,.*}',\n           'aio/content/guide/template-reference-variables.md',\n\n---\n file path A: None | file path B: aio/content/guide/directive-composition-api.md\n\n@@ -0,0 +1,219 @@\n+# Directive composition API\n+\n+Angular directives offer a great way to encapsulate reusable behaviors\u2014 directives can apply\n+attributes, CSS classes, and event listeners to an element.\n+\n+The *directive composition API* lets you apply directives to a component's host element from\n+_within_ the component.\n+\n+## Adding directives to a component\n+\n+You apply directives to a component by adding a `hostDirectives` property to a component's\n+decorator. We call such directives *host directives*.\n+\n+In this example, we apply the directive `MenuBehavior` to the host element of `AdminMenu`. This\n+works similarly to applying the `MenuBehavior` to the `<admin-menu>` element in a template.\n+\n+```typescript\n+@Component({\n+  selector: 'admin-menu',\n+  template: 'admin-menu.html',\n+  hostDirectives: [MenuBehavior],\n+})\n+export class AdminMenu { }\n+```\n+\n+When the framework renders a component, Angular also creates an instance of each host directive. The\n+directives' host bindings apply to the component's host element. By default, host directive inputs\n+and outputs are not exposed as part of the component's public API. See\n+[Including inputs and outputs](#including-inputs-and-outputs) below for more information.\n+\n+**Angular applies host directives statically at compile time.** You cannot dynamically add\n+directives at runtime.\n+\n+**Directives used in `hostDirectives` must be `standalone: true`.**\n+\n+**Angular ignores the `selector` of directives applied in the `hostDirectives` property.**\n+\n+## Including inputs and outputs\n+\n+When you apply `hostDirectives` to your component, the inputs and outputs from the host directives\n+are not included in your component's API by default. You can explicitly include inputs and outputs\n+in your component's API by expanding the entry in `hostDirectives`:\n+\n+```typescript\n+@Component({\n+  selector: 'admin-menu',\n+  template: 'admin-menu.html',\n+  hostDirectives: [{\n+    directive: MenuBehavior,\n+    inputs: ['menuId'],\n+    outputs: ['menuClosed'],\n+  }],\n+})\n+export class AdminMenu { }\n+```\n+\n+By explicitly specifying the inputs and outputs, consumers of the component with `hostDirective` can\n+bind them in a template:\n+\n+```html\n+\n+<admin-menu menuId=\"top-menu\" (menuClosed)=\"logMenuClosed()\">\n+```\n+\n+Furthermore, you can alias inputs and outputs from `hostDirective` to customize the API of your\n+component:\n+\n+```typescript\n+@Component({\n+  selector: 'admin-menu',\n+  template: 'admin-menu.html',\n+  hostDirectives: [{\n+    directive: MenuBehavior,\n+    inputs: ['menuId: id'],\n+    outputs: ['menuClosed: closed'],\n+  }],\n+})\n+export class AdminMenu { }\n+```\n+\n+```html\n+\n+<admin-menu id=\"top-menu\" (closed)=\"logMenuClosed()\">\n+```\n+\n+## Adding directives to another directive\n+\n+You can also add `hostDirectives` to other directives, in addition to components. This enables the\n+transitive aggregation of multiple behaviors.\n+\n+In the following example, we define two directives, `Menu` and `Tooltip`. We then compose the behavior\n+of these two directives in `MenuWithTooltip`. Finally, we apply `MenuWithTooltip`\n+to `SpecializedMenuWithTooltip`.\n+\n+When `SpecializedMenuWithTooltip` is used in a template, it creates instances of all of `Menu`\n+, `Tooltip`, and `MenuWithTooltip`. Each of these directives' host bindings apply to the host\n+element of `SpecializedMenuWithTooltip`.\n+\n+```typescript\n+@Directive({...})\n+export class Menu { }\n+\n+@Directive({...})\n+export class Tooltip { }\n+\n+// MenuWithTooltip can compose behaviors from multiple other directives\n+@Directive({\n+  hostDirectives: [Tooltip, Menu],\n+})\n+export class MenuWithTooltip { }\n+\n+// CustomWidget can apply the already-composed behaviors from MenuWithTooltip\n+@Directive({\n+  hostDirectives: [MenuWithTooltip],\n+})\n+export class SpecializedMenuWithTooltip { }\n+```\n+\n+## Host directive semantics\n+\n+### Directive execution order\n+\n+Host directives go through the same lifecycle as components and directives used directly in a\n+template. However, host directives always execute their constructor, lifecycle hooks, and bindings _\n+before_ the component or directive on which they are applied.\n+\n+The following example shows minimal use of a host directive:\n+\n+```typescript\n+@Component({\n+  selector: 'admin-menu',\n+  template: 'admin-menu.html',\n+  hostDirectives: [MenuBehavior],\n+})\n+export class AdminMenu { }\n+```\n+\n+The order of execution here is:\n+\n+1. `MenuBehavior` instantiated\n+2. `AdminMenu` instantiated\n+3. `MenuBehavior` receives inputs (`ngOnInit`)\n+4. `AdminMenu` receives inputs (`ngOnInit`)\n+5. `MenuBehavior` applies host bindings\n+6. `AdminMenu` applies host bindings\n+\n+This order of operations means that components with `hostDirectives` can override any host bindings\n+specified by a host directive.\n+\n+This order of operations extends to nested chains of host directives, as shown in the following\n+example.\n+\n+```typescript\n+@Directive({...})\n+export class Tooltip { }\n+\n+@Directive({\n+  hostDirectives: [Tooltip],\n+})\n+export class CustomTooltip { }\n+\n+@Directive({\n+  hostDirectives: [CustomTooltip],\n+})\n+export class EvenMoreCustomTooltip { }\n+```\n+\n+In the example above, the order of execution is:\n+\n+1. `Tooltip` instantiated\n+2. `CustomTooltip` instantiated\n+3. `EvenMoreCustomTooltip` instantiated\n+4. `Tooltip` receives inputs (`ngOnInit`)\n+5. `CustomTooltip` receives inputs (`ngOnInit`)\n+6. `EvenMoreCustomTooltip` receives inputs (`ngOnInit`)\n+7. `Tooltip` applies host bindings\n+8. `CustomTooltip` applies host bindings\n+9. `EvenMoreCustomTooltip` applies host bindings\n+\n+### Dependency injection\n+\n+A component or directive that specifies `hostDirectives` can inject the instances of those host\n+directives and vice versa.\n+\n+When applying host directives to a component, both the component and host directives can define\n+providers.\n+\n+If a component or directive with `hostDirectives` and those host directives both provide the same\n+injection token, the providers defined by class with `hostDirectives` take precedence over providers\n+defined by the host directives.\n+\n+### Performance\n+\n+While the directive composition API offers a powerful tool for reusing common behaviors, excessive\n+use of host directives can impact your application's memory use. If you create components or\n+directives that use _many_ host directives, you may inadvertently balloon the memory used by your\n+application.\n+\n+The following example shows a component that applies several host directives.\n+\n+```typescript\n+@Component({\n+  hostDirectives: [\n+    DisabledState,\n+    RequiredState,\n+    ValidationState,\n+    ColorState,\n+    RippleBehavior,\n+  ],\n+})\n+export class CustomCheckbox { }\n+```\n+\n+This example declares a custom checkbox component that includes five host directives. This\n+means that Angular will create six objects each time a `CustomCheckbox` renders\u2014 one for the\n+component and one for each host directive. For a few checkboxes on a page, this won't pose any\n+significant issues. However, if your page renders _hundreds_ of checkboxes, such as in a table, then\n+you could start to see an impact of the additional object allocations. Always be sure to profile\n+your application to determine the right composition pattern for your use case.\n\n---\n file path A: aio/content/navigation.json | file path B: aio/content/navigation.json\n\n@@ -269,6 +269,11 @@\n               \"url\": \"guide/structural-directives\",\n               \"title\": \"Structural directives\",\n               \"tooltip\": \"Structural directives manipulate the layout of the page.\"\n+            },\n+            {\n+              \"url\": \"guide/directive-composition-api\",\n+              \"title\": \"Directive composition API\",\n+              \"tooltip\": \"Apply directive to host elements.\"\n             }\n           ]\n         },\n\n---\n file path A: aio/ngsw-config.json | file path B: aio/ngsw-config.json\n\n@@ -90,6 +90,7 @@\n     \"!/**/api/common/SelectControlValueAccessor-*\",\n     \"!/**/api/common/index/MaxLengthValidator-*\",\n     \"!/**/cookbook/ts-to-js*\",\n+    \"!/analytics/{0,1}\",\n     \"!/apf/{0,1}\",\n     \"!/api/*/*-(class|decorator|directive|function|interface|let|pipe|type|type-alias|var)\",\n     \"!/api/*/testing/*-(class|decorator|directive|function|interface|let|pipe|type|type-alias|var)\",\n@@ -102,6 +103,7 @@\n     \"!/api/testing/*-*\",\n     \"!/api/upgrade/*/*-(class|decorator|directive|function|interface|let|pipe|type|type-alias|var)\",\n     \"!/api/upgrade/*/index/*\",\n+    \"!/cli/usage-analytics-gathering/{0,1}\",\n     \"!/config/solution-tsconfig/{0,1}\",\n     \"!/config/tsconfig/{0,1}\",\n     \"!/devtools/{0,1}\",\n\n---\n file path A: packages/core/src/metadata/directives.ts | file path B: packages/core/src/metadata/directives.ts\n\n@@ -333,8 +333,13 @@ export interface Directive {\n \n   /**\n    * Standalone directives that should be applied to the host whenever the directive is matched.\n-   * By default none of the inputs or outputs of the host directives will be available on the host,\n+   * By default, none of the inputs or outputs of the host directives will be available on the host,\n    * unless they are specified in the `inputs` or `outputs` properties.\n+   *\n+   * You can additionally alias inputs and outputs by putting a colon and the alias after the\n+   * original input or output name. For example, if a directive applied via `hostDirectives`\n+   * defines an input named `menuDisabled`, you can alias this to `disabled` by adding\n+   * `'menuDisabled: disabled'` as an entry to `inputs`.\n    */\n   hostDirectives?: (Type<unknown>|{\n     directive: Type<unknown>,\n\n\n###\n\n", "completion": "docs: add host directives guide (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,16 @@\n+<a name=\"15.0.0-rc.4\"></a>\n+# 15.0.0-rc.4 (2022-11-14)\n+### common\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [449d29b701](https://github.com/angular/angular/commit/449d29b701ee5a50e7279d44f4c3888a5d6f7e96) | fix | Add fetchpriority to ngOptimizedImage preloads ([#48010](https://github.com/angular/angular/pull/48010)) |\n+| [edea15f2c6](https://github.com/angular/angular/commit/edea15f2c63675e86248a25649008a10e1384334) | fix | export the IMAGE_CONFIG token ([#48051](https://github.com/angular/angular/pull/48051)) |\n+| [945432e3fa](https://github.com/angular/angular/commit/945432e3fa2cb22ff911eda2a8ad3302a8adba5a) | fix | Warn on fill ngOptimizedImage without height ([#48036](https://github.com/angular/angular/pull/48036)) |\n+## Special Thanks\n+Alan Agius, Alex Castle, Andrew Kushnir, Mujo Osmanovic and ced\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.0.0-rc.3\"></a>\n # 15.0.0-rc.3 (2022-11-09)\n ## Breaking Changes\n\n\n###\n\n", "completion": "docs: release notes for the v15.0.0-rc.4 release"}
{"prompt": " file path A: aio/content/guide/releases.md | file path B: aio/content/guide/releases.md\n\n@@ -133,9 +133,8 @@ The following table provides the status for Angular versions under support.\n |:---     |:---    |:---        |:---         |:---        |\n | ^14.0.0 | Active | 2022-06-02 | 2022-12-02  | 2023-12-02 |\n | ^13.0.0 | LTS    | 2021-11-04 | 2022-06-02  | 2023-05-04 |\n-| ^12.0.0 | LTS    | 2021-05-12 | 2021-11-12  | 2022-11-12 |\n \n-Angular versions v2 to v11 are no longer under support.\n+Angular versions v2 to v12 are no longer under support.\n \n ### LTS fixes\n \n@@ -189,4 +188,4 @@ The policies and practices that are described in this document do not apply to A\n \n <!-- end links -->\n \n-@reviewed 2022-02-28\n+@reviewed 2022-11-14\n\n\n###\n\n", "completion": "docs: remove version 12 from actively supported versions (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/index.md | file path B: goldens/public-api/common/index.md\n\n@@ -269,9 +269,17 @@ export class I18nSelectPipe implements PipeTransform {\n     static \u0275pipe: i0.\u0275\u0275PipeDeclaration<I18nSelectPipe, \"i18nSelect\", true>;\n }\n \n+// @public\n+export const IMAGE_CONFIG: InjectionToken<ImageConfig>;\n+\n // @public\n export const IMAGE_LOADER: InjectionToken<ImageLoader>;\n \n+// @public\n+export type ImageConfig = {\n+    breakpoints?: number[];\n+};\n+\n // @public\n export type ImageLoader = (config: ImageLoaderConfig) => string;\n \n\n---\n file path A: packages/common/src/common.ts | file path B: packages/common/src/common.ts\n\n@@ -27,4 +27,4 @@ export {PLATFORM_BROWSER_ID as \u0275PLATFORM_BROWSER_ID, PLATFORM_SERVER_ID as \u0275PL\n export {VERSION} from './version';\n export {ViewportScroller, NullViewportScroller as \u0275NullViewportScroller} from './viewport_scroller';\n export {XhrFactory} from './xhr';\n-export {IMAGE_LOADER, ImageLoader, ImageLoaderConfig, NgOptimizedImage, PRECONNECT_CHECK_BLOCKLIST, provideCloudflareLoader, provideCloudinaryLoader, provideImageKitLoader, provideImgixLoader} from './directives/ng_optimized_image';\n+export {IMAGE_CONFIG, ImageConfig, IMAGE_LOADER, ImageLoader, ImageLoaderConfig, NgOptimizedImage, PRECONNECT_CHECK_BLOCKLIST, provideCloudflareLoader, provideCloudinaryLoader, provideImageKitLoader, provideImgixLoader} from './directives/ng_optimized_image';\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/index.ts | file path B: packages/common/src/directives/ng_optimized_image/index.ts\n\n@@ -12,5 +12,5 @@ export {provideCloudinaryLoader} from './image_loaders/cloudinary_loader';\n export {IMAGE_LOADER, ImageLoader, ImageLoaderConfig} from './image_loaders/image_loader';\n export {provideImageKitLoader} from './image_loaders/imagekit_loader';\n export {provideImgixLoader} from './image_loaders/imgix_loader';\n-export {NgOptimizedImage} from './ng_optimized_image';\n+export {IMAGE_CONFIG, ImageConfig, NgOptimizedImage} from './ng_optimized_image';\n export {PRECONNECT_CHECK_BLOCKLIST} from './preconnect_link_checker';\n\n\n###\n\n", "completion": "fix(common): export the IMAGE_CONFIG token (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -877,8 +877,9 @@ function assertNonZeroRenderedHeight(\n           RuntimeErrorCode.INVALID_INPUT,\n           `${imgDirectiveDetails(dir.ngSrc)} the height of the fill-mode image is zero. ` +\n               `This is likely because the containing element does not have the CSS 'position' ` +\n-              `property set to one of the following: \"relative\", \"fixed\", or \"absolute\". Make this ` +\n-              `change to ensure that the image is visible.`));\n+              `property set to one of the following: \"relative\", \"fixed\", or \"absolute\". ` +\n+              `To fix this problem, make sure the container element has the CSS 'position' ` +\n+              `property defined and the height of the element is not zero.`));\n     }\n   });\n }\n\n---\n file path A: packages/core/test/bundling/image-directive/BUILD.bazel | file path B: packages/core/test/bundling/image-directive/BUILD.bazel\n\n@@ -6,6 +6,7 @@ ng_module(\n     name = \"image-directive\",\n     srcs = [\n         \"e2e/basic/basic.ts\",\n+        \"e2e/fill-mode/fill-mode.ts\",\n         \"e2e/image-distortion/image-distortion.ts\",\n         \"e2e/lcp-check/lcp-check.ts\",\n         \"e2e/oversized-image/oversized-image.ts\",\n\n---\n file path A: None | file path B: packages/core/test/bundling/image-directive/e2e/fill-mode/fill-mode.e2e-spec.ts\n\n@@ -0,0 +1,45 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+/* tslint:disable:no-console  */\n+import {browser} from 'protractor';\n+import {logging} from 'selenium-webdriver';\n+\n+import {collectBrowserLogs} from '../browser-logs-util';\n+\n+describe('NgOptimizedImage directive', () => {\n+  it('should not warn when an image in the fill mode is rendered correctly', async () => {\n+    await browser.get('/e2e/fill-mode-passing');\n+    const logs = await collectBrowserLogs(logging.Level.WARNING);\n+    expect(logs.length).toEqual(0);\n+  });\n+\n+  it('should warn if an image in the fill mode has zero height after rendering', async () => {\n+    await browser.get('/e2e/fill-mode-failing');\n+    const logs = await collectBrowserLogs(logging.Level.WARNING);\n+\n+    expect(logs.length).toEqual(1);\n+    // Image loading order is not guaranteed, so all logs, rather than single entry\n+    // needs to be checked in order to test whether a given error message is present.\n+    const expectErrorMessageInLogs = (logs: logging.Entry[], message: string) => {\n+      expect(logs.some((log) => {\n+        return log.message.includes(message);\n+      })).toBeTruthy();\n+    };\n+\n+    expectErrorMessageInLogs(\n+        logs,\n+        'NG02952: The NgOptimizedImage directive (activated on an \\\\u003Cimg> element ' +\n+            'with the `ngSrc=\\\\\"/e2e/logo-500w.jpg\\\\\"`) has detected that the height ' +\n+            'of the fill-mode image is zero. This is likely because the containing element ' +\n+            'does not have the CSS \\'position\\' property set to one of the following: ' +\n+            '\\\\\"relative\\\\\", \\\\\"fixed\\\\\", or \\\\\"absolute\\\\\". To fix this problem, ' +\n+            'make sure the container element has the CSS \\'position\\' ' +\n+            'property defined and the height of the element is not zero.');\n+  });\n+});\n\n---\n file path A: None | file path B: packages/core/test/bundling/image-directive/e2e/fill-mode/fill-mode.ts\n\n@@ -0,0 +1,36 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {NgOptimizedImage} from '@angular/common';\n+import {Component} from '@angular/core';\n+\n+@Component({\n+  selector: 'fill-mode-passing',\n+  standalone: true,\n+  imports: [NgOptimizedImage],\n+  template: `\n+    <!-- Make sure an image in the fill mode has the size of a container -->\n+    <div style=\"position: absolute; width: 100px; height: 100px;\">\n+      <img ngSrc=\"/e2e/logo-500w.jpg\" fill priority>\n+    </div>\n+  `,\n+})\n+export class FillModePassingComponent {\n+}\n+@Component({\n+  selector: 'fill-mode-failing',\n+  standalone: true,\n+  imports: [NgOptimizedImage],\n+  template: `\n+    <div style=\"position: relative; width: 100%;\">\n+      <img ngSrc=\"/e2e/logo-500w.jpg\" fill priority>\n+    </div>\n+  `,\n+})\n+export class FillModeFailingComponent {\n+}\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/image-distortion/image-distortion.e2e-spec.ts | file path B: packages/core/test/bundling/image-directive/e2e/image-distortion/image-distortion.e2e-spec.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n /* tslint:disable:no-console  */\n-import {browser, by, element, ExpectedConditions} from 'protractor';\n+import {browser} from 'protractor';\n import {logging} from 'selenium-webdriver';\n \n import {collectBrowserLogs} from '../browser-logs-util';\n\n---\n file path A: packages/core/test/bundling/image-directive/index.ts | file path B: packages/core/test/bundling/image-directive/index.ts\n\n@@ -11,6 +11,7 @@ import {bootstrapApplication, provideProtractorTestingSupport} from '@angular/pl\n import {RouterModule} from '@angular/router';\n \n import {BasicComponent} from './e2e/basic/basic';\n+import {FillModeFailingComponent, FillModePassingComponent} from './e2e/fill-mode/fill-mode';\n import {ImageDistortionFailingComponent, ImageDistortionPassingComponent} from './e2e/image-distortion/image-distortion';\n import {LcpCheckComponent} from './e2e/lcp-check/lcp-check';\n import {OversizedImageComponentFailing, OversizedImageComponentPassing} from './e2e/oversized-image/oversized-image';\n@@ -38,6 +39,8 @@ const ROUTES = [\n   {path: 'e2e/image-distortion-failing', component: ImageDistortionFailingComponent},\n   {path: 'e2e/oversized-image-passing', component: OversizedImageComponentPassing},\n   {path: 'e2e/oversized-image-failing', component: OversizedImageComponentFailing},\n+  {path: 'e2e/fill-mode-passing', component: FillModePassingComponent},\n+  {path: 'e2e/fill-mode-failing', component: FillModeFailingComponent},\n ];\n \n bootstrapApplication(RootComponent, {\n\n\n###\n\n", "completion": "test(common): add e2e tests for the fill mode checks in the NgOptimizedImage directive (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -365,6 +365,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n       assertNotBlobUrl(this);\n       if (this.fill) {\n         assertEmptyWidthAndHeight(this);\n+        assertNonZeroRenderedHeight(this, this.imgElement, this.renderer);\n       } else {\n         assertNonEmptyWidthAndHeight(this);\n         // Only check for distorted images when not in fill mode, where\n@@ -862,6 +863,26 @@ function assertEmptyWidthAndHeight(dir: NgOptimizedImage) {\n   }\n }\n \n+/**\n+ * Verifies that the rendered image has a nonzero height. If the image is in fill mode, provides\n+ * guidance that this can be caused by the containing element's CSS position property.\n+ */\n+function assertNonZeroRenderedHeight(\n+    dir: NgOptimizedImage, img: HTMLImageElement, renderer: Renderer2) {\n+  const removeListenerFn = renderer.listen(img, 'load', () => {\n+    removeListenerFn();\n+    const renderedHeight = parseFloat(img.clientHeight as any);\n+    if (dir.fill && renderedHeight === 0) {\n+      console.warn(formatRuntimeError(\n+          RuntimeErrorCode.INVALID_INPUT,\n+          `${imgDirectiveDetails(dir.ngSrc)} the height of the fill-mode image is zero. ` +\n+              `This is likely because the containing element does not have the CSS 'position' ` +\n+              `property set to one of the following: \"relative\", \"fixed\", or \"absolute\". Make this ` +\n+              `change to ensure that the image is visible.`));\n+    }\n+  });\n+}\n+\n /**\n  * Verifies that the `loading` attribute is set to a valid input &\n  * is not used on priority images.\n\n\n###\n\n", "completion": "fix(common): Warn on fill ngOptimizedImage without height (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/image-directive.md | file path B: aio/content/guide/image-directive.md\n\n@@ -2,51 +2,52 @@\n \n The `NgOptimizedImage` directive makes it easy to adopt performance best practices for loading images.\n \n-The directive ensures that the loading of the [Largest Contentful Paint](http://web.dev/lcp) image is prioritized by:\n+The directive ensures that the loading of the [Largest Contentful Paint (LCP)](http://web.dev/lcp) image is prioritized by:\n \n *   Automatically setting the `fetchpriority` attribute on the `<img>` tag\n *   Lazy loading other images by default\n *   Asserting that there is a corresponding preconnect link tag in the document head\n+*   Automatically generating a `srcset` attribute\n *   Generating a [preload hint](https://developer.mozilla.org/en-US/docs/Web/HTML/Link_types/preload) if app is using SSR\n \n-In addition to optimizing the loading of the LCP image, `NgOptimizedImage` enforces a number of image best practices:\n+In addition to optimizing the loading of the LCP image, `NgOptimizedImage` enforces a number of image best practices, such as:\n \n-*   Uses [image CDN URLs to apply image optimizations](https://web.dev/image-cdns/#how-image-cdns-use-urls-to-indicate-optimization-options)\n-*   Prevents layout shift by requiring `width` and `height`\n-*   Warns if `width` or `height` have been set incorrectly\n-*   Warns if the image will be visually distorted when rendered\n+*   Using [image CDN URLs to apply image optimizations](https://web.dev/image-cdns/#how-image-cdns-use-urls-to-indicate-optimization-options)\n+*   Preventing layout shift by requiring `width` and `height`\n+*   Warning if `width` or `height` have been set incorrectly\n+*   Warning if the image will be visually distorted when rendered\n \n-## Prerequisites\n+## Getting Started\n \n-1. You will need to import `NgOptimizedImage` from the `@angular/common` module into your application. The directive is defined as a [standalone directive](/guide/standalone-components), so components should import it directly.\n-2. Consider setting up an image loader. These steps are explained in the [Configuring an Image Loader](#configuring-an-image-loader-for-ngoptimizedimage) section.\n+#### Step 1: Import NgOptimizedImage\n \n-## Usage in a template\n+<code-example format=\"typescript\" language=\"typescript\">\n \n-### Overview\n+import { NgOptimizedImage } from '@angular/common'\n \n-To activate the `NgOptimizedImage` directive, replace your image's `src` attribute with `ngSrc`.\n+</code-example>\n \n-<code-example format=\"typescript\" language=\"typescript\">\n+The directive is defined as a [standalone directive](/guide/standalone-components), so components should import it directly.\n \n-&lt;img ngSrc=\"cat.jpg\" width=\"400\" height=\"200\"&gt;\n+#### Step 2: (Optional) Set up a Loader\n \n-</code-example>\n+An image loader is not **required** in order to use NgOptimizedImage, but using one with an image CDN enables powerful performance features, including automatic `srcset`s for your images.\n \n-If you're using a [built-in third-party loader](#built-in-loaders), make sure to omit the base URL path from `src`, as that will be prepended automatically by the loader.\n+A brief guide for setting up a loader can be found in the [Configuring an Image Loader](#configuring-an-image-loader-for-ngoptimizedimage) section at the end of this page.\n \n-### Preventing layout shift\n+#### Step 3: Enable the directive\n \n-To prevent [image-related layout shifts](https://web.dev/css-web-vitals/#images-and-layout-shifts), the directive enforces that you set the `width` and `height` attributes for each image.  \n+To activate the `NgOptimizedImage` directive, replace your image's `src` attribute with `ngSrc`.\n \n-* For responsive images, the `width` and `height` attributes should reflect\n-the [intrinsic size](https://developer.mozilla.org/en-US/docs/Glossary/Intrinsic_Size) of the image. \n+<code-example format=\"typescript\" language=\"typescript\">\n \n-* For fixed size images, the `width` and `height` attributes should reflect the desired rendered size of the image. The aspect ratio of these attributes should always match the intrinsic aspect ratio of the image.\n+&lt;img ngSrc=\"cat.jpg\"&gt;\n \n-Note: if you don't know the size of your images, consider using \"fill mode\" to inherit the size of the parent container (see below).\n+</code-example>\n \n-### Marking images as `priority`\n+If you're using a [built-in third-party loader](#built-in-loaders), make sure to omit the base URL path from `src`, as that will be prepended automatically by the loader.\n+\n+#### Step 4: Mark images as `priority`\n \n Always mark the [LCP image](https://web.dev/lcp/#what-elements-are-considered) on your page as `priority` to prioritize its loading.\n \n@@ -64,31 +65,25 @@ Marking an image as `priority` applies the following optimizations:\n \n Angular displays a warning during development if the LCP element is an image that does not have the `priority` attribute. A page\u2019s LCP element can vary based on a number of factors - such as the dimensions of a user's screen, so a page may have multiple images that should be marked `priority`. See [CSS for Web Vitals](https://web.dev/css-web-vitals/#images-and-largest-contentful-paint-lcp) for more details.\n \n-### Adding resource hints\n+#### Step 5: Include Height and Width\n \n-You can add a [`preconnect` resource hint](https://web.dev/preconnect-and-dns-prefetch) for your image origin to ensure that the LCP image loads as quickly as possible. Always put resource hints in the `<head>` of the document.\n+In order to prevent [image-related layout shifts](https://web.dev/css-web-vitals/#images-and-layout-shifts), NgOptimizedImage requires that you specify a height and width for your image, as follows:\n \n-<code-example format=\"html\" language=\"html\">\n+<code-example format=\"typescript\" language=\"typescript\">\n \n-&lt;link rel=\"preconnect\" href=\"https://my.cdn.origin\" /&gt;\n+&lt;img ngSrc=\"cat.jpg\" width=\"400\" height=\"200\"&gt;\n \n </code-example>\n \n-By default, if you use a loader for a third-party image service, the `NgOptimizedImage` directive will warn during development if it detects that there is no `preconnect` resource hint for the origin that serves the LCP image.\n-\n-To disable these warnings, inject the `PRECONNECT_CHECK_BLOCKLIST` token:\n-\n-<code-example format=\"typescript\" language=\"typescript\">\n+For **responsive images** (images which you've styled to grow and shrink relative to the viewport), the `width` and `height` attributes should be the instrinsic size of the image file.\n \n-providers: [\n-  {provide: PRECONNECT_CHECK_BLOCKLIST, useValue: 'https://your-domain.com'}\n-],\n+For **fixed size images**, the `width` and `height` attributes should reflect the desired rendered size of the image. The aspect ratio of these attributes should always match the intrinsic aspect ratio of the image.\n \n-</code-example>\n+Note: If you don't know the size of your images, consider using \"fill mode\" to inherit the size of the parent container, as described below:\n \n ### Using `fill` mode\n \n-In cases where you want to have an image fill a containing element, you can use the `fill` attribute. This is often useful when you want to achieve a \"background image\" behavior, or when you don't know the exact width and height of your image.\n+In cases where you want to have an image fill a containing element, you can use the `fill` attribute. This is often useful when you want to achieve a \"background image\" behavior. It can also be helpful when you don't know the exact width and height of your image, but you do have a parent container with a known size that you'd like to fit your image into (see \"object-fit\" below).\n \n When you add the `fill` attribute to your image, you do not need and should not include a `width` and `height`, as in this example:\n \n@@ -96,7 +91,15 @@ When you add the `fill` attribute to your image, you do not need and should not\n \n &lt;img ngSrc=\"cat.jpg\" fill&gt;\n \n-</code-example> \n+</code-example>\n+\n+You can use the [obect-fit](https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit) CSS property to change how the image will fill its container. If you style your image with `object-fit: \"contain\"`, the image will maintain its aspect ratio and be \"letterboxed\" to fit the element. If you set `object-fit: \"cover\"`, the element will retain its aspect ratio, fully fill the element, and some content may be \"cropped\" off. \n+\n+See visual examples of the above at the [MDN object-fit documentation.](https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit)\n+\n+You can also style your image with the [object-position property](https://developer.mozilla.org/en-US/docs/Web/CSS/object-position) to adjust its position within its containing element.\n+\n+**Important note:** For the \"fill\" image to render properly, its parent element **must** be styled with `position: \"relative\"`, `position: \"fixed\"`, or `position: \"absolute\"`. \n \n ### Adjusting image styling\n \n@@ -104,7 +107,35 @@ Depending on the image's styling, adding `width` and `height` attributes may cau\n \n You can typically fix this by adding `height: auto` or `width: auto` to your image styles. For more information, see the [web.dev article on the `<img>` tag](https://web.dev/patterns/web-vitals-patterns/images/img-tag).\n \n-### Requesting images at the correct size\n+If the `height` and `width` attribute on the image are preventing you from sizing the image the way you want with CSS, consider using \"fill\" mode instead, and styling the image's parent element.\n+\n+## Performance Features\n+\n+NgOptimizedImage includes a number of features designed to improve loading performance in your app. These features are described in this section.\n+\n+### Add resource hints\n+\n+You can add a [`preconnect` resource hint](https://web.dev/preconnect-and-dns-prefetch) for your image origin to ensure that the LCP image loads as quickly as possible. Always put resource hints in the `<head>` of the document.\n+\n+<code-example format=\"html\" language=\"html\">\n+\n+&lt;link rel=\"preconnect\" href=\"https://my.cdn.origin\" /&gt;\n+\n+</code-example>\n+\n+By default, if you use a loader for a third-party image service, the `NgOptimizedImage` directive will warn during development if it detects that there is no `preconnect` resource hint for the origin that serves the LCP image.\n+\n+To disable these warnings, inject the `PRECONNECT_CHECK_BLOCKLIST` token:\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+\n+providers: [\n+  {provide: PRECONNECT_CHECK_BLOCKLIST, useValue: 'https://your-domain.com'}\n+],\n+\n+</code-example>\n+\n+### Request images at the correct size with automatic `srcset`\n \n Defining a [`srcset` attribute](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/srcset) ensures that the browser requests an image at the right size for your user's viewport, so it doesn't waste time downloading an image that's too large. `NgOptimizedImage` generates an appropriate `srcset` for the image, based on the presence and value of the [`sizes` attribute](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/sizes) on the image tag.\n \n\n\n###\n\n", "completion": "docs(common): Refine NgOptimizedImage docs (#<issue-num>)"}
{"prompt": " file path A: None | file path B: aio/content/errors/NG0910.md\n\n@@ -0,0 +1,71 @@\n+@name Unsafe bindings on an iframe element\n+@category runtime\n+@shortDescription Unsafe bindings on an iframe element\n+\n+@description\n+You see this error when Angular detects an attribute binding or a property binding on an `<iframe>` element using the following property names:\n+\n+* sandbox\n+* allow\n+* allowFullscreen\n+* referrerPolicy\n+* csp\n+* fetchPriority\n+\n+The mentioned attributes affect the security model setup for `<iframe>`s\n+and it's important to apply them before setting the `src` or `srcdoc` attributes.\n+To enforce that, Angular requires these attributes to be set on `<iframe>`s as\n+static attributes, so the values are set at the element creation time and they\n+remain the same throughout the lifetime of an `<iframe>` instance.\n+\n+The error is thrown when a property binding with one of the mentioned attribute names is used:\n+```html\n+<iframe [sandbox]=\"'allow-scripts'\" src=\"...\"></iframe>\n+```\n+\n+or when it's an attribute bindings:\n+\n+```html\n+<iframe [attr.sandbox]=\"'allow-scripts'\" src=\"...\"></iframe>\n+```\n+\n+Also, the error is thrown when a similar pattern is used in Directive's host bindings:\n+\n+```typescript\n+@Directive({\n+  selector: 'iframe',\n+  host: {\n+    '[sandbox]': `'allow-scripts'`,\n+    '[attr.sandbox]': `'allow-scripts'`,\n+  }\n+})\n+class IframeDirective {}\n+```\n+\n+@debugging\n+\n+The error message includes the name of the component with the template where\n+an `<iframe>` element with unsafe bindings is located.\n+\n+The recommended solution is to use the mentioned attributes as static ones, for example:\n+\n+```html\n+<iframe sandbox=\"allow-scripts\" src=\"...\"></iframe>\n+```\n+\n+If you need to have different values for these attributes (depending on various conditions),\n+you can use an `*ngIf` or an `*ngSwitch` on an `<iframe>` element:\n+\n+```html\n+<iframe *ngIf=\"someConditionA\" sandbox=\"allow-scripts\" src=\"...\"></iframe>\n+<iframe *ngIf=\"someConditionB\" sandbox=\"allow-forms\" src=\"...\"></iframe>\n+<iframe *ngIf=\"someConditionC\" sandbox=\"allow-popups\" src=\"...\"></iframe>\n+```\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-05-27\n\n---\n file path A: goldens/public-api/core/errors.md | file path B: goldens/public-api/core/errors.md\n\n@@ -101,7 +101,7 @@ export const enum RuntimeErrorCode {\n     // (undocumented)\n     UNKNOWN_ELEMENT = 304,\n     // (undocumented)\n-    UNSAFE_IFRAME_ATTRS = 910,\n+    UNSAFE_IFRAME_ATTRS = -910,\n     // (undocumented)\n     UNSAFE_VALUE_IN_RESOURCE_URL = 904,\n     // (undocumented)\n\n---\n file path A: packages/core/src/errors.ts | file path B: packages/core/src/errors.ts\n\n@@ -82,7 +82,7 @@ export const enum RuntimeErrorCode {\n   TYPE_IS_NOT_STANDALONE = 907,\n   MISSING_ZONEJS = 908,\n   UNEXPECTED_ZONE_STATE = 909,\n-  UNSAFE_IFRAME_ATTRS = 910,\n+  UNSAFE_IFRAME_ATTRS = -910,\n }\n \n /**\n\n---\n file path A: packages/core/test/acceptance/security_spec.ts | file path B: packages/core/test/acceptance/security_spec.ts\n\n@@ -47,7 +47,7 @@ describe('comment node text escaping', () => {\n \n describe('iframe processing', () => {\n   function getErrorMessageRegexp() {\n-    const errorMessagePart = 'NG0' + RuntimeErrorCode.UNSAFE_IFRAME_ATTRS.toString();\n+    const errorMessagePart = 'NG0' + Math.abs(RuntimeErrorCode.UNSAFE_IFRAME_ATTRS).toString();\n     return new RegExp(errorMessagePart);\n   }\n \n\n\n###\n\n", "completion": "docs(core): add an error details page for unsafe <iframe> bindings (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/standalone-components.md | file path B: aio/content/guide/standalone-components.md\n\n@@ -188,8 +188,8 @@ export const ROUTES: Route[] = [\n       {provide: ADMIN_API_KEY, useValue: '12345'},\n     ],\n     children: [\n-      path: 'users', component: AdminUsersComponent,\n-      path: 'teams', component: AdminTeamsComponent,\n+      {path: 'users', component: AdminUsersComponent},\n+      {path: 'teams', component: AdminTeamsComponent},\n     ],\n   },\n   // ... other application routes that don't\n\n\n###\n\n", "completion": "docs(docs-infra): Fix typo in documentation for standalone components (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/image-directive.md | file path B: aio/content/guide/image-directive.md\n\n@@ -60,6 +60,7 @@ Marking an image as `priority` applies the following optimizations:\n \n *   Sets `fetchpriority=high` (read more about priority hints [here](https://web.dev/priority-hints))\n *   Sets `loading=eager` (read more about native lazy loading [here](https://web.dev/browser-level-image-lazy-loading))\n+*   Automatically generates a [preload link element](https://developer.mozilla.org/en-US/docs/Web/HTML/Link_types/preload) if [rendering on the server](/guide/universal).\n \n Angular displays a warning during development if the LCP element is an image that does not have the `priority` attribute. A page\u2019s LCP element can vary based on a number of factors - such as the dimensions of a user's screen, so a page may have multiple images that should be marked `priority`. See [CSS for Web Vitals](https://web.dev/css-web-vitals/#images-and-largest-contentful-paint-lcp) for more details.\n \n\n---\n file path A: packages/common/src/directives/ng_optimized_image/preload-link-creator.ts | file path B: packages/common/src/directives/ng_optimized_image/preload-link-creator.ts\n\n@@ -65,6 +65,7 @@ export class PreloadLinkCreator {\n     renderer.setAttribute(preload, 'as', 'image');\n     renderer.setAttribute(preload, 'href', src);\n     renderer.setAttribute(preload, 'rel', 'preload');\n+    renderer.setAttribute(preload, 'fetchpriority', 'high');\n \n     if (sizes) {\n       renderer.setAttribute(preload, 'imageSizes', sizes);\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -68,6 +68,7 @@ describe('Image directive', () => {\n       expect(preloadLink!.getAttribute('as')).toEqual('image');\n       expect(preloadLink!.getAttribute('imagesizes')).toEqual('10vw');\n       expect(preloadLink!.getAttribute('imagesrcset')).toEqual(`${rewrittenSrc}?width=100 100w`);\n+      expect(preloadLink!.getAttribute('fetchpriority')).toEqual('high');\n \n       preloadLink!.remove();\n     });\n\n\n###\n\n", "completion": "fix(common): Add fetchpriority to ngOptimizedImage preloads (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,31 @@\n+<a name=\"15.0.0-rc.3\"></a>\n+# 15.0.0-rc.3 (2022-11-09)\n+## Breaking Changes\n+### core\n+- Existing iframe usages may have security-sensitive attributes applied as an attribute or property binding in a template or via host bindings in a directive. Such usages would require an update to ensure compliance with the new stricter rules around iframe bindings.\n+### core\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [37a25486cf](https://github.com/angular/angular/commit/37a25486cfc546df859b6fe8c84b78b4c5827805) | fix | add` zone.js` version `0.12.x` as a valid peer dependency ([#48002](https://github.com/angular/angular/pull/48002)) |\n+| [28f289b825](https://github.com/angular/angular/commit/28f289b825be7f4bf6dc5db69197741867b8ea23) | fix | hardening attribute and property binding rules for <iframe> elements ([#47964](https://github.com/angular/angular/pull/47964)) |\n+### forms\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [2625dc1312](https://github.com/angular/angular/commit/2625dc13127da9f8d5fa79f1b32ad132d6656c63) | fix | Improve a very commonly viewed error message by adding a guide. ([#47969](https://github.com/angular/angular/pull/47969)) |\n+| [ae29f98c20](https://github.com/angular/angular/commit/ae29f98c20390abbf84d2df312ee5e8766195d60) | fix | Runtime error pages must begin with leading zero ([#47991](https://github.com/angular/angular/pull/47991)) |\n+### http\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [e7b48da713](https://github.com/angular/angular/commit/e7b48da713f32c02c096f1342ab8b0d7ec696ca5) | fix | rename `withLegacyInterceptors` to `withInterceptorsFromDi` ([#47901](https://github.com/angular/angular/pull/47901)) |\n+### router\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [b8a6f7491b](https://github.com/angular/angular/commit/b8a6f7491beb9f3cdd71be550bf55173c6e5b670) | fix | fix redirectTo on named outlets - resolves [#33783](https://github.com/angular/angular/pull/33783) ([#47927](https://github.com/angular/angular/pull/47927)) |\n+## Special Thanks\n+Alan Agius, Albert Szekely, Alex Castle, Alex Rickabaugh, Andrew Kushnir, Andrew Scott, Doug Parker, Dylan Hunn, Kristiyan Kostadinov, Markus Eckstein, Matthieu Riegler, Paul Gschwendtner, Peter Scriven and abergquist\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"14.2.10\"></a>\n # 14.2.10 (2022-11-09)\n ### core\n\n\n###\n\n", "completion": "docs: release notes for the v15.0.0-rc.3 release"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,18 @@\n+<a name=\"14.2.10\"></a>\n+# 14.2.10 (2022-11-09)\n+### core\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [a4312e1be5](https://github.com/angular/angular/commit/a4312e1be55f0677a77c9015688dbd4cf8163c69) | fix | add` zone.js` version `0.12.x` as a valid peer dependency ([#48002](https://github.com/angular/angular/pull/48002)) |\n+### router\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [db867fee77](https://github.com/angular/angular/commit/db867fee77bc62f367fc5d484fc3951d72d998c8) | fix | fix redirectTo on named outlets - resolves [#33783](https://github.com/angular/angular/pull/33783) ([#47927](https://github.com/angular/angular/pull/47927)) |\n+## Special Thanks\n+Alan Agius, Albert Szekely, Andrew Scott, Doug Parker, Kristiyan Kostadinov, Markus Eckstein, Peter Scriven and abergquist\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.0.0-rc.2\"></a>\n # 15.0.0-rc.2 (2022-11-04)\n ### core\n@@ -3717,4 +3732,4 @@ This release contains the same set the of changes as 11.2.0-next.1.\n ### Code Refactoring\n \n * **compiler:** remove support for TypeScript 3.9 ([#39313](https://github.com/angular/angular/issues/39313)) ([736e064](https://github.com/angular/angular/commit/736e0644b02bc4606a7ae0c974d1b06e993708f6))\n-* **router:** adjust type of parameter in `navigateByUrl` and `createUrlTree` to be more accurate ([#38227](https://github.com/angular/angular/issues/38227)) ([e4f4d18](https://github.com/angular/angular/commit/e4f4d18)), closes [#18798](https://github.com/angular/angular/issues/18798)\n+* **router:** adjust type of parameter in `navigateByUrl` and `createUrlTree` to be more accurate ([#38227](https://github.com/angular/angular/issues/38227)) ([e4f4d18](https://github.com/angular/angular/commit/e4f4d18)), closes [#18798](https://github.com/angular/angular/issues/18798)\n\\ No newline at end of file\n\n\n###\n\n", "completion": "docs: release notes for the v14.2.10 release"}
{"prompt": " file path A: aio/content/guide/deprecations.md | file path B: aio/content/guide/deprecations.md\n\n@@ -85,6 +85,7 @@ v15 - v18\n | `@angular/router`                     | [`resolver` field of the `OutletContext` class](#router)                                                                        | <!-- v14 --> v16         |\n | `@angular/router`                     | [`RouterLinkWithHref` directive](#router)                                                                        | <!-- v15 --> v17         |\n | `@angular/router`                     | [`provideRoutes` function](#router)                                                                        | <!-- v15 --> v17         |\n+| `@angular/router`                     | [setupTestingRouter](#router)                                                                        | <!-- v15.1 --> v17         |\n | `@angular/service-worker`           | [`SwUpdate#activated`](api/service-worker/SwUpdate#activated)                                              | <!-- v13 --> v16         |\n | `@angular/service-worker`           | [`SwUpdate#available`](api/service-worker/SwUpdate#available)                                              | <!-- v13 --> v16         |\n | template syntax                     | [`/deep/`, `>>>`, and `::ng-deep`](#deep-component-style-selector)                                         | <!--  v7 --> unspecified |\n@@ -169,6 +170,7 @@ In the [API reference section](api) of this site, deprecated APIs are indicated\n | [`resolver` field of the `OutletContext` class](api/router/OutletContext#resolver) | No replacement needed | v14                   | Component factories are not required to create an instance of a component dynamically. Passing a factory resolver via `resolver` class field is no longer needed. |\n | [`RouterLinkWithHref` directive](api/router/RouterLinkWithHref) | Use `RouterLink` instead. | v15                   | The `RouterLinkWithHref` directive code was merged into `RouterLink`. Now the `RouterLink` directive can be used for all elements that have `routerLink` attribute. |\n | [`provideRoutes` function](api/router/provideRoutes) | Use `ROUTES` `InjectionToken` instead. | v15                   | The `provideRoutes` helper function is minimally useful and can be unintentionally used instead of `provideRouter` due to similar spelling. |\n+| [`setupTestingRouter` function](api/router/testing/setupTestingRouter) | Use `provideRouter` or `RouterTestingModule` instead. | v15.1                   | The `setupTestingRouter` function is not necessary. The `Router` is initialized based on the DI configuration in tests as it would be in production. |\n \n \n <a id=\"platform-browser\"></a>\n\n---\n file path A: goldens/public-api/router/testing/index.md | file path B: goldens/public-api/router/testing/index.md\n\n@@ -32,12 +32,9 @@ export class RouterTestingModule {\n     static \u0275mod: i0.\u0275\u0275NgModuleDeclaration<RouterTestingModule, never, never, [typeof i1.RouterModule]>;\n }\n \n-// @public\n+// @public @deprecated\n export function setupTestingRouter(urlSerializer: UrlSerializer, contexts: ChildrenOutletContexts, location: Location_2, compiler: Compiler, injector: Injector, routes: Route[][], opts?: ExtraOptions | UrlHandlingStrategy | null, urlHandlingStrategy?: UrlHandlingStrategy, routeReuseStrategy?: RouteReuseStrategy, titleStrategy?: TitleStrategy): Router;\n \n-// @public\n-export function setupTestingRouterInternal(urlSerializer: UrlSerializer, contexts: ChildrenOutletContexts, location: Location_2, compiler: Compiler, injector: Injector, routes: Route[][], titleStrategy: TitleStrategy, opts?: ExtraOptions | UrlHandlingStrategy, urlHandlingStrategy?: UrlHandlingStrategy, routeReuseStrategy?: RouteReuseStrategy): Router;\n-\n // (No @packageDocumentation comment for this package)\n \n ```\n\n---\n file path A: packages/router/testing/src/router_testing_module.ts | file path B: packages/router/testing/src/router_testing_module.ts\n\n@@ -20,31 +20,11 @@ function isUrlHandlingStrategy(opts: ExtraOptions|\n   return 'shouldProcessUrl' in opts;\n }\n \n-/**\n- * Router setup factory function used for testing. Only used internally to keep the factory that's\n- * marked as publicApi cleaner (i.e. not having _both_ `TitleStrategy` and `DefaultTitleStrategy`).\n- */\n-export function setupTestingRouterInternal(\n-    urlSerializer: UrlSerializer,\n-    contexts: ChildrenOutletContexts,\n-    location: Location,\n-    compiler: Compiler,\n-    injector: Injector,\n-    routes: Route[][],\n-    titleStrategy: TitleStrategy,\n-    opts?: ExtraOptions|UrlHandlingStrategy,\n-    urlHandlingStrategy?: UrlHandlingStrategy,\n-    routeReuseStrategy?: RouteReuseStrategy,\n-) {\n-  return setupTestingRouter(\n-      urlSerializer, contexts, location, compiler, injector, routes, opts, urlHandlingStrategy,\n-      routeReuseStrategy, titleStrategy);\n-}\n-\n /**\n  * Router setup factory function used for testing.\n  *\n  * @publicApi\n+ * @deprecated Use `provideRouter` or `RouterTestingModule` instead.\n  */\n export function setupTestingRouter(\n     urlSerializer: UrlSerializer, contexts: ChildrenOutletContexts, location: Location,\n@@ -107,22 +87,6 @@ export function setupTestingRouter(\n     ROUTER_PROVIDERS,\n     EXTRA_ROUTER_TESTING_PROVIDERS,\n     provideLocationMocks(),\n-    {\n-      provide: Router,\n-      useFactory: setupTestingRouterInternal,\n-      deps: [\n-        UrlSerializer,\n-        ChildrenOutletContexts,\n-        Location,\n-        Compiler,\n-        Injector,\n-        ROUTES,\n-        TitleStrategy,\n-        ROUTER_CONFIGURATION,\n-        [UrlHandlingStrategy, new Optional()],\n-        [RouteReuseStrategy, new Optional()],\n-      ]\n-    },\n     withPreloading(NoPreloading).\u0275providers,\n     {provide: ROUTES, multi: true, useValue: []},\n   ]\n\n\n###\n\n", "completion": "docs(router): deprecate setupTestingRouter (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/router/src/app/auth/auth.guard.2.ts | file path B: aio/content/examples/router/src/app/auth/auth.guard.2.ts\n\n@@ -15,9 +15,6 @@ export const authGuard: CanMatchFn|CanActivateFn = () => {\n     return true;\n   }\n \n-  const url = router.getCurrentNavigation()!.extractedUrl.toString();\n-  // Store the attempted URL for redirecting\n-  authService.redirectUrl = url;\n   // Redirect to the login page\n   return router.parseUrl('/login');\n };\n\n---\n file path A: aio/content/examples/router/src/app/auth/auth.guard.3.ts | file path B: aio/content/examples/router/src/app/auth/auth.guard.3.ts\n\n@@ -15,9 +15,6 @@ export const authGuard: CanMatchFn|CanActivateFn|CanActivateChildFn = () => {\n     return true;\n   }\n \n-  const url = router.getCurrentNavigation()!.extractedUrl.toString();\n-  // Store the attempted URL for redirecting\n-  authService.redirectUrl = url;\n   // Redirect to the login page\n   return router.parseUrl('/login');\n };\n\n---\n file path A: aio/content/examples/router/src/app/auth/auth.guard.4.ts | file path B: aio/content/examples/router/src/app/auth/auth.guard.4.ts\n\n@@ -17,11 +17,6 @@ export const authGuard: CanMatchFn|CanActivateFn|CanActivateChildFn = () => {\n     return true;\n   }\n \n-  const url = router.getCurrentNavigation()!.extractedUrl.toString();\n-\n-  // Store the attempted URL for redirecting\n-  authService.redirectUrl = url;\n-\n   // Create a dummy session id\n   const sessionId = 123456789;\n \n\n---\n file path A: aio/content/examples/router/src/app/auth/auth.guard.ts | file path B: aio/content/examples/router/src/app/auth/auth.guard.ts\n\n@@ -18,11 +18,6 @@ export const authGuard: CanMatchFn|CanActivateChildFn|CanActivateFn|CanLoadFn =\n     return true;\n   }\n \n-  const url = router.getCurrentNavigation()!.extractedUrl.toString();\n-\n-  // Store the attempted URL for redirecting\n-  authService.redirectUrl = url;\n-\n   // Create a dummy session id\n   const sessionId = 123456789;\n \n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -218,7 +218,7 @@ export interface Navigation {\n    */\n   initialUrl: UrlTree;\n   /**\n-   * The initial target URL after being parsed with `UrlSerializer.extract()`.\n+   * The initial target URL after being parsed with `UrlHandlingStrategy.extract()`.\n    */\n   extractedUrl: UrlTree;\n   /**\n\n\n###\n\n", "completion": "docs(router): small adjustments to router docs (#<issue-num>)"}
{"prompt": " file path A: packages/core/package.json | file path B: packages/core/package.json\n\n@@ -17,7 +17,7 @@\n   },\n   \"peerDependencies\": {\n     \"rxjs\": \"^6.5.3 || ^7.4.0\",\n-    \"zone.js\": \"~0.11.4\"\n+    \"zone.js\": \"~0.11.4 || ~0.12.0\"\n   },\n   \"repository\": {\n     \"type\": \"git\",\n\n\n###\n\n", "completion": "fix(core): add` zone.js` version `0.12.x` as a valid peer dependency (#<issue-num>)"}
{"prompt": " file path A: package.json | file path B: package.json\n\n@@ -128,7 +128,7 @@\n     \"diff\": \"^5.0.0\",\n     \"document-register-element\": \"^1.7.2\",\n     \"domino\": \"~2.1.6\",\n-    \"google-closure-compiler\": \"20221004.0.0\",\n+    \"google-closure-compiler\": \"20221102.0.0\",\n     \"graceful-fs\": \"4.2.10\",\n     \"hammerjs\": \"~2.0.8\",\n     \"http-server\": \"^14.0.0\",\n\n---\n file path A: packages/zone.js/package.json | file path B: packages/zone.js/package.json\n\n@@ -14,7 +14,7 @@\n     \"@externs/nodejs\": \"^1.5.0\",\n     \"@types/node\": \"^10.9.4\",\n     \"domino\": \"2.1.6\",\n-    \"google-closure-compiler\": \"^20221004.0.0\",\n+    \"google-closure-compiler\": \"^20221102.0.0\",\n     \"jest\": \"^29.0\",\n     \"jest-environment-jsdom\": \"^29.0.3\",\n     \"jest-environment-node\": \"^29.0.3\",\n\n---\n file path A: packages/zone.js/yarn.lock | file path B: packages/zone.js/yarn.lock\n\n@@ -1689,40 +1689,40 @@ globals@^11.1.0:\n   resolved \"https://registry.yarnpkg.com/globals/-/globals-11.12.0.tgz#ab8795338868a0babd8525758018c2a7eb95c42e\"\n   integrity sha512-WOBp/EEGUiIsJSp7wcv/y6MO+lV9UoncWqxuFfm8eBwzWNgyfBd6Gz+IeKQ9jCmyhoH99g15M3T+QaVHFjizVA==\n \n-google-closure-compiler-java@^20221004.0.0:\n-  version \"20221004.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-java/-/google-closure-compiler-java-20221004.0.0.tgz#ba1049987bd91ebdcc2aebe184bf839bcaa0017e\"\n-  integrity sha512-CygLEB40HxtK0VtP6klv2Xm08w4HQNYX/DTgLV7CP74r8LiQMUByRFleaG/Hv5xQG1JzPNiW0GOAiAubDSdr5A==\n-\n-google-closure-compiler-linux@^20221004.0.0:\n-  version \"20221004.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-linux/-/google-closure-compiler-linux-20221004.0.0.tgz#6fe30f5e970d5a8de9efe9ac3a5d65b60c2c1dc8\"\n-  integrity sha512-B6sca3Lmw3cYXdFzdU0iQpk8L9VEo1ecC1aM7Gl9lgWhIicqqEZebsgnUe5TQ3uHBfQoKjV9fdFG8mt8X/oqSQ==\n-\n-google-closure-compiler-osx@^20221004.0.0:\n-  version \"20221004.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-osx/-/google-closure-compiler-osx-20221004.0.0.tgz#3efdcd226f5dbb2dedab40a3436f2a1b59709dc5\"\n-  integrity sha512-z5V7BvaMauPga8DMTt9u6RGcjBdLAuv4gL2Ebw5NIQRTAHVkEVzCd3kiMX7CVCGhmWdS/1r3jZcCg4BswGia6w==\n-\n-google-closure-compiler-windows@^20221004.0.0:\n-  version \"20221004.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-windows/-/google-closure-compiler-windows-20221004.0.0.tgz#ee61f329b906993a7e2fa419690d93de437bd21a\"\n-  integrity sha512-JSAWilVa7d65QJYKUr+DmklwKmjkAce6BMD6smqJfdL2dv5OSJ2ydGy73euoBJ4Tka8iQPoaOP+BjLrhIuvqKg==\n-\n-google-closure-compiler@^20221004.0.0:\n-  version \"20221004.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler/-/google-closure-compiler-20221004.0.0.tgz#18d255ada6562ddd0332e1e25921bcffc12eaf28\"\n-  integrity sha512-OKENLrZFF2o3FZ/E4zdTc9NeuAUh1fdwbQxT0sibI19aR62sgNUBo2mLU6sc4Gcm0cQ2gwfB7qX1xnapOIkbaA==\n+google-closure-compiler-java@^20221102.0.0:\n+  version \"20221102.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-java/-/google-closure-compiler-java-20221102.0.0.tgz#bba0d0f31a1e9f5034ebfb19dc3bce26c725e79e\"\n+  integrity sha512-feAsp8xVU+jJydBfVTRK4/9jHpNZOX9jbhFziDLd3xypFgjb1CLQ9SzohS1hqA97q8wYxalB6HXU4JdicmRmUA==\n+\n+google-closure-compiler-linux@^20221102.0.0:\n+  version \"20221102.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-linux/-/google-closure-compiler-linux-20221102.0.0.tgz#84cda7af5aaa68a8e7041694d4da3583e4c40687\"\n+  integrity sha512-coffCJoA4XK1M34/+R0u1AN9hGCMj+8M5JnBm0WCvOEtbC+pNGPNiYZw53zFWZZpJ/jCqJnRvRpZe18C773fnQ==\n+\n+google-closure-compiler-osx@^20221102.0.0:\n+  version \"20221102.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-osx/-/google-closure-compiler-osx-20221102.0.0.tgz#d7ee87505377d407dbde9fc78f6720c4c727347b\"\n+  integrity sha512-LYMMwb11aaIQVnLnmqgd3Ml7aNTOKlQ7f3LAqlDHy4tjNRVdGVMOewx1XLCpM/K7blaJflVxnmS3P08qRozQ9g==\n+\n+google-closure-compiler-windows@^20221102.0.0:\n+  version \"20221102.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-windows/-/google-closure-compiler-windows-20221102.0.0.tgz#ca7eac261ffff1a5ce5ecb9ea286746e7fb7fde5\"\n+  integrity sha512-cgF2KkLvXNUpYx49KpxqKChYVGCf9CGGhzKC/OBLhYvN5T2rJb6a7ax/SSDdzy0XEcipX+kmVrRX4x0vo6lZ6Q==\n+\n+google-closure-compiler@^20221102.0.0:\n+  version \"20221102.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler/-/google-closure-compiler-20221102.0.0.tgz#b00f8102cf8bab80edb1ef6377be6fc602b3db30\"\n+  integrity sha512-WmHWoPfBNOKRbQcAh9u4jqvGHhZl8woNMUxvBpb1ULXuRIMHoTBFi70fEbCLABeU7AwjRz7MY7zqGpp1hZM9rQ==\n   dependencies:\n     chalk \"4.x\"\n-    google-closure-compiler-java \"^20221004.0.0\"\n+    google-closure-compiler-java \"^20221102.0.0\"\n     minimist \"1.x\"\n     vinyl \"2.x\"\n     vinyl-sourcemaps-apply \"^0.2.0\"\n   optionalDependencies:\n-    google-closure-compiler-linux \"^20221004.0.0\"\n-    google-closure-compiler-osx \"^20221004.0.0\"\n-    google-closure-compiler-windows \"^20221004.0.0\"\n+    google-closure-compiler-linux \"^20221102.0.0\"\n+    google-closure-compiler-osx \"^20221102.0.0\"\n+    google-closure-compiler-windows \"^20221102.0.0\"\n \n graceful-fs@^4.2.9:\n   version \"4.2.10\"\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -8098,40 +8098,40 @@ google-auth-library@^8.0.2:\n     jws \"^4.0.0\"\n     lru-cache \"^6.0.0\"\n \n-google-closure-compiler-java@^20221004.0.0:\n-  version \"20221004.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-java/-/google-closure-compiler-java-20221004.0.0.tgz#ba1049987bd91ebdcc2aebe184bf839bcaa0017e\"\n-  integrity sha512-CygLEB40HxtK0VtP6klv2Xm08w4HQNYX/DTgLV7CP74r8LiQMUByRFleaG/Hv5xQG1JzPNiW0GOAiAubDSdr5A==\n-\n-google-closure-compiler-linux@^20221004.0.0:\n-  version \"20221004.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-linux/-/google-closure-compiler-linux-20221004.0.0.tgz#6fe30f5e970d5a8de9efe9ac3a5d65b60c2c1dc8\"\n-  integrity sha512-B6sca3Lmw3cYXdFzdU0iQpk8L9VEo1ecC1aM7Gl9lgWhIicqqEZebsgnUe5TQ3uHBfQoKjV9fdFG8mt8X/oqSQ==\n-\n-google-closure-compiler-osx@^20221004.0.0:\n-  version \"20221004.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-osx/-/google-closure-compiler-osx-20221004.0.0.tgz#3efdcd226f5dbb2dedab40a3436f2a1b59709dc5\"\n-  integrity sha512-z5V7BvaMauPga8DMTt9u6RGcjBdLAuv4gL2Ebw5NIQRTAHVkEVzCd3kiMX7CVCGhmWdS/1r3jZcCg4BswGia6w==\n-\n-google-closure-compiler-windows@^20221004.0.0:\n-  version \"20221004.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-windows/-/google-closure-compiler-windows-20221004.0.0.tgz#ee61f329b906993a7e2fa419690d93de437bd21a\"\n-  integrity sha512-JSAWilVa7d65QJYKUr+DmklwKmjkAce6BMD6smqJfdL2dv5OSJ2ydGy73euoBJ4Tka8iQPoaOP+BjLrhIuvqKg==\n-\n-google-closure-compiler@20221004.0.0:\n-  version \"20221004.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler/-/google-closure-compiler-20221004.0.0.tgz#18d255ada6562ddd0332e1e25921bcffc12eaf28\"\n-  integrity sha512-OKENLrZFF2o3FZ/E4zdTc9NeuAUh1fdwbQxT0sibI19aR62sgNUBo2mLU6sc4Gcm0cQ2gwfB7qX1xnapOIkbaA==\n+google-closure-compiler-java@^20221102.0.0:\n+  version \"20221102.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-java/-/google-closure-compiler-java-20221102.0.0.tgz#bba0d0f31a1e9f5034ebfb19dc3bce26c725e79e\"\n+  integrity sha512-feAsp8xVU+jJydBfVTRK4/9jHpNZOX9jbhFziDLd3xypFgjb1CLQ9SzohS1hqA97q8wYxalB6HXU4JdicmRmUA==\n+\n+google-closure-compiler-linux@^20221102.0.0:\n+  version \"20221102.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-linux/-/google-closure-compiler-linux-20221102.0.0.tgz#84cda7af5aaa68a8e7041694d4da3583e4c40687\"\n+  integrity sha512-coffCJoA4XK1M34/+R0u1AN9hGCMj+8M5JnBm0WCvOEtbC+pNGPNiYZw53zFWZZpJ/jCqJnRvRpZe18C773fnQ==\n+\n+google-closure-compiler-osx@^20221102.0.0:\n+  version \"20221102.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-osx/-/google-closure-compiler-osx-20221102.0.0.tgz#d7ee87505377d407dbde9fc78f6720c4c727347b\"\n+  integrity sha512-LYMMwb11aaIQVnLnmqgd3Ml7aNTOKlQ7f3LAqlDHy4tjNRVdGVMOewx1XLCpM/K7blaJflVxnmS3P08qRozQ9g==\n+\n+google-closure-compiler-windows@^20221102.0.0:\n+  version \"20221102.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-windows/-/google-closure-compiler-windows-20221102.0.0.tgz#ca7eac261ffff1a5ce5ecb9ea286746e7fb7fde5\"\n+  integrity sha512-cgF2KkLvXNUpYx49KpxqKChYVGCf9CGGhzKC/OBLhYvN5T2rJb6a7ax/SSDdzy0XEcipX+kmVrRX4x0vo6lZ6Q==\n+\n+google-closure-compiler@20221102.0.0:\n+  version \"20221102.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler/-/google-closure-compiler-20221102.0.0.tgz#b00f8102cf8bab80edb1ef6377be6fc602b3db30\"\n+  integrity sha512-WmHWoPfBNOKRbQcAh9u4jqvGHhZl8woNMUxvBpb1ULXuRIMHoTBFi70fEbCLABeU7AwjRz7MY7zqGpp1hZM9rQ==\n   dependencies:\n     chalk \"4.x\"\n-    google-closure-compiler-java \"^20221004.0.0\"\n+    google-closure-compiler-java \"^20221102.0.0\"\n     minimist \"1.x\"\n     vinyl \"2.x\"\n     vinyl-sourcemaps-apply \"^0.2.0\"\n   optionalDependencies:\n-    google-closure-compiler-linux \"^20221004.0.0\"\n-    google-closure-compiler-osx \"^20221004.0.0\"\n-    google-closure-compiler-windows \"^20221004.0.0\"\n+    google-closure-compiler-linux \"^20221102.0.0\"\n+    google-closure-compiler-osx \"^20221102.0.0\"\n+    google-closure-compiler-windows \"^20221102.0.0\"\n \n google-gax@^3.0.1:\n   version \"3.1.3\"\n\n\n###\n\n", "completion": "build: update dependency google-closure-compiler to v20221102 (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/image-directive-setup.md | file path B: None\n\n@@ -1,57 +0,0 @@\n-# Configuring an image loader for `NgOptimizedImage`\n-\n-These instructions explain how to set up an image loader for use with the `NgOptimizedImage`.\n-\n-A \"loader\" is a function that generates an [image transformation URL](https://web.dev/image-cdns/#how-image-cdns-use-urls-to-indicate-optimization-options) for a given image file. When appropriate, `NgOptimizedImage` sets the size, format, and image quality transformations for an image.\n-\n-`NgOptimizedImage` provides both a generic loader that applies no transformations, as well as loaders for various third-party image services. It also supports writing your own custom loader.\n-\n-| Loader type| Behavior |\n-|:--- |:--- |\n-| Generic loader | The URL returned by the generic loader will always match the value of `src`. In other words, this loader applies no transformations. Sites that use Angular to serve images are the primary intended use case for this loader.|\n-| Loaders for third-party image services | The URL returned by the loaders for third-party image services will follow API conventions used by that particular image service. |\n-| Custom loaders | A custom loader's behavior is defined by its developer. You should use a custom loader if your image service isn't supported by the loaders that come preconfigured with `NgOptimizedImage`.|\n-\n-Based on the image services commonly used with Angular applications, `NgOptimizedImage` provides loaders preconfigured to work with the following image services:\n-\n-| Image Service | Angular API | Documentation |\n-|:--- |:--- |:--- |\n-| Cloudflare Image Resizing | `provideCloudflareLoader` | [Documentation](https://developers.cloudflare.com/images/image-resizing/) |\n-| Cloudinary | `provideCloudinaryLoader` | [Documentation](https://cloudinary.com/documentation/resizing_and_cropping) |\n-| ImageKit | `provideImageKitLoader` | [Documentation](https://docs.imagekit.io/) |\n-| Imgix | `provideImgixLoader` | [Documentation](https://docs.imgix.com/) |\n-\n-To use the **generic loader**: no additional code changes are necessary. This is the default behavior.\n-\n-To use an existing loader for a **third-party image service**: add the provider factory for your chosen service to the `providers` array. In the example below, the Imgix loader is used:\n-\n-<code-example format=\"typescript\" language=\"typescript\">\n-providers: [\n-  provideImgixLoader('https://my.base.url/'),\n-],\n-</code-example>\n-\n-The base URL for your image assets should be passed to the provider factory as an argument. For most sites, this base URL should match one of the following patterns:\n-\n-*   https://yoursite.yourcdn.com\n-*   https://subdomain.yoursite.com\n-*   https://subdomain.yourcdn.com/yoursite\n-\n-You can learn more about the base URL structure in the docs of a corresponding CDN provider.\n-\n-To use a **custom loader**: provide your loader function as a value for the `IMAGE_LOADER` DI token. In the example below, the custom loader function returns a URL starting with `https://example.com` that includes `src` and `width` as URL parameters.\n-\n-<code-example format=\"typescript\" language=\"typescript\">\n-providers: [\n-  {\n-    provide: IMAGE_LOADER,\n-    useValue: (config: ImageLoaderConfig) => {\n-      return `https://example.com/images?src=${config.src}&width=${config.width}`;\n-    },\n-  },\n-],\n-</code-example>\n-\n-A loader function for the `NgOptimizedImage` directive takes an object with the `ImageLoaderConfig` type (from `@angular/common`) as its argument and returns the absolute URL of the image asset. The `ImageLoaderConfig` object contains the `src`and `width` properties.\n-\n-Note: a custom loader must support requesting images at various widths in order for `ngSrcset` to work properly.\n\n---\n file path A: aio/content/guide/image-directive.md | file path B: aio/content/guide/image-directive.md\n\n@@ -12,14 +12,14 @@ The directive ensures that the loading of the [Largest Contentful Paint](http://\n In addition to optimizing the loading of the LCP image, `NgOptimizedImage` enforces a number of image best practices:\n \n *   Uses [image CDN URLs to apply image optimizations](https://web.dev/image-cdns/#how-image-cdns-use-urls-to-indicate-optimization-options)\n-*   Requires that `width` and `height` are set\n+*   Prevents layout shift by requiring `width` and `height`\n *   Warns if `width` or `height` have been set incorrectly\n *   Warns if the image will be visually distorted when rendered\n \n ## Prerequisites\n \n 1. You will need to import `NgOptimizedImage` from the `@angular/common` module into your application. The directive is defined as a [standalone directive](/guide/standalone-components), so components should import it directly.\n-2. Consider setting up an image loader. These steps are explained in the [Configuring an image loader](/guide/image-directive-setup) tutorial.\n+2. Consider setting up an image loader. These steps are explained in the [Configuring an Image Loader](#configuring-an-image-loader-for-ngoptimizedimage) section.\n \n ## Usage in a template\n \n@@ -33,7 +33,7 @@ To activate the `NgOptimizedImage` directive, replace your image's `src` attribu\n \n </code-example>\n \n-If you're using a built-in third-party loader, make sure to omit the base URL path from `src`, as that will be prepended automatically by the loader.\n+If you're using a [built-in third-party loader](#built-in-loaders), make sure to omit the base URL path from `src`, as that will be prepended automatically by the loader.\n \n ### Preventing layout shift\n \n@@ -146,7 +146,7 @@ If you would like to manually define a `srcset` attribute, you can provide your\n \n </code-example>\n \n-If the `ngSrcset` attribute is present, `NgOptimizedImage` generates and sets the `srcset` based on the sizes included. Do not include image file names in `ngSrcset` - the directive infers this information from `ngSrc`. The directive supports both width descriptors (e.g. `100w`) and density descriptors (e.g. `1x`) are supported.\n+If the `ngSrcset` attribute is present, `NgOptimizedImage` generates and sets the `srcset` based on the sizes included. Do not include image file names in `ngSrcset` - the directive infers this information from `ngSrc`. The directive supports both width descriptors (e.g. `100w`) and density descriptors (e.g. `1x`).\n \n <code-example format=\"html\" language=\"html\">\n \n@@ -188,10 +188,70 @@ The `sizes` attribute in the above example says \"I expect this image to be 100 p\n \n For additional information about the `sizes` attribute, see [web.dev](https://web.dev/learn/design/responsive-images/#sizes) or [mdn](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/sizes).\n \n+## Configuring an image loader for `NgOptimizedImage`\n+\n+A \"loader\" is a function that generates an [image transformation URL](https://web.dev/image-cdns/#how-image-cdns-use-urls-to-indicate-optimization-options) for a given image file. When appropriate, `NgOptimizedImage` sets the size, format, and image quality transformations for an image.\n+\n+`NgOptimizedImage` provides both a generic loader that applies no transformations, as well as loaders for various third-party image services. It also supports writing your own custom loader.\n+\n+| Loader type| Behavior |\n+|:--- |:--- |\n+| Generic loader | The URL returned by the generic loader will always match the value of `src`. In other words, this loader applies no transformations. Sites that use Angular to serve images are the primary intended use case for this loader.|\n+| Loaders for third-party image services | The URL returned by the loaders for third-party image services will follow API conventions used by that particular image service. |\n+| Custom loaders | A custom loader's behavior is defined by its developer. You should use a custom loader if your image service isn't supported by the loaders that come preconfigured with `NgOptimizedImage`.|\n+\n+Based on the image services commonly used with Angular applications, `NgOptimizedImage` provides loaders preconfigured to work with the following image services:\n+\n+| Image Service | Angular API | Documentation |\n+|:--- |:--- |:--- |\n+| Cloudflare Image Resizing | `provideCloudflareLoader` | [Documentation](https://developers.cloudflare.com/images/image-resizing/) |\n+| Cloudinary | `provideCloudinaryLoader` | [Documentation](https://cloudinary.com/documentation/resizing_and_cropping) |\n+| ImageKit | `provideImageKitLoader` | [Documentation](https://docs.imagekit.io/) |\n+| Imgix | `provideImgixLoader` | [Documentation](https://docs.imgix.com/) |\n+\n+To use the **generic loader** no additional code changes are necessary. This is the default behavior.\n+\n+### Built-in Loaders\n+\n+To use an existing loader for a **third-party image service**, add the provider factory for your chosen service to the `providers` array. In the example below, the Imgix loader is used:\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+providers: [\n+  provideImgixLoader('https://my.base.url/'),\n+],\n+</code-example>\n+\n+The base URL for your image assets should be passed to the provider factory as an argument. For most sites, this base URL should match one of the following patterns:\n+\n+*   https://yoursite.yourcdn.com\n+*   https://subdomain.yoursite.com\n+*   https://subdomain.yourcdn.com/yoursite\n+\n+You can learn more about the base URL structure in the docs of a corresponding CDN provider.\n+\n+### Custom Loaders\n+\n+To use a **custom loader**, provide your loader function as a value for the `IMAGE_LOADER` DI token. In the example below, the custom loader function returns a URL starting with `https://example.com` that includes `src` and `width` as URL parameters.\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+providers: [\n+  {\n+    provide: IMAGE_LOADER,\n+    useValue: (config: ImageLoaderConfig) => {\n+      return `https://example.com/images?src=${config.src}&width=${config.width}`;\n+    },\n+  },\n+],\n+</code-example>\n+\n+A loader function for the `NgOptimizedImage` directive takes an object with the `ImageLoaderConfig` type (from `@angular/common`) as its argument and returns the absolute URL of the image asset. The `ImageLoaderConfig` object contains the `src` and `width` properties.\n+\n+Note: a custom loader must support requesting images at various widths in order for `ngSrcset` to work properly.\n+\n <!-- links -->\n \n <!-- external links -->\n \n <!--end links -->\n \n-@reviewed 2022-08-25\n+@reviewed 2022-11-07\n\n---\n file path A: aio/content/navigation.json | file path B: aio/content/navigation.json\n\n@@ -825,11 +825,6 @@\n           \"title\": \"Building a template-driven form\",\n           \"tooltip\": \"Create a template-driven form using directives and Angular template syntax.\"\n         },\n-        {\n-          \"url\": \"guide/image-directive-setup\",\n-          \"title\": \"Configuring an image loader for NgOptimizedImage\",\n-          \"tooltip\": \"Set up an image loader for the Angular image directive\"\n-        },\n         {\n           \"title\": \"Angular Libraries\",\n           \"tooltip\": \"Extending Angular with shared libraries.\",\n\n\n###\n\n", "completion": "docs(common): Merge two ngOptimizedImage docs into one (#<issue-num>)"}
{"prompt": " file path A: aio/content/errors/NG1203.md | file path B: aio/content/errors/NG01203.md\n\n@@ -1,5 +1,5 @@\n @name Missing value accessor\n-@category forms\n+@category runtime\n @shortDescription You must register an `NgValueAccessor` with a custom form control\n \n @description\n\n---\n file path A: packages/core/src/errors.ts | file path B: packages/core/src/errors.ts\n\n@@ -113,6 +113,7 @@ export function formatRuntimeError<T extends number = RuntimeErrorCode>(\n     code: T, message: null|false|string): string {\n   // Error code might be a negative number, which is a special marker that instructs the logic to\n   // generate a link to the error details page on angular.io.\n+  // We also prepend `0` to non-compile-time errors.\n   const fullCode = `NG0${Math.abs(code)}`;\n \n   let errorMessage = `${fullCode}${message ? ': ' + message.trim() : ''}`;\n\n\n###\n\n", "completion": "fix(forms): Runtime error pages must begin with leading zero (#<issue-num>)"}
{"prompt": " file path A: packages/router/test/integration.spec.ts | file path B: packages/router/test/integration.spec.ts\n\n@@ -2983,22 +2983,6 @@ describe('Integration', () => {\n         expect(history[history.length - 1].state)\n             .toEqual({foo: 'bar', navigationId: history.length});\n       })));\n-\n-\n-      it('can redirect from componentless named outlets', fakeAsync(() => {\n-           const router = TestBed.inject(Router);\n-           const fixture = createRoot(router, RootCmp);\n-\n-           router.resetConfig([\n-             {path: 'main', outlet: 'aux', component: BlankCmp},\n-             {path: '', pathMatch: 'full', outlet: 'aux', redirectTo: 'main'},\n-           ]);\n-\n-           router.navigateByUrl('');\n-           advance(fixture);\n-\n-           expect(TestBed.inject(Location).path()).toEqual('/(aux:main)');\n-         }));\n     });\n \n     it('should set href on area elements', fakeAsync(() => {\n@@ -3035,6 +3019,21 @@ describe('Integration', () => {\n          expect(location.path()).toEqual('/team/22');\n        })));\n \n+    it('can redirect from componentless named outlets', fakeAsync(() => {\n+         const router = TestBed.inject(Router);\n+         const fixture = createRoot(router, RootCmp);\n+\n+         router.resetConfig([\n+           {path: 'main', outlet: 'aux', component: BlankCmp},\n+           {path: '', pathMatch: 'full', outlet: 'aux', redirectTo: 'main'},\n+         ]);\n+\n+         router.navigateByUrl('');\n+         advance(fixture);\n+\n+         expect(TestBed.inject(Location).path()).toEqual('/(aux:main)');\n+       }));\n+\n     it('should update Navigation object after redirects are applied',\n        fakeAsync(inject([Router, Location], (router: Router, location: Location) => {\n          const fixture = createRoot(router, RootCmp);\n\n\n###\n\n", "completion": "test(router): Move test for redirect under correct describe block (#<issue-num>)"}
{"prompt": " file path A: None | file path B: aio/content/errors/NG1203.md\n\n@@ -0,0 +1,28 @@\n+@name Missing value accessor\n+@category forms\n+@shortDescription You must register an `NgValueAccessor` with a custom form control\n+\n+@description\n+For all custom form controls, you must register a value accessor.\n+\n+Here's an example of how to provide one:\n+\n+```typescript\n+providers: [\n+  {\n+    provide: NG_VALUE_ACCESSOR,\n+    useExisting: forwardRef(() => MyInputField),\n+    multi: true,\n+  }\n+]\n+```\n+\n+@debugging\n+As described above, your control was expected to have a value accessor, but was missing one. However, there are many different reasons this can happen in practice. Here's a listing of some known problems leading to this error.\n+\n+1. If you **defined** a custom form control, did you remember to provide a value accessor?\n+1. Did you put `ngModel` on an element with no value, or an **invalid element** (e.g. `<div [(ngModel)]=\"foo\">`)?\n+1. Are you using a custom form control declared inside an `NgModule`? if so, make sure you are **importing** the `NgModule`.\n+1. Are you using `ngModel` with a third-party custom form control? Check whether that control provides a value accessor. If not, use **`ngDefaultControl`** on the control's element.\n+1. Are you **testing** a custom form control? Be sure to configure your testbed to know about the control. You can do so with `Testbed.configureTestingModule`.\n+1. Are you using **Nx and Module Federation** with Webpack? Your `webpack.config.js` may require [extra configuration](https://github.com/angular/angular/issues/43821#issuecomment-1054845431) to ensure the forms package is shared.\n\n---\n file path A: goldens/public-api/forms/errors.md | file path B: goldens/public-api/forms/errors.md\n\n@@ -25,6 +25,8 @@ export const enum RuntimeErrorCode {\n     // (undocumented)\n     NAME_AND_FORM_CONTROL_NAME_MUST_MATCH = 1202,\n     // (undocumented)\n+    NG_MISSING_VALUE_ACCESSOR = -1203,\n+    // (undocumented)\n     NG_VALUE_ACCESSOR_NOT_PROVIDED = 1200,\n     // (undocumented)\n     NGMODEL_IN_FORM_GROUP = 1350,\n\n---\n file path A: goldens/size-tracking/integration-payloads.json | file path B: goldens/size-tracking/integration-payloads.json\n\n@@ -48,8 +48,8 @@\n   \"animations\": {\n     \"uncompressed\": {\n       \"runtime\": 1070,\n-      \"main\": 155920,\n-      \"polyfills\": 33814\n+      \"main\": 156355,\n+      \"polyfills\": 33897\n     }\n   },\n   \"standalone-bootstrap\": {\n\n---\n file path A: packages/forms/src/directives/shared.ts | file path B: packages/forms/src/directives/shared.ts\n\n@@ -65,7 +65,7 @@ export function setUpControl(\n     callSetDisabledState: SetDisabledStateOption = setDisabledStateDefault): void {\n   if (typeof ngDevMode === 'undefined' || ngDevMode) {\n     if (!control) _throwError(dir, 'Cannot find control with');\n-    if (!dir.valueAccessor) _throwError(dir, 'No value accessor for form control with');\n+    if (!dir.valueAccessor) _throwMissingValueAccessorError(dir);\n   }\n \n   setUpValidators(control, dir);\n@@ -322,6 +322,12 @@ function _describeControlLocation(dir: AbstractControlDirective): string {\n   return 'unspecified name attribute';\n }\n \n+function _throwMissingValueAccessorError(dir: AbstractControlDirective) {\n+  const loc = _describeControlLocation(dir);\n+  throw new RuntimeError(\n+      RuntimeErrorCode.NG_MISSING_VALUE_ACCESSOR, `No value accessor for form control ${loc}.`);\n+}\n+\n function _throwInvalidValueAccessorError(dir: AbstractControlDirective) {\n   const loc = _describeControlLocation(dir);\n   throw new RuntimeError(\n\n---\n file path A: packages/forms/src/errors.ts | file path B: packages/forms/src/errors.ts\n\n@@ -31,6 +31,7 @@ export const enum RuntimeErrorCode {\n   NG_VALUE_ACCESSOR_NOT_PROVIDED = 1200,\n   COMPAREWITH_NOT_A_FN = 1201,\n   NAME_AND_FORM_CONTROL_NAME_MUST_MATCH = 1202,\n+  NG_MISSING_VALUE_ACCESSOR = -1203,\n \n   // Template-driven Forms errors (1350-1399)\n   NGMODEL_IN_FORM_GROUP = 1350,\n\n---\n file path A: packages/forms/test/directives_spec.ts | file path B: packages/forms/test/directives_spec.ts\n\n@@ -184,7 +184,8 @@ class CustomValidatorDirective implements Validator {\n           dir.name = 'login';\n \n           expect(() => form.addControl(dir))\n-              .toThrowError(new RegExp(`No value accessor for form control with name: 'login'`));\n+              .toThrowError(new RegExp(\n+                  `NG01203: No value accessor for form control name: 'login'. Find more at https://angular.io/errors/NG01203`));\n         });\n \n         it('should throw when no value accessor with path', () => {\n@@ -195,7 +196,7 @@ class CustomValidatorDirective implements Validator {\n \n           expect(() => form.addControl(dir))\n               .toThrowError(new RegExp(\n-                  `No value accessor for form control with path: 'passwords -> password'`));\n+                  `NG01203: No value accessor for form control path: 'passwords -> password'. Find more at https://angular.io/errors/NG01203`));\n         });\n \n         it('should set up validators', fakeAsync(() => {\n@@ -582,15 +583,16 @@ class CustomValidatorDirective implements Validator {\n         namedDir.name = 'one';\n \n         expect(() => namedDir.ngOnChanges({}))\n-            .toThrowError(new RegExp(`No value accessor for form control with name: 'one'`));\n+            .toThrowError(new RegExp(\n+                `NG01203: No value accessor for form control name: 'one'. Find more at https://angular.io/errors/NG01203`));\n       });\n \n       it('should throw when no value accessor with unnamed control', () => {\n         const unnamedDir = new NgModel(null!, null!, null!, null!);\n \n         expect(() => unnamedDir.ngOnChanges({}))\n-            .toThrowError(\n-                new RegExp(`No value accessor for form control with unspecified name attribute`));\n+            .toThrowError(new RegExp(\n+                `NG01203: No value accessor for form control unspecified name attribute. Find more at https://angular.io/errors/NG01203`));\n       });\n \n       it('should set up validator', fakeAsync(() => {\n\n---\n file path A: packages/forms/test/reactive_integration_spec.ts | file path B: packages/forms/test/reactive_integration_spec.ts\n\n@@ -5093,7 +5093,9 @@ const ValueAccessorB = createControlValueAccessor('[cva-b]');\n         const fixture = initTest(NoCVAComponent);\n         expect(() => {\n           fixture.detectChanges();\n-        }).toThrowError('No value accessor for form control with name: \\'control\\'');\n+        })\n+            .toThrowError(\n+                `NG01203: No value accessor for form control name: 'control'. Find more at https://angular.io/errors/NG01203`);\n \n         // Making sure that cleanup between tests doesn't cause any issues\n         // for not fully initialized controls.\n\n\n###\n\n", "completion": "fix(forms): Improve a very commonly viewed error message by adding a guide. (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/render3/component_ref.ts | file path B: packages/core/src/render3/component_ref.ts\n\n@@ -169,9 +169,7 @@ export class ComponentFactory<T> extends AbstractComponentFactory<T> {\n     const elementName = this.componentDef.selectors[0][0] as string || 'div';\n     const hostRNode = rootSelectorOrNode ?\n         locateHostElement(hostRenderer, rootSelectorOrNode, this.componentDef.encapsulation) :\n-        createElementNode(\n-            rendererFactory.createRenderer(null, this.componentDef), elementName,\n-            getNamespace(elementName));\n+        createElementNode(hostRenderer, elementName, getNamespace(elementName));\n \n     const rootFlags = this.componentDef.onPush ? LViewFlags.Dirty | LViewFlags.IsRoot :\n                                                  LViewFlags.CheckAlways | LViewFlags.IsRoot;\n\n\n###\n\n", "completion": "refactor(core): remove duplicate createRenderer call (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -743,7 +743,7 @@ class RouterLink implements OnChanges, OnDestroy {\n     // (undocumented)\n     get urlTree(): UrlTree | null;\n     // (undocumented)\n-    static \u0275dir: i0.\u0275\u0275DirectiveDeclaration<RouterLink, \":not(a):not(area)[routerLink],a[routerLink],area[routerLink]\", never, { \"target\": \"target\"; \"queryParams\": \"queryParams\"; \"fragment\": \"fragment\"; \"queryParamsHandling\": \"queryParamsHandling\"; \"state\": \"state\"; \"relativeTo\": \"relativeTo\"; \"preserveFragment\": \"preserveFragment\"; \"skipLocationChange\": \"skipLocationChange\"; \"replaceUrl\": \"replaceUrl\"; \"routerLink\": \"routerLink\"; }, {}, never, never, true, never>;\n+    static \u0275dir: i0.\u0275\u0275DirectiveDeclaration<RouterLink, \"[routerLink]\", never, { \"target\": \"target\"; \"queryParams\": \"queryParams\"; \"fragment\": \"fragment\"; \"queryParamsHandling\": \"queryParamsHandling\"; \"state\": \"state\"; \"relativeTo\": \"relativeTo\"; \"preserveFragment\": \"preserveFragment\"; \"skipLocationChange\": \"skipLocationChange\"; \"replaceUrl\": \"replaceUrl\"; \"routerLink\": \"routerLink\"; }, {}, never, never, true, never>;\n     // (undocumented)\n     static \u0275fac: i0.\u0275\u0275FactoryDeclaration<RouterLink, [null, null, { attribute: \"tabindex\"; }, null, null, null]>;\n }\n\n---\n file path A: packages/router/src/directives/router_link.ts | file path B: packages/router/src/directives/router_link.ts\n\n@@ -116,7 +116,7 @@ import {UrlTree} from '../url_tree';\n  * @publicApi\n  */\n @Directive({\n-  selector: ':not(a):not(area)[routerLink],a[routerLink],area[routerLink]',\n+  selector: '[routerLink]',\n   standalone: true,\n })\n export class RouterLink implements OnChanges, OnDestroy {\n\n\n###\n\n", "completion": "refactor(router): Simplify routerLink selector (#<issue-num>)"}
{"prompt": " file path A: .ng-dev/caretaker.mts | file path B: .ng-dev/caretaker.mts\n\n@@ -10,7 +10,7 @@ export const caretaker: CaretakerConfig = {\n     },\n     {\n       name: 'Merge Assistance Queue',\n-      query: `is:pr is:open label:\"action: caretaker note\"`,\n+      query: `is:pr is:open label:\"merge: caretaker note\" label:\"action: merge\"`,\n     },\n     {\n       name: 'Initial Triage Queue',\n\n\n###\n\n", "completion": "build: update ng-dev configuration to account for caretaker note label change (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/browser-support.md | file path B: aio/content/guide/browser-support.md\n\n@@ -30,6 +30,8 @@ See instructions on how to include polyfills into your project below.\n The suggested polyfills are the ones that run full Angular applications.\n You might need additional polyfills to support features not covered by this list.\n \n+</div>\n+\n <div class=\"alert is-helpful\">\n \n **NOTE**: <br />\n@@ -37,18 +39,32 @@ Polyfills cannot magically transform an old, slow browser into a modern, fast on\n \n </div>\n \n-</div>\n-\n ## Enabling polyfills with CLI projects\n \n The [Angular CLI](cli) provides support for polyfills.\n If you are not using the CLI to create your projects, see [Polyfill instructions for non-CLI users](#non-cli).\n \n-When you create a project with the `ng new` command, a `src/polyfills.ts` configuration file is created as part of your project folder.\n-This file incorporates the mandatory and many of the optional polyfills as JavaScript `import` statements.\n+The `polyfills` options of the [browser](cli/build) and [test](cli/test) builder can be a full path for a file \\(Example: `src/polyfills.ts`\\) or,\n+relative to the current workspace or module specifier \\(Example: `zone.js`\\).\n+\n+If you create a TypeScript file, make sure to include it in the `files` property of your `tsconfig` file.\n+\n+<code-example language=\"jsonc\" syntax=\"jsonc\">\n+\n+{\n+  \"extends\": \"./tsconfig.json\",\n+  \"compilerOptions\": {\n+    ...\n+  },\n+  \"files\": [\n+    \"src/main.ts\",\n+    \"src/polyfills.ts\"\n+  ]\n+  ...\n+}\n+\n+</code-example>\n \n-*   The npm packages for the mandatory polyfills \\(such as `zone.js`\\) are installed automatically for you when you create your project with `ng new`, and their corresponding `import` statements are already enabled in the `src/polyfills.ts` configuration file\n-*   If you need an *optional* polyfill, you must install its npm package, then uncomment or create the corresponding import statement in the `src/polyfills.ts` configuration file\n \n <a id=\"non-cli\"></a>\n \n@@ -89,4 +105,4 @@ For example:\n \n <!-- end links -->\n \n-@reviewed 2022-02-28\n+@reviewed 2022-11-04\n\n\n###\n\n", "completion": "docs: update polyfills sections for version 15 (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/assistant-to-the-branch-manager.yml | file path B: .github/workflows/assistant-to-the-branch-manager.yml\n\n@@ -11,7 +11,6 @@ permissions:\n \n jobs:\n   assistant_to_the_branch_manager:\n-    if: github.action == 'pull_request_target' or github.action == 'push'\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3.0.2\n\n\n###\n\n", "completion": "build: fix invalid yaml (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/utils/config.ts | file path B: packages/router/src/utils/config.ts\n\n@@ -84,8 +84,8 @@ function validateNode(route: Route, fullPath: string, requireStandaloneComponent\n           RuntimeErrorCode.INVALID_ROUTE_CONFIG,\n           `Invalid configuration of route '${fullPath}': Array cannot be specified`);\n     }\n-    if (!route.component && !route.loadComponent && !route.children && !route.loadChildren &&\n-        (route.outlet && route.outlet !== PRIMARY_OUTLET)) {\n+    if (!route.redirectTo && !route.component && !route.loadComponent && !route.children &&\n+        !route.loadChildren && (route.outlet && route.outlet !== PRIMARY_OUTLET)) {\n       throw new RuntimeError(\n           RuntimeErrorCode.INVALID_ROUTE_CONFIG,\n           `Invalid configuration of route '${\n\n---\n file path A: packages/router/test/config.spec.ts | file path B: packages/router/test/config.spec.ts\n\n@@ -157,6 +157,12 @@ describe('config', () => {\n         validateConfig([{path: 'a', outlet: 'aux', loadChildren: jasmine.createSpy('child')}]);\n       }).not.toThrow();\n     });\n+\n+    it('should not throw when outlet has redirectTo', () => {\n+      expect(() => {\n+        validateConfig([{path: '', pathMatch: 'prefix', outlet: 'aux', redirectTo: 'main'}]);\n+      }).not.toThrow();\n+    });\n   });\n });\n \n\n---\n file path A: packages/router/test/integration.spec.ts | file path B: packages/router/test/integration.spec.ts\n\n@@ -2983,6 +2983,22 @@ describe('Integration', () => {\n         expect(history[history.length - 1].state)\n             .toEqual({foo: 'bar', navigationId: history.length});\n       })));\n+\n+\n+      it('can redirect from componentless named outlets', fakeAsync(() => {\n+           const router = TestBed.inject(Router);\n+           const fixture = createRoot(router, RootCmp);\n+\n+           router.resetConfig([\n+             {path: 'main', outlet: 'aux', component: BlankCmp},\n+             {path: '', pathMatch: 'full', outlet: 'aux', redirectTo: 'main'},\n+           ]);\n+\n+           router.navigateByUrl('');\n+           advance(fixture);\n+\n+           expect(TestBed.inject(Location).path()).toEqual('/(aux:main)');\n+         }));\n     });\n \n     it('should set href on area elements', fakeAsync(() => {\n\n\n###\n\n", "completion": "fix(router): fix redirectTo on named outlets - resolves #33783 (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/deprecations.md | file path B: aio/content/guide/deprecations.md\n\n@@ -168,7 +168,7 @@ In the [API reference section](api) of this site, deprecated APIs are indicated\n | [`resolver` argument in `RouterOutletContract.activateWith`](api/router/RouterOutletContract#activatewith) | No replacement needed | v14                   | Component factories are not required to create an instance of a component dynamically. Passing a factory resolver via `resolver` argument is no longer needed. |\n | [`resolver` field of the `OutletContext` class](api/router/OutletContext#resolver) | No replacement needed | v14                   | Component factories are not required to create an instance of a component dynamically. Passing a factory resolver via `resolver` class field is no longer needed. |\n | [`RouterLinkWithHref` directive](api/router/RouterLinkWithHref) | Use `RouterLink` instead. | v15                   | The `RouterLinkWithHref` directive code was merged into `RouterLink`. Now the `RouterLink` directive can be used for all elements that have `routerLink` attribute. |\n-| [`provideRoutes` function](api/router/provideRoutes) | Use `ROUTES` `InjectionToken` instead. | v15                   | The `provideRoutes` helper function is minimally useful and can be unintentionally used instead of `provideRoutes` due similar spelling. |\n+| [`provideRoutes` function](api/router/provideRoutes) | Use `ROUTES` `InjectionToken` instead. | v15                   | The `provideRoutes` helper function is minimally useful and can be unintentionally used instead of `provideRouter` due to similar spelling. |\n \n \n <a id=\"platform-browser\"></a>\n\n---\n file path A: packages/core/test/bundling/router/bundle.golden_symbols.json | file path B: packages/core/test/bundling/router/bundle.golden_symbols.json\n\n@@ -1577,9 +1577,6 @@\n   {\n     \"name\": \"promise\"\n   },\n-  {\n-    \"name\": \"provideRoutes\"\n-  },\n   {\n     \"name\": \"redirectIfUrlTree\"\n   },\n@@ -1640,6 +1637,9 @@\n   {\n     \"name\": \"rootRoute\"\n   },\n+  {\n+    \"name\": \"routes\"\n+  },\n   {\n     \"name\": \"rxSubscriber\"\n   },\n\n---\n file path A: packages/router/src/provide_router.ts | file path B: packages/router/src/provide_router.ts\n\n@@ -61,6 +61,7 @@ const NG_DEV_MODE = typeof ngDevMode === 'undefined' || ngDevMode;\n export function provideRouter(routes: Routes, ...features: RouterFeatures[]): EnvironmentProviders {\n   return makeEnvironmentProviders([\n     {provide: ROUTES, multi: true, useValue: routes},\n+    NG_DEV_MODE ? {provide: ROUTER_IS_PROVIDED, useValue: true} : [],\n     {provide: ActivatedRoute, useFactory: rootRoute, deps: [Router]},\n     {provide: APP_BOOTSTRAP_LISTENER, multi: true, useFactory: getBootstrapListener},\n     features.map(feature => feature.\u0275providers),\n@@ -93,6 +94,28 @@ function routerFeature<FeatureKind extends RouterFeatureKind>(\n   return {\u0275kind: kind, \u0275providers: providers};\n }\n \n+\n+/**\n+ * An Injection token used to indicate whether `provideRouter` or `RouterModule.forRoot` was ever\n+ * called.\n+ */\n+export const ROUTER_IS_PROVIDED =\n+    new InjectionToken<boolean>('', {providedIn: 'root', factory: () => false});\n+\n+const routerIsProvidedDevModeCheck = {\n+  provide: ENVIRONMENT_INITIALIZER,\n+  multi: true,\n+  useFactory() {\n+    return () => {\n+      if (!inject(ROUTER_IS_PROVIDED)) {\n+        console.warn(\n+            '`provideRoutes` was called without `provideRouter` or `RouterModule.forRoot`. ' +\n+            'This is likely a mistake.');\n+      }\n+    };\n+  }\n+};\n+\n /**\n  * Registers a [DI provider](guide/glossary#provider) for a set of routes.\n  * @param routes The route configuration to provide.\n@@ -113,6 +136,7 @@ function routerFeature<FeatureKind extends RouterFeatureKind>(\n export function provideRoutes(routes: Routes): Provider[] {\n   return [\n     {provide: ROUTES, multi: true, useValue: routes},\n+    NG_DEV_MODE ? routerIsProvidedDevModeCheck : [],\n   ];\n }\n \n\n---\n file path A: packages/router/src/router_module.ts | file path B: packages/router/src/router_module.ts\n\n@@ -15,7 +15,7 @@ import {RouterLinkActive} from './directives/router_link_active';\n import {RouterOutlet} from './directives/router_outlet';\n import {RuntimeErrorCode} from './errors';\n import {Routes} from './models';\n-import {getBootstrapListener, rootRoute, withDebugTracing, withDisabledInitialNavigation, withEnabledBlockingInitialNavigation, withPreloading} from './provide_router';\n+import {getBootstrapListener, rootRoute, ROUTER_IS_PROVIDED, withDebugTracing, withDisabledInitialNavigation, withEnabledBlockingInitialNavigation, withPreloading} from './provide_router';\n import {Router, setupRouter} from './router';\n import {ExtraOptions, ROUTER_CONFIGURATION} from './router_config';\n import {RouterConfigLoader, ROUTES} from './router_config_loader';\n@@ -48,6 +48,9 @@ export const ROUTER_PROVIDERS: Provider[] = [\n   ChildrenOutletContexts,\n   {provide: ActivatedRoute, useFactory: rootRoute, deps: [Router]},\n   RouterConfigLoader,\n+  // Only used to warn when `provideRoutes` is used without `RouterModule` or `provideRouter`. Can\n+  // be removed when `provideRoutes` is removed.\n+  NG_DEV_MODE ? {provide: ROUTER_IS_PROVIDED, useValue: true} : [],\n ];\n \n export function routerNgProbeToken() {\n\n---\n file path A: packages/router/test/standalone.spec.ts | file path B: packages/router/test/standalone.spec.ts\n\n@@ -9,9 +9,8 @@\n import {Component, Injectable, NgModule} from '@angular/core';\n import {ComponentFixture, fakeAsync, TestBed, tick} from '@angular/core/testing';\n import {By} from '@angular/platform-browser';\n-import {NavigationEnd, Router, RouterModule} from '@angular/router';\n+import {provideRoutes, Router, RouterModule, ROUTES} from '@angular/router';\n import {RouterTestingModule} from '@angular/router/testing';\n-import {filter, first} from 'rxjs/operators';\n \n @Component({template: '<div>simple standalone</div>', standalone: true})\n export class SimpleStandaloneComponent {\n@@ -372,6 +371,16 @@ describe('standalone in Router API', () => {\n   });\n });\n \n+describe('provideRoutes', () => {\n+  it('warns if provideRoutes is used without provideRouter, RouterTestingModule, or RouterModule.forRoot',\n+     () => {\n+       spyOn(console, 'warn');\n+       TestBed.configureTestingModule({providers: [provideRoutes([])]});\n+       TestBed.inject(ROUTES);\n+       expect(console.warn).toHaveBeenCalled();\n+     });\n+});\n+\n function advance(fixture: ComponentFixture<unknown>) {\n   tick();\n   fixture.detectChanges();\n\n\n###\n\n", "completion": "refactor(router): Warn when provideRoutes is used without provideRouter (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/deprecations.md | file path B: aio/content/guide/deprecations.md\n\n@@ -84,6 +84,7 @@ v15 - v18\n | `@angular/router`                     | [`resolver` argument in `RouterOutletContract.activateWith`](#router)                                                                        | <!-- v14 --> v16         |\n | `@angular/router`                     | [`resolver` field of the `OutletContext` class](#router)                                                                        | <!-- v14 --> v16         |\n | `@angular/router`                     | [`RouterLinkWithHref` directive](#router)                                                                        | <!-- v15 --> v17         |\n+| `@angular/router`                     | [`provideRoutes` function](#router)                                                                        | <!-- v15 --> v17         |\n | `@angular/service-worker`           | [`SwUpdate#activated`](api/service-worker/SwUpdate#activated)                                              | <!-- v13 --> v16         |\n | `@angular/service-worker`           | [`SwUpdate#available`](api/service-worker/SwUpdate#available)                                              | <!-- v13 --> v16         |\n | template syntax                     | [`/deep/`, `>>>`, and `::ng-deep`](#deep-component-style-selector)                                         | <!--  v7 --> unspecified |\n@@ -167,6 +168,7 @@ In the [API reference section](api) of this site, deprecated APIs are indicated\n | [`resolver` argument in `RouterOutletContract.activateWith`](api/router/RouterOutletContract#activatewith) | No replacement needed | v14                   | Component factories are not required to create an instance of a component dynamically. Passing a factory resolver via `resolver` argument is no longer needed. |\n | [`resolver` field of the `OutletContext` class](api/router/OutletContext#resolver) | No replacement needed | v14                   | Component factories are not required to create an instance of a component dynamically. Passing a factory resolver via `resolver` class field is no longer needed. |\n | [`RouterLinkWithHref` directive](api/router/RouterLinkWithHref) | Use `RouterLink` instead. | v15                   | The `RouterLinkWithHref` directive code was merged into `RouterLink`. Now the `RouterLink` directive can be used for all elements that have `routerLink` attribute. |\n+| [`provideRoutes` function](api/router/provideRoutes) | Use `ROUTES` `InjectionToken` instead. | v15                   | The `provideRoutes` helper function is minimally useful and can be unintentionally used instead of `provideRoutes` due similar spelling. |\n \n \n <a id=\"platform-browser\"></a>\n\n---\n file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -526,7 +526,7 @@ export const PRIMARY_OUTLET = \"primary\";\n // @public\n export function provideRouter(routes: Routes, ...features: RouterFeatures[]): EnvironmentProviders;\n \n-// @public\n+// @public @deprecated\n export function provideRoutes(routes: Routes): Provider[];\n \n // @public\n\n---\n file path A: packages/router/src/provide_router.ts | file path B: packages/router/src/provide_router.ts\n\n@@ -60,7 +60,8 @@ const NG_DEV_MODE = typeof ngDevMode === 'undefined' || ngDevMode;\n  */\n export function provideRouter(routes: Routes, ...features: RouterFeatures[]): EnvironmentProviders {\n   return makeEnvironmentProviders([\n-    provideRoutes(routes), {provide: ActivatedRoute, useFactory: rootRoute, deps: [Router]},\n+    {provide: ROUTES, multi: true, useValue: routes},\n+    {provide: ActivatedRoute, useFactory: rootRoute, deps: [Router]},\n     {provide: APP_BOOTSTRAP_LISTENER, multi: true, useFactory: getBootstrapListener},\n     features.map(feature => feature.\u0275providers),\n     // TODO: All options used by the `assignExtraOptionsToRouter` factory need to be reviewed for\n@@ -105,6 +106,8 @@ function routerFeature<FeatureKind extends RouterFeatureKind>(\n  * class LazyLoadedChildModule {}\n  * ```\n  *\n+ * @deprecated If necessary, provide routes using the `ROUTES` `InjectionToken`.\n+ * @see `ROUTES`\n  * @publicApi\n  */\n export function provideRoutes(routes: Routes): Provider[] {\n\n---\n file path A: packages/router/src/router_module.ts | file path B: packages/router/src/router_module.ts\n\n@@ -15,10 +15,10 @@ import {RouterLinkActive} from './directives/router_link_active';\n import {RouterOutlet} from './directives/router_outlet';\n import {RuntimeErrorCode} from './errors';\n import {Routes} from './models';\n-import {getBootstrapListener, provideRoutes, rootRoute, withDebugTracing, withDisabledInitialNavigation, withEnabledBlockingInitialNavigation, withPreloading} from './provide_router';\n+import {getBootstrapListener, rootRoute, withDebugTracing, withDisabledInitialNavigation, withEnabledBlockingInitialNavigation, withPreloading} from './provide_router';\n import {Router, setupRouter} from './router';\n import {ExtraOptions, ROUTER_CONFIGURATION} from './router_config';\n-import {RouterConfigLoader} from './router_config_loader';\n+import {RouterConfigLoader, ROUTES} from './router_config_loader';\n import {ChildrenOutletContexts} from './router_outlet_context';\n import {ROUTER_SCROLLER, RouterScroller} from './router_scroller';\n import {ActivatedRoute} from './router_state';\n@@ -106,7 +106,7 @@ export class RouterModule {\n       providers: [\n         ROUTER_PROVIDERS,\n         NG_DEV_MODE ? (config?.enableTracing ? withDebugTracing().\u0275providers : []) : [],\n-        provideRoutes(routes),\n+        {provide: ROUTES, multi: true, useValue: routes},\n         {\n           provide: ROUTER_FORROOT_GUARD,\n           useFactory: provideForRootGuard,\n@@ -140,7 +140,10 @@ export class RouterModule {\n    *\n    */\n   static forChild(routes: Routes): ModuleWithProviders<RouterModule> {\n-    return {ngModule: RouterModule, providers: [provideRoutes(routes)]};\n+    return {\n+      ngModule: RouterModule,\n+      providers: [{provide: ROUTES, multi: true, useValue: routes}],\n+    };\n   }\n }\n \n\n---\n file path A: packages/router/test/router_preloader.spec.ts | file path B: packages/router/test/router_preloader.spec.ts\n\n@@ -9,7 +9,7 @@\n import {provideLocationMocks} from '@angular/common/testing';\n import {Compiler, Component, Injectable, InjectionToken, Injector, NgModule, NgModuleFactory, NgModuleRef, Type} from '@angular/core';\n import {fakeAsync, inject, TestBed, tick} from '@angular/core/testing';\n-import {PreloadAllModules, PreloadingStrategy, provideRoutes, RouterPreloader, withPreloading} from '@angular/router';\n+import {PreloadAllModules, PreloadingStrategy, RouterPreloader, ROUTES, withPreloading} from '@angular/router';\n import {BehaviorSubject, Observable, of, throwError} from 'rxjs';\n import {catchError, delay, filter, switchMap, take} from 'rxjs/operators';\n \n@@ -46,7 +46,13 @@ describe('RouterPreloader', () => {\n   describe('configurations with canLoad guard', () => {\n     @NgModule({\n       declarations: [LazyLoadedCmp],\n-      providers: [provideRoutes([{path: 'LoadedModule1', component: LazyLoadedCmp}])]\n+      providers: [\n+        {\n+          provide: ROUTES,\n+          multi: true,\n+          useValue: [{path: 'LoadedModule1', component: LazyLoadedCmp}]\n+        },\n+      ]\n     })\n     class LoadedModule {\n     }\n@@ -563,10 +569,14 @@ describe('RouterPreloader', () => {\n     beforeEach(() => {\n       TestBed.configureTestingModule({\n         providers: [\n-          provideRoutes([\n-            {path: 'lazy1', loadChildren: jasmine.createSpy('expected1')},\n-            {path: 'lazy2', loadChildren: () => LoadedModule}\n-          ]),\n+          {\n+            provide: ROUTES,\n+            multi: true,\n+            useValue: [\n+              {path: 'lazy1', loadChildren: jasmine.createSpy('expected1')},\n+              {path: 'lazy2', loadChildren: () => LoadedModule}\n+            ]\n+          },\n           {provide: PreloadingStrategy, useExisting: PreloadAllModules},\n         ]\n       });\n@@ -587,7 +597,10 @@ describe('RouterPreloader', () => {\n \n   describe('should copy loaded configs', () => {\n     const configs = [{path: 'LoadedModule1', component: LazyLoadedCmp}];\n-    @NgModule({declarations: [LazyLoadedCmp], providers: [provideRoutes(configs)]})\n+    @NgModule({\n+      declarations: [LazyLoadedCmp],\n+      providers: [{provide: ROUTES, multi: true, useValue: configs}]\n+    })\n     class LoadedModule {\n     }\n \n@@ -621,7 +634,11 @@ describe('RouterPreloader', () => {\n       'should work with lazy loaded modules that don\\'t provide RouterModule.forChild()', () => {\n         @NgModule({\n           declarations: [LazyLoadedCmp],\n-          providers: [provideRoutes([{path: 'LoadedModule1', component: LazyLoadedCmp}])]\n+          providers: [{\n+            provide: ROUTES,\n+            multi: true,\n+            useValue: [{path: 'LoadedModule1', component: LazyLoadedCmp}]\n+          }]\n         })\n         class LoadedModule {\n         }\n\n---\n file path A: packages/router/testing/src/router_testing_module.ts | file path B: packages/router/testing/src/router_testing_module.ts\n\n@@ -9,7 +9,7 @@\n import {Location} from '@angular/common';\n import {provideLocationMocks} from '@angular/common/testing';\n import {Compiler, Injector, ModuleWithProviders, NgModule, Optional} from '@angular/core';\n-import {ChildrenOutletContexts, ExtraOptions, NoPreloading, provideRoutes, Route, Router, ROUTER_CONFIGURATION, RouteReuseStrategy, RouterModule, ROUTES, Routes, TitleStrategy, UrlHandlingStrategy, UrlSerializer, \u0275assignExtraOptionsToRouter as assignExtraOptionsToRouter, \u0275flatten as flatten, \u0275ROUTER_PROVIDERS as ROUTER_PROVIDERS, \u0275withPreloading as withPreloading} from '@angular/router';\n+import {ChildrenOutletContexts, ExtraOptions, NoPreloading, Route, Router, ROUTER_CONFIGURATION, RouteReuseStrategy, RouterModule, ROUTES, Routes, TitleStrategy, UrlHandlingStrategy, UrlSerializer, \u0275assignExtraOptionsToRouter as assignExtraOptionsToRouter, \u0275flatten as flatten, \u0275ROUTER_PROVIDERS as ROUTER_PROVIDERS, \u0275withPreloading as withPreloading} from '@angular/router';\n \n import {EXTRA_ROUTER_TESTING_PROVIDERS} from './extra_router_testing_providers';\n \n@@ -124,7 +124,7 @@ export function setupTestingRouter(\n       ]\n     },\n     withPreloading(NoPreloading).\u0275providers,\n-    provideRoutes([]),\n+    {provide: ROUTES, multi: true, useValue: []},\n   ]\n })\n export class RouterTestingModule {\n@@ -133,7 +133,7 @@ export class RouterTestingModule {\n     return {\n       ngModule: RouterTestingModule,\n       providers: [\n-        provideRoutes(routes),\n+        {provide: ROUTES, multi: true, useValue: routes},\n         {provide: ROUTER_CONFIGURATION, useValue: config ? config : {}},\n       ]\n     };\n\n\n###\n\n", "completion": "docs(router): deprecate `provideRoutes` function (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/assistant-to-the-branch-manager | file path B: .github/workflows/assistant-to-the-branch-manager.yml\n\n\n\n###\n\n", "completion": "build: fix file extension for github action (#<issue-num>)"}
{"prompt": " file path A: None | file path B: .github/workflows/assistant-to-the-branch-manager\n\n@@ -0,0 +1,22 @@\n+name: DevInfra\n+\n+on:\n+  push:\n+  pull_request_target:\n+    types: [opened, synchronize, reopened, ready_for_review]\n+\n+# Declare default permissions as read only.\n+permissions:\n+  contents: read\n+\n+jobs:\n+  assistant_to_the_branch_manager:\n+    if: github.action == 'pull_request_target' or github.action == 'push'\n+    runs-on: ubuntu-latest\n+    steps:\n+      - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3.0.2\n+        with:\n+          persist-credentials: false\n+      - uses: angular/dev-infra/github-actions/branch-manager@aa4dcc8fa853e6b5f3345e6f1bac5255c7d7a871\n+        with:\n+          angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n---\n file path A: .github/workflows/dev-infra.yml | file path B: .github/workflows/dev-infra.yml\n\n@@ -13,13 +13,13 @@ jobs:\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n-      - uses: angular/dev-infra/github-actions/commit-message-based-labels@d87b1b56a970132f90301624cea6b6d70b6d9489\n+      - uses: angular/dev-infra/github-actions/commit-message-based-labels@aa4dcc8fa853e6b5f3345e6f1bac5255c7d7a871\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n   post_approval_changes:\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n-      - uses: angular/dev-infra/github-actions/post-approval-changes@d87b1b56a970132f90301624cea6b6d70b6d9489\n+      - uses: angular/dev-infra/github-actions/post-approval-changes@aa4dcc8fa853e6b5f3345e6f1bac5255c7d7a871\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n\n###\n\n", "completion": "build: enable the branch manager action in the repo (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/http/index.md | file path B: goldens/public-api/common/http/index.md\n\n@@ -2169,10 +2169,10 @@ export function provideHttpClient(...features: HttpFeature<HttpFeatureKind>[]):\n export function withInterceptors(interceptorFns: HttpInterceptorFn[]): HttpFeature<HttpFeatureKind.Interceptors>;\n \n // @public\n-export function withJsonpSupport(): HttpFeature<HttpFeatureKind.JsonpSupport>;\n+export function withInterceptorsFromDi(): HttpFeature<HttpFeatureKind.LegacyInterceptors>;\n \n // @public\n-export function withLegacyInterceptors(): HttpFeature<HttpFeatureKind.LegacyInterceptors>;\n+export function withJsonpSupport(): HttpFeature<HttpFeatureKind.JsonpSupport>;\n \n // @public\n export function withNoXsrfProtection(): HttpFeature<HttpFeatureKind.NoXsrfProtection>;\n\n---\n file path A: packages/common/http/public_api.ts | file path B: packages/common/http/public_api.ts\n\n@@ -35,7 +35,7 @@ export {HTTP_INTERCEPTORS, HttpInterceptor, HttpInterceptorHandler as \u0275HttpInte\n export {JsonpClientBackend, JsonpInterceptor} from './src/jsonp';\n export {HttpClientJsonpModule, HttpClientModule, HttpClientXsrfModule} from './src/module';\n export {HttpParameterCodec, HttpParams, HttpParamsOptions, HttpUrlEncodingCodec} from './src/params';\n-export {HttpFeature, HttpFeatureKind, provideHttpClient, withJsonpSupport, withLegacyInterceptors, withNoXsrfProtection, withXsrfConfiguration, withInterceptors, withRequestsMadeViaParent} from './src/provider';\n+export {HttpFeature, HttpFeatureKind, provideHttpClient, withJsonpSupport, withNoXsrfProtection, withXsrfConfiguration, withInterceptors, withInterceptorsFromDi, withRequestsMadeViaParent} from './src/provider';\n export {HttpRequest} from './src/request';\n export {HttpDownloadProgressEvent, HttpErrorResponse, HttpEvent, HttpEventType, HttpHeaderResponse, HttpProgressEvent, HttpResponse, HttpResponseBase, HttpSentEvent, HttpStatusCode, HttpUploadProgressEvent, HttpUserEvent} from './src/response';\n export {HttpXhrBackend} from './src/xhr';\n\n---\n file path A: packages/common/http/src/module.ts | file path B: packages/common/http/src/module.ts\n\n@@ -9,7 +9,7 @@\n import {ModuleWithProviders, NgModule} from '@angular/core';\n \n import {HTTP_INTERCEPTORS} from './interceptor';\n-import {provideHttpClient, withJsonpSupport, withLegacyInterceptors, withNoXsrfProtection, withXsrfConfiguration} from './provider';\n+import {provideHttpClient, withInterceptorsFromDi, withJsonpSupport, withNoXsrfProtection, withXsrfConfiguration} from './provider';\n import {HttpXsrfCookieExtractor, HttpXsrfInterceptor, HttpXsrfTokenExtractor, XSRF_DEFAULT_COOKIE_NAME, XSRF_DEFAULT_HEADER_NAME, XSRF_ENABLED} from './xsrf';\n \n /**\n@@ -84,7 +84,7 @@ export class HttpClientXsrfModule {\n    */\n   providers: [\n     provideHttpClient(\n-        withLegacyInterceptors(),\n+        withInterceptorsFromDi(),\n         withXsrfConfiguration({\n           cookieName: XSRF_DEFAULT_COOKIE_NAME,\n           headerName: XSRF_DEFAULT_HEADER_NAME,\n\n---\n file path A: packages/common/http/src/provider.ts | file path B: packages/common/http/src/provider.ts\n\n@@ -56,7 +56,7 @@ function makeHttpFeature<KindT extends HttpFeatureKind>(\n  * `withInterceptors(...)` feature.\n  *\n  * @see withInterceptors\n- * @see withLegacyInterceptors\n+ * @see withInterceptorsFromDi\n  * @see withXsrfConfiguration\n  * @see withNoXsrfProtection\n  * @see withJsonpSupport\n@@ -129,7 +129,7 @@ const LEGACY_INTERCEPTOR_FN = new InjectionToken<HttpInterceptorFn>('LEGACY_INTE\n  * @see HTTP_INTERCEPTORS\n  * @see provideHttpClient\n  */\n-export function withLegacyInterceptors(): HttpFeature<HttpFeatureKind.LegacyInterceptors> {\n+export function withInterceptorsFromDi(): HttpFeature<HttpFeatureKind.LegacyInterceptors> {\n   // Note: the legacy interceptor function is provided here via an intermediate token\n   // (`LEGACY_INTERCEPTOR_FN`), using a pattern which guarantees that if these providers are\n   // included multiple times, all of the multi-provider entries will have the same instance of the\n\n---\n file path A: packages/common/http/test/provider_spec.ts | file path B: packages/common/http/test/provider_spec.ts\n\n@@ -14,7 +14,7 @@ import {TestBed} from '@angular/core/testing';\n import {EMPTY, Observable} from 'rxjs';\n \n import {HttpInterceptorFn} from '../src/interceptor';\n-import {provideHttpClient, withInterceptors, withJsonpSupport, withLegacyInterceptors, withNoXsrfProtection, withRequestsMadeViaParent, withXsrfConfiguration} from '../src/provider';\n+import {provideHttpClient, withInterceptors, withInterceptorsFromDi, withJsonpSupport, withNoXsrfProtection, withRequestsMadeViaParent, withXsrfConfiguration} from '../src/provider';\n \n describe('provideHttp', () => {\n   beforeEach(() => {\n@@ -62,10 +62,10 @@ describe('provideHttp', () => {\n     req.flush('');\n   });\n \n-  it('withLegacyInterceptors() should enable legacy interceptors', () => {\n+  it('withInterceptorsFromDi() should enable legacy interceptors', () => {\n     TestBed.configureTestingModule({\n       providers: [\n-        provideHttpClient(withLegacyInterceptors()),\n+        provideHttpClient(withInterceptorsFromDi()),\n         provideLegacyInterceptor('alpha'),\n         provideLegacyInterceptor('beta'),\n         provideHttpClientTesting(),\n@@ -144,7 +144,7 @@ describe('provideHttp', () => {\n               withInterceptors([\n                 makeLiteralTagInterceptorFn('functional'),\n               ]),\n-              withLegacyInterceptors(),\n+              withInterceptorsFromDi(),\n               ),\n           provideHttpClientTesting(),\n           provideLegacyInterceptor('legacy'),\n@@ -161,7 +161,7 @@ describe('provideHttp', () => {\n       TestBed.configureTestingModule({\n         providers: [\n           provideHttpClient(\n-              withLegacyInterceptors(),\n+              withInterceptorsFromDi(),\n               withInterceptors([\n                 makeLiteralTagInterceptorFn('functional'),\n               ]),\n\n\n###\n\n", "completion": "fix(http): rename `withLegacyInterceptors` to `withInterceptorsFromDi` (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/http/index.md | file path B: goldens/public-api/common/http/index.md\n\n@@ -1728,7 +1728,7 @@ export enum HttpEventType {\n     User = 5\n }\n \n-// @public (undocumented)\n+// @public\n export interface HttpFeature<KindT extends HttpFeatureKind> {\n     // (undocumented)\n     \u0275kind: KindT;\n@@ -1736,7 +1736,7 @@ export interface HttpFeature<KindT extends HttpFeatureKind> {\n     \u0275providers: Provider[];\n }\n \n-// @public (undocumented)\n+// @public\n export enum HttpFeatureKind {\n     // (undocumented)\n     CustomXsrfConfiguration = 2,\n@@ -2162,25 +2162,25 @@ export class JsonpInterceptor {\n     static \u0275prov: i0.\u0275\u0275InjectableDeclaration<JsonpInterceptor>;\n }\n \n-// @public (undocumented)\n+// @public\n export function provideHttpClient(...features: HttpFeature<HttpFeatureKind>[]): EnvironmentProviders;\n \n-// @public (undocumented)\n+// @public\n export function withInterceptors(interceptorFns: HttpInterceptorFn[]): HttpFeature<HttpFeatureKind.Interceptors>;\n \n-// @public (undocumented)\n+// @public\n export function withJsonpSupport(): HttpFeature<HttpFeatureKind.JsonpSupport>;\n \n-// @public (undocumented)\n+// @public\n export function withLegacyInterceptors(): HttpFeature<HttpFeatureKind.LegacyInterceptors>;\n \n-// @public (undocumented)\n+// @public\n export function withNoXsrfProtection(): HttpFeature<HttpFeatureKind.NoXsrfProtection>;\n \n-// @public (undocumented)\n+// @public\n export function withRequestsMadeViaParent(): HttpFeature<HttpFeatureKind.RequestsMadeViaParent>;\n \n-// @public (undocumented)\n+// @public\n export function withXsrfConfiguration({ cookieName, headerName }: {\n     cookieName?: string;\n     headerName?: string;\n\n---\n file path A: packages/common/http/src/interceptor.ts | file path B: packages/common/http/src/interceptor.ts\n\n@@ -66,6 +66,10 @@ export interface HttpInterceptor {\n  * This function should only be called within the scope of the request that's currently being\n  * intercepted. Once that request is complete, this downstream handler function should not be\n  * called.\n+ *\n+ * @publicApi\n+ *\n+ * @see [HTTP Guide](guide/http#intercepting-requests-and-responses)\n  */\n export type HttpHandlerFn = (req: HttpRequest<unknown>) => Observable<HttpEvent<unknown>>;\n \n\n---\n file path A: packages/common/http/src/provider.ts | file path B: packages/common/http/src/provider.ts\n\n@@ -15,6 +15,11 @@ import {jsonpCallbackContext, JsonpCallbackContext, JsonpClientBackend, jsonpInt\n import {HttpXhrBackend} from './xhr';\n import {HttpXsrfCookieExtractor, HttpXsrfTokenExtractor, XSRF_COOKIE_NAME, XSRF_ENABLED, XSRF_HEADER_NAME, xsrfInterceptorFn} from './xsrf';\n \n+/**\n+ * Identifies a particular kind of `HttpFeature`.\n+ *\n+ * @publicApi\n+ */\n export enum HttpFeatureKind {\n   Interceptors,\n   LegacyInterceptors,\n@@ -24,6 +29,11 @@ export enum HttpFeatureKind {\n   RequestsMadeViaParent,\n }\n \n+/**\n+ * A feature for use when configuring `provideHttpClient`.\n+ *\n+ * @publicApi\n+ */\n export interface HttpFeature<KindT extends HttpFeatureKind> {\n   \u0275kind: KindT;\n   \u0275providers: Provider[];\n@@ -37,7 +47,21 @@ function makeHttpFeature<KindT extends HttpFeatureKind>(\n   };\n }\n \n-\n+/**\n+ * Configures Angular's `HttpClient` service to be available for injection.\n+ *\n+ * By default, `HttpClient` will be configured for injection with its default options for XSRF\n+ * protection of outgoing requests. Additional configuration options can be provided by passing\n+ * feature functions to `provideHttpClient`. For example, HTTP interceptors can be added using the\n+ * `withInterceptors(...)` feature.\n+ *\n+ * @see withInterceptors\n+ * @see withLegacyInterceptors\n+ * @see withXsrfConfiguration\n+ * @see withNoXsrfProtection\n+ * @see withJsonpSupport\n+ * @see withRequestsMadeViaParent\n+ */\n export function provideHttpClient(...features: HttpFeature<HttpFeatureKind>[]):\n     EnvironmentProviders {\n   if (ngDevMode) {\n@@ -73,6 +97,14 @@ export function provideHttpClient(...features: HttpFeature<HttpFeatureKind>[]):\n   return makeEnvironmentProviders(providers);\n }\n \n+/**\n+ * Adds one or more functional-style HTTP interceptors to the configuration of the `HttpClient`\n+ * instance.\n+ *\n+ * @see HttpInterceptorFn\n+ * @see provideHttpClient\n+ * @publicApi\n+ */\n export function withInterceptors(interceptorFns: HttpInterceptorFn[]):\n     HttpFeature<HttpFeatureKind.Interceptors> {\n   return makeHttpFeature(HttpFeatureKind.Interceptors, interceptorFns.map(interceptorFn => {\n@@ -86,6 +118,17 @@ export function withInterceptors(interceptorFns: HttpInterceptorFn[]):\n \n const LEGACY_INTERCEPTOR_FN = new InjectionToken<HttpInterceptorFn>('LEGACY_INTERCEPTOR_FN');\n \n+/**\n+ * Includes class-based interceptors configured using a multi-provider in the current injector into\n+ * the configured `HttpClient` instance.\n+ *\n+ * Prefer `withInterceptors` and functional interceptors instead, as support for DI-provided\n+ * interceptors may be phased out in a later release.\n+ *\n+ * @see HttpInterceptor\n+ * @see HTTP_INTERCEPTORS\n+ * @see provideHttpClient\n+ */\n export function withLegacyInterceptors(): HttpFeature<HttpFeatureKind.LegacyInterceptors> {\n   // Note: the legacy interceptor function is provided here via an intermediate token\n   // (`LEGACY_INTERCEPTOR_FN`), using a pattern which guarantees that if these providers are\n@@ -105,6 +148,13 @@ export function withLegacyInterceptors(): HttpFeature<HttpFeatureKind.LegacyInte\n   ]);\n }\n \n+/**\n+ * Customizes the XSRF protection for the configuration of the current `HttpClient` instance.\n+ *\n+ * This feature is incompatible with the `withNoXsrfProtection` feature.\n+ *\n+ * @see provideHttpClient\n+ */\n export function withXsrfConfiguration(\n     {cookieName, headerName}: {cookieName?: string, headerName?: string}):\n     HttpFeature<HttpFeatureKind.CustomXsrfConfiguration> {\n@@ -119,6 +169,13 @@ export function withXsrfConfiguration(\n   return makeHttpFeature(HttpFeatureKind.CustomXsrfConfiguration, providers);\n }\n \n+/**\n+ * Disables XSRF protection in the configuration of the current `HttpClient` instance.\n+ *\n+ * This feature is incompatible with the `withXsrfConfiguration` feature.\n+ *\n+ * @see provideHttpClient\n+ */\n export function withNoXsrfProtection(): HttpFeature<HttpFeatureKind.NoXsrfProtection> {\n   return makeHttpFeature(HttpFeatureKind.NoXsrfProtection, [\n     {\n@@ -128,6 +185,11 @@ export function withNoXsrfProtection(): HttpFeature<HttpFeatureKind.NoXsrfProtec\n   ]);\n }\n \n+/**\n+ * Add JSONP support to the configuration of the current `HttpClient` instance.\n+ *\n+ * @see provideHttpClient\n+ */\n export function withJsonpSupport(): HttpFeature<HttpFeatureKind.JsonpSupport> {\n   return makeHttpFeature(HttpFeatureKind.JsonpSupport, [\n     JsonpClientBackend,\n@@ -137,6 +199,23 @@ export function withJsonpSupport(): HttpFeature<HttpFeatureKind.JsonpSupport> {\n }\n \n /**\n+ * Configures the current `HttpClient` instance to make requests via the parent injector's\n+ * `HttpClient` instead of directly.\n+ *\n+ * By default, `provideHttpClient` configures `HttpClient` in its injector to be an independent\n+ * instance. For example, even if `HttpClient` is configured in the parent injector with\n+ * one or more interceptors, they will not intercept requests made via this instance.\n+ *\n+ * With this option enabled, once the request has passed through the current injector's\n+ * interceptors, it will be delegated to the parent injector's `HttpClient` chain instead of\n+ * dispatched directly, and interceptors in the parent configuration will be applied to the request.\n+ *\n+ * If there are several `HttpClient` instances in the injector hierarchy, it's possible for\n+ * `withRequestsMadeViaParent` to be used at multiple levels, which will cause the request to\n+ * \"bubble up\" until either reaching the root level or an `HttpClient` which was not configured with\n+ * this option.\n+ *\n+ * @see provideHttpClient\n  * @developerPreview\n  */\n export function withRequestsMadeViaParent(): HttpFeature<HttpFeatureKind.RequestsMadeViaParent> {\n\n\n###\n\n", "completion": "docs(http): add public API tags and jsdoc for `provideHttpClient` (#<issue-num>)"}
{"prompt": " file path A: scripts/ci/run_angular_components_unit_tests.sh | file path B: scripts/ci/run_angular_components_unit_tests.sh\n\n@@ -23,4 +23,5 @@ bazel test \\\n   --build_tag_filters=-docs-package,-e2e,-browser:firefox \\\n   --test_tag_filters=-e2e,-browser:firefox \\\n   --build_tests_only \\\n+  --keep_going \\\n   -- src/...\n\n\n###\n\n", "completion": "build: add `--keep_going` to components tests. (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/testing.md | file path B: aio/content/guide/testing.md\n\n@@ -1,5 +1,7 @@\n <a id=\"top\"></a>\n \n+{@searchKeywords test testing karma jasmine coverage}\n+\n # Testing\n \n Testing your Angular application helps you check that your application is working as you expect.\n\n\n###\n\n", "completion": "docs: add searchKeywords in testing guide (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/change-detection-skipping-subtrees.md | file path B: aio/content/guide/change-detection-skipping-subtrees.md\n\n@@ -7,11 +7,11 @@ Change detection is sufficiently fast for most applications. However, when an ap\n If you are confident that a part of the application is not affected by a state change, you can use [OnPush](https://angular.io/api/core/ChangeDetectionStrategy) to skip change detection in an entire component subtree.\n \n \n-## Using OnPush\n+## Using `OnPush`\n \n OnPush change detection instructs Angular to run change detection for a component subtree **only** when:\n * The root component of the subtree receives new inputs as the result of a template binding. Angular compares the current and past value of the input with `==`\n-* Angular handles an event _(e.g. using event binding, output binding, or `@HostListener`)_ in the subtree's root component or any of its children whether they are using OnPush change detection or not.\n+* Angular handles an event _(for example using event binding, output binding, or `@HostListener` )_ in the subtree's root component or any of its children whether they are using OnPush change detection or not.\n \n You can set the change detection strategy of a component to `OnPush` in the `@Component` decorator:\n \n@@ -25,7 +25,7 @@ export class MyComponent {}\n \n ## Common change detection scenarios\n \n-This section examines several common change detection scenarios to illustrate Angular's behavior. \n+This section examines several common change detection scenarios to illustrate Angular's behavior.\n \n ## An event is handled by a component with default change detection\n \n\n---\n file path A: aio/content/guide/change-detection-slow-computations.md | file path B: aio/content/guide/change-detection-slow-computations.md\n\n@@ -4,27 +4,27 @@ On every change detection cycle, Angular synchronously:\n \n * Evaluates all template expressions in all components, unless specified otherwise, based on that each component's detection strategy\n * Executes the `ngDoCheck`, `ngAfterContentChecked`, `ngAfterViewChecked`, and `ngOnChanges` lifecycle hooks.\n-A single slow computation within a template or a lifecycle hook can slow down the entire change detection process because Angular runs the computations sequentially. \n+A single slow computation within a template or a lifecycle hook can slow down the entire change detection process because Angular runs the computations sequentially.\n \n ## Identifying slow computations\n \n-You can identify heavy computations with Angular DevTools\u2019 profiler. In the performance timeline, click on a bar to preview a particular change detection cycle. This displays a bar chart, which shows how long the framework spent in change detection for each component. When you click on a component, you can preview how long Angular spent  evaluating its template and lifecycle hooks.\n+You can identify heavy computations with Angular DevTools\u2019 profiler. In the performance timeline, click a bar to preview a particular change detection cycle. This displays a bar chart, which shows how long the framework spent in change detection for each component. When you click a component, you can preview how long Angular spent  evaluating its template and lifecycle hooks.\n \n <div class=\"lightbox\">\n   <img alt=\"Angular DevTools profiler preview showing slow computation\" src=\"generated/images/guide/change-detection/slow-computations.png\">\n </div>\n \n-For example, in the screenshot above, we selected the second change detection cycle after the profiler started where Angular spent over 573 ms. Angular spent most time in the `EmployeeListComponent`. In the details panel, we can see that we spent over 297ms in evaluating the template of the `EmployeeListComponent`.\n+For example, in the preceding screenshot, the second recorded change detection cycle is selected. Angular spent over 573 ms on this cycle, with the most time spent in the `EmployeeListComponent`. In the details panel, you can see that Angular spent over 297 ms evaluating the template of the `EmployeeListComponent`.\n \n \n ## Optimizing slow computations\n \n-There are several techniques to eliminate slow computations:\n+Here are several techniques to remove slow computations:\n \n-* **Optimizing the underlying algorithm**. This is the recommended approach; if you can speed up the algorithm that is causing the problem, you can speed up the entire change detection mechanism.\n-* **Caching using pure pipes**. You can move the heavy computation to a pure [pipe](https://angular.io/guide/pipes). Angular will reevaluate a pure pipe only if it detects that its inputs changed, compared to the previous time Angular called it.\n+* **Optimizing the underlying algorithm**. This is the recommended approach. If you can speed up the algorithm that is causing the problem, you can speed up the entire change detection mechanism.\n+* **Caching using pure pipes**. You can move the heavy computation to a pure [pipe](https://angular.io/guide/pipes). Angular reevaluates a pure pipe only if it detects that its inputs have changed, compared to the previous time Angular called it.\n * **Using memoization**. [Memoization](https://en.wikipedia.org/wiki/Memoization) is a similar technique to pure pipes, with the difference that pure pipes preserve only the last result from the computation where memoization could store multiple results.\n-* **Avoid repaints/reflows in lifecycle hooks**. Certain [operations](https://web.dev/avoid-large-complex-layouts-and-layout-thrashing/) cause the browser to either synchronously recalculate the layout of the page or re-render it. Since reflows and repaints are generally slow, we want to avoid performing them in every change detection cycle.\n+* **Avoid repaints/reflows in lifecycle hooks**. Certain [operations](https://web.dev/avoid-large-complex-layouts-and-layout-thrashing/) cause the browser to either synchronously recalculate the layout of the page or re-render it. Since reflows and repaints are generally slow, you want to avoid performing them in every change detection cycle.\n \n Pure pipes and memoization have different trade-offs. Pure pipes are an Angular built-in concept compared to memoization, which is a general software engineering practice for caching function results. The memory overhead of memoization could be significant if you invoke the heavy computation frequently with different arguments.\n \n\n---\n file path A: aio/content/guide/change-detection-zone-pollution.md | file path B: aio/content/guide/change-detection-zone-pollution.md\n\n@@ -1,8 +1,8 @@\n-# Resolving Zone Pollution\n+# Resolving zone pollution\n \n **Zone.js** is a signaling mechanism that Angular uses to detect when an application state might have changed. It captures asynchronous operations like `setTimeout`, network requests, and event listeners. Angular schedules change detection based on signals from Zone.js\n \n-There are cases in which scheduled [tasks](https://developer.mozilla.org/en-US/docs/Web/API/HTML_DOM_API/Microtask_guide#tasks) or [microtasks](https://developer.mozilla.org/en-US/docs/Web/API/HTML_DOM_API/Microtask_guide#microtasks) don\u2019t make any changes in the data model, which makes running change detection unnecessary. Common examples are:\n+In some cases scheduled [tasks](https://developer.mozilla.org/en-US/docs/Web/API/HTML_DOM_API/Microtask_guide#tasks) or [microtasks](https://developer.mozilla.org/en-US/docs/Web/API/HTML_DOM_API/Microtask_guide#microtasks) don\u2019t make any changes in the data model, which makes running change detection unnecessary. Common examples are:\n * `requestAnimationFrame`, `setTimeout` or `setInterval`\n * Task or microtask scheduling by third-party libraries\n \n@@ -19,9 +19,9 @@ You can detect unnecessary change detection calls using Angular DevTools. Often\n In the image above, there is a series of change detection calls triggered by event handlers associated with an element. That\u2019s a common challenge when using third-party, non-native Angular components, which do not alter the default behavior of `NgZone`.\n \n \n-## Run tasks outside NgZone\n+## Run tasks outside `NgZone`\n \n-In such cases, we can instruct Angular to avoid calling change detection for tasks scheduled by a given piece of code using  [NgZone](https://angular.io/guide/zone).\n+In such cases, you can instruct Angular to avoid calling change detection for tasks scheduled by a given piece of code using [NgZone](https://angular.io/guide/zone).\n \n ```ts\n import { Component, NgZone, OnInit } from '@angular/core';\n@@ -34,7 +34,7 @@ class AppComponent implements OnInit {\n }\n ```\n \n-The snippet above instructs Angular that it should execute the `setInterval` call outside the Angular Zone and skip running change detection after `pollForUpdates` runs.\n+The preceding snippet instructs Angular to call `setInterval` outside the Angular Zone and skip running change detection after `pollForUpdates` runs.\n \n Third-party libraries commonly trigger unnecessary change detection cycles because they weren't authored with Zone.js in mind. Avoid these extra cycles by calling library APIs outside the Angular zone:\n \n@@ -53,8 +53,8 @@ class AppComponent implements OnInit {\n }\n ```\n \n-Running `Plotly.newPlot('chart', data);` within `runOutsideAngular` instructs the framework that it shouldn\u2019t execute change detection after the execution of tasks scheduled by the initialization logic.\n+Running `Plotly.newPlot('chart', data);` within `runOutsideAngular` instructs the framework that it shouldn\u2019t run change detection after the execution of tasks scheduled by the initialization logic.\n \n-For example, if `Plotly.newPlot('chart', data)` adds event listeners to a DOM element, Angular will not execute change detection after the execution of their handlers.\n+For example, if `Plotly.newPlot('chart', data)` adds event listeners to a DOM element, Angular does not run change detection after the execution of their handlers.\n \n @reviewed 2022-05-04\n\n---\n file path A: aio/content/guide/developer-guide-overview.md | file path B: aio/content/guide/developer-guide-overview.md\n\n@@ -1,4 +1,4 @@\n-# Angular Developer Guides\n+# Angular developer guides\n \n As an application framework, Angular includes a collection of well-integrated libraries that cover a wide variety of features.\n \n\n\n###\n\n", "completion": "docs: fix lint errors for change detection guides (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/testing.md | file path B: aio/content/guide/testing.md\n\n@@ -197,202 +197,17 @@ next to their corresponding helper files.\n \n <a id=\"ci\"></a>\n \n-## Set up continuous integration\n+## Testing in continuous integration\n \n One of the best ways to keep your project bug-free is through a test suite, but you might forget to run tests all the time.\n-Continuous integration \\(CI\\) servers let you set up your project repository so that your tests run on every commit and pull request.\n-\n-There are paid CI services like Circle CI and Travis CI, and you can also host your own for free using Jenkins and others.\n-Although Circle CI and Travis CI are paid services, they are provided free for open source projects.\n-You can create a public project on GitHub and add these services without paying.\n-Contributions to the Angular repository are automatically run through a whole suite of Circle CI tests.\n-\n-This article explains how to configure your project to run Circle CI and Travis CI, and also update your test configuration to be able to run tests in the Chrome browser in either environment.\n-\n-### Configure project for Circle CI\n-\n-1.  Create a folder called `.circleci` at the project root.\n-1.  In the new folder, create a file called `config.yml` with the following content:\n-\n-    <code-example format=\"yaml\" language=\"yaml\">\n-\n-    version: 2\n-    jobs:\n-      build:\n-        working_directory: ~/my-project\n-        docker:\n-          &hyphen; image: cimg/node:18.12.0-browsers\n-        steps:\n-          &hyphen; checkout\n-          &hyphen; restore_cache:\n-              key: my-project-{{ checksum \"package-lock.json\"}}\n-          &hyphen; run: npm ci\n-          &hyphen; save_cache:\n-              key: my-project-{{ checksum \"package-lock.json\" }}\n-              paths:\n-                &hyphen; $HOME/.npm\n-          &hyphen; run: npm run test -- --no-watch --no-progress --browsers=ChromeHeadlessCI\n-\n-    </code-example>\n-\n-    This configuration caches `node_modules/` and uses [`npm run`](https://docs.npmjs.com/cli/run-script) to run CLI commands, because `@angular/cli` is not installed globally.\n-    The double hyphen \\(`--`\\) characters is needed to pass arguments into the `npm` script.\n-\n-1.  Commit your changes and push them to your repository.\n-1.  [Sign up for Circle CI](https://circleci.com/docs/2.0/first-steps) and [add your project](https://circleci.com/add-projects).\n-    Your project should start building.\n-\n-    *   Learn more about Circle CI from [Circle CI documentation](https://circleci.com/docs/2.0).\n-\n-### Configure project for Travis CI\n-\n-1.  Create a file called `.travis.yml` at the project root, with the following content:\n-\n-    <code-example format=\"yaml\" language=\"yaml\">\n-\n-    language: node_js\n-    node_js:\n-      &hyphen; \"18\"\n-\n-    addons:\n-      chrome: stable\n-\n-    cache:\n-      directories:\n-         &hyphen; ./node_modules\n-\n-    install:\n-      &hyphen; npm install\n-\n-    script:\n-      &hyphen; npm run test -- --no-watch --no-progress --browsers=ChromeHeadlessCI\n-\n-    </code-example>\n-\n-    This does the same things as the CircleCI configuration, except that Travis doesn't come with Chrome, so use Chromium instead.\n-\n-1.  Commit your changes and push them to your repository.\n-1.  [Sign up for Travis CI](https://travis-ci.org/auth) and [add your project](https://travis-ci.org/profile).\n-    You'll need to push a new commit to trigger a build.\n-\n-    *   Learn more about Travis CI testing from [Travis CI documentation](https://docs.travis-ci.com).\n-\n-### Configure project for GitLab CI\n-\n-1.  Create a file called `.gitlab-ci.yml` at the project root, with the following content:\n-\n-    <code-example format=\"yaml\" language=\"yaml\">\n-\n-    image: node:18.12-stretch\n-    variables:\n-      FF_USE_FASTZIP: \"true\"\n-\n-    cache:\n-      untracked: true\n-      policy: push\n-      key: &dollar;{CI_COMMIT_SHORT_SHA}\n-      paths:\n-        &hyphen; node_modules/\n-\n-    .pull_cached_node_modules:\n-      cache:\n-        untracked: true\n-        key: &dollar;{CI_COMMIT_SHORT_SHA}\n-        policy: pull\n-\n-    stages:\n-      &hyphen; setup\n-      &hyphen; test\n \n-    install:\n-      stage: setup\n-      script:\n-        &hyphen; npm ci\n-\n-    test:\n-      stage: test\n-      extends: .pull_cached_node_modules\n-      before_script:\n-        &hyphen; apt-get update\n-        &hyphen; wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb\n-        &hyphen; apt install -y ./google-chrome*.deb;\n-        &hyphen; export CHROME_BIN=/usr/bin/google-chrome\n-      script:\n-        &hyphen; npm run test -- --no-watch --no-progress --browsers=ChromeHeadlessCI\n-\n-    </code-example>\n-\n-    This configuration caches `node_modules/` in the `install` job and re-uses the cached `node_modules/` in the `test` job.\n-\n-1.  [Sign up for GitLab CI](https://gitlab.com/users/sign_in) and [add your project](https://gitlab.com/projects/new).\n-    You'll need to push a new commit to trigger a build.\n-\n-1.  Commit your changes and push them to your repository.\n-    *   Learn more about GitLab CI testing from [GitLab CI/CD documentation](https://docs.gitlab.com/ee/ci).\n-\n-### Configure project for GitHub Actions\n-\n-1.  Create a folder called `.github/workflows` at root of your project.\n-1.  In the new folder, create a file called `main.yml` with the following content:\n-\n-    <code-example format=\"yaml\" language=\"yaml\">\n-\n-    name: CI Angular app through GitHub Actions\n-    on: push\n-    jobs:\n-      build:\n-        runs-on: ubuntu-latest\n-        steps:\n-          &hyphen; uses: actions/checkout&commat;v2\n-          &hyphen; name: Use Node.js 18.x\n-            uses: actions/setup-node&commat;v1\n-            with:\n-              node-version: 18.x\n-\n-          &hyphen; name: Setup\n-            run: npm ci\n-\n-          &hyphen; name: Test\n-            run: &verbar;\n-              npm test -- --no-watch --no-progress --browsers=ChromeHeadlessCI\n-\n-    </code-example>\n-\n-1.  [Sign up for GitHub](https://github.com/join) and [add your project](https://github.com/new).\n-    You'll need to push a new commit to trigger a build.\n-\n-1.  Commit your changes and push them to your repository.\n-    *   Learn more about GitHub Actions from [GitHub Actions documentation](https://docs.github.com/en/actions)\n-\n-### Configure CLI for CI testing in Chrome\n-\n-While the CLI command `ng test` is generally running the CI tests in your environment, you might still need to adjust your configuration to run the Chrome browser tests.\n-\n-There is a configuration file for the [Karma JavaScript test runner](https://karma-runner.github.io/latest/config/configuration-file.html), which you must adjust to start Chrome without sandboxing.\n-\n-We'll be using [Headless Chrome](https://developers.google.com/web/updates/2017/04/headless-chrome#cli) in these examples.\n-\n-*   In the Karma configuration file, `karma.conf.js`, add a custom launcher called `ChromeHeadlessCI` below browsers:\n-\n-    <code-example format=\"javascript\" language=\"javascript\">\n-\n-    browsers: ['ChromeHeadlessCI'],\n-    customLaunchers: {\n-      ChromeHeadlessCI: {\n-        base: 'ChromeHeadless',\n-        flags: [\n-          '--no-sandbox'\n-        ]\n-      }\n-    },\n-\n-    </code-example>\n+Continuous integration \\(CI\\) servers let you set up your project repository so that your tests run on every commit and pull request.\n \n-Now, run the following command to use the `--no-sandbox` flag:\n+To test your Angular CLI application in Continuous integration \\(CI\\) run the following command:\n \n <code-example format=\"shell\" language=\"shell\">\n \n-ng test --no-watch --no-progress --browsers=ChromeHeadlessCI\n+ng test --no-watch --no-progress\n \n </code-example>\n \n\n\n###\n\n", "completion": "docs: remove CI testing setups (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/testing.md | file path B: aio/content/guide/testing.md\n\n@@ -2,14 +2,14 @@\n \n # Testing\n \n-Testing your Angular application helps you check that your app is working as you expect.\n+Testing your Angular application helps you check that your application is working as you expect.\n \n ## Prerequisites\n \n-Before writing tests for your Angular app, you should have a basic understanding of the following concepts:\n+Before writing tests for your Angular application, you should have a basic understanding of the following concepts:\n \n-*   Angular fundamentals\n-*   JavaScript\n+*   [Angular fundamentals](guide/architecture)\n+*   [JavaScript](https://javascript.info/)\n *   HTML\n *   CSS\n *   [Angular CLI](cli)\n@@ -27,7 +27,7 @@ If you'd like to experiment with the application that this guide describes, <liv\n \n ## Set up testing\n \n-The Angular CLI downloads and installs everything you need to test an Angular application with the [Jasmine test framework](https://jasmine.github.io).\n+The Angular CLI downloads and installs everything you need to test an Angular application with [Jasmine testing framework](https://jasmine.github.io).\n \n The project you create with the CLI is immediately ready to test.\n Just run the [`ng test`](cli/test) CLI command:\n@@ -41,23 +41,22 @@ ng test\n The `ng test` command builds the application in *watch mode*,\n and launches the [Karma test runner](https://karma-runner.github.io).\n \n-The console output looks a bit like this:\n+The console output looks the below:\n \n <code-example format=\"shell\" language=\"shell\">\n \n-10% building modules 1/1 modules 0 active\n-&hellip;INFO [karma]: Karma v1.7.1 server started at http://0.0.0.0:9876/\n-&hellip;INFO [launcher]: Launching browser Chrome &hellip;\n-&hellip;INFO [launcher]: Starting browser Chrome\n-&hellip;INFO [Chrome &hellip;]: Connected on socket &hellip;\n-Chrome &hellip;: Executed 3 of 3 SUCCESS (0.135 secs / 0.205 secs)\n+02 11 2022 09:08:28.605:INFO [karma-server]: Karma v6.4.1 server started at http://localhost:9876/\n+02 11 2022 09:08:28.607:INFO [launcher]: Launching browsers Chrome with concurrency unlimited\n+02 11 2022 09:08:28.620:INFO [launcher]: Starting browser Chrome\n+02 11 2022 09:08:31.312:INFO [Chrome]: Connected on socket -LaEYvD2R7MdcS0-AAAB with id 31534482\n+Chrome: Executed 3 of 3 SUCCESS (0.193 secs / 0.172 secs)\n+TOTAL: 3 SUCCESS\n \n </code-example>\n \n-The last line of the log is the most important.\n-It shows that Karma ran three tests that all passed.\n+The last line of the log shows that Karma ran three tests that all passed.\n \n-A Chrome browser also opens and displays the test output in the \"Jasmine HTML Reporter\" like this.\n+The test output is displayed in the browser using [Karma Jasmine HTML Reporter](https://github.com/dfederm/karma-jasmine-html-reporter).\n \n <div class=\"lightbox\">\n \n@@ -65,7 +64,6 @@ A Chrome browser also opens and displays the test output in the \"Jasmine HTML Re\n \n </div>\n \n-Most people find this browser output easier to read than the console log.\n Click on a test row to re-run just that test or click on a description to re-run the tests in the selected test group \\(\"test suite\"\\).\n \n Meanwhile, the `ng test` command is watching for changes.\n@@ -75,28 +73,89 @@ The tests run again, the browser refreshes, and the new test results appear.\n \n ## Configuration\n \n-The CLI takes care of Jasmine and Karma configuration for you.\n+The Angular CLI takes care of Jasmine and Karma configuration for you. It constructs the full configuration in memory, based on options specified in the `angular.json` file.\n+\n+If you require to fine-tune Karma, follow the below steps:\n+\n+1. Create a `karma.conf.js` in the root folder of the project.\n+\n+    <code-example format=\"javascript\" language=\"javascript\" header=\"karma.conf.js\">\n+\n+    module.exports = function (config) {\n+      config.set({\n+        basePath: '',\n+        frameworks: ['jasmine', '@angular-devkit/build-angular'],\n+        plugins: [\n+          require('karma-jasmine'),\n+          require('karma-chrome-launcher'),\n+          require('karma-jasmine-html-reporter'),\n+          require('karma-coverage'),\n+          require('@angular-devkit/build-angular/plugins/karma')\n+        ],\n+        client: {\n+          jasmine: {\n+            // you can add configuration options for Jasmine here\n+            // the possible options are listed at https://jasmine.github.io/api/edge/Configuration.html\n+            // for example, you can disable the random execution with `random: false`\n+            // or set a specific seed with `seed: 4321`\n+          },\n+          clearContext: false // leave Jasmine Spec Runner output visible in browser\n+        },\n+        jasmineHtmlReporter: {\n+          suppressAll: true // removes the duplicated traces\n+        },\n+        coverageReporter: {\n+          dir: require('path').join(__dirname, './coverage/<project-name>'),\n+          subdir: '.',\n+          reporters: [\n+            { type: 'html' },\n+            { type: 'text-summary' }\n+          ]\n+        },\n+        reporters: ['progress', 'kjhtml'],\n+        port: 9876,\n+        colors: true,\n+        logLevel: config.LOG_INFO,\n+        autoWatch: true,\n+        browsers: ['Chrome'],\n+        singleRun: false,\n+        restartOnFileChange: true\n+      });\n+    };\n \n-Fine-tune many options by editing the `karma.conf.js` in the root folder of the project and\n-the `test.ts` files in the `src/` folder.\n+    </code-example>\n+\n+1. In the `angular.json`, use the [`karmaConfig`](cli/test) option to configure the Karma builder to use the created configuration file.\n+\n+  <code-example format=\"jsonc\" language=\"jsonc\">\n+\n+  \"test\": {\n+    \"builder\": \"@angular-devkit/build-angular:karma\",\n+    \"options\": {\n+      \"karmaConfig\": \"karma.conf.js\",\n+      \"polyfills\": [\"zone.js\", \"zone.js/testing\"],\n+      \"tsConfig\": \"src/tsconfig.spec.json\",\n+      \"styles\": [\"src/styles.css\"]\n+    }\n+  }\n \n-The `karma.conf.js` file is a partial Karma configuration file.\n-The CLI constructs the full runtime configuration in memory, based on application structure specified in the `angular.json` file, supplemented by `karma.conf.js`.\n+  </code-example>\n \n-Search the web for more details about Jasmine and Karma configuration.\n+\n+<div class=\"alert is-helpful\">\n+\n+Read more about Karma configuration in the [Karma configuration guide](http://karma-runner.github.io/6.4/config/configuration-file.html).\n+\n+</div>\n \n ### Other test frameworks\n \n You can also unit test an Angular application with other testing libraries and test runners.\n Each library and runner has its own distinctive installation procedures, configuration, and syntax.\n \n-Search the web to learn more.\n-\n ### Test file name and location\n \n-Look inside the `src/app` folder.\n-\n-The CLI generated a test file for the `AppComponent` named `app.component.spec.ts`.\n+Inside the `src/app` folder the Angular CLI generated a test file for the `AppComponent` named `app.component.spec.ts`.\n \n <div class=\"alert is-important\">\n \n@@ -162,16 +221,16 @@ This article explains how to configure your project to run Circle CI and Travis\n       build:\n         working_directory: ~/my-project\n         docker:\n-          &hyphen; image: circleci/node:10-browsers\n+          &hyphen; image: cimg/node:18.12.0-browsers\n         steps:\n           &hyphen; checkout\n           &hyphen; restore_cache:\n-              key: my-project-{{ .Branch }}-{{ checksum \"package-lock.json\" }}\n-          &hyphen; run: npm install\n+              key: my-project-{{ checksum \"package-lock.json\"}}\n+          &hyphen; run: npm ci\n           &hyphen; save_cache:\n-              key: my-project-{{ .Branch }}-{{ checksum \"package-lock.json\" }}\n+              key: my-project-{{ checksum \"package-lock.json\" }}\n               paths:\n-                &hyphen; \"node_modules\"\n+                &hyphen; $HOME/.npm\n           &hyphen; run: npm run test -- --no-watch --no-progress --browsers=ChromeHeadlessCI\n \n     </code-example>\n@@ -193,7 +252,7 @@ This article explains how to configure your project to run Circle CI and Travis\n \n     language: node_js\n     node_js:\n-      &hyphen; \"10\"\n+      &hyphen; \"18\"\n \n     addons:\n       chrome: stable\n@@ -224,7 +283,7 @@ This article explains how to configure your project to run Circle CI and Travis\n \n     <code-example format=\"yaml\" language=\"yaml\">\n \n-    image: node:14.15-stretch\n+    image: node:18.12-stretch\n     variables:\n       FF_USE_FASTZIP: \"true\"\n \n@@ -285,10 +344,10 @@ This article explains how to configure your project to run Circle CI and Travis\n         runs-on: ubuntu-latest\n         steps:\n           &hyphen; uses: actions/checkout&commat;v2\n-          &hyphen; name: Use Node.js 14.x\n+          &hyphen; name: Use Node.js 18.x\n             uses: actions/setup-node&commat;v1\n             with:\n-              node-version: 14.x\n+              node-version: 18.x\n \n           &hyphen; name: Setup\n             run: npm ci\n@@ -313,7 +372,7 @@ There is a configuration file for the [Karma JavaScript test runner](https://kar\n \n We'll be using [Headless Chrome](https://developers.google.com/web/updates/2017/04/headless-chrome#cli) in these examples.\n \n-*   In the Karma configuration file, `karma.conf.js`, add a custom launcher called ChromeHeadlessCI below browsers:\n+*   In the Karma configuration file, `karma.conf.js`, add a custom launcher called `ChromeHeadlessCI` below browsers:\n \n     <code-example format=\"javascript\" language=\"javascript\">\n \n@@ -321,7 +380,9 @@ We'll be using [Headless Chrome](https://developers.google.com/web/updates/2017/\n     customLaunchers: {\n       ChromeHeadlessCI: {\n         base: 'ChromeHeadless',\n-        flags: ['--no-sandbox']\n+        flags: [\n+          '--no-sandbox'\n+        ]\n       }\n     },\n \n@@ -335,13 +396,6 @@ ng test --no-watch --no-progress --browsers=ChromeHeadlessCI\n \n </code-example>\n \n-<div class=\"alert is-helpful\">\n-\n-**NOTE**: <br />\n-Right now, you'll also want to include the `--disable-gpu` flag if you're running on Windows.\n-See [crbug.com/737678](https://crbug.com/737678).\n-\n-</div>\n \n ## More information on testing\n \n@@ -364,4 +418,4 @@ After you've set up your application for testing, you might find the following t\n \n <!-- end links -->\n \n-@reviewed 2022-02-28\n+@reviewed 2022-11-02\n\n\n###\n\n", "completion": "docs: update testing document to include karma config (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -439,8 +439,17 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   /** @nodoc */\n   ngOnChanges(changes: SimpleChanges) {\n     if (ngDevMode) {\n-      assertNoPostInitInputChange(\n-          this, changes, ['ngSrc', 'ngSrcset', 'width', 'height', 'priority']);\n+      assertNoPostInitInputChange(this, changes, [\n+        'ngSrc',\n+        'ngSrcset',\n+        'width',\n+        'height',\n+        'priority',\n+        'fill',\n+        'loading',\n+        'sizes',\n+        'disableOptimizedSrcset',\n+      ]);\n     }\n   }\n \n@@ -687,12 +696,20 @@ function assertUnderDensityCap(dir: NgOptimizedImage, value: string) {\n  * the directive has initialized.\n  */\n function postInitInputChangeError(dir: NgOptimizedImage, inputName: string): {} {\n+  let reason!: string;\n+  if (inputName === 'width' || inputName === 'height') {\n+    reason = `Changing \\`${inputName}\\` may result in different attribute value ` +\n+        `applied to the underlying image element and cause layout shifts on a page.`;\n+  } else {\n+    reason = `Changing the \\`${inputName}\\` would have no effect on the underlying ` +\n+        `image element, because the resource loading has already occurred.`;\n+  }\n   return new RuntimeError(\n       RuntimeErrorCode.UNEXPECTED_INPUT_CHANGE,\n       `${imgDirectiveDetails(dir.ngSrc)} \\`${inputName}\\` was updated after initialization. ` +\n-          `The NgOptimizedImage directive will not react to this input change. ` +\n-          `To fix this, switch \\`${inputName}\\` a static value or wrap the image element ` +\n-          `in an *ngIf that is gated on the necessary value.`);\n+          `The NgOptimizedImage directive will not react to this input change. ${reason} ` +\n+          `To fix this, either switch \\`${inputName}\\` to a static value ` +\n+          `or wrap the image element in an *ngIf that is gated on the necessary value.`);\n }\n \n /**\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -641,34 +641,58 @@ describe('Image directive', () => {\n     });\n \n     const inputs = [\n-      ['ngSrc', 'new-img.png'],  //\n-      ['width', 10],             //\n-      ['height', 20],            //\n-      ['priority', true]\n+      ['ngSrc', 'new-img.png'],\n+      ['width', 10],\n+      ['height', 20],\n+      ['priority', true],\n+      ['fill', true],\n+      ['loading', true],\n+      ['sizes', '90vw'],\n+      ['disableOptimizedSrcset', true],\n     ];\n     inputs.forEach(([inputName, value]) => {\n-      it(`should throw if an input changed after directive initialized the input`, () => {\n-        setupTestingModule();\n-\n-        const template =\n-            '<img [ngSrc]=\"ngSrc\" [width]=\"width\" [height]=\"height\" [priority]=\"priority\">';\n-        // Initial render\n-        const fixture = createTestComponent(template);\n-        fixture.detectChanges();\n+      it(`should throw if the \\`${inputName}\\` input changed after directive initialized the input`,\n+         () => {\n+           @Component({\n+             selector: 'test-cmp',\n+             template: `<img\n+              [ngSrc]=\"ngSrc\"\n+              [width]=\"width\"\n+              [height]=\"height\"\n+              [priority]=\"priority\"\n+              [fill]=\"fill\"\n+              [loading]=\"loading\"\n+              [sizes]=\"sizes\"\n+              [disableOptimizedSrcset]=\"disableOptimizedSrcset\"\n+            >`\n+           })\n+           class TestComponent {\n+             width = 100;\n+             height = 50;\n+             ngSrc = 'img.png';\n+             priority = false;\n+             fill = false;\n+             loading = false;\n+             sizes = '100vw';\n+             disableOptimizedSrcset = false;\n+           }\n+\n+           setupTestingModule({component: TestComponent});\n+\n+           // Initial render\n+           const fixture = TestBed.createComponent(TestComponent);\n+           fixture.detectChanges();\n \n-        expect(() => {\n-          // Update input (expect to throw)\n-          (fixture.componentInstance as unknown as {[key: string]: unknown})[inputName as string] =\n-              value;\n-          fixture.detectChanges();\n-        })\n-            .toThrowError(\n-                'NG02953: The NgOptimizedImage directive (activated on an <img> element ' +\n-                `with the \\`ngSrc=\"img.png\"\\`) has detected that \\`${inputName}\\` was updated ` +\n-                'after initialization. The NgOptimizedImage directive will not react ' +\n-                `to this input change. To fix this, switch \\`${inputName}\\` a static value or ` +\n-                'wrap the image element in an *ngIf that is gated on the necessary value.');\n-      });\n+           const expectedErrorMessage =  //\n+               `NG02953: The NgOptimizedImage directive (.*)? ` +\n+               `has detected that \\`${inputName}\\` was updated after initialization`;\n+           expect(() => {\n+             // Update input (expect to throw)\n+             (fixture.componentInstance as unknown as\n+              {[key: string]: unknown})[inputName as string] = value;\n+             fixture.detectChanges();\n+           }).toThrowError(new RegExp(expectedErrorMessage));\n+         });\n     });\n   });\n \n\n\n###\n\n", "completion": "refactor(common): improve the NgOptimizedImage error message related to changing inputs (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/typecheck/api/scope.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/api/scope.ts\n\n@@ -18,7 +18,8 @@ import {SymbolWithValueDeclaration} from '../../util/src/typescript';\n  */\n export interface PotentialImport {\n   kind: PotentialImportKind;\n-  moduleSpecifier: string;\n+  // If no moduleSpecifier is present, the given symbol name is already in scope.\n+  moduleSpecifier?: string;\n   symbolName: string;\n }\n \n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/src/checker.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/src/checker.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {AST, CssSelector, DomElementSchemaRegistry, ExternalExpr, LiteralPrimitive, ParseSourceSpan, PropertyRead, SafePropertyRead, TmplAstElement, TmplAstNode, TmplAstReference, TmplAstTemplate, TmplAstTextAttribute} from '@angular/compiler';\n+import {AST, CssSelector, DomElementSchemaRegistry, ExternalExpr, LiteralPrimitive, ParseSourceSpan, PropertyRead, SafePropertyRead, TmplAstElement, TmplAstNode, TmplAstReference, TmplAstTemplate, TmplAstTextAttribute, WrappedNodeExpr} from '@angular/compiler';\n import ts from 'typescript';\n \n import {ErrorCode, ngErrorCode} from '../../diagnostics';\n@@ -682,6 +682,7 @@ export class TemplateTypeCheckerImpl implements TemplateTypeChecker {\n     if (toImport.ngModule !== null) {\n       ngModuleRef = this.metaReader.getNgModuleMetadata(new Reference(toImport.ngModule))?.ref;\n     }\n+    const kind = ngModuleRef ? PotentialImportKind.NgModule : PotentialImportKind.Standalone;\n \n     // Import the ngModule if one exists. Otherwise, import the standalone trait directly.\n     const importTarget = ngModuleRef ?? toImport.ref;\n@@ -691,9 +692,17 @@ export class TemplateTypeCheckerImpl implements TemplateTypeChecker {\n     // ranking references, such as keeping a record of import specifiers used in existing code.\n     const emittedRef = this.refEmitter.emit(importTarget, inContext.getSourceFile());\n     if (emittedRef.kind === ReferenceEmitKind.Failed) return [];\n+    const emittedExpression = emittedRef.expression;\n+\n+    // This is not be a true import if an appropriate identifier is already in scope.\n+    if (emittedExpression instanceof WrappedNodeExpr) {\n+      return [{kind, symbolName: emittedExpression.node.getText()}];\n+    }\n+    // Otherwise, it must be a genuine external expression.\n+    if (!(emittedExpression instanceof ExternalExpr)) {\n+      return [];\n+    }\n \n-    // The resulting import expression should have a module name and an identifier name.\n-    const emittedExpression: ExternalExpr = emittedRef.expression as ExternalExpr;\n     if (emittedExpression.value.moduleName === null || emittedExpression.value.name === null)\n       return [];\n \n\n---\n file path A: packages/language-service/src/codefixes/fix_missing_import.ts | file path B: packages/language-service/src/codefixes/fix_missing_import.ts\n\n@@ -93,10 +93,13 @@ function getCodeActions(\n       }\n \n       // Create a code action for this import.\n+      let description = `Import ${importName}`;\n+      if (potentialImport.moduleSpecifier !== undefined) {\n+        description += ` from '${potentialImport.moduleSpecifier}' on ${importOn.name!.text}`;\n+      }\n       codeActions.push({\n         fixName: FixIdForCodeFixesAll.FIX_MISSING_IMPORT,\n-        description: `Import ${importName} from '${potentialImport.moduleSpecifier}' on ${\n-            importOn.name!.text}`,\n+        description,\n         changes: [{\n           fileName: importOn.getSourceFile().fileName,\n           textChanges: [...fileImportChanges, ...traitImportChanges],\n@@ -115,7 +118,10 @@ function getCodeActions(\n function updateImportsForTypescriptFile(\n     tsChecker: ts.TypeChecker, file: ts.SourceFile, newImport: PotentialImport,\n     tsFileToImport: ts.SourceFile): [ts.TextChange[], string] {\n-  const changes = new Array<ts.TextChange>();\n+  // If the expression is already imported, we can just return its name.\n+  if (newImport.moduleSpecifier === undefined) {\n+    return [[], newImport.symbolName];\n+  }\n \n   // The trait might already be imported, possibly under a different name. If so, determine the\n   // local name of the imported trait.\n\n\n###\n\n", "completion": "fix(language-service): Prevent crashes on unemitable references (#<issue-num>)"}
{"prompt": " file path A: aio/firebase.json | file path B: aio/firebase.json\n\n@@ -183,7 +183,6 @@\n       // The below paths are referenced in users projects generated by the CLI\n       {\"type\": 301, \"source\": \"/config/tsconfig\", \"destination\": \"/guide/typescript-configuration\"},\n       {\"type\": 301, \"source\": \"/config/solution-tsconfig\", \"destination\": \"https://devblogs.microsoft.com/typescript/announcing-typescript-3-9/#solution-style-tsconfig\"},\n-      {\"type\": 301, \"source\": \"/config/app-package-json\", \"destination\": \"/guide/strict-mode#non-local-side-effects-in-applications\"},\n       {\"type\": 301, \"source\": \"/strict\", \"destination\": \"/guide/strict-mode\"},\n \n       // Use discoverable link for Angular DevTools and redirect to the guide page\n\n---\n file path A: aio/ngsw-config.json | file path B: aio/ngsw-config.json\n\n@@ -102,7 +102,6 @@\n     \"!/api/testing/*-*\",\n     \"!/api/upgrade/*/*-(class|decorator|directive|function|interface|let|pipe|type|type-alias|var)\",\n     \"!/api/upgrade/*/index/*\",\n-    \"!/config/app-package-json/{0,1}\",\n     \"!/config/solution-tsconfig/{0,1}\",\n     \"!/config/tsconfig/{0,1}\",\n     \"!/devtools/{0,1}\",\n\n---\n file path A: aio/tests/deployment/shared/URLS_TO_REDIRECT.txt | file path B: aio/tests/deployment/shared/URLS_TO_REDIRECT.txt\n\n@@ -40,7 +40,6 @@\n /api/upgrade/static/downgradeComponent-function.html --> /api/upgrade/static/downgradeComponent\n /api/upgrade/static/index/downgradeComponent-function --> /api/upgrade/static/downgradeComponent\n /api/upgrade/static/UpgradeModule-class --> /api/upgrade/static/UpgradeModule\n-/config/app-package-json --> /guide/strict-mode#non-local-side-effects-in-applications\n /config/solution-tsconfig --> https://devblogs.microsoft.com/typescript/announcing-typescript-3-9/#solution-style-tsconfig\n /config/tsconfig --> /guide/typescript-configuration\n /devtools --> /guide/devtools\n\n\n###\n\n", "completion": "docs: remove redirects to no longer existing page (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/i18n-common-translation-files.md | file path B: aio/content/guide/i18n-common-translation-files.md\n\n@@ -123,7 +123,7 @@ For example, to create a French translation file, complete the following actions\n Unless you are fluent in the language and have the time to edit translations, you will likely complete the following steps.\n \n 1.  Send each translation file to a translator.\n-1.  The translator uses an XLIFF file editor complete the following actions.\n+1.  The translator uses an XLIFF file editor to complete the following actions.\n     1.  Create the translation.\n     1.  Edit the translation.\n \n\n\n###\n\n", "completion": "docs: fix missing word (#<issue-num>)"}
{"prompt": " file path A: aio/content/cli/usage-analytics-gathering.md | file path B: None\n\n@@ -1,62 +0,0 @@\n-# Gathering and Viewing Usage Analytics\n-\n-Users can opt in to share their Angular CLI usage data with [Google Analytics](https://support.google.com/analytics/answer/1008015?hl=en), using the [`ng analytics` CLI command](analytics).\n-The data is also shared with the Angular team, and used to improve the CLI.\n-\n-The gathering of CLI analytics data is disabled by default, and must be enabled at the project level by individual users.\n-It cannot be enabled at the project level for all users.\n-\n-Data gathered in this way can be viewed on the Google Analytics site, but is not automatically visible on your own organization's Analytics site.\n-As an administrator for an Angular development group, you can configure your instance of Angular CLI to be able to see analytics data for your own team's usage of the Angular CLI.\n-This configuration option is separate from and in addition to other usage analytics that your users may be sharing with Google.\n-\n-## Enable access to CLI usage data\n-\n-To configure access to your own users' CLI usage data, use the `ng config` command to add a key to your global [`angular.json` workspace configuration file](guide/workspace-config).\n-The key goes under `cli.analyticsSharing` at the top level of the file, outside the `projects` sections.\n-The value of the key is your organization's tracking ID, as assigned by Google Analytics.\n-This ID is a string that looks like `UA-123456-12`.\n-\n-You can choose to use a descriptive string as the key value, or be assigned a random key when you run the CLI command.\n-For example, the following command adds a configuration key named \"tracking\".\n-\n-<code-example format=\"shell\" language=\"shell\">\n-\n-ng config --global cli.analyticsSharing.tracking UA-123456-12\n-\n-</code-example>\n-\n-To turn off this feature, run the following command:\n-\n-<code-example format=\"shell\" language=\"shell\">\n-\n-ng config --global cli.analyticsSharing undefined\n-\n-</code-example>\n-\n-## Per user tracking\n-\n-You can add a custom user ID to the global configuration, in order to identify unique usage of commands and flags.\n-If that user enables CLI analytics for their own project, your analytics display tracks and labels their individual usage.\n-\n-<code-example format=\"shell\" language=\"shell\">\n-\n-ng config --global cli.analyticsSharing.uuid SOME_USER_NAME\n-\n-</code-example>\n-\n-To generate a new random user ID, run the following command:\n-\n-<code-example format=\"shell\" language=\"shell\">\n-\n-ng config --global cli.analyticsSharing.uuid \"\"\n-\n-</code-example>\n-\n-<!-- links -->\n-\n-<!-- external links -->\n-\n-<!-- end links -->\n-\n-@reviewed 2022-02-28\n\n---\n file path A: aio/content/guide/workspace-config.md | file path B: aio/content/guide/workspace-config.md\n\n@@ -19,7 +19,6 @@ The following properties, at the top-level of the file, configure the workspace.\n | `schematics`     | A set of [schematics](guide/glossary#schematic) that customize the `ng generate` sub-command option defaults for this workspace. See the [Generation schematics](#schematics) section.                                                |\n | `projects`       | Contains a subsection for each library or application in the workspace, with the per-project configuration options.                                                                                                       |\n \n-\n The initial application that you create with `ng new app_name` is listed under \"projects\":\n \n <code-example language=\"json\">\n@@ -55,19 +54,12 @@ The following configuration properties are a set of options that customize the A\n \n | Property              | Details                                                                                       | Value type                                              |\n |:---                   |:---                                                                                           |:---                                                     |\n-| `analytics`           | Share anonymous [usage data](cli/usage-analytics-gathering) with the Angular Team.            | `boolean` &verbar; `ci`                                 |\n-| `analyticsSharing`    | A set of analytics sharing options.                                                           | [Analytics sharing options](#analytics-sharing-options) |\n+| `analytics`           | Share anonymous [usage data](cli/analytics) with the Angular Team.                            | `boolean` &verbar; `ci`                                 |\n | `cache`               | Control [persistent disk cache](cli/cache) used by [Angular CLI Builders](guide/cli-builder). | [Cache options](#cache-options)                         |\n | `schematicCollections`| A list of default schematics collections to use.                                              | `string[]`                                              |\n | `packageManager`      | The preferred package manager tool to use.                                                    | `npm` &verbar; `cnpm` &verbar; `pnpm` &verbar;`yarn`    |\n | `warnings`            | Control Angular CLI specific console warnings.                                                        | [Warnings options](#warnings-options)                   |\n \n-### Analytics sharing options\n-\n-| Property   | Details                                                        | Value type |\n-|:---        |:---                                                            |:---        |\n-| `tracking` | Analytics sharing info tracking ID.                            | `string`   |\n-| `uuid`     | Analytics sharing info Universally Unique Identifier (UUID).   | `string`   |\n \n ### Cache options\n \n\n---\n file path A: aio/content/marketing/analytics.md | file path B: None\n\n@@ -1,62 +0,0 @@\n-# Usage Metrics Gathering\n-\n-You can help the Angular Team to prioritize features and improvements by permitting the Angular team to send command-line command usage statistics to Google.\n-The Angular Team does not collect usage statistics unless you explicitly opt in during the Angular CLI installation or upgrade.\n-\n-## What is collected?\n-\n-Usage analytics include the commands and selected flags for each execution.\n-Usage analytics may include the following information:\n-\n-*   Your operating system \\(macOS, Linux distribution, Windows\\) and its version.\n-*   Number of CPUs, amount of RAM.\n-*   Node and Angular CLI version \\(local version only\\).\n-*   How long each command took to initialize and execute.\n-*   Command name that was run.\n-*   For Schematics commands \\(add, generate and new\\), the schematic collection and name and a list of selected flags.\n-*   For build commands \\(build, serve\\), the builder name, the number and size of bundles \\(initial and lazy\\), compilation units, the time it took to build and rebuild, and basic Angular-specific API usage.\n-*   Error code of exceptions and crash data. No stack trace is collected.\n-\n-Only Angular owned and developed schematics and builders are reported.\n-Third-party schematics and builders do not send data to the Angular Team.\n-\n-## Opting in\n-\n-When installing the Angular CLI or upgrading an existing version, you are prompted to allow global collection of usage statistics.\n-If you say no or skip the prompt, no data is collected.\n-\n-Starting with version 8, we added the `analytics` command to the CLI.\n-You can change your opt-in decision at any time using this command.\n-\n-### Disabling usage analytics\n-\n-To disable analytics gathering, run the following command:\n-\n-<code-example format=\"shell\" language=\"shell\">\n-\n-&num; Disable all usage analytics.\n-ng analytics disable\n-\n-</code-example>\n-\n-### Enabling usage analytics\n-\n-To enable usage analytics, run the following command:\n-\n-<code-example format=\"shell\" language=\"shell\">\n-\n-&num; Enable all usage analytics.\n-ng analytics enable\n-\n-</code-example>\n-\n-### Prompting\n-\n-To prompt the user again about usage analytics, run the following command:\n-\n-<code-example format=\"shell\" language=\"shell\">\n-\n-&num; Prompt for all usage analytics.\n-ng analytics prompt\n-\n-</code-example>\n\n---\n file path A: aio/content/navigation.json | file path B: aio/content/navigation.json\n\n@@ -1114,11 +1114,6 @@\n               \"title\": \"Overview\",\n               \"tooltip\": \"An introduction to the CLI tool, commands, and syntax.\",\n               \"url\": \"cli\"\n-            },\n-            {\n-              \"title\": \"Usage analytics\",\n-              \"tooltip\": \"For administrators, guide to gathering usage analytics from your users.\",\n-              \"url\": \"cli/usage-analytics-gathering\"\n             }\n           ]\n         },\n@@ -1310,11 +1305,6 @@\n           \"url\": \"https://blog.angular.io/\",\n           \"title\": \"Blog\",\n           \"tooltip\": \"Angular Blog\"\n-        },\n-        {\n-          \"url\": \"analytics\",\n-          \"title\": \"Usage analytics\",\n-          \"tooltip\": \"Angular Usage Analytics\"\n         }\n       ]\n     },\n\n---\n file path A: aio/firebase.json | file path B: aio/firebase.json\n\n@@ -194,7 +194,11 @@\n \n       // Temporarily serve the guide at `/devtools` as well as `/guide/devtools` until users have\n       // their SW updated to a version that knows about the `/devtools` redirect.\n-      {\"type\": 302, \"source\": \"/generated/docs/devtools.json\", \"destination\": \"/generated/docs/guide/devtools.json\"}\n+      {\"type\": 302, \"source\": \"/generated/docs/devtools.json\", \"destination\": \"/generated/docs/guide/devtools.json\"},\n+\n+      // Analytics pages that have been deleted in v15\n+      {\"type\": 301, \"source\": \"/cli/usage-analytics-gathering\", \"destination\": \"/cli/analytics\"},\n+      {\"type\": 301, \"source\": \"/analytics\", \"destination\": \"/cli/analytics\"}\n     ],\n     \"rewrites\": [\n       {\n\n---\n file path A: aio/tests/deployment/shared/URLS_TO_REDIRECT.txt | file path B: aio/tests/deployment/shared/URLS_TO_REDIRECT.txt\n\n@@ -232,3 +232,5 @@\n /styleguide --> /guide/styleguide\n /testing --> /guide/testing\n /testing/first-app-tests.html --> /guide/testing\n+/cli/usage-analytics-gathering --> /cli/analytics\n+/analytics --> /cli/analytics\n\n\n###\n\n", "completion": "docs: update analytics gathering documentation (#<issue-num>)"}
{"prompt": " file path A: aio/content/start/index.md | file path B: aio/content/start/index.md\n\n@@ -9,7 +9,7 @@ StackBlitz is a browser-based development environment where you can create, save\n \n ## Prerequisites\n \n-To get the most out of this tutorial you should already have a basic understanding of the following.\n+To get the most out of this tutorial, you should already have a basic understanding of the following.\n \n *   [HTML](https://developer.mozilla.org/docs/Learn/HTML \"Learning HTML: Guides and tutorials\")\n *   [JavaScript](https://developer.mozilla.org/docs/Web/JavaScript \"JavaScript\")\n@@ -24,20 +24,20 @@ Components define areas of responsibility in the UI that let you reuse sets of U\n \n A component consists of three things:\n \n-|                           | Details |\n+| Component Part            | Details |\n |:---                       |:---     |\n-| A component class         | Handles data and functionality. |\n-| An HTML template          | Determines the UI.              |\n-| Component-specific styles | Define the look and feel.       |\n+| A component class         | Handles data and functionality |\n+| An HTML template          | Determines the UI              |\n+| Component-specific styles | Define the look and feel       |\n \n-This guide demonstrates building an application with the following components.\n+This guide demonstrates building an application with the following components:\n \n | Components             | Details |\n |:---                    |:---     |\n-| `<app-root>`           | The first component to load and the container for the other components. |\n-| `<app-top-bar>`        | The store name and checkout button.                                     |\n-| `<app-product-list>`   | The product list.                                                       |\n-| `<app-product-alerts>` | A component that contains the application's alerts.                     |\n+| `<app-root>`           | The first component to load and the container for the other components |\n+| `<app-top-bar>`        | The store name and checkout button                                     |\n+| `<app-product-list>`   | The product list                                                       |\n+| `<app-product-alerts>` | A component that contains the application's alerts                     |\n \n <div class=\"lightbox\">\n \n@@ -181,7 +181,7 @@ The `ProductListComponent` also defines a `products` property that contains impo\n The next step is to create a new alert feature that uses product data from the `ProductListComponent`.\n The alert checks the product's price, and, if the price is greater than &dollar;700, displays a **Notify Me** button that lets users sign up for notifications when the product goes on sale.\n \n-This section walks you through creating a child component, `ProductAlertsComponent` that can receive data from its parent component, `ProductListComponent`.\n+This section walks you through creating a child component, `ProductAlertsComponent`, that can receive data from its parent component, `ProductListComponent`.\n \n 1.  Click on the plus sign above the current terminal to create a new terminal to run the command to generate the component.\n \n@@ -191,11 +191,11 @@ This section walks you through creating a child component, `ProductAlertsCompone\n \n     </div>\n \n-1.  In the new terminal, generate a new component named `product-alerts` by running the following command.\n+1.  In the new terminal, generate a new component named `product-alerts` by running the following command:\n \n     <code-example format=\"shell\" language=\"shell\">\n \n-    ng generate component product-alerts\n+    `ng generate component product-alerts`\n   \n     </code-example>\n \n\n\n###\n\n", "completion": "docs: made code appear better, etc. (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,22 @@\n+<a name=\"15.0.0-rc.2\"></a>\n+# 15.0.0-rc.2 (2022-11-04)\n+### core\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [96c0e42e61](https://github.com/angular/angular/commit/96c0e42e61b8a4fced1354da0162c06e7b029cf3) | fix | allow readonly arrays for standalone imports ([#47851](https://github.com/angular/angular/pull/47851)) |\n+### platform-browser\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [d5cd79f885](https://github.com/angular/angular/commit/d5cd79f88542cc19aa6cc907a8097881ebd8aea1) | perf | resolve memory leak when using animations with shadow DOM ([#47903](https://github.com/angular/angular/pull/47903)) |\n+### platform-server\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [31a7ce1268](https://github.com/angular/angular/commit/31a7ce12681d45cda33070b6fcf29d4815814cdf) | fix | call `onSerialize` when state is empty ([#47888](https://github.com/angular/angular/pull/47888)) |\n+## Special Thanks\n+Alan Agius, Alex Rickabaugh, Andrew Kushnir, Charles Lyding, Kristiyan Kostadinov, Paul Gschwendtner, Pawel Kozlowski, Virginia Dooley and mgechev\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"14.2.9\"></a>\n # 14.2.9 (2022-11-03)\n ### platform-browser\n@@ -3698,4 +3717,4 @@ This release contains the same set the of changes as 11.2.0-next.1.\n ### Code Refactoring\n \n * **compiler:** remove support for TypeScript 3.9 ([#39313](https://github.com/angular/angular/issues/39313)) ([736e064](https://github.com/angular/angular/commit/736e0644b02bc4606a7ae0c974d1b06e993708f6))\n-* **router:** adjust type of parameter in `navigateByUrl` and `createUrlTree` to be more accurate ([#38227](https://github.com/angular/angular/issues/38227)) ([e4f4d18](https://github.com/angular/angular/commit/e4f4d18)), closes [#18798](https://github.com/angular/angular/issues/18798)\n\\ No newline at end of file\n+* **router:** adjust type of parameter in `navigateByUrl` and `createUrlTree` to be more accurate ([#38227](https://github.com/angular/angular/issues/38227)) ([e4f4d18](https://github.com/angular/angular/commit/e4f4d18)), closes [#18798](https://github.com/angular/angular/issues/18798)\n\n\n###\n\n", "completion": "docs: release notes for the v15.0.0-rc.2 release"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,18 @@\n+<a name=\"14.2.9\"></a>\n+# 14.2.9 (2022-11-03)\n+### platform-browser\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [92d28bdd99](https://github.com/angular/angular/commit/92d28bdd99d3e18f42f6ed8494344b72b15d0104) | perf | resolve memory leak when using animations with shadow DOM ([#47903](https://github.com/angular/angular/pull/47903)) |\n+### platform-server\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [d2d9bbf5ce](https://github.com/angular/angular/commit/d2d9bbf5ce5a2f5e95e7c836fbca67d90db62371) | fix | call `onSerialize` when state is empty ([#47888](https://github.com/angular/angular/pull/47888)) |\n+## Special Thanks\n+Alan Agius, Kristiyan Kostadinov, Virginia Dooley and mgechev\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.0.0-rc.1\"></a>\n # 15.0.0-rc.1 (2022-10-26)\n ### common\n\n\n###\n\n", "completion": "docs: release notes for the v14.2.9 release"}
{"prompt": " file path A: aio/content/guide/roadmap.md | file path B: aio/content/guide/roadmap.md\n\n@@ -1,6 +1,6 @@\n # Angular Roadmap\n \n-<p class=\"roadmap-last-updated\">Last updated: 2022-05-23</p>\n+<p class=\"roadmap-last-updated\">Last updated: 2022-11-05</p>\n \n Angular receives a large number of feature requests, both from inside Google and from the broader open-source community.\n At the same time, our list of projects contains plenty of maintenance tasks, code refactorings, and potential performance improvements.\n@@ -14,46 +14,34 @@ For example, features are released in the next minor after they are complete, or\n \n ## In progress\n \n-### Implement APIs for optional NgModules\n-\n-In the process of making Angular simpler, we are working on introducing APIs that allow developers to initialize applications, instantiate components, and use the router without NgModules. Angular v14 introduces developer preview of the APIs for standalone components, directives, and pipes. In the next few quarters we'll collect feedback from developers and finalize the project making the APIs stable. As the next step we will work on improving use cases such as `TestBed`, Angular elements, etc.\n-\n-### Improve image performance\n+### Explore hydration and server-side rendering usability improvements\n \n-The [Aurora](https://web.dev/introducing-aurora/) and the Angular teams are working on the implementation of an image directive that aims to improve [Core Web Vitals](https://web.dev/vitals). Currently, the project is in a prototyping phase and the teams are validating the image directive with partners.\n+As the first step of this project we will implement non-destructive hydration. This technique will allow us to reuse the server-side rendered DOM and rather than rerendering it only attach event listeners and create data structures required by the Angular runtime. As the next step, we are going to further explore the dynamically evolving space of partial hydration and resumability. Each of the approaches has their trade-offs and we'd like to make an informed decision what's the most optimal long-term solution for Angular.\n \n-### Investigate micro frontend architecture for scalable development processes\n+### Improve runtime performance and make Zone.js optional\n \n-We conducted a series of 40 interviews to understand the requirements for micro-frontend architecture of the community. We followed up with a broader community survey. As the next step, we'll share analysis of the results publicly.\n+As part of this effort we are revisiting Angular's reactivity model to make Zone.js optional and improve runtime performance. By default Angular runs change detection globally, traversing the entire component tree. We're exploring options to run change detection only in affected components. This way, we simplify the framework, improve debugging, and reduce application bundle size. Additionally, this lets us take advantage of built-in async/await syntax, which currently Zone.js does not support.\n \n-### Investigate modern bundles\n+### Improve documentation and schematics for standalone components\n \n-To improve development experience by speeding up build times research modern bundles.\n-As part of the project experiment with [esbuild](https://esbuild.github.io) and other open source solutions, compare them with the state-of-the-art tooling in Angular CLI, and report the findings. In Angular v14 we're releasing an [experimental support](https://github.com/angular/angular-cli/pull/22995) for esbuild. Next, the team will focus on validating the new prototype and implementing watch and Sass support.\n+We are working on developing an `ng new` collection for applications bootstrapped with a standalone component. Additionally, we are filling the documentation gaps of the simplified standalone component APIs.\n \n-### Modern CSS\n+### Introduce dependency injection debugging APIs\n \n-The Web ecosystem evolves constantly and we want to reflect the latest modern standards in Angular. In this project we aim to provide guidelines on using modern CSS features in Angular to ensure developers follow best practices for layout, styling, etc.\n+To improve the debugging utilities of Angular and Angular DevTools, we'll work on APIs that provide access the dependency injection runtime. As part of the project we'll expose debugging methods that allow us to explore the injector hierarchy and the dependencies across their associated providers.\n \n-### Support adding directives to host elements\n+### Streamline standalone imports with Language Service\n \n-A [long-standing feature request](https://github.com/angular/angular/issues/8785) is to add the ability to add directives to host elements.\n-The feature lets developers augment their own components with additional behaviors without using inheritance.\n-The project requires substantial effort in terms of the definition of APIs, semantics, and implementation.\n+As part of this initiative we are going to implement automatic import of template dependencies for standalone components. Additionally, to enable smaller application bundles the language service will propose automatic removal of unused imports.\n \n-### Better stack traces\n+### Investigate modern bundles\n \n-The Angular and the Chrome DevTools are working together to enable more readable stack traces for error messages.\n+To improve development experience by speeding up build times, we plan to explore options to improve JavaScript bundles created by Angular CLI.\n+As part of the project experiment with [esbuild](https://esbuild.github.io) and other open source solutions, compare them with the state-of-the-art tooling in Angular CLI, and report the findings. In Angular v15 we have experimental esbuild support in `ng build` and `ng build --watch`. We'll continue iterating on the solution until we're confident to release it as stable.\n \n ### New CDK primitives\n \n-We are working on new CDK primitives to facilitate creating custom components based on the WAI-ARIA design patterns for [Listbox](https://www.w3.org/TR/wai-aria-practices-1.1/#Listbox) and [Combobox](https://www.w3.org/TR/wai-aria-practices-1.1/#combobox). Angular v14 introduced stable [menu and dialog primitives](https://material.angular.io/cdk/categories) as part of this project.\n-\n-### Enhanced Angular Material components by integrating MDC Web\n-\n-[MDC Web](https://material.io/develop/web) is a library created by the Google Material Design team that provides reusable primitives for building Material Design components.\n-The Angular team is incorporating these primitives into Angular Material.\n-Using MDC Web aligns Angular Material more closely with the Material Design specification, expand accessibility, improve component quality, and improve the velocity of our team.\n+We are working on new CDK primitives to facilitate creating custom components based on the WAI-ARIA design patterns for [Combobox](https://www.w3.org/TR/wai-aria-practices-1.1/#combobox). Angular v14 introduced stable [menu and dialog primitives](https://material.angular.io/cdk/categories) as part of this project and in v15 [Listbox](https://www.w3.org/TR/wai-aria-practices-1.1/#Listbox).\n \n ### Angular component accessibility\n \n@@ -63,23 +51,33 @@ We are evaluating components in Angular Material against accessibility standards\n \n Ensure all existing documentation fits into a consistent set of content types. Update excessive use of tutorial-style documentation into independent topics. We want to ensure the content outside the main tutorials is self-sufficient without being tightly coupled to a series of guides. In Q2 2022, we refactored the [template content](https://github.com/angular/angular/pull/45897). The next steps are to introduce better structure for components and dependency injection.\n \n+### Investigate micro frontend architecture for scalable development processes\n+\n+For the past couple of quarters we understood and defined the problem space. We are going to follow up with a series of blog posts on best practices when developing applications at scale.\n+\n+### Update getting started tutorial\n+\n+We're working on updating the Angular getting started experience with standalone components. As part of this initiative, we'd like to create a new textual and video tutorials.\n+\n+### Improvements in the image directive\n+\n+We released the Angular [image directive](https://developer.chrome.com/blog/angular-image-directive/) as stable in v15. We introduced a new fill mode feature that enables images to fit within their parent container rather than having explicit dimensions. Currently, this feature is in [developer preview](https://angular.io/guide/releases#developer-preview). Next we'll be working on collecting feedback from developers before we promote fill mode as stable.\n+\n ## Future\n \n-### Explore hydration and server-side rendering usability improvements\n+### Token-based theming APIs\n+\n+To provide better customization of our Angular material components and enable Material 3 capabilities, we'll be collaborating with Google's Material Design team on defining token-based theming APIs.\n \n-As part of this effort we'll explore the problem space of hydration with server-side rendering, different approaches, and opportunities for Angular. As outcome of this project we'll have validation of the effort as well as a plan for action.\n+### Modernize Angular's unit testing experience\n+\n+In v12 we revisited the Angular end-to-end testing experience by replacing Protractor with modern alternatives such as Cypress, Nightwatch, and Webdriver.io. Next we'd like to tackle `ng test` to modernize Angular's unit testing experience.\n \n ### Revamp performance dashboards to detect regressions\n \n We have a set of benchmarks that we run against every code change to ensure Angular aligns with our performance standards.\n To ensure the runtime of the framework does not regress after a code change, we need to refine some of the existing infrastructure the dashboards step on.\n \n-### Leverage full framework capabilities with Zone.js opt-out\n-\n-We are going to design and implement a plan to make Zone.js optional from Angular applications.\n-This way, we simplify the framework, improve debugging, and reduce application bundle size.\n-Additionally, this lets us take advantage of built-in async/await syntax, which currently Zone.js does not support.\n-\n ### Improved build performance with ngc as a tsc plugin distribution\n \n Distributing the Angular compiler as a plugin of the TypeScript compiler will substantially improve build performance for developers and reduce maintenance costs.\n@@ -95,10 +93,6 @@ To encourage this practice, we will be working on more ergonomic code-splitting\n We want to ensure Angular developers are taking advantage of the latest capabilities of RxJS and have a smooth transition to the next major releases of the framework.\n For this purpose, we will explore and document the scope of the changes in v7 and beyond RxJS, and plan an update strategy.\n \n-### Introduce dependency injection debugging APIs\n-\n-To improve the debugging utilities of Angular and Angular DevTools, we'll work on APIs that provide access the dependency injection runtime. As part of the project we'll expose debugging methods that allow us to explore the injector hierarchy and the dependencies across their associated providers.\n-\n ### Support two-dimensional drag-and-drop\n \n As part of this project we'd like to implement mixed orientation support for the Angular CDK drag and drop. This is one of the most highly [requested features](https://github.com/angular/components/issues/13372) in the repository.\n@@ -114,6 +108,43 @@ As part of this project we'd like to implement mixed orientation support for the\n   </summary>\n   <div class=\"details-content\">\n \n+### Improve image performance\n+\n+*Completed Q4 2022*\n+\n+The [Aurora](https://web.dev/introducing-aurora/) and the Angular teams are working on the implementation of an image directive that aims to improve [Core Web Vitals](https://web.dev/vitals). We shipped a stable version of the image directive in v15.\n+\n+### Modern CSS\n+\n+*Completed Q4 2022*\n+\n+The Web ecosystem evolves constantly and we want to reflect the latest modern standards in Angular. In this project we aim to provide guidelines on using modern CSS features in Angular to ensure developers follow best practices for layout, styling, etc. We shared official guidelines for layout and as part of the initiative stopped publishing flex layout. Learn [more on our blog](https://blog.angular.io/modern-css-in-angular-layouts-4a259dca9127).\n+\n+### Support adding directives to host elements\n+\n+*Completed Q4 2022*\n+\n+A [long-standing feature request](https://github.com/angular/angular/issues/8785) is to add the ability to add directives to host elements. The feature lets developers augment their own components with additional behaviors without using inheritance. In v15 we shipped our directive composition API, which enables enhancing host elements with directives.\n+\n+### Better stack traces\n+\n+*Completed Q4 2022*\n+\n+The Angular and the Chrome DevTools are working together to enable more readable stack traces for error messages. In v15 we [released improved](https://twitter.com/angular/status/1578807563017392128) relevant and linked stack traces. As a lower priority initiative, we'll be exploring how to make the stack traces friendlier by providing more accurate call frame names for templates.\n+\n+### Enhanced Angular Material components by integrating MDC Web\n+\n+*Completed Q4 2022*\n+\n+[MDC Web](https://material.io/develop/web) is a library created by the Google Material Design team that provides reusable primitives for building Material Design components.\n+The Angular team is incorporating these primitives into Angular Material.\n+Using MDC Web aligns Angular Material more closely with the Material Design specification, expand accessibility, improve component quality, and improve the velocity of our team.\n+\n+### Implement APIs for optional NgModules\n+\n+*Completed Q4 2022*\n+\n+In the process of making Angular simpler, we are working on [introducing APIs](https://angular.io/guide/standalone-components) that allow developers to initialize applications, instantiate components, and use the router without NgModules. Angular v14 introduces developer preview of the APIs for standalone components, directives, and pipes. In the next few quarters we'll collect feedback from developers and finalize the project making the APIs stable. As the next step we will work on improving use cases such as `TestBed`, Angular elements, etc.\n \n ### Allow binding to protected fields in templates\n \n\n\n###\n\n", "completion": "docs: update roadmap as of q4 2022 (#<issue-num>)"}
{"prompt": " file path A: packages/platform-browser/animations/src/animation_renderer.ts | file path B: packages/platform-browser/animations/src/animation_renderer.ts\n\n@@ -50,7 +50,11 @@ export class AnimationRendererFactory implements RendererFactory2 {\n     if (!hostElement || !type || !type.data || !type.data['animation']) {\n       let renderer: BaseAnimationRenderer|undefined = this._rendererCache.get(delegate);\n       if (!renderer) {\n-        renderer = new BaseAnimationRenderer(EMPTY_NAMESPACE_ID, delegate, this.engine);\n+        // Ensure that the renderer is removed from the cache on destroy\n+        // since it may contain references to detached DOM nodes.\n+        const onRendererDestroy = () => this._rendererCache.delete(delegate);\n+        renderer =\n+            new BaseAnimationRenderer(EMPTY_NAMESPACE_ID, delegate, this.engine, onRendererDestroy);\n         // only cache this result when the base renderer is used\n         this._rendererCache.set(delegate, renderer);\n       }\n@@ -135,7 +139,8 @@ export class AnimationRendererFactory implements RendererFactory2 {\n \n export class BaseAnimationRenderer implements Renderer2 {\n   constructor(\n-      protected namespaceId: string, public delegate: Renderer2, public engine: AnimationEngine) {\n+      protected namespaceId: string, public delegate: Renderer2, public engine: AnimationEngine,\n+      private _onDestroy?: () => void) {\n     this.destroyNode = this.delegate.destroyNode ? (n) => delegate.destroyNode!(n) : null;\n   }\n \n@@ -148,6 +153,7 @@ export class BaseAnimationRenderer implements Renderer2 {\n   destroy(): void {\n     this.engine.destroy(this.namespaceId, this.delegate);\n     this.delegate.destroy();\n+    this._onDestroy?.();\n   }\n \n   createElement(name: string, namespace?: string|null|undefined) {\n@@ -237,8 +243,8 @@ export class BaseAnimationRenderer implements Renderer2 {\n export class AnimationRenderer extends BaseAnimationRenderer implements Renderer2 {\n   constructor(\n       public factory: AnimationRendererFactory, namespaceId: string, delegate: Renderer2,\n-      engine: AnimationEngine) {\n-    super(namespaceId, delegate, engine);\n+      engine: AnimationEngine, onDestroy?: () => void) {\n+    super(namespaceId, delegate, engine, onDestroy);\n     this.namespaceId = namespaceId;\n   }\n \n\n\n###\n\n", "completion": "perf(platform-browser): resolve memory leak when using animations with shadow DOM (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/standalone-components.md | file path B: aio/content/guide/standalone-components.md\n\n@@ -91,16 +91,29 @@ bootstrapApplication(PhotoAppComponent, {\n });\n ```\n \n-The standalone bootstrap operation is based on explicitly configuring a list of `Provider`s for dependency injection. However, existing libraries may rely on `NgModule`s for configuring DI. For example, Angular\u2019s router uses the `RouterModule.forRoot()` helper to set up routing in an application. You can use these existing `NgModule`s in `bootstrapApplication` via the `importProvidersFrom` utility:\n+The standalone bootstrap operation is based on explicitly configuring a list of `Provider`s for dependency injection. In Angular, `provide`-prefixed functions can be used to configure different systems without needing to import NgModules. For example, `provideRouter` is used in place of `RouterModule.forRoot` to configure the router:\n \n ```ts\n+bootstrapApplication(PhotoAppComponent, {\n+  providers: [\n+    {provide: BACKEND_URL, useValue: 'https://photoapp.looknongmodules.com/api'},\n+    provideRouter([/* app routes */]),\n+    // ...\n+  ]\n+});\n+```\n+\n+Many third party libraries have also been updated to support this `provide`-function configuration pattern. If a library only offers an NgModule API for its DI configuration, you can use the `importProvidersFrom` utility to still use it with `bootstrapApplication` and other standalone contexts:\n+\n+```ts\n+import {LibraryModule} from 'ngmodule-based-library';\n+\n bootstrapApplication(PhotoAppComponent, {\n   providers: [\n     {provide: BACKEND_URL, useValue: 'https://photoapp.looknongmodules.com/api'},\n     importProvidersFrom(\n-      RouterModule.forRoot([/* app routes */]),\n+      LibraryModule.forRoot()\n     ),\n-    // ...\n   ]\n });\n ```\n@@ -211,6 +224,8 @@ export const ADMIN_ROUTES: Route[] = [{\n \n Note the use of an empty-path route to host `providers` that are shared among all the child routes.\n \n+`importProvidersFrom` can be used to import existing NgModule-based DI configuration into route `providers` as well.\n+\n ## Advanced topics\n \n This section goes into more details that are relevant only to more advanced usage patterns. You can safely skip this section when learning about standalone components, directives, and pipes for the first time. \n\n\n###\n\n", "completion": "docs(core): update standalone docs for `provideRouter` (#<issue-num>)"}
{"prompt": " file path A: packages/bazel/src/ngc-wrapped/BUILD.bazel | file path B: packages/bazel/src/ngc-wrapped/BUILD.bazel\n\n@@ -9,7 +9,6 @@ ts_library(\n         \"index.ts\",\n     ],\n     module_name = \"@angular/bazel\",\n-    tsconfig = \":tsconfig.json\",\n     visibility = [\n         \"//packages/bazel:__pkg__\",\n         \"//packages/bazel/test/ngc-wrapped:__subpackages__\",\n\n---\n file path A: packages/bazel/src/ngc-wrapped/index.ts | file path B: packages/bazel/src/ngc-wrapped/index.ts\n\n@@ -46,7 +46,7 @@ const ALL_DEPS_COMPILED_WITH_BAZEL = false;\n \n const NODE_MODULES = 'node_modules/';\n \n-export async function main(args) {\n+export async function main(args: string[]) {\n   if (runAsWorker(args)) {\n     await runWorkerLoop(runOneBuild);\n   } else {\n@@ -112,6 +112,10 @@ export async function runOneBuild(\n     console.error(ng.formatDiagnostics(errors));\n     return false;\n   }\n+  if (parsedOptions === null) {\n+    console.error('Could not parse tsconfig. No parse diagnostics provided.');\n+    return false;\n+  }\n \n   const {bazelOpts, options: tsOptions, files, config} = parsedOptions;\n   const {errors: userErrors, options: userOptions} = ng.readConfiguration(project);\n@@ -145,17 +149,21 @@ export async function runOneBuild(\n                               obj[key] = value;\n \n                               return obj;\n-                            }, {});\n+                            }, {} as Record<string, unknown>);\n+\n+  // Angular Compiler options are always set under Bazel. See `ng_module.bzl`.\n+  const angularConfigRawOptions =\n+      (config as {angularCompilerOptions: AngularCompilerOptions})['angularCompilerOptions'];\n \n   const compilerOpts: AngularCompilerOptions = {\n     ...userOverrides,\n-    ...config['angularCompilerOptions'],\n+    ...angularConfigRawOptions,\n     ...tsOptions,\n   };\n \n   // These are options passed through from the `ng_module` rule which aren't supported\n   // by the `@angular/compiler-cli` and are only intended for `ngc-wrapped`.\n-  const {expectedOut, _useManifestPathsAsModuleName} = config['angularCompilerOptions'];\n+  const {expectedOut, _useManifestPathsAsModuleName} = angularConfigRawOptions;\n \n   const tsHost = ts.createCompilerHost(compilerOpts, true);\n   const {diagnostics} = compile({\n@@ -207,9 +215,15 @@ export function compile({\n         expectedOuts: string[],\n   gatherDiagnostics?: (program: Program) => readonly ts.Diagnostic[],\n   bazelHost?: CompilerHost, ng: CompilerCliModule,\n-}): {diagnostics: readonly ts.Diagnostic[], program: Program} {\n+}): {diagnostics: readonly ts.Diagnostic[], program: Program|undefined} {\n   let fileLoader: FileLoader;\n \n+  // These options are expected to be set in Bazel. See:\n+  // https://github.com/bazelbuild/rules_nodejs/blob/591e76edc9ee0a71d604c5999af8bad7909ef2d4/packages/concatjs/internal/common/tsconfig.bzl#L246.\n+  const baseUrl = compilerOpts.baseUrl!;\n+  const rootDir = compilerOpts.rootDir!;\n+  const rootDirs = compilerOpts.rootDirs!;\n+\n   if (bazelOpts.maxCacheSizeMb !== undefined) {\n     const maxCacheSizeBytes = bazelOpts.maxCacheSizeMb * (1 << 20);\n     fileCache.setMaxCacheSize(maxCacheSizeBytes);\n@@ -245,9 +259,8 @@ export function compile({\n   const originalWriteFile = tsHost.writeFile.bind(tsHost);\n   tsHost.writeFile =\n       (fileName: string, content: string, writeByteOrderMark: boolean,\n-       onError?: (message: string) => void, sourceFiles?: ts.SourceFile[]) => {\n-        const relative =\n-            relativeToRootDirs(convertToForwardSlashPath(fileName), [compilerOpts.rootDir]);\n+       onError?: (message: string) => void, sourceFiles?: readonly ts.SourceFile[]) => {\n+        const relative = relativeToRootDirs(convertToForwardSlashPath(fileName), [rootDir]);\n         if (expectedOutsSet.has(relative)) {\n           expectedOutsSet.delete(relative);\n           originalWriteFile(fileName, content, writeByteOrderMark, onError, sourceFiles);\n@@ -329,7 +342,7 @@ export function compile({\n     // However we still want to give it an AMD module name for devmode.\n     // We can't easily tell which file is the synthetic one, so we build up the path we expect\n     // it to have and compare against that.\n-    if (fileName === path.posix.join(compilerOpts.baseUrl, flatModuleOutPath)) return true;\n+    if (fileName === path.posix.join(baseUrl, flatModuleOutPath)) return true;\n \n     // Also handle the case the target is in an external repository.\n     // Pull the workspace name from the target which is formatted as `@wksp//package:target`\n@@ -338,8 +351,7 @@ export function compile({\n     const targetWorkspace = bazelOpts.target.split('/')[0].replace(/^@/, '');\n \n     if (targetWorkspace &&\n-        fileName ===\n-            path.posix.join(compilerOpts.baseUrl, 'external', targetWorkspace, flatModuleOutPath))\n+        fileName === path.posix.join(baseUrl, 'external', targetWorkspace, flatModuleOutPath))\n       return true;\n \n     return origBazelHostShouldNameModule(fileName) || NGC_GEN_FILES.test(fileName);\n@@ -347,11 +359,10 @@ export function compile({\n \n   const ngHost = ng.createCompilerHost({options: compilerOpts, tsHost: bazelHost});\n   patchNgHostWithFileNameToModuleName(\n-      ngHost, compilerOpts, bazelOpts, useManifestPathsAsModuleName);\n+      ngHost, compilerOpts, bazelOpts, rootDirs, !!useManifestPathsAsModuleName);\n \n   ngHost.toSummaryFileName = (fileName: string, referringSrcFileName: string) => path.posix.join(\n-      bazelOpts.workspaceName,\n-      relativeToRootDirs(fileName, compilerOpts.rootDirs).replace(EXT, ''));\n+      bazelOpts.workspaceName, relativeToRootDirs(fileName, rootDirs).replace(EXT, ''));\n   if (allDepsCompiledWithBazel) {\n     // Note: The default implementation would work as well,\n     // but we can be faster as we know how `toSummaryFileName` works.\n@@ -369,7 +380,7 @@ export function compile({\n     console.error('Check that it\\'s included in the `assets` attribute of the `ng_module` rule.\\n');\n   };\n \n-  const emitCallback: TsEmitCallback = ({\n+  const emitCallback: TsEmitCallback<tsickle.EmitResult> = ({\n     program,\n     targetSourceFile,\n     writeFile,\n@@ -378,7 +389,7 @@ export function compile({\n     customTransformers = {},\n   }) =>\n       tsickle.emitWithTsickle(\n-          program, bazelHost, bazelHost, compilerOpts, targetSourceFile, writeFile,\n+          program, bazelHost!, bazelHost!, compilerOpts, targetSourceFile, writeFile,\n           cancellationToken, emitOnlyDtsFiles, {\n             beforeTs: customTransformers.before,\n             afterTs: customTransformers.after,\n@@ -402,7 +413,7 @@ export function compile({\n   const hasError = diagnostics.some((diag) => diag.category === ts.DiagnosticCategory.Error);\n   if (!hasError) {\n     if (bazelOpts.tsickleGenerateExterns) {\n-      externs += tsickle.getGeneratedExterns(tsickleEmitResult.externs, compilerOpts.rootDir!);\n+      externs += tsickle.getGeneratedExterns(tsickleEmitResult.externs, rootDir);\n     }\n     if (bazelOpts.manifest) {\n       const manifest = constructManifest(tsickleEmitResult.modulesManifest, bazelHost);\n@@ -428,7 +439,7 @@ export function compile({\n   }\n \n   if (!compilerOpts.noEmit) {\n-    maybeWriteUnusedInputsList(program.getTsProgram(), compilerOpts, bazelOpts);\n+    maybeWriteUnusedInputsList(program.getTsProgram(), rootDir, bazelOpts);\n   }\n \n   return {program, diagnostics};\n@@ -442,10 +453,13 @@ export function compile({\n  * See https://bazel.build/contribute/codebase#input-discovery\n  */\n export function maybeWriteUnusedInputsList(\n-    program: ts.Program, options: ts.CompilerOptions, bazelOpts: BazelOptions) {\n+    program: ts.Program, rootDir: string, bazelOpts: BazelOptions) {\n   if (!bazelOpts?.unusedInputsListPath) {\n     return;\n   }\n+  if (bazelOpts.allowedInputs === undefined) {\n+    throw new Error('`unusedInputsListPath` is set, but no list of allowed inputs provided.');\n+  }\n \n   // ts.Program's getSourceFiles() gets populated by the sources actually\n   // loaded while the program is being built.\n@@ -472,8 +486,7 @@ export function maybeWriteUnusedInputsList(\n   // execroot directory.\n   // See https://docs.bazel.build/versions/main/output_directories.html\n   fs.writeFileSync(\n-      bazelOpts.unusedInputsListPath,\n-      unusedInputs.map(f => path.relative(options.rootDir!, f)).join('\\n'));\n+      bazelOpts.unusedInputsListPath, unusedInputs.map(f => path.relative(rootDir, f)).join('\\n'));\n }\n \n function isCompilationTarget(bazelOpts: BazelOptions, sf: ts.SourceFile): boolean {\n@@ -540,7 +553,7 @@ if (require.main === module) {\n  */\n export function patchNgHostWithFileNameToModuleName(\n     ngHost: NgCompilerHost, compilerOpts: CompilerOptions, bazelOpts: BazelOptions,\n-    useManifestPathsAsModuleName: boolean): void {\n+    rootDirs: string[], useManifestPathsAsModuleName: boolean): void {\n   const fileNameToModuleNameCache = new Map<string, string>();\n   ngHost.fileNameToModuleName = (importedFilePath: string, containingFilePath?: string) => {\n     const cacheKey = `${importedFilePath}:${containingFilePath}`;\n@@ -549,7 +562,7 @@ export function patchNgHostWithFileNameToModuleName(\n     // but when we don't run as a worker, there is no cache.\n     // For one example target in g3, we saw a cache hit rate of 7590/7695\n     if (fileNameToModuleNameCache.has(cacheKey)) {\n-      return fileNameToModuleNameCache.get(cacheKey);\n+      return fileNameToModuleNameCache.get(cacheKey)!;\n     }\n     const result = doFileNameToModuleName(importedFilePath, containingFilePath);\n     fileNameToModuleNameCache.set(cacheKey, result);\n@@ -557,8 +570,7 @@ export function patchNgHostWithFileNameToModuleName(\n   };\n \n   function doFileNameToModuleName(importedFilePath: string, containingFilePath?: string): string {\n-    const relativeTargetPath =\n-        relativeToRootDirs(importedFilePath, compilerOpts.rootDirs).replace(EXT, '');\n+    const relativeTargetPath = relativeToRootDirs(importedFilePath, rootDirs).replace(EXT, '');\n     const manifestTargetPath = `${bazelOpts.workspaceName}/${relativeTargetPath}`;\n     if (useManifestPathsAsModuleName === true) {\n       return manifestTargetPath;\n@@ -605,7 +617,10 @@ export function patchNgHostWithFileNameToModuleName(\n \n     if ((compilerOpts.module === ts.ModuleKind.UMD || compilerOpts.module === ts.ModuleKind.AMD) &&\n         ngHost.amdModuleName) {\n-      return ngHost.amdModuleName({fileName: importedFilePath} as ts.SourceFile);\n+      const amdName = ngHost.amdModuleName({fileName: importedFilePath} as ts.SourceFile);\n+      if (amdName !== undefined) {\n+        return amdName;\n+      }\n     }\n \n     // If no AMD module name has been set for the source file by the `@bazel/concatjs` compiler\n@@ -628,8 +643,7 @@ export function patchNgHostWithFileNameToModuleName(\n         containingFilePath == null || !bazelOpts.compilationTargetSrc.includes(importedFilePath)) {\n       return manifestTargetPath;\n     }\n-    const containingFileDir =\n-        path.dirname(relativeToRootDirs(containingFilePath, compilerOpts.rootDirs));\n+    const containingFileDir = path.dirname(relativeToRootDirs(containingFilePath, rootDirs));\n     const relativeImportPath = path.posix.relative(containingFileDir, relativeTargetPath);\n     return relativeImportPath.startsWith('.') ? relativeImportPath : `./${relativeImportPath}`;\n   }\n\n---\n file path A: packages/bazel/src/ngc-wrapped/tsconfig.json | file path B: None\n\n@@ -1,8 +0,0 @@\n-{\n-  \"compilerOptions\": {\n-    \"lib\": [\"es2015\"],\n-    \"types\": [\"node\"],\n-    \"esModuleInterop\": true,\n-    \"downlevelIteration\": true\n-  }\n-}\n\n---\n file path A: packages/tsconfig.json | file path B: packages/tsconfig.json\n\n@@ -19,39 +19,23 @@\n     \"noImplicitOverride\": true,\n     \"noFallthroughCasesInSwitch\": true,\n     \"paths\": {\n-      \"selenium-webdriver\": [\n-        \"./node_modules/@types/selenium-webdriver/index.d.ts\"\n-      ],\n-      \"rxjs/*\": [\n-        \"./node_modules/rxjs/*\"\n-      ],\n-      \"@angular/*\": [\n-        \"./packages/*\"\n-      ],\n-      \"zone.js/*\": [\n-        \"./packages/zone.js/*\"\n-      ],\n-      \"angular-in-memory-web-api\": [\n-        \"./packages/misc/angular-in-memory-web-api/index.ts\"\n-      ]\n+      \"selenium-webdriver\": [\"./node_modules/@types/selenium-webdriver/index.d.ts\"],\n+      \"rxjs/*\": [\"./node_modules/rxjs/*\"],\n+      \"@angular/*\": [\"./packages/*\"],\n+      \"zone.js/*\": [\"./packages/zone.js/*\"],\n+      \"angular-in-memory-web-api\": [\"./packages/misc/angular-in-memory-web-api/index.ts\"]\n     },\n     \"rootDir\": \".\",\n     \"inlineSourceMap\": true,\n-    \"lib\": [\n-      \"es2020\",\n-      \"dom\"\n-    ],\n+    \"lib\": [\"es2020\", \"dom\"],\n     \"skipDefaultLibCheck\": true,\n     \"skipLibCheck\": true,\n-    \"types\": [\n-      \"angular\"\n-    ]\n+    \"types\": [\"angular\"]\n   },\n   \"bazelOptions\": {\n     \"suppressTsconfigOverrideWarnings\": true\n   },\n   \"exclude\": [\n-    \"bazel\",\n     \"common/locales\",\n     \"compiler-cli/integrationtest\",\n     \"compiler-cli/test/compliance\",\n@@ -67,4 +51,4 @@\n     \"platform-server/integrationtest\",\n     \"router/test/aot_ngsummary_test\"\n   ]\n-}\n\\ No newline at end of file\n+}\n\n\n###\n\n", "completion": "refactor(bazel): enable typescript strictness flags for package (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/main.ts | file path B: packages/compiler-cli/src/main.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import ts from 'typescript';\n-import type {TsickleHost} from 'tsickle';\n+import type {TsickleHost, EmitResult as TsickleEmitResult} from 'tsickle';\n import yargs from 'yargs';\n import {exitCodeFromResult, formatDiagnostics, ParsedConfiguration, performCompilation, readConfiguration} from './perform_compile';\n import {createPerformWatchHost, performWatchCompilation} from './perform_watch';\n@@ -91,8 +91,8 @@ export function mainDiagnosticsForTest(\n   };\n }\n \n-function createEmitCallback(\n-    options: api.CompilerOptions, tsickle?: TsickleModule): api.TsEmitCallback|undefined {\n+function createEmitCallback(options: api.CompilerOptions, tsickle?: TsickleModule):\n+    api.TsEmitCallback<TsickleEmitResult>|undefined {\n   if (!options.annotateForClosureCompiler) {\n     return undefined;\n   }\n\n---\n file path A: packages/compiler-cli/src/ngtsc/program.ts | file path B: packages/compiler-cli/src/ngtsc/program.ts\n\n@@ -231,14 +231,8 @@ export class NgtscProgram implements api.Program {\n         this.options, ctx, resolve);\n   }\n \n-  emit(opts?: {\n-    emitFlags?: api.EmitFlags|undefined;\n-    forceEmit?: boolean;\n-    cancellationToken?: ts.CancellationToken | undefined;\n-    customTransformers?: api.CustomTransformers | undefined;\n-    emitCallback?: api.TsEmitCallback | undefined;\n-    mergeEmitResultsCallback?: api.TsMergeEmitResultsCallback | undefined;\n-  }|undefined): ts.EmitResult {\n+  emit<CbEmitRes extends ts.EmitResult>(opts?: api.EmitOptions<CbEmitRes>|\n+                                        undefined): ts.EmitResult {\n     // Check if emission of the i18n messages bundle was requested.\n     if (opts !== undefined && opts.emitFlags !== undefined &&\n         opts.emitFlags & api.EmitFlags.I18nBundle) {\n@@ -263,7 +257,8 @@ export class NgtscProgram implements api.Program {\n     const res = this.compiler.perfRecorder.inPhase(PerfPhase.TypeScriptEmit, () => {\n       const {transformers} = this.compiler.prepareEmit();\n       const ignoreFiles = this.compiler.ignoreForEmit;\n-      const emitCallback = opts && opts.emitCallback || defaultEmitCallback;\n+      const emitCallback =\n+          (opts?.emitCallback ?? defaultEmitCallback) as api.TsEmitCallback<CbEmitRes>;\n \n       const writeFile: ts.WriteFileCallback =\n           (fileName: string, data: string, writeByteOrderMark: boolean,\n@@ -291,7 +286,7 @@ export class NgtscProgram implements api.Program {\n         beforeTransforms.push(...customTransforms.beforeTs);\n       }\n \n-      const emitResults: ts.EmitResult[] = [];\n+      const emitResults: CbEmitRes[] = [];\n \n       for (const targetSourceFile of this.tsProgram.getSourceFiles()) {\n         if (targetSourceFile.isDeclarationFile || ignoreFiles.has(targetSourceFile)) {\n@@ -345,7 +340,7 @@ export class NgtscProgram implements api.Program {\n   }\n }\n \n-const defaultEmitCallback: api.TsEmitCallback = ({\n+const defaultEmitCallback: api.TsEmitCallback<ts.EmitResult> = ({\n   program,\n   targetSourceFile,\n   writeFile,\n\n---\n file path A: packages/compiler-cli/src/perform_compile.ts | file path B: packages/compiler-cli/src/perform_compile.ts\n\n@@ -208,7 +208,7 @@ export function exitCodeFromResult(diags: ReadonlyArray<ts.Diagnostic>|undefined\n   return diags.some(d => d.source === 'angular' && d.code === api.UNKNOWN_ERROR_CODE) ? 2 : 1;\n }\n \n-export function performCompilation({\n+export function performCompilation<CbEmitRes extends ts.EmitResult = ts.EmitResult>({\n   rootNames,\n   options,\n   host,\n@@ -225,8 +225,8 @@ export function performCompilation({\n   options: api.CompilerOptions,\n   host?: api.CompilerHost,\n   oldProgram?: api.Program,\n-  emitCallback?: api.TsEmitCallback,\n-  mergeEmitResultsCallback?: api.TsMergeEmitResultsCallback,\n+  emitCallback?: api.TsEmitCallback<CbEmitRes>,\n+  mergeEmitResultsCallback?: api.TsMergeEmitResultsCallback<CbEmitRes>,\n   gatherDiagnostics?: (program: api.Program) => ReadonlyArray<ts.Diagnostic>,\n   customTransformers?: api.CustomTransformers,\n   emitFlags?: api.EmitFlags,\n\n---\n file path A: packages/compiler-cli/src/perform_watch.ts | file path B: packages/compiler-cli/src/perform_watch.ts\n\n@@ -39,11 +39,11 @@ export enum FileChangeEvent {\n   CreateDeleteDir,\n }\n \n-export interface PerformWatchHost {\n+export interface PerformWatchHost<CbEmitRes extends ts.EmitResult = ts.EmitResult> {\n   reportDiagnostics(diagnostics: ReadonlyArray<ts.Diagnostic>): void;\n   readConfiguration(): ParsedConfiguration;\n   createCompilerHost(options: api.CompilerOptions): api.CompilerHost;\n-  createEmitCallback(options: api.CompilerOptions): api.TsEmitCallback|undefined;\n+  createEmitCallback(options: api.CompilerOptions): api.TsEmitCallback<CbEmitRes>|undefined;\n   onFileChange(\n       options: api.CompilerOptions, listener: (event: FileChangeEvent, fileName: string) => void,\n       ready: () => void): {close: () => void};\n@@ -51,11 +51,11 @@ export interface PerformWatchHost {\n   clearTimeout(timeoutId: any): void;\n }\n \n-export function createPerformWatchHost(\n+export function createPerformWatchHost<CbEmitRes extends ts.EmitResult = ts.EmitResult>(\n     configFileName: string, reportDiagnostics: (diagnostics: ReadonlyArray<ts.Diagnostic>) => void,\n     existingOptions?: ts.CompilerOptions,\n     createEmitCallback?: (options: api.CompilerOptions) =>\n-        api.TsEmitCallback | undefined): PerformWatchHost {\n+        api.TsEmitCallback<CbEmitRes>| undefined): PerformWatchHost {\n   return {\n     reportDiagnostics: reportDiagnostics,\n     createCompilerHost: options => createCompilerHost({options}),\n\n---\n file path A: packages/compiler-cli/src/transformers/api.ts | file path B: packages/compiler-cli/src/transformers/api.ts\n\n@@ -162,11 +162,11 @@ export interface TsEmitArguments {\n   customTransformers?: ts.CustomTransformers;\n }\n \n-export interface TsEmitCallback {\n-  (args: TsEmitArguments): ts.EmitResult;\n+export interface TsEmitCallback<T extends ts.EmitResult> {\n+  (args: TsEmitArguments): T;\n }\n-export interface TsMergeEmitResultsCallback {\n-  (results: ts.EmitResult[]): ts.EmitResult;\n+export interface TsMergeEmitResultsCallback<T extends ts.EmitResult> {\n+  (results: T[]): T;\n }\n \n export interface LazyRoute {\n@@ -175,6 +175,15 @@ export interface LazyRoute {\n   referencedModule: {name: string, filePath: string};\n }\n \n+export interface EmitOptions<CbEmitRes extends ts.EmitResult> {\n+  emitFlags?: EmitFlags;\n+  forceEmit?: boolean;\n+  cancellationToken?: ts.CancellationToken;\n+  customTransformers?: CustomTransformers;\n+  emitCallback?: TsEmitCallback<CbEmitRes>;\n+  mergeEmitResultsCallback?: TsMergeEmitResultsCallback<CbEmitRes>;\n+}\n+\n export interface Program {\n   /**\n    * Retrieve the TypeScript program used to produce semantic diagnostics and emit the sources.\n@@ -250,21 +259,7 @@ export interface Program {\n    *\n    * Angular structural information is required to emit files.\n    */\n-  emit({\n-    emitFlags,\n-    forceEmit,\n-    cancellationToken,\n-    customTransformers,\n-    emitCallback,\n-    mergeEmitResultsCallback,\n-  }?: {\n-    emitFlags?: EmitFlags,\n-    forceEmit?: boolean,\n-    cancellationToken?: ts.CancellationToken,\n-    customTransformers?: CustomTransformers,\n-    emitCallback?: TsEmitCallback,\n-    mergeEmitResultsCallback?: TsMergeEmitResultsCallback\n-  }): ts.EmitResult;\n+  emit<CbEmitRes extends ts.EmitResult>(opts?: EmitOptions<CbEmitRes>|undefined): ts.EmitResult;\n \n   /**\n    * @internal\n\n\n###\n\n", "completion": "refactor(compiler-cli): update `emit` signature to support for strongly typed `emitCallback` (#<issue-num>)"}
{"prompt": " file path A: aio/tools/transforms/templates/cli/cli-command.template.html | file path B: aio/tools/transforms/templates/cli/cli-command.template.html\n\n@@ -20,7 +20,7 @@\n     {% endif%}\n \n     {% if doc.subcommands.length %}\n-    <p>This command has the following <a href=\"#{$ doc.name $}-commands\">commands</a>:<p>\n+    <p>This command has the following <a href=\"#{$ doc.name $}-commands\">sub-commands</a>:<p>\n     <ul>\n       {% for subcommand in doc.subcommands %}\n       <li><a class=\"code-anchor\" href=\"#{$ subcommand.name $}-command\">{$ subcommand.name $}</a></li>\n\n\n###\n\n", "completion": "docs: improve grammer in CLI command template (#<issue-num>)"}
{"prompt": " file path A: packages/platform-server/src/transfer_state.ts | file path B: packages/platform-server/src/transfer_state.ts\n\n@@ -21,15 +21,20 @@ export const TRANSFER_STATE_SERIALIZATION_PROVIDERS: Provider[] = [{\n \n function serializeTransferStateFactory(doc: Document, appId: string, transferStore: TransferState) {\n   return () => {\n+    // The `.toJSON` here causes the `onSerialize` callbacks to be called.\n+    // These callbacks can be used to provide the value for a given key.\n+    const content = transferStore.toJson();\n+\n     if (transferStore.isEmpty) {\n       // The state is empty, nothing to transfer,\n       // avoid creating an extra `<script>` tag in this case.\n       return;\n     }\n+\n     const script = doc.createElement('script');\n     script.id = appId + '-state';\n     script.setAttribute('type', 'application/json');\n-    script.textContent = escapeHtml(transferStore.toJson());\n+    script.textContent = escapeHtml(content);\n     doc.body.appendChild(script);\n   };\n }\n\n---\n file path A: packages/platform-server/test/integration_spec.ts | file path B: packages/platform-server/test/integration_spec.ts\n\n@@ -10,10 +10,10 @@ import {animate, AnimationBuilder, state, style, transition, trigger} from '@ang\n import {DOCUMENT, isPlatformServer, PlatformLocation, \u0275getDOM as getDOM} from '@angular/common';\n import {HTTP_INTERCEPTORS, HttpClient, HttpClientModule, HttpEvent, HttpHandler, HttpInterceptor, HttpRequest} from '@angular/common/http';\n import {HttpClientTestingModule, HttpTestingController} from '@angular/common/http/testing';\n-import {ApplicationRef, CompilerFactory, Component, destroyPlatform, getPlatform, HostBinding, HostListener, importProvidersFrom, Inject, Injectable, Input, NgModule, NgZone, OnInit, PLATFORM_ID, PlatformRef, Type, ViewEncapsulation} from '@angular/core';\n+import {ApplicationRef, CompilerFactory, Component, destroyPlatform, getPlatform, HostListener, Inject, Injectable, Input, NgModule, NgZone, PLATFORM_ID, PlatformRef, ViewEncapsulation} from '@angular/core';\n import {inject, TestBed, waitForAsync} from '@angular/core/testing';\n-import {BrowserModule, makeStateKey, Title, TransferState} from '@angular/platform-browser';\n-import {BEFORE_APP_SERIALIZED, INITIAL_CONFIG, platformDynamicServer, PlatformState, renderModule, renderModuleFactory, ServerModule, ServerTransferStateModule} from '@angular/platform-server';\n+import {BrowserModule, Title} from '@angular/platform-browser';\n+import {BEFORE_APP_SERIALIZED, INITIAL_CONFIG, platformDynamicServer, PlatformState, renderModule, renderModuleFactory, ServerModule} from '@angular/platform-server';\n import {Observable} from 'rxjs';\n import {first} from 'rxjs/operators';\n \n@@ -389,19 +389,6 @@ const [MyHostComponentStandalone, _] = createFalseAttributesComponents(true);\n class FalseAttributesModule {\n }\n \n-@Component({selector: 'app', template: '<div [innerText]=\"foo\"></div>'})\n-class InnerTextComponent {\n-  foo = 'Some text';\n-}\n-\n-@NgModule({\n-  declarations: [InnerTextComponent],\n-  bootstrap: [InnerTextComponent],\n-  imports: [ServerModule, BrowserModule.withServerTransition({appId: 'inner-text'})]\n-})\n-class InnerTextModule {\n-}\n-\n function createMyInputComponent(standalone: boolean) {\n   @Component({\n     standalone,\n@@ -449,47 +436,6 @@ const HTMLTypesAppStandalone = createHTMLTypesApp(true);\n class HTMLTypesModule {\n }\n \n-const TEST_KEY = makeStateKey<number>('test');\n-const STRING_KEY = makeStateKey<string>('testString');\n-\n-@Component({selector: 'app', template: 'Works!'})\n-class TransferComponent {\n-  constructor(private transferStore: TransferState) {}\n-  ngOnInit() {\n-    this.transferStore.set(TEST_KEY, 10);\n-  }\n-}\n-\n-@Component({selector: 'esc-app', template: 'Works!'})\n-class EscapedComponent {\n-  constructor(private transferStore: TransferState) {}\n-  ngOnInit() {\n-    this.transferStore.set(STRING_KEY, '</script><script>alert(\\'Hello&\\' + \"World\");');\n-  }\n-}\n-\n-@NgModule({\n-  bootstrap: [TransferComponent],\n-  declarations: [TransferComponent],\n-  imports: [\n-    BrowserModule.withServerTransition({appId: 'transfer'}),\n-    ServerModule,\n-  ]\n-})\n-class TransferStoreModule {\n-}\n-\n-@NgModule({\n-  bootstrap: [EscapedComponent],\n-  declarations: [EscapedComponent],\n-  imports: [\n-    BrowserModule.withServerTransition({appId: 'transfer'}),\n-    ServerModule,\n-  ]\n-})\n-class EscapedTransferStoreModule {\n-}\n-\n function createMyHiddenComponent(standalone: boolean) {\n   @Component({\n     standalone,\n@@ -1310,50 +1256,5 @@ describe('platform-server integration', () => {\n       });\n     });\n   });\n-\n-  describe('ServerTransferStoreModule', () => {\n-    let called = false;\n-    const defaultExpectedOutput =\n-        '<html><head></head><body><app ng-version=\"0.0.0-PLACEHOLDER\" ng-server-context=\"other\">Works!</app><script id=\"transfer-state\" type=\"application/json\">{&q;test&q;:10}</script></body></html>';\n-\n-    beforeEach(() => {\n-      called = false;\n-    });\n-    afterEach(() => {\n-      expect(called).toBe(true);\n-    });\n-\n-    it('adds transfer script tag when using renderModule', waitForAsync(() => {\n-         renderModule(TransferStoreModule, {document: '<app></app>'}).then(output => {\n-           expect(output).toBe(defaultExpectedOutput);\n-           called = true;\n-         });\n-       }));\n-\n-    it('adds transfer script tag when using renderModuleFactory',\n-       waitForAsync(inject([PlatformRef], (defaultPlatform: PlatformRef) => {\n-         const compilerFactory: CompilerFactory =\n-             defaultPlatform.injector.get(CompilerFactory, null)!;\n-         const moduleFactory =\n-             compilerFactory.createCompiler().compileModuleSync(TransferStoreModule);\n-         renderModuleFactory(moduleFactory, {document: '<app></app>'}).then(output => {\n-           expect(output).toBe(defaultExpectedOutput);\n-           called = true;\n-         });\n-       })));\n-\n-    it('cannot break out of <script> tag in serialized output', waitForAsync(() => {\n-         renderModule(EscapedTransferStoreModule, {\n-           document: '<esc-app></esc-app>'\n-         }).then(output => {\n-           expect(output).toBe(\n-               '<html><head></head><body><esc-app ng-version=\"0.0.0-PLACEHOLDER\" ng-server-context=\"other\">Works!</esc-app>' +\n-               '<script id=\"transfer-state\" type=\"application/json\">' +\n-               '{&q;testString&q;:&q;&l;/script&g;&l;script&g;' +\n-               'alert(&s;Hello&a;&s; + \\\\&q;World\\\\&q;);&q;}</script></body></html>');\n-           called = true;\n-         });\n-       }));\n-  });\n });\n })();\n\n---\n file path A: None | file path B: packages/platform-server/test/transfer_state_spec.ts\n\n@@ -0,0 +1,86 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Component, NgModule,} from '@angular/core';\n+import {BrowserModule, makeStateKey, TransferState} from '@angular/platform-browser';\n+import {renderModule, ServerModule} from '@angular/platform-server';\n+\n+describe('transfer_state', () => {\n+  const defaultExpectedOutput =\n+      '<html><head></head><body><app ng-version=\"0.0.0-PLACEHOLDER\" ng-server-context=\"other\">Works!</app><script id=\"transfer-state\" type=\"application/json\">{&q;test&q;:10}</script></body></html>';\n+\n+  it('adds transfer script tag when using renderModule', async () => {\n+    const STATE_KEY = makeStateKey<number>('test');\n+\n+    @Component({selector: 'app', template: 'Works!'})\n+    class TransferComponent {\n+      constructor(private transferStore: TransferState) {\n+        this.transferStore.set(STATE_KEY, 10);\n+      }\n+    }\n+\n+    @NgModule({\n+      bootstrap: [TransferComponent],\n+      declarations: [TransferComponent],\n+      imports: [BrowserModule.withServerTransition({appId: 'transfer'}), ServerModule],\n+    })\n+    class TransferStoreModule {\n+    }\n+\n+    const output = await renderModule(TransferStoreModule, {document: '<app></app>'});\n+    expect(output).toBe(defaultExpectedOutput);\n+  });\n+\n+  it('cannot break out of <script> tag in serialized output', async () => {\n+    const STATE_KEY = makeStateKey<string>('testString');\n+\n+    @Component({selector: 'esc-app', template: 'Works!'})\n+    class EscapedComponent {\n+      constructor(private transferStore: TransferState) {\n+        this.transferStore.set(STATE_KEY, '</script><script>alert(\\'Hello&\\' + \"World\");');\n+      }\n+    }\n+    @NgModule({\n+      bootstrap: [EscapedComponent],\n+      declarations: [EscapedComponent],\n+      imports: [BrowserModule.withServerTransition({appId: 'transfer'}), ServerModule],\n+    })\n+    class EscapedTransferStoreModule {\n+    }\n+\n+    const output =\n+        await renderModule(EscapedTransferStoreModule, {document: '<esc-app></esc-app>'});\n+    expect(output).toBe(\n+        '<html><head></head><body><esc-app ng-version=\"0.0.0-PLACEHOLDER\" ng-server-context=\"other\">Works!</esc-app>' +\n+        '<script id=\"transfer-state\" type=\"application/json\">' +\n+        '{&q;testString&q;:&q;&l;/script&g;&l;script&g;' +\n+        'alert(&s;Hello&a;&s; + \\\\&q;World\\\\&q;);&q;}</script></body></html>');\n+  });\n+\n+  it('adds transfer script tag when setting state during onSerialize', async () => {\n+    const STATE_KEY = makeStateKey<number>('test');\n+\n+    @Component({selector: 'app', template: 'Works!'})\n+    class TransferComponent {\n+      constructor(private transferStore: TransferState) {\n+        this.transferStore.onSerialize(STATE_KEY, () => 10);\n+      }\n+    }\n+\n+    @NgModule({\n+      bootstrap: [TransferComponent],\n+      declarations: [TransferComponent],\n+      imports: [BrowserModule.withServerTransition({appId: 'transfer'}), ServerModule],\n+    })\n+    class TransferStoreModule {\n+    }\n+\n+    const output = await renderModule(TransferStoreModule, {document: '<app></app>'});\n+    expect(output).toBe(defaultExpectedOutput);\n+  });\n+});\n\n---\n file path A: packages/platform-server/testing/src/server.ts | file path B: packages/platform-server/testing/src/server.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {createPlatformFactory, NgModule, PlatformRef, StaticProvider} from '@angular/core';\n+import {createPlatformFactory, NgModule} from '@angular/core';\n import {BrowserDynamicTestingModule, \u0275platformCoreDynamicTesting as platformCoreDynamicTesting} from '@angular/platform-browser-dynamic/testing';\n import {NoopAnimationsModule} from '@angular/platform-browser/animations';\n import {\u0275INTERNAL_SERVER_PLATFORM_PROVIDERS as INTERNAL_SERVER_PLATFORM_PROVIDERS, \u0275SERVER_RENDER_PROVIDERS as SERVER_RENDER_PROVIDERS} from '@angular/platform-server';\n\n\n###\n\n", "completion": "fix(platform-server): call `onSerialize` when state is empty (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/deprecations.md | file path B: aio/content/guide/deprecations.md\n\n@@ -598,29 +598,13 @@ mockRequest.error(mockError);\n \n This section contains a complete list all of the currently deprecated CLI flags.\n \n-### &commat;angular/cli\n-\n-| API/Option        | May be removed in | Details |\n-|:---               |:---               |:---     |\n-| `--prod`          | <!--v12--> v14    | Use `--configuration production` instead. |\n-| `ng update --all` | <!--v11--> v14    | No longer has an effect.                  |\n-\n ### &commat;angular-devkit/build-angular\n \n | API/Option                 | May be removed in | Details |\n |:---                        |:---               |:---     |\n | `deployUrl`                | <!--v13--> v15    | Use `baseHref` option, `APP_BASE_HREF` DI token or a combination of both instead. For more information, see [the deploy url](guide/deployment#the-deploy-url). |\n-| `showCircularDependencies` | <!--v12--> v14    | The recommended method to detect circular dependencies in project code is to use either a lint rule or other external tooling.                                 |\n | Protractor builder         | <!--v12--> v14    | Deprecate as part of the Protractor deprecation.                                                                                                               |\n \n-### &commat;angular-devkit/build-optimizer\n-\n-The entire NPM package is deprecated.\n-It has always been experimental \\(never hit `1.0.0`\\) and has\n-been an internal package for the Angular CLI.\n-All the relevant functionality has been moved to\n-`@angular-devkit/build-angular`\n-\n <a id=\"removed\"></a>\n \n ## Removed APIs\n\n\n###\n\n", "completion": "docs: update CLI related deprecation information (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/core/index.md | file path B: goldens/public-api/core/index.md\n\n@@ -188,7 +188,7 @@ export interface Component extends Directive {\n     encapsulation?: ViewEncapsulation;\n     // @deprecated\n     entryComponents?: Array<Type<any> | any[]>;\n-    imports?: (Type<any> | any[])[];\n+    imports?: (Type<any> | ReadonlyArray<any>)[];\n     interpolation?: [string, string];\n     moduleId?: string;\n     preserveWhitespaces?: boolean;\n\n---\n file path A: packages/core/src/metadata/directives.ts | file path B: packages/core/src/metadata/directives.ts\n\n@@ -629,7 +629,7 @@ export interface Component extends Directive {\n    * More information about standalone components, directives, and pipes can be found in [this\n    * guide](guide/standalone-components).\n    */\n-  imports?: (Type<any>|any[])[];\n+  imports?: (Type<any>|ReadonlyArray<any>)[];\n \n   /**\n    * The set of schemas that declare elements to be allowed in a standalone component. Elements and\n\n---\n file path A: packages/core/test/acceptance/standalone_spec.ts | file path B: packages/core/test/acceptance/standalone_spec.ts\n\n@@ -152,7 +152,7 @@ describe('standalone components, directives, and pipes', () => {\n   });\n \n \n-  it('should render a standalone component with dependenices and ambient providers', () => {\n+  it('should render a standalone component with dependencies and ambient providers', () => {\n     @Component({\n       standalone: true,\n       template: 'Inner',\n@@ -453,6 +453,34 @@ describe('standalone components, directives, and pipes', () => {\n     expect(fixture.nativeElement.innerHTML).toBe('<div red=\"true\">blue</div>');\n   });\n \n+  it('should support readonly arrays in @Component.imports', () => {\n+    @Directive({selector: '[red]', standalone: true, host: {'[attr.red]': 'true'}})\n+    class RedIdDirective {\n+    }\n+\n+    @Pipe({name: 'blue', pure: true, standalone: true})\n+    class BluePipe implements PipeTransform {\n+      transform() {\n+        return 'blue';\n+      }\n+    }\n+\n+    const DirAndPipe = [RedIdDirective, BluePipe] as const;\n+\n+    @Component({\n+      selector: 'standalone',\n+      standalone: true,\n+      template: `<div red>{{'' | blue}}</div>`,\n+      imports: [DirAndPipe],\n+    })\n+    class TestComponent {\n+    }\n+\n+    const fixture = TestBed.createComponent(TestComponent);\n+    fixture.detectChanges();\n+    expect(fixture.nativeElement.innerHTML).toBe('<div red=\"true\">blue</div>');\n+  });\n+\n   it('should deduplicate declarations', () => {\n     @Component({selector: 'test-red', standalone: true, template: 'red(<ng-content></ng-content>)'})\n     class RedComponent {\n\n\n###\n\n", "completion": "fix(core): allow readonly arrays for standalone imports (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,22 @@\n+<a name=\"15.0.0-rc.1\"></a>\n+# 15.0.0-rc.1 (2022-10-26)\n+### common\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [3a18398d83](https://github.com/angular/angular/commit/3a18398d8303fb4ae1923b3a182e6abb92e3117b) | fix | Don't warn about image distortion is fill mode is enabled ([#47824](https://github.com/angular/angular/pull/47824)) |\n+### forms\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [a99d9d67f3](https://github.com/angular/angular/commit/a99d9d67f382c18b46c4c1c6765bbda445ca0b8c) | fix | don't mutate validators array ([#47830](https://github.com/angular/angular/pull/47830)) |\n+### platform-server\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [2908eba59c](https://github.com/angular/angular/commit/2908eba59c25e9a1fc5aa257b4a8a247db82079e) | fix | align server renderer interface with base renderer ([#47868](https://github.com/angular/angular/pull/47868)) |\n+## Special Thanks\n+Alan Agius, Alex Castle, Andrew Scott, Balaji, George Kalpakas, Kristiyan Kostadinov, Paul Gschwendtner, Pawel Kozlowski, WD Snoeijer, onrails and vyom1611\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"14.2.8\"></a>\n # 14.2.8 (2022-10-26)\n ## Special Thanks\n\n\n###\n\n", "completion": "docs: release notes for the v15.0.0-rc.1 release"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,10 @@\n+<a name=\"14.2.8\"></a>\n+# 14.2.8 (2022-10-26)\n+## Special Thanks\n+Andrew Scott, Balaji, Paul Gschwendtner, WD Snoeijer, onrails and vyom1611\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.0.0-rc.0\"></a>\n # 15.0.0-rc.0 (2022-10-19)\n ### common\n\n\n###\n\n", "completion": "docs: release notes for the v14.2.8 release"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -19,7 +19,7 @@\n     \"build-local\": \"yarn ~~build\",\n     \"prebuild-local-ci\": \"yarn setup-local-ci\",\n     \"build-local-ci\": \"yarn ~~build --progress=false\",\n-    \"extract-cli-command-docs\": \"node tools/transforms/cli-docs-package/extract-cli-commands.js 46cb32b90\",\n+    \"extract-cli-command-docs\": \"node tools/transforms/cli-docs-package/extract-cli-commands.js 23b229e89\",\n     \"lint\": \"yarn check-env && yarn docs-lint && ng lint && yarn example-lint && yarn tools-lint && yarn security-lint\",\n     \"test\": \"yarn check-env && ng test\",\n     \"test:bazel\": \"bazelisk test //aio:test\",\n\n\n###\n\n", "completion": "build(docs-infra): upgrade cli command docs sources to 23b229e89 (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/dev-infra.yml | file path B: .github/workflows/dev-infra.yml\n\n@@ -13,13 +13,13 @@ jobs:\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n-      - uses: angular/dev-infra/github-actions/commit-message-based-labels@bf6b1f3beb4017d91b58007e063aa5f09ebe0212\n+      - uses: angular/dev-infra/github-actions/commit-message-based-labels@d87b1b56a970132f90301624cea6b6d70b6d9489\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n   post_approval_changes:\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n-      - uses: angular/dev-infra/github-actions/post-approval-changes@bf6b1f3beb4017d91b58007e063aa5f09ebe0212\n+      - uses: angular/dev-infra/github-actions/post-approval-changes@d87b1b56a970132f90301624cea6b6d70b6d9489\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n---\n file path A: .github/workflows/feature-requests.yml | file path B: .github/workflows/feature-requests.yml\n\n@@ -14,6 +14,6 @@ jobs:\n     if: github.repository == 'angular/angular'\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: angular/dev-infra/github-actions/feature-request@bf6b1f3beb4017d91b58007e063aa5f09ebe0212\n+      - uses: angular/dev-infra/github-actions/feature-request@d87b1b56a970132f90301624cea6b6d70b6d9489\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n---\n file path A: .github/workflows/google-internal-tests.yml | file path B: .github/workflows/google-internal-tests.yml\n\n@@ -13,7 +13,7 @@ jobs:\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n-      - uses: angular/dev-infra/github-actions/google-internal-tests@bf6b1f3beb4017d91b58007e063aa5f09ebe0212\n+      - uses: angular/dev-infra/github-actions/google-internal-tests@d87b1b56a970132f90301624cea6b6d70b6d9489\n         with:\n           run-tests-guide-url: http://go/angular/g3sync\n           github-token: ${{ secrets.GITHUB_TOKEN }}\n\n---\n file path A: .github/workflows/lock-closed.yml | file path B: .github/workflows/lock-closed.yml\n\n@@ -14,6 +14,6 @@ jobs:\n     if: github.repository == 'angular/angular'\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: angular/dev-infra/github-actions/lock-closed@bf6b1f3beb4017d91b58007e063aa5f09ebe0212\n+      - uses: angular/dev-infra/github-actions/lock-closed@d87b1b56a970132f90301624cea6b6d70b6d9489\n         with:\n           lock-bot-key: ${{ secrets.LOCK_BOT_PRIVATE_KEY }}\n\n---\n file path A: .github/workflows/update-events.yml | file path B: .github/workflows/update-events.yml\n\n@@ -35,7 +35,7 @@ jobs:\n       - name: Generate `events.json`\n         run: node aio/scripts/generate-events/index.mjs --ignore-invalid-dates\n       - name: Create a PR (if necessary)\n-        uses: angular/dev-infra/github-actions/create-pr-for-changes@bf6b1f3beb4017d91b58007e063aa5f09ebe0212\n+        uses: angular/dev-infra/github-actions/create-pr-for-changes@d87b1b56a970132f90301624cea6b6d70b6d9489\n         with:\n           branch-prefix: docs-update-events\n           pr-title: 'docs: update events'\n\n---\n file path A: package.json | file path B: package.json\n\n@@ -179,8 +179,8 @@\n   },\n   \"// 2\": \"devDependencies are not used under Bazel. Many can be removed after test.sh is deleted.\",\n   \"devDependencies\": {\n-    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#faeeb54064fae2907c28ecd3cdca17a950433d64\",\n-    \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#fadde2b96ad66dd57221b99a91b256ad3745588a\",\n+    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#51f13a0f64d44abb406f1a79c0a9587d5c9a2182\",\n+    \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#60bcee1fbdce4933102f6b434c82079dd0be9af9\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n     \"@bazel/buildifier\": \"^5.0.0\",\n     \"@bazel/ibazel\": \"^0.16.0\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -150,14 +150,15 @@\n     \"@angular/core\" \"^13.0.0 || ^14.0.0-0\"\n     reflect-metadata \"^0.1.13\"\n \n-\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#faeeb54064fae2907c28ecd3cdca17a950433d64\":\n-  version \"0.0.0-bf6b1f3beb4017d91b58007e063aa5f09ebe0212\"\n-  uid faeeb54064fae2907c28ecd3cdca17a950433d64\n-  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#faeeb54064fae2907c28ecd3cdca17a950433d64\"\n+\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#51f13a0f64d44abb406f1a79c0a9587d5c9a2182\":\n+  version \"0.0.0-d87b1b56a970132f90301624cea6b6d70b6d9489\"\n+  uid \"51f13a0f64d44abb406f1a79c0a9587d5c9a2182\"\n+  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#51f13a0f64d44abb406f1a79c0a9587d5c9a2182\"\n   dependencies:\n     \"@angular-devkit/build-angular\" \"15.0.0-rc.0\"\n     \"@angular/benchpress\" \"0.3.0\"\n     \"@babel/core\" \"^7.16.0\"\n+    \"@babel/helper-annotate-as-pure\" \"^7.18.6\"\n     \"@bazel/buildifier\" \"5.1.0\"\n     \"@bazel/concatjs\" \"5.7.0\"\n     \"@bazel/esbuild\" \"5.7.0\"\n@@ -256,10 +257,10 @@\n   dependencies:\n     tslib \"^2.3.0\"\n \n-\"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#fadde2b96ad66dd57221b99a91b256ad3745588a\":\n-  version \"0.0.0-bf6b1f3beb4017d91b58007e063aa5f09ebe0212\"\n-  uid fadde2b96ad66dd57221b99a91b256ad3745588a\n-  resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#fadde2b96ad66dd57221b99a91b256ad3745588a\"\n+\"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#60bcee1fbdce4933102f6b434c82079dd0be9af9\":\n+  version \"0.0.0-d87b1b56a970132f90301624cea6b6d70b6d9489\"\n+  uid \"60bcee1fbdce4933102f6b434c82079dd0be9af9\"\n+  resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#60bcee1fbdce4933102f6b434c82079dd0be9af9\"\n   dependencies:\n     \"@yarnpkg/lockfile\" \"^1.1.0\"\n     typescript \"~4.8.0\"\n\n\n###\n\n", "completion": "build: update cross-repo angular dependencies (#<issue-num>)"}
{"prompt": " file path A: package.json | file path B: package.json\n\n@@ -68,14 +68,14 @@\n     \"@babel/template\": \"7.18.10\",\n     \"@babel/traverse\": \"7.19.4\",\n     \"@babel/types\": \"7.19.4\",\n-    \"@bazel/concatjs\": \"5.5.3\",\n-    \"@bazel/esbuild\": \"5.5.3\",\n-    \"@bazel/jasmine\": \"5.5.3\",\n-    \"@bazel/protractor\": \"5.5.3\",\n-    \"@bazel/rollup\": \"5.5.3\",\n-    \"@bazel/runfiles\": \"5.5.3\",\n-    \"@bazel/terser\": \"5.5.3\",\n-    \"@bazel/worker\": \"5.5.3\",\n+    \"@bazel/concatjs\": \"5.7.0\",\n+    \"@bazel/esbuild\": \"5.7.0\",\n+    \"@bazel/jasmine\": \"5.7.0\",\n+    \"@bazel/protractor\": \"5.7.0\",\n+    \"@bazel/rollup\": \"5.7.0\",\n+    \"@bazel/runfiles\": \"5.7.0\",\n+    \"@bazel/terser\": \"5.7.0\",\n+    \"@bazel/worker\": \"5.7.0\",\n     \"@microsoft/api-extractor\": \"^7.24.2\",\n     \"@rollup/plugin-babel\": \"^6.0.0\",\n     \"@rollup/plugin-commonjs\": \"^23.0.0\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -1625,15 +1625,6 @@\n   resolved \"https://registry.yarnpkg.com/@bazel/buildifier/-/buildifier-5.1.0.tgz#ae0b93c5d14b2b080d5a492a8bfee231101b5385\"\n   integrity sha512-gO0+//hkH+iE3AQ02mYttJAcWiE+rapP8IxmstDhwSqs+CmZJJI8Q1vAaIvMyJUT3NIf7lGljRNpzclkCPk89w==\n \n-\"@bazel/concatjs@5.5.3\":\n-  version \"5.5.3\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/concatjs/-/concatjs-5.5.3.tgz#5d5704db97d0014f700dbbd77ef4a4b3666ce865\"\n-  integrity sha512-YR8agkKikd/1pzFM9re5AFeFY6o8QA/C22RzVAYnZaKd7YMf19L7NchKKYwPTiDTy6lLhPqWMliYijR8RZ9ECA==\n-  dependencies:\n-    protobufjs \"6.8.8\"\n-    source-map-support \"0.5.9\"\n-    tsutils \"3.21.0\"\n-\n \"@bazel/concatjs@5.7.0\":\n   version \"5.7.0\"\n   resolved \"https://registry.yarnpkg.com/@bazel/concatjs/-/concatjs-5.7.0.tgz#ee9e2369ceabca7fdba9ee1539ddcdf0fc57a283\"\n@@ -1643,11 +1634,6 @@\n     source-map-support \"0.5.9\"\n     tsutils \"3.21.0\"\n \n-\"@bazel/esbuild@5.5.3\":\n-  version \"5.5.3\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/esbuild/-/esbuild-5.5.3.tgz#2172ecad5f5729d5d71c34a836b28cd081f84e6d\"\n-  integrity sha512-A+mVZfJsnTYc4dvrmGy/Sxu4pt2jvJFRFONP+ngve4qont3K1xK3LF3C6uOEFk4lMNoykUptr7/bvhGRr/j9Vw==\n-\n \"@bazel/esbuild@5.7.0\":\n   version \"5.7.0\"\n   resolved \"https://registry.yarnpkg.com/@bazel/esbuild/-/esbuild-5.7.0.tgz#8eb01e18994553f24e08df175fd43d0298bfc51d\"\n@@ -1658,46 +1644,31 @@\n   resolved \"https://registry.yarnpkg.com/@bazel/ibazel/-/ibazel-0.16.2.tgz#05dd7f06659759fda30f87b15534f1e42f1201bb\"\n   integrity sha512-KgqAWMH0emL6f3xH6nqyTryoBMqlJ627LBIe9PT1PRRQPz2FtHib3FIHJPukp1slzF3hJYZvdiVwgPnHbaSOOA==\n \n-\"@bazel/jasmine@5.5.3\":\n-  version \"5.5.3\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/jasmine/-/jasmine-5.5.3.tgz#90aa34218287ce1cc79e08274f4aa63460a4a1b2\"\n-  integrity sha512-dEgppnYPPot9c5EudnsaMKQHi8Su7rpKO5ENXWOqRxwuGCm1TvkyDvJghUbxpq9TpFqn7L39mJ+LB7IPYNF9TQ==\n+\"@bazel/jasmine@5.7.0\":\n+  version \"5.7.0\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/jasmine/-/jasmine-5.7.0.tgz#85b136f0e671e17d7907ab7bc725648c3267dc1d\"\n+  integrity sha512-ZUFyNk1PxMtbeQkF3JshuOpdEpNczKLP2es70Kp7oLZfPQ5DySpGX07utuM/o3gkawdZGVtRMFF+UbQa/wG5mA==\n   dependencies:\n     c8 \"~7.5.0\"\n     jasmine-reporters \"~2.5.0\"\n \n-\"@bazel/protractor@5.5.3\":\n-  version \"5.5.3\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/protractor/-/protractor-5.5.3.tgz#1c30b4b063b7c65809907ef8d08c0fa455449f9b\"\n-  integrity sha512-VvZ/WOVoZxuuMm+4ZQwDgY+Hl8ptcyteje9hORsrukhHOuTjYdxPfejtTRBdYi26dMggxx8mqaM4UzFD/XR/yA==\n-\n \"@bazel/protractor@5.7.0\":\n   version \"5.7.0\"\n   resolved \"https://registry.yarnpkg.com/@bazel/protractor/-/protractor-5.7.0.tgz#b367a5c24bad3dbfe833ab4747013cb741602130\"\n   integrity sha512-I5N9SFf5xY8XQyIiBRGKAsTn284+pRVWqdrtICk8KehPjcRjEX/sB78Tsw02XB3ZmMw7pIrofu2HPXlGftzQIg==\n \n-\"@bazel/rollup@5.5.3\":\n-  version \"5.5.3\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/rollup/-/rollup-5.5.3.tgz#f4e5a3101b7acd6fe5a448c1456c91a3b6c2a840\"\n-  integrity sha512-1P4DDNLBWLrKwNhS+1bp3Odrg8bhFGxDiq9/hfeezRnIuvc8o2ZTyCYbbUN2bN8cjH5hAfAOXvoq73cmE33ahQ==\n+\"@bazel/rollup@5.7.0\":\n+  version \"5.7.0\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/rollup/-/rollup-5.7.0.tgz#13ac4e739465ffd0898d5d5f821c03fc2d4e6f4d\"\n+  integrity sha512-v53T4uixMzFFRtjZ25T66OQBG9/eB/TU0/0ELSed77yiVwD+9APgK2U54vVCcDQB7y83uCi+xORpZxmET1OGqw==\n   dependencies:\n-    \"@bazel/worker\" \"5.5.3\"\n-\n-\"@bazel/runfiles@5.5.3\":\n-  version \"5.5.3\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/runfiles/-/runfiles-5.5.3.tgz#da394adc895f694e3075ba292009163c28b1ee7d\"\n-  integrity sha512-c/2vCJvcmNYhbcqwBrQPV3BSxCIETXCzuMsqEXgudOK5EL70/DtqSOQN1veJW/KUBoMljcxM7DN4gvWEItA2Dg==\n+    \"@bazel/worker\" \"5.7.0\"\n \n \"@bazel/runfiles@5.7.0\":\n   version \"5.7.0\"\n   resolved \"https://registry.yarnpkg.com/@bazel/runfiles/-/runfiles-5.7.0.tgz#e0ea75267808f78d0dedaff5e772e6a088250d8f\"\n   integrity sha512-BfmbGuMpqkBNtAmllCrl70YAHo6OrCtcGzakV6KMBUBXzeGl22qRWHFhDvoWgeMKTjhbcywMooPg2Udq9MoVfQ==\n \n-\"@bazel/terser@5.5.3\":\n-  version \"5.5.3\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/terser/-/terser-5.5.3.tgz#d8471bb2b2c2f81f31a13545c17090fb7de78208\"\n-  integrity sha512-4QNPwlGJk+fdL4gLIdMPB72XfKPbcvcWmnDBGvRB6TfdTXRt3+78AdZD5Q6Cw9U6Ov67sHRCXqtybWQnTCxF9g==\n-\n \"@bazel/terser@5.7.0\":\n   version \"5.7.0\"\n   resolved \"https://registry.yarnpkg.com/@bazel/terser/-/terser-5.7.0.tgz#0b47c950fd1f7355ba98eb013683d399f1f5f106\"\n@@ -1713,13 +1684,6 @@\n     source-map-support \"0.5.9\"\n     tsutils \"3.21.0\"\n \n-\"@bazel/worker@5.5.3\":\n-  version \"5.5.3\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/worker/-/worker-5.5.3.tgz#3c23135a4e9d6c8ef05f1de85bc3c0c30df2ad38\"\n-  integrity sha512-Wm0istBBko5w2ddDwCK4rvDQrWfeFGaWdG3iTNkYAHKfQrkgYeMucMoAbFB6LZ87KZKuBEN9KSDq+fi8MXtGlw==\n-  dependencies:\n-    google-protobuf \"^3.6.1\"\n-\n \"@bazel/worker@5.7.0\":\n   version \"5.7.0\"\n   resolved \"https://registry.yarnpkg.com/@bazel/worker/-/worker-5.7.0.tgz#d121261ee1833c5f5858f818f0e4d9a2d8e2c3c5\"\n\n\n###\n\n", "completion": "build: update bazel setup to v5.7.0 (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/dev-infra.yml | file path B: .github/workflows/dev-infra.yml\n\n@@ -13,13 +13,13 @@ jobs:\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n-      - uses: angular/dev-infra/github-actions/commit-message-based-labels@dcf4672ce6b29284a464804f1d12fd0c507a4e8c\n+      - uses: angular/dev-infra/github-actions/commit-message-based-labels@bf6b1f3beb4017d91b58007e063aa5f09ebe0212\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n   post_approval_changes:\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n-      - uses: angular/dev-infra/github-actions/post-approval-changes@dcf4672ce6b29284a464804f1d12fd0c507a4e8c\n+      - uses: angular/dev-infra/github-actions/post-approval-changes@bf6b1f3beb4017d91b58007e063aa5f09ebe0212\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n---\n file path A: .github/workflows/feature-requests.yml | file path B: .github/workflows/feature-requests.yml\n\n@@ -14,6 +14,6 @@ jobs:\n     if: github.repository == 'angular/angular'\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: angular/dev-infra/github-actions/feature-request@dcf4672ce6b29284a464804f1d12fd0c507a4e8c\n+      - uses: angular/dev-infra/github-actions/feature-request@bf6b1f3beb4017d91b58007e063aa5f09ebe0212\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n---\n file path A: .github/workflows/google-internal-tests.yml | file path B: .github/workflows/google-internal-tests.yml\n\n@@ -13,7 +13,7 @@ jobs:\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n-      - uses: angular/dev-infra/github-actions/google-internal-tests@dcf4672ce6b29284a464804f1d12fd0c507a4e8c\n+      - uses: angular/dev-infra/github-actions/google-internal-tests@bf6b1f3beb4017d91b58007e063aa5f09ebe0212\n         with:\n           run-tests-guide-url: http://go/angular/g3sync\n           github-token: ${{ secrets.GITHUB_TOKEN }}\n\n---\n file path A: .github/workflows/lock-closed.yml | file path B: .github/workflows/lock-closed.yml\n\n@@ -14,6 +14,6 @@ jobs:\n     if: github.repository == 'angular/angular'\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: angular/dev-infra/github-actions/lock-closed@dcf4672ce6b29284a464804f1d12fd0c507a4e8c\n+      - uses: angular/dev-infra/github-actions/lock-closed@bf6b1f3beb4017d91b58007e063aa5f09ebe0212\n         with:\n           lock-bot-key: ${{ secrets.LOCK_BOT_PRIVATE_KEY }}\n\n---\n file path A: .github/workflows/update-events.yml | file path B: .github/workflows/update-events.yml\n\n@@ -35,7 +35,7 @@ jobs:\n       - name: Generate `events.json`\n         run: node aio/scripts/generate-events/index.mjs --ignore-invalid-dates\n       - name: Create a PR (if necessary)\n-        uses: angular/dev-infra/github-actions/create-pr-for-changes@dcf4672ce6b29284a464804f1d12fd0c507a4e8c\n+        uses: angular/dev-infra/github-actions/create-pr-for-changes@bf6b1f3beb4017d91b58007e063aa5f09ebe0212\n         with:\n           branch-prefix: docs-update-events\n           pr-title: 'docs: update events'\n\n---\n file path A: package.json | file path B: package.json\n\n@@ -179,8 +179,8 @@\n   },\n   \"// 2\": \"devDependencies are not used under Bazel. Many can be removed after test.sh is deleted.\",\n   \"devDependencies\": {\n-    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#64bf4ec27deae3c017b08577672f20e0d824bf6b\",\n-    \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#007bfb0112c6d13b04d56acc8ada165b7ec1b652\",\n+    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#faeeb54064fae2907c28ecd3cdca17a950433d64\",\n+    \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#fadde2b96ad66dd57221b99a91b256ad3745588a\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n     \"@bazel/buildifier\": \"^5.0.0\",\n     \"@bazel/ibazel\": \"^0.16.0\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -150,10 +150,10 @@\n     \"@angular/core\" \"^13.0.0 || ^14.0.0-0\"\n     reflect-metadata \"^0.1.13\"\n \n-\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#64bf4ec27deae3c017b08577672f20e0d824bf6b\":\n-  version \"0.0.0-dcf4672ce6b29284a464804f1d12fd0c507a4e8c\"\n-  uid \"64bf4ec27deae3c017b08577672f20e0d824bf6b\"\n-  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#64bf4ec27deae3c017b08577672f20e0d824bf6b\"\n+\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#faeeb54064fae2907c28ecd3cdca17a950433d64\":\n+  version \"0.0.0-bf6b1f3beb4017d91b58007e063aa5f09ebe0212\"\n+  uid faeeb54064fae2907c28ecd3cdca17a950433d64\n+  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#faeeb54064fae2907c28ecd3cdca17a950433d64\"\n   dependencies:\n     \"@angular-devkit/build-angular\" \"15.0.0-rc.0\"\n     \"@angular/benchpress\" \"0.3.0\"\n@@ -256,10 +256,10 @@\n   dependencies:\n     tslib \"^2.3.0\"\n \n-\"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#007bfb0112c6d13b04d56acc8ada165b7ec1b652\":\n-  version \"0.0.0-dcf4672ce6b29284a464804f1d12fd0c507a4e8c\"\n-  uid \"007bfb0112c6d13b04d56acc8ada165b7ec1b652\"\n-  resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#007bfb0112c6d13b04d56acc8ada165b7ec1b652\"\n+\"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#fadde2b96ad66dd57221b99a91b256ad3745588a\":\n+  version \"0.0.0-bf6b1f3beb4017d91b58007e063aa5f09ebe0212\"\n+  uid fadde2b96ad66dd57221b99a91b256ad3745588a\n+  resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#fadde2b96ad66dd57221b99a91b256ad3745588a\"\n   dependencies:\n     \"@yarnpkg/lockfile\" \"^1.1.0\"\n     typescript \"~4.8.0\"\n\n\n###\n\n", "completion": "build: update cross-repo angular dependencies (#<issue-num>)"}
{"prompt": " file path A: packages/platform-server/src/server_renderer.ts | file path B: packages/platform-server/src/server_renderer.ts\n\n@@ -69,7 +69,7 @@ class DefaultServerRenderer2 implements Renderer2 {\n \n   destroyNode = null;\n \n-  createElement(name: string, namespace?: string, debugInfo?: any): any {\n+  createElement(name: string, namespace?: string): any {\n     if (namespace) {\n       const doc = this.document || getDOM().getDefaultDocument();\n       return doc.createElementNS(NAMESPACE_URIS[namespace], name);\n@@ -78,11 +78,11 @@ class DefaultServerRenderer2 implements Renderer2 {\n     return getDOM().createElement(name, this.document);\n   }\n \n-  createComment(value: string, debugInfo?: any): any {\n+  createComment(value: string): any {\n     return getDOM().getDefaultDocument().createComment(value);\n   }\n \n-  createText(value: string, debugInfo?: any): any {\n+  createText(value: string): any {\n     const doc = getDOM().getDefaultDocument();\n     return doc.createTextNode(value);\n   }\n@@ -105,18 +105,16 @@ class DefaultServerRenderer2 implements Renderer2 {\n     }\n   }\n \n-  selectRootElement(selectorOrNode: string|any, debugInfo?: any): any {\n-    let el: any;\n-    if (typeof selectorOrNode === 'string') {\n-      el = this.document.querySelector(selectorOrNode);\n-      if (!el) {\n-        throw new Error(`The selector \"${selectorOrNode}\" did not match any elements`);\n-      }\n-    } else {\n-      el = selectorOrNode;\n+  selectRootElement(selectorOrNode: string|any, preserveContent?: boolean): any {\n+    const el = typeof selectorOrNode === 'string' ? this.document.querySelector(selectorOrNode) :\n+                                                    selectorOrNode;\n+    if (!el) {\n+      throw new Error(`The selector \"${selectorOrNode}\" did not match any elements`);\n     }\n-    while (el.firstChild) {\n-      el.removeChild(el.firstChild);\n+    if (!preserveContent) {\n+      while (el.firstChild) {\n+        el.removeChild(el.firstChild);\n+      }\n     }\n     return el;\n   }\n@@ -271,7 +269,7 @@ class EmulatedEncapsulationServerRenderer2 extends DefaultServerRenderer2 {\n   }\n \n   override createElement(parent: any, name: string): Element {\n-    const el = super.createElement(parent, name, this.document);\n+    const el = super.createElement(parent, name);\n     super.setAttribute(el, this.contentAttr, '');\n     return el;\n   }\n\n\n###\n\n", "completion": "fix(platform-server): align server renderer interface with base renderer (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/getting-started/tsconfig.0.json | file path B: aio/content/examples/getting-started/tsconfig.0.json\n\n@@ -1,28 +1,37 @@\n // This tsconfig is used in the TypeScript\n-// configuration guide (../guide/typescript-configuration.md) \n+// configuration guide (../guide/typescript-configuration.md)\n // to display the latest default configuration\n // Note: Update with every major release to the latest default\n // #docregion\n+/* To learn more about this file see: https://angular.io/config/tsconfig. */\n {\n   \"compileOnSave\": false,\n   \"compilerOptions\": {\n     \"baseUrl\": \"./\",\n-    \"outDir\": \"./dist/out-tsc\",\n+    \"forceConsistentCasingInFileNames\": true,\n+    \"strict\": true,\n+    \"noImplicitOverride\": true,\n+    \"noPropertyAccessFromIndexSignature\": true,\n+    \"noImplicitReturns\": true,\n+    \"noFallthroughCasesInSwitch\": true,\n     \"sourceMap\": true,\n     \"declaration\": false,\n-    \"module\": \"esnext\",\n-    \"moduleResolution\": \"node\",\n+    \"downlevelIteration\": true,\n     \"experimentalDecorators\": true,\n+    \"moduleResolution\": \"node\",\n     \"importHelpers\": true,\n-    \"target\": \"es2015\",\n-    \"typeRoots\": [\n-      \"node_modules/@types\"\n-    ],\n-// #docregion lib    \n+    \"target\": \"ES2022\",\n+    \"module\": \"ES2022\",\n+    \"useDefineForClassFields\": false,\n     \"lib\": [\n-      \"es2018\",\n+      \"ES2022\",\n       \"dom\"\n     ]\n-// #enddocregion lib\n+  },\n+  \"angularCompilerOptions\": {\n+    \"enableI18nLegacyMessageIdFormat\": false,\n+    \"strictInjectionParameters\": true,\n+    \"strictInputAccessModifiers\": true,\n+    \"strictTemplates\": true\n   }\n }\n\n---\n file path A: aio/content/guide/build.md | file path B: aio/content/guide/build.md\n\n@@ -305,7 +305,7 @@ To disable these warnings, add the CommonJS module name to `allowedCommonJsDepen\n \n The Angular CLI uses [Browserslist](https://github.com/browserslist/browserslist) to ensure compatibility with different browser versions. [Autoprefixer](https://github.com/postcss/autoprefixer) is used for CSS vendor prefixing and [@babel/preset-env](https://babeljs.io/docs/en/babel-preset-env) for JavaScript syntax transformations.\n \n-Internally, the Angular CLI uses the below `browserslist` configuration which matches the [browsers that are supported by Angular](guide/browser-support).\n+Internally, the Angular CLI uses the below `browserslist` configuration which matches the [browsers that are supported](guide/browser-support) by Angular.\n \n   <code-example format=\"none\" language=\"text\">\n   last 1 Chrome version\n@@ -317,9 +317,6 @@ Internally, the Angular CLI uses the below `browserslist` configuration which ma\n   </code-example>\n \n \n-The CLI uses [Autoprefixer](https://github.com/postcss/autoprefixer) to ensure compatibility with different browser and browser versions.\n-You might find it necessary to target specific browsers or exclude certain browser versions from your build.\n-\n To override the internal configuration, add a new file named `.browserslistrc`, to the project directory, that specifies the browsers you want to support:\n \n   <code-example format=\"none\" language=\"text\">\n@@ -330,7 +327,9 @@ To override the internal configuration, add a new file named `.browserslistrc`,\n See the [browserslist repository](https://github.com/browserslist/browserslist) for more examples of how to target specific browsers and versions.\n \n <div class=\"alert is-helpful\">\n+\n Use [browsersl.ist](https://browsersl.ist) to display compatible browsers for a `browserslist` query.\n+\n </div>\n \n <a id=\"proxy\"></a>\n\n---\n file path A: aio/content/guide/typescript-configuration.md | file path B: aio/content/guide/typescript-configuration.md\n\n@@ -32,34 +32,14 @@ For more information, see the [Configuration inheritance with extends](https://w\n \n <div class=\"alert is-helpful\">\n \n-For more information TypeScript configuration files, see the official [TypeScript wiki](https://www.typescriptlang.org/docs/handbook/tsconfig-json.html).\n+For more information TypeScript configuration files, see the official [TypeScript handbook](https://www.typescriptlang.org/docs/handbook/tsconfig-json.html).\n For details about configuration inheritance, see the [Configuration inheritance with extends](https://www.typescriptlang.org/docs/handbook/tsconfig-json.html#configuration-inheritance-with-extends) section.\n \n </div>\n \n The initial `tsconfig.json` for an Angular workspace typically looks like the following example.\n \n-<code-example lang=\"json\" header=\"tsconfig.json\" linenums=\"false\">\n-{\n-  \"compileOnSave\": false,\n-  \"compilerOptions\": {\n-    \"baseUrl\": \"./\",\n-    \"outDir\": \"./dist/out-tsc\",\n-    \"sourceMap\": true,\n-    \"declaration\": false,\n-    \"downlevelIteration\": true,\n-    \"experimentalDecorators\": true,\n-    \"moduleResolution\": \"node\",\n-    \"importHelpers\": true,\n-    \"target\": \"es2015\",\n-    \"module\": \"es2020\",\n-    \"lib\": [\n-      \"es2018\",\n-      \"dom\"\n-    ]\n-  }\n-}\n-</code-example>\n+<code-example header=\"tsconfig.json\" path=\"getting-started/tsconfig.0.json\"></code-example>\n \n <a id=\"noImplicitAny\"></a>\n \n@@ -116,17 +96,12 @@ Angular packages include them already.\n \n </div>\n \n-### `lib.d.ts`\n-\n-TypeScript includes a special declaration file called `lib.d.ts`.\n-This file contains the ambient declarations for various common JavaScript constructs present in JavaScript runtimes and the DOM.\n-\n-Based on the `--target`, TypeScript adds *additional* ambient declarations like `Promise` if the target is `es6`.\n+### `lib`\n \n-By default, the target is `es2015`.\n-If you are targeting `es5`, you still have newer type declarations due to the list of declaration files included:\n+TypeScript includes a default set of declaration files.\n+These files contain the ambient declarations for various common JavaScript constructs present in JavaScript runtimes and the DOM.\n \n-<code-example header=\"tsconfig.json (lib excerpt)\" path=\"getting-started/tsconfig.0.json\" region=\"lib\"></code-example>\n+For more information, see [lib](https://www.typescriptlang.org/tsconfig#lib) in the TypeScript guide.\n \n ### Installable typings files\n \n@@ -148,7 +123,8 @@ For instance, to install typings for `chai` you run `npm install @types/chai --s\n \n ### `target`\n \n-By default, the target is `es2020`, which is supported in modern browsers.\n+By default, the target is `ES2022`. To control ECMA syntax use the [Browserslist](https://github.com/browserslist/browserslist) configuration file.\n+For more information, see the [configuring browser compatibility](/guide/build#configuring-browser-compatibility) guide.\n \n <!-- links -->\n \n@@ -156,4 +132,4 @@ By default, the target is `es2020`, which is supported in modern browsers.\n \n <!-- end links -->\n \n-@reviewed 2022-02-28\n+@reviewed 2022-10-24\n\n\n###\n\n", "completion": "docs: update typescript configuration (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/build.md | file path B: aio/content/guide/build.md\n\n@@ -303,35 +303,35 @@ To disable these warnings, add the CommonJS module name to `allowedCommonJsDepen\n \n ## Configuring browser compatibility\n \n-The CLI uses [Autoprefixer](https://github.com/postcss/autoprefixer) to ensure compatibility with different browser and browser versions.\n-You might find it necessary to target specific browsers or exclude certain browser versions from your build.\n+The Angular CLI uses [Browserslist](https://github.com/browserslist/browserslist) to ensure compatibility with different browser versions. [Autoprefixer](https://github.com/postcss/autoprefixer) is used for CSS vendor prefixing and [@babel/preset-env](https://babeljs.io/docs/en/babel-preset-env) for JavaScript syntax transformations.\n \n-Internally, Autoprefixer relies on a library called [Browserslist](https://github.com/browserslist/browserslist) to figure out which browsers to support with prefixing.\n-Browserslist looks for configuration options in a `browserslist` property of the package configuration file, or in a configuration file named `.browserslistrc`.\n-Autoprefixer looks for the `browserslist` configuration when it prefixes your CSS.\n+Internally, the Angular CLI uses the below `browserslist` configuration which matches the [browsers that are supported by Angular](guide/browser-support).\n \n-*   Tell Autoprefixer what browsers to target by adding a browserslist property to the package configuration file, `package.json`:\n+  <code-example format=\"none\" language=\"text\">\n+  last 1 Chrome version\n+  last 1 Firefox version\n+  last 2 Edge major versions\n+  last 2 Safari major versions\n+  last 2 iOS major versions\n+  Firefox ESR\n+  </code-example>\n \n-    <code-example format=\"json\" language=\"json\">\n-\n-    \"browserslist\": [\n-      \"&gt; 1%\",\n-      \"last 2 versions\"\n-    ]\n \n-    </code-example>\n+The CLI uses [Autoprefixer](https://github.com/postcss/autoprefixer) to ensure compatibility with different browser and browser versions.\n+You might find it necessary to target specific browsers or exclude certain browser versions from your build.\n \n-*   Alternatively, you can add a new file, `.browserslistrc`, to the project directory, that specifies browsers you want to support:\n+To override the internal configuration, add a new file named `.browserslistrc`, to the project directory, that specifies the browsers you want to support:\n \n-    <code-example format=\"none\" language=\"text\">\n+  <code-example format=\"none\" language=\"text\">\n+  last 1 Chrome version\n+  last 1 Firefox version\n+  </code-example>\n \n-    &num;&num;&num; Supported Browsers\n-    &gt; 1%\n-    last 2 versions\n+See the [browserslist repository](https://github.com/browserslist/browserslist) for more examples of how to target specific browsers and versions.\n \n-    </code-example>\n-\n-See the [browserslist repo](https://github.com/browserslist/browserslist) for more examples of how to target specific browsers and versions.\n+<div class=\"alert is-helpful\">\n+Use [browsersl.ist](https://browsersl.ist) to display compatible browsers for a `browserslist` query.\n+</div>\n \n <a id=\"proxy\"></a>\n \n@@ -547,16 +547,10 @@ module.exports = setupForCorporateProxy(proxyConfig);\n \n </code-example>\n \n-<a id=\"browser-compat\"></a>\n-\n-## Configuring browser compatibility\n-\n-See [browser support guide](guide/browser-support).\n-\n <!-- links -->\n \n <!-- external links -->\n \n <!-- end links -->\n \n-@reviewed 2022-02-28\n+@reviewed 2022-10-24\n\n\n###\n\n", "completion": "docs: update configuring browser compatibility (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/file-structure.md | file path B: aio/content/guide/file-structure.md\n\n@@ -72,13 +72,10 @@ Subfolders contain the application source and application-specific configuration\n |:---                       |:---                                                                                                                                                                                                                                                                                                                                                        |\n | `app/`                    | Contains the component files in which your application logic and data are defined. See details [below](#app-src).                                                                                                                                                                                                                                          |\n | `assets/`                 | Contains image and other asset files to be copied as-is when you build your application.                                                                                                                                                                                                                                                                   |\n-| `environments/`           | Contains build configuration options for particular target environments. By default there is an unnamed standard development environment and a production \\(\"prod\"\\) environment. You can define additional target environment configurations.                                                                                                             |\n | `favicon.ico`             | An icon to use for this application in the bookmark bar.                                                                                                                                                                                                                                                                                                   |\n | `index.html`              | The main HTML page that is served when someone visits your site. The CLI automatically adds all JavaScript and CSS files when building your app, so you typically don't need to add any `<script>` or` <link>` tags here manually.                                                                                                                         |\n | `main.ts`                 | The main entry point for your application. Compiles the application with the [JIT compiler](guide/glossary#jit) and bootstraps the application's root module \\(AppModule\\) to run in the browser. You can also use the [AOT compiler](guide/aot-compiler) without changing any code by appending the `--aot` flag to the CLI `build` and `serve` commands. |\n-| `polyfills.ts`            | Provides polyfill scripts for browser support.                                                                                                                                                                                                                                                                                                             |\n | `styles.sass`             | Lists CSS files that supply styles for a project. The extension reflects the style preprocessor you have configured for the project.                                                                                                                                                                                                                       |\n-| `test.ts`                 | The main entry point for your unit tests, with some Angular-specific configuration. You don't typically need to edit this file.                                                                                                                                                                                                                            |\n \n <div class=\"alert is-helpful\">\n \n@@ -110,8 +107,6 @@ Project-specific [TypeScript](https://www.typescriptlang.org) configuration file\n \n | Application-specific configuration files | Purpose                                                                                                                                                                                                                                                                      |\n |:---                                      |:---                                                                                                                                                                                                                                                                          |\n-| `.browserslistrc`                        | Configures sharing of target browsers and Node.js versions among various front-end tools. See [Browserslist on GitHub](https://github.com/browserslist/browserslist) for more information.                                                                                   |\n-| `karma.conf.js`                          | Application-specific [Karma](https://karma-runner.github.io/2.0/config/configuration-file.html) configuration.                                                                                                                                                               |\n | `tsconfig.app.json`                      | Application-specific [TypeScript](https://www.typescriptlang.org) configuration, including TypeScript and Angular template compiler options. See [TypeScript Configuration](guide/typescript-configuration) and [Angular Compiler Options](guide/angular-compiler-options). |\n | `tsconfig.spec.json`                     | [TypeScript](https://www.typescriptlang.org) configuration for the application tests. See [TypeScript Configuration](guide/typescript-configuration).                                                                                                                       |\n \n@@ -129,7 +124,7 @@ The following command creates a workspace with all of the workspace-wide configu\n \n <code-example format=\"shell\" language=\"shell\">\n \n-ng new my-workspace --create-application false\n+ng new my-workspace --no-create-application\n \n </code-example>\n \n@@ -198,9 +193,7 @@ Under the `projects/` folder, the `my-lib` folder contains your library code.\n | Library source files     | Purpose                                                                                                                                                                                                   |\n |:---                      |:---                                                                                                                                                                                                       |\n | `src/lib`                |  Contains your library project's logic and data. Like an application project, a library project can contain components, services, modules, directives, and pipes.                                         |\n-| `src/test.ts`            | The main entry point for your unit tests, with some library-specific configuration. You don't typically need to edit this file.                                                                           |\n | `src/public-api.ts`      | Specifies all files that are exported from your library.                                                                                                                                                  |\n-| `karma.conf.js`          | Library-specific [Karma](https://karma-runner.github.io/2.0/config/configuration-file.html) configuration.                                                                                                |\n | `ng-package.json`        | Configuration file used by [ng-packagr](https://github.com/ng-packagr/ng-packagr) for building your library.                                                                                              |\n | `package.json`           | Configures [npm package dependencies](guide/npm-packages) that are required for this library.                                                                                                             |\n | `tsconfig.lib.json`      | Library-specific [TypeScript](https://www.typescriptlang.org) configuration, including TypeScript and Angular template compiler options. See [TypeScript Configuration](guide/typescript-configuration). |\n@@ -213,4 +206,4 @@ Under the `projects/` folder, the `my-lib` folder contains your library code.\n \n <!-- end links -->\n \n-@reviewed 2022-02-28\n+@reviewed 2022-10-24\n\n\n###\n\n", "completion": "docs: update projects file structure (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/service-worker-getting-started.md | file path B: aio/content/guide/service-worker-getting-started.md\n\n@@ -45,21 +45,6 @@ The CLI project is now set up to use the Angular service worker.\n This section demonstrates a service worker in action,\n using an example application.\n \n-### Serving with `http-server`\n-\n-Because `ng serve` does not work with service workers, you must use a separate HTTP server to test your project locally.\n-Use any HTTP server.\n-The following example uses the [http-server](https://www.npmjs.com/package/http-server) package from npm.\n-To reduce the possibility of conflicts and avoid serving stale content, test on a dedicated port and disable caching.\n-\n-To serve the directory containing your web files with `http-server`, run the following command:\n-\n-<code-example format=\"shell\" language=\"shell\">\n-\n-http-server -p 8080 -c-1 dist/&lt;project-name&gt;\n-\n-</code-example>\n-\n ### Initial load\n \n With the server running, point your browser at `http://localhost:8080`.\n\n\n###\n\n", "completion": "docs: removing http-server section in Service worker tour (#<issue-num>)"}
{"prompt": " file path A: .vscode/recommended-launch.json | file path B: .vscode/recommended-launch.json\n\n@@ -16,7 +16,7 @@\n       \"remoteRoot\": \"${workspaceRoot}\",\n       \"stopOnEntry\": false,\n       \"timeout\": 600000,\n-      \"outFiles\": [\"${workspaceFolder}/bazel-out/**/angular/**/*.js\"],\n+      \"outFiles\": [\"${workspaceFolder}/dist/out/**/packages/**/*.js\"]\n     },\n     {\n       \"name\": \"Attach to bazel test ... --config=debug (no source maps)\",\n@@ -30,58 +30,46 @@\n       \"remoteRoot\": \"${workspaceRoot}\",\n       \"stopOnEntry\": false,\n       \"timeout\": 600000,\n-      \"outFiles\": [\"${workspaceFolder}/bazel-out/**/angular/**/*.js\"],\n+      \"outFiles\": [\"${workspaceFolder}/dist/out/**/packages/**/*.js\"]\n     },\n     {\n       \"name\": \"IVY:packages/core/test/acceptance\",\n       \"type\": \"node\",\n       \"request\": \"launch\",\n       \"program\": \"${workspaceFolder}/node_modules/.bin/bazelisk\",\n-      \"args\": [\n-        \"test\",\n-        \"packages/core/test/acceptance\",\n-        \"--config=debug\"\n-      ],\n+      \"args\": [\"test\", \"packages/core/test/acceptance\", \"--config=debug\"],\n       \"port\": 9229,\n       \"address\": \"localhost\",\n       \"restart\": true,\n       \"sourceMaps\": true,\n       \"timeout\": 600000,\n-      \"outFiles\": [\"${workspaceFolder}/bazel-out/**/angular/**/*.js\"],\n+      \"outFiles\": [\"${workspaceFolder}/dist/out/**/packages/**/*.js\"]\n     },\n     {\n       \"name\": \"IVY:packages/core/test/render3\",\n       \"type\": \"node\",\n       \"request\": \"launch\",\n       \"program\": \"${workspaceFolder}/node_modules/.bin/bazelisk\",\n-      \"args\": [\n-        \"test\",\n-        \"packages/core/test/render3\",\n-        \"--config=debug\"\n-      ],\n+      \"args\": [\"test\", \"packages/core/test/render3\", \"--config=debug\"],\n       \"port\": 9229,\n       \"address\": \"localhost\",\n       \"restart\": true,\n       \"sourceMaps\": true,\n       \"timeout\": 600000,\n-      \"outFiles\": [\"${workspaceFolder}/bazel-out/**/angular/**/*.js\"],\n+      \"outFiles\": [\"${workspaceFolder}/dist/out/**/packages/**/*.js\"]\n     },\n     {\n       \"name\": \"IVY:packages/core/test\",\n       \"type\": \"node\",\n       \"request\": \"launch\",\n       \"program\": \"${workspaceFolder}/node_modules/.bin/bazelisk\",\n-      \"args\": [\n-        \"test\",\n-        \"packages/core/test\",\n-        \"--config=debug\"\n-      ],\n+      \"args\": [\"test\", \"packages/core/test\", \"--config=debug\"],\n       \"port\": 9229,\n       \"address\": \"localhost\",\n       \"restart\": true,\n       \"sourceMaps\": true,\n       \"timeout\": 600000,\n-      \"outFiles\": [\"${workspaceFolder}/bazel-out/**/angular/**/*.js\"],\n-    },\n+      \"outFiles\": [\"${workspaceFolder}/dist/out/**/packages/**/*.js\"]\n+    }\n   ]\n }\n\n\n###\n\n", "completion": "build: update recommended launch vscode config to use proper bazel dist path (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/schematics.md | file path B: aio/content/guide/schematics.md\n\n@@ -16,8 +16,8 @@ You can modify these schematics, and define new ones to do things like update yo\n \n Schematics that are included in the `@schematics/angular` collection are run by default by the commands `ng generate` and `ng add`.\n The package contains named schematics that configure the options that are available to the CLI for `ng generate` sub-commands, such as `ng generate component` and `ng generate service`.\n-The subcommands for `ng generate` are shorthand for the corresponding schematic.\n-To specify a particular schematic \\(or collection of schematics\\) to generate, using the long form:\n+The sub-commands for `ng generate` are shorthand for the corresponding schematic.\n+To specify and generate a particular schematic, or a collection of schematics, using the long form:\n \n <code-example format=\"shell\" language=\"shell\">\n \n@@ -35,7 +35,7 @@ ng generate my-schematic-name --collection collection-name\n \n ### Configuring CLI schematics\n \n-A JSON schema associated with a schematic tells the Angular CLI what options are available to commands and subcommands, and determines the defaults.\n+A JSON schema associated with a schematic tells the Angular CLI what options are available to commands and sub-commands, and determines the defaults.\n These defaults can be overridden by providing a different value for an option on the command line.\n See [Workspace Configuration](guide/workspace-config) for information about how to change the generation option defaults for your workspace.\n \n@@ -47,7 +47,7 @@ The schema describes the options available to the CLI for each of the `ng genera\n As a library developer, you can create your own collections of custom schematics to integrate your library with the Angular CLI.\n \n *   An *add schematic* lets developers install your library in an Angular workspace using `ng add`\n-*   *Generation schematics* can tell the `ng generate` subcommands how to modify projects, add configurations and scripts, and scaffold artifacts that are defined in your library\n+*   *Generation schematics* can tell the `ng generate` sub-commands how to modify projects, add configurations and scripts, and scaffold artifacts that are defined in your library\n *   An *update schematic* can tell the `ng update` command how to update your library's dependencies and adjust for breaking changes when you release a new version\n \n For more details of what these look like and how to create them, see:\n@@ -57,16 +57,16 @@ For more details of what these look like and how to create them, see:\n \n ### Add schematics\n \n-An add schematic is typically supplied with a library, so that the library can be added to an existing project with `ng add`.\n+An *add schematic* is typically supplied with a library, so that the library can be added to an existing project with `ng add`.\n The `add` command uses your package manager to download new dependencies, and invokes an installation script that is implemented as a schematic.\n \n For example, the [`@angular/material`](https://material.angular.io/guide/schematics) schematic tells the `add` command to install and set up Angular Material and theming, and register new starter components that can be created with `ng generate`.\n Look at this one as an example and model for your own add schematic.\n \n Partner and third party libraries also support the Angular CLI with add schematics.\n-For example, `@ng-bootstrap/schematics` adds [ng-bootstrap](https://ng-bootstrap.github.io)  to an app, and  `@clr/angular` installs and sets up [Clarity from VMWare](https://vmware.github.io/clarity/documentation/v1.0/get-started).\n+For example, `@ng-bootstrap/schematics` adds [ng-bootstrap](https://ng-bootstrap.github.io)  to an app, and  `@clr/angular` installs and sets up [Clarity from VMWare](https://clarity.design/documentation/get-started).\n \n-An add schematic can also update a project with configuration changes, add additional dependencies \\(such as polyfills\\), or scaffold package-specific initialization code.\n+An *add schematic* can also update a project with configuration changes, add additional dependencies \\(such as polyfills\\), or scaffold package-specific initialization code.\n For example, the `@angular/pwa` schematic turns your application into a PWA by adding an application manifest and service worker.\n \n ### Generation schematics\n@@ -91,15 +91,15 @@ ng generate &commat;angular/material:table &lt;component-name&gt;\n <code-example format=\"shell\" language=\"shell\">\n \n ng update\n-    We analyzed your package.json, there are some packages to update:\n-\n-      Name                               Version                  Command to update\n-     &hyphen;-------------------------------------------------------------------------------\n-      &commat;angular/cdk                       7.2.2 -&gt; 7.3.1           ng update &commat;angular/cdk\n-      &commat;angular/cli                       7.2.3 -&gt; 7.3.0           ng update &commat;angular/cli\n-      &commat;angular/core                      7.2.2 -&gt; 7.2.3           ng update &commat;angular/core\n-      &commat;angular/material                  7.2.2 -&gt; 7.3.1           ng update &commat;angular/material\n-      rxjs                               6.3.3 -&gt; 6.4.0           ng update rxjs\n+We analyzed your package.json, there are some packages to update:\n+\n+    Name                                      Version                     Command to update\n+    &hyphen;-------------------------------------------------------------------------------\n+    &commat;angular/cdk                       7.2.2 -&gt; 7.3.1           ng update &commat;angular/cdk\n+    &commat;angular/cli                       7.2.3 -&gt; 7.3.0           ng update &commat;angular/cli\n+    &commat;angular/core                      7.2.2 -&gt; 7.2.3           ng update &commat;angular/core\n+    &commat;angular/material                  7.2.2 -&gt; 7.3.1           ng update &commat;angular/material\n+    rxjs                                      6.3.3 -&gt; 6.4.0           ng update rxjs\n \n     There might be additional packages that are outdated.\n     Run \"ng update --all\" to try to update all at the same time.\n\n\n###\n\n", "completion": "docs: fixing copy inconsistencies in schematics description (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/user-input.md | file path B: aio/content/guide/user-input.md\n\n@@ -4,7 +4,7 @@\n \n <header>Marked for archiving</header>\n \n-To ensure that you have the best experience possible, this topic is marked for archiving until we determine that it clearly conveys the most accurate information possible.\n+To ensure that you have the best experience possible, this topic is marked for archiving until it clearly conveys the most accurate information possible.\n \n In the meantime, this topic might be helpful:\n [Event binding](guide/event-binding).\n@@ -28,16 +28,20 @@ To bind to a DOM event, surround the DOM event name in parentheses and assign a\n \n The following example shows an event binding that implements a click handler:\n \n+<!-- vale Angular.Google_WordListWarnings = NO -->\n+\n <code-example header=\"src/app/click-me.component.ts\" path=\"user-input/src/app/click-me.component.ts\" region=\"click-me-button\"></code-example>\n \n+<!-- vale Angular.Google_WordListWarnings = YES -->\n+\n <a id=\"click\"></a>\n \n The `(click)` to the left of the equals sign identifies the button's click event as the **target of the binding**.\n-The text in quotes to the right of the equals sign is the **template statement**, which responds to the click event by calling the component's `onClickMe` method.\n+The text in quotes to the right of the equals sign is the **template statement**. The statement responds to the click event by calling the component's `onClickMe` method.\n \n When writing a binding, be aware of a template statement's **execution context**.\n The identifiers in a template statement belong to a specific context object, usually the Angular component controlling the template.\n-The example above shows a single line of HTML, but that HTML belongs to a larger component:\n+The preceding example shows a single line of HTML, but that HTML belongs to a larger component:\n \n <code-example header=\"src/app/click-me.component.ts\" path=\"user-input/src/app/click-me.component.ts\" region=\"click-me-component\"></code-example>\n \n@@ -52,7 +56,7 @@ The following code listens to the `keyup` event and passes the entire event payl\n \n <code-example header=\"src/app/keyup.components.ts (template v.1)\" path=\"user-input/src/app/keyup.components.ts\" region=\"key-up-component-1-template\"></code-example>\n \n-When a user presses and releases a key, the `keyup` event occurs, and Angular provides a corresponding DOM event object in the `$event` variable which this code passes as a parameter to the component's `onKey()` method.\n+When a user presses and releases a key, the `keyup` event occurs. Angular then provides a corresponding DOM event object in the `$event` variable which this code passes as a parameter to the component's `onKey()` method.\n \n <code-example header=\"src/app/keyup.components.ts (class v.1)\" path=\"user-input/src/app/keyup.components.ts\" region=\"key-up-component-1-class-no-type\"></code-example>\n \n@@ -65,9 +69,13 @@ In this case, `target` refers to the [`<input>` element](https://developer.mozil\n After each call, the `onKey()` method appends the contents of the input box value to the list in the component's `values` property, followed by a separator character \\(`|`\\).\n The [interpolation](guide/interpolation) displays the accumulating input box changes from the `values` property.\n \n-Suppose the user enters the letters \"abc\", and then backspaces to remove them one by one.\n+<!-- vale Angular.Angular_Spelling = NO -->\n+\n+Suppose the user enters the letters \"abc\" and then backspaces to remove them one by one.\n Here's what the UI displays:\n \n+<!-- vale Angular.Angular_Spelling = YES -->\n+\n <code-example>\n \n a &verbar; ab &verbar; abc &verbar; ab &verbar; a &verbar; &verbar;\n@@ -82,7 +90,7 @@ a &verbar; ab &verbar; abc &verbar; ab &verbar; a &verbar; &verbar;\n \n <div class=\"alert is-helpful\">\n \n-Alternatively, you could accumulate the individual keys themselves by substituting `event.key` for `event.target.value` in which case the same user input would produce:\n+You could also accumulate the individual keys themselves by substituting `event.key` for `event.target.value` in which case the same user input would produce:\n \n <code-example>\n \n@@ -96,7 +104,7 @@ a &verbar; b &verbar; c &verbar; backspace &verbar; backspace &verbar; backspace\n \n ### Type the `$event`\n \n-The example above casts the `$event` as an `any` type.\n+The preceding example casts the `$event` as an `any` type.\n That simplifies the code at a cost.\n There is no type information that could reveal properties of the event object and prevent silly mistakes.\n \n@@ -110,19 +118,18 @@ The `OnKey` method more clearly expresses what it expects from the template and\n \n ### Passing `$event` is a dubious practice\n \n-Typing the event object reveals a significant objection to passing the entire DOM event into the method:\n-The component has too much awareness of the template details.\n+Typing the event object reveals a significant objection to passing the entire DOM event into the method. Namely, the component has too much awareness of the template details.\n It can't extract information without knowing more than it should about the HTML implementation.\n-That breaks the separation of concerns between the template \\(*what the user sees*\\) and the component \\(*how the application processes user data*\\).\n+That breaks the separation of concerns between the template, *what the user sees*, and the component, *how the application processes user data*.\n \n The next section shows how to use template reference variables to address this problem.\n \n ## Get user input from a template reference variable\n \n There's another way to get the user data:\n-Use Angular [**template reference variables**](guide/template-reference-variables).\n+use Angular [**template reference variables**](guide/template-reference-variables).\n These variables provide direct access to an element from within the template.\n-To declare a template reference variable, precede an identifier with a hash \\(or pound\\) character \\(`#`\\).\n+To declare a template reference variable, precede an identifier with a hash/pound character \\(`#`\\).\n \n The following example uses a template reference variable to implement a keystroke loopback in a simple template.\n \n@@ -146,9 +153,9 @@ Type something in the input box, and watch the display update with each keystrok\n \n <header>This won't work at all unless you bind to an event.</header>\n \n-Angular updates the bindings \\(and therefore the screen\\) only if the app does something in response to asynchronous events, such as keystrokes.\n+Angular updates the bindings and screen only if the app does something in response to asynchronous events, such as keystrokes.\n This example code binds the `keyup` event to the number 0, the shortest template statement possible.\n-While the statement does nothing useful, it satisfies Angular's requirement so that Angular will update the screen.\n+While the statement does nothing useful, it satisfies Angular's condition so that Angular updates the screen.\n \n </div>\n \n@@ -169,7 +176,7 @@ Sometimes only the *Enter* key matters, because it signals that the user has fin\n One way to reduce the noise would be to examine every `$event.keyCode` and take action only when the key is *Enter*.\n \n There's an easier way:\n-Bind to Angular's `keyup.enter` pseudo-event.\n+bind to Angular's `keyup.enter` pseudo-event.\n Then Angular calls the event handler only when the user presses *Enter*.\n \n <code-example header=\"src/app/keyup.components.ts (v3)\" path=\"user-input/src/app/keyup.components.ts\" region=\"key-up-component-3\"></code-example>\n@@ -184,7 +191,7 @@ Here's how it works.\n \n ## On blur\n \n-In the previous example, the current state of the input box is lost if the user mouses away and clicks elsewhere on the page without first pressing *Enter*.\n+In the previous example, the current state of the input box is lost if the user mouses away and clicks elsewhere without first pressing *Enter*.\n The component's `value` property is updated only when the user presses *Enter*.\n \n To fix this issue, listen to both the *Enter* key and the `blur` event.\n@@ -248,7 +255,7 @@ For example, you can use the following steps to make the scroll event passive.\n \n     </code-example>\n \n-After those steps, if you add event listeners for the `scroll` event, the listeners will be `passive`.\n+After those steps, if you add event listeners for the `scroll` event, the listeners are going to be `passive`.\n \n ## Summary\n \n\n\n###\n\n", "completion": "docs: fix linter errors in user-input.md (#<issue-num>)"}
{"prompt": " file path A: packages/language-service/src/codefixes/fix_missing_import.ts | file path B: packages/language-service/src/codefixes/fix_missing_import.ts\n\n@@ -39,6 +39,8 @@ export const missingImportMeta: CodeActionMeta = {\n function getCodeActions(\n     {templateInfo, start, compiler, formatOptions, preferences, errorCode, tsLs}:\n         CodeActionContext) {\n+  let codeActions: ts.CodeFixAction[] = [];\n+\n   const checker = compiler.getTemplateTypeChecker();\n   const tsChecker = compiler.programDriver.getProgram().getTypeChecker();\n \n@@ -64,46 +66,45 @@ function getCodeActions(\n   }\n   const importOn = owningNgModule ?? templateInfo.component;\n \n-  // Find all possible importable directives with a matching selector, and take one of them.\n-  // In the future, we could handle multiple matches as additional quick fixes.\n+  // Find all possible importable directives with a matching selector.\n   const allPossibleDirectives = checker.getPotentialTemplateDirectives(templateInfo.component);\n   const matchingDirectives =\n       getDirectiveMatchesForElementTag(missingElement, allPossibleDirectives);\n-  if (matchingDirectives.size === 0) {\n-    return [];\n-  }\n-  const bestMatch: PotentialDirective = matchingDirectives.values().next().value;\n-  const bestMatchSymbol = bestMatch.tsSymbol.valueDeclaration;\n-\n-  // Get possible trait imports corresponding to the recommended directive. Only use the\n-  // compiler's best import; in the future, we could suggest multiple imports if they exist.\n-  const potentialImports = checker.getPotentialImportsFor(bestMatch, importOn);\n-  if (potentialImports.length === 0) {\n-    return [];\n-  }\n-  const potentialImport = potentialImports[0];\n-\n-  // Update the imports on the TypeScript file and Angular decorator.\n-  let [fileImportChanges, importName] = updateImportsForTypescriptFile(\n-      tsChecker, importOn.getSourceFile(), potentialImport, bestMatchSymbol.getSourceFile());\n-  let traitImportChanges = updateImportsForAngularTrait(checker, importOn, importName);\n-\n-  // All quick fixes should always update the trait import; however, the TypeScript import might\n-  // already be present.\n-  if (traitImportChanges.length === 0) {\n-    return [];\n+  const matches = matchingDirectives.values();\n+\n+  // Generate suggestions for each possible match.\n+  for (let currMatch of matches) {\n+    const currMatchSymbol = currMatch.tsSymbol.valueDeclaration;\n+\n+    // Get possible trait imports corresponding to the recommended directive.\n+    const potentialImports = checker.getPotentialImportsFor(currMatch, importOn);\n+\n+    // For each possible import specifier, create a suggestion.\n+    for (let potentialImport of potentialImports) {\n+      // Update the imports on the TypeScript file and Angular decorator.\n+      let [fileImportChanges, importName] = updateImportsForTypescriptFile(\n+          tsChecker, importOn.getSourceFile(), potentialImport, currMatchSymbol.getSourceFile());\n+      let traitImportChanges = updateImportsForAngularTrait(checker, importOn, importName);\n+\n+      // All quick fixes should always update the trait import; however, the TypeScript import might\n+      // already be present.\n+      if (traitImportChanges.length === 0) {\n+        continue;\n+      }\n+\n+      // Create a code action for this import.\n+      codeActions.push({\n+        fixName: FixIdForCodeFixesAll.FIX_MISSING_IMPORT,\n+        description: `Import ${importName} from '${potentialImport.moduleSpecifier}' on ${\n+            importOn.name!.text}`,\n+        changes: [{\n+          fileName: importOn.getSourceFile().fileName,\n+          textChanges: [...fileImportChanges, ...traitImportChanges],\n+        }]\n+      });\n+    }\n   }\n \n-  // Create the code action to insert the new imports.\n-  const codeActions: ts.CodeFixAction[] = [{\n-    fixName: FixIdForCodeFixesAll.FIX_MISSING_IMPORT,\n-    description:\n-        `Import ${importName} from '${potentialImport.moduleSpecifier}' on ${importOn.name!.text}`,\n-    changes: [{\n-      fileName: importOn.getSourceFile().fileName,\n-      textChanges: [...fileImportChanges, ...traitImportChanges],\n-    }],\n-  }];\n   return codeActions;\n }\n \n\n\n###\n\n", "completion": "feat(language-service): Allow auto-imports to suggest multiple possible imports. (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/hierarchical-dependency-injection.md | file path B: aio/content/guide/hierarchical-dependency-injection.md\n\n@@ -736,7 +736,7 @@ The example application uses `@Optional()` so the application does not throw an\n The `<app-child>` currently provides the `AnimalService` in the `viewProviders` array with the value of dog <code>&#x1F436;</code>.\n Because the injector has only to look at the `ElementInjector` of the `<app-child>` for the `AnimalService`, it never sees the whale <code>&#x1F433;</code>.\n \n-As in the `FlowerService` example, if you add `@SkipSelf()` to the constructor for the `AnimalService`, the injector won't look in the  `ElementInjector` oh the current `<app-child>` for the `AnimalService`.\n+As in the `FlowerService` example, if you add `@SkipSelf()` to the constructor for the `AnimalService`, the injector won't look in the  `ElementInjector` or the current `<app-child>` for the `AnimalService`.\n \n <code-example format=\"typescript\" language=\"typescript\">\n \n\n\n###\n\n", "completion": "docs: fix minor typo in hierarchical-dependency-injection.md (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -367,9 +367,11 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n         assertEmptyWidthAndHeight(this);\n       } else {\n         assertNonEmptyWidthAndHeight(this);\n+        // Only check for distorted images when not in fill mode, where\n+        // images may be intentionally stretched, cropped or letterboxed.\n+        assertNoImageDistortion(this, this.imgElement, this.renderer);\n       }\n       assertValidLoadingInput(this);\n-      assertNoImageDistortion(this, this.imgElement, this.renderer);\n       if (!this.ngSrcset) {\n         assertNoComplexSizes(this);\n       }\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/image-distortion/image-distortion.ts | file path B: packages/core/test/bundling/image-directive/e2e/image-distortion/image-distortion.ts\n\n@@ -36,6 +36,10 @@ import {Component} from '@angular/core';\n      <!-- Aspect-ratio: 1.0652173913 -->\n      <img ngSrc=\"/e2e/b.png\" width=\"245\" height=\"230\">\n      <br>\n+     <!-- Fill mode disables aspect ratio warning -->\n+     <!-- Aspect-ratio: 0.1 -->\n+     <img ngSrc=\"/e2e/b.png\" width=\"24\" height=\"240\" disableOptimizedSrcset fill>\n+     <br>\n      <!-- Supplied aspect ratio is correct & image has 0x0 rendered size -->\n      <img ngSrc=\"/e2e/a.png\" width=\"25\" height=\"25\" style=\"display: none\">\n      <br>\n\n\n###\n\n", "completion": "fix(common): Don't warn about image distortion is fill mode is enabled (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,28 @@\n+<a name=\"15.0.0-rc.0\"></a>\n+# 15.0.0-rc.0 (2022-10-19)\n+### common\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [4f52d4e474](https://github.com/angular/angular/commit/4f52d4e47416494b4054e43a0d96383bde7813ca) | fix | don't generate srcset if noopImageLoader is used ([#47804](https://github.com/angular/angular/pull/47804)) |\n+| [fa4798095e](https://github.com/angular/angular/commit/fa4798095e3820087c4a3bccc9638c5e979315da) | fix | update size error to mention 'fill' mode ([#47797](https://github.com/angular/angular/pull/47797)) |\n+| [23f210c0ab](https://github.com/angular/angular/commit/23f210c0abfb6104f4aa2f39d0efd096c2b7574d) | fix | warn if using supported CDN but not built-in loader ([#47330](https://github.com/angular/angular/pull/47330)) |\n+### compiler-cli\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [309b2cde51](https://github.com/angular/angular/commit/309b2cde51d1577d6561e826be01e2b5fce43c49) | fix | implement more host directive validations as diagnostics ([#47768](https://github.com/angular/angular/pull/47768)) |\n+### localize\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [b6fd814542](https://github.com/angular/angular/commit/b6fd81454207bd256a48d5726f3bd7e6ce6a489b) | fix | update ng add schematic to support Angular CLI version 15 ([#47763](https://github.com/angular/angular/pull/47763)) |\n+### router\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [79e9e8ab77](https://github.com/angular/angular/commit/79e9e8ab779d230f6a1df25c4ccff94b13129305) | fix | Delay router scroll event until navigated components have rendered ([#47563](https://github.com/angular/angular/pull/47563)) |\n+## Special Thanks\n+Alan Agius, Alex Castle, Andrew Kushnir, Andrew Scott, Bob Watson, Charles Barnes, Charles Lyding, Kara Erickson, Kristiyan Kostadinov, Paul Gschwendtner, Virginia Dooley, WD Snoeijer, abergquist and urugator\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"14.2.7\"></a>\n # 14.2.7 (2022-10-19)\n ## Special Thanks\n\n\n###\n\n", "completion": "docs: release notes for the v15.0.0-rc.0 release"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,10 @@\n+<a name=\"14.2.7\"></a>\n+# 14.2.7 (2022-10-19)\n+## Special Thanks\n+Bob Watson, Charles Barnes, Joey Perrott, Virginia Dooley, WD Snoeijer, abergquist and urugator\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.0.0-next.6\"></a>\n # 15.0.0-next.6 (2022-10-12)\n ## Breaking Changes\n\n\n###\n\n", "completion": "docs: release notes for the v14.2.7 release"}
{"prompt": " file path A: packages/router/src/provide_router.ts | file path B: packages/router/src/provide_router.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {LOCATION_INITIALIZED, ViewportScroller} from '@angular/common';\n-import {APP_BOOTSTRAP_LISTENER, APP_INITIALIZER, ApplicationRef, ComponentRef, ENVIRONMENT_INITIALIZER, EnvironmentProviders, inject, InjectFlags, InjectionToken, Injector, makeEnvironmentProviders, Provider, Type} from '@angular/core';\n+import {APP_BOOTSTRAP_LISTENER, APP_INITIALIZER, ApplicationRef, ComponentRef, ENVIRONMENT_INITIALIZER, EnvironmentProviders, inject, InjectFlags, InjectionToken, Injector, makeEnvironmentProviders, NgZone, Provider, Type} from '@angular/core';\n import {of, Subject} from 'rxjs';\n import {filter, map, take} from 'rxjs/operators';\n \n@@ -155,7 +155,8 @@ export function withInMemoryScrolling(options: InMemoryScrollingOptions = {}):\n     useFactory: () => {\n       const router = inject(Router);\n       const viewportScroller = inject(ViewportScroller);\n-      return new RouterScroller(router, viewportScroller, options);\n+      const zone = inject(NgZone);\n+      return new RouterScroller(router, viewportScroller, zone, options);\n     },\n   }];\n   return routerFeature(RouterFeatureKind.InMemoryScrollingFeature, providers);\n\n---\n file path A: packages/router/src/router_module.ts | file path B: packages/router/src/router_module.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {HashLocationStrategy, Location, LocationStrategy, PathLocationStrategy, ViewportScroller} from '@angular/common';\n-import {APP_BOOTSTRAP_LISTENER, ComponentRef, inject, Inject, InjectionToken, ModuleWithProviders, NgModule, NgProbeToken, Optional, Provider, SkipSelf, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {APP_BOOTSTRAP_LISTENER, ComponentRef, inject, Inject, InjectionToken, ModuleWithProviders, NgModule, NgProbeToken, NgZone, Optional, Provider, SkipSelf, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {EmptyOutletComponent} from './components/empty_outlet';\n import {RouterLink} from './directives/router_link';\n@@ -154,11 +154,12 @@ export function provideRouterScroller(): Provider {\n     useFactory: () => {\n       const router = inject(Router);\n       const viewportScroller = inject(ViewportScroller);\n+      const zone = inject(NgZone);\n       const config: ExtraOptions = inject(ROUTER_CONFIGURATION);\n       if (config.scrollOffset) {\n         viewportScroller.setOffset(config.scrollOffset);\n       }\n-      return new RouterScroller(router, viewportScroller, config);\n+      return new RouterScroller(router, viewportScroller, zone, config);\n     },\n   };\n }\n\n---\n file path A: packages/router/src/router_scroller.ts | file path B: packages/router/src/router_scroller.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {ViewportScroller} from '@angular/common';\n-import {Injectable, InjectionToken, OnDestroy} from '@angular/core';\n+import {Injectable, InjectionToken, NgZone, OnDestroy} from '@angular/core';\n import {Unsubscribable} from 'rxjs';\n \n import {NavigationEnd, NavigationStart, Scroll} from './events';\n@@ -29,7 +29,8 @@ export class RouterScroller implements OnDestroy {\n \n   constructor(\n       private router: Router,\n-      /** @docsNotRequired */ public readonly viewportScroller: ViewportScroller, private options: {\n+      /** @docsNotRequired */ public readonly viewportScroller: ViewportScroller,\n+      private readonly zone: NgZone, private options: {\n         scrollPositionRestoration?: 'disabled'|'enabled'|'top',\n         anchorScrolling?: 'disabled'|'enabled'\n       } = {}) {\n@@ -85,8 +86,18 @@ export class RouterScroller implements OnDestroy {\n   }\n \n   private scheduleScrollEvent(routerEvent: NavigationEnd, anchor: string|null): void {\n-    this.router.triggerEvent(new Scroll(\n-        routerEvent, this.lastSource === 'popstate' ? this.store[this.restoredId] : null, anchor));\n+    this.zone.runOutsideAngular(() => {\n+      // The scroll event needs to be delayed until after change detection. Otherwise, we may\n+      // attempt to restore the scroll position before the router outlet has fully rendered the\n+      // component by executing its update block of the template function.\n+      setTimeout(() => {\n+        this.zone.run(() => {\n+          this.router.triggerEvent(new Scroll(\n+              routerEvent, this.lastSource === 'popstate' ? this.store[this.restoredId] : null,\n+              anchor));\n+        });\n+      }, 0);\n+    });\n   }\n \n   /** @nodoc */\n\n---\n file path A: packages/router/test/bootstrap.spec.ts | file path B: packages/router/test/bootstrap.spec.ts\n\n@@ -205,21 +205,13 @@ describe('bootstrap', () => {\n       schemas: [CUSTOM_ELEMENTS_SCHEMA]\n     })\n     class TestModule {\n-      constructor(router: Router) {\n-        log.push('TestModule');\n-        router.events.subscribe(e => log.push(e.constructor.name));\n-      }\n+      constructor(router: Router) {}\n     }\n \n     platformBrowserDynamic([]).bootstrapModule(TestModule).then(res => {\n       const router = res.injector.get(Router);\n       const data = router.routerState.snapshot.root.firstChild!.data;\n       expect(data['test']).toEqual('test-data');\n-      expect(log).toEqual([\n-        'TestModule', 'NavigationStart', 'RoutesRecognized', 'GuardsCheckStart',\n-        'ChildActivationStart', 'ActivationStart', 'GuardsCheckEnd', 'ResolveStart', 'ResolveEnd',\n-        'RootCmp', 'ActivationEnd', 'ChildActivationEnd', 'NavigationEnd', 'Scroll'\n-      ]);\n       done();\n     });\n   });\n@@ -432,6 +424,14 @@ describe('bootstrap', () => {\n     class TestModule {\n     }\n \n+    function resolveAfter(milliseconds: number) {\n+      return new Promise<void>((resolve) => {\n+        setTimeout(() => {\n+          resolve();\n+        }, milliseconds);\n+      });\n+    }\n+\n     const res = await platformBrowserDynamic([]).bootstrapModule(TestModule);\n     const router = res.injector.get(Router);\n \n@@ -447,13 +447,16 @@ describe('bootstrap', () => {\n     expect(window.pageYOffset).toEqual(3000);\n \n     await router.navigateByUrl('/cc');\n+    await resolveAfter(100);\n     expect(window.pageYOffset).toEqual(0);\n \n     await router.navigateByUrl('/aa#marker2');\n+    await resolveAfter(100);\n     expect(window.pageYOffset).toBeGreaterThanOrEqual(5900);\n     expect(window.pageYOffset).toBeLessThan(6000);  // offset\n \n     await router.navigateByUrl('/aa#marker3');\n+    await resolveAfter(100);\n     expect(window.pageYOffset).toBeGreaterThanOrEqual(8900);\n     expect(window.pageYOffset).toBeLessThan(9000);\n   });\n@@ -506,9 +509,6 @@ describe('bootstrap', () => {\n     (async () => {\n       const res = await platformBrowserDynamic([]).bootstrapModule(TestModule);\n       const router = res.injector.get(Router);\n-      router.events.subscribe(() => {\n-        expect(router.getCurrentNavigation()?.id).toBeDefined();\n-      });\n       router.events.subscribe(async (e) => {\n         if (e instanceof NavigationEnd && e.url === '/b') {\n           await router.navigate(['a']);\n\n---\n file path A: packages/router/test/router_scroller.spec.ts | file path B: packages/router/test/router_scroller.spec.ts\n\n@@ -7,17 +7,21 @@\n  */\n \n import {fakeAsync, tick} from '@angular/core/testing';\n-import {DefaultUrlSerializer, NavigationEnd, NavigationStart, RouterEvent} from '@angular/router';\n+import {DefaultUrlSerializer, Event, NavigationEnd, NavigationStart} from '@angular/router';\n import {Subject} from 'rxjs';\n-import {filter, switchMap} from 'rxjs/operators';\n+import {filter, switchMap, take} from 'rxjs/operators';\n \n import {Scroll} from '../src/events';\n import {RouterScroller} from '../src/router_scroller';\n \n // TODO: add tests that exercise the `withInMemoryScrolling` feature of the provideRouter function\n+const fakeZone = {\n+  runOutsideAngular: (fn: any) => fn(),\n+  run: (fn: any) => fn()\n+};\n describe('RouterScroller', () => {\n   it('defaults to disabled', () => {\n-    const events = new Subject<RouterEvent>();\n+    const events = new Subject<Event>();\n     const router = <any>{\n       events,\n       parseUrl: (url: any) => new DefaultUrlSerializer().parse(url),\n@@ -28,87 +32,103 @@ describe('RouterScroller', () => {\n         'viewportScroller',\n         ['getScrollPosition', 'scrollToPosition', 'scrollToAnchor', 'setHistoryScrollRestoration']);\n     setScroll(viewportScroller, 0, 0);\n-    const scroller = new RouterScroller(router, router);\n+    const scroller = new RouterScroller(router, router, fakeZone as any);\n \n     expect((scroller as any).options.scrollPositionRestoration).toBe('disabled');\n     expect((scroller as any).options.anchorScrolling).toBe('disabled');\n   });\n \n+  function nextScrollEvent(events: Subject<Event>): Promise<Scroll> {\n+    return events.pipe(filter((e): e is Scroll => e instanceof Scroll), take(1)).toPromise();\n+  }\n+\n   describe('scroll to top', () => {\n-    it('should scroll to the top', () => {\n+    it('should scroll to the top', async () => {\n       const {events, viewportScroller} =\n           createRouterScroller({scrollPositionRestoration: 'top', anchorScrolling: 'disabled'});\n \n       events.next(new NavigationStart(1, '/a'));\n       events.next(new NavigationEnd(1, '/a', '/a'));\n+      await nextScrollEvent(events);\n       expect(viewportScroller.scrollToPosition).toHaveBeenCalledWith([0, 0]);\n \n       events.next(new NavigationStart(2, '/a'));\n       events.next(new NavigationEnd(2, '/b', '/b'));\n+      await nextScrollEvent(events);\n       expect(viewportScroller.scrollToPosition).toHaveBeenCalledWith([0, 0]);\n \n       events.next(new NavigationStart(3, '/a', 'popstate'));\n       events.next(new NavigationEnd(3, '/a', '/a'));\n+      await nextScrollEvent(events);\n       expect(viewportScroller.scrollToPosition).toHaveBeenCalledWith([0, 0]);\n     });\n   });\n \n   describe('scroll to the stored position', () => {\n-    it('should scroll to the stored position on popstate', () => {\n+    it('should scroll to the stored position on popstate', async () => {\n       const {events, viewportScroller} =\n           createRouterScroller({scrollPositionRestoration: 'enabled', anchorScrolling: 'disabled'});\n \n       events.next(new NavigationStart(1, '/a'));\n       events.next(new NavigationEnd(1, '/a', '/a'));\n+      await nextScrollEvent(events);\n       setScroll(viewportScroller, 10, 100);\n       expect(viewportScroller.scrollToPosition).toHaveBeenCalledWith([0, 0]);\n \n       events.next(new NavigationStart(2, '/b'));\n       events.next(new NavigationEnd(2, '/b', '/b'));\n+      await nextScrollEvent(events);\n       setScroll(viewportScroller, 20, 200);\n       expect(viewportScroller.scrollToPosition).toHaveBeenCalledWith([0, 0]);\n \n       events.next(new NavigationStart(3, '/a', 'popstate', {navigationId: 1}));\n       events.next(new NavigationEnd(3, '/a', '/a'));\n+      await nextScrollEvent(events);\n       expect(viewportScroller.scrollToPosition).toHaveBeenCalledWith([10, 100]);\n     });\n   });\n \n   describe('anchor scrolling', () => {\n-    it('should work (scrollPositionRestoration is disabled)', () => {\n+    it('should work (scrollPositionRestoration is disabled)', async () => {\n       const {events, viewportScroller} =\n           createRouterScroller({scrollPositionRestoration: 'disabled', anchorScrolling: 'enabled'});\n       events.next(new NavigationStart(1, '/a#anchor'));\n       events.next(new NavigationEnd(1, '/a#anchor', '/a#anchor'));\n+      await nextScrollEvent(events);\n       expect(viewportScroller.scrollToAnchor).toHaveBeenCalledWith('anchor');\n \n       events.next(new NavigationStart(2, '/a#anchor2'));\n       events.next(new NavigationEnd(2, '/a#anchor2', '/a#anchor2'));\n+      await nextScrollEvent(events);\n       expect(viewportScroller.scrollToAnchor).toHaveBeenCalledWith('anchor2');\n       viewportScroller.scrollToAnchor.calls.reset();\n \n       // we never scroll to anchor when navigating back.\n       events.next(new NavigationStart(3, '/a#anchor', 'popstate'));\n       events.next(new NavigationEnd(3, '/a#anchor', '/a#anchor'));\n+      await nextScrollEvent(events);\n       expect(viewportScroller.scrollToAnchor).not.toHaveBeenCalled();\n       expect(viewportScroller.scrollToPosition).not.toHaveBeenCalled();\n     });\n \n-    it('should work (scrollPositionRestoration is enabled)', () => {\n+    it('should work (scrollPositionRestoration is enabled)', async () => {\n       const {events, viewportScroller} =\n           createRouterScroller({scrollPositionRestoration: 'enabled', anchorScrolling: 'enabled'});\n       events.next(new NavigationStart(1, '/a#anchor'));\n       events.next(new NavigationEnd(1, '/a#anchor', '/a#anchor'));\n+      await nextScrollEvent(events);\n       expect(viewportScroller.scrollToAnchor).toHaveBeenCalledWith('anchor');\n \n       events.next(new NavigationStart(2, '/a#anchor2'));\n       events.next(new NavigationEnd(2, '/a#anchor2', '/a#anchor2'));\n+      await nextScrollEvent(events);\n       expect(viewportScroller.scrollToAnchor).toHaveBeenCalledWith('anchor2');\n       viewportScroller.scrollToAnchor.calls.reset();\n \n       // we never scroll to anchor when navigating back\n       events.next(new NavigationStart(3, '/a#anchor', 'popstate', {navigationId: 1}));\n       events.next(new NavigationEnd(3, '/a#anchor', '/a#anchor'));\n+      await nextScrollEvent(events);\n       expect(viewportScroller.scrollToAnchor).not.toHaveBeenCalled();\n       expect(viewportScroller.scrollToPosition).toHaveBeenCalledWith([0, 0]);\n     });\n@@ -135,14 +155,17 @@ describe('RouterScroller', () => {\n \n          events.next(new NavigationStart(1, '/a'));\n          events.next(new NavigationEnd(1, '/a', '/a'));\n+         tick();\n          setScroll(viewportScroller, 10, 100);\n \n          events.next(new NavigationStart(2, '/b'));\n          events.next(new NavigationEnd(2, '/b', '/b'));\n+         tick();\n          setScroll(viewportScroller, 20, 200);\n \n          events.next(new NavigationStart(3, '/c'));\n          events.next(new NavigationEnd(3, '/c', '/c'));\n+         tick();\n          setScroll(viewportScroller, 30, 300);\n \n          events.next(new NavigationStart(4, '/a', 'popstate', {navigationId: 1}));\n@@ -164,7 +187,7 @@ describe('RouterScroller', () => {\n     scrollPositionRestoration: 'disabled'|'enabled'|'top',\n     anchorScrolling: 'disabled'|'enabled'\n   }) {\n-    const events = new Subject<RouterEvent>();\n+    const events = new Subject<Event>();\n     const router = <any>{\n       events,\n       parseUrl: (url: any) => new DefaultUrlSerializer().parse(url),\n@@ -176,8 +199,8 @@ describe('RouterScroller', () => {\n         ['getScrollPosition', 'scrollToPosition', 'scrollToAnchor', 'setHistoryScrollRestoration']);\n     setScroll(viewportScroller, 0, 0);\n \n-    const scroller =\n-        new RouterScroller(router, viewportScroller, {scrollPositionRestoration, anchorScrolling});\n+    const scroller = new RouterScroller(\n+        router, viewportScroller, fakeZone as any, {scrollPositionRestoration, anchorScrolling});\n     scroller.init();\n \n     return {events, viewportScroller, router};\n\n\n###\n\n", "completion": "fix(router): Delay router scroll event until navigated components have rendered (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -352,6 +352,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n    */\n   @Input() srcset?: string;\n \n+  /** @nodoc */\n   ngOnInit() {\n     if (ngDevMode) {\n       assertNonEmptyInput(this, 'ngSrc', this.ngSrc);\n@@ -433,6 +434,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n     }\n   }\n \n+  /** @nodoc */\n   ngOnChanges(changes: SimpleChanges) {\n     if (ngDevMode) {\n       assertNoPostInitInputChange(\n@@ -503,6 +505,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n     return finalSrcs.join(', ');\n   }\n \n+  /** @nodoc */\n   ngOnDestroy() {\n     if (ngDevMode) {\n       if (!this.priority && this._renderedSrc !== null && this.lcpObserver !== null) {\n\n\n###\n\n", "completion": "docs: exclude lifecycle hooks of the NgOptimizedImage from docs (#<issue-num>)"}
{"prompt": " file path A: aio/tools/transforms/templates/api/lib/memberHelpers.html | file path B: aio/tools/transforms/templates/api/lib/memberHelpers.html\n\n@@ -89,6 +89,11 @@\n         {%- else %}{$ method.name $}()\n         {%- endif -%}\n       </h3>\n+      {%- if method.developerPreview %}\n+      <label class=\"api-status-label dev-preview\" title=\"This API is in Developer Preview\">\n+        <a href=\"guide/releases#developer-preview\">developer preview</a>\n+      </label>\n+      {% endif %}\n       {$ github.githubLinks(method, versionInfo) $}\n     </div>\n   </th></tr></thead>\n@@ -221,6 +226,12 @@\n           <code class=\"{% if property.deprecated %} deprecated-api-item{% endif %}\">{$ renderMemberSyntax(property) $}</code>\n         </td>\n         <td>\n+          {%- if property.developerPreview %}\n+          <label class=\"api-status-label dev-preview\" title=\"This API is in Developer Preview\">\n+            <a href=\"guide/releases#developer-preview\">developer preview</a>\n+          </label>\n+          {% endif %}\n+\n           {%- if (property.isGetAccessor or property.isReadonly) and not property.isSetAccessor %}\n           <span class='read-only-property'>Read-Only</span>{% endif %}\n \n\n---\n file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -322,7 +322,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   private _disableOptimizedSrcset = false;\n \n   /**\n-   * Sets the image to \"fill mode,\" which eliminates the height/width requirement and adds\n+   * Sets the image to \"fill mode\", which eliminates the height/width requirement and adds\n    * styles such that the image fills its containing element.\n    *\n    * @developerPreview\n\n\n###\n\n", "completion": "fix(docs-infra): display \"developer preview\" label on class members (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -418,7 +418,8 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n \n     if (this.ngSrcset) {\n       rewrittenSrcset = this.getRewrittenSrcset();\n-    } else if (!this._disableOptimizedSrcset && !this.srcset) {\n+    } else if (\n+        !this._disableOptimizedSrcset && !this.srcset && this.imageLoader !== noopImageLoader) {\n       rewrittenSrcset = this.getAutomaticSrcset();\n     }\n \n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -1401,6 +1401,20 @@ describe('Image directive', () => {\n         return `${IMG_BASE_URL}/${config.src}${width}`;\n       };\n \n+      it('should not generate a srcset if the default noop loader is used', () => {\n+        setupTestingModule({noLoader: true});\n+\n+        const template = `\n+          <img ngSrc=\"img\" width=\"100\" height=\"50\" sizes=\"100vw\">\n+        `;\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+\n+        const nativeElement = fixture.nativeElement as HTMLElement;\n+        const img = nativeElement.querySelector('img')!;\n+        expect(img.getAttribute('srcset')).toBeNull();\n+      });\n+\n       it('should add a responsive srcset to the img element if sizes attribute exists', () => {\n         setupTestingModule({imageLoader});\n \n@@ -1538,6 +1552,7 @@ class TestComponent {\n function setupTestingModule(config?: {\n   imageConfig?: ImageConfig,\n   imageLoader?: ImageLoader,\n+  noLoader?: boolean,\n   extraProviders?: Provider[],\n   component?: Type<unknown>\n }) {\n@@ -1548,8 +1563,8 @@ function setupTestingModule(config?: {\n   const loader = config?.imageLoader || defaultLoader;\n   const extraProviders = config?.extraProviders || [];\n   const providers: Provider[] = [\n-    {provide: DOCUMENT, useValue: window.document}, {provide: IMAGE_LOADER, useValue: loader},\n-    ...extraProviders\n+    {provide: DOCUMENT, useValue: window.document},\n+    ...(config?.noLoader ? [] : [{provide: IMAGE_LOADER, useValue: loader}]), ...extraProviders\n   ];\n   if (config?.imageConfig) {\n     providers.push({provide: IMAGE_CONFIG, useValue: config.imageConfig});\n\n\n###\n\n", "completion": "fix(common): don't generate srcset if noopImageLoader is used (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/accessibility.md | file path B: aio/content/guide/accessibility.md\n\n@@ -2,7 +2,7 @@\n \n The web is used by a wide variety of people, including those who have visual or motor impairments.\n A variety of assistive technologies are available that make it much easier for these groups to interact with web-based software applications.\n-In addition, designing an application to be more accessible generally improves the user experience for all users.\n+Also, designing an application to be more accessible generally improves the user experience for all users.\n \n For an in-depth introduction to issues and techniques for designing accessible applications, see the [Accessibility](https://developers.google.com/web/fundamentals/accessibility/#what_is_accessibility) section of the Google's [Web Fundamentals](https://developers.google.com/web/fundamentals).\n \n@@ -16,10 +16,10 @@ For the sample application that this page describes, see the <live-example></liv\n \n ## Accessibility attributes\n \n-Building accessible web experience often involves setting [ARIA attributes](https://developers.google.com/web/fundamentals/accessibility/semantics-aria) to provide semantic meaning where it might otherwise be missing.\n+Building accessible web experience often involves setting [Accessible Rich Internet Applications \\(ARIA\\) attributes](https://developers.google.com/web/fundamentals/accessibility/semantics-aria) to provide semantic meaning where it might otherwise be missing.\n Use [attribute binding](guide/attribute-binding) template syntax to control the values of accessibility-related attributes.\n \n-When binding to ARIA attributes in Angular, you must use the `attr.` prefix, as the ARIA specification depends specifically on HTML attributes rather than properties of DOM elements.\n+When binding to ARIA attributes in Angular, you must use the `attr.` prefix. The ARIA specification depends specifically on HTML attributes rather than properties of DOM elements.\n \n <code-example format=\"html\" language=\"html\">\n \n@@ -67,7 +67,7 @@ For full details of these and other tools, see the [Angular CDK accessibility ov\n \n ### Augmenting native elements\n \n-Native HTML elements capture a number of standard interaction patterns that are important to accessibility.\n+Native HTML elements capture several standard interaction patterns that are important to accessibility.\n When authoring Angular components, you should re-use these native elements directly when possible, rather than re-implementing well-supported behaviors.\n \n For example, instead of creating a custom element for a new variety of button, create a component that uses an attribute selector with a native `<button>` element.\n@@ -79,8 +79,8 @@ You can see examples of this pattern in Angular Material:\n ### Using containers for native elements\n \n Sometimes using the appropriate native element requires a container element.\n-For example, the native `<input>` element cannot have children, so any custom text entry components need to wrap an `<input>` with additional elements.\n-While you might just include the `<input>` in your custom component's template, this makes it impossible for users of the component to set arbitrary properties and attributes to the input element.\n+For example, the native `<input>` element cannot have children, so any custom text entry components need to wrap an `<input>` with extra elements.\n+By just including `<input>` in your custom component's template, it's impossible for your component's users  to set arbitrary properties and attributes to the `<input>` element.\n Instead, create a container component that uses content projection to include the native control in the component's API.\n \n You can see [`MatFormField`](https://material.angular.io/components/form-field/overview) as an example of this pattern.\n@@ -127,7 +127,10 @@ You should avoid situations where focus returns to the `body` element after a ro\n \n ### Active links identification\n \n-CSS classes applied to active `RouterLink` elements (usually via `RouterLinkActive`) provide a visual indication regarding as to which link is currently active. Such indication doesn't apply to blind or visually impaired users, in order to provide such information the `aria-current` attribute should be applied to the element as well (for more information see [MDN aria-current](https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-current)).\n+CSS classes applied to active `RouterLink` elements, such as `RouterLinkActive`, provide a visual cue to identify the active link.\n+Unfortunately, a visual cue doesn't help blind or visually impaired users.\n+Applying the `aria-current` attribute to the element can help identify the active link.\n+For more information, see [Mozilla Developer Network \\(MDN\\) aria-current](https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-current)).\n \n The `RouterLinkActive` directive provides the `ariaCurrentWhenActive` input which sets the `aria-current` to a specified value when the link becomes active.\n \n@@ -153,7 +156,9 @@ The following example shows how to apply the `active-page` class to active links\n     </nav>\n ```\n \n-## Additional resources\n+<!-- vale Angular.Angular_Spelling = NO -->\n+\n+## More information\n \n *   [Accessibility - Google Web Fundamentals](https://developers.google.com/web/fundamentals/accessibility)\n *   [ARIA specification and authoring practices](https://www.w3.org/TR/wai-aria)\n@@ -165,6 +170,8 @@ The following example shows how to apply the `active-page` class to active links\n *   [Rob Dodson A11ycasts](https://www.youtube.com/watch?v=HtTyRajRuyY)\n *   [Angular ESLint](https://github.com/angular-eslint/angular-eslint#functionality) provides linting rules that can help you make sure your code meets accessibility standards.\n \n+<!-- vale Angular.Angular_Spelling = YES -->\n+\n Books\n \n <!-- vale Angular.Google_Quotes = NO -->\n\n\n###\n\n", "completion": "docs: fix linter errors for accessibility.md (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/image-directive-setup.md | file path B: aio/content/guide/image-directive-setup.md\n\n@@ -1,15 +1,6 @@\n # Configuring an image loader for `NgOptimizedImage`\n \n-<div class=\"alert is-important\">\n-\n-The `NgOptimizedImage` directive is available for [developer preview](https://angular.io/guide/releases#developer-preview).\n-It's ready for you to try, but it might change before it is stable.\n-\n-For information on using `NgOptimizedImage`, see [Getting Started with NgOptimizedImage](/guide/image-directive).\n-\n-</div>\n-\n-These instructions explain how to set up an image loader for use with the `NgOptimizedImage`. \n+These instructions explain how to set up an image loader for use with the `NgOptimizedImage`.\n \n A \"loader\" is a function that generates an [image transformation URL](https://web.dev/image-cdns/#how-image-cdns-use-urls-to-indicate-optimization-options) for a given image file. When appropriate, `NgOptimizedImage` sets the size, format, and image quality transformations for an image.\n \n\n---\n file path A: aio/content/guide/image-directive.md | file path B: aio/content/guide/image-directive.md\n\n@@ -1,12 +1,5 @@\n # Getting started with NgOptimizedImage\n \n-<div class=\"alert is-important\">\n-\n-The `NgOptimizedImage` directive is available for [developer preview](https://angular.io/guide/releases#developer-preview).\n-It's ready for you to try, but it might change before it is stable.\n-\n-</div>\n-\n The `NgOptimizedImage` directive makes it easy to adopt performance best practices for loading images.\n \n The directive ensures that the loading of the [Largest Contentful Paint](http://web.dev/lcp) image is prioritized by:\n\n---\n file path A: aio/content/navigation.json | file path B: aio/content/navigation.json\n\n@@ -417,6 +417,11 @@\n           \"title\": \"HTTP client\",\n           \"tooltip\": \"Use HTTP to talk to a remote server.\"\n         },\n+        {\n+          \"url\": \"guide/image-directive\",\n+          \"title\": \"Image optimization\",\n+          \"tooltip\": \"Performant images with the Angular image directive.\"\n+        },\n         {\n           \"title\": \"Testing\",\n           \"tooltip\": \"Testing your Angular apps.\",\n@@ -853,17 +858,6 @@\n         }\n       ]\n     },\n-    {\n-      \"title\": \"Feature preview\",\n-      \"tooltip\": \"Angular preview features and APIs\",\n-      \"children\": [\n-        {\n-          \"url\": \"guide/image-directive\",\n-          \"title\": \"Image Directive\",\n-          \"tooltip\": \"Performant images with the Angular image directive.\"\n-        }\n-      ]\n-    },\n     {\n       \"title\": \"Release Information\",\n       \"tooltip\": \"Angular release practices, updating, and upgrading.\",\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts\n\n@@ -18,7 +18,6 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  * @returns Provider that provides an ImageLoader function\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export const provideCloudflareLoader = createImageLoader(\n     createCloudflareUrl,\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts\n\n@@ -35,7 +35,6 @@ function isCloudinaryUrl(url: string): boolean {\n  * @returns Set of providers to configure the Cloudinary loader.\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export const provideCloudinaryLoader = createImageLoader(\n     createCloudinaryUrl,\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts\n\n@@ -17,7 +17,6 @@ import {isAbsoluteUrl, isValidPath, normalizePath, normalizeSrc} from '../url';\n  * @see `ImageLoader`\n  * @see `NgOptimizedImage`\n  * @publicApi\n- * @developerPreview\n  */\n export interface ImageLoaderConfig {\n   /**\n@@ -35,7 +34,6 @@ export interface ImageLoaderConfig {\n  * NgOptimizedImage directive to produce full image URL based on the image name and its width.\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export type ImageLoader = (config: ImageLoaderConfig) => string;\n \n@@ -62,7 +60,6 @@ export type ImageLoaderInfo = {\n  * @see `ImageLoader`\n  * @see `NgOptimizedImage`\n  * @publicApi\n- * @developerPreview\n  */\n export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n   providedIn: 'root',\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts\n\n@@ -34,7 +34,6 @@ function isImageKitUrl(url: string): boolean {\n  * @returns Set of providers to configure the ImageKit loader.\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export const provideImageKitLoader = createImageLoader(\n     createImagekitUrl,\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts\n\n@@ -32,7 +32,6 @@ function isImgixUrl(url: string): boolean {\n  * @returns Set of providers to configure the Imgix loader.\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export const provideImgixLoader =\n     createImageLoader(createImgixUrl, ngDevMode ? ['https://somepath.imgix.net/'] : undefined);\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -203,7 +203,6 @@ export const IMAGE_CONFIG = new InjectionToken<ImageConfig>(\n  * ```\n  *\n  * @publicApi\n- * @developerPreview\n  */\n @Directive({\n   standalone: true,\n@@ -325,6 +324,8 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   /**\n    * Sets the image to \"fill mode,\" which eliminates the height/width requirement and adds\n    * styles such that the image fills its containing element.\n+   *\n+   * @developerPreview\n    */\n   @Input()\n   set fill(value: string|boolean|undefined) {\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/preconnect_link_checker.ts | file path B: packages/common/src/directives/ng_optimized_image/preconnect_link_checker.ts\n\n@@ -35,7 +35,6 @@ const INTERNAL_PRECONNECT_CHECK_BLOCKLIST = new Set(['localhost', '127.0.0.1', '\n  * ```\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export const PRECONNECT_CHECK_BLOCKLIST =\n     new InjectionToken<Array<string|string[]>>('PRECONNECT_CHECK_BLOCKLIST');\n\n\n###\n\n", "completion": "docs: declare NgOptimizedImage APIs as stable (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/route_reuse_strategy.ts | file path B: packages/router/src/route_reuse_strategy.ts\n\n@@ -64,7 +64,7 @@ export abstract class RouteReuseStrategy {\n  *\n  * This base route reuse strategy only reuses routes when the matched router configs are\n  * identical. This prevents components from being destroyed and recreated\n- * when just the fragment or query parameters change\n+ * when just the route parameters, query parameters or fragment change\n  * (that is, the existing component is _reused_).\n  *\n  * This strategy does not store any routes for later reuse.\n\n\n###\n\n", "completion": "docs(router): fix misleading description of `BaseRouteReuseStrategy` (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/reusable-animations.md | file path B: aio/content/guide/reusable-animations.md\n\n@@ -9,7 +9,7 @@ Before continuing with this topic, you should be familiar with the following:\n *   [Introduction to Angular animations](guide/animations)\n *   [Transition and triggers](guide/transition-and-triggers)\n \n-## Creating reusable animations\n+## Create reusable animations\n \n To create a reusable animation, use the [`animation()`](api/animations/animation) function to define an animation in a separate `.ts` file and declare this animation definition as a `const` export variable.\n You can then import and reuse this animation in any of your application components using the [`useAnimation()`](api/animations/useAnimation) function.\n@@ -44,10 +44,4 @@ You might also be interested in the following:\n *   [Complex animation Sequences](guide/complex-animation-sequences)\n *   [Route transition animations](guide/route-animations)\n \n-<!-- links -->\n-\n-<!-- external links -->\n-\n-<!-- end links -->\n-\n-@reviewed 2022-02-28\n+@reviewed 2022-10-11\n\n\n###\n\n", "completion": "docs: Linting suggested corrections made.  Restructuring or rewording sentences to be shorter and clearer. (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/image-directive-setup.md | file path B: aio/content/guide/image-directive-setup.md\n\n@@ -1,23 +1,19 @@\n-# Setting up `NgOptimizedImage`\n+# Configuring an image loader for `NgOptimizedImage`\n \n <div class=\"alert is-important\">\n \n The `NgOptimizedImage` directive is available for [developer preview](https://angular.io/guide/releases#developer-preview).\n It's ready for you to try, but it might change before it is stable.\n \n-</div>\n-\n-This tutorial explains how to set up the `NgOptimizedImage`. For information on using `NgOptimizedImage`, see [Getting Started with NgOptimizedImage](/guide/image-directive).\n+For information on using `NgOptimizedImage`, see [Getting Started with NgOptimizedImage](/guide/image-directive).\n \n-## Import `NgOptimizedImage`\n-\n-You can import `NgOptimizedImage` from the `@angular/common` module. The directive is defined as a [standalone directive](/guide/standalone-components), so components should import it directly.\n+</div>\n \n-## Configure an `ImageLoader`\n+These instructions explain how to set up an image loader for use with the `NgOptimizedImage`. \n \n-A \"loader\" is a function that generates the [image transformation URL](https://web.dev/image-cdns/#how-image-cdns-use-urls-to-indicate-optimization-options) for a given image file. When appropriate, `NgOptimizedImage` sets the size, format, and image quality transformations for an image.\n+A \"loader\" is a function that generates an [image transformation URL](https://web.dev/image-cdns/#how-image-cdns-use-urls-to-indicate-optimization-options) for a given image file. When appropriate, `NgOptimizedImage` sets the size, format, and image quality transformations for an image.\n \n-`NgOptimizedImage` provides a generic loader as well as loaders for various third-party image services; it also supports writing your own custom loader.\n+`NgOptimizedImage` provides both a generic loader that applies no transformations, as well as loaders for various third-party image services. It also supports writing your own custom loader.\n \n | Loader type| Behavior |\n |:--- |:--- |\n@@ -34,40 +30,7 @@ Based on the image services commonly used with Angular applications, `NgOptimize\n | ImageKit | `provideImageKitLoader` | [Documentation](https://docs.imagekit.io/) |\n | Imgix | `provideImgixLoader` | [Documentation](https://docs.imgix.com/) |\n \n-You must configure an image loader to use `NgOptimizedImage`.\n-\n-These instructions explain how to set up an image loader for use with the `NgOptimizedImage`. \n-\n-1. Import the `NgOptimizedImage` directive into the application by adding it to the `imports` section of an NgModule or a standalone Component.\n-\n-<code-example format=\"typescript\" language=\"typescript\">\n-import { NgOptimizedImage } from '@angular/common';\n-// Include NgOptimizedImage in the appropriate NgModule\n-@NgModule({\n-  imports: [\n-    // ... other imports\n-    NgOptimizedImage,\n-  ],\n-})\n-\n-class AppModule {}\n-</code-example>\n-\n-<code-example format=\"typescript\" language=\"typescript\">\n-@Component({\n-  standalone: true,\n-  imports: [\n-    // ... other imports\n-    NgOptimizedImage,\n-  ],\n-})\n-\n-class MyStandaloneComponent {}\n-</code-example>\n-\n-2. Configure a loader that you want to use.\n-\n-To use the **generic loader**: no additional code changes are necessary.\n+To use the **generic loader**: no additional code changes are necessary. This is the default behavior.\n \n To use an existing loader for a **third-party image service**: add the provider factory for your chosen service to the `providers` array. In the example below, the Imgix loader is used:\n \n\n---\n file path A: aio/content/guide/image-directive.md | file path B: aio/content/guide/image-directive.md\n\n@@ -9,22 +9,24 @@ It's ready for you to try, but it might change before it is stable.\n \n The `NgOptimizedImage` directive makes it easy to adopt performance best practices for loading images.\n \n-The `NgOptimizedImage` directive ensures that the loading of the [Largest Contentful Paint](http://web.dev/lcp) image is prioritized by:\n+The directive ensures that the loading of the [Largest Contentful Paint](http://web.dev/lcp) image is prioritized by:\n \n *   Automatically setting the `fetchpriority` attribute on the `<img>` tag\n *   Lazy loading other images by default\n *   Asserting that there is a corresponding preconnect link tag in the document head\n+*   Generating a [preload hint](https://developer.mozilla.org/en-US/docs/Web/HTML/Link_types/preload) if app is using SSR\n \n In addition to optimizing the loading of the LCP image, `NgOptimizedImage` enforces a number of image best practices:\n \n-*   Using [image URLs to apply image optimizations](https://web.dev/image-cdns/#how-image-cdns-use-urls-to-indicate-optimization-options)\n+*   Uses [image CDN URLs to apply image optimizations](https://web.dev/image-cdns/#how-image-cdns-use-urls-to-indicate-optimization-options)\n *   Requires that `width` and `height` are set\n *   Warns if `width` or `height` have been set incorrectly\n *   Warns if the image will be visually distorted when rendered\n \n ## Prerequisites\n \n-You will need to import the directive into your application. In addition, you will need to set up an image loader. These steps are explained in the [Setting up `NgOptimizedImage`](/guide/image-directive-setup) tutorial.\n+1. You will need to import `NgOptimizedImage` from the `@angular/common` module into your application. The directive is defined as a [standalone directive](/guide/standalone-components), so components should import it directly.\n+2. Consider setting up an image loader. These steps are explained in the [Configuring an image loader](/guide/image-directive-setup) tutorial.\n \n ## Usage in a template\n \n@@ -38,9 +40,18 @@ To activate the `NgOptimizedImage` directive, replace your image's `src` attribu\n \n </code-example>\n \n-The built-in third-party loaders prepend a shared base URL to `src`. If you're using one of these loaders (or any other loader that does this), make sure to omit the shared base URL path from `src` to prevent unnecessary duplication.\n+If you're using a built-in third-party loader, make sure to omit the base URL path from `src`, as that will be prepended automatically by the loader.\n \n-You must also set the `width` and `height` attributes. This is done to prevent [image-related layout shifts](https://web.dev/css-web-vitals/#images-and-layout-shifts).  The `width` and `height` attributes should reflect the [intrinsic size](https://developer.mozilla.org/en-US/docs/Glossary/Intrinsic_Size) of the image. During development, the `NgOptimizedImage` warns if it detects that the `width` and `height` attributes have been set incorrectly.\n+### Preventing layout shift\n+\n+To prevent [image-related layout shifts](https://web.dev/css-web-vitals/#images-and-layout-shifts), the directive enforces that you set the `width` and `height` attributes for each image.  \n+\n+* For responsive images, the `width` and `height` attributes should reflect\n+the [intrinsic size](https://developer.mozilla.org/en-US/docs/Glossary/Intrinsic_Size) of the image. \n+\n+* For fixed size images, the `width` and `height` attributes should reflect the desired rendered size of the image. The aspect ratio of these attributes should always match the intrinsic aspect ratio of the image.\n+\n+Note: if you don't know the size of your images, consider using \"fill mode\" to inherit the size of the parent container (see below).\n \n ### Marking images as `priority`\n \n@@ -57,7 +68,7 @@ Marking an image as `priority` applies the following optimizations:\n *   Sets `fetchpriority=high` (read more about priority hints [here](https://web.dev/priority-hints))\n *   Sets `loading=eager` (read more about native lazy loading [here](https://web.dev/browser-level-image-lazy-loading))\n \n-Angular displays a warning during development if the LCP element is an image that does not have the `priority` attribute. A page\u2019s LCP element can vary based on a number of factors - such as the dimensions of a user's screen. A page may have multiple images that should be marked `priority`. See [CSS for Web Vitals](https://web.dev/css-web-vitals/#images-and-largest-contentful-paint-lcp) for more details.\n+Angular displays a warning during development if the LCP element is an image that does not have the `priority` attribute. A page\u2019s LCP element can vary based on a number of factors - such as the dimensions of a user's screen, so a page may have multiple images that should be marked `priority`. See [CSS for Web Vitals](https://web.dev/css-web-vitals/#images-and-largest-contentful-paint-lcp) for more details.\n \n ### Adding resource hints\n \n@@ -71,12 +82,12 @@ You can add a [`preconnect` resource hint](https://web.dev/preconnect-and-dns-pr\n \n By default, if you use a loader for a third-party image service, the `NgOptimizedImage` directive will warn during development if it detects that there is no `preconnect` resource hint for the origin that serves the LCP image.\n \n-To disable these warnings, add `{ensurePreconnect: false}` to the arguments passed to the provider factory for your chosen image service:\n+To disable these warnings, inject the `PRECONNECT_CHECK_BLOCKLIST` token:\n \n <code-example format=\"typescript\" language=\"typescript\">\n \n providers: [\n-  provideImgixLoader('https://my.base.url', {ensurePreconnect: false})\n+  {provide: PRECONNECT_CHECK_BLOCKLIST, useValue: 'https://your-domain.com'}\n ],\n \n </code-example>\n@@ -99,9 +110,9 @@ Depending on the image's styling, adding `width` and `height` attributes may cau\n \n You can typically fix this by adding `height: auto` or `width: auto` to your image styles. For more information, see the [web.dev article on the `<img>` tag](https://web.dev/patterns/web-vitals-patterns/images/img-tag).\n \n-### Handling `srcset` attributes\n+### Requesting images at the correct size\n \n-Defining a [`srcset` attribute](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/srcset) ensures that the browser requests an image at the right size for your user's viewport, so it doesn't waste time downloading an image that's too large. 'NgOptimizedImage' generates an appropriate `srcset` for the image, based on the presence and value of the [`sizes` attribute](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/sizes) on the image tag.\n+Defining a [`srcset` attribute](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/srcset) ensures that the browser requests an image at the right size for your user's viewport, so it doesn't waste time downloading an image that's too large. `NgOptimizedImage` generates an appropriate `srcset` for the image, based on the presence and value of the [`sizes` attribute](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/sizes) on the image tag.\n \n #### Fixed-size images\n \n@@ -134,7 +145,7 @@ providers: [\n ],\n </code-example>\n \n-If you would like to manually define a `srcset` attribute, you can provide your own directly, or use the `ngSrcset` attribute:\n+If you would like to manually define a `srcset` attribute, you can provide your own using the `ngSrcset` attribute:\n \n <code-example format=\"html\" language=\"html\">\n \n@@ -142,7 +153,7 @@ If you would like to manually define a `srcset` attribute, you can provide your\n \n </code-example>\n \n-If the `ngSrcset` attribute is present, `NgOptimizedImage` generates and sets the `srcset` using the configured image loader. Do not include image file names in `ngSrcset` - the directive infers this information from `ngSrc`. The directive supports both width descriptors (e.g. `100w`) and density descriptors (e.g. `1x`) are supported.\n+If the `ngSrcset` attribute is present, `NgOptimizedImage` generates and sets the `srcset` based on the sizes included. Do not include image file names in `ngSrcset` - the directive infers this information from `ngSrc`. The directive supports both width descriptors (e.g. `100w`) and density descriptors (e.g. `1x`) are supported.\n \n <code-example format=\"html\" language=\"html\">\n \n\n---\n file path A: aio/content/navigation.json | file path B: aio/content/navigation.json\n\n@@ -822,8 +822,8 @@\n         },\n         {\n           \"url\": \"guide/image-directive-setup\",\n-          \"title\": \"Setting up NgOptimizedImage\",\n-          \"tooltip\": \"Setup the Angular image directive\"\n+          \"title\": \"Configuring an image loader for NgOptimizedImage\",\n+          \"tooltip\": \"Set up an image loader for the Angular image directive\"\n         },\n         {\n           \"title\": \"Angular Libraries\",\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -262,7 +262,8 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   @Input() sizes?: string;\n \n   /**\n-   * The intrinsic width of the image in pixels.\n+   * For responsive images: the intrinsic width of the image in pixels.\n+   * For fixed size images: the desired rendered width of the image in pixels.\n    */\n   @Input()\n   set width(value: string|number|undefined) {\n@@ -275,7 +276,9 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   private _width?: number;\n \n   /**\n-   * The intrinsic height of the image in pixels.\n+   * For responsive images: the intrinsic height of the image in pixels.\n+   * For fixed size images: the desired rendered height of the image in pixels.* The intrinsic\n+   * height of the image in pixels.\n    */\n   @Input()\n   set height(value: string|number|undefined) {\n\n\n###\n\n", "completion": "docs(common): update image directive docs (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/route-animations.md | file path B: aio/content/guide/route-animations.md\n\n@@ -1,5 +1,7 @@\n # Route transition animations\n \n+Routing enables users to navigate between different routes in an application.\n+\n ## Prerequisites\n \n A basic understanding of the following concepts:\n@@ -8,13 +10,14 @@ A basic understanding of the following concepts:\n *   [Transition and triggers](guide/transition-and-triggers)\n *   [Reusable animations](guide/reusable-animations)\n \n-Routing enables users to navigate between different routes in an application.\n+## Enable routing transition animation\n+\n When a user navigates from one route to another, the Angular router maps the URL path to a relevant component and displays its view.\n Animating this route transition can greatly enhance the user experience.\n \n The Angular router comes with high-level animation functions that let you animate the transitions between views when a route changes.\n To produce an animation sequence when switching between routes, you need to define nested animation sequences.\n-Start with the top-level component that hosts the view, and nest additional animations in the components that host the embedded views.\n+Start with the top-level component that hosts the view, and nest animations in the components that host the embedded views.\n \n To enable routing transition animation, do the following:\n \n@@ -24,7 +27,7 @@ To enable routing transition animation, do the following:\n \n Illustrate a router transition animation by navigating between two routes, *Home* and *About* associated with the `HomeComponent` and `AboutComponent` views respectively.\n Both of these component views are children of the top-most view, hosted by `AppComponent`.\n-We'll implement a router transition animation that slides in the new view to the right and slides out the old view when the user navigates between the two routes.\n+Implement a router transition animation that slides in the new view to the right and slides out the old view when navigating between the two routes.\n \n <div class=\"lightbox\">\n \n@@ -55,10 +58,8 @@ The following configuration defines the possible routes for the application.\n The `home` and `about` paths are associated with the `HomeComponent` and `AboutComponent` views.\n The route configuration tells the Angular router to instantiate the `HomeComponent` and `AboutComponent` views when the navigation matches the corresponding path.\n \n-In addition to `path` and `component`, the `data` property of each route defines the key animation-specific configuration associated with a route.\n+The `data` property of each route defines the key animation-specific configuration associated with a route.\n The `data` property value is passed into `AppComponent` when the route changes.\n-You can also pass additional data in route configuration that is consumed within the animation.\n-The data property value has to match the transitions defined in the `routeAnimation` trigger, which we'll define shortly.\n \n <div class=\"alert is-helpful\">\n \n@@ -74,7 +75,7 @@ After configuring the routes, add a `<router-outlet>` inside the root `AppCompon\n The `<router-outlet>` directive tells the Angular router where to render the views when matched with a route.\n \n The `ChildrenOutletContexts` holds information about outlets and activated routes.\n-We can use the `data` property of each `Route` to animate our routing transitions.\n+The `data` property of each `Route` can be used to animate routing transitions.\n \n <code-example header=\"src/app/app.component.html\" path=\"animations/src/app/app.component.html\" region=\"route-animations-outlet\"></code-example>\n \n@@ -84,13 +85,13 @@ Here's an example of an `AppComponent` method that detects when a route change h\n \n <code-example header=\"src/app/app.component.ts\" path=\"animations/src/app/app.component.ts\" region=\"get-route-animations-data\"></code-example>\n \n-Here, the `getRouteAnimationData()` method takes the value of the outlet and returns a string that represents the state of the animation based on the custom data of the current active route.\n-Use this data to control which transition to execute for each route.\n+The `getRouteAnimationData()` method takes the value of the outlet. It returns a string that represents the state of the animation based on the custom data of the current active route.\n+Use this data to control which transition to run for each route.\n \n ## Animation definition\n \n Animations can be defined directly inside your components.\n-For this example you are defining the animations in a separate file, which lets us re-use the animations.\n+For this example you are defining the animations in a separate file, which allows re-use of animations.\n \n The following code snippet defines a reusable animation named `slideInAnimation`.\n \n@@ -115,9 +116,7 @@ Make the animation definition available in your application by adding the reusab\n \n <code-example header=\"src/app/app.component.ts\" path=\"animations/src/app/app.component.ts\" region=\"define\"></code-example>\n \n-So, let's break down the animation definition and see more closely what it does&hellip;\n-\n-### Styling the host and child components\n+### Style the host and child components\n \n During a transition, a new view is inserted directly after the old one and both elements appear on screen at the same time.\n To prevent this behavior, update the host view to use relative positioning.\n@@ -126,7 +125,7 @@ Adding these styles to the views animates the containers in place and prevents o\n \n <code-example header=\"src/app/animations.ts (excerpt)\" path=\"animations/src/app/animations.ts\" region=\"style-view\"></code-example>\n \n-### Querying the view containers\n+### Query the view containers\n \n Use the `query()` method to find and animate elements within the current host component.\n The `query(\":enter\")` statement returns the view that is being inserted, and `query(\":leave\")` returns the view that is being removed.\n@@ -159,10 +158,4 @@ You might also be interested in the following:\n *   [Complex animation sequences](guide/complex-animation-sequences)\n *   [Reusable animations](guide/reusable-animations)\n \n-<!-- links -->\n-\n-<!-- external links -->\n-\n-<!-- end links -->\n-\n-@reviewed 2022-02-28\n+@reviewed 2022-10-11\n\n\n###\n\n", "completion": "docs: Linting suggested corrections made. Restructuring or rewording sentences to be shorter and clearer. Inserted an introductory paragraph under level 1 heading. (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -814,7 +814,8 @@ function assertNonEmptyWidthAndHeight(dir: NgOptimizedImage) {\n         `${imgDirectiveDetails(dir.ngSrc)} these required attributes ` +\n             `are missing: ${missingAttributes.map(attr => `\"${attr}\"`).join(', ')}. ` +\n             `Including \"width\" and \"height\" attributes will prevent image-related layout shifts. ` +\n-            `To fix this, include \"width\" and \"height\" attributes on the image tag.`);\n+            `To fix this, include \"width\" and \"height\" attributes on the image tag or turn on ` +\n+            `\"fill\" mode with the \\`fill\\` attribute.`);\n   }\n }\n \n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -344,7 +344,8 @@ describe('Image directive', () => {\n               'element with the `ngSrc=\"img.png\"`) has detected that these ' +\n               'required attributes are missing: \"width\", \"height\". Including \"width\" and ' +\n               '\"height\" attributes will prevent image-related layout shifts. ' +\n-              'To fix this, include \"width\" and \"height\" attributes on the image tag.');\n+              'To fix this, include \"width\" and \"height\" attributes on the image tag or turn on ' +\n+              '\"fill\" mode with the `fill` attribute.');\n     });\n \n     it('should throw if `width` is not set', () => {\n@@ -360,7 +361,8 @@ describe('Image directive', () => {\n               'element with the `ngSrc=\"img.png\"`) has detected that these ' +\n               'required attributes are missing: \"width\". Including \"width\" and ' +\n               '\"height\" attributes will prevent image-related layout shifts. ' +\n-              'To fix this, include \"width\" and \"height\" attributes on the image tag.');\n+              'To fix this, include \"width\" and \"height\" attributes on the image tag or turn on ' +\n+              '\"fill\" mode with the `fill` attribute.');\n     });\n \n     it('should throw if `width` is 0', () => {\n@@ -406,7 +408,8 @@ describe('Image directive', () => {\n               'element with the `ngSrc=\"img.png\"`) has detected that these required ' +\n               'attributes are missing: \"height\". Including \"width\" and \"height\" ' +\n               'attributes will prevent image-related layout shifts. ' +\n-              'To fix this, include \"width\" and \"height\" attributes on the image tag.');\n+              'To fix this, include \"width\" and \"height\" attributes on the image tag or turn on ' +\n+              '\"fill\" mode with the `fill` attribute.');\n     });\n \n     it('should throw if `height` is 0', () => {\n\n\n###\n\n", "completion": "fix(common): update size error to mention 'fill' mode (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/index.md | file path B: goldens/public-api/common/index.md\n\n@@ -567,14 +567,12 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n     set priority(value: string | boolean | undefined);\n     // (undocumented)\n     get priority(): boolean;\n-    // @deprecated\n-    set rawSrc(value: string);\n     sizes?: string;\n     set width(value: string | number | undefined);\n     // (undocumented)\n     get width(): number | undefined;\n     // (undocumented)\n-    static \u0275dir: i0.\u0275\u0275DirectiveDeclaration<NgOptimizedImage, \"img[ngSrc],img[rawSrc]\", never, { \"rawSrc\": \"rawSrc\"; \"ngSrc\": \"ngSrc\"; \"ngSrcset\": \"ngSrcset\"; \"sizes\": \"sizes\"; \"width\": \"width\"; \"height\": \"height\"; \"loading\": \"loading\"; \"priority\": \"priority\"; \"disableOptimizedSrcset\": \"disableOptimizedSrcset\"; \"fill\": \"fill\"; \"src\": \"src\"; \"srcset\": \"srcset\"; }, {}, never, never, true, never>;\n+    static \u0275dir: i0.\u0275\u0275DirectiveDeclaration<NgOptimizedImage, \"img[ngSrc]\", never, { \"ngSrc\": \"ngSrc\"; \"ngSrcset\": \"ngSrcset\"; \"sizes\": \"sizes\"; \"width\": \"width\"; \"height\": \"height\"; \"loading\": \"loading\"; \"priority\": \"priority\"; \"disableOptimizedSrcset\": \"disableOptimizedSrcset\"; \"fill\": \"fill\"; \"src\": \"src\"; \"srcset\": \"srcset\"; }, {}, never, never, true, never>;\n     // (undocumented)\n     static \u0275fac: i0.\u0275\u0275FactoryDeclaration<NgOptimizedImage, never>;\n }\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -207,7 +207,7 @@ export const IMAGE_CONFIG = new InjectionToken<ImageConfig>(\n  */\n @Directive({\n   standalone: true,\n-  selector: 'img[ngSrc],img[rawSrc]',\n+  selector: 'img[ngSrc]',\n   host: {\n     '[style.position]': 'fill ? \"absolute\" : null',\n     '[style.width]': 'fill ? \"100%\" : null',\n@@ -235,29 +235,6 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n    */\n   private _renderedSrc: string|null = null;\n \n-  /**\n-   * Previously, the `rawSrc` attribute was used to activate the directive.\n-   * The attribute was renamed to `ngSrc` and this input just produces an error,\n-   * suggesting to switch to `ngSrc` instead.\n-   *\n-   * This error should be removed in v15.\n-   *\n-   * @nodoc\n-   * @deprecated Use `ngSrc` instead.\n-   */\n-  @Input()\n-  set rawSrc(value: string) {\n-    if (ngDevMode) {\n-      throw new RuntimeError(\n-          RuntimeErrorCode.INVALID_INPUT,\n-          `${imgDirectiveDetails(value, false)} the \\`rawSrc\\` attribute was used ` +\n-              `to activate the directive. Newer version of the directive uses the \\`ngSrc\\` ` +\n-              `attribute instead. Please replace \\`rawSrc\\` with \\`ngSrc\\` and ` +\n-              `\\`rawSrcset\\` with \\`ngSrcset\\` attributes in the template to ` +\n-              `enable image optimizations.`);\n-    }\n-  }\n-\n   /**\n    * Name of the source image.\n    * Image name will be processed by the image loader and the final URL will be applied as the `src`\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -288,21 +288,6 @@ describe('Image directive', () => {\n               'attribute.');\n     });\n \n-    it('should throw if an old `rawSrc` is present', () => {\n-      setupTestingModule();\n-\n-      const template = '<img rawSrc=\"path/img.png\" src=\"path/img2.png\" width=\"100\" height=\"50\">';\n-      expect(() => {\n-        const fixture = createTestComponent(template);\n-        fixture.detectChanges();\n-      })\n-          .toThrowError(\n-              'NG02952: The NgOptimizedImage directive has detected that the `rawSrc` ' +\n-              'attribute was used to activate the directive. Newer version of the directive uses ' +\n-              'the `ngSrc` attribute instead. Please replace `rawSrc` with `ngSrc` and ' +\n-              '`rawSrcset` with `ngSrcset` attributes in the template to enable image optimizations.');\n-    });\n-\n     it('should throw if `ngSrc` contains a Base64-encoded image (that starts with `data:`)', () => {\n       setupTestingModule();\n \n\n\n###\n\n", "completion": "refactor(common): drop deprecated selector from the NgOptimizedImage directive (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/errors.md | file path B: goldens/public-api/common/errors.md\n\n@@ -15,6 +15,8 @@ export const enum RuntimeErrorCode {\n     // (undocumented)\n     LCP_IMG_MISSING_PRIORITY = 2955,\n     // (undocumented)\n+    MISSING_BUILTIN_LOADER = 2962,\n+    // (undocumented)\n     NG_FOR_MISSING_DIFFER = -2200,\n     // (undocumented)\n     OVERSIZED_IMAGE = 2960,\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts\n\n@@ -6,7 +6,23 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {createImageLoader, ImageLoaderConfig} from './image_loader';\n+import {createImageLoader, ImageLoaderConfig, ImageLoaderInfo} from './image_loader';\n+\n+/**\n+ * Name and URL tester for Cloudinary.\n+ */\n+export const cloudinaryLoaderInfo: ImageLoaderInfo = {\n+  name: 'Cloudinary',\n+  testUrl: isCloudinaryUrl\n+};\n+\n+const CLOUDINARY_LOADER_REGEX = /https?\\:\\/\\/[^\\/]+\\.cloudinary\\.com\\/.+/;\n+/**\n+ * Tests whether a URL is from Cloudinary CDN.\n+ */\n+function isCloudinaryUrl(url: string): boolean {\n+  return CLOUDINARY_LOADER_REGEX.test(url);\n+}\n \n /**\n  * Function that generates an ImageLoader for Cloudinary and turns it into an Angular provider.\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts\n\n@@ -46,7 +46,15 @@ export type ImageLoader = (config: ImageLoaderConfig) => string;\n  * @see `ImageLoader`\n  * @see `NgOptimizedImage`\n  */\n-const noopImageLoader = (config: ImageLoaderConfig) => config.src;\n+export const noopImageLoader = (config: ImageLoaderConfig) => config.src;\n+\n+/**\n+ * Metadata about the image loader.\n+ */\n+export type ImageLoaderInfo = {\n+  name: string,\n+  testUrl: (url: string) => boolean\n+};\n \n /**\n  * Injection token that configures the image loader function.\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts\n\n@@ -6,7 +6,23 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {createImageLoader, ImageLoaderConfig} from './image_loader';\n+import {createImageLoader, ImageLoaderConfig, ImageLoaderInfo} from './image_loader';\n+\n+/**\n+ * Name and URL tester for ImageKit.\n+ */\n+export const imageKitLoaderInfo: ImageLoaderInfo = {\n+  name: 'ImageKit',\n+  testUrl: isImageKitUrl\n+};\n+\n+const IMAGE_KIT_LOADER_REGEX = /https?\\:\\/\\/[^\\/]+\\.imagekit\\.io\\/.+/;\n+/**\n+ * Tests whether a URL is from ImageKit CDN.\n+ */\n+function isImageKitUrl(url: string): boolean {\n+  return IMAGE_KIT_LOADER_REGEX.test(url);\n+}\n \n /**\n  * Function that generates an ImageLoader for ImageKit and turns it into an Angular provider.\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts\n\n@@ -6,7 +6,23 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {createImageLoader, ImageLoaderConfig} from './image_loader';\n+import {createImageLoader, ImageLoaderConfig, ImageLoaderInfo} from './image_loader';\n+\n+/**\n+ * Name and URL tester for Imgix.\n+ */\n+export const imgixLoaderInfo: ImageLoaderInfo = {\n+  name: 'Imgix',\n+  testUrl: isImgixUrl\n+};\n+\n+const IMGIX_LOADER_REGEX = /https?\\:\\/\\/[^\\/]+\\.imgix\\.net\\/.+/;\n+/**\n+ * Tests whether a URL is from Imgix CDN.\n+ */\n+function isImgixUrl(url: string): boolean {\n+  return IMGIX_LOADER_REGEX.test(url);\n+}\n \n /**\n  * Function that generates an ImageLoader for Imgix and turns it into an Angular provider.\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -12,7 +12,10 @@ import {RuntimeErrorCode} from '../../errors';\n import {isPlatformServer} from '../../platform_id';\n \n import {imgDirectiveDetails} from './error_helper';\n-import {IMAGE_LOADER} from './image_loaders/image_loader';\n+import {cloudinaryLoaderInfo} from './image_loaders/cloudinary_loader';\n+import {IMAGE_LOADER, ImageLoader, noopImageLoader} from './image_loaders/image_loader';\n+import {imageKitLoaderInfo} from './image_loaders/imagekit_loader';\n+import {imgixLoaderInfo} from './image_loaders/imgix_loader';\n import {LCPImageObserver} from './lcp_image_observer';\n import {PreconnectLinkChecker} from './preconnect_link_checker';\n import {PreloadLinkCreator} from './preload-link-creator';\n@@ -72,6 +75,9 @@ const ASPECT_RATIO_TOLERANCE = .1;\n  */\n const OVERSIZED_IMAGE_TOLERANCE = 1000;\n \n+/** Info about built-in loaders we can test for. */\n+export const BUILT_IN_LOADERS = [imgixLoaderInfo, imageKitLoaderInfo, cloudinaryLoaderInfo];\n+\n /**\n  * A configuration object for the NgOptimizedImage directive. Contains:\n  * - breakpoints: An array of integer breakpoints used to generate\n@@ -385,6 +391,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n       if (!this.ngSrcset) {\n         assertNoComplexSizes(this);\n       }\n+      assertNotMissingBuiltInLoader(this.ngSrc, this.imageLoader);\n       if (this.priority) {\n         const checker = this.injector.get(PreconnectLinkChecker);\n         checker.assertPreconnect(this.getRewrittenSrc(), this.ngSrc);\n@@ -873,3 +880,35 @@ function assertValidLoadingInput(dir: NgOptimizedImage) {\n             `To fix this, provide a valid value (\"lazy\", \"eager\", or \"auto\").`);\n   }\n }\n+\n+/**\n+ * Warns if NOT using a loader (falling back to the generic loader) and\n+ * the image appears to be hosted on one of the image CDNs for which\n+ * we do have a built-in image loader. Suggests switching to the\n+ * built-in loader.\n+ *\n+ * @param ngSrc Value of the ngSrc attribute\n+ * @param imageLoader ImageLoader provided\n+ */\n+function assertNotMissingBuiltInLoader(ngSrc: string, imageLoader: ImageLoader) {\n+  if (imageLoader === noopImageLoader) {\n+    let builtInLoaderName = '';\n+    for (const loader of BUILT_IN_LOADERS) {\n+      if (loader.testUrl(ngSrc)) {\n+        builtInLoaderName = loader.name;\n+        break;\n+      }\n+    }\n+    if (builtInLoaderName) {\n+      console.warn(formatRuntimeError(\n+          RuntimeErrorCode.MISSING_BUILTIN_LOADER,\n+          `NgOptimizedImage: It looks like your images may be hosted on the ` +\n+              `${builtInLoaderName} CDN, but your app is not using Angular's ` +\n+              `built-in loader for that CDN. We recommend switching to use ` +\n+              `the built-in by calling \\`provide${builtInLoaderName}Loader()\\` ` +\n+              `in your \\`providers\\` and passing it your instance's base URL. ` +\n+              `If you don't want to use the built-in loader, define a custom ` +\n+              `loader function using IMAGE_LOADER to silence this warning.`));\n+    }\n+  }\n+}\n\n---\n file path A: packages/common/src/errors.ts | file path B: packages/common/src/errors.ts\n\n@@ -32,4 +32,5 @@ export const enum RuntimeErrorCode {\n   INVALID_LOADER_ARGUMENTS = 2959,\n   OVERSIZED_IMAGE = 2960,\n   TOO_MANY_PRELOADED_IMAGES = 2961,\n+  MISSING_BUILTIN_LOADER = 2962,\n }\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -1097,6 +1097,56 @@ describe('Image directive', () => {\n       expect(img.src).toBe(`${IMG_BASE_URL}/img.png`);\n     });\n \n+    it('should warn if there is no image loader but using Imgix URL', () => {\n+      setUpModuleNoLoader();\n+\n+      const template = `<img ngSrc=\"https://some.imgix.net/img.png\" width=\"100\" height=\"50\">`;\n+      const fixture = createTestComponent(template);\n+      const consoleWarnSpy = spyOn(console, 'warn');\n+      fixture.detectChanges();\n+\n+      expect(consoleWarnSpy.calls.count()).toBe(1);\n+      expect(consoleWarnSpy.calls.argsFor(0)[0])\n+          .toMatch(/your images may be hosted on the Imgix CDN/);\n+    });\n+\n+    it('should warn if there is no image loader but using ImageKit URL', () => {\n+      setUpModuleNoLoader();\n+\n+      const template = `<img ngSrc=\"https://some.imagekit.io/img.png\" width=\"100\" height=\"50\">`;\n+      const fixture = createTestComponent(template);\n+      const consoleWarnSpy = spyOn(console, 'warn');\n+      fixture.detectChanges();\n+\n+      expect(consoleWarnSpy.calls.count()).toBe(1);\n+      expect(consoleWarnSpy.calls.argsFor(0)[0])\n+          .toMatch(/your images may be hosted on the ImageKit CDN/);\n+    });\n+\n+    it('should warn if there is no image loader but using Cloudinary URL', () => {\n+      setUpModuleNoLoader();\n+\n+      const template = `<img ngSrc=\"https://some.cloudinary.com/img.png\" width=\"100\" height=\"50\">`;\n+      const fixture = createTestComponent(template);\n+      const consoleWarnSpy = spyOn(console, 'warn');\n+      fixture.detectChanges();\n+\n+      expect(consoleWarnSpy.calls.count()).toBe(1);\n+      expect(consoleWarnSpy.calls.argsFor(0)[0])\n+          .toMatch(/your images may be hosted on the Cloudinary CDN/);\n+    });\n+\n+    it('should NOT warn if there is a custom loader but using CDN URL', () => {\n+      setupTestingModule();\n+\n+      const template = `<img ngSrc=\"https://some.cloudinary.com/img.png\" width=\"100\" height=\"50\">`;\n+      const fixture = createTestComponent(template);\n+      const consoleWarnSpy = spyOn(console, 'warn');\n+      fixture.detectChanges();\n+\n+      expect(consoleWarnSpy.calls.count()).toBe(0);\n+    });\n+\n     it('should set `src` using the image loader provided via the `IMAGE_LOADER` token to compose src URL',\n        () => {\n          const imageLoader = (config: ImageLoaderConfig) => `${IMG_BASE_URL}/${config.src}`;\n@@ -1526,6 +1576,16 @@ function setupTestingModule(config?: {\n   });\n }\n \n+// Same as above but explicitly doesn't provide a custom loader,\n+// so the noopImageLoader should be used.\n+function setUpModuleNoLoader() {\n+  TestBed.configureTestingModule({\n+    declarations: [TestComponent],\n+    imports: [CommonModule, NgOptimizedImage],\n+    providers: [{provide: DOCUMENT, useValue: window.document}]\n+  });\n+}\n+\n function createTestComponent(template: string): ComponentFixture<TestComponent> {\n   return TestBed.overrideComponent(TestComponent, {set: {template: template}})\n       .createComponent(TestComponent);\n\n\n###\n\n", "completion": "fix(common): warn if using supported CDN but not built-in loader (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/standalone-components.md | file path B: aio/content/guide/standalone-components.md\n\n@@ -1,13 +1,6 @@\n # Getting started with standalone components\n \n-<div class=\"alert is-important\">\n-\n-The standalone component feature is available for [developer preview](https://angular.io/guide/releases#developer-preview).\n-It's ready for you to try, but it might change before it is stable.\n-\n-</div>\n-\n-In v14 and higher, **standalone components** provide a simplified way to build Angular applications. Standalone components, directives, and pipes aim to streamline the authoring experience by reducing the need for `NgModule`s. Existing applications can optionally and incrementally adopt the new standalone style without any breaking changes.\n+**Standalone components** provide a simplified way to build Angular applications. Standalone components, directives, and pipes aim to streamline the authoring experience by reducing the need for `NgModule`s. Existing applications can optionally and incrementally adopt the new standalone style without any breaking changes.\n \n ## Creating standalone components\n \n\n---\n file path A: aio/content/navigation.json | file path B: aio/content/navigation.json\n\n@@ -314,6 +314,11 @@\n           \"title\": \"Overview\",\n           \"tooltip\": \"A list of developer guides for building Angular applications.\"\n         },\n+        {\n+          \"url\": \"guide/standalone-components\",\n+          \"title\": \"Standalone components\",\n+          \"tooltip\": \"Standalone components, directives, and pipes\"\n+        },\n         {\n           \"title\": \"Change detection\",\n           \"tooltip\": \"Learn how Angular updates the view based on data changes and how to keep your application fast\",\n@@ -852,11 +857,6 @@\n       \"title\": \"Feature preview\",\n       \"tooltip\": \"Angular preview features and APIs\",\n       \"children\": [\n-        {\n-          \"url\": \"guide/standalone-components\",\n-          \"title\": \"Standalone components\",\n-          \"tooltip\": \"Standalone components, directives, and pipes\"\n-        },\n         {\n           \"url\": \"guide/image-directive\",\n           \"title\": \"Image Directive\",\n\n---\n file path A: packages/common/testing/src/provide_location_mocks.ts | file path B: packages/common/testing/src/provide_location_mocks.ts\n\n@@ -16,7 +16,6 @@ import {MockLocationStrategy} from './mock_location_strategy';\n  * Returns mock providers for the `Location` and `LocationStrategy` classes.\n  * The mocks are helpful in tests to fire simulated location events.\n  *\n- * @developerPreview\n  * @publicApi\n  */\n export function provideLocationMocks(): Provider[] {\n\n---\n file path A: packages/core/src/di/provider_collection.ts | file path B: packages/core/src/di/provider_collection.ts\n\n@@ -37,7 +37,6 @@ export function makeEnvironmentProviders(providers: Provider[]): EnvironmentProv\n /**\n  * A source of providers for the `importProvidersFrom` function.\n  *\n- * @developerPreview\n  * @publicApi\n  */\n export type ImportProvidersSource =\n@@ -82,7 +81,6 @@ export type ImportProvidersSource =\n  *\n  * @returns Collected providers from the specified list of types.\n  * @publicApi\n- * @developerPreview\n  */\n export function importProvidersFrom(...sources: ImportProvidersSource[]): EnvironmentProviders {\n   return {\n\n---\n file path A: packages/core/src/di/r3_injector.ts | file path B: packages/core/src/di/r3_injector.ts\n\n@@ -73,8 +73,6 @@ interface Record<T> {\n /**\n  * An `Injector` that's part of the environment injector hierarchy, which exists outside of the\n  * component tree.\n- *\n- * @developerPreview\n  */\n export abstract class EnvironmentInjector implements Injector {\n   /**\n\n---\n file path A: packages/core/src/metadata/directives.ts | file path B: packages/core/src/metadata/directives.ts\n\n@@ -328,8 +328,6 @@ export interface Directive {\n    *\n    * More information about standalone components, directives, and pipes can be found in [this\n    * guide](guide/standalone-components).\n-   *\n-   * @developerPreview\n    */\n   standalone?: boolean;\n \n@@ -617,8 +615,6 @@ export interface Component extends Directive {\n    *\n    * More information about standalone components, directives, and pipes can be found in [this\n    * guide](guide/standalone-components).\n-   *\n-   * @developerPreview\n    */\n   standalone?: boolean;\n \n@@ -632,8 +628,6 @@ export interface Component extends Directive {\n    *\n    * More information about standalone components, directives, and pipes can be found in [this\n    * guide](guide/standalone-components).\n-   *\n-   * @developerPreview\n    */\n   imports?: (Type<any>|any[])[];\n \n\n---\n file path A: packages/core/src/render3/ng_module_ref.ts | file path B: packages/core/src/render3/ng_module_ref.ts\n\n@@ -154,7 +154,6 @@ class EnvironmentNgModuleRefAdapter extends viewEngine_NgModuleRef<null> {\n  *     messages.\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export function createEnvironmentInjector(\n     providers: Array<Provider|EnvironmentProviders>, parent: EnvironmentInjector,\n\n---\n file path A: packages/platform-browser/animations/src/module.ts | file path B: packages/platform-browser/animations/src/module.ts\n\n@@ -79,7 +79,6 @@ export class BrowserAnimationsModule {\n  * ```\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export function provideAnimations(): Provider[] {\n   // Return a copy to prevent changes to the original array in case any in-place\n@@ -118,7 +117,6 @@ export class NoopAnimationsModule {\n  * ```\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export function provideNoopAnimations(): Provider[] {\n   // Return a copy to prevent changes to the original array in case any in-place\n\n---\n file path A: packages/platform-browser/src/browser.ts | file path B: packages/platform-browser/src/browser.ts\n\n@@ -24,7 +24,6 @@ const NG_DEV_MODE = typeof ngDevMode === 'undefined' || !!ngDevMode;\n /**\n  * Set of config options available during the application bootstrap operation.\n  *\n- * @developerPreview\n  * @publicApi\n  */\n export interface ApplicationConfig {\n@@ -92,7 +91,6 @@ export interface ApplicationConfig {\n  * @returns A promise that returns an `ApplicationRef` instance once resolved.\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export function bootstrapApplication(\n     rootComponent: Type<unknown>, options?: ApplicationConfig): Promise<ApplicationRef> {\n@@ -110,7 +108,6 @@ export function bootstrapApplication(\n  * @returns A promise that returns an `ApplicationRef` instance once resolved.\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export function createApplication(options?: ApplicationConfig) {\n   return internalCreateApplication(createProvidersConfig(options));\n@@ -135,7 +132,6 @@ function createProvidersConfig(options?: ApplicationConfig) {\n  * @returns An array of providers required to setup Testability for an application and make it\n  *     available for testing using Protractor.\n  *\n- * @developerPreview\n  * @publicApi\n  */\n export function provideProtractorTestingSupport(): Provider[] {\n\n---\n file path A: packages/router/src/provide_router.ts | file path B: packages/router/src/provide_router.ts\n\n@@ -54,7 +54,6 @@ const NG_DEV_MODE = typeof ngDevMode === 'undefined' || ngDevMode;\n  * @see `RouterFeatures`\n  *\n  * @publicApi\n- * @developerPreview\n  * @param routes A set of `Route`s to use for the application routing table.\n  * @param features Optional features to configure additional router behaviors.\n  * @returns A set of providers to setup a Router.\n@@ -79,7 +78,6 @@ export function rootRoute(router: Router): ActivatedRoute {\n  * Helper type to represent a Router feature.\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export interface RouterFeature<FeatureKind extends RouterFeatureKind> {\n   \u0275kind: FeatureKind;\n@@ -122,7 +120,6 @@ export function provideRoutes(routes: Routes): Provider[] {\n  * @see `provideRouter`\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export type InMemoryScrollingFeature = RouterFeature<RouterFeatureKind.InMemoryScrollingFeature>;\n \n@@ -147,7 +144,6 @@ export type InMemoryScrollingFeature = RouterFeature<RouterFeatureKind.InMemoryS\n  * @see `ViewportScroller`\n  *\n  * @publicApi\n- * @developerPreview\n  * @param options Set of configuration parameters to customize scrolling behavior, see\n  *     `InMemoryScrollingOptions` for additional information.\n  * @returns A set of providers for use with `provideRouter`.\n@@ -236,7 +232,6 @@ const INITIAL_NAVIGATION = new InjectionToken<InitialNavigation>(\n  * @see `provideRouter`\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export type EnabledBlockingInitialNavigationFeature =\n     RouterFeature<RouterFeatureKind.EnabledBlockingInitialNavigationFeature>;\n@@ -250,7 +245,6 @@ export type EnabledBlockingInitialNavigationFeature =\n  * @see `provideRouter`\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export type InitialNavigationFeature =\n     EnabledBlockingInitialNavigationFeature|DisabledInitialNavigationFeature;\n@@ -278,7 +272,6 @@ export type InitialNavigationFeature =\n  * @see `provideRouter`\n  *\n  * @publicApi\n- * @developerPreview\n  * @returns A set of providers for use with `provideRouter`.\n  */\n export function withEnabledBlockingInitialNavigation(): EnabledBlockingInitialNavigationFeature {\n@@ -369,7 +362,6 @@ export function withEnabledBlockingInitialNavigation(): EnabledBlockingInitialNa\n  * @see `provideRouter`\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export type DisabledInitialNavigationFeature =\n     RouterFeature<RouterFeatureKind.DisabledInitialNavigationFeature>;\n@@ -399,7 +391,6 @@ export type DisabledInitialNavigationFeature =\n  * @returns A set of providers for use with `provideRouter`.\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export function withDisabledInitialNavigation(): DisabledInitialNavigationFeature {\n   const providers = [\n@@ -425,7 +416,6 @@ export function withDisabledInitialNavigation(): DisabledInitialNavigationFeatur\n  * @see `provideRouter`\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export type DebugTracingFeature = RouterFeature<RouterFeatureKind.DebugTracingFeature>;\n \n@@ -452,7 +442,6 @@ export type DebugTracingFeature = RouterFeature<RouterFeatureKind.DebugTracingFe\n  * @returns A set of providers for use with `provideRouter`.\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export function withDebugTracing(): DebugTracingFeature {\n   let providers: Provider[] = [];\n@@ -488,7 +477,6 @@ const ROUTER_PRELOADER = new InjectionToken<RouterPreloader>(NG_DEV_MODE ? 'rout\n  * @see `provideRouter`\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export type PreloadingFeature = RouterFeature<RouterFeatureKind.PreloadingFeature>;\n \n@@ -517,7 +505,6 @@ export type PreloadingFeature = RouterFeature<RouterFeatureKind.PreloadingFeatur\n  * @returns A set of providers for use with `provideRouter`.\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export function withPreloading(preloadingStrategy: Type<PreloadingStrategy>): PreloadingFeature {\n   const providers = [\n@@ -534,7 +521,6 @@ export function withPreloading(preloadingStrategy: Type<PreloadingStrategy>): Pr\n  * @see `provideRouter`\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export type RouterConfigurationFeature =\n     RouterFeature<RouterFeatureKind.RouterConfigurationFeature>;\n@@ -565,7 +551,6 @@ export type RouterConfigurationFeature =\n  * @returns A set of providers for use with `provideRouter`.\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export function withRouterConfig(options: RouterConfigOptions): RouterConfigurationFeature {\n   const providers = [\n@@ -583,7 +568,6 @@ export function withRouterConfig(options: RouterConfigOptions): RouterConfigurat\n  * @see `provideRouter`\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export type RouterFeatures = PreloadingFeature|DebugTracingFeature|InitialNavigationFeature|\n     InMemoryScrollingFeature|RouterConfigurationFeature;\n\n---\n file path A: packages/router/src/router_config.ts | file path B: packages/router/src/router_config.ts\n\n@@ -49,7 +49,6 @@ export type InitialNavigation = 'disabled'|'enabledBlocking'|'enabledNonBlocking\n  * Extra configuration options that can be used with the `withRouterConfig` function.\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export interface RouterConfigOptions {\n   /**\n@@ -115,7 +114,6 @@ export interface RouterConfigOptions {\n  * function.\n  *\n  * @publicApi\n- * @developerPreview\n  */\n export interface InMemoryScrollingOptions {\n   /**\n\n\n###\n\n", "completion": "docs: declare Standalone APIs as stable (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/zone.md | file path B: aio/content/guide/zone.md\n\n@@ -1,7 +1,11 @@\n+<!-- vale Angular.Google_Headings = NO -->\n+\n # NgZone\n \n+<!-- vale Angular.Google_Headings = YES -->\n+\n A zone is an execution context that persists across async tasks.\n-You can think of it as [thread-local storage](https://en.wikipedia.org/wiki/Thread-local_storage) for JavaScript VMs.\n+You can think of it as [thread-local storage](https://en.wikipedia.org/wiki/Thread-local_storage) for the JavaScript VM.\n This guide describes how to use Angular's NgZone to automatically detect changes in the component to update HTML.\n \n ## Fundamentals of change detection\n@@ -14,13 +18,13 @@ In Angular, you can display data by binding controls in an HTML template to the\n \n <code-example header=\"src/app/app.component.ts\" path=\"displaying-data/src/app/app.component.1.ts\"></code-example>\n \n-In addition, you can bind DOM events to a method of an Angular component.\n+You can also bind DOM events to a method of an Angular component.\n In such methods, you can also update a property of the Angular component, which updates the corresponding data displayed in the template.\n \n <code-example header=\"src/app/click-me.component.ts\" path=\"user-input/src/app/click-me.component.ts\" region=\"click-me-component\"></code-example>\n \n-In both of the above examples, the component's code updates only the property of the component.\n-However, the HTML is also updated automatically.\n+In both of the preceding examples, the component's code updates only the property of the component.\n+The HTML is also updated automatically.\n This guide describes how and when Angular renders the HTML based on the data from the Angular component.\n \n ### Detecting changes with plain JavaScript\n@@ -96,7 +100,7 @@ To clarify how changes are detected and values updated, consider the following c\n \n </code-example>\n \n-After you update the data, you need to call `detectChange()` manually to check whether the data changed.\n+After you update the data, you need to call `detectChange()` manually to see whether the data changed.\n If the data changed, you render the HTML to reflect the updated data.\n \n In Angular, this step is unnecessary.\n@@ -187,7 +191,7 @@ Typically, updates occur for one of the following reasons:\n     </code-example>\n \n 1.  Other async operations.\n-    In addition to `addEventListener()`, `setTimeout()` and `Promise.then()`, there are other operations that can update the data asynchronously.\n+    Besides `addEventListener()`, `setTimeout()` and `Promise.then()`, there are other operations that can update the data asynchronously.\n     Some examples include `WebSocket.onmessage()` and `Canvas.toBlob()`.\n \n     The preceding list contains most common scenarios in which the application might change the data.\n@@ -278,10 +282,10 @@ zone.run(() =&gt; {\n \n </code-example>\n \n-The above example creates a zone with several hooks.\n+The preceding example creates a zone with several hooks.\n \n The `onXXXTask` hooks trigger when the status of the task changes.\n-The concept of a *Zone Task* is very similar to the JavaScript VM Task concept:\n+The concept of a *Zone Task* is comparable to the JavaScript VM Task concept:\n \n *   `macroTask`: such as `setTimeout()`\n *   `microTask`: such as `Promise.then()`\n@@ -292,13 +296,13 @@ These hooks trigger under the following circumstances:\n | Hooks            | Details |\n |:---              |:---     |\n | `onScheduleTask` | Triggers when a new asynchronous task is scheduled, such as when you call `setTimeout()`.                                                                                                                                                         |\n-| `onInvokeTask`   | Triggers when an asynchronous task is about to execute, such as when the callback of `setTimeout()` is about to execute.                                                                                                                          |\n+| `onInvokeTask`   | Triggers when an asynchronous task is about to run, such as when the callback of `setTimeout()` is about to run.                                                                                                                          |\n | `onHasTask`      | Triggers when the status of one kind of task inside a zone changes from stable to unstable or from unstable to stable. A status of \"stable\" means there are no tasks inside the zone, while \"unstable\" means a new task is scheduled in the zone. |\n-| `onInvoke`       | Triggers when a synchronous function is going to execute in the zone.                                                                                                                                                                             |\n+| `onInvoke`       | Triggers when a synchronous function is going to run in the zone.                                                                                                                                                                             |\n \n-With these hooks, `Zone` can monitor the status of all synchronous and asynchronous operations inside a zone.\n+With these hooks, `Zone` can observe the status of all synchronous and asynchronous operations inside a zone.\n \n-The above example returns the following output:\n+The preceding example returns the following output:\n \n <code-example format=\"output\" hideCopy language=\"shell\">\n \n@@ -323,24 +327,32 @@ task state changed in the zone: { microTask: false,\n \n All of the functions of `Zone` are provided by a library called [Zone.js](https://github.com/angular/angular/tree/main/packages/zone.js/README.md).\n This library implements those features by intercepting asynchronous APIs through monkey patching.\n-Monkey patching is a technique to add or modify the default behavior of a function at runtime without changing the source code.\n+Monkey patching is a technique to add or alter the default behavior of a function at runtime without changing the source code.\n+\n+<!-- vale Angular.Google_Headings = NO -->\n \n ## NgZone\n \n-While Zone.js can monitor all the states of synchronous and asynchronous operations, Angular additionally provides a service called NgZone.\n+<!-- vale Angular.Google_Headings = YES -->\n+\n+While Zone.js can observe all the states of synchronous and asynchronous operations, Angular additionally provides a service called NgZone.\n This service creates a zone named `angular` to automatically trigger change detection when the following conditions are satisfied:\n \n 1.  When a sync or async function is executed\n 1.  When there is no `microTask` scheduled\n \n+<!-- vale Angular.Google_Headings = NO -->\n+\n ### NgZone `run()` and `runOutsideOfAngular()`\n \n+<!-- vale Angular.Google_Headings = YES -->\n+\n `Zone` handles most asynchronous APIs such as `setTimeout()`, `Promise.then()`, and `addEventListener()`.\n For the full list, see the [Zone Module document](https://github.com/angular/angular/blob/main/packages/zone.js/MODULE.md).\n-Therefore in those asynchronous APIs, you don't need to trigger change detection manually.\n+In those asynchronous APIs, you don't need to trigger change detection manually.\n \n-There are still some third party APIs that Zone does not handle.\n-In those cases, the `NgZone` service provides a [`run()`](api/core/NgZone#run) method that allows you to execute a function inside the Angular zone.\n+Some third party APIs are not handled by Zone.\n+In those cases, the `NgZone` service provides a [`run()`](api/core/NgZone#run) method that allows you to run a function inside the Angular zone.\n This function, and all asynchronous operations in that function, triggers change detection automatically at the correct time.\n \n <code-example format=\"typescript\" language=\"typescript\">\n@@ -384,10 +396,14 @@ export class AppComponent implements OnInit {\n \n </code-example>\n \n+<!-- vale Angular.Google_Headings = NO -->\n+\n ### Setting up Zone.js\n \n+<!-- vale Angular.Google_Headings = YES -->\n+\n To make Zone.js available in Angular, you need to import the `zone.js` package.\n-If you are using the Angular CLI, this step is done automatically, and you will see the following line in the `src/polyfills.ts`:\n+If you are using the Angular CLI, this step is done automatically, and you can see the following line in the `src/polyfills.ts`:\n \n <code-example format=\"typescript\" language=\"typescript\">\n \n@@ -398,15 +414,15 @@ import 'zone.js';  // Included with Angular CLI.\n \n </code-example>\n \n-Before importing the  `zone.js` package, you can set the following configurations:\n+Before importing the `zone.js` package, you can set the following configurations:\n \n-*   You can disable some asynchronous API monkey patching for better performance.\n-    For example, you can disable the `requestAnimationFrame()` monkey patch, so the callback of `requestAnimationFrame()` will not trigger change detection.\n-    This is useful if, in your application, the callback of the `requestAnimationFrame()` will not update any data.\n+*   Disabling some asynchronous API monkey patching for better performance.\n+    For example, disabling the `requestAnimationFrame()` monkey patch, so the callback of `requestAnimationFrame()` does not trigger change detection.\n+    This is useful if, in your application, the callback of the `requestAnimationFrame()` does not update any data.\n \n-*   You can specify that certain DOM events do not run inside the Angular zone; for example, to prevent a `mousemove` or `scroll` event to trigger change detection\n+*   Specify that certain DOM events do not run inside the Angular zone. For example, to prevent a `mousemove` or `scroll` event to trigger change detection\n \n-There are several other settings you can change.\n+Several other settings can be changed.\n To make these changes, you need to create a `zone-flags.ts` file, such as the following.\n \n <code-example format=\"typescript\" language=\"typescript\">\n@@ -433,18 +449,22 @@ import 'zone.js';  // Included with Angular CLI.\n \n For more information about what you can configure, see the [Zone.js](https://github.com/angular/angular/tree/main/packages/zone.js) documentation.\n \n+<!-- vale Angular.Google_Headings = NO -->\n+\n ### NoopZone\n \n+<!-- vale Angular.Google_Headings = YES -->\n+\n `Zone` helps Angular know when to trigger change detection and let the developers focus on the application development.\n-By default, `Zone` is loaded and works without additional configuration.\n-However, you don't necessarily have to use `Zone` to make Angular work.\n+By default, `Zone` is loaded and works without further configuration.\n+You don't necessarily have to use `Zone` to make Angular work.\n Instead, you can opt to trigger change detection on your own.\n \n <div class=\"callout is-helpful\">\n \n <header>Disabling Zone</header>\n \n-**If you disable `Zone`, you will need to trigger all change detection at the correct timing yourself, which requires comprehensive knowledge of change detection**.\n+**Disabling `Zone` requires you to trigger all change detection at the correct timing yourself, which requires comprehensive knowledge of change detection**.\n \n </div>\n \n\n\n###\n\n", "completion": "docs: fix linter errors for zone.md (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/web-worker.md | file path B: aio/content/guide/web-worker.md\n\n@@ -1,11 +1,11 @@\n # Background processing using web workers\n \n [Web workers](https://developer.mozilla.org/docs/Web/API/Web_Workers_API) lets you run CPU-intensive computations in a background thread, freeing the main thread to update the user interface.\n-If you find your application performs a lot of computations, such as generating CAD drawings or doing heavy geometrical calculations, using web workers can help increase your application's performance.\n+Application's performing a lot of computations, like generating Computer-Aided Design \\(CAD\\) drawings or doing heavy geometric calculations, can use web workers to increase performance.\n \n <div class=\"alert is-helpful\">\n \n-The CLI does not support running Angular itself in a web worker.\n+The Angular CLI does not support running itself in a web worker.\n \n </div>\n \n@@ -60,12 +60,12 @@ The command performs the following actions.\n \n     </code-example>\n \n-After you generate this initial scaffold, you must refactor your code to use the web worker by sending messages to and from the worker.\n+After you create this initial scaffold, you must refactor your code to use the web worker by sending messages to and from the worker.\n \n <div class=\"alert is-important\">\n \n Some environments or platforms, such as `@angular/platform-server` used in [Server-side Rendering](guide/universal), don't support web workers.\n-To ensure that your application will work in these environments, you must provide a fallback mechanism to perform the computations that the worker would otherwise perform.\n+To ensure that your application works in these environments, you must provide a fallback mechanism to perform the computations that the worker would otherwise perform.\n \n </div>\n \n\n\n###\n\n", "completion": "docs: fix linter errors for web-worker.md (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/view-encapsulation.md | file path B: aio/content/guide/view-encapsulation.md\n\n@@ -2,20 +2,24 @@\n \n In Angular, a component's styles can be encapsulated within the component's host element so that they don't affect the rest of the application.\n \n-The `Component`'s decorator provides the [`encapsulation`](api/core/Component#encapsulation) option which can be used to control how the encapsulation is applied on a *per component* basis.\n+The `Component` decorator provides the [`encapsulation`](api/core/Component#encapsulation) option which can be used to control how the encapsulation is applied on a *per component* basis.\n \n Choose from the following modes:\n \n+<!-- vale off -->\n+\n | Modes                         | Details |\n |:---                           |:---     |\n-| `ViewEncapsulation.ShadowDom` | Angular uses the browser's built-in [Shadow DOM API](https://developer.mozilla.org/docs/Web/Web_Components/Shadow_DOM) to enclose the component's view inside a ShadowRoot \\(used as the component's host element\\) and apply the provided styles in an isolated manner. <div class=\"alert is-important\"> `ViewEncapsulation.ShadowDom` only works on browsers that have built-in support for the shadow DOM \\(see [Can I use - Shadow DOM v1](https://caniuse.com/shadowdomv1)\\). Not all browsers support it, which is why the `ViewEncapsulation.Emulated` is the recommended and default mode. </div> |\n-| `ViewEncapsulation.Emulated`  | Angular modifies the component's CSS selectors so that they are only applied to the component's view and do not affect other elements in the application \\(*emulating* Shadow DOM behavior\\). For more details, see [Inspecting generated CSS](guide/view-encapsulation#inspect-generated-css).                                                                                                                                                                                                                                                                                                           |\n+| `ViewEncapsulation.ShadowDom` | Angular uses the browser's built-in [Shadow DOM API](https://developer.mozilla.org/docs/Web/Web_Components/Shadow_DOM) to enclose the component's view inside a ShadowRoot, used as the component's host element, and apply the provided styles in an isolated manner. <div class=\"alert is-important\"> `ViewEncapsulation.ShadowDom` only works on browsers that have built-in support for the shadow DOM \\(see [Can I use - Shadow DOM v1](https://caniuse.com/shadowdomv1)\\). Not all browsers support it, which is why the `ViewEncapsulation.Emulated` is the recommended and default mode. </div> |\n+| `ViewEncapsulation.Emulated`  | Angular modifies the component's CSS selectors so that they are only applied to the component's view and do not affect other elements in the application, *emulating* Shadow DOM behavior. For more details, see [Inspecting generated CSS](guide/view-encapsulation#inspect-generated-css).                                                                                                                                                                                                                                                                                                           |\n | `ViewEncapsulation.None`      | Angular does not apply any sort of view encapsulation meaning that any styles specified for the component are actually globally applied and can affect any HTML element present within the application. This mode is essentially the same as including the styles into the HTML itself.                                                                                                                                                                                                                                                                                                                   |\n \n <a id=\"inspect-generated-css\"></a>\n \n ## Inspecting generated CSS\n \n+<!-- vale on -->\n+\n When using the emulated view encapsulation, Angular pre-processes all the component's styles so that they are only applied to the component's view.\n \n In the DOM of a running Angular application, elements belonging to components using emulated view encapsulation have some extra attributes attached to them:\n@@ -31,7 +35,7 @@ In the DOM of a running Angular application, elements belonging to components us\n \n </code-example>\n \n-There are two kinds of such attributes:\n+Two kinds of these attributes exist:\n \n | Attributes   | Details |\n |:---          |:---     |\n@@ -39,9 +43,9 @@ There are two kinds of such attributes:\n | `_ngcontent` | Are added to child element within a component's view, those are used to match the elements with their respective emulated ShadowRoots \\(host elements with a matching `_nghost` attribute\\). |\n \n The exact values of these attributes are a private implementation detail of Angular.\n-They are automatically generated and you should never refer to them in application code.\n+They are automatically created and you should never refer to them in application code.\n \n-They are targeted by the generated component styles, which are injected in the `<head>` section of the DOM:\n+They are targeted by the created component styles, which are injected in the `<head>` section of the DOM:\n \n <code-example format=\"css\" language=\"css\">\n \n@@ -61,10 +65,10 @@ These modified selectors make sure the styles to be applied to components' views\n \n ## Mixing encapsulation modes\n \n-As previously mentioned you specify the encapsulation mode in the Component's decorator on a *per component* basis, this means that within your application you can have different components using different encapsulation strategies.\n+As mentioned earlier, you specify the encapsulation mode in the Component's decorator on a *per component* basis. This means that within your application you can have different components using different encapsulation strategies.\n \n Although possible, this is not recommended.\n-If it is really needed you should be aware of how the styles of components using different encapsulation modes will interact with each other:\n+If it is really needed, you should be aware of how the styles of components using different encapsulation modes interact with each other:\n \n | Modes                         | Details |\n |:---                           |:---     |\n@@ -76,9 +80,9 @@ If it is really needed you should be aware of how the styles of components using\n \n Styles of `ViewEncapsulation.Emulated` and `ViewEncapsulation.None` components are also added to the shadow DOM host of each `ViewEncapsulation.ShadowDom` component.\n \n-This means that styles for components with `ViewEncapsulation.None` will affect matching elements within shadow DOMs.\n+This means that styles for components with `ViewEncapsulation.None` affect matching elements within the shadow DOM.\n \n-This approach may seem counter-intuitive at first, but without it a component with `ViewEncapsulation.None` would be rendered differently within a component using `ViewEncapsulation.ShadowDom`, since its styles would not be available.\n+This approach may seem counter-intuitive at first. But without it a component with `ViewEncapsulation.None` would be rendered differently within a component using `ViewEncapsulation.ShadowDom`, since its styles would not be available.\n \n </div>\n \n@@ -97,8 +101,7 @@ This component colors its template elements red.\n \n Angular adds the styles for this component as global styles to the `<head>` of the document.\n \n-As already mentioned Angular also adds the styles to all shadow DOM hosts.\n-Therefore, the styles are available throughout the whole application.\n+As already mentioned, Angular also adds the styles to all shadow DOM hosts, making the styles available throughout the whole application.\n \n <div class=\"lightbox\">\n \n@@ -113,12 +116,12 @@ This component colors its template elements green.\n \n <code-example header=\"src/app/emulated-encapsulation.component.ts\" path=\"view-encapsulation/src/app/emulated-encapsulation.component.ts\"></code-example>\n \n-Similar to `ViewEncapsulation.None`, Angular adds the styles for this component to the `<head>` of the document, but with \"scoped\" styles.\n+Comparable to `ViewEncapsulation.None`, Angular adds the styles for this component to the `<head>` of the document, but with \"scoped\" styles.\n \n-Therefore, only the elements directly within this component's template will match its styles.\n-Since the \"scoped\" styles from the `EmulatedEncapsulationComponent` are very specific, they override the global styles from the `NoEncapsulationComponent`.\n+Only the elements directly within this component's template are going to match its styles.\n+Since the \"scoped\" styles from the `EmulatedEncapsulationComponent` are specific, they override the global styles from the `NoEncapsulationComponent`.\n \n-In this example, the `EmulatedEncapsulationComponent` contains a `NoEncapsulationComponent`, but `NoEncapsulationComponent` is still styled as expected since the `EmulatedEncapsulationComponent`'s \"scoped\" styles do not match elements in its template.\n+In this example, the `EmulatedEncapsulationComponent` contains a `NoEncapsulationComponent`, but `NoEncapsulationComponent` is still styled as expected since the `EmulatedEncapsulationComponent` 's \"scoped\" styles do not match elements in its template.\n \n <div class=\"lightbox\">\n \n@@ -138,7 +141,7 @@ Angular adds styles for this component only to the shadow DOM host, so they are\n <div class=\"alert is-helpful\">\n \n **NOTE**: <br />\n-Angular also adds the global styles from the `NoEncapsulationComponent` and `EmulatedEncapsulationComponent` to the shadow DOM host, so those styles are still available to the elements in the template of this component.\n+Angular also adds the global styles from the `NoEncapsulationComponent` and `EmulatedEncapsulationComponent` to the shadow DOM host. Those styles are still available to the elements in the template of this component.\n \n </div>\n \n@@ -148,7 +151,7 @@ The styles added by the `ShadowDomEncapsulationComponent` component are availabl\n \n The `EmulatedEncapsulationComponent` has specific \"scoped\" styles, so the styling of this component's template is unaffected.\n \n-But since styles from `ShadowDomEncapsulationComponent` are added to the shadow host after the global styles, the `h2` style overrides the style from the `NoEncapsulationComponent`.\n+Since styles from `ShadowDomEncapsulationComponent` are added to the shadow host after the global styles, the `h2` style overrides the style from the `NoEncapsulationComponent`.\n The result is that the `<h2>` element in the `NoEncapsulationComponent` is colored blue rather than red, which may not be what the component's author intended.\n \n <div class=\"lightbox\">\n\n\n###\n\n", "completion": "docs: fix linter errors for view-encapsulation.md (#<issue-num>)"}
{"prompt": " file path A: goldens/size-tracking/aio-payloads.json | file path B: goldens/size-tracking/aio-payloads.json\n\n@@ -2,7 +2,7 @@\n   \"aio\": {\n     \"uncompressed\": {\n       \"runtime\": 4325,\n-      \"main\": 455373,\n+      \"main\": 455143,\n       \"polyfills\": 33922,\n       \"styles\": 73964,\n       \"light-theme\": 78157,\n@@ -12,11 +12,11 @@\n   \"aio-local\": {\n     \"uncompressed\": {\n       \"runtime\": 4325,\n-      \"main\": 455738,\n-      \"polyfills\": 33922,\n-      \"styles\": 73640,\n-      \"light-theme\": 78045,\n-      \"dark-theme\": 78177\n+      \"main\": 455228,\n+      \"polyfills\": 33952,\n+      \"styles\": 73964,\n+      \"light-theme\": 78157,\n+      \"dark-theme\": 78289\n     }\n   }\n }\n\n\n###\n\n", "completion": "test: update size golden for main bundle reduction (#<issue-num>)"}
{"prompt": " file path A: aio/.browserslistrc | file path B: None\n\n@@ -1,16 +0,0 @@\n-# This file is used by the build system to adjust CSS and JS output to support the specified browsers below.\n-# For additional information regarding the format and rule options, please see:\n-# https://github.com/browserslist/browserslist#queries\n-\n-# For the full list of supported browsers by the Angular framework, please see:\n-# https://angular.io/guide/browser-support\n-\n-# You can see what browsers were selected by your queries by running:\n-#   npx browserslist\n-\n-last 1 Chrome version\n-last 1 Firefox version\n-last 2 Edge major versions\n-last 2 Safari major versions\n-last 2 iOS major versions\n-Firefox ESR\n\n---\n file path A: aio/content/examples/universal/src/main.server.ts | file path B: aio/content/examples/universal/src/main.server.ts\n\n@@ -7,4 +7,3 @@ if (environment.production) {\n }\n \n export { AppServerModule } from './app/app.server.module';\n-export { renderModule, renderModuleFactory } from '@angular/platform-server';\n\n---\n file path A: aio/src/test.ts | file path B: aio/src/test.ts\n\n@@ -7,20 +7,8 @@ import {\n   platformBrowserDynamicTesting\n } from '@angular/platform-browser-dynamic/testing';\n \n-declare const require: {\n-  context(path: string, deep?: boolean, filter?: RegExp): {\n-    <T>(id: string): T;\n-    keys(): string[];\n-  };\n-};\n-\n // First, initialize the Angular testing environment.\n getTestBed().initTestEnvironment(\n   BrowserDynamicTestingModule,\n   platformBrowserDynamicTesting(),\n );\n-\n-// Then we find all the tests.\n-const context = require.context('./', true, /\\.spec\\.ts$/);\n-// And load the modules.\n-context.keys().forEach(context);\n\n---\n file path A: aio/tsconfig.json | file path B: aio/tsconfig.json\n\n@@ -7,8 +7,6 @@\n     \"forceConsistentCasingInFileNames\": true,\n     \"strict\": true,\n     \"noImplicitOverride\": true,\n-    // NOTE: Intentionally deviate from default Angular CLI settings\n-    //       (due to many violations and uglier syntax).\n     \"noPropertyAccessFromIndexSignature\": false,\n     \"noImplicitReturns\": true,\n     \"noFallthroughCasesInSwitch\": true,\n@@ -20,15 +18,15 @@\n     \"experimentalDecorators\": true,\n     \"moduleResolution\": \"node\",\n     \"importHelpers\": true,\n-    \"target\": \"es2020\",\n+    \"target\": \"ES2022\",\n     \"module\": \"es2020\",\n     \"lib\": [\n       \"es2020\",\n       \"dom\"\n     ],\n     \"skipLibCheck\": true,\n-    // disabled because this is on by default in tsc 2.7 breaking our codebase - we need to refactor\n-    \"strictPropertyInitialization\": false\n+    \"strictPropertyInitialization\": false,\n+    \"useDefineForClassFields\": false\n   },\n   \"exclude\": [\n     \"aio-builds-setup\",\n\n\n###\n\n", "completion": "build: run ng update for Angular CLI next (#<issue-num>)"}
{"prompt": " file path A: aio/src/styles/2-modules/errors/_errors-theme.scss | file path B: aio/src/styles/2-modules/errors/_errors-theme.scss\n\n@@ -1,6 +1,9 @@\n+@use 'sass:map';\n @use '../../constants';\n \n @mixin theme($theme) {\n+  $is-dark-theme: map.get($theme, is-dark);\n+\n   .error-list {\n     li {\n       .symbol {\n@@ -17,7 +20,7 @@\n         color: constants.$blue-grey-600;\n \n         &:hover {\n-          background: constants.$blue-grey-50;\n+          background: if($is-dark-theme, constants.$darkgray, constants.$blue-grey-50);\n           color: constants.$blue-500;\n         }\n       }\n\n\n###\n\n", "completion": "docs(docs-infra): fix errors page hover styles (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/google-internal-tests.yml | file path B: .github/workflows/google-internal-tests.yml\n\n@@ -12,62 +12,9 @@ jobs:\n   trigger:\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: angular/dev-infra/github-actions/google-internal-tests@fac5f7cd944a71f4680a1754164a5fd92e3b8866\n+      - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n+      - uses: angular/dev-infra/github-actions/google-internal-tests@658ea9ec012d34882807f0be093812961af79cce\n         with:\n           run-tests-guide-url: http://go/angular/g3sync\n           github-token: ${{ secrets.GITHUB_TOKEN }}\n-          # List must be manually kept in sync with google3/third_party/javascript/angular2/copy.bara.sky\n-          synced-files: |\n-            LICENSE\n-            modules/benchmarks/**\n-            modules/system.d.ts\n-            packages/**\n-          # List of patterns which are always considered external, even when matching above.\n-          always-external-files: |\n-            packages/*\n-            packages/bazel/*\n-            packages/bazel/src/*\n-            packages/bazel/src/api-extractor/**\n-            packages/bazel/src/builders/**\n-            packages/bazel/src/ng_module/**\n-            packages/bazel/src/ng_package/**\n-            packages/bazel/src/protractor/**\n-            packages/bazel/src/schematics/**\n-            packages/bazel/src/types_bundle/**\n-            packages/compiler-cli/src/ngcc/**\n-            packages/compiler-cli/linker/**\n-            packages/compiler-cli/ngcc/**\n-            packages/compiler-cli/src/ngtsc/sourcemaps/**\n-            packages/compiler-cli/private/bazel.ts\n-            packages/compiler-cli/private/localize.ts\n-            packages/compiler-cli/private/tooling.ts\n-            packages/compiler-cli/private/babel.d.ts\n-            packages/compiler-cli/src/bin/**\n-            packages/docs/**\n-            packages/elements/schematics/**\n-            packages/examples/**\n-            packages/language-service/**\n-            packages/localize/**\n-            packages/private/**\n-            packages/service-worker/**\n-            packages/common/locales/generate-locales-tool/**\n-            packages/common/locales/index.bzl\n-            packages/http/**\n-            **/.gitignore\n-            **/.gitkeep\n-            **/yarn.lock\n-            **/package.json\n-            **/third_party/**\n-            **/tsconfig-build.json\n-            **/tsconfig-tsec.json\n-            **/tsconfig.json\n-            **/rollup.config.js\n-            **/BUILD.bazel\n-            **/*.md\n-            packages/**/integrationtest/**\n-            packages/**/test/**\n-            packages/zone.js/*\n-            packages/zone.js/dist/**\n-            packages/zone.js/doc/**\n-            packages/zone.js/example/**\n-            packages/zone.js/scripts/**\n+          sync-config: ./.ng-dev/google-sync-config.json\n\n---\n file path A: .ng-dev/caretaker.mts | file path B: .ng-dev/caretaker.mts\n\n@@ -2,6 +2,7 @@ import {CaretakerConfig} from '@angular/ng-dev';\n \n /** The configuration for `ng-dev caretaker` commands. */\n export const caretaker: CaretakerConfig = {\n+  g3SyncConfigPath: './.ng-dev/google-sync-config.json',\n   githubQueries: [\n     {\n       name: 'Merge Queue',\n@@ -9,7 +10,7 @@ export const caretaker: CaretakerConfig = {\n     },\n     {\n       name: 'Merge Assistance Queue',\n-      query: `is:pr is:open label:\"action: merge-assistance\"`,\n+      query: `is:pr is:open label:\"action: caretaker note\"`,\n     },\n     {\n       name: 'Initial Triage Queue',\n\n---\n file path A: None | file path B: .ng-dev/google-sync-config.json\n\n@@ -0,0 +1,52 @@\n+{\n+  \"syncedFilePatterns\": [\"LICENSE\", \"modules/benchmarks/**\", \"modules/system.d.ts\", \"packages/**\"],\n+  \"alwaysExternalFilePatterns\": [\n+    \"packages/*\",\n+    \"packages/bazel/*\",\n+    \"packages/bazel/src/*\",\n+    \"packages/bazel/src/api-extractor/**\",\n+    \"packages/bazel/src/builders/**\",\n+    \"packages/bazel/src/ng_module/**\",\n+    \"packages/bazel/src/ng_package/**\",\n+    \"packages/bazel/src/protractor/**\",\n+    \"packages/bazel/src/schematics/**\",\n+    \"packages/bazel/src/types_bundle/**\",\n+    \"packages/compiler-cli/src/ngcc/**\",\n+    \"packages/compiler-cli/linker/**\",\n+    \"packages/compiler-cli/ngcc/**\",\n+    \"packages/compiler-cli/src/ngtsc/sourcemaps/**\",\n+    \"packages/compiler-cli/private/bazel.ts\",\n+    \"packages/compiler-cli/private/localize.ts\",\n+    \"packages/compiler-cli/private/tooling.ts\",\n+    \"packages/compiler-cli/private/babel.d.ts\",\n+    \"packages/compiler-cli/src/bin/**\",\n+    \"packages/docs/**\",\n+    \"packages/elements/schematics/**\",\n+    \"packages/examples/**\",\n+    \"packages/language-service/**\",\n+    \"packages/localize/**\",\n+    \"packages/private/**\",\n+    \"packages/service-worker/**\",\n+    \"packages/common/locales/generate-locales-tool/**\",\n+    \"packages/common/locales/index.bzl\",\n+    \"packages/http/**\",\n+    \"**/.gitignore\",\n+    \"**/.gitkeep\",\n+    \"**/yarn.lock\",\n+    \"**/package.json\",\n+    \"**/third_party/**\",\n+    \"**/tsconfig-build.json\",\n+    \"**/tsconfig-tsec.json\",\n+    \"**/tsconfig.json\",\n+    \"**/rollup.config.js\",\n+    \"**/BUILD.bazel\",\n+    \"**/*.md\",\n+    \"packages/**/integrationtest/**\",\n+    \"packages/**/test/**\",\n+    \"packages/zone.js/*\",\n+    \"packages/zone.js/dist/**\",\n+    \"packages/zone.js/doc/**\",\n+    \"packages/zone.js/example/**\",\n+    \"packages/zone.js/scripts/**\"\n+  ]\n+}\n\n---\n file path A: .ng-dev/pull-request.mts | file path B: .ng-dev/pull-request.mts\n\n@@ -6,9 +6,6 @@ import {PullRequestConfig} from '@angular/ng-dev';\n  */\n export const pullRequest: PullRequestConfig = {\n   githubApiMerge: false,\n-  mergeReadyLabel: 'action: merge',\n-  caretakerNoteLabel: 'action: caretaker note',\n-  commitMessageFixupLabel: 'merge: fix commit message',\n   requiredBaseCommits: {\n     // PRs that target either `main` or the patch branch, need to be rebased\n     // on top of the latest commit message validation fix.\n\n---\n file path A: package.json | file path B: package.json\n\n@@ -180,7 +180,7 @@\n   \"// 2\": \"devDependencies are not used under Bazel. Many can be removed after test.sh is deleted.\",\n   \"devDependencies\": {\n     \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#1c1c375aff396f7f5eaa22d6d5bc112b255bd45a\",\n-    \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#5d7a73b39c1357c571dc1478caa495bc30195d6f\",\n+    \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#4c84bf7d283d773e86db85827b831187f983a480\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n     \"@bazel/buildifier\": \"^5.0.0\",\n     \"@bazel/ibazel\": \"^0.16.0\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -255,7 +255,6 @@\n \n \"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#1c1c375aff396f7f5eaa22d6d5bc112b255bd45a\":\n   version \"0.0.0-c9b2ff083a50d0eac742da1e69e0cbdb98bf53dd\"\n-  uid \"1c1c375aff396f7f5eaa22d6d5bc112b255bd45a\"\n   resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#1c1c375aff396f7f5eaa22d6d5bc112b255bd45a\"\n   dependencies:\n     \"@angular-devkit/build-angular\" \"15.0.0-next.0\"\n@@ -360,10 +359,9 @@\n   dependencies:\n     tslib \"^2.3.0\"\n \n-\"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#5d7a73b39c1357c571dc1478caa495bc30195d6f\":\n-  version \"0.0.0-c9b2ff083a50d0eac742da1e69e0cbdb98bf53dd\"\n-  uid \"5d7a73b39c1357c571dc1478caa495bc30195d6f\"\n-  resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#5d7a73b39c1357c571dc1478caa495bc30195d6f\"\n+\"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#4c84bf7d283d773e86db85827b831187f983a480\":\n+  version \"0.0.0-658ea9ec012d34882807f0be093812961af79cce\"\n+  resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#4c84bf7d283d773e86db85827b831187f983a480\"\n   dependencies:\n     \"@yarnpkg/lockfile\" \"^1.1.0\"\n     typescript \"~4.8.0\"\n@@ -11061,7 +11059,7 @@ magic-string@0.26.5:\n   dependencies:\n     sourcemap-codec \"^1.4.8\"\n \n-magic-string@0.26.7:\n+magic-string@0.26.7, magic-string@^0.26.4:\n   version \"0.26.7\"\n   resolved \"https://registry.yarnpkg.com/magic-string/-/magic-string-0.26.7.tgz#caf7daf61b34e9982f8228c4527474dac8981d6f\"\n   integrity sha512-hX9XH3ziStPoPhJxLq1syWuZMxbDvGNbVchfrdCtanC7D13888bMFow61x8axrx+GfHLtVeAx2kxL7tTGRl+Ow==\n@@ -11075,13 +11073,6 @@ magic-string@^0.25.7:\n   dependencies:\n     sourcemap-codec \"^1.4.8\"\n \n-magic-string@^0.26.4:\n-  version \"0.26.7\"\n-  resolved \"https://registry.yarnpkg.com/magic-string/-/magic-string-0.26.7.tgz#caf7daf61b34e9982f8228c4527474dac8981d6f\"\n-  integrity sha512-hX9XH3ziStPoPhJxLq1syWuZMxbDvGNbVchfrdCtanC7D13888bMFow61x8axrx+GfHLtVeAx2kxL7tTGRl+Ow==\n-  dependencies:\n-    sourcemap-codec \"^1.4.8\"\n-\n make-dir@^1.0.0:\n   version \"1.3.0\"\n   resolved \"https://registry.yarnpkg.com/make-dir/-/make-dir-1.3.0.tgz#79c1033b80515bd6d24ec9933e860ca75ee27f0c\"\n\n\n###\n\n", "completion": "build: update `ng-dev` to fix `caretaker check` and update label config (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/file_system/src/node_js_file_system.ts | file path B: packages/compiler-cli/src/ngtsc/file_system/src/node_js_file_system.ts\n\n@@ -123,30 +123,11 @@ export class NodeJSFileSystem extends NodeJSReadonlyFileSystem implements FileSy\n     fs.renameSync(from, to);\n   }\n   ensureDir(path: AbsoluteFsPath): void {\n-    const parents: AbsoluteFsPath[] = [];\n-    while (!this.isRoot(path) && !this.exists(path)) {\n-      parents.push(path);\n-      path = this.dirname(path);\n-    }\n-    while (parents.length) {\n-      this.safeMkdir(parents.pop()!);\n-    }\n+    fs.mkdirSync(path, {recursive: true});\n   }\n   removeDeep(path: AbsoluteFsPath): void {\n     fs.rmdirSync(path, {recursive: true});\n   }\n-\n-  private safeMkdir(path: AbsoluteFsPath): void {\n-    try {\n-      fs.mkdirSync(path);\n-    } catch (err) {\n-      // Ignore the error, if the path already exists and points to a directory.\n-      // Re-throw otherwise.\n-      if (!this.exists(path) || !this.stat(path).isDirectory()) {\n-        throw err;\n-      }\n-    }\n-  }\n }\n \n /**\n\n---\n file path A: packages/compiler-cli/src/ngtsc/file_system/test/node_js_file_system_spec.ts | file path B: packages/compiler-cli/src/ngtsc/file_system/test/node_js_file_system_spec.ts\n\n@@ -172,102 +172,12 @@ describe('NodeJSFileSystem', () => {\n   });\n \n   describe('ensureDir()', () => {\n-    it('should call exists() and fs.mkdir()', () => {\n-      const aPath = fs.resolve('/a');\n-      const abPath = fs.resolve('/a/b');\n-      const xPath = fs.resolve('/x');\n-      const xyPath = fs.resolve('/x/y');\n+    it('should delegate to fs.mkdirSync()', () => {\n       const mkdirCalls: string[] = [];\n-      const existsCalls: string[] = [];\n       spyOn(realFs, 'mkdirSync').and.callFake(((path: string) => mkdirCalls.push(path)) as any);\n-      spyOn(fs, 'exists').and.callFake((path: AbsoluteFsPath) => {\n-        existsCalls.push(path);\n-        switch (path) {\n-          case aPath:\n-            return true;\n-          case abPath:\n-            return true;\n-          default:\n-            return false;\n-        }\n-      });\n+\n       fs.ensureDir(abcPath);\n-      expect(existsCalls).toEqual([abcPath, abPath]);\n       expect(mkdirCalls).toEqual([abcPath]);\n-\n-      mkdirCalls.length = 0;\n-      existsCalls.length = 0;\n-\n-      fs.ensureDir(xyzPath);\n-      expect(existsCalls).toEqual([xyzPath, xyPath, xPath]);\n-      expect(mkdirCalls).toEqual([xPath, xyPath, xyzPath]);\n-    });\n-\n-    it('should not fail if a directory (that did not exist before) does exist when trying to create it',\n-       () => {\n-         let abcPathExists = false;\n-\n-         spyOn(fs, 'exists').and.callFake((path: AbsoluteFsPath) => {\n-           if (path === abcPath) {\n-             // Pretend `abcPath` is created (e.g. by another process) right after we check if it\n-             // exists for the first time.\n-             const exists = abcPathExists;\n-             abcPathExists = true;\n-             return exists;\n-           }\n-           return false;\n-         });\n-         spyOn(fs, 'stat').and.returnValue({isDirectory: () => true} as any);\n-         const mkdirSyncSpy =\n-             spyOn(realFs, 'mkdirSync').and.callFake(((path: string) => {\n-                                                       if (path === abcPath) {\n-                                                         throw new Error(\n-                                                             'It exists already. Supposedly.');\n-                                                       }\n-                                                     }) as any);\n-\n-         fs.ensureDir(abcPath);\n-         expect(mkdirSyncSpy).toHaveBeenCalledTimes(3);\n-         expect(mkdirSyncSpy).toHaveBeenCalledWith(abcPath);\n-         expect(mkdirSyncSpy).toHaveBeenCalledWith(fs.dirname(abcPath));\n-       });\n-\n-    it('should fail if creating the directory throws and the directory does not exist', () => {\n-      spyOn(fs, 'exists').and.returnValue(false);\n-      spyOn(realFs, 'mkdirSync')\n-          .and.callFake(((path: string) => {\n-                          if (path === abcPath) {\n-                            throw new Error('Unable to create directory (for whatever reason).');\n-                          }\n-                        }) as any);\n-\n-      expect(() => fs.ensureDir(abcPath))\n-          .toThrowError('Unable to create directory (for whatever reason).');\n-    });\n-\n-    it('should fail if creating the directory throws and the path points to a file', () => {\n-      const isDirectorySpy = jasmine.createSpy('isDirectory').and.returnValue(false);\n-      let abcPathExists = false;\n-\n-      spyOn(fs, 'exists').and.callFake((path: AbsoluteFsPath) => {\n-        if (path === abcPath) {\n-          // Pretend `abcPath` is created (e.g. by another process) right after we check if it\n-          // exists for the first time.\n-          const exists = abcPathExists;\n-          abcPathExists = true;\n-          return exists;\n-        }\n-        return false;\n-      });\n-      spyOn(fs, 'stat').and.returnValue({isDirectory: isDirectorySpy} as any);\n-      spyOn(realFs, 'mkdirSync').and.callFake(((path: string) => {\n-                                                if (path === abcPath) {\n-                                                  throw new Error('It exists already. Supposedly.');\n-                                                }\n-                                              }) as any);\n-\n-      expect(() => fs.ensureDir(abcPath)).toThrowError('It exists already. Supposedly.');\n-      expect(isDirectorySpy).toHaveBeenCalledTimes(1);\n     });\n   });\n \n\n\n###\n\n", "completion": "refactor(compiler-cli): use mkdirSync recursive option instead of custom implementation (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/what-is-angular/src/app/hello-world-bindings/hello-world-bindings.component.html | file path B: aio/content/examples/what-is-angular/src/app/hello-world-bindings/hello-world-bindings.component.html\n\n@@ -6,6 +6,7 @@\n   Trigger alert message\n </button>\n <!-- #enddocregion -->\n+\n <!-- #docregion bindings -->\n <p\n   [id]=\"sayHelloId\"\n@@ -13,4 +14,5 @@\n   You can set my color in the component!\n </p>\n <!-- #enddocregion -->\n+\n <p>My color is {{ fontColor }}</p>\n\n\n###\n\n", "completion": "docs: Separated HTML elements with blank lines (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/http/index.md | file path B: goldens/public-api/common/http/index.md\n\n@@ -5,6 +5,7 @@\n ```ts\n \n import { EnvironmentInjector } from '@angular/core';\n+import { EnvironmentProviders } from '@angular/core';\n import * as i0 from '@angular/core';\n import { InjectionToken } from '@angular/core';\n import { ModuleWithProviders } from '@angular/core';\n@@ -2162,7 +2163,7 @@ export class JsonpInterceptor {\n }\n \n // @public (undocumented)\n-export function provideHttpClient(...features: HttpFeature<HttpFeatureKind>[]): Provider[];\n+export function provideHttpClient(...features: HttpFeature<HttpFeatureKind>[]): EnvironmentProviders;\n \n // @public (undocumented)\n export function withInterceptors(interceptorFns: HttpInterceptorFn[]): HttpFeature<HttpFeatureKind.Interceptors>;\n\n---\n file path A: packages/common/http/src/provider.ts | file path B: packages/common/http/src/provider.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {inject, InjectionToken, Provider} from '@angular/core';\n+import {EnvironmentProviders, inject, InjectionToken, makeEnvironmentProviders, Provider} from '@angular/core';\n \n import {HttpBackend, HttpHandler} from './backend';\n import {HttpClient} from './client';\n@@ -38,7 +38,8 @@ function makeHttpFeature<KindT extends HttpFeatureKind>(\n }\n \n \n-export function provideHttpClient(...features: HttpFeature<HttpFeatureKind>[]): Provider[] {\n+export function provideHttpClient(...features: HttpFeature<HttpFeatureKind>[]):\n+    EnvironmentProviders {\n   if (ngDevMode) {\n     const featureKinds = new Set(features.map(f => f.\u0275kind));\n     if (featureKinds.has(HttpFeatureKind.NoXsrfProtection) &&\n@@ -69,7 +70,7 @@ export function provideHttpClient(...features: HttpFeature<HttpFeatureKind>[]):\n     providers.push(...feature.\u0275providers);\n   }\n \n-  return providers;\n+  return makeEnvironmentProviders(providers);\n }\n \n export function withInterceptors(interceptorFns: HttpInterceptorFn[]):\n\n\n###\n\n", "completion": "refactor(common): make `provideHttpClient` return `EnvironmentProviders` (#<issue-num>)"}
{"prompt": " file path A: .github/angular-robot.yml | file path B: .github/angular-robot.yml\n\n@@ -22,7 +22,7 @@ merge:\n   # the g3 status will be added to your pull requests if they include files that match the patterns\n   g3Status:\n     # set to true to disable\n-    disabled: false\n+    disabled: true\n     # the name of the status\n     context: 'google3'\n     # text to show when the status is pending, {{PRNumber}} will be replaced by the PR number\n@@ -32,64 +32,8 @@ merge:\n     # link to use for the details\n     url: 'http://go/angular/g3sync'\n     # list of patterns to check for the files changed by the PR\n-    # this list must be manually kept in sync with google3/third_party/javascript/angular2/copy.bara.sky\n     include:\n-      - 'LICENSE'\n-      - 'modules/benchmarks/**'\n-      - 'modules/system.d.ts'\n-      - 'packages/**'\n-    # list of patterns to ignore for the files changed by the PR\n     exclude:\n-      - 'packages/*'\n-      - 'packages/bazel/*'\n-      - 'packages/bazel/src/*'\n-      - 'packages/bazel/src/api-extractor/**'\n-      - 'packages/bazel/src/builders/**'\n-      - 'packages/bazel/src/ng_module/**'\n-      - 'packages/bazel/src/ng_package/**'\n-      - 'packages/bazel/src/protractor/**'\n-      - 'packages/bazel/src/schematics/**'\n-      - 'packages/bazel/src/types_bundle/**'\n-      - 'packages/compiler-cli/src/ngcc/**'\n-      - 'packages/compiler-cli/linker/**'\n-      - 'packages/compiler-cli/ngcc/**'\n-      - 'packages/compiler-cli/src/ngtsc/sourcemaps/**'\n-      # 'private' mostly contains entrypoints for 3P Angular.\n-      # Note that 'private/migrations' _is_ used.\n-      - 'packages/compiler-cli/private/bazel.ts'\n-      - 'packages/compiler-cli/private/localize.ts'\n-      - 'packages/compiler-cli/private/tooling.ts'\n-      - 'packages/compiler-cli/private/babel.d.ts'\n-      # google3 defines its own binary entrypoints.\n-      - 'packages/compiler-cli/src/bin/**'\n-      - 'packages/docs/**'\n-      - 'packages/elements/schematics/**'\n-      - 'packages/examples/**'\n-      - 'packages/language-service/**'\n-      - 'packages/localize/**'\n-      - 'packages/private/**'\n-      - 'packages/service-worker/**'\n-      - 'packages/common/locales/generate-locales-tool/**'\n-      - 'packages/common/locales/index.bzl'\n-      - 'packages/http/**'\n-      - '**/.gitignore'\n-      - '**/.gitkeep'\n-      - '**/yarn.lock'\n-      - '**/package.json'\n-      - '**/third_party/**'\n-      - '**/tsconfig-build.json'\n-      - '**/tsconfig-tsec.json'\n-      - '**/tsconfig.json'\n-      - '**/rollup.config.js'\n-      - '**/BUILD.bazel'\n-      - '**/*.md'\n-      - 'packages/**/integrationtest/**'\n-      - 'packages/**/test/**'\n-      - 'packages/zone.js/*'\n-      - 'packages/zone.js/dist/**'\n-      - 'packages/zone.js/doc/**'\n-      - 'packages/zone.js/example/**'\n-      - 'packages/zone.js/scripts/**'\n \n   # comment that will be added to a PR when there is a conflict, leave empty or set to false to disable\n   mergeConflictComment: \"Hi @{{PRAuthor}}! This PR has merge conflicts due to recent upstream merges.\\nPlease help to unblock it by resolving these conflicts. Thanks!\"\n@@ -127,7 +71,7 @@ merge:\n       - 'ci/circleci: build'\n       - 'ci/circleci: lint'\n       - 'ci/angular: size'\n-      - 'google3'\n+      - 'google-internal-tests'\n       - 'pullapprove'\n \n   # the comment that will be added when the merge label is added despite failing checks, leave empty or set to false to disable\n\n---\n file path A: None | file path B: .github/workflows/google-internal-tests.yml\n\n@@ -0,0 +1,73 @@\n+name: Google Internal Tests Enforcement\n+\n+on:\n+  pull_request_target:\n+    types: [opened, reopened, synchronize]\n+\n+permissions:\n+  pull-requests: read\n+  statuses: write\n+\n+jobs:\n+  trigger:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - uses: angular/dev-infra/github-actions/google-internal-tests@fac5f7cd944a71f4680a1754164a5fd92e3b8866\n+        with:\n+          run-tests-guide-url: http://go/angular/g3sync\n+          github-token: ${{ secrets.GITHUB_TOKEN }}\n+          # List must be manually kept in sync with google3/third_party/javascript/angular2/copy.bara.sky\n+          synced-files: |\n+            LICENSE\n+            modules/benchmarks/**\n+            modules/system.d.ts\n+            packages/**\n+          # List of patterns which are always considered external, even when matching above.\n+          always-external-files: |\n+            packages/*\n+            packages/bazel/*\n+            packages/bazel/src/*\n+            packages/bazel/src/api-extractor/**\n+            packages/bazel/src/builders/**\n+            packages/bazel/src/ng_module/**\n+            packages/bazel/src/ng_package/**\n+            packages/bazel/src/protractor/**\n+            packages/bazel/src/schematics/**\n+            packages/bazel/src/types_bundle/**\n+            packages/compiler-cli/src/ngcc/**\n+            packages/compiler-cli/linker/**\n+            packages/compiler-cli/ngcc/**\n+            packages/compiler-cli/src/ngtsc/sourcemaps/**\n+            packages/compiler-cli/private/bazel.ts\n+            packages/compiler-cli/private/localize.ts\n+            packages/compiler-cli/private/tooling.ts\n+            packages/compiler-cli/private/babel.d.ts\n+            packages/compiler-cli/src/bin/**\n+            packages/docs/**\n+            packages/elements/schematics/**\n+            packages/examples/**\n+            packages/language-service/**\n+            packages/localize/**\n+            packages/private/**\n+            packages/service-worker/**\n+            packages/common/locales/generate-locales-tool/**\n+            packages/common/locales/index.bzl\n+            packages/http/**\n+            **/.gitignore\n+            **/.gitkeep\n+            **/yarn.lock\n+            **/package.json\n+            **/third_party/**\n+            **/tsconfig-build.json\n+            **/tsconfig-tsec.json\n+            **/tsconfig.json\n+            **/rollup.config.js\n+            **/BUILD.bazel\n+            **/*.md\n+            packages/**/integrationtest/**\n+            packages/**/test/**\n+            packages/zone.js/*\n+            packages/zone.js/dist/**\n+            packages/zone.js/doc/**\n+            packages/zone.js/example/**\n+            packages/zone.js/scripts/**\n\n\n###\n\n", "completion": "build: wire up new github action for identifying g3-affecting PRs (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/dev-infra.yml | file path B: .github/workflows/dev-infra.yml\n\n@@ -13,7 +13,7 @@ jobs:\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n-      - uses: angular/dev-infra/github-actions/commit-message-based-labels@c9b2ff083a50d0eac742da1e69e0cbdb98bf53dd\n+      - uses: angular/dev-infra/github-actions/commit-message-based-labels@604d67220ea3a92d23e603873b2a9d3d217973f5\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n   post_approval_changes:\n\n\n###\n\n", "completion": "build: update commit message based labels action"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,94 @@\n+<a name=\"15.0.0-next.6\"></a>\n+# 15.0.0-next.6 (2022-10-12)\n+## Breaking Changes\n+### compiler-cli\n+- Invalid constructors for DI may now report compilation errors\n+  \n+  When a class inherits its constructor from a base class, the compiler may now\n+  report an error when that constructor cannot be used for DI purposes. This may\n+  either be because the base class is missing an Angular decorator such as\n+  `@Injectable()` or `@Directive()`, or because the constructor contains parameters\n+  which do not have an associated token (such as primitive types like `string`).\n+  These situations used to behave unexpectedly at runtime, where the class may be\n+  constructed without any of its constructor parameters, so this is now reported\n+  as an error during compilation.\n+  \n+  Any new errors that may be reported because of this change can be resolved either\n+  by decorating the base class from which the constructor is inherited, or by adding\n+  an explicit constructor to the class for which the error is reported.\n+### core\n+- Angular no longer supports Node.js versions `14.[15-19].x` and `16.[10-12].x`. Current supported versions of Node.js are `14.20.x`, `16.13.x` and `18.10.x`.\n+- TypeScript versions older than 4.8 are no longer supported.\n+### forms\n+- setDisabledState will always be called when a `ControlValueAccessor` is attached. You can opt-out with `FormsModule.withConfig` or `ReactiveFormsModule.withConfig`.\n+### router\n+- `relativeLinkResolution` is no longer configurable in\n+  the Router. This option was used as a means to opt out of a bug fix.\n+## Deprecations\n+### common\n+- The `DATE_PIPE_DEFAULT_TIMEZONE` token is now deprecated in favor\n+  of the `DATE_PIPE_DEFAULT_OPTIONS` token, which accepts an object\n+  as a value and the timezone can be defined as a field (called `timezone`)\n+  on that object.\n+### router\n+- The `RouterLinkWithHref` directive is deprecated, use the `RouterLink` directive instead. The `RouterLink` contains the code from the `RouterLinkWithHref` to handle elements with `href` attributes.\n+### common\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [c0c7efaf7c](https://github.com/angular/angular/commit/c0c7efaf7c8a53c1a6f137aac960757cc804f263) | feat | add `provideLocationMocks()` function to provide Location mocks ([#47674](https://github.com/angular/angular/pull/47674)) |\n+| [75e6297f09](https://github.com/angular/angular/commit/75e6297f0901cc98aea1626a138a820e68d026ec) | feat | add <link> preload tag on server for priority img ([#47343](https://github.com/angular/angular/pull/47343)) |\n+| [4fde292bb5](https://github.com/angular/angular/commit/4fde292bb58f5d5bc3cf6e634f7cff9eb0d13d84) | feat | Add automatic srcset generation to ngOptimizedImage ([#47547](https://github.com/angular/angular/pull/47547)) |\n+| [9483343ebf](https://github.com/angular/angular/commit/9483343ebf958297ebcb81ef313d356296a41f41) | feat | Add fill mode to NgOptimizedImage ([#47738](https://github.com/angular/angular/pull/47738)) |\n+| [bdb5371033](https://github.com/angular/angular/commit/bdb5371033d8e9a110619861323e8383a32d5900) | feat | add injection token for default DatePipe configuration ([#47157](https://github.com/angular/angular/pull/47157)) |\n+### compiler\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [39b72e208b](https://github.com/angular/angular/commit/39b72e208b46d80f1d9a802cebf043c2ccf3c5f2) | fix | update element schema ([#47552](https://github.com/angular/angular/pull/47552)) |\n+| [48b354a83e](https://github.com/angular/angular/commit/48b354a83e6d94735a03eebb3a52c5698e7a0f44) | fix | update element schema ([#47552](https://github.com/angular/angular/pull/47552)) |\n+### compiler-cli\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [38078e7adb](https://github.com/angular/angular/commit/38078e7adb79c058d2cb1dfe2e8d11f7304d4e5d) | fix | add missing period to error message ([#47744](https://github.com/angular/angular/pull/47744)) |\n+| [bc54687c7b](https://github.com/angular/angular/commit/bc54687c7b91efe451aa744d2d3a15ca3524231e) | fix | exclude abstract classes from `strictInjectionParameters` requirement ([#44615](https://github.com/angular/angular/pull/44615)) |\n+| [19ad4987f9](https://github.com/angular/angular/commit/19ad4987f9070222bb2fb8bd07a43ed7995f602a) | fix | use @ts-ignore. ([#47636](https://github.com/angular/angular/pull/47636)) |\n+| [a792bf1703](https://github.com/angular/angular/commit/a792bf1703fa6fb7b6aff0b9256b2bc65d27b724) | perf | minimize filesystem calls when generating shims ([#47682](https://github.com/angular/angular/pull/47682)) |\n+### core\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [1b9fd46d14](https://github.com/angular/angular/commit/1b9fd46d14ed46f78b6d761b3917ded1f0d51e0d) | feat | add support for Node.js version 18 ([#47730](https://github.com/angular/angular/pull/47730)) |\n+| [ed11a13c3c](https://github.com/angular/angular/commit/ed11a13c3c5cccb0094c1a4ff9c60ea741a42067) | feat | drop support for TypeScript 4.6 and 4.7 ([#47690](https://github.com/angular/angular/pull/47690)) |\n+| [db28badfe6](https://github.com/angular/angular/commit/db28badfe67f404e81dacd7c3131af105feb3412) | feat | enable the new directive composition API ([#47642](https://github.com/angular/angular/pull/47642)) |\n+| [7de1469be6](https://github.com/angular/angular/commit/7de1469be62b08037681ee9e75614fb800700ef8) | feat | introduce EnvironmentProviders wrapper type ([#47669](https://github.com/angular/angular/pull/47669)) |\n+### forms\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [a8569e3802](https://github.com/angular/angular/commit/a8569e38029724a7d77935bccce99117a7e1aefa) | feat | export forms utility functions: isFormArray, isFormGroup\u2026 ([#47718](https://github.com/angular/angular/pull/47718)) |\n+| [96b7fe93af](https://github.com/angular/angular/commit/96b7fe93af361a1cf2ea5477970f64ba6f3d8cd5) | fix | call `setDisabledState` on `ControlValueAcessor` when control is enabled ([#47576](https://github.com/angular/angular/pull/47576)) |\n+### http\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [3ba99e286a](https://github.com/angular/angular/commit/3ba99e286a166d122fb334171b6a9a1e6461a724) | feat | allow for child `HttpClient`s to request via parents ([#47502](https://github.com/angular/angular/pull/47502)) |\n+| [84d0d33c35](https://github.com/angular/angular/commit/84d0d33c3537f0da927e0ce449ede78ef9bebc6b) | feat | introduce `provideHttpClientTesting` provider function ([#47502](https://github.com/angular/angular/pull/47502)) |\n+| [62c7a7a16e](https://github.com/angular/angular/commit/62c7a7a16e035c3a5346270dc4c5c6de85bf9137) | feat | introduce functional interceptors ([#47502](https://github.com/angular/angular/pull/47502)) |\n+| [e47b129070](https://github.com/angular/angular/commit/e47b129070655f2e9eeac58bc2d0ea5648f41045) | feat | introduce the `provideHttpClient()` API ([#47502](https://github.com/angular/angular/pull/47502)) |\n+| [ea16a98dfe](https://github.com/angular/angular/commit/ea16a98dfef0de33c192e328f151cca39749a488) | fix | better handle unexpected `undefined` XSRF tokens ([#47683](https://github.com/angular/angular/pull/47683)) |\n+### language-service\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [bebef5fb43](https://github.com/angular/angular/commit/bebef5fb43dcf54a109499d0d9dd701786c33f60) | feat | Quick fix to import a component when its selector is used ([#47088](https://github.com/angular/angular/pull/47088)) |\n+### router\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [7bee28d037](https://github.com/angular/angular/commit/7bee28d037a8a21a7440293b3e8c118cc93ec8c1) | feat | add a migration to remove `relativeLinkResolution` usages ([#47604](https://github.com/angular/angular/pull/47604)) |\n+| [f73ef21442](https://github.com/angular/angular/commit/f73ef2144279b6b26902510f90ca1fccb8e166b2) | feat | merge `RouterLinkWithHref` into `RouterLink` ([#47630](https://github.com/angular/angular/pull/47630)) |\n+| [16c8f55663](https://github.com/angular/angular/commit/16c8f55663c30270fcd647b1a8a20ddbc8923349) | feat | migrate `RouterLinkWithHref` references to `RouterLink` ([#47599](https://github.com/angular/angular/pull/47599)) |\n+| [07017a7bd3](https://github.com/angular/angular/commit/07017a7bd30c6bb7bd1b94a9fd1b112ee68c9ced) | feat | prevent `provideRouter()` from usage in @Component ([#47669](https://github.com/angular/angular/pull/47669)) |\n+| [7b89d95c0e](https://github.com/angular/angular/commit/7b89d95c0e7370d33f006aba8e67bafb53a2fd4f) | fix | Remove deprecated relativeLinkResolution ([#47623](https://github.com/angular/angular/pull/47623)) |\n+## Special Thanks\n+Alan Agius, AleksanderBodurri, Alex Castle, Alex Rickabaugh, Andrew Kushnir, Andrew Scott, Aristeidis Bampakos, Bob Watson, Charles Lyding, Dylan Hunn, Ferdinand Malcher, George Kalpakas, Jessica Janiuk, Joey Perrott, JoostK, Joshua Morony, Kristiyan Kostadinov, Martin Probst, Mathew Berg, Matthias Wei\u00df, Paul Gschwendtner, Peter Dickten, Renan Ferro, Sri Ram, WD Snoeijer, arturovt, jaybell, markostanimirovic and \u00c1lvaro Mart\u00ednez\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"14.2.6\"></a>\n # 14.2.6 (2022-10-12)\n ### compiler-cli\n\n\n###\n\n", "completion": "docs: release notes for the v15.0.0-next.6 release"}
{"prompt": " file path A: .github/angular-robot.yml | file path B: .github/angular-robot.yml\n\n@@ -143,29 +143,29 @@ triage:\n   defaultMilestone: 82,\n   # arrays of labels that determine if an issue has been triaged by the caretaker\n   l1TriageLabels:\n-    - - 'comp: *'\n+    - - 'area: *'\n   # arrays of labels that determine if an issue has been fully triaged\n   l2TriageLabels:\n     - - 'P0'\n-      - 'comp: *'\n+      - 'area: *'\n     - - 'P1'\n-      - 'comp: *'\n+      - 'area: *'\n     - - 'P2'\n-      - 'comp: *'\n+      - 'area: *'\n     - - 'P3'\n-      - 'comp: *'\n+      - 'area: *'\n     - - 'P4'\n-      - 'comp: *'\n+      - 'area: *'\n     - - 'P5'\n-      - 'comp: *'\n+      - 'area: *'\n     - - 'feature'\n-      - 'comp: *'\n+      - 'area: *'\n     - - 'discussion'\n-      - 'comp: *'\n+      - 'area: *'\n     - - 'needs clarification'\n-      - 'comp: *'\n+      - 'area: *'\n     - - 'needs reproduction'\n-      - 'comp: *'\n+      - 'area: *'\n \n # options for the triage PR plugin\n triagePR:\n@@ -177,10 +177,10 @@ triagePR:\n   defaultMilestone: 82,\n   # arrays of labels that determine if a PR has been triaged by the caretaker\n   l1TriageLabels:\n-    - - 'comp: *'\n+    - - 'area: *'\n   # arrays of labels that determine if a PR has been fully triaged\n   l2TriageLabels:\n-    - - 'comp: *'\n+    - - 'area: *'\n \n # options for rerunning CI\n rerunCircleCI:\n\n---\n file path A: .github/workflows/update-events.yml | file path B: .github/workflows/update-events.yml\n\n@@ -43,6 +43,6 @@ jobs:\n             Generated `events.json` with the latest events retrieved from the Firebase DB.\n           pr-labels: |\n             action: review\n-            comp: docs\n+            area: docs\n             target: patch\n           angular-robot-token: ${{ secrets.ANGULAR_ROBOT_ACCESS_TOKEN }}\n\n---\n file path A: .ng-dev/release.mts | file path B: .ng-dev/release.mts\n\n@@ -31,5 +31,5 @@ export const release: ReleaseConfig = {\n   releaseNotes: {\n     hiddenScopes: ['aio', 'bazel', 'dev-infra', 'docs-infra', 'zone.js', 'devtools'],\n   },\n-  releasePrLabels: ['comp: build & ci', 'action: merge', 'PullApprove: disable'],\n+  releasePrLabels: ['area: build & ci', 'action: merge', 'PullApprove: disable'],\n };\n\n---\n file path A: docs/TRIAGE_AND_LABELS.md | file path B: docs/TRIAGE_AND_LABELS.md\n\n@@ -1,7 +1,7 @@\n # Triage Process and GitHub Labels for Angular\n \n This document describes how the Angular team uses labels and milestones to triage issues on GitHub.\n-The basic idea of the process is that caretaker only assigns a component (`comp: *`) label.\n+The basic idea of the process is that caretaker only assigns a component (`area: *`) label.\n The owner of the component is then responsible for the detailed / component-level triage.\n \n \n@@ -13,41 +13,41 @@ The caretaker should be able to determine which component the issue belongs to.\n The components have a clear piece of source code associated with it within the `/packages/` folder\n of this repo.\n \n-* `comp: animations`\n-* `comp: bazel` - @angular/bazel rules\n-* `comp: benchpress`\n-* `comp: common` - this includes core components / pipes\n-* `comp: common/http` - this includes core components / pipes\n-* `comp: core & compiler` - because core, compiler, compiler-cli and\n+* `area: animations`\n+* `area: bazel` - @angular/bazel rules\n+* `area: benchpress`\n+* `area: common` - this includes core components / pipes\n+* `area: common/http` - this includes core components / pipes\n+* `area: core & compiler` - because core, compiler, compiler-cli and\n   browser-platforms are very intertwined, we will be treating them as one\n-* `comp: ivy` - a subset of core representing the new Ivy renderer.\n-* `comp: ngcc` - a subset of ivy representing the [Angular Compatibility Compiler](../packages/compiler-cli/ngcc/README.md)\n-* `comp: ve` - a subset of `core & compiler` representing changes specific to ViewEngine (legacy compiler/renderer).\n-* `comp: docs-infra` - the angular.io application and docs-related tooling\n-* `comp: elements`\n-* `comp: forms`\n-* `comp: http`\n-* `comp: i18n`\n-* `comp: language-service`\n-* `comp: metadata-extractor`\n-* `comp: router`\n-* `comp: server`\n-* `comp: service-worker`\n-* `comp: testing`\n-* `comp: upgrade`\n-* `comp: web-worker`\n-* `comp: zones`\n+* `area: ivy` - a subset of core representing the new Ivy renderer.\n+* `area: ngcc` - a subset of ivy representing the [Angular Compatibility Compiler](../packages/compiler-cli/ngcc/README.md)\n+* `area: ve` - a subset of `core & compiler` representing changes specific to ViewEngine (legacy compiler/renderer).\n+* `area: docs-infra` - the angular.io application and docs-related tooling\n+* `area: elements`\n+* `area: forms`\n+* `area: http`\n+* `area: i18n`\n+* `area: language-service`\n+* `area: metadata-extractor`\n+* `area: router`\n+* `area: server`\n+* `area: service-worker`\n+* `area: testing`\n+* `area: upgrade`\n+* `area: web-worker`\n+* `area: zones`\n \n There are few components which are cross-cutting.\n They don't have a clear location in the source tree.\n We will treat them as a component even thought no specific source tree is associated with them.\n \n-* `comp: build & ci` - build and CI infrastructure for the angular/angular repo\n-* `comp: dev-infra` - angular's common internal developer infrastructure scripting and tooling\n-* `comp: docs` - documentation, including API docs, guides, tutorial\n-* `comp: packaging` - packaging format of @angular/* npm packages\n-* `comp: performance`\n-* `comp: security`\n+* `area: build & ci` - build and CI infrastructure for the angular/angular repo\n+* `area: dev-infra` - angular's common internal developer infrastructure scripting and tooling\n+* `area: docs` - documentation, including API docs, guides, tutorial\n+* `area: packaging` - packaging format of @angular/* npm packages\n+* `area: performance`\n+* `area: security`\n \n Sometimes, especially in the case of cross-cutting issues or PRs, these PRs or issues belong to\n multiple components. In these cases, all applicable component labels should be used to triage the\n@@ -65,7 +65,7 @@ issue or PR.\n \n ## Caretaker Triage Process (Initial Triage)\n \n-The caretaker assigns `comp:  *` labels to new issues as they come in.\n+The caretaker assigns `area:  *` labels to new issues as they come in.\n Untriaged issues can be found by selecting the issues with no milestone.\n \n If an issue or PR obviously relates to a release regression, the caretaker must assign an\n\n---\n file path A: renovate.json | file path B: renovate.json\n\n@@ -14,7 +14,7 @@\n   \"prHourlyLimit\": 3,\n   \"timezone\": \"America/Tijuana\",\n   \"lockFileMaintenance\": {\"enabled\": true},\n-  \"labels\": [\"target: patch\", \"comp: build & ci\", \"action: review\"],\n+  \"labels\": [\"target: patch\", \"area: build & ci\", \"action: review\"],\n   \"ignoreDeps\": [\n     \"@angular/animations-12\",\n     \"@angular/common-12\",\n\n\n###\n\n", "completion": "build: update comp labels to be area instead (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,15 @@\n+<a name=\"14.2.6\"></a>\n+# 14.2.6 (2022-10-12)\n+### compiler-cli\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [3fd176a905](https://github.com/angular/angular/commit/3fd176a9054bea6f6c4cd22e8ff3b8f63b86b637) | fix | add missing period to error message ([#47744](https://github.com/angular/angular/pull/47744)) |\n+| [c3821f5ab5](https://github.com/angular/angular/commit/c3821f5ab5bf54b2c9d7868da79a742d4e4b7667) | perf | minimize filesystem calls when generating shims ([#47682](https://github.com/angular/angular/pull/47682)) |\n+## Special Thanks\n+Alan Agius, Andrew Kushnir, Andrew Scott, Aristeidis Bampakos, Bob Watson, Charles Lyding, Joey Perrott, Joshua Morony, Mathew Berg, Paul Gschwendtner, Peter Dickten, Renan Ferro, Sri Ram, WD Snoeijer, markostanimirovic and \u00c1lvaro Mart\u00ednez\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.0.0-next.5\"></a>\n # 15.0.0-next.5 (2022-10-05)\n ## Breaking Changes\n@@ -3522,4 +3534,4 @@ This release contains the same set the of changes as 11.2.0-next.1.\n ### Code Refactoring\n \n * **compiler:** remove support for TypeScript 3.9 ([#39313](https://github.com/angular/angular/issues/39313)) ([736e064](https://github.com/angular/angular/commit/736e0644b02bc4606a7ae0c974d1b06e993708f6))\n-* **router:** adjust type of parameter in `navigateByUrl` and `createUrlTree` to be more accurate ([#38227](https://github.com/angular/angular/issues/38227)) ([e4f4d18](https://github.com/angular/angular/commit/e4f4d18)), closes [#18798](https://github.com/angular/angular/issues/18798)\n+* **router:** adjust type of parameter in `navigateByUrl` and `createUrlTree` to be more accurate ([#38227](https://github.com/angular/angular/issues/38227)) ([e4f4d18](https://github.com/angular/angular/commit/e4f4d18)), closes [#18798](https://github.com/angular/angular/issues/18798)\n\\ No newline at end of file\n\n\n###\n\n", "completion": "docs: release notes for the v14.2.6 release"}
{"prompt": " file path A: .github/workflows/feature-requests.yml | file path B: .github/workflows/feature-requests.yml\n\n@@ -14,6 +14,6 @@ jobs:\n     if: github.repository == 'angular/angular'\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: angular/dev-infra/github-actions/feature-request@c9b2ff083a50d0eac742da1e69e0cbdb98bf53dd\n+      - uses: angular/dev-infra/github-actions/feature-request@a64f3515ea822a8b228ebaab1c52e76e557a580c\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n\n###\n\n", "completion": "build: update to the latest version of the feature triage action"}
{"prompt": " file path A: .ng-dev/pull-request.mts | file path B: .ng-dev/pull-request.mts\n\n@@ -7,8 +7,8 @@ import {PullRequestConfig} from '@angular/ng-dev';\n export const pullRequest: PullRequestConfig = {\n   githubApiMerge: false,\n   mergeReadyLabel: 'action: merge',\n-  caretakerNoteLabel: 'action: merge-assistance',\n-  commitMessageFixupLabel: 'commit message fixup',\n+  caretakerNoteLabel: 'action: caretaker note',\n+  commitMessageFixupLabel: 'merge: fix commit message',\n   requiredBaseCommits: {\n     // PRs that target either `main` or the patch branch, need to be rebased\n     // on top of the latest commit message validation fix.\n\n\n###\n\n", "completion": "build: update labels to match standardized labels (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/annotations/component/src/util.ts | file path B: packages/compiler-cli/src/ngtsc/annotations/component/src/util.ts\n\n@@ -69,7 +69,7 @@ export function validateAndFlattenComponentImports(imports: ResolvedValue, expr:\n   if (!Array.isArray(imports)) {\n     const error = createValueHasWrongTypeError(\n                       expr, imports,\n-                      `'imports' must be an array of components, directives, pipes, or NgModules`)\n+                      `'imports' must be an array of components, directives, pipes, or NgModules.`)\n                       .toDiagnostic();\n     return {\n       imports: [],\n@@ -91,7 +91,7 @@ export function validateAndFlattenComponentImports(imports: ResolvedValue, expr:\n         diagnostics.push(\n             createValueHasWrongTypeError(\n                 ref.getOriginForDiagnostics(expr), ref,\n-                `'imports' must be an array of components, directives, pipes, or NgModules`)\n+                `'imports' must be an array of components, directives, pipes, or NgModules.`)\n                 .toDiagnostic());\n       }\n     } else if (isLikelyModuleWithProviders(ref)) {\n@@ -111,7 +111,7 @@ export function validateAndFlattenComponentImports(imports: ResolvedValue, expr:\n       diagnostics.push(\n           createValueHasWrongTypeError(\n               expr, imports,\n-              `'imports' must be an array of components, directives, pipes, or NgModules`)\n+              `'imports' must be an array of components, directives, pipes, or NgModules.`)\n               .toDiagnostic());\n     }\n   }\n\n\n###\n\n", "completion": "fix(compiler-cli): add missing period to error message (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/image-directive.md | file path B: aio/content/guide/image-directive.md\n\n@@ -81,6 +81,18 @@ providers: [\n \n </code-example>\n \n+### Using `fill` mode\n+\n+In cases where you want to have an image fill a containing element, you can use the `fill` attribute. This is often useful when you want to achieve a \"background image\" behavior, or when you don't know the exact width and height of your image.\n+\n+When you add the `fill` attribute to your image, you do not need and should not include a `width` and `height`, as in this example:\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+\n+&lt;img ngSrc=\"cat.jpg\" fill&gt;\n+\n+</code-example> \n+\n ### Adjusting image styling\n \n Depending on the image's styling, adding `width` and `height` attributes may cause the image to render differently. `NgOptimizedImage` warns you if your image styling renders the image at a distorted aspect ratio.\n\n---\n file path A: goldens/public-api/common/index.md | file path B: goldens/public-api/common/index.md\n\n@@ -549,6 +549,9 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n     set disableOptimizedSrcset(value: string | boolean | undefined);\n     // (undocumented)\n     get disableOptimizedSrcset(): boolean;\n+    set fill(value: string | boolean | undefined);\n+    // (undocumented)\n+    get fill(): boolean;\n     set height(value: string | number | undefined);\n     // (undocumented)\n     get height(): number | undefined;\n@@ -571,7 +574,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n     // (undocumented)\n     get width(): number | undefined;\n     // (undocumented)\n-    static \u0275dir: i0.\u0275\u0275DirectiveDeclaration<NgOptimizedImage, \"img[ngSrc],img[rawSrc]\", never, { \"rawSrc\": \"rawSrc\"; \"ngSrc\": \"ngSrc\"; \"ngSrcset\": \"ngSrcset\"; \"sizes\": \"sizes\"; \"width\": \"width\"; \"height\": \"height\"; \"loading\": \"loading\"; \"priority\": \"priority\"; \"disableOptimizedSrcset\": \"disableOptimizedSrcset\"; \"src\": \"src\"; \"srcset\": \"srcset\"; }, {}, never, never, true, never>;\n+    static \u0275dir: i0.\u0275\u0275DirectiveDeclaration<NgOptimizedImage, \"img[ngSrc],img[rawSrc]\", never, { \"rawSrc\": \"rawSrc\"; \"ngSrc\": \"ngSrc\"; \"ngSrcset\": \"ngSrcset\"; \"sizes\": \"sizes\"; \"width\": \"width\"; \"height\": \"height\"; \"loading\": \"loading\"; \"priority\": \"priority\"; \"disableOptimizedSrcset\": \"disableOptimizedSrcset\"; \"fill\": \"fill\"; \"src\": \"src\"; \"srcset\": \"srcset\"; }, {}, never, never, true, never>;\n     // (undocumented)\n     static \u0275fac: i0.\u0275\u0275FactoryDeclaration<NgOptimizedImage, never>;\n }\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -202,6 +202,12 @@ export const IMAGE_CONFIG = new InjectionToken<ImageConfig>(\n @Directive({\n   standalone: true,\n   selector: 'img[ngSrc],img[rawSrc]',\n+  host: {\n+    '[style.position]': 'fill ? \"absolute\" : null',\n+    '[style.width]': 'fill ? \"100%\" : null',\n+    '[style.height]': 'fill ? \"100%\" : null',\n+    '[style.inset]': 'fill ? \"0px\" : null'\n+  }\n })\n export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   private imageLoader = inject(IMAGE_LOADER);\n@@ -330,6 +336,19 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   }\n   private _disableOptimizedSrcset = false;\n \n+  /**\n+   * Sets the image to \"fill mode,\" which eliminates the height/width requirement and adds\n+   * styles such that the image fills its containing element.\n+   */\n+  @Input()\n+  set fill(value: string|boolean|undefined) {\n+    this._fill = inputToBoolean(value);\n+  }\n+  get fill(): boolean {\n+    return this._fill;\n+  }\n+  private _fill = false;\n+\n   /**\n    * Value of the `src` attribute if set on the host `<img>` element.\n    * This input is exclusively read to assert that `src` is not set in conflict\n@@ -356,7 +375,11 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n       }\n       assertNotBase64Image(this);\n       assertNotBlobUrl(this);\n-      assertNonEmptyWidthAndHeight(this);\n+      if (this.fill) {\n+        assertEmptyWidthAndHeight(this);\n+      } else {\n+        assertNonEmptyWidthAndHeight(this);\n+      }\n       assertValidLoadingInput(this);\n       assertNoImageDistortion(this, this.imgElement, this.renderer);\n       if (!this.ngSrcset) {\n@@ -383,8 +406,14 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   private setHostAttributes() {\n     // Must set width/height explicitly in case they are bound (in which case they will\n     // only be reflected and not found by the browser)\n-    this.setHostAttribute('width', this.width!.toString());\n-    this.setHostAttribute('height', this.height!.toString());\n+    if (this.fill) {\n+      if (!this.sizes) {\n+        this.sizes = '100vw';\n+      }\n+    } else {\n+      this.setHostAttribute('width', this.width!.toString());\n+      this.setHostAttribute('height', this.height!.toString());\n+    }\n \n     this.setHostAttribute('loading', this.getLoadingBehavior());\n     this.setHostAttribute('fetchpriority', this.getFetchPriority());\n@@ -805,6 +834,22 @@ function assertNonEmptyWidthAndHeight(dir: NgOptimizedImage) {\n   }\n }\n \n+/**\n+ * Verifies that width and height are not set. Used in fill mode, where those attributes don't make\n+ * sense.\n+ */\n+function assertEmptyWidthAndHeight(dir: NgOptimizedImage) {\n+  if (dir.width || dir.height) {\n+    throw new RuntimeError(\n+        RuntimeErrorCode.INVALID_INPUT,\n+        `${\n+            imgDirectiveDetails(\n+                dir.ngSrc)} the attributes \\`height\\` and/or \\`width\\` are present ` +\n+            `along with the \\`fill\\` attribute. Because \\`fill\\` mode causes an image to fill its containing ` +\n+            `element, the size attributes have no effect and should be removed.`);\n+  }\n+}\n+\n /**\n  * Verifies that the `loading` attribute is set to a valid input &\n  * is not used on priority images.\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -794,6 +794,123 @@ describe('Image directive', () => {\n     });\n   });\n \n+  describe('fill mode', () => {\n+    it('should allow unsized images in fill mode', () => {\n+      setupTestingModule();\n+\n+      const template = '<img ngSrc=\"path/img.png\" fill>';\n+      expect(() => {\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+      }).not.toThrow();\n+    });\n+    it('should throw if width is provided for fill mode image', () => {\n+      setupTestingModule();\n+\n+      const template = '<img ngSrc=\"path/img.png\" width=\"500\" fill>';\n+      expect(() => {\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              'NG02952: The NgOptimizedImage directive (activated on an <img> element with the ' +\n+              '`ngSrc=\"path/img.png\"`) has detected that the attributes `height` and/or `width` ' +\n+              'are present along with the `fill` attribute. Because `fill` mode causes an image ' +\n+              'to fill its containing element, the size attributes have no effect and should be removed.');\n+    });\n+    it('should throw if height is provided for fill mode image', () => {\n+      setupTestingModule();\n+\n+      const template = '<img ngSrc=\"path/img.png\" height=\"500\" fill>';\n+      expect(() => {\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              'NG02952: The NgOptimizedImage directive (activated on an <img> element with the ' +\n+              '`ngSrc=\"path/img.png\"`) has detected that the attributes `height` and/or `width` ' +\n+              'are present along with the `fill` attribute. Because `fill` mode causes an image ' +\n+              'to fill its containing element, the size attributes have no effect and should be removed.');\n+    });\n+    it('should apply appropriate styles in fill mode', () => {\n+      setupTestingModule();\n+\n+      const template = '<img ngSrc=\"path/img.png\" fill>';\n+\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.getAttribute('style')?.replace(/\\s/g, ''))\n+          .toBe('position:absolute;width:100%;height:100%;inset:0px;');\n+    });\n+    it('should augment existing styles in fill mode', () => {\n+      setupTestingModule();\n+\n+      const template = '<img ngSrc=\"path/img.png\" style=\"border-radius: 5px; padding: 10px\" fill>';\n+\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.getAttribute('style')?.replace(/\\s/g, ''))\n+          .toBe(\n+              'border-radius:5px;padding:10px;position:absolute;width:100%;height:100%;inset:0px;');\n+    });\n+    it('should not add fill styles if not in fill mode', () => {\n+      setupTestingModule();\n+\n+      const template =\n+          '<img ngSrc=\"path/img.png\" width=\"400\" height=\"300\" style=\"position: relative; border-radius: 5px\">';\n+\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.getAttribute('style')?.replace(/\\s/g, ''))\n+          .toBe('position:relative;border-radius:5px;');\n+    });\n+    it('should add default sizes value in fill mode', () => {\n+      setupTestingModule();\n+\n+      const template = '<img ngSrc=\"path/img.png\" fill>';\n+\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.getAttribute('sizes')).toBe('100vw');\n+    });\n+    it('should not overwrite sizes value in fill mode', () => {\n+      setupTestingModule();\n+\n+      const template = '<img ngSrc=\"path/img.png\" sizes=\"50vw\" fill>';\n+\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.getAttribute('sizes')).toBe('50vw');\n+    });\n+    it('should cause responsive srcset to be generated in fill mode', () => {\n+      setupTestingModule();\n+\n+      const template = '<img ngSrc=\"path/img.png\" fill>';\n+\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.getAttribute('srcset'))\n+          .toBe(\n+              `${IMG_BASE_URL}/path/img.png 640w, ${IMG_BASE_URL}/path/img.png 750w, ${\n+                  IMG_BASE_URL}/path/img.png 828w, ` +\n+              `${IMG_BASE_URL}/path/img.png 1080w, ${IMG_BASE_URL}/path/img.png 1200w, ${\n+                  IMG_BASE_URL}/path/img.png 1920w, ` +\n+              `${IMG_BASE_URL}/path/img.png 2048w, ${IMG_BASE_URL}/path/img.png 3840w`);\n+    });\n+  });\n+\n   describe('preconnect detector', () => {\n     const imageLoader = () => {\n       // We need something different from the `localhost` (as we don't want to produce\n\n\n###\n\n", "completion": "feat(common): Add fill mode to NgOptimizedImage (#<issue-num>)"}
{"prompt": " file path A: aio/content/images/bios/joshuamorony.jpg | file path B: aio/content/images/bios/joshuamorony.jpg\n\nBinary files /dev/null and b/aio/content/images/bios/joshuamorony.jpg differ\n\n---\n file path A: aio/content/marketing/contributors.json | file path B: aio/content/marketing/contributors.json\n\n@@ -509,6 +509,14 @@\n     \"twitter\": \"joeyperrott\",\n     \"groups\": [\"Angular\"]\n   },\n+  \"joshuamorony\": {\n+    \"name\": \"Joshua Morony\",\n+    \"picture\": \"joshuamorony.jpg\",\n+    \"twitter\": \"joshuamorony\",\n+    \"website\": \"https://joshmorony.com\",\n+    \"bio\": \"Josh is a Software Engineer, Google Developer Expert for Angular, and Ionic Developer Expert. He is a consultant and content creator focused on advancing the skills of Angular and Ionic developers. He is the author of multiple books and courses including Ionic Start and Modern Angular.\",\n+    \"groups\": [\"GDE\"]\n+  },\n   \"josmar-crwdstffng\": {\n     \"name\": \"Joe Martin\",\n     \"picture\": \"josephmmartin.jpg\",\n\n\n###\n\n", "completion": "docs: add Joshua Morony to GDE resources (#<issue-num>)"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -158,10 +158,10 @@ cldr_xml_data_repository(\n # sass rules\n http_archive(\n     name = \"io_bazel_rules_sass\",\n-    sha256 = \"a5ff47737667d644dba00af5444b6723fd5ddae2db80ee2f1e202bf0ccfcd4ef\",\n-    strip_prefix = \"rules_sass-f3874ae3ddbdab73a0a0e7bc14909d498c464ad9\",\n+    sha256 = \"0cde2dd9ff34994f27ba4d5c74d34cca3c727bf41bc6024cf66ad298a1f5e5c2\",\n+    strip_prefix = \"rules_sass-f6ceac7f5e11424880ae41f9c1a5cfd02968376c\",\n     urls = [\n-        \"https://github.com/bazelbuild/rules_sass/archive/f3874ae3ddbdab73a0a0e7bc14909d498c464ad9.zip\",\n+        \"https://github.com/bazelbuild/rules_sass/archive/f6ceac7f5e11424880ae41f9c1a5cfd02968376c.zip\",\n     ],\n )\n \n\n\n###\n\n", "completion": "build: update io_bazel_rules_sass digest to f6ceac7 (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/dev-infra.yml | file path B: .github/workflows/dev-infra.yml\n\n@@ -12,14 +12,14 @@ jobs:\n   labels:\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3.0.2\n+      - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n       - uses: angular/dev-infra/github-actions/commit-message-based-labels@c9b2ff083a50d0eac742da1e69e0cbdb98bf53dd\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n   post_approval_changes:\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3.0.2\n+      - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n       - uses: angular/dev-infra/github-actions/post-approval-changes@c9b2ff083a50d0eac742da1e69e0cbdb98bf53dd\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n---\n file path A: .github/workflows/update-events.yml | file path B: .github/workflows/update-events.yml\n\n@@ -24,7 +24,7 @@ jobs:\n     runs-on: ubuntu-latest\n     steps:\n       - name: Checkout the repository\n-        uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3.0.2\n+        uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n         with:\n           # Setting `persist-credentials: false` prevents the github-action account from being the\n           # account that is attempted to be used for authentication, instead the remote is set to\n\n---\n file path A: package.json | file path B: package.json\n\n@@ -85,7 +85,7 @@\n     \"@types/babel__core\": \"7.1.19\",\n     \"@types/babel__generator\": \"7.6.4\",\n     \"@types/babel__template\": \"7.4.1\",\n-    \"@types/babel__traverse\": \"7.18.1\",\n+    \"@types/babel__traverse\": \"7.18.2\",\n     \"@types/base64-js\": \"1.3.0\",\n     \"@types/bluebird\": \"^3.5.27\",\n     \"@types/chrome\": \"^0.0.197\",\n@@ -144,7 +144,7 @@\n     \"karma-jasmine\": \"^5.0.0\",\n     \"karma-requirejs\": \"^1.1.0\",\n     \"karma-sourcemap-loader\": \"^0.3.7\",\n-    \"magic-string\": \"0.26.3\",\n+    \"magic-string\": \"0.26.7\",\n     \"materialize-css\": \"1.0.0\",\n     \"memo-decorator\": \"^2.0.1\",\n     \"ngx-flamegraph\": \"0.0.11\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -2969,10 +2969,10 @@\n   dependencies:\n     \"@babel/types\" \"^7.3.0\"\n \n-\"@types/babel__traverse@7.18.1\":\n-  version \"7.18.1\"\n-  resolved \"https://registry.yarnpkg.com/@types/babel__traverse/-/babel__traverse-7.18.1.tgz#ce5e2c8c272b99b7a9fd69fa39f0b4cd85028bd9\"\n-  integrity sha512-FSdLaZh2UxaMuLp9lixWaHq/golWTRWOnRsAXzDTDSDOQLuZb1nsdCt6pJSPWSEQt2eFZ2YVk3oYhn+1kLMeMA==\n+\"@types/babel__traverse@7.18.2\":\n+  version \"7.18.2\"\n+  resolved \"https://registry.yarnpkg.com/@types/babel__traverse/-/babel__traverse-7.18.2.tgz#235bf339d17185bdec25e024ca19cce257cc7309\"\n+  integrity sha512-FcFaxOr2V5KZCviw1TnutEMVUVsGt4D2hP1TAfXZAMKuHYW3xQhe3jTxNPWutgCJ3/X1c5yX8ZoGVEItxKbwBg==\n   dependencies:\n     \"@babel/types\" \"^7.3.0\"\n \n@@ -11054,13 +11054,6 @@ madge@^5.0.0:\n     typescript \"^3.9.5\"\n     walkdir \"^0.4.1\"\n \n-magic-string@0.26.3:\n-  version \"0.26.3\"\n-  resolved \"https://registry.yarnpkg.com/magic-string/-/magic-string-0.26.3.tgz#25840b875140f7b4785ab06bddc384270b7dd452\"\n-  integrity sha512-u1Po0NDyFcwdg2nzHT88wSK0+Rih0N1M+Ph1Sp08k8yvFFU3KR72wryS7e1qMPJypt99WB7fIFVCA92mQrMjrg==\n-  dependencies:\n-    sourcemap-codec \"^1.4.8\"\n-\n magic-string@0.26.5:\n   version \"0.26.5\"\n   resolved \"https://registry.yarnpkg.com/magic-string/-/magic-string-0.26.5.tgz#3ceb5c60f546ba4e21e3865ab8de4d32bd8ed07f\"\n@@ -11068,6 +11061,13 @@ magic-string@0.26.5:\n   dependencies:\n     sourcemap-codec \"^1.4.8\"\n \n+magic-string@0.26.7:\n+  version \"0.26.7\"\n+  resolved \"https://registry.yarnpkg.com/magic-string/-/magic-string-0.26.7.tgz#caf7daf61b34e9982f8228c4527474dac8981d6f\"\n+  integrity sha512-hX9XH3ziStPoPhJxLq1syWuZMxbDvGNbVchfrdCtanC7D13888bMFow61x8axrx+GfHLtVeAx2kxL7tTGRl+Ow==\n+  dependencies:\n+    sourcemap-codec \"^1.4.8\"\n+\n magic-string@^0.25.7:\n   version \"0.25.9\"\n   resolved \"https://registry.yarnpkg.com/magic-string/-/magic-string-0.25.9.tgz#de7f9faf91ef8a1c91d02c2e5314c8277dbcdd1c\"\n\n\n###\n\n", "completion": "build: update all non-major dependencies (#<issue-num>)"}
{"prompt": " file path A: aio/tools/examples/shared/boilerplate/systemjs/package.json | file path B: aio/tools/examples/shared/boilerplate/systemjs/package.json\n\n@@ -43,7 +43,7 @@\n   },\n   \"devDependencies\": {\n     \"@angular/compiler-cli\": \"^14.2.0\",\n-    \"@rollup/plugin-commonjs\": \"^22.0.0\",\n+    \"@rollup/plugin-commonjs\": \"^23.0.0\",\n     \"@rollup/plugin-node-resolve\": \"^13.2.0\",\n     \"@types/angular\": \"^1.8.4\",\n     \"@types/angular-animate\": \"^1.5.11\",\n\n---\n file path A: aio/tools/examples/shared/package.json | file path B: aio/tools/examples/shared/package.json\n\n@@ -51,7 +51,7 @@\n     \"@angular/cli\": \"^14.2.1\",\n     \"@angular/compiler-cli\": \"^14.2.0\",\n     \"@nguniversal/builders\": \"^14.1.0\",\n-    \"@rollup/plugin-commonjs\": \"^22.0.0\",\n+    \"@rollup/plugin-commonjs\": \"^23.0.0\",\n     \"@rollup/plugin-node-resolve\": \"^13.2.0\",\n     \"@types/angular\": \"^1.8.4\",\n     \"@types/angular-animate\": \"^1.5.11\",\n\n---\n file path A: aio/tools/examples/shared/yarn.lock | file path B: aio/tools/examples/shared/yarn.lock\n\n@@ -1744,18 +1744,17 @@\n     read-package-json-fast \"^2.0.3\"\n     which \"^2.0.2\"\n \n-\"@rollup/plugin-commonjs@^22.0.0\":\n-  version \"22.0.1\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/plugin-commonjs/-/plugin-commonjs-22.0.1.tgz#f7cb777d20de3eeeaf994f39080115c336bef810\"\n-  integrity sha512-dGfEZvdjDHObBiP5IvwTKMVeq/tBZGMBHZFMdIV1ClMM/YoWS34xrHFGfag9SN2ZtMgNZRFruqvxZQEa70O6nQ==\n+\"@rollup/plugin-commonjs@^23.0.0\":\n+  version \"23.0.0\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/plugin-commonjs/-/plugin-commonjs-23.0.0.tgz#3f64a49409d0681cd7496a71dd6577f07d39c3b0\"\n+  integrity sha512-JbrTRyDNtLQj/rhl7RFUuYXwQ2fac+33oLDAu2k++WD95zweyo28UAomLVA0JMGx4vmCa7Nw4T6k/1F6lelExg==\n   dependencies:\n-    \"@rollup/pluginutils\" \"^3.1.0\"\n+    \"@rollup/pluginutils\" \"^4.2.1\"\n     commondir \"^1.0.1\"\n-    estree-walker \"^2.0.1\"\n-    glob \"^7.1.6\"\n-    is-reference \"^1.2.1\"\n-    magic-string \"^0.25.7\"\n-    resolve \"^1.17.0\"\n+    estree-walker \"^2.0.2\"\n+    glob \"^8.0.3\"\n+    is-reference \"1.2.1\"\n+    magic-string \"^0.26.4\"\n \n \"@rollup/plugin-node-resolve@^13.2.0\":\n   version \"13.3.0\"\n@@ -1778,6 +1777,14 @@\n     estree-walker \"^1.0.1\"\n     picomatch \"^2.2.2\"\n \n+\"@rollup/pluginutils@^4.2.1\":\n+  version \"4.2.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/pluginutils/-/pluginutils-4.2.1.tgz#e6c6c3aba0744edce3fb2074922d3776c0af2a6d\"\n+  integrity sha512-iKnFXr7NkdZAIHiIWE+BX5ULi/ucVFYWD6TbAV+rZctiRTY2PL6tsIKhoIOaoskiWAkgu+VsbXgUVDNLHf+InQ==\n+  dependencies:\n+    estree-walker \"^2.0.1\"\n+    picomatch \"^2.2.2\"\n+\n \"@schematics/angular@14.2.1\":\n   version \"14.2.1\"\n   resolved \"https://registry.yarnpkg.com/@schematics/angular/-/angular-14.2.1.tgz#00f54cb6b30dc1945b6d344ca225c04dcc12f682\"\n@@ -4063,7 +4070,7 @@ estree-walker@^1.0.1:\n   resolved \"https://registry.yarnpkg.com/estree-walker/-/estree-walker-1.0.1.tgz#31bc5d612c96b704106b477e6dd5d8aa138cb700\"\n   integrity sha512-1fMXF3YP4pZZVozF8j/ZLfvnR8NSIljt56UhbZ5PeeDmmGHpgpdwQt7ITlGvYaQukCvuBRMLEiKiYC+oeIg4cg==\n \n-estree-walker@^2.0.1:\n+estree-walker@^2.0.1, estree-walker@^2.0.2:\n   version \"2.0.2\"\n   resolved \"https://registry.yarnpkg.com/estree-walker/-/estree-walker-2.0.2.tgz#52f010178c2a4c117a7757cfe942adb7d2da4cac\"\n   integrity sha512-Rfkk/Mp/DL7JVje3u18FxFujQlTNR2q6QfMSMB7AvCBx91NGj/ba3kCfza0f6dVDbw7YlRf/nDrn7pQrCCyQ/w==\n@@ -4492,7 +4499,7 @@ glob-to-regexp@^0.4.1:\n   resolved \"https://registry.yarnpkg.com/glob-to-regexp/-/glob-to-regexp-0.4.1.tgz#c75297087c851b9a578bd217dd59a92f59fe546e\"\n   integrity sha512-lkX1HJXwyMcprw/5YUZc2s7DrpAiHB21/V+E1rHUrVNokkvB6bqMzT0VfV6/86ZNabt1k14YOIaT7nDvOX3Iiw==\n \n-glob@8.0.3, glob@^8.0.1:\n+glob@8.0.3, glob@^8.0.1, glob@^8.0.3:\n   version \"8.0.3\"\n   resolved \"https://registry.yarnpkg.com/glob/-/glob-8.0.3.tgz#415c6eb2deed9e502c68fa44a272e6da6eeca42e\"\n   integrity sha512-ull455NHSHI/Y1FqGaaYFaLGkNMMJbavMrEGFXG/PGrg6y7sutWHUHrz6gy6WEBH6akM1M414dWKCNs+IhKdiQ==\n@@ -5073,7 +5080,7 @@ is-potential-custom-element-name@^1.0.1:\n   resolved \"https://registry.yarnpkg.com/is-potential-custom-element-name/-/is-potential-custom-element-name-1.0.1.tgz#171ed6f19e3ac554394edf78caa05784a45bebb5\"\n   integrity sha512-bCYeRA2rVibKZd+s2625gGnGF/t7DSqDs4dP7CrLA1m7jKWz6pps0LpYLJN8Q64HtmPKJ1hrN3nzPNKFEKOUiQ==\n \n-is-reference@^1.2.1:\n+is-reference@1.2.1:\n   version \"1.2.1\"\n   resolved \"https://registry.yarnpkg.com/is-reference/-/is-reference-1.2.1.tgz#8b2dac0b371f4bc994fdeaba9eb542d03002d0b7\"\n   integrity sha512-U82MsXXiFIrjCK4otLT+o2NA2Cd2g5MLoOVXUZjIOhLurrRxpEXzI8O0KZHr3IjLvlAH1kTPYSuqer5T9ZVBKQ==\n@@ -5659,10 +5666,10 @@ magic-string@0.26.2, magic-string@^0.26.0:\n   dependencies:\n     sourcemap-codec \"^1.4.8\"\n \n-magic-string@^0.25.7:\n-  version \"0.25.9\"\n-  resolved \"https://registry.yarnpkg.com/magic-string/-/magic-string-0.25.9.tgz#de7f9faf91ef8a1c91d02c2e5314c8277dbcdd1c\"\n-  integrity sha512-RmF0AsMzgt25qzqqLc1+MbHmhdx0ojF2Fvs4XnOqz2ZOBXzzkEwc/dJQZCYHAn7v1jbVOjAZfK8msRn4BxO4VQ==\n+magic-string@^0.26.4:\n+  version \"0.26.7\"\n+  resolved \"https://registry.yarnpkg.com/magic-string/-/magic-string-0.26.7.tgz#caf7daf61b34e9982f8228c4527474dac8981d6f\"\n+  integrity sha512-hX9XH3ziStPoPhJxLq1syWuZMxbDvGNbVchfrdCtanC7D13888bMFow61x8axrx+GfHLtVeAx2kxL7tTGRl+Ow==\n   dependencies:\n     sourcemap-codec \"^1.4.8\"\n \n@@ -7205,7 +7212,7 @@ resolve-url-loader@5.0.0:\n     postcss \"^8.2.14\"\n     source-map \"0.6.1\"\n \n-resolve@1.22.1, resolve@^1.1.7, resolve@^1.14.2, resolve@^1.17.0, resolve@^1.19.0:\n+resolve@1.22.1, resolve@^1.1.7, resolve@^1.14.2, resolve@^1.19.0:\n   version \"1.22.1\"\n   resolved \"https://registry.yarnpkg.com/resolve/-/resolve-1.22.1.tgz#27cb2ebb53f91abb49470a928bba7558066ac177\"\n   integrity sha512-nBpuuYuY5jFsli/JIs1oldw6fOQCBioohqWZg/2hiaOybXOft4lonv85uDOKXdf8rhyK159cxU5cDcK/NKk8zw==\n\n---\n file path A: package.json | file path B: package.json\n\n@@ -78,7 +78,7 @@\n     \"@bazel/worker\": \"5.5.3\",\n     \"@microsoft/api-extractor\": \"^7.24.2\",\n     \"@rollup/plugin-babel\": \"^6.0.0\",\n-    \"@rollup/plugin-commonjs\": \"^22.0.0\",\n+    \"@rollup/plugin-commonjs\": \"^23.0.0\",\n     \"@rollup/plugin-node-resolve\": \"^13.0.4\",\n     \"@schematics/angular\": \"15.0.0-next.4\",\n     \"@types/angular\": \"^1.6.47\",\n\n---\n file path A: packages/bazel/package.json | file path B: packages/bazel/package.json\n\n@@ -31,7 +31,7 @@\n     \"@angular/compiler-cli\": \"0.0.0-PLACEHOLDER\",\n     \"@bazel/concatjs\": \"^5.3.0\",\n     \"@bazel/worker\": \"^5.3.0\",\n-    \"@rollup/plugin-commonjs\": \"^22.0.0\",\n+    \"@rollup/plugin-commonjs\": \"^23.0.0\",\n     \"@rollup/plugin-node-resolve\": \"^13.0.4\",\n     \"rollup\": \"^2.56.3\",\n     \"rollup-plugin-sourcemaps\": \"^0.6.3\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -2730,18 +2730,17 @@\n     \"@babel/helper-module-imports\" \"^7.18.6\"\n     \"@rollup/pluginutils\" \"^4.2.1\"\n \n-\"@rollup/plugin-commonjs@^22.0.0\":\n-  version \"22.0.1\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/plugin-commonjs/-/plugin-commonjs-22.0.1.tgz#f7cb777d20de3eeeaf994f39080115c336bef810\"\n-  integrity sha512-dGfEZvdjDHObBiP5IvwTKMVeq/tBZGMBHZFMdIV1ClMM/YoWS34xrHFGfag9SN2ZtMgNZRFruqvxZQEa70O6nQ==\n+\"@rollup/plugin-commonjs@^23.0.0\":\n+  version \"23.0.0\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/plugin-commonjs/-/plugin-commonjs-23.0.0.tgz#3f64a49409d0681cd7496a71dd6577f07d39c3b0\"\n+  integrity sha512-JbrTRyDNtLQj/rhl7RFUuYXwQ2fac+33oLDAu2k++WD95zweyo28UAomLVA0JMGx4vmCa7Nw4T6k/1F6lelExg==\n   dependencies:\n-    \"@rollup/pluginutils\" \"^3.1.0\"\n+    \"@rollup/pluginutils\" \"^4.2.1\"\n     commondir \"^1.0.1\"\n-    estree-walker \"^2.0.1\"\n-    glob \"^7.1.6\"\n-    is-reference \"^1.2.1\"\n-    magic-string \"^0.25.7\"\n-    resolve \"^1.17.0\"\n+    estree-walker \"^2.0.2\"\n+    glob \"^8.0.3\"\n+    is-reference \"1.2.1\"\n+    magic-string \"^0.26.4\"\n \n \"@rollup/plugin-node-resolve@^13.0.4\":\n   version \"13.3.0\"\n@@ -7548,7 +7547,7 @@ estree-walker@^1.0.1:\n   resolved \"https://registry.yarnpkg.com/estree-walker/-/estree-walker-1.0.1.tgz#31bc5d612c96b704106b477e6dd5d8aa138cb700\"\n   integrity sha512-1fMXF3YP4pZZVozF8j/ZLfvnR8NSIljt56UhbZ5PeeDmmGHpgpdwQt7ITlGvYaQukCvuBRMLEiKiYC+oeIg4cg==\n \n-estree-walker@^2.0.1:\n+estree-walker@^2.0.1, estree-walker@^2.0.2:\n   version \"2.0.2\"\n   resolved \"https://registry.yarnpkg.com/estree-walker/-/estree-walker-2.0.2.tgz#52f010178c2a4c117a7757cfe942adb7d2da4cac\"\n   integrity sha512-Rfkk/Mp/DL7JVje3u18FxFujQlTNR2q6QfMSMB7AvCBx91NGj/ba3kCfza0f6dVDbw7YlRf/nDrn7pQrCCyQ/w==\n@@ -8677,7 +8676,7 @@ glob-watcher@^5.0.3:\n     normalize-path \"^3.0.0\"\n     object.defaults \"^1.1.0\"\n \n-glob@8.0.3, glob@^8.0.1:\n+glob@8.0.3, glob@^8.0.1, glob@^8.0.3:\n   version \"8.0.3\"\n   resolved \"https://registry.yarnpkg.com/glob/-/glob-8.0.3.tgz#415c6eb2deed9e502c68fa44a272e6da6eeca42e\"\n   integrity sha512-ull455NHSHI/Y1FqGaaYFaLGkNMMJbavMrEGFXG/PGrg6y7sutWHUHrz6gy6WEBH6akM1M414dWKCNs+IhKdiQ==\n@@ -9920,7 +9919,7 @@ is-promise@^2.2.2:\n   resolved \"https://registry.yarnpkg.com/is-promise/-/is-promise-2.2.2.tgz#39ab959ccbf9a774cf079f7b40c7a26f763135f1\"\n   integrity sha512-+lP4/6lKUBfQjZ2pdxThZvLUAafmZb8OAxFb8XXtiQmS35INgr85hdOGoEs124ez1FCnZJt6jau/T+alh58QFQ==\n \n-is-reference@^1.2.1:\n+is-reference@1.2.1:\n   version \"1.2.1\"\n   resolved \"https://registry.yarnpkg.com/is-reference/-/is-reference-1.2.1.tgz#8b2dac0b371f4bc994fdeaba9eb542d03002d0b7\"\n   integrity sha512-U82MsXXiFIrjCK4otLT+o2NA2Cd2g5MLoOVXUZjIOhLurrRxpEXzI8O0KZHr3IjLvlAH1kTPYSuqer5T9ZVBKQ==\n@@ -11076,6 +11075,13 @@ magic-string@^0.25.7:\n   dependencies:\n     sourcemap-codec \"^1.4.8\"\n \n+magic-string@^0.26.4:\n+  version \"0.26.7\"\n+  resolved \"https://registry.yarnpkg.com/magic-string/-/magic-string-0.26.7.tgz#caf7daf61b34e9982f8228c4527474dac8981d6f\"\n+  integrity sha512-hX9XH3ziStPoPhJxLq1syWuZMxbDvGNbVchfrdCtanC7D13888bMFow61x8axrx+GfHLtVeAx2kxL7tTGRl+Ow==\n+  dependencies:\n+    sourcemap-codec \"^1.4.8\"\n+\n make-dir@^1.0.0:\n   version \"1.3.0\"\n   resolved \"https://registry.yarnpkg.com/make-dir/-/make-dir-1.3.0.tgz#79c1033b80515bd6d24ec9933e860ca75ee27f0c\"\n@@ -13748,7 +13754,7 @@ resolve-url@^0.2.1:\n   resolved \"https://registry.yarnpkg.com/resolve-url/-/resolve-url-0.2.1.tgz#2c637fe77c893afd2a663fe21aa9080068e2052a\"\n   integrity sha512-ZuF55hVUQaaczgOIwqWzkEcEidmlD/xl44x1UZnhOXcYuFN2S6+rcxpG+C1N3So0wvNI3DmJICUFfu2SxhBmvg==\n \n-resolve@1.22.1, resolve@^1.1.6, resolve@^1.1.7, resolve@^1.10.0, resolve@^1.14.2, resolve@^1.17.0, resolve@^1.19.0, resolve@^1.21.0, resolve@^1.3.2, resolve@^1.4.0:\n+resolve@1.22.1, resolve@^1.1.6, resolve@^1.1.7, resolve@^1.10.0, resolve@^1.14.2, resolve@^1.19.0, resolve@^1.21.0, resolve@^1.3.2, resolve@^1.4.0:\n   version \"1.22.1\"\n   resolved \"https://registry.yarnpkg.com/resolve/-/resolve-1.22.1.tgz#27cb2ebb53f91abb49470a928bba7558066ac177\"\n   integrity sha512-nBpuuYuY5jFsli/JIs1oldw6fOQCBioohqWZg/2hiaOybXOft4lonv85uDOKXdf8rhyK159cxU5cDcK/NKk8zw==\n\n\n###\n\n", "completion": "build: update dependency @rollup/plugin-commonjs to v23 (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/what-is-angular.md | file path B: aio/content/guide/what-is-angular.md\n\n@@ -10,7 +10,7 @@ As a platform, Angular includes:\n *   A suite of developer tools to help you develop, build, test, and update your code\n \n With Angular, you're taking advantage of a platform that can scale from single-developer projects to enterprise-level applications.\n-Angular is designed to make updating as straightforward as possible, so take advantage of the latest developments with a minimum of effort.\n+Angular is designed to make updating as straightforward as possible, so take advantage of the latest developments with minimal effort.\n Best of all, the Angular ecosystem consists of a diverse group of over 1.7 million developers, library authors, and content creators.\n \n <div class=\"alert is-helpful\">\n@@ -53,7 +53,7 @@ When Angular renders this component, the resulting DOM looks like this:\n <code-example format=\"html\" language=\"html\" path=\"what-is-angular/src/app/hello-world-example.html\"></code-example>\n \n Angular's component model offers strong encapsulation and an intuitive application structure.\n-Components also make your application painless to unit test and can improve the overall readability of your code.\n+Components also make your application painless to unit test and can improve the general readability of your code.\n \n For more information on what to do with components, see the [Components](guide/component-overview) section.\n \n@@ -61,10 +61,14 @@ For more information on what to do with components, see the [Components](guide/c\n \n ### Templates\n \n+<!-- vale Angular.Google_WordListWarnings = NO -->\n+\n Every component has an HTML template that declares how that component renders.\n You define this template either inline or by file path.\n \n-Angular extends HTML with additional syntax that lets you insert dynamic values from your component.\n+<!-- vale Angular.Google_WordListWarnings = YES -->\n+\n+Angular adds syntax elements that extend HTML so you can insert dynamic values from your component.\n Angular automatically updates the rendered DOM when your component's state changes.\n One application of this feature is inserting dynamic text, as shown in the following example.\n \n@@ -106,7 +110,7 @@ The following is a combined example of Interpolation, Property Binding, and Even\n     <code-pane header=\"hello-world-bindings.component.html\" path=\"what-is-angular/src/app/hello-world-bindings/hello-world-bindings.component.html\"></code-pane>\n </code-tabs>\n \n-Add additional functionality to your templates through the use of [directives](guide/built-in-directives).\n+Add features to your templates by using [directives](guide/built-in-directives).\n The most popular directives in Angular are `*ngIf` and `*ngFor`.\n Use directives to perform a variety of tasks, such as dynamically modifying the DOM structure.\n And create your own custom directives to create great user experiences.\n@@ -130,7 +134,7 @@ For more information on templates, see the [Templates](guide/template-syntax) se\n Dependency injection lets you declare the dependencies of your TypeScript classes without taking care of their instantiation.\n Instead, Angular handles the instantiation for you.\n This design pattern lets you write more testable and flexible code.\n-Even though understanding dependency injection is not critical to start using Angular, we strongly recommend it as a best practice and many aspects of Angular take advantage of it to some degree.\n+Understanding dependency injection is not critical to start using Angular, but it is strongly recommended as a best practice. Many aspects of Angular take advantage of it to some degree.\n \n To illustrate how dependency injection works, consider the following example.\n The first file, `logger.service.ts`, defines a `Logger` class.\n@@ -151,53 +155,64 @@ For more information about dependency injection and Angular, see the [Dependency\n ## Angular CLI\n \n The Angular CLI is the fastest, straightforward, and recommended way to develop Angular applications.\n-The Angular CLI makes a number of tasks trouble-free.\n-Here are some examples:\n+The Angular CLI makes some tasks trouble-free.\n+For example:\n+\n+<!-- vale Angular.Google_WordListSuggestions = NO -->\n \n | Command                     | Details |\n |:---                         |:---     |\n-| [ng build](cli/build)       | Compiles an Angular app into an output directory.                     |\n+| [ng build](cli/build)       | Compiles an Angular application into an output directory.                     |\n | [ng serve](cli/serve)       | Builds and serves your application, rebuilding on file changes.       |\n | [ng generate](cli/generate) | Generates or modifies files based on a schematic.                     |\n | [ng test](cli/test)         | Runs unit tests on a given project.                                   |\n | [ng e2e](cli/e2e)           | Builds and serves an Angular application, then runs end-to-end tests. |\n \n-You'll find the Angular CLI a valuable tool for building out your applications.\n+<!-- vale Angular.Google_WordListSuggestions = YES -->\n+\n+The Angular CLI is a valuable tool for building out your applications.\n \n-For more information about the Angular CLI, see the [CLI Reference](cli) section.\n+For more information about the Angular CLI, see the [Angular CLI Reference](cli) section.\n \n <a id=\"1p-libraries\"></a>\n \n ## First-party libraries\n \n-The section, [Angular applications: The essentials](#essentials), provides a brief overview of a couple of the key architectural elements you'll use when building Angular applications.\n-But the many benefits of Angular really become apparent when your application grows and you want to add additional functions such as site navigation or user input.\n+The section, [Angular applications: the essentials](#essentials), provides a brief overview of a couple of the key architectural elements that are used when building Angular applications.\n+The many benefits of Angular really become clear when your application grows and you want to add functions such as site navigation or user input.\n Use the Angular platform to incorporate one of the many first-party libraries that Angular provides.\n \n Some of the libraries available to you include:\n \n+<!-- vale Angular.Google_Acronyms = NO -->\n+\n | Library                                   | Details |\n |:---                                       |:---     |\n | [Angular Router](guide/router)            | Advanced client-side navigation and routing based on Angular components. Supports lazy-loading, nested routes, custom path matching, and more. |\n | [Angular Forms](guide/forms-overview)     | Uniform system for form participation and validation.                                                                                          |\n | [Angular HttpClient](guide/http)          | Robust HTTP client that can power more advanced client-server communication.                                                                   |\n | [Angular Animations](guide/animations)    | Rich system for driving animations based on application state.                                                                                 |\n-| [Angular PWA](guide/service-worker-intro) | Tools for building Progressive Web Applications \\(PWAs\\) including a service worker and Web app manifest.                                      |\n+| [Angular PWA](guide/service-worker-intro) | Tools for building Progressive Web Applications \\(PWA\\) including a service worker and Web application manifest.                                      |\n | [Angular Schematics](guide/schematics)    | Automated scaffolding, refactoring, and update tools that simplify development at large scale.                                                 |\n \n-These libraries expand your application's functionality while also letting you focus more on the features that make your application unique.\n-Add these libraries knowing that they're designed to integrate seamlessly into and update simultaneously with the Angular framework.\n+<!-- vale Angular.Google_Acronyms = YES -->\n+\n+These libraries expand your application's capabilities while also letting you focus more on the features that make your application unique.\n+Add these libraries knowing that they're designed to integrate flawlessly into and update simultaneously with the Angular framework.\n \n-These libraries are only required if and when they can help you add functionality to your applications or solve a particular problem.\n+These libraries are only required when they can help you add features to your applications or solve a particular problem.\n \n ## Next steps\n \n-This topic is intended to give you a brief overview of what Angular is, the advantages it provides, and what to expect as you start to build your applications.\n+This topic gives you a brief overview of what Angular is, the advantages it provides, and what to expect as you start to build your applications.\n \n-To see Angular in action, see our [Getting Started](start) tutorial.\n+To see Angular in action, see the [Getting Started](start) tutorial.\n This tutorial uses [stackblitz.com](https://stackblitz.com), for you to explore a working example of Angular without any installation requirements.\n \n-To explore Angular's capabilities further, we recommend reading through the sections, Understanding Angular, and Developer Guides.\n+The following sections are recommended to explore Angular's capabilities further:\n+\n+*   [Understanding Angular](guide/understanding-angular-overview)\n+*   [Angular Developer Guide](guide/developer-guide-overview)\n \n <!-- links -->\n \n\n\n###\n\n", "completion": "docs: fix linter errors for what-is-angular.md (#<issue-num>)"}
{"prompt": " file path A: devtools/projects/shell-browser/src/BUILD.bazel | file path B: devtools/projects/shell-browser/src/BUILD.bazel\n\n@@ -133,6 +133,7 @@ pkg_web(\n         \"//devtools/projects/shell-browser/src/app:backend_bundle\",\n         \"//devtools/projects/shell-browser/src/app:background_bundle\",\n         \"//devtools/projects/shell-browser/src/app:content_script_bundle\",\n+        \"//devtools/projects/shell-browser/src/app:detect_angular_for_extension_icon_bundle\",\n         \"//devtools/projects/shell-browser/src/app:ng_validate_bundle\",\n         \"//devtools/projects/shell-browser/src/assets\",\n         \"//devtools/projects/shell-browser/src/popups\",\n\n---\n file path A: devtools/projects/shell-browser/src/app/BUILD.bazel | file path B: devtools/projects/shell-browser/src/app/BUILD.bazel\n\n@@ -126,7 +126,7 @@ ts_library(\n     srcs = [\n         \"background.ts\",\n     ],\n-    deps = [\"//devtools/projects/shell-browser/src/app:ng_validate\"],\n+    deps = [\"//devtools/projects/shell-browser/src/app:detect_angular_for_extension_icon\"],\n )\n \n ts_library(\n@@ -156,6 +156,30 @@ ts_library(\n     ],\n )\n \n+ts_library(\n+    name = \"detect_angular_for_extension_icon\",\n+    srcs = [\n+        \"detect-angular-for-extension-icon.ts\",\n+    ],\n+    deps = [\n+        \"@npm//@types\",\n+    ],\n+)\n+\n+esbuild(\n+    name = \"detect_angular_for_extension_icon_bundle\",\n+    config = \"//devtools/tools/esbuild:esbuild_config_iife\",\n+    entry_point = \"detect-angular-for-extension-icon.ts\",\n+    format = \"iife\",\n+    minify = True,\n+    platform = \"browser\",\n+    splitting = False,\n+    target = \"esnext\",\n+    deps = [\n+        \":detect_angular_for_extension_icon\",\n+    ],\n+)\n+\n esbuild(\n     name = \"backend_bundle\",\n     config = \"//devtools/tools/esbuild:esbuild_config_iife\",\n\n---\n file path A: devtools/projects/shell-browser/src/app/background.ts | file path B: devtools/projects/shell-browser/src/app/background.ts\n\n@@ -8,19 +8,29 @@\n \n /// <reference types=\"chrome\"/>\n \n-import {AngularDetection} from './ng-validate';\n+import {AngularDetection} from './detect-angular-for-extension-icon';\n \n-// Electron does not expose browserAction object,\n-// Use empty calls as fallback if they are not defined.\n-const browserAction = chrome.browserAction || {setIcon: () => {}, setPopup: () => {}};\n+const isManifestV3 = chrome.runtime.getManifest().manifest_version === 3;\n+\n+const browserAction = (() => {\n+  // Electron does not expose browserAction object,\n+  // Use empty calls as fallback if they are not defined.\n+  const noopAction = {setIcon: () => {}, setPopup: () => {}};\n+\n+  if (isManifestV3) {\n+    return chrome.action || noopAction;\n+  }\n+\n+  return chrome.browserAction || noopAction;\n+})();\n \n // By default use the black and white icon.\n // Replace it only when we detect an Angular app.\n browserAction.setIcon({\n   path: {\n-    16: `assets/icon-bw16.png`,\n-    48: `assets/icon-bw48.png`,\n-    128: `assets/icon-bw128.png`,\n+    16: chrome.runtime.getURL(`assets/icon-bw16.png`),\n+    48: chrome.runtime.getURL(`assets/icon-bw48.png`),\n+    128: chrome.runtime.getURL(`assets/icon-bw128.png`),\n   },\n });\n \n@@ -94,6 +104,17 @@ const installContentScript = (tabId: number) => {\n \n   // We first inject the content-script and after that\n   // invoke the global that it exposes.\n+\n+  if (isManifestV3) {\n+    chrome.scripting.executeScript(\n+        {files: ['app/content_script_bundle.js'], target: {tabId}}, () => {\n+          chrome.scripting.executeScript({func: () => globalThis.main(), target: {tabId}});\n+        });\n+\n+    return;\n+  }\n+\n+  // manifest V2 APIs\n   chrome.tabs.executeScript(tabId, {file: 'app/content_script_bundle.js'}, (result) => {\n     chrome.tabs.executeScript(tabId, {\n       code: 'globalThis.main()',\n@@ -163,9 +184,9 @@ chrome.runtime.onMessage.addListener((req, sender) => {\n     browserAction.setIcon({\n       tabId: sender.tab.id,\n       path: {\n-        16: `assets/icon16.png`,\n-        48: `assets/icon48.png`,\n-        128: `assets/icon128.png`,\n+        16: chrome.runtime.getURL(`assets/icon16.png`),\n+        48: chrome.runtime.getURL(`assets/icon48.png`),\n+        128: chrome.runtime.getURL(`assets/icon128.png`),\n       },\n     });\n   }\n\n---\n file path A: None | file path B: devtools/projects/shell-browser/src/app/detect-angular-for-extension-icon.ts\n\n@@ -0,0 +1,53 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+export interface AngularDetection {\n+  // This is necessary because the runtime\n+  // message listener handles messages globally\n+  // including from other extensions. We don't\n+  // want to set icon and/or popup based on\n+  // a message coming from an unrelated extension.\n+  isAngularDevTools: true;\n+  isIvy: boolean;\n+  isAngular: boolean;\n+  isDebugMode: boolean;\n+  isSupportedAngularVersion: boolean;\n+}\n+\n+function detectAngular(win: Window): void {\n+  const isDebugMode = Boolean((win as any).ng);\n+  const ngVersionElement = document.querySelector('[ng-version]');\n+  let isSupportedAngularVersion = false;\n+  let isAngular = false;\n+\n+  if (ngVersionElement) {\n+    isAngular = true;\n+    const attr = ngVersionElement.getAttribute('ng-version');\n+    const major = attr ? parseInt(attr.split('.')[0], 10) : -1;\n+    // In case of g3 apps we support major 0.\n+    if (attr && (major >= 12 || major === 0)) {\n+      isSupportedAngularVersion = true;\n+    }\n+  }\n+\n+  win.postMessage(\n+      {\n+        isIvy: typeof (ngVersionElement as any)?.__ngContext__ !== 'undefined',\n+        isAngular,\n+        isDebugMode,\n+        isSupportedAngularVersion,\n+        isAngularDevTools: true,\n+      } as AngularDetection,\n+      '*');\n+\n+  if (!isAngular) {\n+    setTimeout(() => detectAngular(win), 1000);\n+  }\n+}\n+\n+detectAngular(window);\n\n---\n file path A: devtools/projects/shell-browser/src/app/ng-validate.ts | file path B: devtools/projects/shell-browser/src/app/ng-validate.ts\n\n@@ -8,68 +8,13 @@\n \n /// <reference types=\"chrome\"/>\n \n-export interface AngularDetection {\n-  // This is necessary because the runtime\n-  // message listener handles messages globally\n-  // including from other extensions. We don't\n-  // want to set icon and/or popup based on\n-  // a message coming from an unrelated extension.\n-  isAngularDevTools: true;\n-  isIvy: boolean;\n-  isAngular: boolean;\n-  isDebugMode: boolean;\n-  isSupportedAngularVersion: boolean;\n-}\n-\n window.addEventListener('message', (event: MessageEvent) => {\n   if (event.source === window && event.data) {\n     chrome.runtime.sendMessage(event.data);\n   }\n });\n \n-function detectAngular(win: Window): void {\n-  const isDebugMode = Boolean((win as any).ng);\n-  const ngVersionElement = document.querySelector('[ng-version]');\n-  let isSupportedAngularVersion = false;\n-  let isAngular = false;\n-  if (ngVersionElement) {\n-    isAngular = true;\n-    const attr = ngVersionElement.getAttribute('ng-version');\n-    const major = attr ? parseInt(attr.split('.')[0], 10) : -1;\n-    // In case of g3 apps we support major 0.\n-    if (attr && (major >= 9 || major === 0)) {\n-      isSupportedAngularVersion = true;\n-    }\n-  }\n-\n-  win.postMessage(\n-      {\n-        // Needs to be inline because we're stringifying\n-        // this function and executing it with eval.\n-        isIvy: typeof (ngVersionElement as any)?.__ngContext__ !== 'undefined',\n-        isAngular,\n-        isDebugMode,\n-        isSupportedAngularVersion,\n-        isAngularDevTools: true,\n-      } as AngularDetection,\n-      '*');\n-\n-  if (!isAngular) {\n-    setTimeout(() => detectAngular(win), 1000);\n-  }\n-}\n-\n-function installScript(fn: string): void {\n-  const source = `;(${fn})(window)`;\n-  const script = document.createElement('script');\n-  script.textContent = source;\n-  document.documentElement.appendChild(script);\n-  const parentElement = script.parentElement;\n-  if (parentElement) {\n-    parentElement.removeChild(script);\n-  }\n-}\n-\n-if (document instanceof Document) {\n-  installScript(detectAngular.toString());\n-}\n+const script = document.createElement('script');\n+script.src = chrome.runtime.getURL('app/detect_angular_for_extension_icon_bundle.js');\n+document.documentElement.appendChild(script);\n+document.documentElement.removeChild(script);\n\n---\n file path A: devtools/projects/shell-browser/src/manifest/manifest.chrome.json | file path B: devtools/projects/shell-browser/src/manifest/manifest.chrome.json\n\n@@ -1,36 +1,48 @@\n {\n-  \"manifest_version\": 2,\n+  \"manifest_version\": 3,\n   \"short_name\": \"Angular DevTools\",\n   \"name\": \"Angular DevTools\",\n   \"description\": \"Angular DevTools extends Chrome DevTools adding Angular specific debugging and profiling capabilities.\",\n   \"version\": \"1.0.6\",\n   \"version_name\": \"1.0.6\",\n-  \"minimum_chrome_version\": \"50\",\n-  \"content_security_policy\": \"script-src 'self' 'unsafe-eval'; object-src 'self'\",\n+  \"minimum_chrome_version\": \"102\",\n+  \"content_security_policy\": {\n+    \"extension_pages\": \"script-src 'self'; object-src 'self'\"\n+  },\n   \"icons\": {\n     \"16\": \"assets/icon16.png\",\n     \"48\": \"assets/icon48.png\",\n     \"128\": \"assets/icon128.png\"\n   },\n-  \"browser_action\": {\n-    \"default_popup\": \"popups/not-angular.html\"\n+  \"action\": {\n+    \"default_popup\": \"popups/not-angular.html\",\n+    \"default_icon\": {\n+      \"16\": \"assets/icon-bw16.png\",\n+      \"48\": \"assets/icon-bw48.png\",\n+      \"128\": \"assets/icon-bw128.png\"\n+    }\n   },\n   \"devtools_page\": \"devtools.html\",\n   \"web_accessible_resources\": [\n-    \"app/backend_bundle.js\",\n-    \"devtools.html\"\n+    {\n+      \"resources\": [\n+        \"app/backend_bundle.js\",\n+        \"app/detect_angular_for_extension_icon_bundle.js\",\n+        \"devtools.html\"\n+      ],\n+      \"matches\": [\"<all_urls>\"],\n+      \"extension_ids\": []\n+    }\n   ],\n   \"background\": {\n-    \"scripts\": [\n-      \"app/background_bundle.js\"\n-    ],\n-    \"persistent\": false\n+    \"service_worker\": \"app/background_bundle.js\"\n   },\n   \"permissions\": [\n-    \"activeTab\",\n-    \"http://*/*\",\n-    \"https://*/*\",\n-    \"file:///*\"\n+    \"scripting\",\n+    \"activeTab\"\n+  ],\n+  \"host_permissions\": [\n+    \"<all_urls>\"\n   ],\n   \"content_scripts\": [\n     {\n\n\n###\n\n", "completion": "build(devtools): migrate to manifest v3 (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/property-binding-best-practices.md | file path B: aio/content/guide/property-binding-best-practices.md\n\n@@ -1,6 +1,6 @@\n # Property binding best practices\n \n-By following a few guidelines, you can use property binding in a way that helps you minimize bugs and keep your code readable.\n+By following a few guidelines, you can use property binding in a way that helps you reduce bugs and keep your code readable.\n \n <div class=\"alert is-helpful\">\n \n@@ -25,8 +25,12 @@ As a best practice, use only properties and methods that return values.\n \n ## Return the proper type\n \n-A template expression should evaluate to the type of value that the target property expects.\n-For example, return a string if the target property expects a string, a number if it expects a number, or an object if it expects an object.\n+A template expression should result in the type of value that the target property expects.\n+For example, return:\n+\n+*   a `string`, if the target property expects a string\n+*   a `number`, if it expects a number\n+*   an `object`, if it expects an object.\n \n ### Passing in a string\n \n@@ -54,7 +58,7 @@ In the `ItemListComponent` the `@Input()`, `items`, has a type of `Item[]`.\n \n <code-example header=\"src/app/item-list.component.ts\" path=\"property-binding/src/app/item-list/item-list.component.ts\" region=\"item-input\"></code-example>\n \n-Notice that `Item` is an object that it has two properties; an `id` and a `name`.\n+Notice that `Item` is an object that it has two properties, an `id` and a `name`.\n \n <code-example header=\"src/app/item.ts\" path=\"property-binding/src/app/item.ts\" region=\"item-class\"></code-example>\n \n@@ -62,7 +66,7 @@ In `app.component.ts`, `currentItems` is an array of objects in the same shape a\n \n <code-example header=\"src/app.component.ts\" path=\"property-binding/src/app/app.component.ts\" region=\"pass-object\"></code-example>\n \n-By supplying an object in the same shape, you satisfy the expectations of `items` when Angular evaluates the expression `currentItems`.\n+By supplying an object in the same shape, you meet the expectations of `items` when Angular evaluates the expression `currentItems`.\n \n <!-- links -->\n \n\n\n###\n\n", "completion": "docs: fix linter errors for property-binding-best-practices.md (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/property-binding.md | file path B: aio/content/guide/property-binding.md\n\n@@ -1,6 +1,6 @@\n # Property binding\n \n-Property binding in Angular helps you set values for properties of HTML elements or directives.  Use property binding to do things such as toggle button functionality, set paths programmatically, and share values between components.\n+Property binding in Angular helps you set values for properties of HTML elements or directives. Use property binding to do things such as toggle button features, set paths programmatically, and share values between components.\n \n <div class=\"alert is-helpful\">\n \n@@ -40,8 +40,12 @@ In most cases, the target name is the name of a property, even when it appears t\n \n In this example, `src` is the name of the `<img>` element property.\n \n+<!-- vale Angular.Google_WordListSuggestions = NO -->\n+\n The brackets, `[]`, cause Angular to evaluate the right-hand side of the assignment as a dynamic expression.\n \n+<!-- vale Angular.Google_WordListSuggestions = NO -->\n+\n Without the brackets, Angular treats the right-hand side as a string literal and sets the property to that static value.\n \n To assign a string to a property, type the following code:\n@@ -52,7 +56,7 @@ Omitting the brackets renders the string `parentItem`, not the value of `parentI\n \n ## Setting an element property to a component property value\n \n-To bind the `src` property of an `<img>` element to a component's property, place the target, `src`, in square brackets followed by an equal sign and then the property.\n+To bind the `src` property of an `<img>` element to a component's property, place `src` in square brackets followed by an equal sign and then the property.\n \n Using the property `itemImageUrl`, type the following code:\n \n@@ -72,7 +76,7 @@ To use property binding using `colSpan`, type the following:\n \n <code-example path=\"attribute-binding/src/app/app.component.html\" region=\"colSpan\" header=\"src/app/app.component.html\"></code-example>\n \n-To disable a button when the component says that it `isUnchanged`, type the following:\n+To disable a button while the component's `isUnchanged` property is `true`, type the following:\n \n <code-example path=\"property-binding/src/app/app.component.html\" region=\"disabled-button\" header=\"src/app/app.component.html\"></code-example>\n \n@@ -84,10 +88,13 @@ To set the model property of a custom component for parent and child components\n \n <code-example path=\"property-binding/src/app/app.component.html\" region=\"model-property-binding\" header=\"src/app/app.component.html\"></code-example>\n \n+## Toggling button features\n+\n+<!-- vale Angular.Google_WordListSuggestions = NO -->\n \n-## Toggling button functionality\n+To use a Boolean value to disable a button's features, bind the `disabled` DOM attribute to a Boolean property in the class.\n \n-To disable a button's functionality depending on a Boolean value, bind the DOM `disabled` property to a property in the class that is `true` or `false`.\n+<!-- vale Angular.Google_WordListSuggestions = YES -->\n \n <code-example path=\"property-binding/src/app/app.component.html\" region=\"disabled-button\" header=\"src/app/app.component.html\"></code-example>\n \n\n\n###\n\n", "completion": "docs: fix linter errors for property-binding.md (#<issue-num>)"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -92,7 +92,7 @@ executors:\n         type: string\n         default: medium\n     docker:\n-      - image: cimg/node:16.10.0\n+      - image: cimg/node:16.13.0\n     resource_class: << parameters.resource_class >>\n     working_directory: ~/ng\n \n@@ -102,7 +102,7 @@ executors:\n         type: string\n         default: medium\n     docker:\n-      - image: cimg/node:16.10.0-browsers\n+      - image: cimg/node:16.13.0-browsers\n     resource_class: << parameters.resource_class >>\n     working_directory: ~/ng\n \n\n---\n file path A: .nvmrc | file path B: .nvmrc\n\n@@ -1 +1 @@\n-16.10.0\n+16.13.0\n\n---\n file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -56,7 +56,7 @@ load(\"@rules_nodejs//nodejs:repositories.bzl\", \"nodejs_register_toolchains\")\n \n nodejs_register_toolchains(\n     name = \"nodejs\",\n-    node_version = \"16.10.0\",\n+    node_version = \"16.13.0\",\n )\n \n # Download npm dependencies.\n\n---\n file path A: package.json | file path B: package.json\n\n@@ -8,7 +8,7 @@\n   \"license\": \"MIT\",\n   \"//engines-comment\": \"Keep this in sync with /aio/package.json and /aio/tools/examples/shared/package.json\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\",\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\",\n     \"yarn\": \">=1.22.4 <2\",\n     \"npm\": \"Please use yarn instead of NPM to install dependencies\"\n   },\n\n---\n file path A: packages/animations/package.json | file path B: packages/animations/package.json\n\n@@ -5,7 +5,7 @@\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\"\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"dependencies\": {\n     \"tslib\": \"^2.3.0\"\n\n---\n file path A: packages/bazel/package.json | file path B: packages/bazel/package.json\n\n@@ -5,7 +5,7 @@\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\"\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"bin\": {\n     \"ngc-wrapped\": \"./src/ngc-wrapped/index.js\",\n\n---\n file path A: packages/common/package.json | file path B: packages/common/package.json\n\n@@ -5,7 +5,7 @@\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\"\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"locales\": \"locales\",\n   \"dependencies\": {\n@@ -35,4 +35,4 @@\n     \"**/global/*.js\",\n     \"**/closure-locale.*\"\n   ]\n-}\n\\ No newline at end of file\n+}\n\n---\n file path A: packages/compiler-cli/package.json | file path B: packages/compiler-cli/package.json\n\n@@ -79,7 +79,7 @@\n   ],\n   \"license\": \"MIT\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\"\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"bugs\": {\n     \"url\": \"https://github.com/angular/angular/issues\"\n\n---\n file path A: packages/compiler/package.json | file path B: packages/compiler/package.json\n\n@@ -5,7 +5,7 @@\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\"\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"dependencies\": {\n     \"tslib\": \"^2.3.0\"\n\n---\n file path A: packages/core/package.json | file path B: packages/core/package.json\n\n@@ -5,7 +5,7 @@\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\"\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"exports\": {\n     \"./schematics/*\": {\n@@ -29,4 +29,4 @@\n     \"packageGroup\": \"NG_UPDATE_PACKAGE_GROUP\"\n   },\n   \"sideEffects\": false\n-}\n\\ No newline at end of file\n+}\n\n---\n file path A: packages/elements/package.json | file path B: packages/elements/package.json\n\n@@ -5,7 +5,7 @@\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\"\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"dependencies\": {\n     \"tslib\": \"^2.3.0\"\n\n---\n file path A: packages/forms/package.json | file path B: packages/forms/package.json\n\n@@ -5,7 +5,7 @@\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\"\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"dependencies\": {\n     \"tslib\": \"^2.3.0\"\n@@ -25,4 +25,4 @@\n     \"packageGroup\": \"NG_UPDATE_PACKAGE_GROUP\"\n   },\n   \"sideEffects\": false\n-}\n\\ No newline at end of file\n+}\n\n---\n file path A: packages/language-service/package.json | file path B: packages/language-service/package.json\n\n@@ -7,7 +7,7 @@\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\"\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"repository\": {\n     \"type\": \"git\",\n\n---\n file path A: packages/localize/package.json | file path B: packages/localize/package.json\n\n@@ -16,7 +16,7 @@\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\"\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"repository\": {\n     \"type\": \"git\",\n\n---\n file path A: packages/platform-browser-dynamic/package.json | file path B: packages/platform-browser-dynamic/package.json\n\n@@ -5,7 +5,7 @@\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\"\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"dependencies\": {\n     \"tslib\": \"^2.3.0\"\n\n---\n file path A: packages/platform-browser/package.json | file path B: packages/platform-browser/package.json\n\n@@ -5,7 +5,7 @@\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\"\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"dependencies\": {\n     \"tslib\": \"^2.3.0\"\n\n---\n file path A: packages/platform-server/package.json | file path B: packages/platform-server/package.json\n\n@@ -5,7 +5,7 @@\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\"\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"peerDependencies\": {\n     \"@angular/animations\": \"0.0.0-PLACEHOLDER\",\n\n---\n file path A: packages/router/package.json | file path B: packages/router/package.json\n\n@@ -14,7 +14,7 @@\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\"\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"bugs\": {\n     \"url\": \"https://github.com/angular/angular/issues\"\n\n---\n file path A: packages/service-worker/package.json | file path B: packages/service-worker/package.json\n\n@@ -5,7 +5,7 @@\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\"\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"exports\": {\n     \"./ngsw-worker.js\": {\n\n---\n file path A: packages/upgrade/package.json | file path B: packages/upgrade/package.json\n\n@@ -5,7 +5,7 @@\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"engines\": {\n-    \"node\": \"^14.15.0 || >=16.10.0\"\n+    \"node\": \"^14.20.0 || ^16.13.0 || >=18.10.0\"\n   },\n   \"dependencies\": {\n     \"tslib\": \"^2.3.0\"\n\n\n###\n\n", "completion": "feat(core): add support for Node.js version 18 (#<issue-num>)"}
{"prompt": " file path A: packages/zone.js/lib/zone.ts | file path B: packages/zone.js/lib/zone.ts\n\n@@ -956,6 +956,11 @@ const Zone: ZoneType = (function(global: any) {\n         throw new Error(\n             'A task can only be cancelled in the zone of creation! (Creation: ' +\n             (task.zone || NO_ZONE).name + '; Execution: ' + this.name + ')');\n+\n+      if (task.state !== scheduled && task.state !== running) {\n+        return;\n+      }\n+\n       (task as ZoneTask<any>)._transitionTo(canceling, scheduled, running);\n       try {\n         this._zoneDelegate.cancelTask(this, task);\n\n---\n file path A: packages/zone.js/test/common/task.spec.ts | file path B: packages/zone.js/test/common/task.spec.ts\n\n@@ -907,6 +907,28 @@ describe('task lifecycle', () => {\n        }));\n   });\n \n+  // Test specific to https://github.com/angular/angular/issues/45711\n+  it('should not throw an error when the task has been canceled previously and is attemped to be canceled again',\n+     () => {\n+       testFnWithLoggedTransitionTo(() => {\n+         Zone.current.fork({name: 'testCancelZone'}).run(() => {\n+           const task =\n+               Zone.current.scheduleEventTask('testEventTask', noop, undefined, noop, noop);\n+           Zone.current.cancelTask(task);\n+           Zone.current.cancelTask(task);\n+         });\n+         expect(log.map(item => {\n+           return {toState: item.toState, fromState: item.fromState};\n+         }))\n+             .toEqual([\n+               {toState: 'scheduling', fromState: 'notScheduled'},\n+               {toState: 'scheduled', fromState: 'scheduling'},\n+               {toState: 'canceling', fromState: 'scheduled'},\n+               {toState: 'notScheduled', fromState: 'canceling'}\n+             ]);\n+       });\n+     });\n+\n   describe('reschedule zone', () => {\n     let callbackLogs: ({pos: string, method: string, zone: string, task: string}|HasTaskState)[];\n     const newZone = Zone.root.fork({\n\n\n###\n\n", "completion": "fix(zone.js): cancel tasks only when they are scheduled or running (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/prerendering.md | file path B: aio/content/guide/prerendering.md\n\n@@ -5,7 +5,7 @@ Prerendering is the process where a dynamic page is processed at build time gene\n \n ## How to prerender a page\n \n-To prerender a static page make sure to add SSR capabilities to your application.\n+To prerender a static page make sure to add Server-Side Rendering (SSR) capabilities to your application.\n For more information see the [universal guide](guide/universal).\n Once SSR is added, run the following command:\n \n@@ -23,8 +23,8 @@ When you add prerendering to your application, the following build options are a\n |:---             |:---     |\n | `browserTarget` | Specify the target to build.                                                                                                                       |\n | `serverTarget`  | Specify the Server target to use for prerendering the application.                                                                                 |\n-| `routes`        | Define an array of additional routes to prerender.                                                                                                 |\n-| `guessRoutes`   | Whether builder should extract routes and guess which paths to render.Defaults to `true`.                                                          |\n+| `routes`        | Define an array of extra routes to prerender.                                                                                                 |\n+| `guessRoutes`   | Whether builder should extract routes and guess which paths to render. Defaults to `true`.                                                          |\n | `routesFile`    | Specify a file that contains a list of all routes to prerender, separated by newlines. This option is useful if you have a large number of routes. |\n | `numProcesses`  | Specify the number of CPUs to be used while running the prerendering command.                                                                      |\n \n@@ -35,13 +35,13 @@ An example of a dynamic route is `product/:id`, where `id` is dynamically provid\n \n To prerender dynamic routes, choose one from the following options:\n \n-*   Provide additional routes in the command line\n+*   Provide extra routes in the command line\n *   Provide routes using a file\n *   Prerender specific routes\n \n-#### Provide additional routes in the command line\n+#### Provide extra routes in the command line\n \n-While running the prerender command, you can provide additional routes.\n+While running the prerender command, you can provide extra routes.\n For example:\n \n <code-example format=\"shell\" language=\"shell\">\n@@ -50,14 +50,14 @@ ng run &lt;app-name&gt;:prerender --routes /product/1 /product/2\n \n </code-example>\n \n-#### Providing additional routes using a file\n+#### Providing extra routes using a file\n \n-You can provide routes using a file to generate static pages.\n-This method is useful if you have a large number of routes to generate, such as product details for an e-commerce application, which might come from an external source \\(Database or CMS\\).\n+You can provide routes using a file to create static pages.\n+This method is useful if you have a large number of routes to create. For example, product details for an e-commerce application, which might come from an external source, like a Database or Content Management System (CMS).\n \n To provide routes using a file, use the `--routes-file` option with the name of a `.txt` file containing the routes.\n \n-For example, you could generate this file by using a script to extract IDs from a database and save them to a `routes.txt` file:\n+For example, you could create this file by using a script to extract IDs from a database and save them to a `routes.txt` file:\n \n <code-example language=\"none\" header=\"routes.txt\">\n \n@@ -77,7 +77,7 @@ ng run &lt;app-name&gt;:prerender --routes-file routes.txt\n #### Prerendering specific routes\n \n You can also pass specific routes to the prerender command.\n-If you choose this option, make sure to disable the `guessRoutes` option.\n+If you choose this option, make sure to turn off the `guessRoutes` option.\n \n <code-example format=\"shell\" language=\"shell\">\n \n\n\n###\n\n", "completion": "docs: fix linter errors in prerendering.md (#<issue-num>)"}
{"prompt": " file path A: README.md | file path B: README.md\n\n@@ -115,11 +115,11 @@ Check out our [upgrade guide](https://update.angular.io/) to find out the best w\n \n ### Contributing Guidelines\n \n-Read through our [contributing guidelines][contributing] to learn about our submission process, coding rules and more.\n+Read through our [contributing guidelines][contributing] to learn about our submission process, coding rules, and more.\n \n ### Want to Help?\n \n-Want to report a bug, contribute some code, or improve documentation? Excellent! Read up on our guidelines for [contributing][contributing] and then check out one of our issues labeled as <kbd>[help wanted](https://github.com/angular/angular/labels/help%20wanted)</kbd> or <kbd>[good first issue](https://github.com/angular/angular/labels/good%20first%20issue)</kbd>.\n+Want to report a bug, contribute some code, or improve the documentation? Excellent! Read up on our guidelines for [contributing][contributing] and then check out one of our issues labeled as <kbd>[help wanted](https://github.com/angular/angular/labels/help%20wanted)</kbd> or <kbd>[good first issue](https://github.com/angular/angular/labels/good%20first%20issue)</kbd>.\n \n ### Code of Conduct\n \n\n\n###\n\n", "completion": "docs(core): Improved README.md (#<issue-num>)"}
{"prompt": " file path A: aio/content/errors/NG1003.md | file path B: aio/content/errors/NG01003.md\n\n@@ -1,5 +1,5 @@\n @name Wrong Async Validator Return Type\n-@category forms\n+@category runtime\n @shortDescription Async validator must return a Promise or Observable\n \n @description\n\n---\n file path A: aio/content/errors/NG2200.md | file path B: aio/content/errors/NG02200.md\n\n\n\n###\n\n", "completion": "docs: add 0 to filename of runtime error guides (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/scorecard.yml | file path B: .github/workflows/scorecard.yml\n\n@@ -18,6 +18,8 @@ jobs:\n     permissions:\n       # Needed to upload the results to code-scanning dashboard.\n       security-events: write\n+      # Needed to publish results\n+      id-token: write\n       actions: read\n       contents: read\n \n\n\n###\n\n", "completion": "ci: adjust workflow permissions for OpenSSF Scorecard results publishing (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/scorecard.yml | file path B: .github/workflows/scorecard.yml\n\n@@ -23,12 +23,12 @@ jobs:\n \n     steps:\n       - name: 'Checkout code'\n-        uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3.0.2\n+        uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0\n         with:\n           persist-credentials: false\n \n       - name: 'Run analysis'\n-        uses: ossf/scorecard-action@ce330fde6b1a5c9c75b417e7efc510b822a35564 # tag=v1.1.2\n+        uses: ossf/scorecard-action@e363bfca00e752f91de7b7d2a77340e2e523cb18 # tag=v2.0.4\n         with:\n           results_file: results.sarif\n           results_format: sarif\n@@ -45,6 +45,6 @@ jobs:\n \n       # Upload the results to GitHub's code scanning dashboard.\n       - name: 'Upload to code-scanning'\n-        uses: github/codeql-action/upload-sarif@b398f525a5587552e573b247ac661067fafa920b # tag=v2.1.22\n+        uses: github/codeql-action/upload-sarif@807578363a7869ca324a79039e6db9c843e0e100 # tag=v2.1.27\n         with:\n           sarif_file: results.sarif\n\n\n###\n\n", "completion": "build: update scorecard action dependencies (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -19,7 +19,7 @@\n     \"build-local\": \"yarn ~~build\",\n     \"prebuild-local-ci\": \"yarn setup-local-ci\",\n     \"build-local-ci\": \"yarn ~~build --progress=false\",\n-    \"extract-cli-command-docs\": \"node tools/transforms/cli-docs-package/extract-cli-commands.js 77c70052e\",\n+    \"extract-cli-command-docs\": \"node tools/transforms/cli-docs-package/extract-cli-commands.js 46cb32b90\",\n     \"lint\": \"yarn check-env && yarn docs-lint && ng lint && yarn example-lint && yarn tools-lint && yarn security-lint\",\n     \"test\": \"yarn check-env && ng test\",\n     \"test:bazel\": \"bazelisk test //aio:test\",\n\n\n###\n\n", "completion": "build(docs-infra): upgrade cli command docs sources to 46cb32b90 (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/forms/index.md | file path B: goldens/public-api/forms/index.md\n\n@@ -559,6 +559,18 @@ export class FormsModule {\n     static \u0275mod: i0.\u0275\u0275NgModuleDeclaration<FormsModule, [typeof i1_2.NgModel, typeof i2_2.NgModelGroup, typeof i3_2.NgForm], never, [typeof i4_2.\u0275InternalFormsSharedModule, typeof i1_2.NgModel, typeof i2_2.NgModelGroup, typeof i3_2.NgForm]>;\n }\n \n+// @public\n+export const isFormArray: (control: unknown) => control is FormArray<any>;\n+\n+// @public\n+export const isFormControl: (control: unknown) => control is FormControl<any>;\n+\n+// @public\n+export const isFormGroup: (control: unknown) => control is FormGroup<any>;\n+\n+// @public\n+export const isFormRecord: (control: unknown) => control is FormRecord<AbstractControl<any, any>>;\n+\n // @public\n export class MaxLengthValidator extends AbstractValidatorDirective {\n     maxlength: string | number | null;\n\n---\n file path A: packages/forms/src/forms.ts | file path B: packages/forms/src/forms.ts\n\n@@ -43,9 +43,9 @@ export {SelectMultipleControlValueAccessor, \u0275NgSelectMultipleOption} from './di\n export {AsyncValidator, AsyncValidatorFn, CheckboxRequiredValidator, EmailValidator, MaxLengthValidator, MaxValidator, MinLengthValidator, MinValidator, PatternValidator, RequiredValidator, ValidationErrors, Validator, ValidatorFn} from './directives/validators';\n export {ControlConfig, FormBuilder, NonNullableFormBuilder, UntypedFormBuilder, \u0275Element} from './form_builder';\n export {AbstractControl, AbstractControlOptions, FormControlStatus, \u0275CoerceStrArrToNumArr, \u0275GetProperty, \u0275Navigate, \u0275RawValue, \u0275Tokenize, \u0275TypedOrUntyped, \u0275Value, \u0275Writeable} from './model/abstract_model';\n-export {FormArray, UntypedFormArray, \u0275FormArrayRawValue, \u0275FormArrayValue} from './model/form_array';\n-export {FormControl, FormControlOptions, FormControlState, UntypedFormControl, \u0275FormControlCtor} from './model/form_control';\n-export {FormGroup, FormRecord, UntypedFormGroup, \u0275FormGroupRawValue, \u0275FormGroupValue, \u0275OptionalKeys} from './model/form_group';\n+export {FormArray, isFormArray, UntypedFormArray, \u0275FormArrayRawValue, \u0275FormArrayValue} from './model/form_array';\n+export {FormControl, FormControlOptions, FormControlState, isFormControl, UntypedFormControl, \u0275FormControlCtor} from './model/form_control';\n+export {FormGroup, FormRecord, isFormGroup, isFormRecord, UntypedFormGroup, \u0275FormGroupRawValue, \u0275FormGroupValue, \u0275OptionalKeys} from './model/form_group';\n export {NG_ASYNC_VALIDATORS, NG_VALIDATORS, Validators} from './validators';\n export {VERSION} from './version';\n \n\n---\n file path A: packages/forms/src/model/form_array.ts | file path B: packages/forms/src/model/form_array.ts\n\n@@ -530,4 +530,10 @@ export type UntypedFormArray = FormArray<any>;\n \n export const UntypedFormArray: UntypedFormArrayCtor = FormArray;\n \n+/**\n+ * @description\n+ * Asserts that the given control is an instance of `FormArray`\n+ *\n+ * @publicApi\n+ */\n export const isFormArray = (control: unknown): control is FormArray => control instanceof FormArray;\n\n---\n file path A: packages/forms/src/model/form_control.ts | file path B: packages/forms/src/model/form_control.ts\n\n@@ -561,5 +561,11 @@ export type UntypedFormControl = FormControl<any>;\n \n export const UntypedFormControl: UntypedFormControlCtor = FormControl;\n \n+/**\n+ * @description\n+ * Asserts that the given control is an instance of `FormControl`\n+ *\n+ * @publicApi\n+ */\n export const isFormControl = (control: unknown): control is FormControl =>\n     control instanceof FormControl;\n\n---\n file path A: packages/forms/src/model/form_group.ts | file path B: packages/forms/src/model/form_group.ts\n\n@@ -604,6 +604,12 @@ export type UntypedFormGroup = FormGroup<any>;\n \n export const UntypedFormGroup: UntypedFormGroupCtor = FormGroup;\n \n+/**\n+ * @description\n+ * Asserts that the given control is an instance of `FormGroup`\n+ *\n+ * @publicApi\n+ */\n export const isFormGroup = (control: unknown): control is FormGroup => control instanceof FormGroup;\n \n /**\n@@ -706,5 +712,11 @@ export interface FormRecord<TControl> {\n   getRawValue(): {[key: string]: \u0275RawValue<TControl>};\n }\n \n+/**\n+ * @description\n+ * Asserts that the given control is an instance of `FormRecord`\n+ *\n+ * @publicApi\n+ */\n export const isFormRecord = (control: unknown): control is FormRecord =>\n     control instanceof FormRecord;\n\n\n###\n\n", "completion": "feat(forms): export forms utility functions: isFormArray, isFormGroup\u2026 (#<issue-num>)"}
{"prompt": " file path A: package.json | file path B: package.json\n\n@@ -128,7 +128,7 @@\n     \"diff\": \"^5.0.0\",\n     \"document-register-element\": \"^1.7.2\",\n     \"domino\": \"~2.1.6\",\n-    \"google-closure-compiler\": \"20220905.0.0\",\n+    \"google-closure-compiler\": \"20221004.0.0\",\n     \"graceful-fs\": \"4.2.10\",\n     \"hammerjs\": \"~2.0.8\",\n     \"http-server\": \"^14.0.0\",\n\n---\n file path A: packages/zone.js/package.json | file path B: packages/zone.js/package.json\n\n@@ -14,7 +14,7 @@\n     \"@externs/nodejs\": \"^1.5.0\",\n     \"@types/node\": \"^10.9.4\",\n     \"domino\": \"2.1.6\",\n-    \"google-closure-compiler\": \"^20220905.0.0\",\n+    \"google-closure-compiler\": \"^20221004.0.0\",\n     \"jest\": \"^29.0\",\n     \"jest-environment-jsdom\": \"^29.0.3\",\n     \"jest-environment-node\": \"^29.0.3\",\n\n---\n file path A: packages/zone.js/yarn.lock | file path B: packages/zone.js/yarn.lock\n\n@@ -1689,40 +1689,40 @@ globals@^11.1.0:\n   resolved \"https://registry.yarnpkg.com/globals/-/globals-11.12.0.tgz#ab8795338868a0babd8525758018c2a7eb95c42e\"\n   integrity sha512-WOBp/EEGUiIsJSp7wcv/y6MO+lV9UoncWqxuFfm8eBwzWNgyfBd6Gz+IeKQ9jCmyhoH99g15M3T+QaVHFjizVA==\n \n-google-closure-compiler-java@^20220905.0.0:\n-  version \"20220905.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-java/-/google-closure-compiler-java-20220905.0.0.tgz#53d4b081c63fac09b6589729f5f359c8ec3ce27e\"\n-  integrity sha512-wxGxNla/0UDS1Lm0cRxEy85KhVRd0vNlsTclnIJ9f1gRWzvvTsJ4lwz+PdT60R6y2hKAOBvydIJHh+B8XJastA==\n-\n-google-closure-compiler-linux@^20220905.0.0:\n-  version \"20220905.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-linux/-/google-closure-compiler-linux-20220905.0.0.tgz#4cefd19938b522c1ac9b8254a44ecfffcb3354d8\"\n-  integrity sha512-kH09S66sz9+6wZmYM22VX8vG8KhCKJwFwXCfHx/ZOU6DBEzni6KfWrP+87CzTmZFEivclBhWAndm5HgNhSOEXQ==\n-\n-google-closure-compiler-osx@^20220905.0.0:\n-  version \"20220905.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-osx/-/google-closure-compiler-osx-20220905.0.0.tgz#0e685fb886db298af88b96ba683a04601f8c168b\"\n-  integrity sha512-4uo2GAz77gI8nDt4OA8VUYh/FNdjmTLOIRDazl7si+BOjgp9bC6C3E/88o+YHETsVtrPmZk57/W7vH0lftyTAw==\n-\n-google-closure-compiler-windows@^20220905.0.0:\n-  version \"20220905.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-windows/-/google-closure-compiler-windows-20220905.0.0.tgz#89b8767c4b6d95b4e8d13cc01bc6e4acdc5700dd\"\n-  integrity sha512-TZKHu6RHnrmgV90Gyen8+TGc0vgjgds80ErR+al5CqmfP9p+AskBbOe5CWZJht0bANrUhaeBMCrbs+7loFv06Q==\n-\n-google-closure-compiler@^20220905.0.0:\n-  version \"20220905.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler/-/google-closure-compiler-20220905.0.0.tgz#3e31cc164cea63789c04fca67f89661efec749de\"\n-  integrity sha512-idZavy2vn91HCmqEepjmLFjfOdYoRsh9PggUbazUpjAOrBQz0HOm3WjOICMiywre+EnY1QGss0srEBtFtukM6w==\n+google-closure-compiler-java@^20221004.0.0:\n+  version \"20221004.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-java/-/google-closure-compiler-java-20221004.0.0.tgz#ba1049987bd91ebdcc2aebe184bf839bcaa0017e\"\n+  integrity sha512-CygLEB40HxtK0VtP6klv2Xm08w4HQNYX/DTgLV7CP74r8LiQMUByRFleaG/Hv5xQG1JzPNiW0GOAiAubDSdr5A==\n+\n+google-closure-compiler-linux@^20221004.0.0:\n+  version \"20221004.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-linux/-/google-closure-compiler-linux-20221004.0.0.tgz#6fe30f5e970d5a8de9efe9ac3a5d65b60c2c1dc8\"\n+  integrity sha512-B6sca3Lmw3cYXdFzdU0iQpk8L9VEo1ecC1aM7Gl9lgWhIicqqEZebsgnUe5TQ3uHBfQoKjV9fdFG8mt8X/oqSQ==\n+\n+google-closure-compiler-osx@^20221004.0.0:\n+  version \"20221004.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-osx/-/google-closure-compiler-osx-20221004.0.0.tgz#3efdcd226f5dbb2dedab40a3436f2a1b59709dc5\"\n+  integrity sha512-z5V7BvaMauPga8DMTt9u6RGcjBdLAuv4gL2Ebw5NIQRTAHVkEVzCd3kiMX7CVCGhmWdS/1r3jZcCg4BswGia6w==\n+\n+google-closure-compiler-windows@^20221004.0.0:\n+  version \"20221004.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-windows/-/google-closure-compiler-windows-20221004.0.0.tgz#ee61f329b906993a7e2fa419690d93de437bd21a\"\n+  integrity sha512-JSAWilVa7d65QJYKUr+DmklwKmjkAce6BMD6smqJfdL2dv5OSJ2ydGy73euoBJ4Tka8iQPoaOP+BjLrhIuvqKg==\n+\n+google-closure-compiler@^20221004.0.0:\n+  version \"20221004.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler/-/google-closure-compiler-20221004.0.0.tgz#18d255ada6562ddd0332e1e25921bcffc12eaf28\"\n+  integrity sha512-OKENLrZFF2o3FZ/E4zdTc9NeuAUh1fdwbQxT0sibI19aR62sgNUBo2mLU6sc4Gcm0cQ2gwfB7qX1xnapOIkbaA==\n   dependencies:\n     chalk \"4.x\"\n-    google-closure-compiler-java \"^20220905.0.0\"\n+    google-closure-compiler-java \"^20221004.0.0\"\n     minimist \"1.x\"\n     vinyl \"2.x\"\n     vinyl-sourcemaps-apply \"^0.2.0\"\n   optionalDependencies:\n-    google-closure-compiler-linux \"^20220905.0.0\"\n-    google-closure-compiler-osx \"^20220905.0.0\"\n-    google-closure-compiler-windows \"^20220905.0.0\"\n+    google-closure-compiler-linux \"^20221004.0.0\"\n+    google-closure-compiler-osx \"^20221004.0.0\"\n+    google-closure-compiler-windows \"^20221004.0.0\"\n \n graceful-fs@^4.2.9:\n   version \"4.2.10\"\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -8838,40 +8838,40 @@ google-auth-library@^8.0.2:\n     jws \"^4.0.0\"\n     lru-cache \"^6.0.0\"\n \n-google-closure-compiler-java@^20220905.0.0:\n-  version \"20220905.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-java/-/google-closure-compiler-java-20220905.0.0.tgz#53d4b081c63fac09b6589729f5f359c8ec3ce27e\"\n-  integrity sha512-wxGxNla/0UDS1Lm0cRxEy85KhVRd0vNlsTclnIJ9f1gRWzvvTsJ4lwz+PdT60R6y2hKAOBvydIJHh+B8XJastA==\n-\n-google-closure-compiler-linux@^20220905.0.0:\n-  version \"20220905.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-linux/-/google-closure-compiler-linux-20220905.0.0.tgz#4cefd19938b522c1ac9b8254a44ecfffcb3354d8\"\n-  integrity sha512-kH09S66sz9+6wZmYM22VX8vG8KhCKJwFwXCfHx/ZOU6DBEzni6KfWrP+87CzTmZFEivclBhWAndm5HgNhSOEXQ==\n-\n-google-closure-compiler-osx@^20220905.0.0:\n-  version \"20220905.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-osx/-/google-closure-compiler-osx-20220905.0.0.tgz#0e685fb886db298af88b96ba683a04601f8c168b\"\n-  integrity sha512-4uo2GAz77gI8nDt4OA8VUYh/FNdjmTLOIRDazl7si+BOjgp9bC6C3E/88o+YHETsVtrPmZk57/W7vH0lftyTAw==\n-\n-google-closure-compiler-windows@^20220905.0.0:\n-  version \"20220905.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-windows/-/google-closure-compiler-windows-20220905.0.0.tgz#89b8767c4b6d95b4e8d13cc01bc6e4acdc5700dd\"\n-  integrity sha512-TZKHu6RHnrmgV90Gyen8+TGc0vgjgds80ErR+al5CqmfP9p+AskBbOe5CWZJht0bANrUhaeBMCrbs+7loFv06Q==\n-\n-google-closure-compiler@20220905.0.0:\n-  version \"20220905.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler/-/google-closure-compiler-20220905.0.0.tgz#3e31cc164cea63789c04fca67f89661efec749de\"\n-  integrity sha512-idZavy2vn91HCmqEepjmLFjfOdYoRsh9PggUbazUpjAOrBQz0HOm3WjOICMiywre+EnY1QGss0srEBtFtukM6w==\n+google-closure-compiler-java@^20221004.0.0:\n+  version \"20221004.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-java/-/google-closure-compiler-java-20221004.0.0.tgz#ba1049987bd91ebdcc2aebe184bf839bcaa0017e\"\n+  integrity sha512-CygLEB40HxtK0VtP6klv2Xm08w4HQNYX/DTgLV7CP74r8LiQMUByRFleaG/Hv5xQG1JzPNiW0GOAiAubDSdr5A==\n+\n+google-closure-compiler-linux@^20221004.0.0:\n+  version \"20221004.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-linux/-/google-closure-compiler-linux-20221004.0.0.tgz#6fe30f5e970d5a8de9efe9ac3a5d65b60c2c1dc8\"\n+  integrity sha512-B6sca3Lmw3cYXdFzdU0iQpk8L9VEo1ecC1aM7Gl9lgWhIicqqEZebsgnUe5TQ3uHBfQoKjV9fdFG8mt8X/oqSQ==\n+\n+google-closure-compiler-osx@^20221004.0.0:\n+  version \"20221004.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-osx/-/google-closure-compiler-osx-20221004.0.0.tgz#3efdcd226f5dbb2dedab40a3436f2a1b59709dc5\"\n+  integrity sha512-z5V7BvaMauPga8DMTt9u6RGcjBdLAuv4gL2Ebw5NIQRTAHVkEVzCd3kiMX7CVCGhmWdS/1r3jZcCg4BswGia6w==\n+\n+google-closure-compiler-windows@^20221004.0.0:\n+  version \"20221004.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-windows/-/google-closure-compiler-windows-20221004.0.0.tgz#ee61f329b906993a7e2fa419690d93de437bd21a\"\n+  integrity sha512-JSAWilVa7d65QJYKUr+DmklwKmjkAce6BMD6smqJfdL2dv5OSJ2ydGy73euoBJ4Tka8iQPoaOP+BjLrhIuvqKg==\n+\n+google-closure-compiler@20221004.0.0:\n+  version \"20221004.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler/-/google-closure-compiler-20221004.0.0.tgz#18d255ada6562ddd0332e1e25921bcffc12eaf28\"\n+  integrity sha512-OKENLrZFF2o3FZ/E4zdTc9NeuAUh1fdwbQxT0sibI19aR62sgNUBo2mLU6sc4Gcm0cQ2gwfB7qX1xnapOIkbaA==\n   dependencies:\n     chalk \"4.x\"\n-    google-closure-compiler-java \"^20220905.0.0\"\n+    google-closure-compiler-java \"^20221004.0.0\"\n     minimist \"1.x\"\n     vinyl \"2.x\"\n     vinyl-sourcemaps-apply \"^0.2.0\"\n   optionalDependencies:\n-    google-closure-compiler-linux \"^20220905.0.0\"\n-    google-closure-compiler-osx \"^20220905.0.0\"\n-    google-closure-compiler-windows \"^20220905.0.0\"\n+    google-closure-compiler-linux \"^20221004.0.0\"\n+    google-closure-compiler-osx \"^20221004.0.0\"\n+    google-closure-compiler-windows \"^20221004.0.0\"\n \n google-gax@^3.0.1:\n   version \"3.1.3\"\n\n\n###\n\n", "completion": "build: update dependency google-closure-compiler to v20221004 (#<issue-num>)"}
{"prompt": " file path A: package.json | file path B: package.json\n\n@@ -77,7 +77,7 @@\n     \"@bazel/terser\": \"5.5.3\",\n     \"@bazel/worker\": \"5.5.3\",\n     \"@microsoft/api-extractor\": \"^7.24.2\",\n-    \"@rollup/plugin-babel\": \"^5.3.0\",\n+    \"@rollup/plugin-babel\": \"^6.0.0\",\n     \"@rollup/plugin-commonjs\": \"^22.0.0\",\n     \"@rollup/plugin-node-resolve\": \"^13.0.4\",\n     \"@schematics/angular\": \"15.0.0-next.4\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -764,7 +764,7 @@\n   dependencies:\n     \"@babel/types\" \"^7.18.9\"\n \n-\"@babel/helper-module-imports@^7.10.4\", \"@babel/helper-module-imports@^7.12.13\", \"@babel/helper-module-imports@^7.18.6\":\n+\"@babel/helper-module-imports@^7.12.13\", \"@babel/helper-module-imports@^7.18.6\":\n   version \"7.18.6\"\n   resolved \"https://registry.yarnpkg.com/@babel/helper-module-imports/-/helper-module-imports-7.18.6.tgz#1e3ebdbbd08aad1437b428c50204db13c5a3ca6e\"\n   integrity sha512-0NFvs3VkuSYbFi1x2Vd6tKrywq+z/cLeYC/RJNFrIX/30Bf5aiGYbtvGXolEktzJH8o5E5KJ3tT+nkxuuZFVlA==\n@@ -2722,13 +2722,13 @@\n   resolved \"https://registry.yarnpkg.com/@protobufjs/utf8/-/utf8-1.1.0.tgz#a777360b5b39a1a2e5106f8e858f2fd2d060c570\"\n   integrity sha512-Vvn3zZrhQZkkBE8LSuW3em98c0FwgO4nxzv6OdSxPKJIEKY2bGbHn+mhGIPerzI4twdxaP8/0+06HBpwf345Lw==\n \n-\"@rollup/plugin-babel@^5.3.0\":\n-  version \"5.3.1\"\n-  resolved \"https://registry.yarnpkg.com/@rollup/plugin-babel/-/plugin-babel-5.3.1.tgz#04bc0608f4aa4b2e4b1aebf284344d0f68fda283\"\n-  integrity sha512-WFfdLWU/xVWKeRQnKmIAQULUI7Il0gZnBIH/ZFO069wYIfPu+8zrfp/KMW0atmELoRDq8FbiP3VCss9MhCut7Q==\n+\"@rollup/plugin-babel@^6.0.0\":\n+  version \"6.0.0\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/plugin-babel/-/plugin-babel-6.0.0.tgz#7ce5b064e5d3ead3c9a1874af6594bd1df87791b\"\n+  integrity sha512-qM8YIt/2fVxw5O0wUgAeglyC+qx9mg3UtCCLoSqetmQOKipmnQ/X3I0L2sjjb6BswaYpv2tun25lHViU7JPxLQ==\n   dependencies:\n-    \"@babel/helper-module-imports\" \"^7.10.4\"\n-    \"@rollup/pluginutils\" \"^3.1.0\"\n+    \"@babel/helper-module-imports\" \"^7.18.6\"\n+    \"@rollup/pluginutils\" \"^4.2.1\"\n \n \"@rollup/plugin-commonjs@^22.0.0\":\n   version \"22.0.1\"\n@@ -2764,6 +2764,14 @@\n     estree-walker \"^1.0.1\"\n     picomatch \"^2.2.2\"\n \n+\"@rollup/pluginutils@^4.2.1\":\n+  version \"4.2.1\"\n+  resolved \"https://registry.yarnpkg.com/@rollup/pluginutils/-/pluginutils-4.2.1.tgz#e6c6c3aba0744edce3fb2074922d3776c0af2a6d\"\n+  integrity sha512-iKnFXr7NkdZAIHiIWE+BX5ULi/ucVFYWD6TbAV+rZctiRTY2PL6tsIKhoIOaoskiWAkgu+VsbXgUVDNLHf+InQ==\n+  dependencies:\n+    estree-walker \"^2.0.1\"\n+    picomatch \"^2.2.2\"\n+\n \"@rushstack/node-core-library@3.49.0\":\n   version \"3.49.0\"\n   resolved \"https://registry.yarnpkg.com/@rushstack/node-core-library/-/node-core-library-3.49.0.tgz#0324c1a5ba5e469967b70e9718d1a90750648503\"\n\n\n###\n\n", "completion": "build: update dependency @rollup/plugin-babel to v6 (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -524,7 +524,7 @@ export abstract class PreloadingStrategy {\n export const PRIMARY_OUTLET = \"primary\";\n \n // @public\n-export function provideRouter(routes: Routes, ...features: RouterFeatures[]): Provider[];\n+export function provideRouter(routes: Routes, ...features: RouterFeatures[]): EnvironmentProviders;\n \n // @public\n export function provideRoutes(routes: Routes): Provider[];\n\n---\n file path A: packages/router/src/provide_router.ts | file path B: packages/router/src/provide_router.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {LOCATION_INITIALIZED, ViewportScroller} from '@angular/common';\n-import {APP_BOOTSTRAP_LISTENER, APP_INITIALIZER, ApplicationRef, ComponentRef, ENVIRONMENT_INITIALIZER, inject, InjectFlags, InjectionToken, Injector, Provider, Type} from '@angular/core';\n+import {APP_BOOTSTRAP_LISTENER, APP_INITIALIZER, ApplicationRef, ComponentRef, ENVIRONMENT_INITIALIZER, EnvironmentProviders, inject, InjectFlags, InjectionToken, Injector, makeEnvironmentProviders, Provider, Type} from '@angular/core';\n import {of, Subject} from 'rxjs';\n import {filter, map, take} from 'rxjs/operators';\n \n@@ -59,8 +59,8 @@ const NG_DEV_MODE = typeof ngDevMode === 'undefined' || ngDevMode;\n  * @param features Optional features to configure additional router behaviors.\n  * @returns A set of providers to setup a Router.\n  */\n-export function provideRouter(routes: Routes, ...features: RouterFeatures[]): Provider[] {\n-  return [\n+export function provideRouter(routes: Routes, ...features: RouterFeatures[]): EnvironmentProviders {\n+  return makeEnvironmentProviders([\n     provideRoutes(routes), {provide: ActivatedRoute, useFactory: rootRoute, deps: [Router]},\n     {provide: APP_BOOTSTRAP_LISTENER, multi: true, useFactory: getBootstrapListener},\n     features.map(feature => feature.\u0275providers),\n@@ -68,7 +68,7 @@ export function provideRouter(routes: Routes, ...features: RouterFeatures[]): Pr\n     // how we want them to be configured. This API doesn't currently have a way to configure them\n     // and we should decide what the _best_ way to do that is rather than just sticking with the\n     // status quo of how it's done today.\n-  ];\n+  ]);\n }\n \n export function rootRoute(router: Router): ActivatedRoute {\n\n---\n file path A: packages/router/testing/src/provide_router_for_testing.ts | file path B: packages/router/testing/src/provide_router_for_testing.ts\n\n@@ -8,7 +8,7 @@\n \n import {Location, LocationStrategy} from '@angular/common';\n import {MockLocationStrategy, SpyLocation} from '@angular/common/testing';\n-import {Provider} from '@angular/core';\n+import {EnvironmentProviders, Provider} from '@angular/core';\n import {provideRouter, RouterFeatures, Routes} from '@angular/router';\n \n \n@@ -46,9 +46,9 @@ import {provideRouter, RouterFeatures, Routes} from '@angular/router';\n  * @returns A set of providers to setup Router for testing.\n  */\n export function provideRouterForTesting(\n-    routes: Routes = [], ...features: RouterFeatures[]): Provider[] {\n+    routes: Routes = [], ...features: RouterFeatures[]): (Provider|EnvironmentProviders)[] {\n   return [\n-    ...provideRouter(routes, ...features),\n+    provideRouter(routes, ...features),\n     {provide: Location, useClass: SpyLocation},\n     {provide: LocationStrategy, useClass: MockLocationStrategy},\n   ];\n\n\n###\n\n", "completion": "feat(router): prevent `provideRouter()` from usage in @Component (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/core_private_export.ts | file path B: packages/core/src/core_private_export.ts\n\n@@ -14,6 +14,7 @@ export {Console as \u0275Console} from './console';\n export {getDebugNodeR2 as \u0275getDebugNodeR2} from './debug/debug_node';\n export {convertToBitFlags as \u0275convertToBitFlags, setCurrentInjector as \u0275setCurrentInjector} from './di/injector_compatibility';\n export {getInjectableDef as \u0275getInjectableDef, \u0275\u0275InjectableDeclaration, \u0275\u0275InjectorDef} from './di/interface/defs';\n+export {InternalEnvironmentProviders as \u0275InternalEnvironmentProviders, isEnvironmentProviders as \u0275isEnvironmentProviders} from './di/interface/provider';\n export {INJECTOR_SCOPE as \u0275INJECTOR_SCOPE} from './di/scope';\n export {formatRuntimeError as \u0275formatRuntimeError, RuntimeError as \u0275RuntimeError} from './errors';\n export {CurrencyIndex as \u0275CurrencyIndex, ExtraLocaleDataIndex as \u0275ExtraLocaleDataIndex, findLocaleData as \u0275findLocaleData, getLocaleCurrencyCode as \u0275getLocaleCurrencyCode, getLocalePluralCase as \u0275getLocalePluralCase, LocaleDataIndex as \u0275LocaleDataIndex, registerLocaleData as \u0275registerLocaleData, unregisterAllLocaleData as \u0275unregisterLocaleData} from './i18n/locale_data_api';\n\n---\n file path A: packages/core/src/di/interface/provider.ts | file path B: packages/core/src/di/interface/provider.ts\n\n@@ -332,6 +332,41 @@ export interface ClassProvider extends ClassSansProvider {\n export type Provider = TypeProvider|ValueProvider|ClassProvider|ConstructorProvider|\n     ExistingProvider|FactoryProvider|any[];\n \n+/**\n+ * Encapsulated `Provider`s that are only accepted during creation of an `EnvironmentInjector` (e.g.\n+ * in an `NgModule`).\n+ *\n+ * Using this wrapper type prevents providers which are only designed to work in\n+ * application/environment injectors from being accidentally included in\n+ * `@Component.providers` and ending up in a component injector.\n+ *\n+ * This wrapper type prevents access to the `Provider`s inside.\n+ *\n+ * @see `makeEnvironmentProviders`\n+ * @see `importProvidersFrom`\n+ *\n+ * @publicApi\n+ */\n+export type EnvironmentProviders = {\n+  \u0275brand: 'EnvironmentProviders';\n+};\n+\n+export interface InternalEnvironmentProviders extends EnvironmentProviders {\n+  \u0275providers: Provider[];\n+\n+  /**\n+   * If present, indicates that the `EnvironmentProviders` were derived from NgModule providers.\n+   *\n+   * This is used to produce clearer error messages.\n+   */\n+  \u0275fromNgModule?: true;\n+}\n+\n+export function isEnvironmentProviders(value: Provider|InternalEnvironmentProviders):\n+    value is InternalEnvironmentProviders {\n+  return value && !!(value as InternalEnvironmentProviders).\u0275providers;\n+}\n+\n /**\n  * Describes a function that is used to process provider lists (such as provider\n  * overrides).\n\n---\n file path A: packages/core/src/di/provider_collection.ts | file path B: packages/core/src/di/provider_collection.ts\n\n@@ -21,9 +21,19 @@ import {resolveForwardRef} from './forward_ref';\n import {ENVIRONMENT_INITIALIZER} from './initializer_token';\n import {\u0275\u0275inject as inject} from './injector_compatibility';\n import {getInjectorDef, InjectorType, InjectorTypeWithProviders} from './interface/defs';\n-import {ClassProvider, ConstructorProvider, ExistingProvider, FactoryProvider, ImportedNgModuleProviders, ModuleWithProviders, Provider, StaticClassProvider, TypeProvider, ValueProvider} from './interface/provider';\n+import {ClassProvider, ConstructorProvider, EnvironmentProviders, ExistingProvider, FactoryProvider, ImportedNgModuleProviders, ModuleWithProviders, Provider, StaticClassProvider, TypeProvider, ValueProvider} from './interface/provider';\n import {INJECTOR_DEF_TYPES} from './internal_tokens';\n \n+/**\n+ * Wrap an array of `Provider`s into `EnvironmentProviders`, preventing them from being accidentally\n+ * referenced in `@Component in a component injector.\n+ */\n+export function makeEnvironmentProviders(providers: Provider[]): EnvironmentProviders {\n+  return {\n+    \u0275providers: providers,\n+  } as unknown as EnvironmentProviders;\n+}\n+\n /**\n  * A source of providers for the `importProvidersFrom` function.\n  *\n\n\n###\n\n", "completion": "refactor(core): define shape of EnvironmentProviders interface (#<issue-num>)"}
{"prompt": " file path A: aio/tools/doc-linter/styles/Angular/Google_WordListSuggestions.yml | file path B: aio/tools/doc-linter/styles/Angular/Google_WordListSuggestions.yml\n\n@@ -44,8 +44,6 @@ swap:\n   overview screen: recents screen\n   params: parameters\n   precaching: pre-caching\n-  prerender: pre-render\n-  prerendering: pre-rendering\n   prior to: before\n   provided that: if\n   resubscription: re-subscribe|subscription\n\n---\n file path A: aio/tools/doc-linter/styles/Vocab/Angular.txt | file path B: aio/tools/doc-linter/styles/Vocab/Angular.txt\n\n@@ -3,6 +3,7 @@ angular's\n animatable\n autoprefixer\n bootstrapper\n+cpus\n devtools\n initializer\n initializers\n@@ -21,7 +22,9 @@ preloader\n preloading\n preloads\n prepends\n+prerender\n+prerendering\n profiler\n rollout\n routable\n-sideEffects\n\\ No newline at end of file\n+sideEffects\n\n\n###\n\n", "completion": "docs: update spelling dictionary (#<issue-num>)"}
{"prompt": " file path A: aio/content/tutorial/index.md | file path B: aio/content/tutorial/index.md\n\n@@ -5,7 +5,7 @@\n <header>Getting Started</header>\n \n In this tutorial, you build your own Angular application from the start.\n-This is a good way to experience a typical development process as you learn Angular application-design concepts, tools, and terminology. \n+This is a good way to experience a typical development process as you learn Angular application-design concepts, tools, and terminology.\n \n If you're new to Angular, try the [**Try it now**](start) quick-start application first.\n **Try it now** is based on a ready-made  partially completed project.\n@@ -30,7 +30,6 @@ The finished application:\n * Edits a selected hero's details\n * Navigates between different views of heroic data\n \n-\n This tutorial helps you gain confidence that Angular can do whatever you need it to do by showing you how to:\n \n *   Use Angular [directives](guide/glossary#directive \"Directives definition\") to show and hide elements and display lists of hero data.\n\n---\n file path A: aio/content/tutorial/toh-pt0.md | file path B: aio/content/tutorial/toh-pt0.md\n\n@@ -22,8 +22,8 @@ To set up your development environment, follow the instructions in [Local Enviro\n ## Create a new workspace and an initial application\n \n You develop applications in the context of an Angular [workspace](guide/glossary#workspace).\n-A _workspace_ contains the files for one or more [projects](guide/glossary#project).\n-A _project_ is the set of files that make up an application or a library.\n+A *workspace* contains the files for one or more [projects](guide/glossary#project).\n+A *project* is the set of files that make up an application or a library.\n \n To create a new workspace and an initial project:\n \n@@ -100,7 +100,7 @@ In the IDE, locate these files, which make up the `AppComponent` that you just c\n <div class=\"alert is-important\">\n \n When you ran `ng new`, Angular created test specifications for your new application.\n-Making these changes, however, breaks your newly created specifications.\n+Unfortunately, making these changes breaks your newly created specifications.\n \n That won't be a problem because Angular testing is outside the scope of this tutorial and won't be used.\n \n\n---\n file path A: aio/content/tutorial/toh-pt1.md | file path B: aio/content/tutorial/toh-pt1.md\n\n@@ -162,7 +162,7 @@ Other critical metadata is in [`@NgModule`](guide/ngmodules) decorators.\n The most important `@NgModule` decorator annotates the top-level **AppModule** class.\n \n `ng new` created an `AppModule` class in `src/app/app.module.ts` when it created the project.\n-This is where you _opt in_ to the `FormsModule`.\n+This is where you *opt in* to the `FormsModule`.\n \n ### Import `FormsModule`\n \n@@ -171,7 +171,7 @@ Open `app.module.ts` and import the `FormsModule` symbol from the `@angular/form\n <code-example path=\"toh-pt1/src/app/app.module.ts\" header=\"app.module.ts (FormsModule symbol import)\"\n  region=\"formsmodule-js-import\"></code-example>\n \n-Add `FormsModule` to the  `imports` array in `@NgModule`. \n+Add `FormsModule` to the  `imports` array in `@NgModule`.\n The `imports` array contains the list of external modules that the application needs.\n \n <code-example header=\"app.module.ts (@NgModule imports)\" path=\"toh-pt1/src/app/app.module.ts\" region=\"ng-imports\"></code-example>\n\n---\n file path A: aio/content/tutorial/toh-pt2.md | file path B: aio/content/tutorial/toh-pt2.md\n\n@@ -1,6 +1,6 @@\n # Display a selection list\n \n-This tutorial shows you how to: \n+This tutorial shows you how to:\n \n * Expand the Tour of Heroes application to display a list of heroes.\n * Allow users to select a hero and display the hero's details.\n@@ -141,7 +141,7 @@ Add the following `onSelect()` method, which assigns the clicked hero from the t\n ### Add a details section\n \n Currently, you have a list in the component template.\n-To show details about a hero when you click their name in the list, add a section \n+To show details about a hero when you click their name in the list, add a section\n in the template that displays their details.\n Add the following to `heroes.component.html` beneath the list section:\n \n\n---\n file path A: aio/content/tutorial/toh-pt4.md | file path B: aio/content/tutorial/toh-pt4.md\n\n@@ -42,7 +42,7 @@ The command generates a skeleton `HeroService` class in `src/app/hero.service.ts\n ### `@Injectable()` services\n \n Notice that the new service imports the Angular `Injectable` symbol and annotates the class with the `@Injectable()` decorator. This marks the class as one that participates in the *dependency injection system*.\n-The `HeroService` class is going to provide an injectable service, and it can also have its own injected dependencies. \n+The `HeroService` class is going to provide an injectable service, and it can also have its own injected dependencies.\n It doesn't have any dependencies yet.\n \n The `@Injectable()` decorator accepts a metadata object for the service, the same way the `@Component()` decorator did for your component classes.\n@@ -166,7 +166,7 @@ synchronous, because that would block the browser as it waits to return data.\n \n `HeroService.getHeroes()` must have an *asynchronous signature* of some kind.\n \n-In this tutorial, `HeroService.getHeroes()` returns an `Observable` so that it can \n+In this tutorial, `HeroService.getHeroes()` returns an `Observable` so that it can\n use the Angular `HttpClient.get` method to fetch the heroes\n and have [`HttpClient.get()`](guide/http) return an `Observable`.\n \n@@ -263,7 +263,7 @@ Open `MessageService` and replace its contents with the following.\n \n The service exposes its cache of `messages` and two methods:\n \n-* One to `add()` a message to the cache. \n+* One to `add()` a message to the cache.\n * Another to `clear()` the cache.\n \n <a id=\"inject-message-service\"></a>\n\n---\n file path A: aio/content/tutorial/toh-pt5.md | file path B: aio/content/tutorial/toh-pt5.md\n\n@@ -98,6 +98,8 @@ Next, `AppRoutingModule` exports `RouterModule` to be available throughout the a\n \n ## Add `RouterOutlet`\n \n+<!-- markdownlint-disable MD001 -->\n+\n Open the `AppComponent` template and replace the `<app-heroes>` element with a `<router-outlet>` element.\n \n <code-example header=\"src/app/app.component.html (router-outlet)\" path=\"toh-pt5/src/app/app.component.html\" region=\"outlet\"></code-example>\n@@ -114,6 +116,8 @@ If you didn't use the `ng generate` command to create `app-routing.module.ts`, i\n \n </div>\n \n+<!-- markdownlint-disable MD024 -->\n+\n #### Try it\n \n If you're not still serving your application, run `ng serve` to see your application in the browser.\n@@ -125,11 +129,14 @@ The URL ends in `/`.\n The route path to `HeroesComponent` is `/heroes`.\n \n Append `/heroes` to the URL in the browser address bar.\n-You should see the familiar heroes master/detail view.\n+You should see the familiar heroes overview/detail view.\n \n Remove `/heroes` from the URL in the browser address bar.\n The browser should refresh and display the application title but not the list of heroes.\n \n+<!-- markdownlint-enable MD001 -->\n+<!-- markdownlint-enable MD024 -->\n+\n <a id=\"routerlink\"></a>\n \n ## Add a navigation link using `routerLink`\n@@ -292,8 +299,8 @@ The hero items in the `HeroesComponent` are `<li>` elements whose click events a\n \n <code-example header=\"src/app/heroes/heroes.component.html (list with onSelect)\" path=\"toh-pt4/src/app/heroes/heroes.component.html\" region=\"list\"></code-example>\n \n-Remove the `<li>` back to just its `*ngFor`. \n-Wrap the badge and name in an anchor `<a>` element. \n+Remove the `<li>` back to just its `*ngFor`.\n+Wrap the badge and name in an anchor `<a>` element.\n Add a `routerLink` attribute to the anchor that's the same as in the dashboard template.\n \n <code-example header=\"src/app/heroes/heroes.component.html (list with links)\" path=\"toh-pt5/src/app/heroes/heroes.component.html\" region=\"list\"></code-example>\n@@ -380,6 +387,8 @@ It returns a *mock hero* as an `Observable`, using the RxJS `of()` function.\n \n You can rewrite `getHero()` as a real `Http` request without having to change the `HeroDetailComponent` that calls it.\n \n+<!-- markdownlint-disable MD024 -->\n+\n #### Try it\n \n The browser refreshes and the application is working again.\n@@ -387,6 +396,8 @@ You can click a hero in the dashboard or in the heroes list and navigate to that\n \n If you paste `localhost:4200/detail/12` in the browser address bar, the router navigates to the detail view for the hero with `id: 12`, **Dr Nice**.\n \n+<!-- markdownlint-enable MD024 -->\n+\n <a id=\"goback\"></a>\n \n ### Find the way back\n@@ -411,6 +422,8 @@ The details look better when you add the private CSS styles to `hero-detail.comp\n \n ## Final code review\n \n+<!-- markdownlint-disable MD001 -->\n+\n Here are the code files discussed on this page.\n \n <a id=\"approutingmodule\"></a>\n@@ -464,6 +477,8 @@ Here are the code files discussed on this page.\n     <code-pane header=\"src/app/hero-detail/hero-detail.component.css\" path=\"toh-pt5/src/app/hero-detail/hero-detail.component.css\"></code-pane>\n </code-tabs>\n \n+<!-- markdownlint-enable MD001 -->\n+\n ## Summary\n \n *   You added the Angular router to navigate among different components\n\n---\n file path A: aio/content/tutorial/toh-pt6.md | file path B: aio/content/tutorial/toh-pt6.md\n\n@@ -207,8 +207,10 @@ Update the `HeroService` `getHero()` method with the following to make that requ\n \n ## Update heroes\n \n+<!-- markdownlint-disable MD001 -->\n+\n Edit a hero's name in the hero detail view.\n-As you type, the hero name updates the heading at the top of the page, yet \n+As you type, the hero name updates the heading at the top of the page, yet\n when you click **Go back**, your changes are lost.\n \n If you want changes to persist, you must write them back to the server.\n@@ -440,7 +442,7 @@ Each operator works as follows:\n \n <div class=\"alert is-helpful\">\n \n-With the [switchMap operator](https://www.learnrxjs.io/learn-rxjs/operators/transformation/switchmap), every qualifying key event can trigger an `HttpClient.get()` method call.\n+With the [`switchMap` operator](https://www.learnrxjs.io/learn-rxjs/operators/transformation/switchmap), every qualifying key event can trigger an `HttpClient.get()` method call.\n Even with a 300&nbsp;ms pause between requests, you could have many HTTP requests in flight and they may not return in the order sent.\n \n `switchMap()` preserves the original request order while returning only the observable from the most recent HTTP method call.\n\n\n###\n\n", "completion": "docs: remove assorted lint errors (#<issue-num>)"}
{"prompt": " file path A: packages/core/schematics/BUILD.bazel | file path B: packages/core/schematics/BUILD.bazel\n\n@@ -15,6 +15,7 @@ pkg_npm(\n     deps = [\n         \"//packages/core/schematics/migrations/entry-components\",\n         \"//packages/core/schematics/migrations/path-match-type\",\n+        \"//packages/core/schematics/migrations/relative-link-resolution\",\n         \"//packages/core/schematics/migrations/router-link-with-href\",\n         \"//packages/core/schematics/migrations/typed-forms\",\n     ],\n\n---\n file path A: packages/core/schematics/migrations.json | file path B: packages/core/schematics/migrations.json\n\n@@ -19,6 +19,11 @@\n       \"version\": \"15.0.0-beta\",\n       \"description\": \"Since Angular v15, the `RouterLink` contains the logic of the `RouterLinkWithHref` directive. This migration replaces all `RouterLinkWithHref` references with `RouterLink`.\",\n       \"factory\": \"./migrations/router-link-with-href/index\"\n+    },\n+    \"migration-v15-relative-link-resolution\": {\n+      \"version\": \"15.0.0-beta\",\n+      \"description\": \"In Angular version 15, the deprecated `relativeLinkResolution` config parameter of the Router is removed. This migration removes all `relativeLinkResolution` fields from the Router config objects.\",\n+      \"factory\": \"./migrations/relative-link-resolution/index\"\n     }\n   }\n }\n\\ No newline at end of file\n\n---\n file path A: packages/core/schematics/migrations/google3/BUILD.bazel | file path B: packages/core/schematics/migrations/google3/BUILD.bazel\n\n@@ -9,6 +9,7 @@ ts_library(\n         \"//packages/core/schematics/migrations/entry-components\",\n         \"//packages/core/schematics/migrations/path-match-type\",\n         \"//packages/core/schematics/migrations/path-match-type/google3\",\n+        \"//packages/core/schematics/migrations/relative-link-resolution\",\n         \"//packages/core/schematics/migrations/typed-forms\",\n         \"//packages/core/schematics/utils\",\n         \"//packages/core/schematics/utils/tslint\",\n\n---\n file path A: None | file path B: packages/core/schematics/migrations/google3/relativeLinkResolutionRule.ts\n\n@@ -0,0 +1,31 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Replacement, RuleFailure, Rules} from 'tslint';\n+import ts from 'typescript';\n+\n+import {migrateFile} from '../relative-link-resolution/util';\n+\n+/** TSLint rule for the `relativeLinkResolution` migration. */\n+export class Rule extends Rules.TypedRule {\n+  override applyWithProgram(sourceFile: ts.SourceFile, program: ts.Program): RuleFailure[] {\n+    const failures: RuleFailure[] = [];\n+\n+    const rewriter = (startPos: number, origLength: number, text: string) => {\n+      const failure = new RuleFailure(\n+          sourceFile, startPos, startPos + origLength,\n+          'The `relativeLinkResolution` Router config option is removed and should not be used.',\n+          this.ruleName, new Replacement(startPos, origLength, text));\n+      failures.push(failure);\n+    };\n+\n+    migrateFile(sourceFile, rewriter);\n+\n+    return failures;\n+  }\n+}\n\n---\n file path A: None | file path B: packages/core/schematics/migrations/relative-link-resolution/BUILD.bazel\n\n@@ -0,0 +1,18 @@\n+load(\"//tools:defaults.bzl\", \"ts_library\")\n+\n+ts_library(\n+    name = \"relative-link-resolution\",\n+    srcs = glob([\"**/*.ts\"]),\n+    tsconfig = \"//packages/core/schematics:tsconfig.json\",\n+    visibility = [\n+        \"//packages/core/schematics:__pkg__\",\n+        \"//packages/core/schematics/migrations/google3:__pkg__\",\n+        \"//packages/core/schematics/test:__pkg__\",\n+    ],\n+    deps = [\n+        \"//packages/core/schematics/utils\",\n+        \"@npm//@angular-devkit/schematics\",\n+        \"@npm//@types/node\",\n+        \"@npm//typescript\",\n+    ],\n+)\n\n---\n file path A: None | file path B: packages/core/schematics/migrations/relative-link-resolution/README.md\n\n@@ -0,0 +1,25 @@\n+## Relative link resolution migration\n+\n+As of Angular v15, the deprecated `relativeLinkResolution` config option of the Router is removed.\n+This migration cleans up (removes) the `relativeLinkResolution` fields from the Router config objects\n+in applications code.\n+\n+#### Before\n+```ts\n+import { RouterModule } from '@angular/router';\n+\n+RouterModule.forRoot([], {\n+  relativeLinkResolution: 'legacy',\n+  enableTracing: false,\n+});\n+```\n+\n+#### After\n+```ts\n+import { RouterModule } from '@angular/router';\n+\n+RouterModule.forRoot([], {\n+  // the `relativeLinkResolution` is removed\n+  enableTracing: false,\n+});\n+```\n\n---\n file path A: None | file path B: packages/core/schematics/migrations/relative-link-resolution/index.ts\n\n@@ -0,0 +1,58 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Rule, SchematicsException, Tree, UpdateRecorder} from '@angular-devkit/schematics';\n+import {relative} from 'path';\n+\n+import {getProjectTsConfigPaths} from '../../utils/project_tsconfig_paths';\n+import {canMigrateFile, createMigrationProgram} from '../../utils/typescript/compiler_host';\n+\n+import {migrateFile} from './util';\n+\n+export default function(): Rule {\n+  return async (tree: Tree) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n+    const basePath = process.cwd();\n+    const allPaths = [...buildPaths, ...testPaths];\n+\n+    if (!allPaths.length) {\n+      throw new SchematicsException(\n+          'Could not find any tsconfig file. ' +\n+          'Cannot run a migration to cleanup the deprecated `relativeLinkResolution` config option.');\n+    }\n+\n+    for (const tsconfigPath of allPaths) {\n+      runRelativeLinkResolutionMigration(tree, tsconfigPath, basePath);\n+    }\n+  };\n+}\n+\n+function runRelativeLinkResolutionMigration(tree: Tree, tsconfigPath: string, basePath: string) {\n+  const {program} = createMigrationProgram(tree, tsconfigPath, basePath);\n+  const sourceFiles =\n+      program.getSourceFiles().filter(sourceFile => canMigrateFile(basePath, sourceFile, program));\n+\n+  for (const sourceFile of sourceFiles) {\n+    let update: UpdateRecorder|null = null;\n+\n+    const rewriter = (startPos: number, origLength: number, text: string) => {\n+      if (update === null) {\n+        // Lazily initialize update, because most files will not require migration.\n+        update = tree.beginUpdate(relative(basePath, sourceFile.fileName));\n+      }\n+      update.remove(startPos, origLength);\n+      update.insertLeft(startPos, text);\n+    };\n+\n+    migrateFile(sourceFile, rewriter);\n+\n+    if (update !== null) {\n+      tree.commitUpdate(update);\n+    }\n+  }\n+}\n\n---\n file path A: None | file path B: packages/core/schematics/migrations/relative-link-resolution/util.ts\n\n@@ -0,0 +1,85 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import ts from 'typescript';\n+\n+const relativeLinkResolution = 'relativeLinkResolution';\n+const knownConfigValues = new Set([`'legacy'`, `'corrected'`]);\n+\n+export interface RewriteEntity {\n+  startPos: number;\n+  width: number;\n+  replacement: string;\n+}\n+\n+export interface MigratableNode {\n+  objectLiteral: ts.ObjectLiteralExpression;\n+  property: ts.ObjectLiteralElementLike;\n+}\n+\n+export type RewriteFn = (startPos: number, origLength: number, text: string) => void;\n+\n+export function migrateFile(sourceFile: ts.SourceFile, rewriteFn: RewriteFn) {\n+  let rewrites: RewriteEntity[] = [];\n+  const usages = getUsages(sourceFile);\n+  for (const {objectLiteral, property} of usages) {\n+    const replacementNode = ts.factory.updateObjectLiteralExpression(\n+        objectLiteral, objectLiteral.properties.filter(prop => prop !== property));\n+    const printer = ts.createPrinter();\n+    const replacementText = printer.printNode(ts.EmitHint.Unspecified, replacementNode, sourceFile);\n+    rewrites.push({\n+      startPos: objectLiteral.getStart(),\n+      width: objectLiteral.getWidth(),\n+      replacement: replacementText,\n+    });\n+  }\n+\n+  // Process rewrites last-to-first (based on start pos) to avoid offset shifts during rewrites.\n+  rewrites = sortByStartPosDescending(rewrites);\n+  for (const rewrite of rewrites) {\n+    rewriteFn(rewrite.startPos, rewrite.width, rewrite.replacement);\n+  }\n+}\n+\n+function getUsages(sourceFile: ts.SourceFile): MigratableNode[] {\n+  const usages: MigratableNode[] = [];\n+  const visitNode = (node: ts.Node) => {\n+    if (ts.isObjectLiteralExpression(node)) {\n+      // Look for patterns like the following:\n+      // ```\n+      // { ... relativeLinkResolution: 'legacy', ... }\n+      // ```\n+      // or:\n+      // ```\n+      // { ... relativeLinkResolution: 'corrected', ... }\n+      // ```\n+      // If the value is unknown (i.e. not 'legacy' or 'corrected'),\n+      // do not attempt to rewrite (this might be an application-specific\n+      // configuration, not a part of Router).\n+      const property = node.properties.find(\n+          prop => ts.isPropertyAssignment(prop) && ts.isIdentifier(prop.name) &&\n+              prop.name.text === relativeLinkResolution &&\n+              knownConfigValues.has(prop.initializer.getText()));\n+      if (property) {\n+        usages.push({objectLiteral: node, property});\n+      }\n+    }\n+    ts.forEachChild(node, visitNode);\n+  };\n+  ts.forEachChild(sourceFile, visitNode);\n+  return usages;\n+}\n+\n+/**\n+ * Sort all found usages based on their start positions in the source file in descending order (i.e.\n+ * last usage goes first on the list, etc). This is needed to avoid shifting offsets in the source\n+ * file (in case there are multiple usages) as we rewrite symbols.\n+ */\n+function sortByStartPosDescending(rewrites: RewriteEntity[]): RewriteEntity[] {\n+  return rewrites.sort((entityA, entityB) => entityB.startPos - entityA.startPos);\n+}\n\n---\n file path A: packages/core/schematics/test/BUILD.bazel | file path B: packages/core/schematics/test/BUILD.bazel\n\n@@ -10,6 +10,7 @@ ts_library(\n     deps = [\n         \"//packages/core/schematics/migrations/entry-components\",\n         \"//packages/core/schematics/migrations/path-match-type\",\n+        \"//packages/core/schematics/migrations/relative-link-resolution\",\n         \"//packages/core/schematics/migrations/router-link-with-href\",\n         \"//packages/core/schematics/migrations/typed-forms\",\n         \"//packages/core/schematics/utils\",\n\n---\n file path A: None | file path B: packages/core/schematics/test/google3/relative_link_resolution_spec.ts\n\n@@ -0,0 +1,72 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {readFileSync, writeFileSync} from 'fs';\n+import {dirname, join} from 'path';\n+import * as shx from 'shelljs';\n+import {Configuration, Linter} from 'tslint';\n+\n+describe('Google3 relativeLinkResolution TSLint rule', () => {\n+  const rulesDirectory =\n+      dirname(require.resolve('../../migrations/google3/relativeLinkResolutionRule'));\n+\n+  let tmpDir: string;\n+\n+  beforeEach(() => {\n+    tmpDir = join(process.env['TEST_TMPDIR']!, 'google3-test');\n+    shx.mkdir('-p', tmpDir);\n+\n+    writeFile('tsconfig.json', JSON.stringify({\n+      compilerOptions: {\n+        module: 'es2015',\n+        baseUrl: './',\n+      },\n+    }));\n+  });\n+\n+  afterEach(() => shx.rm('-r', tmpDir));\n+\n+  function runTSLint(fix: boolean) {\n+    const program = Linter.createProgram(join(tmpDir, 'tsconfig.json'));\n+    const linter = new Linter({fix, rulesDirectory: [rulesDirectory]}, program);\n+    const config = Configuration.parseConfigFile({rules: {'relativeLinkResolution': true}});\n+\n+    program.getRootFileNames().forEach(fileName => {\n+      linter.lint(fileName, program.getSourceFile(fileName)!.getFullText(), config);\n+    });\n+\n+    return linter;\n+  }\n+\n+  function writeFile(fileName: string, content: string) {\n+    writeFileSync(join(tmpDir, fileName), content);\n+  }\n+\n+  function getFile(fileName: string) {\n+    return readFileSync(join(tmpDir, fileName), 'utf8');\n+  }\n+\n+  // This is just a sanity check for the TSLint configuration;\n+  // see test/relative_link_resolution_spec.ts for the full test suite.\n+  it('should migrate a simple example', () => {\n+    writeFile('/index.ts', `\n+      import { RouterModule } from '@angular/router';\n+\n+      let providers = RouterModule.forRoot([], {\n+        onSameUrlNavigation: 'reload',\n+        paramsInheritanceStrategy: 'always',\n+        relativeLinkResolution: 'legacy',\n+        enableTracing: false,\n+      });\n+    `);\n+\n+    runTSLint(true);\n+    const content = getFile(`/index.ts`);\n+    expect(content).not.toContain('relativeLinkResolution');\n+  });\n+});\n\n---\n file path A: None | file path B: packages/core/schematics/test/relative_link_resolution_spec.ts\n\n@@ -0,0 +1,129 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {getSystemPath, normalize, virtualFs} from '@angular-devkit/core';\n+import {TempScopedNodeJsSyncHost} from '@angular-devkit/core/node/testing';\n+import {HostTree} from '@angular-devkit/schematics';\n+import {SchematicTestRunner, UnitTestTree} from '@angular-devkit/schematics/testing';\n+import * as shx from 'shelljs';\n+\n+describe('Relative link resolution config migration', () => {\n+  let runner: SchematicTestRunner;\n+  let host: TempScopedNodeJsSyncHost;\n+  let tree: UnitTestTree;\n+  let tmpDirPath: string;\n+  let previousWorkingDir: string;\n+\n+  function writeFile(filePath: string, contents: string) {\n+    host.sync.write(normalize(filePath), virtualFs.stringToFileBuffer(contents));\n+  }\n+\n+  function runMigration() {\n+    return runner.runSchematicAsync('migration-v15-relative-link-resolution', {}, tree).toPromise();\n+  }\n+\n+  beforeEach(() => {\n+    runner = new SchematicTestRunner('test', require.resolve('../migrations.json'));\n+    host = new TempScopedNodeJsSyncHost();\n+    tree = new UnitTestTree(new HostTree(host));\n+\n+    writeFile('/tsconfig.json', JSON.stringify({\n+      compilerOptions: {\n+        lib: ['es2015'],\n+        strictNullChecks: true,\n+      },\n+    }));\n+\n+    writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n+      projects: {t: {root: '', architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n+    }));\n+\n+    previousWorkingDir = shx.pwd();\n+    tmpDirPath = getSystemPath(host.root);\n+\n+    // Switch into the temporary directory path. This allows us to run\n+    // the schematic against our custom unit test tree.\n+    shx.cd(tmpDirPath);\n+  });\n+\n+  afterEach(() => {\n+    shx.cd(previousWorkingDir);\n+    shx.rm('-r', tmpDirPath);\n+  });\n+\n+  it('should drop `relativeLinkResolution` config option when used with RouterModule.forRoot',\n+     async () => {\n+       writeFile('/index.ts', `\n+          import { RouterModule } from '@angular/router';\n+\n+          let providers = RouterModule.forRoot([], {\n+            onSameUrlNavigation: 'reload',\n+            paramsInheritanceStrategy: 'always',\n+            relativeLinkResolution: 'legacy',\n+            enableTracing: false,\n+          });\n+\n+          providers = RouterModule.forRoot([], {\n+            onSameUrlNavigation: 'reload',\n+            paramsInheritanceStrategy: 'always',\n+            relativeLinkResolution: 'corrected',\n+            enableTracing: false,\n+          });\n+        `);\n+\n+       await runMigration();\n+\n+       const content = tree.readContent('/index.ts');\n+       expect(content).not.toContain('relativeLinkResolution');\n+     });\n+\n+  it('should drop `relativeLinkResolution` config option when used without RouterModule.forRoot',\n+     async () => {\n+       writeFile('/index.ts', `\n+          const routerConfig = {\n+            onSameUrlNavigation: 'reload',\n+            paramsInheritanceStrategy: 'always',\n+            relativeLinkResolution: 'legacy',\n+            enableTracing: false,\n+          };\n+        `);\n+\n+       await runMigration();\n+\n+       const content = tree.readContent('/index.ts');\n+       expect(content).not.toContain('relativeLinkResolution');\n+     });\n+\n+  it('should not touch `` if a value is unknown', async () => {\n+    writeFile('/index.ts', `\n+      const routerConfig = {\n+        relativeLinkResolution: 'some-unknown-value',\n+      };\n+    `);\n+\n+    await runMigration();\n+\n+    const content = tree.readContent('/index.ts');\n+    expect(content).toContain(`relativeLinkResolution: 'some-unknown-value'`);\n+  });\n+\n+  it('should retain an empty object if `relativeLinkResolution` was the only property',\n+     async () => {\n+       writeFile('/index.ts', `\n+          const routerConfig = {\n+            relativeLinkResolution: 'legacy',\n+          };\n+        `);\n+\n+       await runMigration();\n+\n+       const content = tree.readContent('/index.ts');\n+       expect(content).toContain(`const routerConfig = {}`);\n+     });\n+});\n\n\n###\n\n", "completion": "feat(router): add a migration to remove `relativeLinkResolution` usages (#<issue-num>)"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -145,6 +145,7 @@ commands:\n             CIRCLE_GIT_BASE_REVISION: << pipeline.git.base_revision >>\n             CIRCLE_GIT_REVISION: << pipeline.git.revision >>\n           command: ./.circleci/env.sh\n+      - devinfra/setup-bazel-remote-exec\n       - run:\n           # Configure git as the CircleCI `checkout` command does.\n           # This is needed because we only checkout on the setup job.\n\n---\n file path A: .circleci/env.linux.sh | file path B: .circleci/env.linux.sh\n\n@@ -1,11 +1,4 @@\n-####################################################################################################\n-# Decrypt GCP Credentials and store them as the Google default credentials.\n-####################################################################################################\n-mkdir -p \"$HOME/.config/gcloud\";\n-openssl aes-256-cbc -d -in \"${PROJECT_ROOT}/.circleci/gcp_token\" \\\n-        -md md5 -k \"$CIRCLE_PROJECT_REPONAME\" -out \"$HOME/.config/gcloud/application_default_credentials.json\"\n-\n ####################################################################################################\n # Set bazel configuration for CircleCI runs.\n ####################################################################################################\n-cp \"${PROJECT_ROOT}/.circleci/bazel.linux.rc\" \"$HOME/.bazelrc\";\n+cp \"${PROJECT_ROOT}/.circleci/bazel.linux.rc\" \".bazelrc.user\";\n\n---\n file path A: .circleci/env.windows.sh | file path B: .circleci/env.windows.sh\n\n@@ -1,17 +1,10 @@\n-####################################################################################################\n-# Decrypt GCP Credentials and store them as the Google default credentials.\n-####################################################################################################\n-mkdir -p \"${APPDATA}/gcloud/\";\n-openssl aes-256-cbc -d -in \"${PROJECT_ROOT}/.circleci/gcp_token\" \\\n-        -md md5 -k \"$CIRCLE_PROJECT_REPONAME\" -out \"${APPDATA}/gcloud/application_default_credentials.json\"\n-\n ####################################################################################################\n # Set bazel configuration for CircleCI runs.\n ####################################################################################################\n-cp \"${PROJECT_ROOT}/.circleci/bazel.windows.rc\" \"${USERPROFILE}/.bazelrc\";\n+cp \"${PROJECT_ROOT}/.circleci/bazel.windows.rc\" \".bazelrc.user\";\n \n \n # Expose the Bazelisk version. We need to run Bazelisk globally since Windows has problems launching\n # Bazel from a node modules directoy that might be modified by the Bazel Yarn install then.\n setPublicVar BAZELISK_VERSION \\\n-    \"$(cd ${PROJECT_ROOT}; node -p 'require(\"./package.json\").devDependencies[\"@bazel/bazelisk\"]')\"\n\\ No newline at end of file\n+    \"$(cd ${PROJECT_ROOT}; node -p 'require(\"./package.json\").devDependencies[\"@bazel/bazelisk\"]')\"\n\n---\n file path A: .circleci/gcp_token | file path B: .circleci/gcp_token\n\nBinary files a/.circleci/gcp_token and /dev/null differ\n\n---\n file path A: scripts/ci/run_angular_components_unit_tests.sh | file path B: scripts/ci/run_angular_components_unit_tests.sh\n\n@@ -13,6 +13,11 @@ cd ${COMPONENTS_REPO_TMP_DIR}\n # Create a symlink for the Bazel binary installed through NPM, as running through Yarn introduces OOM errors.\n ./scripts/circleci/setup_bazel_binary.sh\n \n+# Properly wire up the components repo CircleCI Bazel configuration\n+# Also enable RBE. The credentials are expected to be set up already.\n+echo \"import %workspace%/.circleci/bazel.rc\" >> ./.bazelrc.user\n+echo \"build --config=remote\" >> ./.bazelrc.user\n+\n # Now actually run the tests.\n bazel test \\\n   --build_tag_filters=-docs-package,-e2e,-browser:firefox \\\n\n\n###\n\n", "completion": "build: setup remote execution through shared command (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/shims/src/adapter.ts | file path B: packages/compiler-cli/src/ngtsc/shims/src/adapter.ts\n\n@@ -168,31 +168,26 @@ export class ShimAdapter {\n       // This _might_ be a shim, if an underlying base file exists. The base file might be .ts or\n       // .tsx.\n       let baseFileName = absoluteFrom(prefix + '.ts');\n-      if (!this.delegate.fileExists(baseFileName)) {\n+      // Retrieve the original file for which the shim will be generated.\n+      let inputFile = this.delegate.getSourceFile(baseFileName, ts.ScriptTarget.Latest);\n+      if (inputFile === undefined) {\n         // No .ts file by that name - try .tsx.\n         baseFileName = absoluteFrom(prefix + '.tsx');\n-        if (!this.delegate.fileExists(baseFileName)) {\n-          // This isn't a shim after all since there is no original file which would have triggered\n-          // its generation, even though the path is right. There are a few reasons why this could\n-          // occur:\n-          //\n-          // * when resolving an import to an .ngfactory.d.ts file, the module resolution algorithm\n-          //   will first look for an .ngfactory.ts file in its place, which will be requested here.\n-          // * when the user writes a bad import.\n-          // * when a file is present in one compilation and removed in the next incremental step.\n-          //\n-          // Note that this does not add the filename to `notShims`, so this path is not cached.\n-          // That's okay as these cases above are edge cases and do not occur regularly in normal\n-          // operations.\n-          return undefined;\n-        }\n+        inputFile = this.delegate.getSourceFile(baseFileName, ts.ScriptTarget.Latest);\n       }\n-\n-      // Retrieve the original file for which the shim will be generated.\n-      const inputFile = this.delegate.getSourceFile(baseFileName, ts.ScriptTarget.Latest);\n       if (inputFile === undefined || isShim(inputFile)) {\n-        // Something strange happened here. This case is also not cached in `notShims`, but this\n-        // path is not expected to occur in reality so this shouldn't be a problem.\n+        // This isn't a shim after all since there is no original file which would have triggered\n+        // its generation, even though the path is right. There are a few reasons why this could\n+        // occur:\n+        //\n+        // * when resolving an import to an .ngfactory.d.ts file, the module resolution algorithm\n+        //   will first look for an .ngfactory.ts file in its place, which will be requested here.\n+        // * when the user writes a bad import.\n+        // * when a file is present in one compilation and removed in the next incremental step.\n+        //\n+        // Note that this does not add the filename to `notShims`, so this path is not cached.\n+        // That's okay as these cases above are edge cases and do not occur regularly in normal\n+        // operations.\n         return undefined;\n       }\n \n\n---\n file path A: packages/compiler-cli/test/perform_watch_spec.ts | file path B: packages/compiler-cli/test/perform_watch_spec.ts\n\n@@ -121,7 +121,6 @@ describe('perform watch', () => {\n     expectNoDiagnostics(config.options, host.diagnostics);\n \n     expect(fileExistsSpy!).not.toHaveBeenCalledWith(mainTsPath);\n-    expect(fileExistsSpy!).toHaveBeenCalledWith(utilTsPath);\n     expect(getSourceFileSpy!).not.toHaveBeenCalledWith(mainTsPath, jasmine.anything());\n     expect(getSourceFileSpy!).toHaveBeenCalledWith(utilTsPath, jasmine.anything());\n \n\n\n###\n\n", "completion": "perf(compiler-cli): minimize filesystem calls when generating shims (#<issue-num>)"}
{"prompt": " file path A: packages/common/http/src/xsrf.ts | file path B: packages/common/http/src/xsrf.ts\n\n@@ -90,7 +90,7 @@ export function xsrfInterceptorFn(\n   const headerName = inject(XSRF_HEADER_NAME);\n \n   // Be careful not to overwrite an existing header of the same name.\n-  if (token !== null && !req.headers.has(headerName)) {\n+  if (token != null && !req.headers.has(headerName)) {\n     req = req.clone({headers: req.headers.set(headerName, token)});\n   }\n   return next(req);\n\n\n###\n\n", "completion": "fix(http): better handle unexpected `undefined` XSRF tokens (#<issue-num>)"}
{"prompt": " file path A: aio/src/app/layout/notification/notification.component.html | file path B: aio/src/app/layout/notification/notification.component.html\n\n@@ -2,6 +2,6 @@\n   <ng-content></ng-content>\n </span>\n \n-<button mat-icon-button class=\"close-button\" aria-label=\"Dismiss notification\" (click)=\"dismiss()\">\n+<button mat-icon-button class=\"close-button\" [attr.aria-label]=\"'Close' + bannerNotficationDescription\" (click)=\"dismiss()\">\n   <mat-icon svgIcon=\"close\"></mat-icon>\n </button>\n\n---\n file path A: aio/src/app/layout/notification/notification.component.ts | file path B: aio/src/app/layout/notification/notification.component.ts\n\n@@ -21,6 +21,7 @@ const LOCAL_STORAGE_NAMESPACE = 'aio-notification/';\n   host: { role: 'group', 'aria-label': 'Notification' }\n })\n export class NotificationComponent implements OnInit {\n+  @Input() bannerNotficationDescription = 'notification banner.';\n   @Input() dismissOnContentClick: boolean;\n   @Input() notificationId: string;\n   @Input() expirationDate: string;\n\n---\n file path A: goldens/size-tracking/aio-payloads.json | file path B: goldens/size-tracking/aio-payloads.json\n\n@@ -2,11 +2,11 @@\n   \"aio\": {\n     \"uncompressed\": {\n       \"runtime\": 4325,\n-      \"main\": 454820,\n-      \"polyfills\": 33814,\n-      \"styles\": 73640,\n-      \"light-theme\": 78276,\n-      \"dark-theme\": 78381\n+      \"main\": 455373,\n+      \"polyfills\": 33922,\n+      \"styles\": 73964,\n+      \"light-theme\": 78157,\n+      \"dark-theme\": 78289\n     }\n   },\n   \"aio-local\": {\n\n\n###\n\n", "completion": "refactor(docs-infra): add new Input for better description of close button in notification component (#<issue-num>)"}
{"prompt": " file path A: aio/content/images/bios/marko.jpg | file path B: aio/content/images/bios/marko.jpg\n\nBinary files /dev/null and b/aio/content/images/bios/marko.jpg differ\n\n---\n file path A: aio/content/marketing/contributors.json | file path B: aio/content/marketing/contributors.json\n\n@@ -654,6 +654,14 @@\n     \"mentor\": \"mgechev\",\n     \"groups\": [\"GDE\", \"Collaborators\"]\n   },\n+  \"markostanimirovic\": {\n+    \"name\": \"Marko Stanimirovi\u0107\",\n+    \"picture\": \"marko.jpg\",\n+    \"twitter\": \"MarkoStDev\",\n+    \"website\": \"https://github.com/markostanimirovic\",\n+    \"bio\": \"Marko is a core member of the NgRx team, a Google Developer Expert in Angular, and an organizer of the Angular Belgrade group. He enjoys contributing to open source software, sharing knowledge through technical articles and talks, and playing guitar. He is also a Master of Science in Software Engineering from the University of Belgrade.\",\n+    \"groups\": [\"GDE\"]\n+  },\n   \"marsibarsi\": {\n     \"name\": \"Roman Sedov\",\n     \"picture\": \"sedov.jpg\",\n\n\n###\n\n", "completion": "docs: add Marko to GDE resources (#<issue-num>)"}
{"prompt": " file path A: aio/content/errors/NG1003.md | file path B: aio/content/errors/NG1003.md\n\n@@ -7,7 +7,7 @@ Async validators must return a promise or an observable, and emit/resolve them w\n \n ```typescript\n export function isTenAsync(control: AbstractControl): \n-  Observable<ValidationErrors> | null {\n+  Observable<ValidationErrors | null> {\n     const v: number = control.value;\n     if (v !== 10) {\n     // Emit an object with a validation error.\n@@ -27,4 +27,4 @@ Did you mistakenly use a synchronous validator instead of an async validator?\n \n <!-- end links -->\n \n-@reviewed 2022-06-28\n\\ No newline at end of file\n+@reviewed 2022-06-28\n\n\n###\n\n", "completion": "docs: fixed typo in AsyncValidatorFn (#<issue-num>)"}
{"prompt": " file path A: packages/forms/src/model/abstract_model.ts | file path B: packages/forms/src/model/abstract_model.ts\n\n@@ -1109,6 +1109,11 @@ export abstract class AbstractControl<TValue = any, TRawValue extends TValue = T\n    *\n    * Calling `setErrors` also updates the validity of the parent control.\n    *\n+   * @param opts Configuration options that determine how the control propagates\n+   * changes and emits events after the control errors are set.\n+   * * `emitEvent`: When true or not supplied (the default), the `statusChanges`\n+   * observable emits an event after the errors are set.\n+   *\n    * @usageNotes\n    *\n    * ### Manually set the errors for a control\n\n\n###\n\n", "completion": "docs(forms): setErrors emitEvent default value (#<issue-num>)"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -54,7 +54,6 @@\n # =========================================================\n #  Used for approving minor documentation-only changes that don't require engineering review.\n #\n-# gkalpak\n # josmar-crwdstffng\n # ileil\n # TeriGlover\n@@ -177,7 +176,6 @@ groups:\n     reviewers:\n       users:\n         - alxhub\n-        - gkalpak\n         - JoostK\n \n   # =========================================================\n@@ -438,7 +436,6 @@ groups:\n         - andrewseguin\n         - atscott\n         - dylhunn\n-        - gkalpak\n         - jessicajaniuk\n         - pkozlowski-opensource\n \n@@ -589,7 +586,6 @@ groups:\n     reviewers:\n       users:\n         - alxhub\n-        - gkalpak\n \n   # =========================================================\n   #  Framework: Upgrade\n@@ -617,7 +613,6 @@ groups:\n     reviewers:\n       users:\n         - alxhub\n-        - gkalpak\n         - jessicajaniuk\n \n   # =========================================================\n@@ -1092,7 +1087,6 @@ groups:\n     reviewers:\n       users:\n         - AndrewKushnir\n-        - gkalpak\n         - jessicajaniuk\n         - josephperrott\n \n@@ -1159,7 +1153,6 @@ groups:\n     reviewers:\n       users:\n         - devversion\n-        - gkalpak\n         - josephperrott\n \n   # =========================================================\n@@ -1357,7 +1350,6 @@ groups:\n         - dgp1130 # Doug Parker\n         - dylhunn # Dylan Hunn\n         - filipesilva # Filipe Silva\n-        - gkalpak # Georgios Kalpakas\n         - jelbourn # Jeremy Elbourn\n         - jessicajaniuk # Jessica Janiuk\n         - JiaLiPassion # Jia Li\n\n\n###\n\n", "completion": "ci: cleanup PullApprove config file (#<issue-num>)"}
{"prompt": " file path A: packages/common/http/src/module.ts | file path B: packages/common/http/src/module.ts\n\n@@ -101,9 +101,6 @@ export class HttpClientModule {\n  * Without this module, Jsonp requests reach the backend\n  * with method JSONP, where they are rejected.\n  *\n- * You can add interceptors to the chain behind `HttpClient` by binding them to the\n- * multiprovider for built-in [DI token](guide/glossary#di-token) `HTTP_INTERCEPTORS`.\n- *\n  * @publicApi\n  */\n @NgModule({\n\n\n###\n\n", "completion": "docs(http): fix copy-paste error in HttpClientJsonpModule docs (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/http/index.md | file path B: goldens/public-api/common/http/index.md\n\n@@ -1746,7 +1746,9 @@ export enum HttpFeatureKind {\n     // (undocumented)\n     LegacyInterceptors = 1,\n     // (undocumented)\n-    NoXsrfProtection = 3\n+    NoXsrfProtection = 3,\n+    // (undocumented)\n+    RequestsMadeViaParent = 5\n }\n \n // @public\n@@ -2174,6 +2176,9 @@ export function withLegacyInterceptors(): HttpFeature<HttpFeatureKind.LegacyInte\n // @public (undocumented)\n export function withNoXsrfProtection(): HttpFeature<HttpFeatureKind.NoXsrfProtection>;\n \n+// @public (undocumented)\n+export function withRequestsMadeViaParent(): HttpFeature<HttpFeatureKind.RequestsMadeViaParent>;\n+\n // @public (undocumented)\n export function withXsrfConfiguration({ cookieName, headerName }: {\n     cookieName?: string;\n\n---\n file path A: packages/common/http/public_api.ts | file path B: packages/common/http/public_api.ts\n\n@@ -35,7 +35,7 @@ export {HTTP_INTERCEPTORS, HttpInterceptor, HttpInterceptorHandler as \u0275HttpInte\n export {JsonpClientBackend, JsonpInterceptor} from './src/jsonp';\n export {HttpClientJsonpModule, HttpClientModule, HttpClientXsrfModule} from './src/module';\n export {HttpParameterCodec, HttpParams, HttpParamsOptions, HttpUrlEncodingCodec} from './src/params';\n-export {HttpFeature, HttpFeatureKind, provideHttpClient, withJsonpSupport, withLegacyInterceptors, withNoXsrfProtection, withXsrfConfiguration, withInterceptors} from './src/provider';\n+export {HttpFeature, HttpFeatureKind, provideHttpClient, withJsonpSupport, withLegacyInterceptors, withNoXsrfProtection, withXsrfConfiguration, withInterceptors, withRequestsMadeViaParent} from './src/provider';\n export {HttpRequest} from './src/request';\n export {HttpDownloadProgressEvent, HttpErrorResponse, HttpEvent, HttpEventType, HttpHeaderResponse, HttpProgressEvent, HttpResponse, HttpResponseBase, HttpSentEvent, HttpStatusCode, HttpUploadProgressEvent, HttpUserEvent} from './src/response';\n export {HttpXhrBackend} from './src/xhr';\n\n---\n file path A: packages/common/http/src/provider.ts | file path B: packages/common/http/src/provider.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {InjectionToken, Provider} from '@angular/core';\n+import {inject, InjectionToken, Provider} from '@angular/core';\n \n import {HttpBackend, HttpHandler} from './backend';\n import {HttpClient} from './client';\n@@ -21,6 +21,7 @@ export enum HttpFeatureKind {\n   CustomXsrfConfiguration,\n   NoXsrfProtection,\n   JsonpSupport,\n+  RequestsMadeViaParent,\n }\n \n export interface HttpFeature<KindT extends HttpFeatureKind> {\n@@ -133,3 +134,22 @@ export function withJsonpSupport(): HttpFeature<HttpFeatureKind.JsonpSupport> {\n     {provide: HTTP_INTERCEPTOR_FNS, useValue: jsonpInterceptorFn, multi: true},\n   ]);\n }\n+\n+/**\n+ * @developerPreview\n+ */\n+export function withRequestsMadeViaParent(): HttpFeature<HttpFeatureKind.RequestsMadeViaParent> {\n+  return makeHttpFeature(HttpFeatureKind.RequestsMadeViaParent, [\n+    {\n+      provide: HttpBackend,\n+      useFactory: () => {\n+        const handlerFromParent = inject(HttpHandler, {skipSelf: true, optional: true});\n+        if (ngDevMode && handlerFromParent === null) {\n+          throw new Error(\n+              'withRequestsMadeViaParent() can only be used when the parent injector also configures HttpClient');\n+        }\n+        return handlerFromParent;\n+      },\n+    },\n+  ]);\n+}\n\n---\n file path A: packages/common/http/test/provider_spec.ts | file path B: packages/common/http/test/provider_spec.ts\n\n@@ -6,15 +6,15 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {DOCUMENT} from '@angular/common';\n+import {DOCUMENT, XhrFactory} from '@angular/common';\n import {HTTP_INTERCEPTORS, HttpClient, HttpClientModule, HttpEvent, HttpHandler, HttpInterceptor, HttpRequest, JsonpClientBackend} from '@angular/common/http';\n-import {HttpTestingController, provideHttpClientTesting} from '@angular/common/http/testing';\n-import {inject, InjectionToken, PLATFORM_ID, Provider} from '@angular/core';\n+import {HttpClientTestingModule, HttpTestingController, provideHttpClientTesting} from '@angular/common/http/testing';\n+import {createEnvironmentInjector, EnvironmentInjector, inject, InjectionToken, PLATFORM_ID, Provider} from '@angular/core';\n import {TestBed} from '@angular/core/testing';\n import {EMPTY, Observable} from 'rxjs';\n \n import {HttpInterceptorFn} from '../src/interceptor';\n-import {provideHttpClient, withInterceptors, withJsonpSupport, withLegacyInterceptors, withNoXsrfProtection, withXsrfConfiguration} from '../src/provider';\n+import {provideHttpClient, withInterceptors, withJsonpSupport, withLegacyInterceptors, withNoXsrfProtection, withRequestsMadeViaParent, withXsrfConfiguration} from '../src/provider';\n \n describe('provideHttp', () => {\n   beforeEach(() => {\n@@ -272,6 +272,100 @@ describe('provideHttp', () => {\n     });\n   });\n \n+  describe('withRequestsMadeViaParent()', () => {\n+    it('should have independent HTTP setups if not explicitly specified', async () => {\n+      TestBed.configureTestingModule({\n+        providers: [\n+          provideHttpClient(),\n+          provideHttpClientTesting(),\n+        ],\n+      });\n+\n+      const child = createEnvironmentInjector(\n+          [\n+            provideHttpClient(), {\n+              provide: XhrFactory,\n+              useValue: {\n+                build: () => {\n+                  throw new Error('Request reached the \"backend\".');\n+                },\n+              },\n+            }\n+          ],\n+          TestBed.inject(EnvironmentInjector));\n+\n+      // Because `child` is an entirely independent HTTP context, it is not connected to the\n+      // HTTP testing backend from the parent injector, and requests attempted via the child's\n+      // `HttpClient` will fail.\n+      await expectAsync(child.get(HttpClient).get('/test').toPromise()).toBeRejected();\n+    });\n+\n+    it('should connect child to parent configuration if specified', () => {\n+      TestBed.configureTestingModule({\n+        providers: [\n+          provideHttpClient(),\n+          provideHttpClientTesting(),\n+        ],\n+      });\n+\n+      const child = createEnvironmentInjector(\n+          [provideHttpClient(withRequestsMadeViaParent())], TestBed.inject(EnvironmentInjector));\n+\n+\n+      // `child` is now to the parent HTTP context and therefore the testing backend, and so a\n+      // request made via its `HttpClient` can be made.\n+      child.get(HttpClient).get('/test', {responseType: 'text'}).subscribe();\n+      const req = TestBed.inject(HttpTestingController).expectOne('/test');\n+      req.flush('');\n+    });\n+\n+    it('should include interceptors from both parent and child contexts', () => {\n+      TestBed.configureTestingModule({\n+        providers: [\n+          provideHttpClient(withInterceptors([makeLiteralTagInterceptorFn('parent')])),\n+          provideHttpClientTesting(),\n+        ],\n+      });\n+\n+      const child = createEnvironmentInjector(\n+          [provideHttpClient(\n+              withRequestsMadeViaParent(),\n+              withInterceptors([makeLiteralTagInterceptorFn('child')]),\n+              )],\n+          TestBed.inject(EnvironmentInjector));\n+\n+\n+      child.get(HttpClient).get('/test', {responseType: 'text'}).subscribe();\n+      const req = TestBed.inject(HttpTestingController).expectOne('/test');\n+      expect(req.request.headers.get('X-Tag')).toEqual('child,parent');\n+      req.flush('');\n+    });\n+\n+    it('should be able to connect to a legacy-provided HttpClient context', () => {\n+      TestBed.configureTestingModule({\n+        imports: [\n+          HttpClientTestingModule,\n+        ],\n+        providers: [\n+          provideLegacyInterceptor('parent'),\n+        ],\n+      });\n+\n+      const child = createEnvironmentInjector(\n+          [provideHttpClient(\n+              withRequestsMadeViaParent(),\n+              withInterceptors([makeLiteralTagInterceptorFn('child')]),\n+              )],\n+          TestBed.inject(EnvironmentInjector));\n+\n+\n+      child.get(HttpClient).get('/test', {responseType: 'text'}).subscribe();\n+      const req = TestBed.inject(HttpTestingController).expectOne('/test');\n+      expect(req.request.headers.get('X-Tag')).toEqual('child,parent');\n+      req.flush('');\n+    });\n+  });\n+\n   describe('compatibility with Http NgModules', () => {\n     it('should function when configuring HTTP both ways in the same injector', () => {\n       TestBed.configureTestingModule({\n\n\n###\n\n", "completion": "feat(http): allow for child `HttpClient`s to request via parents (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/http/index.md | file path B: goldens/public-api/common/http/index.md\n\n@@ -1738,13 +1738,15 @@ export interface HttpFeature<KindT extends HttpFeatureKind> {\n // @public (undocumented)\n export enum HttpFeatureKind {\n     // (undocumented)\n-    CustomXsrfConfiguration = 1,\n+    CustomXsrfConfiguration = 2,\n     // (undocumented)\n-    JsonpSupport = 3,\n+    Interceptors = 0,\n     // (undocumented)\n-    LegacyInterceptors = 0,\n+    JsonpSupport = 4,\n     // (undocumented)\n-    NoXsrfProtection = 2\n+    LegacyInterceptors = 1,\n+    // (undocumented)\n+    NoXsrfProtection = 3\n }\n \n // @public\n@@ -1753,6 +1755,9 @@ export abstract class HttpHandler {\n     abstract handle(req: HttpRequest<any>): Observable<HttpEvent<any>>;\n }\n \n+// @public\n+export type HttpHandlerFn = (req: HttpRequest<unknown>) => Observable<HttpEvent<unknown>>;\n+\n // @public\n export class HttpHeaderResponse extends HttpResponseBase {\n     constructor(init?: {\n@@ -1790,6 +1795,9 @@ export interface HttpInterceptor {\n     intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>>;\n }\n \n+// @public\n+export type HttpInterceptorFn = (req: HttpRequest<unknown>, next: HttpHandlerFn) => Observable<HttpEvent<unknown>>;\n+\n // @public\n export interface HttpParameterCodec {\n     // (undocumented)\n@@ -2154,6 +2162,9 @@ export class JsonpInterceptor {\n // @public (undocumented)\n export function provideHttpClient(...features: HttpFeature<HttpFeatureKind>[]): Provider[];\n \n+// @public (undocumented)\n+export function withInterceptors(interceptorFns: HttpInterceptorFn[]): HttpFeature<HttpFeatureKind.Interceptors>;\n+\n // @public (undocumented)\n export function withJsonpSupport(): HttpFeature<HttpFeatureKind.JsonpSupport>;\n \n\n---\n file path A: packages/common/http/public_api.ts | file path B: packages/common/http/public_api.ts\n\n@@ -31,11 +31,11 @@ export {HttpBackend, HttpHandler} from './src/backend';\n export {HttpClient} from './src/client';\n export {HttpContext, HttpContextToken} from './src/context';\n export {HttpHeaders} from './src/headers';\n-export {HTTP_INTERCEPTORS, HttpInterceptor, HttpInterceptorHandler as \u0275HttpInterceptorHandler} from './src/interceptor';\n+export {HTTP_INTERCEPTORS, HttpInterceptor, HttpInterceptorHandler as \u0275HttpInterceptorHandler, HttpInterceptorFn, HttpHandlerFn} from './src/interceptor';\n export {JsonpClientBackend, JsonpInterceptor} from './src/jsonp';\n export {HttpClientJsonpModule, HttpClientModule, HttpClientXsrfModule} from './src/module';\n export {HttpParameterCodec, HttpParams, HttpParamsOptions, HttpUrlEncodingCodec} from './src/params';\n-export {HttpFeature, HttpFeatureKind, provideHttpClient, withJsonpSupport, withLegacyInterceptors, withNoXsrfProtection, withXsrfConfiguration} from './src/provider';\n+export {HttpFeature, HttpFeatureKind, provideHttpClient, withJsonpSupport, withLegacyInterceptors, withNoXsrfProtection, withXsrfConfiguration, withInterceptors} from './src/provider';\n export {HttpRequest} from './src/request';\n export {HttpDownloadProgressEvent, HttpErrorResponse, HttpEvent, HttpEventType, HttpHeaderResponse, HttpProgressEvent, HttpResponse, HttpResponseBase, HttpSentEvent, HttpStatusCode, HttpUploadProgressEvent, HttpUserEvent} from './src/response';\n export {HttpXhrBackend} from './src/xhr';\n\n---\n file path A: packages/common/http/src/provider.ts | file path B: packages/common/http/src/provider.ts\n\n@@ -11,11 +11,12 @@ import {InjectionToken, Provider} from '@angular/core';\n import {HttpBackend, HttpHandler} from './backend';\n import {HttpClient} from './client';\n import {HTTP_INTERCEPTOR_FNS, HttpInterceptorFn, HttpInterceptorHandler, legacyInterceptorFnFactory} from './interceptor';\n-import {JsonpCallbackContext, jsonpCallbackContext, JsonpClientBackend, jsonpInterceptorFn} from './jsonp';\n+import {jsonpCallbackContext, JsonpCallbackContext, JsonpClientBackend, jsonpInterceptorFn} from './jsonp';\n import {HttpXhrBackend} from './xhr';\n import {HttpXsrfCookieExtractor, HttpXsrfTokenExtractor, XSRF_COOKIE_NAME, XSRF_ENABLED, XSRF_HEADER_NAME, xsrfInterceptorFn} from './xsrf';\n \n export enum HttpFeatureKind {\n+  Interceptors,\n   LegacyInterceptors,\n   CustomXsrfConfiguration,\n   NoXsrfProtection,\n@@ -70,6 +71,17 @@ export function provideHttpClient(...features: HttpFeature<HttpFeatureKind>[]):\n   return providers;\n }\n \n+export function withInterceptors(interceptorFns: HttpInterceptorFn[]):\n+    HttpFeature<HttpFeatureKind.Interceptors> {\n+  return makeHttpFeature(HttpFeatureKind.Interceptors, interceptorFns.map(interceptorFn => {\n+    return {\n+      provide: HTTP_INTERCEPTOR_FNS,\n+      useValue: interceptorFn,\n+      multi: true,\n+    };\n+  }));\n+}\n+\n const LEGACY_INTERCEPTOR_FN = new InjectionToken<HttpInterceptorFn>('LEGACY_INTERCEPTOR_FN');\n \n export function withLegacyInterceptors(): HttpFeature<HttpFeatureKind.LegacyInterceptors> {\n\n---\n file path A: packages/common/http/test/provider_spec.ts | file path B: packages/common/http/test/provider_spec.ts\n\n@@ -9,11 +9,12 @@\n import {DOCUMENT} from '@angular/common';\n import {HTTP_INTERCEPTORS, HttpClient, HttpClientModule, HttpEvent, HttpHandler, HttpInterceptor, HttpRequest, JsonpClientBackend} from '@angular/common/http';\n import {HttpTestingController, provideHttpClientTesting} from '@angular/common/http/testing';\n-import {InjectionToken, PLATFORM_ID, Provider} from '@angular/core';\n+import {inject, InjectionToken, PLATFORM_ID, Provider} from '@angular/core';\n import {TestBed} from '@angular/core/testing';\n import {EMPTY, Observable} from 'rxjs';\n \n-import {provideHttpClient, withJsonpSupport, withLegacyInterceptors, withNoXsrfProtection, withXsrfConfiguration} from '../src/provider';\n+import {HttpInterceptorFn} from '../src/interceptor';\n+import {provideHttpClient, withInterceptors, withJsonpSupport, withLegacyInterceptors, withNoXsrfProtection, withXsrfConfiguration} from '../src/provider';\n \n describe('provideHttp', () => {\n   beforeEach(() => {\n@@ -77,6 +78,106 @@ describe('provideHttp', () => {\n     req.flush('');\n   });\n \n+  describe('interceptor functions', () => {\n+    it('should allow configuring interceptors', () => {\n+      TestBed.configureTestingModule({\n+        providers: [\n+          provideHttpClient(withInterceptors([\n+            makeLiteralTagInterceptorFn('alpha'),\n+            makeLiteralTagInterceptorFn('beta'),\n+          ])),\n+          provideHttpClientTesting(),\n+        ],\n+      });\n+\n+      TestBed.inject(HttpClient).get('/test', {responseType: 'text'}).subscribe();\n+      const req = TestBed.inject(HttpTestingController).expectOne('/test');\n+      expect(req.request.headers.get('X-Tag')).toEqual('alpha,beta');\n+      req.flush('');\n+    });\n+\n+    it('should accept multiple separate interceptor configs', () => {\n+      TestBed.configureTestingModule({\n+        providers: [\n+          provideHttpClient(\n+              withInterceptors([\n+                makeLiteralTagInterceptorFn('alpha'),\n+              ]),\n+              withInterceptors([\n+                makeLiteralTagInterceptorFn('beta'),\n+              ])),\n+          provideHttpClientTesting(),\n+        ],\n+      });\n+\n+      TestBed.inject(HttpClient).get('/test', {responseType: 'text'}).subscribe();\n+      const req = TestBed.inject(HttpTestingController).expectOne('/test');\n+      expect(req.request.headers.get('X-Tag')).toEqual('alpha,beta');\n+      req.flush('');\n+    });\n+\n+    it('should allow injection from an interceptor context', () => {\n+      const ALPHA =\n+          new InjectionToken<string>('alpha', {providedIn: 'root', factory: () => 'alpha'});\n+      const BETA = new InjectionToken<string>('beta', {providedIn: 'root', factory: () => 'beta'});\n+\n+      TestBed.configureTestingModule({\n+        providers: [\n+          provideHttpClient(withInterceptors([\n+            makeTokenTagInterceptorFn(ALPHA),\n+            makeTokenTagInterceptorFn(BETA),\n+          ])),\n+          provideHttpClientTesting(),\n+        ],\n+      });\n+\n+      TestBed.inject(HttpClient).get('/test', {responseType: 'text'}).subscribe();\n+      const req = TestBed.inject(HttpTestingController).expectOne('/test');\n+      expect(req.request.headers.get('X-Tag')).toEqual('alpha,beta');\n+      req.flush('');\n+    });\n+\n+    it('should allow combination with legacy interceptors, before the legacy stack', () => {\n+      TestBed.configureTestingModule({\n+        providers: [\n+          provideHttpClient(\n+              withInterceptors([\n+                makeLiteralTagInterceptorFn('functional'),\n+              ]),\n+              withLegacyInterceptors(),\n+              ),\n+          provideHttpClientTesting(),\n+          provideLegacyInterceptor('legacy'),\n+        ],\n+      });\n+\n+      TestBed.inject(HttpClient).get('/test', {responseType: 'text'}).subscribe();\n+      const req = TestBed.inject(HttpTestingController).expectOne('/test');\n+      expect(req.request.headers.get('X-Tag')).toEqual('functional,legacy');\n+      req.flush('');\n+    });\n+\n+    it('should allow combination with legacy interceptors, after the legacy stack', () => {\n+      TestBed.configureTestingModule({\n+        providers: [\n+          provideHttpClient(\n+              withLegacyInterceptors(),\n+              withInterceptors([\n+                makeLiteralTagInterceptorFn('functional'),\n+              ]),\n+              ),\n+          provideHttpClientTesting(),\n+          provideLegacyInterceptor('legacy'),\n+        ],\n+      });\n+\n+      TestBed.inject(HttpClient).get('/test', {responseType: 'text'}).subscribe();\n+      const req = TestBed.inject(HttpTestingController).expectOne('/test');\n+      expect(req.request.headers.get('X-Tag')).toEqual('legacy,functional');\n+      req.flush('');\n+    });\n+  });\n+\n   describe('xsrf protection', () => {\n     it('should enable xsrf protection by default', () => {\n       TestBed.configureTestingModule({\n@@ -224,6 +325,14 @@ function provideLegacyInterceptor(tag: string): Provider {\n   };\n }\n \n+function makeLiteralTagInterceptorFn(tag: string): HttpInterceptorFn {\n+  return (req, next) => next(addTagToRequest(req, tag));\n+}\n+\n+function makeTokenTagInterceptorFn(tag: InjectionToken<string>): HttpInterceptorFn {\n+  return (req, next) => next(addTagToRequest(req, inject(tag)));\n+}\n+\n function addTagToRequest(req: HttpRequest<unknown>, tag: string): HttpRequest<unknown> {\n   const prevTagHeader = req.headers.get('X-Tag') ?? '';\n   const tagHeader = (prevTagHeader.length > 0) ? prevTagHeader + ',' + tag : tag;\n\n\n###\n\n", "completion": "feat(http): introduce functional interceptors (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/http/index.md | file path B: goldens/public-api/common/http/index.md\n\n@@ -1654,7 +1654,7 @@ export class HttpClientModule {\n     // (undocumented)\n     static \u0275inj: i0.\u0275\u0275InjectorDeclaration<HttpClientModule>;\n     // (undocumented)\n-    static \u0275mod: i0.\u0275\u0275NgModuleDeclaration<HttpClientModule, never, [typeof HttpClientXsrfModule], never>;\n+    static \u0275mod: i0.\u0275\u0275NgModuleDeclaration<HttpClientModule, never, never, never>;\n }\n \n // @public\n\n---\n file path A: packages/common/http/src/interceptor.ts | file path B: packages/common/http/src/interceptor.ts\n\n@@ -170,8 +170,6 @@ export function legacyInterceptorFnFactory(): HttpInterceptorFn {\n   };\n }\n \n-export const LEGACY_INTERCEPTOR_FN = new InjectionToken<HttpInterceptorFn>('LEGACY_INTERCEPTOR_FN');\n-\n @Injectable()\n export class HttpInterceptorHandler extends HttpHandler {\n   private chain: ChainedInterceptorFn<unknown>|null = null;\n\n---\n file path A: packages/common/http/src/module.ts | file path B: packages/common/http/src/module.ts\n\n@@ -8,12 +8,9 @@\n \n import {ModuleWithProviders, NgModule} from '@angular/core';\n \n-import {HttpBackend, HttpHandler} from './backend';\n-import {HttpClient} from './client';\n-import {HTTP_INTERCEPTOR_FNS, HTTP_INTERCEPTORS, HttpInterceptorHandler, LEGACY_INTERCEPTOR_FN, legacyInterceptorFnFactory} from './interceptor';\n-import {jsonpCallbackContext, JsonpCallbackContext, JsonpClientBackend, jsonpInterceptorFn} from './jsonp';\n-import {HttpXhrBackend} from './xhr';\n-import {HttpXsrfCookieExtractor, HttpXsrfInterceptor, HttpXsrfTokenExtractor, XSRF_COOKIE_NAME, XSRF_DEFAULT_COOKIE_NAME, XSRF_DEFAULT_HEADER_NAME, XSRF_ENABLED, XSRF_HEADER_NAME} from './xsrf';\n+import {HTTP_INTERCEPTORS} from './interceptor';\n+import {provideHttpClient, withJsonpSupport, withLegacyInterceptors, withNoXsrfProtection, withXsrfConfiguration} from './provider';\n+import {HttpXsrfCookieExtractor, HttpXsrfInterceptor, HttpXsrfTokenExtractor, XSRF_DEFAULT_COOKIE_NAME, XSRF_DEFAULT_HEADER_NAME, XSRF_ENABLED} from './xsrf';\n \n /**\n  * Configures XSRF protection support for outgoing requests.\n@@ -32,8 +29,10 @@ import {HttpXsrfCookieExtractor, HttpXsrfInterceptor, HttpXsrfTokenExtractor, XS\n     HttpXsrfInterceptor,\n     {provide: HTTP_INTERCEPTORS, useExisting: HttpXsrfInterceptor, multi: true},\n     {provide: HttpXsrfTokenExtractor, useClass: HttpXsrfCookieExtractor},\n-    {provide: XSRF_COOKIE_NAME, useValue: XSRF_DEFAULT_COOKIE_NAME},\n-    {provide: XSRF_HEADER_NAME, useValue: XSRF_DEFAULT_HEADER_NAME},\n+    withXsrfConfiguration({\n+      cookieName: XSRF_DEFAULT_COOKIE_NAME,\n+      headerName: XSRF_DEFAULT_HEADER_NAME,\n+    }).\u0275providers,\n     {provide: XSRF_ENABLED, useValue: true},\n   ],\n })\n@@ -45,7 +44,7 @@ export class HttpClientXsrfModule {\n     return {\n       ngModule: HttpClientXsrfModule,\n       providers: [\n-        {provide: XSRF_ENABLED, useValue: false},\n+        withNoXsrfProtection().\u0275providers,\n       ],\n     };\n   }\n@@ -64,10 +63,7 @@ export class HttpClientXsrfModule {\n   } = {}): ModuleWithProviders<HttpClientXsrfModule> {\n     return {\n       ngModule: HttpClientXsrfModule,\n-      providers: [\n-        options.cookieName ? {provide: XSRF_COOKIE_NAME, useValue: options.cookieName} : [],\n-        options.headerName ? {provide: XSRF_HEADER_NAME, useValue: options.headerName} : [],\n-      ],\n+      providers: withXsrfConfiguration(options).\u0275providers,\n     };\n   }\n }\n@@ -82,31 +78,18 @@ export class HttpClientXsrfModule {\n  * @publicApi\n  */\n @NgModule({\n-  /**\n-   * Optional configuration for XSRF protection.\n-   */\n-  imports: [\n-    HttpClientXsrfModule.withOptions({\n-      cookieName: XSRF_DEFAULT_COOKIE_NAME,\n-      headerName: XSRF_DEFAULT_HEADER_NAME,\n-    }),\n-  ],\n   /**\n    * Configures the [dependency injector](guide/glossary#injector) where it is imported\n    * with supporting services for HTTP communications.\n    */\n   providers: [\n-    HttpClient,\n-    HttpXhrBackend,\n-    HttpInterceptorHandler,\n-    {provide: HttpHandler, useExisting: HttpInterceptorHandler},\n-    {provide: HttpBackend, useExisting: HttpXhrBackend},\n-    {provide: LEGACY_INTERCEPTOR_FN, useFactory: legacyInterceptorFnFactory},\n-    {\n-      provide: HTTP_INTERCEPTOR_FNS,\n-      useExisting: LEGACY_INTERCEPTOR_FN,\n-      multi: true,\n-    },\n+    provideHttpClient(\n+        withLegacyInterceptors(),\n+        withXsrfConfiguration({\n+          cookieName: XSRF_DEFAULT_COOKIE_NAME,\n+          headerName: XSRF_DEFAULT_HEADER_NAME,\n+        }),\n+        ),\n   ],\n })\n export class HttpClientModule {\n@@ -125,9 +108,7 @@ export class HttpClientModule {\n  */\n @NgModule({\n   providers: [\n-    JsonpClientBackend,\n-    {provide: JsonpCallbackContext, useFactory: jsonpCallbackContext},\n-    {provide: HTTP_INTERCEPTOR_FNS, useValue: jsonpInterceptorFn, multi: true},\n+    withJsonpSupport().\u0275providers,\n   ],\n })\n export class HttpClientJsonpModule {\n\n---\n file path A: packages/common/http/src/provider.ts | file path B: packages/common/http/src/provider.ts\n\n@@ -6,11 +6,11 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Provider} from '@angular/core';\n+import {InjectionToken, Provider} from '@angular/core';\n \n import {HttpBackend, HttpHandler} from './backend';\n import {HttpClient} from './client';\n-import {HTTP_INTERCEPTOR_FNS, HttpInterceptorHandler, LEGACY_INTERCEPTOR_FN, legacyInterceptorFnFactory} from './interceptor';\n+import {HTTP_INTERCEPTOR_FNS, HttpInterceptorFn, HttpInterceptorHandler, legacyInterceptorFnFactory} from './interceptor';\n import {JsonpCallbackContext, jsonpCallbackContext, JsonpClientBackend, jsonpInterceptorFn} from './jsonp';\n import {HttpXhrBackend} from './xhr';\n import {HttpXsrfCookieExtractor, HttpXsrfTokenExtractor, XSRF_COOKIE_NAME, XSRF_ENABLED, XSRF_HEADER_NAME, xsrfInterceptorFn} from './xsrf';\n@@ -70,6 +70,8 @@ export function provideHttpClient(...features: HttpFeature<HttpFeatureKind>[]):\n   return providers;\n }\n \n+const LEGACY_INTERCEPTOR_FN = new InjectionToken<HttpInterceptorFn>('LEGACY_INTERCEPTOR_FN');\n+\n export function withLegacyInterceptors(): HttpFeature<HttpFeatureKind.LegacyInterceptors> {\n   // Note: the legacy interceptor function is provided here via an intermediate token\n   // (`LEGACY_INTERCEPTOR_FN`), using a pattern which guarantees that if these providers are\n\n\n###\n\n", "completion": "refactor(http): convert NgModules to use `provideHttpClient` internally (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/http/index.md | file path B: goldens/public-api/common/http/index.md\n\n@@ -9,6 +9,7 @@ import * as i0 from '@angular/core';\n import { InjectionToken } from '@angular/core';\n import { ModuleWithProviders } from '@angular/core';\n import { Observable } from 'rxjs';\n+import { Provider } from '@angular/core';\n import { XhrFactory as XhrFactory_2 } from '@angular/common';\n \n // @public\n@@ -1726,6 +1727,26 @@ export enum HttpEventType {\n     User = 5\n }\n \n+// @public (undocumented)\n+export interface HttpFeature<KindT extends HttpFeatureKind> {\n+    // (undocumented)\n+    \u0275kind: KindT;\n+    // (undocumented)\n+    \u0275providers: Provider[];\n+}\n+\n+// @public (undocumented)\n+export enum HttpFeatureKind {\n+    // (undocumented)\n+    CustomXsrfConfiguration = 1,\n+    // (undocumented)\n+    JsonpSupport = 3,\n+    // (undocumented)\n+    LegacyInterceptors = 0,\n+    // (undocumented)\n+    NoXsrfProtection = 2\n+}\n+\n // @public\n export abstract class HttpHandler {\n     // (undocumented)\n@@ -2130,6 +2151,24 @@ export class JsonpInterceptor {\n     static \u0275prov: i0.\u0275\u0275InjectableDeclaration<JsonpInterceptor>;\n }\n \n+// @public (undocumented)\n+export function provideHttpClient(...features: HttpFeature<HttpFeatureKind>[]): Provider[];\n+\n+// @public (undocumented)\n+export function withJsonpSupport(): HttpFeature<HttpFeatureKind.JsonpSupport>;\n+\n+// @public (undocumented)\n+export function withLegacyInterceptors(): HttpFeature<HttpFeatureKind.LegacyInterceptors>;\n+\n+// @public (undocumented)\n+export function withNoXsrfProtection(): HttpFeature<HttpFeatureKind.NoXsrfProtection>;\n+\n+// @public (undocumented)\n+export function withXsrfConfiguration({ cookieName, headerName }: {\n+    cookieName?: string;\n+    headerName?: string;\n+}): HttpFeature<HttpFeatureKind.CustomXsrfConfiguration>;\n+\n // @public @deprecated\n export type XhrFactory = XhrFactory_2;\n \n\n---\n file path A: packages/common/http/public_api.ts | file path B: packages/common/http/public_api.ts\n\n@@ -35,6 +35,7 @@ export {HTTP_INTERCEPTORS, HttpInterceptor, HttpInterceptorHandler as \u0275HttpInte\n export {JsonpClientBackend, JsonpInterceptor} from './src/jsonp';\n export {HttpClientJsonpModule, HttpClientModule, HttpClientXsrfModule} from './src/module';\n export {HttpParameterCodec, HttpParams, HttpParamsOptions, HttpUrlEncodingCodec} from './src/params';\n+export {HttpFeature, HttpFeatureKind, provideHttpClient, withJsonpSupport, withLegacyInterceptors, withNoXsrfProtection, withXsrfConfiguration} from './src/provider';\n export {HttpRequest} from './src/request';\n export {HttpDownloadProgressEvent, HttpErrorResponse, HttpEvent, HttpEventType, HttpHeaderResponse, HttpProgressEvent, HttpResponse, HttpResponseBase, HttpSentEvent, HttpStatusCode, HttpUploadProgressEvent, HttpUserEvent} from './src/response';\n export {HttpXhrBackend} from './src/xhr';\n\n---\n file path A: packages/common/http/src/module.ts | file path B: packages/common/http/src/module.ts\n\n@@ -97,8 +97,9 @@ export class HttpClientXsrfModule {\n    */\n   providers: [\n     HttpClient,\n-    {provide: HttpHandler, useClass: HttpInterceptorHandler},\n     HttpXhrBackend,\n+    HttpInterceptorHandler,\n+    {provide: HttpHandler, useExisting: HttpInterceptorHandler},\n     {provide: HttpBackend, useExisting: HttpXhrBackend},\n     {provide: LEGACY_INTERCEPTOR_FN, useFactory: legacyInterceptorFnFactory},\n     {\n\n---\n file path A: None | file path B: packages/common/http/src/provider.ts\n\n@@ -0,0 +1,121 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Provider} from '@angular/core';\n+\n+import {HttpBackend, HttpHandler} from './backend';\n+import {HttpClient} from './client';\n+import {HTTP_INTERCEPTOR_FNS, HttpInterceptorHandler, LEGACY_INTERCEPTOR_FN, legacyInterceptorFnFactory} from './interceptor';\n+import {JsonpCallbackContext, jsonpCallbackContext, JsonpClientBackend, jsonpInterceptorFn} from './jsonp';\n+import {HttpXhrBackend} from './xhr';\n+import {HttpXsrfCookieExtractor, HttpXsrfTokenExtractor, XSRF_COOKIE_NAME, XSRF_ENABLED, XSRF_HEADER_NAME, xsrfInterceptorFn} from './xsrf';\n+\n+export enum HttpFeatureKind {\n+  LegacyInterceptors,\n+  CustomXsrfConfiguration,\n+  NoXsrfProtection,\n+  JsonpSupport,\n+}\n+\n+export interface HttpFeature<KindT extends HttpFeatureKind> {\n+  \u0275kind: KindT;\n+  \u0275providers: Provider[];\n+}\n+\n+function makeHttpFeature<KindT extends HttpFeatureKind>(\n+    kind: KindT, providers: Provider[]): HttpFeature<KindT> {\n+  return {\n+    \u0275kind: kind,\n+    \u0275providers: providers,\n+  };\n+}\n+\n+\n+export function provideHttpClient(...features: HttpFeature<HttpFeatureKind>[]): Provider[] {\n+  if (ngDevMode) {\n+    const featureKinds = new Set(features.map(f => f.\u0275kind));\n+    if (featureKinds.has(HttpFeatureKind.NoXsrfProtection) &&\n+        featureKinds.has(HttpFeatureKind.CustomXsrfConfiguration)) {\n+      throw new Error(\n+          ngDevMode ?\n+              `Configuration error: found both withXsrfConfiguration() and withNoXsrfProtection() in the same call to provideHttpClient(), which is a contradiction.` :\n+              '');\n+    }\n+  }\n+\n+  const providers: Provider[] = [\n+    HttpClient,\n+    HttpXhrBackend,\n+    HttpInterceptorHandler,\n+    {provide: HttpHandler, useExisting: HttpInterceptorHandler},\n+    {provide: HttpBackend, useExisting: HttpXhrBackend},\n+    {\n+      provide: HTTP_INTERCEPTOR_FNS,\n+      useValue: xsrfInterceptorFn,\n+      multi: true,\n+    },\n+    {provide: XSRF_ENABLED, useValue: true},\n+    {provide: HttpXsrfTokenExtractor, useClass: HttpXsrfCookieExtractor},\n+  ];\n+\n+  for (const feature of features) {\n+    providers.push(...feature.\u0275providers);\n+  }\n+\n+  return providers;\n+}\n+\n+export function withLegacyInterceptors(): HttpFeature<HttpFeatureKind.LegacyInterceptors> {\n+  // Note: the legacy interceptor function is provided here via an intermediate token\n+  // (`LEGACY_INTERCEPTOR_FN`), using a pattern which guarantees that if these providers are\n+  // included multiple times, all of the multi-provider entries will have the same instance of the\n+  // interceptor function. That way, the `HttpINterceptorHandler` will dedup them and legacy\n+  // interceptors will not run multiple times.\n+  return makeHttpFeature(HttpFeatureKind.LegacyInterceptors, [\n+    {\n+      provide: LEGACY_INTERCEPTOR_FN,\n+      useFactory: legacyInterceptorFnFactory,\n+    },\n+    {\n+      provide: HTTP_INTERCEPTOR_FNS,\n+      useExisting: LEGACY_INTERCEPTOR_FN,\n+      multi: true,\n+    }\n+  ]);\n+}\n+\n+export function withXsrfConfiguration(\n+    {cookieName, headerName}: {cookieName?: string, headerName?: string}):\n+    HttpFeature<HttpFeatureKind.CustomXsrfConfiguration> {\n+  const providers: Provider[] = [];\n+  if (cookieName !== undefined) {\n+    providers.push({provide: XSRF_COOKIE_NAME, useValue: cookieName});\n+  }\n+  if (headerName !== undefined) {\n+    providers.push({provide: XSRF_HEADER_NAME, useValue: headerName});\n+  }\n+\n+  return makeHttpFeature(HttpFeatureKind.CustomXsrfConfiguration, providers);\n+}\n+\n+export function withNoXsrfProtection(): HttpFeature<HttpFeatureKind.NoXsrfProtection> {\n+  return makeHttpFeature(HttpFeatureKind.NoXsrfProtection, [\n+    {\n+      provide: XSRF_ENABLED,\n+      useValue: false,\n+    },\n+  ]);\n+}\n+\n+export function withJsonpSupport(): HttpFeature<HttpFeatureKind.JsonpSupport> {\n+  return makeHttpFeature(HttpFeatureKind.JsonpSupport, [\n+    JsonpClientBackend,\n+    {provide: JsonpCallbackContext, useFactory: jsonpCallbackContext},\n+    {provide: HTTP_INTERCEPTOR_FNS, useValue: jsonpInterceptorFn, multi: true},\n+  ]);\n+}\n\n---\n file path A: None | file path B: packages/common/http/test/provider_spec.ts\n\n@@ -0,0 +1,243 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.sonpCallbackContext\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {DOCUMENT} from '@angular/common';\n+import {HTTP_INTERCEPTORS, HttpClient, HttpClientModule, HttpEvent, HttpHandler, HttpInterceptor, HttpRequest, JsonpClientBackend} from '@angular/common/http';\n+import {HttpTestingController, provideHttpClientTesting} from '@angular/common/http/testing';\n+import {InjectionToken, PLATFORM_ID, Provider} from '@angular/core';\n+import {TestBed} from '@angular/core/testing';\n+import {EMPTY, Observable} from 'rxjs';\n+\n+import {provideHttpClient, withJsonpSupport, withLegacyInterceptors, withNoXsrfProtection, withXsrfConfiguration} from '../src/provider';\n+\n+describe('provideHttp', () => {\n+  beforeEach(() => {\n+    setCookie('');\n+    TestBed.resetTestingModule();\n+  });\n+\n+  afterEach(() => {\n+    let controller: HttpTestingController;\n+    try {\n+      controller = TestBed.inject(HttpTestingController);\n+    } catch (err) {\n+      // A failure here means that TestBed wasn't successfully configured. Some tests intentionally\n+      // test configuration errors and therefore exit without setting up TestBed for HTTP, so just\n+      // exit here without performing verification on the `HttpTestingController` in that case.\n+      return;\n+    }\n+    controller.verify();\n+  });\n+\n+  it('should configure HttpClient', () => {\n+    TestBed.configureTestingModule({\n+      providers: [\n+        provideHttpClient(),\n+        provideHttpClientTesting(),\n+      ],\n+    });\n+\n+    TestBed.inject(HttpClient).get('/test', {responseType: 'text'}).subscribe();\n+    TestBed.inject(HttpTestingController).expectOne('/test').flush('');\n+  });\n+\n+  it('should not use legacy interceptors by default', () => {\n+    TestBed.configureTestingModule({\n+      providers: [\n+        provideHttpClient(),\n+        provideLegacyInterceptor('legacy'),\n+        provideHttpClientTesting(),\n+      ],\n+    });\n+\n+    TestBed.inject(HttpClient).get('/test', {responseType: 'text'}).subscribe();\n+    const req = TestBed.inject(HttpTestingController).expectOne('/test');\n+    expect(req.request.headers.has('X-Tag')).toBeFalse();\n+    req.flush('');\n+  });\n+\n+  it('withLegacyInterceptors() should enable legacy interceptors', () => {\n+    TestBed.configureTestingModule({\n+      providers: [\n+        provideHttpClient(withLegacyInterceptors()),\n+        provideLegacyInterceptor('alpha'),\n+        provideLegacyInterceptor('beta'),\n+        provideHttpClientTesting(),\n+      ],\n+    });\n+\n+    TestBed.inject(HttpClient).get('/test', {responseType: 'text'}).subscribe();\n+    const req = TestBed.inject(HttpTestingController).expectOne('/test');\n+    expect(req.request.headers.get('X-Tag')).toEqual('alpha,beta');\n+    req.flush('');\n+  });\n+\n+  describe('xsrf protection', () => {\n+    it('should enable xsrf protection by default', () => {\n+      TestBed.configureTestingModule({\n+        providers: [\n+          provideHttpClient(),\n+          provideHttpClientTesting(),\n+          {provide: PLATFORM_ID, useValue: 'test'},\n+        ],\n+      });\n+\n+      setXsrfToken('abcdefg');\n+\n+      TestBed.inject(HttpClient).post('/test', '', {responseType: 'text'}).subscribe();\n+      const req = TestBed.inject(HttpTestingController).expectOne('/test');\n+      expect(req.request.headers.get('X-XSRF-TOKEN')).toEqual('abcdefg');\n+      req.flush('');\n+    });\n+\n+    it('withXsrfConfiguration() should allow customization of xsrf config', () => {\n+      TestBed.configureTestingModule({\n+        providers: [\n+          provideHttpClient(withXsrfConfiguration(\n+              {cookieName: 'XSRF-CUSTOM-COOKIE', headerName: 'X-Custom-Xsrf-Header'})),\n+          provideHttpClientTesting(),\n+          {provide: PLATFORM_ID, useValue: 'test'},\n+        ],\n+      });\n+\n+      setCookie('XSRF-CUSTOM-COOKIE=abcdefg');\n+      TestBed.inject(HttpClient).post('/test', '', {responseType: 'text'}).subscribe();\n+      const req = TestBed.inject(HttpTestingController).expectOne('/test');\n+      expect(req.request.headers.get('X-Custom-Xsrf-Header')).toEqual('abcdefg');\n+      req.flush('');\n+    });\n+\n+    it('withNoXsrfProtection() should disable xsrf protection', () => {\n+      TestBed.configureTestingModule({\n+        providers: [\n+          provideHttpClient(withNoXsrfProtection()),\n+          provideHttpClientTesting(),\n+          {provide: PLATFORM_ID, useValue: 'test'},\n+        ],\n+      });\n+      setXsrfToken('abcdefg');\n+\n+      TestBed.inject(HttpClient).post('/test', '', {responseType: 'text'}).subscribe();\n+      const req = TestBed.inject(HttpTestingController).expectOne('/test');\n+      expect(req.request.headers.has('X-Custom-Xsrf-Header')).toBeFalse();\n+      req.flush('');\n+    });\n+\n+    it('should error if withXsrfConfiguration() and withNoXsrfProtection() are combined', () => {\n+      expect(() => {\n+        TestBed.configureTestingModule({\n+          providers: [\n+            provideHttpClient(withNoXsrfProtection(), withXsrfConfiguration({})),\n+            provideHttpClientTesting(),\n+            {provide: PLATFORM_ID, useValue: 'test'},\n+          ],\n+        });\n+      }).toThrow();\n+    });\n+  });\n+\n+  describe('JSONP support', () => {\n+    it('should not be enabled by default', () => {\n+      TestBed.configureTestingModule({\n+        providers: [\n+          provideHttpClient(),\n+          provideHttpClientTesting(),\n+        ],\n+      });\n+\n+      TestBed.inject(HttpClient).jsonp('/test', 'callback').subscribe();\n+\n+      // Because no JSONP interceptor should be registered, this request should go to the testing\n+      // backend.\n+      TestBed.inject(HttpTestingController).expectOne('/test?callback=JSONP_CALLBACK').flush('');\n+    });\n+\n+    it('should be enabled when using withJsonpSupport()', () => {\n+      TestBed.configureTestingModule({\n+        providers: [\n+          provideHttpClient(withJsonpSupport()),\n+          provideHttpClientTesting(),\n+          FAKE_JSONP_BACKEND_PROVIDER,\n+        ],\n+      });\n+\n+      TestBed.inject(HttpClient).jsonp('/test', 'callback').subscribe();\n+      TestBed.inject(HttpTestingController).expectNone('/test?callback=JSONP_CALLBACK');\n+    });\n+  });\n+\n+  describe('compatibility with Http NgModules', () => {\n+    it('should function when configuring HTTP both ways in the same injector', () => {\n+      TestBed.configureTestingModule({\n+        imports: [\n+          HttpClientModule,\n+        ],\n+        providers: [\n+          provideHttpClient(),\n+          // Interceptor support from HttpClientModule should be functional\n+          provideLegacyInterceptor('alpha'),\n+          provideLegacyInterceptor('beta'),\n+          provideHttpClientTesting(),\n+        ],\n+      });\n+\n+      TestBed.inject(HttpClient).get('/test', {responseType: 'text'}).subscribe();\n+      const req = TestBed.inject(HttpTestingController).expectOne('/test');\n+      expect(req.request.headers.get('X-Tag')).toEqual('alpha,beta');\n+      req.flush('');\n+    });\n+  });\n+});\n+\n+function setXsrfToken(token: string): void {\n+  setCookie(`XSRF-TOKEN=${token}`);\n+}\n+\n+function setCookie(cookie: string): void {\n+  Object.defineProperty(TestBed.inject(DOCUMENT), 'cookie', {\n+    get: () => cookie,\n+    configurable: true,\n+  });\n+}\n+\n+function provideLegacyInterceptor(tag: string): Provider {\n+  class LegacyTagInterceptor implements HttpInterceptor {\n+    intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n+      return next.handle(addTagToRequest(req, tag));\n+    }\n+  }\n+\n+  const token = new InjectionToken(`LegacyTagInterceptor[${tag}]`, {\n+    providedIn: 'root',\n+    factory: () => new LegacyTagInterceptor(),\n+  });\n+\n+  return {\n+    provide: HTTP_INTERCEPTORS,\n+    useExisting: token,\n+    multi: true,\n+  };\n+}\n+\n+function addTagToRequest(req: HttpRequest<unknown>, tag: string): HttpRequest<unknown> {\n+  const prevTagHeader = req.headers.get('X-Tag') ?? '';\n+  const tagHeader = (prevTagHeader.length > 0) ? prevTagHeader + ',' + tag : tag;\n+\n+  return req.clone({\n+    setHeaders: {\n+      'X-Tag': tagHeader,\n+    }\n+  });\n+}\n+\n+const FAKE_JSONP_BACKEND_PROVIDER = {\n+  provide: JsonpClientBackend,\n+  useValue: {\n+    handle: (req: HttpRequest<never>) => EMPTY,\n+  },\n+};\n\n\n###\n\n", "completion": "feat(http): introduce the `provideHttpClient()` API (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/http/testing/index.md | file path B: goldens/public-api/common/http/testing/index.md\n\n@@ -10,6 +10,7 @@ import { HttpRequest } from '@angular/common/http';\n import * as i0 from '@angular/core';\n import * as i1 from '@angular/common/http';\n import { Observer } from 'rxjs';\n+import { Provider } from '@angular/core';\n \n // @public\n export class HttpClientTestingModule {\n@@ -37,6 +38,9 @@ export abstract class HttpTestingController {\n     }): void;\n }\n \n+// @public (undocumented)\n+export function provideHttpClientTesting(): Provider[];\n+\n // @public\n export interface RequestMatch {\n     // (undocumented)\n\n---\n file path A: packages/common/http/testing/public_api.ts | file path B: packages/common/http/testing/public_api.ts\n\n@@ -8,4 +8,5 @@\n \n export {HttpTestingController, RequestMatch} from './src/api';\n export {HttpClientTestingModule} from './src/module';\n+export {provideHttpClientTesting} from './src/provider';\n export {TestRequest} from './src/request';\n\n---\n file path A: packages/common/http/testing/src/module.ts | file path B: packages/common/http/testing/src/module.ts\n\n@@ -6,11 +6,10 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {HttpBackend, HttpClientModule} from '@angular/common/http';\n+import {HttpClientModule} from '@angular/common/http';\n import {NgModule} from '@angular/core';\n \n-import {HttpTestingController} from './api';\n-import {HttpClientTestingBackend} from './backend';\n+import {provideHttpClientTesting} from './provider';\n \n \n /**\n@@ -25,9 +24,7 @@ import {HttpClientTestingBackend} from './backend';\n     HttpClientModule,\n   ],\n   providers: [\n-    HttpClientTestingBackend,\n-    {provide: HttpBackend, useExisting: HttpClientTestingBackend},\n-    {provide: HttpTestingController, useExisting: HttpClientTestingBackend},\n+    provideHttpClientTesting(),\n   ],\n })\n export class HttpClientTestingModule {\n\n---\n file path A: None | file path B: packages/common/http/testing/src/provider.ts\n\n@@ -0,0 +1,22 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {HttpBackend, HttpClientModule} from '@angular/common/http';\n+import {NgModule, Provider} from '@angular/core';\n+\n+import {HttpTestingController} from './api';\n+import {HttpClientTestingBackend} from './backend';\n+\n+\n+export function provideHttpClientTesting(): Provider[] {\n+  return [\n+    HttpClientTestingBackend,\n+    {provide: HttpBackend, useExisting: HttpClientTestingBackend},\n+    {provide: HttpTestingController, useExisting: HttpClientTestingBackend},\n+  ];\n+}\n\n\n###\n\n", "completion": "feat(http): introduce `provideHttpClientTesting` provider function (#<issue-num>)"}
{"prompt": " file path A: packages/common/http/src/xsrf.ts | file path B: packages/common/http/src/xsrf.ts\n\n@@ -7,11 +7,11 @@\n  */\n \n import {DOCUMENT, \u0275parseCookieValue as parseCookieValue} from '@angular/common';\n-import {Inject, Injectable, InjectionToken, PLATFORM_ID} from '@angular/core';\n+import {EnvironmentInjector, Inject, inject, Injectable, InjectionToken, PLATFORM_ID} from '@angular/core';\n import {Observable} from 'rxjs';\n \n import {HttpHandler} from './backend';\n-import {HttpInterceptor} from './interceptor';\n+import {HttpHandlerFn, HttpInterceptor} from './interceptor';\n import {HttpRequest} from './request';\n import {HttpEvent} from './response';\n \n@@ -74,32 +74,38 @@ export class HttpXsrfCookieExtractor implements HttpXsrfTokenExtractor {\n   }\n }\n \n+export function xsrfInterceptorFn(\n+    req: HttpRequest<unknown>, next: HttpHandlerFn): Observable<HttpEvent<unknown>> {\n+  const lcUrl = req.url.toLowerCase();\n+  // Skip both non-mutating requests and absolute URLs.\n+  // Non-mutating requests don't require a token, and absolute URLs require special handling\n+  // anyway as the cookie set\n+  // on our origin is not the same as the token expected by another origin.\n+  if (!inject(XSRF_ENABLED) || req.method === 'GET' || req.method === 'HEAD' ||\n+      lcUrl.startsWith('http://') || lcUrl.startsWith('https://')) {\n+    return next(req);\n+  }\n+\n+  const token = inject(HttpXsrfTokenExtractor).getToken();\n+  const headerName = inject(XSRF_HEADER_NAME);\n+\n+  // Be careful not to overwrite an existing header of the same name.\n+  if (token !== null && !req.headers.has(headerName)) {\n+    req = req.clone({headers: req.headers.set(headerName, token)});\n+  }\n+  return next(req);\n+}\n+\n /**\n  * `HttpInterceptor` which adds an XSRF token to eligible outgoing requests.\n  */\n @Injectable()\n export class HttpXsrfInterceptor implements HttpInterceptor {\n-  constructor(\n-      private tokenService: HttpXsrfTokenExtractor,\n-      @Inject(XSRF_HEADER_NAME) private headerName: string,\n-      @Inject(XSRF_ENABLED) private enabled: boolean) {}\n+  constructor(private injector: EnvironmentInjector) {}\n \n-  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n-    const lcUrl = req.url.toLowerCase();\n-    // Skip both non-mutating requests and absolute URLs.\n-    // Non-mutating requests don't require a token, and absolute URLs require special handling\n-    // anyway as the cookie set\n-    // on our origin is not the same as the token expected by another origin.\n-    if (!this.enabled || req.method === 'GET' || req.method === 'HEAD' ||\n-        lcUrl.startsWith('http://') || lcUrl.startsWith('https://')) {\n-      return next.handle(req);\n-    }\n-    const token = this.tokenService.getToken();\n-\n-    // Be careful not to overwrite an existing header of the same name.\n-    if (token !== null && !req.headers.has(this.headerName)) {\n-      req = req.clone({headers: req.headers.set(this.headerName, token)});\n-    }\n-    return next.handle(req);\n+  intercept(initialRequest: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n+    return this.injector.runInContext(\n+        () =>\n+            xsrfInterceptorFn(initialRequest, downstreamRequest => next.handle(downstreamRequest)));\n   }\n }\n\n---\n file path A: packages/common/http/test/xsrf_spec.ts | file path B: packages/common/http/test/xsrf_spec.ts\n\n@@ -8,8 +8,9 @@\n \n import {HttpHeaders} from '@angular/common/http/src/headers';\n import {HttpRequest} from '@angular/common/http/src/request';\n-import {HttpXsrfCookieExtractor, HttpXsrfInterceptor, HttpXsrfTokenExtractor} from '@angular/common/http/src/xsrf';\n+import {HttpXsrfCookieExtractor, HttpXsrfInterceptor, HttpXsrfTokenExtractor, XSRF_ENABLED, XSRF_HEADER_NAME} from '@angular/common/http/src/xsrf';\n import {HttpClientTestingBackend} from '@angular/common/http/testing/src/backend';\n+import {TestBed} from '@angular/core/testing';\n \n class SampleTokenExtractor extends HttpXsrfTokenExtractor {\n   constructor(private token: string|null) {\n@@ -24,9 +25,26 @@ class SampleTokenExtractor extends HttpXsrfTokenExtractor {\n {\n   describe('HttpXsrfInterceptor', () => {\n     let backend: HttpClientTestingBackend;\n-    const interceptor = new HttpXsrfInterceptor(\n-        new SampleTokenExtractor('test'), 'X-XSRF-TOKEN', /* enabled */ true);\n+    let interceptor: HttpXsrfInterceptor;\n     beforeEach(() => {\n+      TestBed.configureTestingModule({\n+        providers: [\n+          {\n+            provide: HttpXsrfTokenExtractor,\n+            useValue: new SampleTokenExtractor('test'),\n+          },\n+          {\n+            provide: XSRF_HEADER_NAME,\n+            useValue: 'X-XSRF-TOKEN',\n+          },\n+          {\n+            provide: XSRF_ENABLED,\n+            useValue: true,\n+          },\n+          HttpXsrfInterceptor,\n+        ],\n+      });\n+      interceptor = TestBed.inject(HttpXsrfInterceptor);\n       backend = new HttpClientTestingBackend();\n     });\n     it('applies XSRF protection to outgoing requests', () => {\n@@ -59,8 +77,25 @@ class SampleTokenExtractor extends HttpXsrfTokenExtractor {\n       req.flush({});\n     });\n     it('does not set the header for a null token', () => {\n-      const interceptor = new HttpXsrfInterceptor(\n-          new SampleTokenExtractor(null), 'X-XSRF-TOKEN', /* enabled */ true);\n+      TestBed.resetTestingModule();\n+      TestBed.configureTestingModule({\n+        providers: [\n+          {\n+            provide: HttpXsrfTokenExtractor,\n+            useValue: new SampleTokenExtractor(null),\n+          },\n+          {\n+            provide: XSRF_HEADER_NAME,\n+            useValue: 'X-XSRF-TOKEN',\n+          },\n+          {\n+            provide: XSRF_ENABLED,\n+            useValue: true,\n+          },\n+          HttpXsrfInterceptor,\n+        ],\n+      });\n+      interceptor = TestBed.inject(HttpXsrfInterceptor);\n       interceptor.intercept(new HttpRequest('POST', '/test', {}), backend).subscribe();\n       const req = backend.expectOne('/test');\n       expect(req.request.headers.has('X-XSRF-TOKEN')).toEqual(false);\n\n\n###\n\n", "completion": "refactor(http): convert the XSRF interceptor to functional style (#<issue-num>)"}
{"prompt": " file path A: packages/common/http/src/module.ts | file path B: packages/common/http/src/module.ts\n\n@@ -13,7 +13,7 @@ import {HttpClient} from './client';\n import {HTTP_INTERCEPTOR_FNS, HTTP_INTERCEPTORS, HttpInterceptorHandler, LEGACY_INTERCEPTOR_FN, legacyInterceptorFnFactory} from './interceptor';\n import {jsonpCallbackContext, JsonpCallbackContext, JsonpClientBackend, jsonpInterceptorFn} from './jsonp';\n import {HttpXhrBackend} from './xhr';\n-import {HttpXsrfCookieExtractor, HttpXsrfInterceptor, HttpXsrfTokenExtractor, XSRF_COOKIE_NAME, XSRF_ENABLED, XSRF_HEADER_NAME} from './xsrf';\n+import {HttpXsrfCookieExtractor, HttpXsrfInterceptor, HttpXsrfTokenExtractor, XSRF_COOKIE_NAME, XSRF_DEFAULT_COOKIE_NAME, XSRF_DEFAULT_HEADER_NAME, XSRF_ENABLED, XSRF_HEADER_NAME} from './xsrf';\n \n /**\n  * Configures XSRF protection support for outgoing requests.\n@@ -32,8 +32,8 @@ import {HttpXsrfCookieExtractor, HttpXsrfInterceptor, HttpXsrfTokenExtractor, XS\n     HttpXsrfInterceptor,\n     {provide: HTTP_INTERCEPTORS, useExisting: HttpXsrfInterceptor, multi: true},\n     {provide: HttpXsrfTokenExtractor, useClass: HttpXsrfCookieExtractor},\n-    {provide: XSRF_COOKIE_NAME, useValue: 'XSRF-TOKEN'},\n-    {provide: XSRF_HEADER_NAME, useValue: 'X-XSRF-TOKEN'},\n+    {provide: XSRF_COOKIE_NAME, useValue: XSRF_DEFAULT_COOKIE_NAME},\n+    {provide: XSRF_HEADER_NAME, useValue: XSRF_DEFAULT_HEADER_NAME},\n     {provide: XSRF_ENABLED, useValue: true},\n   ],\n })\n@@ -87,8 +87,8 @@ export class HttpClientXsrfModule {\n    */\n   imports: [\n     HttpClientXsrfModule.withOptions({\n-      cookieName: 'XSRF-TOKEN',\n-      headerName: 'X-XSRF-TOKEN',\n+      cookieName: XSRF_DEFAULT_COOKIE_NAME,\n+      headerName: XSRF_DEFAULT_HEADER_NAME,\n     }),\n   ],\n   /**\n\n---\n file path A: packages/common/http/src/xsrf.ts | file path B: packages/common/http/src/xsrf.ts\n\n@@ -16,8 +16,18 @@ import {HttpRequest} from './request';\n import {HttpEvent} from './response';\n \n export const XSRF_ENABLED = new InjectionToken<boolean>('XSRF_ENABLED');\n-export const XSRF_COOKIE_NAME = new InjectionToken<string>('XSRF_COOKIE_NAME');\n-export const XSRF_HEADER_NAME = new InjectionToken<string>('XSRF_HEADER_NAME');\n+\n+export const XSRF_DEFAULT_COOKIE_NAME = 'XSRF-TOKEN';\n+export const XSRF_COOKIE_NAME = new InjectionToken<string>('XSRF_COOKIE_NAME', {\n+  providedIn: 'root',\n+  factory: () => XSRF_DEFAULT_COOKIE_NAME,\n+});\n+\n+export const XSRF_DEFAULT_HEADER_NAME = 'X-XSRF-TOKEN';\n+export const XSRF_HEADER_NAME = new InjectionToken<string>('XSRF_HEADER_NAME', {\n+  providedIn: 'root',\n+  factory: () => XSRF_DEFAULT_HEADER_NAME,\n+});\n \n /**\n  * Retrieves the current XSRF token to use with the next outgoing request.\n\n\n###\n\n", "completion": "refactor(http): provide XSRF configuration tokens in root (#<issue-num>)"}
{"prompt": " file path A: packages/common/http/src/interceptor.ts | file path B: packages/common/http/src/interceptor.ts\n\n@@ -148,13 +148,6 @@ export const HTTP_INTERCEPTORS = new InjectionToken<HttpInterceptor[]>('HTTP_INT\n  */\n export const HTTP_INTERCEPTOR_FNS = new InjectionToken<HttpInterceptorFn[]>('HTTP_INTERCEPTOR_FNS');\n \n-@Injectable()\n-export class NoopInterceptor implements HttpInterceptor {\n-  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n-    return next.handle(req);\n-  }\n-}\n-\n /**\n  * Creates an `HttpInterceptorFn` which lazily initializes an interceptor chain from the legacy\n  * class-based interceptors and runs the request through it.\n\n---\n file path A: packages/common/http/src/module.ts | file path B: packages/common/http/src/module.ts\n\n@@ -10,10 +10,10 @@ import {ModuleWithProviders, NgModule} from '@angular/core';\n \n import {HttpBackend, HttpHandler} from './backend';\n import {HttpClient} from './client';\n-import {HTTP_INTERCEPTOR_FNS, HTTP_INTERCEPTORS, HttpInterceptorHandler, LEGACY_INTERCEPTOR_FN, legacyInterceptorFnFactory, NoopInterceptor} from './interceptor';\n+import {HTTP_INTERCEPTOR_FNS, HTTP_INTERCEPTORS, HttpInterceptorHandler, LEGACY_INTERCEPTOR_FN, legacyInterceptorFnFactory} from './interceptor';\n import {jsonpCallbackContext, JsonpCallbackContext, JsonpClientBackend, jsonpInterceptorFn} from './jsonp';\n import {HttpXhrBackend} from './xhr';\n-import {HttpXsrfCookieExtractor, HttpXsrfInterceptor, HttpXsrfTokenExtractor, XSRF_COOKIE_NAME, XSRF_HEADER_NAME} from './xsrf';\n+import {HttpXsrfCookieExtractor, HttpXsrfInterceptor, HttpXsrfTokenExtractor, XSRF_COOKIE_NAME, XSRF_ENABLED, XSRF_HEADER_NAME} from './xsrf';\n \n /**\n  * Configures XSRF protection support for outgoing requests.\n@@ -34,6 +34,7 @@ import {HttpXsrfCookieExtractor, HttpXsrfInterceptor, HttpXsrfTokenExtractor, XS\n     {provide: HttpXsrfTokenExtractor, useClass: HttpXsrfCookieExtractor},\n     {provide: XSRF_COOKIE_NAME, useValue: 'XSRF-TOKEN'},\n     {provide: XSRF_HEADER_NAME, useValue: 'X-XSRF-TOKEN'},\n+    {provide: XSRF_ENABLED, useValue: true},\n   ],\n })\n export class HttpClientXsrfModule {\n@@ -44,7 +45,7 @@ export class HttpClientXsrfModule {\n     return {\n       ngModule: HttpClientXsrfModule,\n       providers: [\n-        {provide: HttpXsrfInterceptor, useClass: NoopInterceptor},\n+        {provide: XSRF_ENABLED, useValue: false},\n       ],\n     };\n   }\n\n---\n file path A: packages/common/http/src/xsrf.ts | file path B: packages/common/http/src/xsrf.ts\n\n@@ -15,6 +15,7 @@ import {HttpInterceptor} from './interceptor';\n import {HttpRequest} from './request';\n import {HttpEvent} from './response';\n \n+export const XSRF_ENABLED = new InjectionToken<boolean>('XSRF_ENABLED');\n export const XSRF_COOKIE_NAME = new InjectionToken<string>('XSRF_COOKIE_NAME');\n export const XSRF_HEADER_NAME = new InjectionToken<string>('XSRF_HEADER_NAME');\n \n@@ -70,7 +71,8 @@ export class HttpXsrfCookieExtractor implements HttpXsrfTokenExtractor {\n export class HttpXsrfInterceptor implements HttpInterceptor {\n   constructor(\n       private tokenService: HttpXsrfTokenExtractor,\n-      @Inject(XSRF_HEADER_NAME) private headerName: string) {}\n+      @Inject(XSRF_HEADER_NAME) private headerName: string,\n+      @Inject(XSRF_ENABLED) private enabled: boolean) {}\n \n   intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n     const lcUrl = req.url.toLowerCase();\n@@ -78,8 +80,8 @@ export class HttpXsrfInterceptor implements HttpInterceptor {\n     // Non-mutating requests don't require a token, and absolute URLs require special handling\n     // anyway as the cookie set\n     // on our origin is not the same as the token expected by another origin.\n-    if (req.method === 'GET' || req.method === 'HEAD' || lcUrl.startsWith('http://') ||\n-        lcUrl.startsWith('https://')) {\n+    if (!this.enabled || req.method === 'GET' || req.method === 'HEAD' ||\n+        lcUrl.startsWith('http://') || lcUrl.startsWith('https://')) {\n       return next.handle(req);\n     }\n     const token = this.tokenService.getToken();\n\n---\n file path A: packages/common/http/test/xsrf_spec.ts | file path B: packages/common/http/test/xsrf_spec.ts\n\n@@ -9,7 +9,6 @@\n import {HttpHeaders} from '@angular/common/http/src/headers';\n import {HttpRequest} from '@angular/common/http/src/request';\n import {HttpXsrfCookieExtractor, HttpXsrfInterceptor, HttpXsrfTokenExtractor} from '@angular/common/http/src/xsrf';\n-\n import {HttpClientTestingBackend} from '@angular/common/http/testing/src/backend';\n \n class SampleTokenExtractor extends HttpXsrfTokenExtractor {\n@@ -25,7 +24,8 @@ class SampleTokenExtractor extends HttpXsrfTokenExtractor {\n {\n   describe('HttpXsrfInterceptor', () => {\n     let backend: HttpClientTestingBackend;\n-    const interceptor = new HttpXsrfInterceptor(new SampleTokenExtractor('test'), 'X-XSRF-TOKEN');\n+    const interceptor = new HttpXsrfInterceptor(\n+        new SampleTokenExtractor('test'), 'X-XSRF-TOKEN', /* enabled */ true);\n     beforeEach(() => {\n       backend = new HttpClientTestingBackend();\n     });\n@@ -59,7 +59,8 @@ class SampleTokenExtractor extends HttpXsrfTokenExtractor {\n       req.flush({});\n     });\n     it('does not set the header for a null token', () => {\n-      const interceptor = new HttpXsrfInterceptor(new SampleTokenExtractor(null), 'X-XSRF-TOKEN');\n+      const interceptor = new HttpXsrfInterceptor(\n+          new SampleTokenExtractor(null), 'X-XSRF-TOKEN', /* enabled */ true);\n       interceptor.intercept(new HttpRequest('POST', '/test', {}), backend).subscribe();\n       const req = backend.expectOne('/test');\n       expect(req.request.headers.has('X-XSRF-TOKEN')).toEqual(false);\n\n\n###\n\n", "completion": "refactor(http): use an InjectionToken to disable the XSRF interceptor (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/http/index.md | file path B: goldens/public-api/common/http/index.md\n\n@@ -4,6 +4,7 @@\n \n ```ts\n \n+import { EnvironmentInjector } from '@angular/core';\n import * as i0 from '@angular/core';\n import { InjectionToken } from '@angular/core';\n import { ModuleWithProviders } from '@angular/core';\n@@ -2121,8 +2122,8 @@ export class JsonpClientBackend implements HttpBackend {\n \n // @public\n export class JsonpInterceptor {\n-    constructor(jsonp: JsonpClientBackend);\n-    intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>>;\n+    constructor(injector: EnvironmentInjector);\n+    intercept(initialRequest: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>>;\n     // (undocumented)\n     static \u0275fac: i0.\u0275\u0275FactoryDeclaration<JsonpInterceptor, never>;\n     // (undocumented)\n\n---\n file path A: packages/common/http/src/jsonp.ts | file path B: packages/common/http/src/jsonp.ts\n\n@@ -7,10 +7,11 @@\n  */\n \n import {DOCUMENT} from '@angular/common';\n-import {Inject, Injectable} from '@angular/core';\n+import {EnvironmentInjector, Inject, inject, Injectable} from '@angular/core';\n import {Observable, Observer} from 'rxjs';\n \n import {HttpBackend, HttpHandler} from './backend';\n+import {HttpHandlerFn} from './interceptor';\n import {HttpRequest} from './request';\n import {HttpErrorResponse, HttpEvent, HttpEventType, HttpResponse, HttpStatusCode} from './response';\n \n@@ -51,6 +52,21 @@ export abstract class JsonpCallbackContext {\n   [key: string]: (data: any) => void;\n }\n \n+/**\n+ * Factory function that determines where to store JSONP callbacks.\n+ *\n+ * Ordinarily JSONP callbacks are stored on the `window` object, but this may not exist\n+ * in test environments. In that case, callbacks are stored on an anonymous object instead.\n+ *\n+ *\n+ */\n+export function jsonpCallbackContext(): Object {\n+  if (typeof window === 'object') {\n+    return window;\n+  }\n+  return {};\n+}\n+\n /**\n  * Processes an `HttpRequest` with the JSONP method,\n  * by performing JSONP style requests.\n@@ -229,6 +245,19 @@ export class JsonpClientBackend implements HttpBackend {\n   }\n }\n \n+/**\n+ * Identifies requests with the method JSONP and shifts them to the `JsonpClientBackend`.\n+ */\n+export function jsonpInterceptorFn(\n+    req: HttpRequest<unknown>, next: HttpHandlerFn): Observable<HttpEvent<unknown>> {\n+  if (req.method === 'JSONP') {\n+    return inject(JsonpClientBackend).handle(req as HttpRequest<never>);\n+  }\n+\n+  // Fall through for normal HTTP requests.\n+  return next(req);\n+}\n+\n /**\n  * Identifies requests with the method JSONP and\n  * shifts them to the `JsonpClientBackend`.\n@@ -239,20 +268,18 @@ export class JsonpClientBackend implements HttpBackend {\n  */\n @Injectable()\n export class JsonpInterceptor {\n-  constructor(private jsonp: JsonpClientBackend) {}\n+  constructor(private injector: EnvironmentInjector) {}\n \n   /**\n    * Identifies and handles a given JSONP request.\n-   * @param req The outgoing request object to handle.\n+   * @param initialRequest The outgoing request object to handle.\n    * @param next The next interceptor in the chain, or the backend\n    * if no interceptors remain in the chain.\n    * @returns An observable of the event stream.\n    */\n-  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n-    if (req.method === 'JSONP') {\n-      return this.jsonp.handle(req as HttpRequest<never>);\n-    }\n-    // Fall through for normal HTTP requests.\n-    return next.handle(req);\n+  intercept(initialRequest: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n+    return this.injector.runInContext(\n+        () => jsonpInterceptorFn(\n+            initialRequest, downstreamRequest => next.handle(downstreamRequest)));\n   }\n }\n\n---\n file path A: packages/common/http/src/module.ts | file path B: packages/common/http/src/module.ts\n\n@@ -11,25 +11,10 @@ import {ModuleWithProviders, NgModule} from '@angular/core';\n import {HttpBackend, HttpHandler} from './backend';\n import {HttpClient} from './client';\n import {HTTP_INTERCEPTOR_FNS, HTTP_INTERCEPTORS, HttpInterceptorHandler, LEGACY_INTERCEPTOR_FN, legacyInterceptorFnFactory, NoopInterceptor} from './interceptor';\n-import {JsonpCallbackContext, JsonpClientBackend, JsonpInterceptor} from './jsonp';\n+import {jsonpCallbackContext, JsonpCallbackContext, JsonpClientBackend, jsonpInterceptorFn} from './jsonp';\n import {HttpXhrBackend} from './xhr';\n import {HttpXsrfCookieExtractor, HttpXsrfInterceptor, HttpXsrfTokenExtractor, XSRF_COOKIE_NAME, XSRF_HEADER_NAME} from './xsrf';\n \n-/**\n- * Factory function that determines where to store JSONP callbacks.\n- *\n- * Ordinarily JSONP callbacks are stored on the `window` object, but this may not exist\n- * in test environments. In that case, callbacks are stored on an anonymous object instead.\n- *\n- *\n- */\n-export function jsonpCallbackContext(): Object {\n-  if (typeof window === 'object') {\n-    return window;\n-  }\n-  return {};\n-}\n-\n /**\n  * Configures XSRF protection support for outgoing requests.\n  *\n@@ -140,7 +125,7 @@ export class HttpClientModule {\n   providers: [\n     JsonpClientBackend,\n     {provide: JsonpCallbackContext, useFactory: jsonpCallbackContext},\n-    {provide: HTTP_INTERCEPTORS, useClass: JsonpInterceptor, multi: true},\n+    {provide: HTTP_INTERCEPTOR_FNS, useValue: jsonpInterceptorFn, multi: true},\n   ],\n })\n export class HttpClientJsonpModule {\n\n\n###\n\n", "completion": "refactor(http): convert the JSONP interceptor to the functional style (#<issue-num>)"}
{"prompt": " file path A: packages/common/http/src/interceptor.ts | file path B: packages/common/http/src/interceptor.ts\n\n@@ -118,6 +118,23 @@ function adaptLegacyInterceptorToChain(\n   });\n }\n \n+/**\n+ * Constructs a `ChainedInterceptorFn` which wraps and invokes a functional interceptor in the given\n+ * injector.\n+ */\n+function chainedInterceptorFn(\n+    chainTailFn: ChainedInterceptorFn<unknown>, interceptorFn: HttpInterceptorFn,\n+    injector: EnvironmentInjector): ChainedInterceptorFn<unknown> {\n+  // clang-format off\n+  return (initialRequest, finalHandlerFn) => injector.runInContext(() =>\n+    interceptorFn(\n+      initialRequest,\n+      downstreamRequest => chainTailFn(downstreamRequest, finalHandlerFn)\n+    )\n+  );\n+  // clang-format on\n+}\n+\n /**\n  * A multi-provider token that represents the array of registered\n  * `HttpInterceptor` objects.\n@@ -126,6 +143,11 @@ function adaptLegacyInterceptorToChain(\n  */\n export const HTTP_INTERCEPTORS = new InjectionToken<HttpInterceptor[]>('HTTP_INTERCEPTORS');\n \n+/**\n+ * A multi-provided token of `HttpInterceptorFn`s.\n+ */\n+export const HTTP_INTERCEPTOR_FNS = new InjectionToken<HttpInterceptorFn[]>('HTTP_INTERCEPTOR_FNS');\n+\n @Injectable()\n export class NoopInterceptor implements HttpInterceptor {\n   intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n@@ -155,17 +177,29 @@ export function legacyInterceptorFnFactory(): HttpInterceptorFn {\n   };\n }\n \n+export const LEGACY_INTERCEPTOR_FN = new InjectionToken<HttpInterceptorFn>('LEGACY_INTERCEPTOR_FN');\n+\n @Injectable()\n export class HttpInterceptorHandler extends HttpHandler {\n-  private legacyInterceptors = legacyInterceptorFnFactory();\n+  private chain: ChainedInterceptorFn<unknown>|null = null;\n \n   constructor(private backend: HttpBackend, private injector: EnvironmentInjector) {\n     super();\n   }\n \n   override handle(initialRequest: HttpRequest<any>): Observable<HttpEvent<any>> {\n-    return this.injector.runInContext(\n-        () => this.legacyInterceptors(\n-            initialRequest, downstreamRequest => this.backend.handle(downstreamRequest)));\n+    if (this.chain === null) {\n+      const dedupedInterceptorFns = Array.from(new Set(this.injector.get(HTTP_INTERCEPTOR_FNS)));\n+\n+      // Note: interceptors are wrapped right-to-left so that final execution order is\n+      // left-to-right. That is, if `dedupedInterceptorFns` is the array `[a, b, c]`, we want to\n+      // produce a chain that is conceptually `c(b(a(end)))`, which we build from the inside\n+      // out.\n+      this.chain = dedupedInterceptorFns.reduceRight(\n+          (nextSequencedFn, interceptorFn) =>\n+              chainedInterceptorFn(nextSequencedFn, interceptorFn, this.injector),\n+          interceptorChainEndFn as ChainedInterceptorFn<unknown>);\n+    }\n+    return this.chain(initialRequest, downstreamRequest => this.backend.handle(downstreamRequest));\n   }\n }\n\n---\n file path A: packages/common/http/src/module.ts | file path B: packages/common/http/src/module.ts\n\n@@ -10,7 +10,7 @@ import {ModuleWithProviders, NgModule} from '@angular/core';\n \n import {HttpBackend, HttpHandler} from './backend';\n import {HttpClient} from './client';\n-import {HTTP_INTERCEPTORS, HttpInterceptorHandler, NoopInterceptor} from './interceptor';\n+import {HTTP_INTERCEPTOR_FNS, HTTP_INTERCEPTORS, HttpInterceptorHandler, LEGACY_INTERCEPTOR_FN, legacyInterceptorFnFactory, NoopInterceptor} from './interceptor';\n import {JsonpCallbackContext, JsonpClientBackend, JsonpInterceptor} from './jsonp';\n import {HttpXhrBackend} from './xhr';\n import {HttpXsrfCookieExtractor, HttpXsrfInterceptor, HttpXsrfTokenExtractor, XSRF_COOKIE_NAME, XSRF_HEADER_NAME} from './xsrf';\n@@ -114,6 +114,12 @@ export class HttpClientXsrfModule {\n     {provide: HttpHandler, useClass: HttpInterceptorHandler},\n     HttpXhrBackend,\n     {provide: HttpBackend, useExisting: HttpXhrBackend},\n+    {provide: LEGACY_INTERCEPTOR_FN, useFactory: legacyInterceptorFnFactory},\n+    {\n+      provide: HTTP_INTERCEPTOR_FNS,\n+      useExisting: LEGACY_INTERCEPTOR_FN,\n+      multi: true,\n+    },\n   ],\n })\n export class HttpClientModule {\n\n\n###\n\n", "completion": "refactor(http): use a DI token for new interceptors (#<issue-num>)"}
{"prompt": " file path A: packages/common/http/public_api.ts | file path B: packages/common/http/public_api.ts\n\n@@ -31,11 +31,14 @@ export {HttpBackend, HttpHandler} from './src/backend';\n export {HttpClient} from './src/client';\n export {HttpContext, HttpContextToken} from './src/context';\n export {HttpHeaders} from './src/headers';\n-export {HTTP_INTERCEPTORS, HttpInterceptor} from './src/interceptor';\n+export {HTTP_INTERCEPTORS, HttpInterceptor, HttpInterceptorHandler as \u0275HttpInterceptorHandler} from './src/interceptor';\n export {JsonpClientBackend, JsonpInterceptor} from './src/jsonp';\n-export {HttpClientJsonpModule, HttpClientModule, HttpClientXsrfModule, HttpInterceptingHandler as \u0275HttpInterceptingHandler} from './src/module';\n+export {HttpClientJsonpModule, HttpClientModule, HttpClientXsrfModule} from './src/module';\n export {HttpParameterCodec, HttpParams, HttpParamsOptions, HttpUrlEncodingCodec} from './src/params';\n export {HttpRequest} from './src/request';\n export {HttpDownloadProgressEvent, HttpErrorResponse, HttpEvent, HttpEventType, HttpHeaderResponse, HttpProgressEvent, HttpResponse, HttpResponseBase, HttpSentEvent, HttpStatusCode, HttpUploadProgressEvent, HttpUserEvent} from './src/response';\n export {HttpXhrBackend} from './src/xhr';\n export {HttpXsrfTokenExtractor} from './src/xsrf';\n+\n+// This re-export exists because g3 depends on this old private name.\n+export {HttpInterceptorHandler as \u0275HttpInterceptingHandler} from './src/interceptor';\n\n---\n file path A: packages/common/http/src/backend.ts | file path B: packages/common/http/src/backend.ts\n\n@@ -7,6 +7,7 @@\n  */\n \n import {Observable} from 'rxjs';\n+\n import {HttpRequest} from './request';\n import {HttpEvent} from './response';\n \n\n---\n file path A: packages/common/http/src/interceptor.ts | file path B: packages/common/http/src/interceptor.ts\n\n@@ -6,10 +6,10 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Injectable, InjectionToken} from '@angular/core';\n+import {EnvironmentInjector, inject, Injectable, InjectionToken} from '@angular/core';\n import {Observable} from 'rxjs';\n \n-import {HttpHandler} from './backend';\n+import {HttpBackend, HttpHandler} from './backend';\n import {HttpRequest} from './request';\n import {HttpEvent} from './response';\n \n@@ -40,7 +40,6 @@ import {HttpEvent} from './response';\n  * If you import `HttpClientModule` multiple times across different modules (for example, in lazy\n  * loading modules), each import creates a new copy of the `HttpClientModule`, which overwrites the\n  * interceptors provided in the root module.\n- *\n  */\n export interface HttpInterceptor {\n   /**\n@@ -54,16 +53,69 @@ export interface HttpInterceptor {\n }\n \n /**\n- * `HttpHandler` which applies an `HttpInterceptor` to an `HttpRequest`.\n+ * Represents the next interceptor in an interceptor chain, or the real backend if there are no\n+ * further interceptors.\n  *\n+ * Most interceptors will delegate to this function, and either modify the outgoing request or the\n+ * response when it arrives. Within the scope of the current request, however, this function may be\n+ * called any number of times, for any number of downstream requests. Such downstream requests need\n+ * not be to the same URL or even the same origin as the current request. It is also valid to not\n+ * call the downstream handler at all, and process the current request entirely within the\n+ * interceptor.\n  *\n+ * This function should only be called within the scope of the request that's currently being\n+ * intercepted. Once that request is complete, this downstream handler function should not be\n+ * called.\n  */\n-export class HttpInterceptorHandler implements HttpHandler {\n-  constructor(private next: HttpHandler, private interceptor: HttpInterceptor) {}\n+export type HttpHandlerFn = (req: HttpRequest<unknown>) => Observable<HttpEvent<unknown>>;\n \n-  handle(req: HttpRequest<any>): Observable<HttpEvent<any>> {\n-    return this.interceptor.intercept(req, this.next);\n-  }\n+/**\n+ * An interceptor for HTTP requests made via `HttpClient`.\n+ *\n+ * `HttpInterceptorFn`s are middleware functions which `HttpClient` calls when a request is made.\n+ * These functions have the opportunity to modify the outgoing request or any response that comes\n+ * back, as well as block, redirect, or otherwise change the request or response semantics.\n+ *\n+ * An `HttpHandlerFn` representing the next interceptor (or the backend which will make a real HTTP\n+ * request) is provided. Most interceptors will delegate to this function, but that is not required\n+ * (see `HttpHandlerFn` for more details).\n+ *\n+ * `HttpInterceptorFn`s have access to `inject()` via the `EnvironmentInjector` from which they were\n+ * configured.\n+ */\n+export type HttpInterceptorFn = (req: HttpRequest<unknown>, next: HttpHandlerFn) =>\n+    Observable<HttpEvent<unknown>>;\n+\n+/**\n+ * Function which invokes an HTTP interceptor chain.\n+ *\n+ * Each interceptor in the interceptor chain is turned into a `ChainedInterceptorFn` which closes\n+ * over the rest of the chain (represented by another `ChainedInterceptorFn`). The last such\n+ * function in the chain will instead delegate to the `finalHandlerFn`, which is passed down when\n+ * the chain is invoked.\n+ *\n+ * This pattern allows for a chain of many interceptors to be composed and wrapped in a single\n+ * `HttpInterceptorFn`, which is a useful abstraction for including different kinds of interceptors\n+ * (e.g. legacy class-based interceptors) in the same chain.\n+ */\n+type ChainedInterceptorFn<RequestT> = (req: HttpRequest<RequestT>, finalHandlerFn: HttpHandlerFn) =>\n+    Observable<HttpEvent<RequestT>>;\n+\n+function interceptorChainEndFn(\n+    req: HttpRequest<any>, finalHandlerFn: HttpHandlerFn): Observable<HttpEvent<any>> {\n+  return finalHandlerFn(req);\n+}\n+\n+/**\n+ * Constructs a `ChainedInterceptorFn` which adapts a legacy `HttpInterceptor` to the\n+ * `ChainedInterceptorFn` interface.\n+ */\n+function adaptLegacyInterceptorToChain(\n+    chainTailFn: ChainedInterceptorFn<any>,\n+    interceptor: HttpInterceptor): ChainedInterceptorFn<any> {\n+  return (initialRequest, finalHandlerFn) => interceptor.intercept(initialRequest, {\n+    handle: (downstreamRequest) => chainTailFn(downstreamRequest, finalHandlerFn),\n+  });\n }\n \n /**\n@@ -80,3 +132,40 @@ export class NoopInterceptor implements HttpInterceptor {\n     return next.handle(req);\n   }\n }\n+\n+/**\n+ * Creates an `HttpInterceptorFn` which lazily initializes an interceptor chain from the legacy\n+ * class-based interceptors and runs the request through it.\n+ */\n+export function legacyInterceptorFnFactory(): HttpInterceptorFn {\n+  let chain: ChainedInterceptorFn<any>|null = null;\n+\n+  return (req, handler) => {\n+    if (chain === null) {\n+      const interceptors = inject(HTTP_INTERCEPTORS, {optional: true}) ?? [];\n+      // Note: interceptors are wrapped right-to-left so that final execution order is\n+      // left-to-right. That is, if `interceptors` is the array `[a, b, c]`, we want to\n+      // produce a chain that is conceptually `c(b(a(end)))`, which we build from the inside\n+      // out.\n+      chain = interceptors.reduceRight(\n+          adaptLegacyInterceptorToChain, interceptorChainEndFn as ChainedInterceptorFn<any>);\n+    }\n+\n+    return chain(req, handler);\n+  };\n+}\n+\n+@Injectable()\n+export class HttpInterceptorHandler extends HttpHandler {\n+  private legacyInterceptors = legacyInterceptorFnFactory();\n+\n+  constructor(private backend: HttpBackend, private injector: EnvironmentInjector) {\n+    super();\n+  }\n+\n+  override handle(initialRequest: HttpRequest<any>): Observable<HttpEvent<any>> {\n+    return this.injector.runInContext(\n+        () => this.legacyInterceptors(\n+            initialRequest, downstreamRequest => this.backend.handle(downstreamRequest)));\n+  }\n+}\n\n---\n file path A: packages/common/http/src/module.ts | file path B: packages/common/http/src/module.ts\n\n@@ -6,60 +6,15 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Injectable, Injector, ModuleWithProviders, NgModule} from '@angular/core';\n-import {Observable} from 'rxjs';\n+import {ModuleWithProviders, NgModule} from '@angular/core';\n \n import {HttpBackend, HttpHandler} from './backend';\n import {HttpClient} from './client';\n-import {HTTP_INTERCEPTORS, HttpInterceptor, HttpInterceptorHandler, NoopInterceptor} from './interceptor';\n+import {HTTP_INTERCEPTORS, HttpInterceptorHandler, NoopInterceptor} from './interceptor';\n import {JsonpCallbackContext, JsonpClientBackend, JsonpInterceptor} from './jsonp';\n-import {HttpRequest} from './request';\n-import {HttpEvent} from './response';\n import {HttpXhrBackend} from './xhr';\n import {HttpXsrfCookieExtractor, HttpXsrfInterceptor, HttpXsrfTokenExtractor, XSRF_COOKIE_NAME, XSRF_HEADER_NAME} from './xsrf';\n \n-/**\n- * An injectable `HttpHandler` that applies multiple interceptors\n- * to a request before passing it to the given `HttpBackend`.\n- *\n- * The interceptors are loaded lazily from the injector, to allow\n- * interceptors to themselves inject classes depending indirectly\n- * on `HttpInterceptingHandler` itself.\n- * @see `HttpInterceptor`\n- */\n-@Injectable()\n-export class HttpInterceptingHandler implements HttpHandler {\n-  private chain: HttpHandler|null = null;\n-\n-  constructor(private backend: HttpBackend, private injector: Injector) {}\n-\n-  handle(req: HttpRequest<any>): Observable<HttpEvent<any>> {\n-    if (this.chain === null) {\n-      const interceptors = this.injector.get(HTTP_INTERCEPTORS, []);\n-      this.chain = interceptors.reduceRight(\n-          (next, interceptor) => new HttpInterceptorHandler(next, interceptor), this.backend);\n-    }\n-    return this.chain.handle(req);\n-  }\n-}\n-\n-/**\n- * Constructs an `HttpHandler` that applies interceptors\n- * to a request before passing it to the given `HttpBackend`.\n- *\n- * Use as a factory function within `HttpClientModule`.\n- *\n- *\n- */\n-export function interceptingHandler(\n-    backend: HttpBackend, interceptors: HttpInterceptor[]|null = []): HttpHandler {\n-  if (!interceptors) {\n-    return backend;\n-  }\n-  return interceptors.reduceRight(\n-      (next, interceptor) => new HttpInterceptorHandler(next, interceptor), backend);\n-}\n-\n /**\n  * Factory function that determines where to store JSONP callbacks.\n  *\n@@ -156,7 +111,7 @@ export class HttpClientXsrfModule {\n    */\n   providers: [\n     HttpClient,\n-    {provide: HttpHandler, useClass: HttpInterceptingHandler},\n+    {provide: HttpHandler, useClass: HttpInterceptorHandler},\n     HttpXhrBackend,\n     {provide: HttpBackend, useExisting: HttpXhrBackend},\n   ],\n\n---\n file path A: packages/platform-server/src/http.ts | file path B: packages/platform-server/src/http.ts\n\n@@ -7,8 +7,8 @@\n  */\n \n import {PlatformLocation, XhrFactory} from '@angular/common';\n-import {HttpBackend, HttpEvent, HttpHandler, HttpRequest, \u0275HttpInterceptingHandler as HttpInterceptingHandler} from '@angular/common/http';\n-import {Injectable, Injector, Provider} from '@angular/core';\n+import {HttpBackend, HttpEvent, HttpHandler, HttpRequest, \u0275HttpInterceptorHandler as HttpInterceptorHandler} from '@angular/common/http';\n+import {EnvironmentInjector, inject, Injectable, Provider} from '@angular/core';\n import {Observable, Observer, Subscription} from 'rxjs';\n import * as xhr2 from 'xhr2';\n \n@@ -128,17 +128,17 @@ export class ZoneClientBackend extends\n   }\n }\n \n-export function zoneWrappedInterceptingHandler(\n-    backend: HttpBackend, injector: Injector, platformLocation: PlatformLocation,\n-    config: PlatformConfig) {\n-  const realBackend: HttpBackend = new HttpInterceptingHandler(backend, injector);\n-  return new ZoneClientBackend(realBackend, platformLocation, config);\n+export function zoneWrappedInterceptorHandler(\n+    platformLocation: PlatformLocation, config: PlatformConfig) {\n+  return new ZoneClientBackend(\n+      new HttpInterceptorHandler(inject(HttpBackend), inject(EnvironmentInjector)),\n+      platformLocation, config);\n }\n \n export const SERVER_HTTP_PROVIDERS: Provider[] = [\n   {provide: XhrFactory, useClass: ServerXhr}, {\n     provide: HttpHandler,\n-    useFactory: zoneWrappedInterceptingHandler,\n-    deps: [HttpBackend, Injector, PlatformLocation, INITIAL_CONFIG]\n+    useFactory: zoneWrappedInterceptorHandler,\n+    deps: [PlatformLocation, INITIAL_CONFIG]\n   }\n ];\n\n\n###\n\n", "completion": "refactor(http): introduce the functional interceptors API (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/lightweight-injection-tokens.md | file path B: aio/content/guide/lightweight-injection-tokens.md\n\n@@ -1,12 +1,12 @@\n-# Optimizing client app size with lightweight injection tokens\n+# Optimizing client application size with lightweight injection tokens\n \n This page provides a conceptual overview of a dependency injection technique that is recommended for library developers.\n Designing your library with *lightweight injection tokens* helps optimize the bundle size of client applications that use your library.\n \n You can manage the dependency structure among your components and injectable services to optimize bundle size by using [tree-shakable providers](guide/architecture-services#introduction-to-services-and-dependency-injection).\n-This normally ensures that if a provided component or service is never actually used by the app, the compiler can eliminate its code from the bundle.\n+This normally ensures that if a provided component or service is never actually used by the application, the compiler can remove its code from the bundle.\n \n-However, due to the way Angular stores injection tokens, it is possible that such an unused component or service can end up in the bundle anyway.\n+Due to the way Angular stores injection tokens, it is possible that such an unused component or service can end up in the bundle anyway.\n This page describes a dependency-injection design pattern that supports proper tree-shaking by using lightweight injection tokens.\n \n The lightweight injection token design pattern is especially important for library developers.\n@@ -19,7 +19,7 @@ To prevent the retention of unused components, your library should use the light\n \n ## When tokens are retained\n \n-To better explain the condition under which token retention occurs, consider a library that provides a library-card component, which contains a body and can contain an optional header.\n+To better explain the condition under which token retention occurs, consider a library that provides a library-card component. This component contains a body and can contain an optional header.\n \n <code-example format=\"html\" language=\"html\">\n \n@@ -29,7 +29,7 @@ To better explain the condition under which token retention occurs, consider a l\n \n </code-example>\n \n-In a likely implementation, the `<lib-card>` component uses `@ContentChild()` or `@ContentChildren()` to obtain `<lib-header>` and `<lib-body>`, as in the following.\n+In a likely implementation, the `<lib-card>` component uses `@ContentChild()` or `@ContentChildren()` to get `<lib-header>` and `<lib-body>`, as in the following.\n \n <code-example format=\"typescript\" language=\"typescript\">\n \n@@ -68,10 +68,10 @@ The compiler handles token references in these positions differently.\n \n *   The compiler erases *type position* references after conversion from TypeScript, so they have no impact on tree-shaking.\n \n-*   The compiler must retain *value position* references at runtime, which prevents the component from being tree-shaken.\n+*   The compiler must keep *value position* references at runtime, which prevents the component from being tree-shaken.\n \n-In the example, the compiler retains the `LibHeaderComponent` token that occurs in the value position, which prevents the referenced component from being tree-shaken, even if the application developer does not actually use `<lib-header>` anywhere.\n-If `LibHeaderComponent` is large \\(code, template, and styles\\), including it unnecessarily can significantly increase the size of the client application.\n+In the example, the compiler retains the `LibHeaderComponent` token that occurs in the value position. This prevents the referenced component from being tree-shaken, even if the application developer does not actually use `<lib-header>` anywhere.\n+If `LibHeaderComponent` 's code, template, and styles combined becomes too large, including it unnecessarily can significantly increase the size of the client application.\n \n ## When to use the lightweight injection token pattern\n \n@@ -81,7 +81,7 @@ There are two cases when that can happen.\n *   The token is used in the value position of a [content query](guide/lifecycle-hooks#using-aftercontent-hooks \"See more about using content queries.\").\n *   The token is used as a type specifier for constructor injection.\n \n-In the following example, both uses of the `OtherComponent` token cause retention of `OtherComponent` \\(that is, prevent it from being tree-shaken when it is not used\\).\n+In the following example, both uses of the `OtherComponent` token cause retention of `OtherComponent`, preventing it from being tree-shaken when it is not used.\n \n <code-example format=\"typescript\" language=\"typescript\">\n \n@@ -96,7 +96,7 @@ class MyComponent {\n \n Although tokens used only as type specifiers are removed when converted to JavaScript, all tokens used for dependency injection are needed at runtime.\n These effectively change `constructor(@Optional() other: OtherComponent)` to `constructor(@Optional() @Inject(OtherComponent) other)`.\n-The token is now in a value position, and causes the tree shaker to retain the reference.\n+The token is now in a value position, and causes the tree shaker to keep the reference.\n \n <div class=\"alert is helpful\">\n \n@@ -107,7 +107,7 @@ For all services, a library should use [tree-shakable providers](guide/architect\n ## Using lightweight injection tokens\n \n The lightweight injection token design pattern consists of using a small abstract class as an injection token, and providing the actual implementation at a later stage.\n-The abstract class is retained \\(not tree-shaken\\), but it is small and has no material impact on the application size.\n+The abstract class is retained, not tree-shaken, but it is small and has no material impact on the application size.\n \n The following example shows how this works for the `LibHeaderComponent`.\n \n@@ -152,9 +152,9 @@ To summarize, the lightweight injection token pattern consists of the following.\n ### Use the lightweight injection token for API definition\n \n A component that injects a lightweight injection token might need to invoke a method in the injected class.\n-Because the token is now an abstract class, and the injectable component implements that class, you must also declare an abstract method in the abstract lightweight injection token class.\n-The implementation of the method \\(with all of its code overhead\\) resides in the injectable component that can be tree-shaken.\n-This lets the parent communicate with the child \\(if it is present\\) in a type-safe manner.\n+The token is now an abstract class. Since the injectable component implements that class, you must also declare an abstract method in the abstract lightweight injection token class.\n+The implementation of the method, with all its code overhead, resides in the injectable component that can be tree-shaken.\n+This lets the parent communicate with the child, if it is present, in a type-safe manner.\n \n For example, the `LibCardComponent` now queries `LibHeaderToken` rather than `LibHeaderComponent`.\n The following example shows how the pattern lets `LibCardComponent` communicate with the `LibHeaderComponent` without actually referring to `LibHeaderComponent`.\n@@ -193,7 +193,7 @@ class LibCardComponent implement AfterContentInit {\n \n </code-example>\n \n-In this example the parent  queries the token to obtain the child component, and stores the resulting component reference if it is present.\n+In this example the parent  queries the token to get the child component, and stores the resulting component reference if it is present.\n Before calling a method in the child, the parent component checks to see if the child component is present.\n If the child component has been tree-shaken, there is no runtime reference to it, and no call to its method.\n \n@@ -203,7 +203,7 @@ Lightweight injection tokens are only useful with components.\n The Angular style guide suggests that you name components using the \"Component\" suffix.\n The example \"LibHeaderComponent\" follows this convention.\n \n-To maintain the relationship between the component and its token while still distinguishing between them, the recommended style is to use the component base name with the suffix \"`Token`\" to name your lightweight injection tokens: \"`LibHeaderToken`\".\n+You should maintain the relationship between the component and its token while still distinguishing between them. The recommended style is to use the component base name with the suffix \"`Token`\" to name your lightweight injection tokens: \"`LibHeaderToken`.\"\n \n <!-- links -->\n \n\n\n###\n\n", "completion": "docs: fix linter errors for lightweight-injection-tokens.md (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/lazy-loading-ngmodules.md | file path B: aio/content/guide/lazy-loading-ngmodules.md\n\n@@ -1,6 +1,6 @@\n # Lazy-loading feature modules\n \n-By default, NgModules are eagerly loaded, which means that as soon as the application loads, so do all the NgModules, whether or not they are immediately necessary.\n+By default, NgModules are eagerly loaded. This means that as soon as the application loads, so do all the NgModules, whether they are immediately necessary or not.\n For large applications with lots of routes, consider lazy loading &mdash;a design pattern that loads NgModules as needed.\n Lazy loading helps keep initial bundle sizes smaller, which in turn helps decrease load times.\n \n@@ -50,37 +50,42 @@ For step-by-step instructions on lazy loading modules, continue with the followi\n \n ## Step-by-step setup\n \n-There are two main steps to setting up a lazy-loaded feature module:\n+Setting up a lazy-loaded feature module requires two main steps:\n \n-1.  Create the feature module with the CLI, using the `--route` flag.\n+1.  Create the feature module with the Angular CLI, using the `--route` flag.\n 1.  Configure the routes.\n \n-### Set up an app\n+### Set up an application\n+\n+If you don't already have an application, follow the following steps to create one with the Angular CLI.\n+If you already have an application, skip to [Configure the routes](#config-routes).\n+\n+<!-- vale Angular.Google_WordListWarnings = NO -->\n \n-If you don't already have an app, follow the following steps to create one with the CLI.\n-If you already have an app, skip to [Configure the routes](#config-routes).\n Enter the following command where `customer-app` is the name of your app:\n \n+<!-- vale Angular.Google_WordListWarnings = YES -->\n+\n <code-example format=\"shell\" language=\"shell\">\n \n ng new customer-app --routing\n \n </code-example>\n \n-This creates an application called `customer-app` and the `--routing` flag generates a file called `app-routing.module.ts`, which is one of the files you need for setting up lazy loading for your feature module.\n+This creates an application called `customer-app` and the `--routing` flag generates a file called `app-routing.module.ts`. This is one of the files you need for setting up lazy loading for your feature module.\n Navigate into the project by issuing the command `cd customer-app`.\n \n <div class=\"alert is-helpful\">\n \n-The `--routing` option requires Angular/CLI version 8.1 or higher.\n+The `--routing` option requires Angular CLI version 8.1 or higher.\n See [Keeping Up to Date](guide/updating).\n \n </div>\n \n ### Create a feature module with routing\n \n-Next, you'll need a feature module with a component to route to.\n-To make one, enter the following command in the terminal, where `customers` is the name of the feature module.\n+Next, you need a feature module with a component to route to.\n+To make one, enter the following command in the command line tool, where `customers` is the name of the feature module.\n The path for loading the `customers` feature modules is also `customers` because it is specified with the `--route` option:\n \n <code-example format=\"shell\" language=\"shell\">\n@@ -89,10 +94,10 @@ ng generate module customers --route customers --module app.module\n \n </code-example>\n \n-This creates a `customers` folder having the new lazy-loadable feature module `CustomersModule` defined in the `customers.module.ts` file and the routing module `CustomersRoutingModule` defined in the `customers-routing.module.ts` file.\n+This creates a `customers` directory having the new lazy-loadable feature module `CustomersModule` defined in the `customers.module.ts` file and the routing module `CustomersRoutingModule` defined in the `customers-routing.module.ts` file.\n The command automatically declares the `CustomersComponent` and imports `CustomersRoutingModule` inside the new feature module.\n \n-Because the new module is meant to be lazy-loaded, the command does NOT add a reference to the new feature module in the application's root module file, `app.module.ts`.\n+Because the new module is meant to be lazy-loaded, the command does **not** add a reference to it in the application's root module file, `app.module.ts`.\n Instead, it adds the declared route, `customers` to the `routes` array declared in the module provided as the `--module` option.\n \n <code-example header=\"src/app/app-routing.module.ts\" path=\"lazy-loading-ngmodules/src/app/app-routing.module.ts\" region=\"routes-customers\"></code-example>\n@@ -105,9 +110,9 @@ The import path is the relative path to the module.\n <header>String-based lazy loading</header>\n \n In Angular version 8, the string syntax for the `loadChildren` route specification [was deprecated](guide/deprecations#loadchildren-string-syntax) in favor of the `import()` syntax.\n-However, you can opt into using string-based lazy loading \\(`loadChildren: './path/to/module#Module'`\\) by including the lazy-loaded routes in your `tsconfig` file, which includes the lazy-loaded files in the compilation.\n+You can opt into using string-based lazy loading \\(`loadChildren: './path/to/module#Module'`\\) by including the lazy-loaded routes in your `tsconfig` file, which includes the lazy-loaded files in the compilation.\n \n-By default the CLI generates projects with stricter file inclusions intended to be used with the `import()` syntax.\n+By default the Angular CLI generates projects with stricter file inclusions intended to be used with the `import()` syntax.\n \n </div>\n \n@@ -121,7 +126,7 @@ ng generate module orders --route orders --module app.module\n \n </code-example>\n \n-This creates a new folder called `orders` containing the `OrdersModule` and `OrdersRoutingModule`, along with the new `OrdersComponent` source files.\n+This creates a new directory called `orders` containing the `OrdersModule` and `OrdersRoutingModule`, along with the new `OrdersComponent` source files.\n The `orders` route, specified with the `--route` option, is added to the `routes` array inside the `app-routing.module.ts` file, using the lazy-loading syntax.\n \n <code-example header=\"src/app/app-routing.module.ts\" path=\"lazy-loading-ngmodules/src/app/app-routing.module.ts\" region=\"routes-customers-orders\"></code-example>\n@@ -133,7 +138,7 @@ Replace the default placeholder markup in `app.component.html` with a custom nav\n \n <code-example header=\"app.component.html\" path=\"lazy-loading-ngmodules/src/app/app.component.html\" region=\"app-component-template\" header=\"src/app/app.component.html\"></code-example>\n \n-To see your application in the browser so far, enter the following command in the terminal window:\n+To see your application in the browser so far, enter the following command in the command line tool window:\n \n <code-example format=\"shell\" language=\"shell\">\n \n@@ -141,21 +146,25 @@ ng serve\n \n </code-example>\n \n+<!-- vale Angular.Google_WordListWarnings = NO -->\n+\n Then go to `localhost:4200` where you should see \"customer-app\" and three buttons.\n \n+<!-- vale Angular.Google_WordListWarnings = YES -->\n+\n <div class=\"lightbox\">\n \n <img alt=\"three buttons in the browser\" src=\"generated/images/guide/lazy-loading-ngmodules/three-buttons.png\" width=\"300\">\n \n </div>\n \n-These buttons work, because the CLI automatically added the routes to the feature modules to the `routes` array in `app-routing.module.ts`.\n+These buttons work, because the Angular CLI automatically added the routes to the feature modules to the `routes` array in `app-routing.module.ts`.\n \n <a id=\"config-routes\"></a>\n \n ### Imports and route configuration\n \n-The CLI automatically added each feature module to the routes map at the application level.\n+The Angular CLI automatically added each feature module to the routes map at the application level.\n Finish this off by adding the default route.\n In the `app-routing.module.ts` file, update the `routes` array with the following:\n \n@@ -168,7 +177,7 @@ The empty path matches everything that doesn't match an earlier path.\n ### Inside the feature module\n \n Next, take a look at the `customers.module.ts` file.\n-If you're using the CLI and following the steps outlined in this page, you don't have to do anything here.\n+If you're using the Angular CLI and following the steps outlined in this page, you don't have to do anything here.\n \n <code-example header=\"src/app/customers/customers.module.ts\" path=\"lazy-loading-ngmodules/src/app/customers/customers.module.ts\" id=\"customers.module.ts\" region=\"customers-module\"></code-example>\n \n@@ -192,7 +201,7 @@ The other feature module's routing module is configured similarly.\n \n ### Verify lazy loading\n \n-You can check to see that a module is indeed being lazy loaded with the Chrome developer tools.\n+You can verify that a module is indeed being lazy loaded with the Chrome developer tools.\n In Chrome, open the developer tools by pressing `Cmd+Option+i` on a Mac or `Ctrl+Shift+j` on a PC and go to the Network Tab.\n \n <div class=\"lightbox\">\n@@ -211,7 +220,7 @@ A chunk should appear for Orders and for Customers but only appears once for eac\n \n </div>\n \n-To see it again, or to test after working in the project, clear everything out by clicking the circle with a line through it in the upper left of the Network Tab:\n+To see it again, or to test after making changes, click the circle with a line through it in the upper left of the Network Tab:\n \n <div class=\"lightbox\">\n \n@@ -223,13 +232,13 @@ Then reload with `Cmd+r` or `Ctrl+r`, depending on your platform.\n \n ## `forRoot()` and `forChild()`\n \n-You might have noticed that the CLI adds `RouterModule.forRoot(routes)` to the `AppRoutingModule` `imports` array.\n+You might have noticed that the Angular CLI adds `RouterModule.forRoot(routes)` to the `AppRoutingModule` `imports` array.\n This lets Angular know that the `AppRoutingModule` is a routing module and `forRoot()` specifies that this is the root routing module.\n It configures all the routes you pass to it, gives you access to the router directives, and registers the `Router` service.\n Use `forRoot()` only once in the application, inside the `AppRoutingModule`.\n \n-The CLI also adds `RouterModule.forChild(routes)` to feature routing modules.\n-This way, Angular knows that the route list is only responsible for providing additional routes and is intended for feature modules.\n+The Angular CLI also adds `RouterModule.forChild(routes)` to feature routing modules.\n+This way, Angular knows that the route list is only responsible for providing extra routes and is intended for feature modules.\n You can use `forChild()` in multiple modules.\n \n The `forRoot()` method takes care of the *global* injector configuration for the Router.\n@@ -246,7 +255,7 @@ You can preload modules or component data.\n \n ### Preloading modules\n \n-Preloading modules improves UX by loading parts of your application in the background so users don't have to wait for the elements to download when they activate a route.\n+Preloading modules improves UX by loading parts of your application in the background. By doing this, users don't have to wait for the elements to download when they activate a route.\n \n To enable preloading of all lazy loaded modules, import the `PreloadAllModules` token from the Angular `router`.\n \n@@ -277,7 +286,7 @@ Resolvers improve UX by blocking the page load until all necessary data is avail\n #### Resolvers\n \n Create a resolver service.\n-With the CLI, the command to generate a service is as follows:\n+With the Angular CLI, the command to create a service is as follows:\n \n <code-example format=\"shell\" language=\"shell\">\n \n@@ -285,7 +294,7 @@ ng generate service &lt;service-name&gt;\n \n </code-example>\n \n-In the newly-created service, implement the `Resolve` interface provided by the `&commat;angular/router` package:\n+In the newly created service, implement the `Resolve` interface provided by the `&commat;angular/router` package:\n \n <code-example header=\"Resolver service (excerpt)\">\n \n@@ -318,6 +327,7 @@ import { CrisisDetailResolverService } from './crisis-detail-resolver.service';\n Add a `resolve` object to the component's `route` configuration.\n \n <code-example header=\"Feature module's routing module (excerpt)\">\n+\n {\n   path: '/your-path',\n   component: YourComponent,\n@@ -325,6 +335,7 @@ Add a `resolve` object to the component's `route` configuration.\n     crisis: CrisisDetailResolverService\n   }\n }\n+\n </code-example>\n \n In the component's constructor, inject an instance of the `ActivatedRoute` class that represents the current route.\n@@ -367,8 +378,8 @@ For more information with a working example, see the [routing tutorial section o\n \n A common error when lazy-loading modules is importing common modules in multiple places within an application.\n Test for this condition by first generating the module using the Angular CLI and including the `--route route-name` parameter, where `route-name` is the name of your module.\n-Next, generate the module without the `--route` parameter.\n-If the Angular CLI generates an error when you use the `--route` parameter, but runs correctly without it, you might have imported the same module in multiple places.\n+Next, create the module without the `--route` parameter.\n+If `ng generate module` with the `--route` parameter returns an error, but runs correctly without it, you might have imported the same module in multiple places.\n \n Remember, many common Angular modules should be imported at the base of your application.\n \n\n\n###\n\n", "completion": "docs: fix linter errors for lazy-loading-ngmodules.md (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/libraries.md | file path B: aio/content/guide/libraries.md\n\n@@ -7,8 +7,8 @@ Such a solution can be built as Angular *libraries* and these libraries can be p\n An Angular library is an Angular [project](guide/glossary#project) that differs from an application in that it cannot run on its own.\n A library must be imported and used in an application.\n \n-Libraries extend Angular's base functionality.\n-For example, to add [reactive forms](guide/reactive-forms) to an app, add the library package using `ng add @angular/forms`, then import the `ReactiveFormsModule` from the `@angular/forms` library in your application code.\n+Libraries extend Angular's base features.\n+For example, to add [reactive forms](guide/reactive-forms) to an application, add the library package using `ng add @angular/forms`, then import the `ReactiveFormsModule` from the `@angular/forms` library in your application code.\n Similarly, adding the [service worker](guide/service-worker-intro) library to an Angular application is one of the steps for turning an application into a [Progressive Web App](https://developers.google.com/web/progressive-web-apps) \\(PWA\\).\n [Angular Material](https://material.angular.io) is an example of a large, general-purpose library that provides sophisticated, reusable, and adaptable UI components.\n \n@@ -17,25 +17,25 @@ See [Using Published Libraries](guide/using-libraries).\n \n ## Creating libraries\n \n-If you have developed functionality that is suitable for reuse, you can create your own libraries.\n+If you have developed features that are suitable for reuse, you can create your own libraries.\n These libraries can be used locally in your workspace, or you can publish them as [npm packages](guide/npm-packages) to share with other projects or other Angular developers.\n These packages can be published to the npm registry, a private npm Enterprise registry, or a private package management system that supports npm packages.\n See [Creating Libraries](guide/creating-libraries).\n \n-Whether you decide to package functionality as a library is an architectural decision, similar to deciding whether a piece of functionality is a component or a service, or deciding on the scope of a component.\n+Deciding to package features as a library is an architectural decision. It is comparable to deciding whether a feature is a component or a service, or deciding on the scope of a component.\n \n-Packaging functionality as a library forces the artifacts in the library to be decoupled from the application's business logic.\n+Packaging features as a library forces the artifacts in the library to be decoupled from the application's business logic.\n This can help to avoid various bad practices or architecture mistakes that can make it difficult to decouple and reuse code in the future.\n \n Putting code into a separate library is more complex than simply putting everything in one application.\n It requires more of an investment in time and thought for managing, maintaining, and updating the library.\n-This complexity can pay off, however, when the library is being used in multiple applications.\n+This complexity can pay off when the library is being used in multiple applications.\n \n <div class=\"alert is-helpful\">\n \n **NOTE**: <br />\n Libraries are intended to be used by Angular applications.\n-To add Angular functionality to non-Angular web applications, use [Angular custom elements](guide/elements).\n+To add Angular features to non-Angular web applications, use [Angular custom elements](guide/elements).\n \n </div>\n \n\n\n###\n\n", "completion": "docs: fix linter errors for libraries.md (#<issue-num>)"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -62,8 +62,9 @@\n \n version: 3\n \n-# availability:\n-#   users_unavailable:\n+availability:\n+  users_unavailable:\n+    - atscott\n \n # Meta field that goes unused by PullApprove to allow for defining aliases to be\n # used throughout the config.\n\n\n###\n\n", "completion": "build: add atscott to unavailable list for pullapprove (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/typecheck/api/checker.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/api/checker.ts\n\n@@ -14,7 +14,7 @@ import {ErrorCode} from '../../diagnostics';\n \n import {FullTemplateMapping, NgTemplateDiagnostic, TypeCheckableDirectiveMeta} from './api';\n import {GlobalCompletion} from './completion';\n-import {PotentialDirective, PotentialPipe} from './scope';\n+import {PotentialDirective, PotentialImport, PotentialPipe} from './scope';\n import {ElementSymbol, Symbol, TcbLocation, TemplateSymbol} from './symbols';\n \n /**\n@@ -146,6 +146,12 @@ export interface TemplateTypeChecker {\n    */\n   getPotentialElementTags(component: ts.ClassDeclaration): Map<string, PotentialDirective|null>;\n \n+  /**\n+   * In the context of an Angular trait, generate potential imports for a directive.\n+   */\n+  getPotentialImportsFor(directive: PotentialDirective, inComponent: ts.ClassDeclaration):\n+      ReadonlyArray<PotentialImport>;\n+\n   /**\n    * Get the primary decorator for an Angular class (such as @Component). This does not work for\n    * `@Injectable`.\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/api/scope.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/api/scope.ts\n\n@@ -12,6 +12,24 @@ import {EmittedReference, Reference} from '../../imports';\n import {ClassDeclaration} from '../../reflection';\n import {SymbolWithValueDeclaration} from '../../util/src/typescript';\n \n+/**\n+ * A PotentialImport for some Angular trait has a TypeScript module specifier, which can be\n+ * relative, as well as an identifier name.\n+ */\n+export interface PotentialImport {\n+  kind: PotentialImportKind;\n+  moduleSpecifier: string;\n+  symbolName: string;\n+}\n+\n+/**\n+ * Which kind of Angular Trait the import targets.\n+ */\n+export enum PotentialImportKind {\n+  NgModule,\n+  Standalone,\n+}\n+\n /**\n  * Metadata on a directive which is available in a template.\n  */\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/src/checker.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/src/checker.ts\n\n@@ -6,21 +6,21 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {AST, CssSelector, DomElementSchemaRegistry, LiteralPrimitive, ParseSourceSpan, PropertyRead, SafePropertyRead, TmplAstElement, TmplAstNode, TmplAstReference, TmplAstTemplate, TmplAstTextAttribute} from '@angular/compiler';\n+import {AST, CssSelector, DomElementSchemaRegistry, ExternalExpr, LiteralPrimitive, ParseSourceSpan, PropertyRead, SafePropertyRead, TmplAstElement, TmplAstNode, TmplAstReference, TmplAstTemplate, TmplAstTextAttribute} from '@angular/compiler';\n import ts from 'typescript';\n \n import {ErrorCode, ngErrorCode} from '../../diagnostics';\n import {absoluteFrom, absoluteFromSourceFile, AbsoluteFsPath, getSourceFileOrError} from '../../file_system';\n-import {Reference, ReferenceEmitter} from '../../imports';\n+import {Reference, ReferenceEmitKind, ReferenceEmitter} from '../../imports';\n import {IncrementalBuild} from '../../incremental/api';\n-import {DirectiveMeta, MetadataReader, MetadataReaderWithIndex, MetaKind} from '../../metadata';\n+import {DirectiveMeta, MetadataReader, MetadataReaderWithIndex, MetaKind, NgModuleMeta} from '../../metadata';\n import {PerfCheckpoint, PerfEvent, PerfPhase, PerfRecorder} from '../../perf';\n import {ProgramDriver, UpdateMode} from '../../program_driver';\n import {ClassDeclaration, DeclarationNode, isNamedClassDeclaration, ReflectionHost} from '../../reflection';\n import {ComponentScopeKind, ComponentScopeReader, TypeCheckScopeRegistry} from '../../scope';\n import {isShim} from '../../shims';\n import {getSourceFileOrNull, isSymbolWithValueDeclaration} from '../../util/src/typescript';\n-import {ElementSymbol, FullTemplateMapping, GlobalCompletion, NgTemplateDiagnostic, OptimizeFor, PotentialDirective, PotentialPipe, ProgramTypeCheckAdapter, Symbol, TcbLocation, TemplateDiagnostic, TemplateId, TemplateSymbol, TemplateTypeChecker, TypeCheckableDirectiveMeta, TypeCheckingConfig} from '../api';\n+import {ElementSymbol, FullTemplateMapping, GlobalCompletion, NgTemplateDiagnostic, OptimizeFor, PotentialDirective, PotentialImport, PotentialImportKind, PotentialPipe, ProgramTypeCheckAdapter, Symbol, TcbLocation, TemplateDiagnostic, TemplateId, TemplateSymbol, TemplateTypeChecker, TypeCheckableDirectiveMeta, TypeCheckingConfig} from '../api';\n import {makeTemplateDiagnostic} from '../diagnostics';\n \n import {CompletionEngine} from './completion';\n@@ -673,6 +673,39 @@ export class TemplateTypeCheckerImpl implements TemplateTypeChecker {\n     return scope.ngModule;\n   }\n \n+  getPotentialImportsFor(toImport: PotentialDirective, inContext: ts.ClassDeclaration):\n+      ReadonlyArray<PotentialImport> {\n+    // Look up the original reference associated with the trait's ngModule, so we don't lose the\n+    // Reference context (such as identifiers). If the trait is standalone, this will be\n+    // `undefined`.\n+    let ngModuleRef: Reference<ClassDeclaration<DeclarationNode>>|undefined;\n+    if (toImport.ngModule !== null) {\n+      ngModuleRef = this.metaReader.getNgModuleMetadata(new Reference(toImport.ngModule))?.ref;\n+    }\n+\n+    // Import the ngModule if one exists. Otherwise, import the standalone trait directly.\n+    const importTarget = ngModuleRef ?? toImport.ref;\n+\n+    // Using the compiler's ReferenceEmitter, try to emit a reference to the trait.\n+    // TODO(dylhunn): In the future, we can use a more sophisticated strategy for generating and\n+    // ranking references, such as keeping a record of import specifiers used in existing code.\n+    const emittedRef = this.refEmitter.emit(importTarget, inContext.getSourceFile());\n+    if (emittedRef.kind === ReferenceEmitKind.Failed) return [];\n+\n+    // The resulting import expression should have a module name and an identifier name.\n+    const emittedExpression: ExternalExpr = emittedRef.expression as ExternalExpr;\n+    if (emittedExpression.value.moduleName === null || emittedExpression.value.name === null)\n+      return [];\n+\n+    // Extract and return the TS module and identifier names.\n+    const preferredImport: PotentialImport = {\n+      kind: ngModuleRef ? PotentialImportKind.NgModule : PotentialImportKind.Standalone,\n+      moduleSpecifier: emittedExpression.value.moduleName,\n+      symbolName: emittedExpression.value.name,\n+    };\n+    return [preferredImport];\n+  }\n+\n   private getScopeData(component: ts.ClassDeclaration): ScopeData|null {\n     if (this.scopeCache.has(component)) {\n       return this.scopeCache.get(component)!;\n\n---\n file path A: packages/compiler-cli/test/ngtsc/ls_typecheck_helpers_spec.ts | file path B: packages/compiler-cli/test/ngtsc/ls_typecheck_helpers_spec.ts\n\n@@ -201,5 +201,98 @@ runInEachFileSystem(() => {\n         expect(directives.map(d => d.selector)).toContain('two-cmp');\n       });\n     });\n+\n+    describe('can generate imports` ', () => {\n+      it('for out of scope standalone components', () => {\n+        env.write('one.ts', `\n+\t\t\t import {Component} from '@angular/core';\n+\t \n+\t\t\t @Component({\n+\t\t\t\t standalone: true,\n+\t\t\t\t selector: 'one-cmp',\n+\t\t\t\t template: '<div></div>',\n+\t\t\t })\n+\t\t\t export class OneCmp {}\n+\t\t\t `);\n+\n+        env.write('two.ts', `\n+\t\t\t import {Component} from '@angular/core';\n+\t \n+\t\t\t @Component({\n+\t\t\t\t standalone: true,\n+\t\t\t\t selector: 'two-cmp',\n+\t\t\t\t template: '<div></div>',\n+\t\t\t })\n+\t\t\t export class TwoCmp {}\n+\t\t\t `);\n+        const {program, checker} = env.driveTemplateTypeChecker();\n+        const sfOne = program.getSourceFile(_('/one.ts'));\n+        expect(sfOne).not.toBeNull();\n+        const OneCmpClass = getClass(sfOne!, 'OneCmp');\n+\n+        const TwoCmpDir = checker.getPotentialTemplateDirectives(OneCmpClass)\n+                              .filter(d => d.selector === 'two-cmp')[0];\n+        const imports = checker.getPotentialImportsFor(TwoCmpDir, OneCmpClass);\n+\n+        expect(imports.length).toBe(1);\n+        expect(imports[0].moduleSpecifier).toBe('./two');\n+        expect(imports[0].symbolName).toBe('TwoCmp');\n+      });\n+\n+      it('for out of scope ngModules', () => {\n+        env.write('one.ts', `\n+\t\t\t import {Component} from '@angular/core';\n+\t \n+\t\t\t @Component({\n+\t\t\t\t standalone: true,\n+\t\t\t\t selector: 'one-cmp',\n+\t\t\t\t template: '<div></div>',\n+\t\t\t })\n+\t\t\t export class OneCmp {}\n+\t\t\t `);\n+\n+        env.write('two.ts', `\n+\t\t\t import {Component} from '@angular/core';\n+\t \n+\t\t\t @Component({\n+\t\t\t\t selector: 'two-cmp',\n+\t\t\t\t template: '<div></div>',\n+\t\t\t })\n+\t\t\t export class TwoCmp {}\n+\t\t\t `);\n+\n+        env.write('twomod.ts', `\n+\t\t\timport { NgModule } from '@angular/core';\n+\t\t\timport { CommonModule } from '@angular/common';\n+\t\t\timport { TwoCmp } from './two';\n+\t\t\t\n+\t\t\t@NgModule({\n+\t\t\tdeclarations: [\n+\t\t\t\tTwoCmp\n+\t\t\t],\n+\t\t\texports: [\n+\t\t\t\tTwoCmp\n+\t\t\t],\n+\t\t\timports: [\n+\t\t\t\tCommonModule\n+\t\t\t]\n+\t\t\t})\n+\t\t\texport class TwoModule { }\n+\t\t\t `);\n+\n+        const {program, checker} = env.driveTemplateTypeChecker();\n+        const sfOne = program.getSourceFile(_('/one.ts'));\n+        expect(sfOne).not.toBeNull();\n+        const OneCmpClass = getClass(sfOne!, 'OneCmp');\n+\n+        const TwoNgMod = checker.getPotentialTemplateDirectives(OneCmpClass)\n+                             .filter(d => d.selector === 'two-cmp')[0];\n+        const imports = checker.getPotentialImportsFor(TwoNgMod, OneCmpClass);\n+\n+        expect(imports.length).toBe(1);\n+        expect(imports[0].moduleSpecifier).toBe('./twomod');\n+        expect(imports[0].symbolName).toBe('TwoModule');\n+      });\n+    });\n   });\n });\n\n\n###\n\n", "completion": "refactor(compiler): Add `getPotentialImportsFor` method on template type checker (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/core/src/host.ts | file path B: packages/compiler-cli/src/ngtsc/core/src/host.ts\n\n@@ -68,7 +68,7 @@ export class DelegatingCompilerHost implements\n   useCaseSensitiveFileNames = this.delegateMethod('useCaseSensitiveFileNames');\n   writeFile = this.delegateMethod('writeFile');\n   getModuleResolutionCache = this.delegateMethod('getModuleResolutionCache');\n-  // @ts-expect-error 'hasInvalidatedResolutions' is visible (and thus required here) in latest TSC\n+  // @ts-ignore 'hasInvalidatedResolutions' is visible (and thus required here) in latest TSC\n   // main. It's already present, so the code works at runtime.\n   // TODO: remove this comment including the suppression once Angular uses a TSC version that\n   // includes this change (github.com/microsoft/TypeScript@a455955).\n\n---\n file path A: packages/compiler-cli/src/ngtsc/program_driver/src/ts_create_program_driver.ts | file path B: packages/compiler-cli/src/ngtsc/program_driver/src/ts_create_program_driver.ts\n\n@@ -52,7 +52,7 @@ export class DelegatingCompilerHost implements\n   trace = this.delegateMethod('trace');\n   useCaseSensitiveFileNames = this.delegateMethod('useCaseSensitiveFileNames');\n   getModuleResolutionCache = this.delegateMethod('getModuleResolutionCache');\n-  // @ts-expect-error 'hasInvalidatedResolutions' is visible (and thus required here) in latest TSC\n+  // @ts-ignore 'hasInvalidatedResolutions' is visible (and thus required here) in latest TSC\n   // main. It's already present, so the code works at runtime.\n   // TODO: remove this comment including the suppression once Angular uses a TSC version that\n   // includes this change (github.com/microsoft/TypeScript@a455955).\n\n\n###\n\n", "completion": "fix(compiler-cli): use @ts-ignore. (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -288,14 +288,12 @@ export const enum EventType {\n }\n \n // @public\n-export interface ExtraOptions extends InMemoryScrollingOptions, RouterConfigOptions {\n+export interface ExtraOptions extends InMemoryScrollingOptions, RouterConfigOptions, InternalExtraOptions {\n     enableTracing?: boolean;\n     errorHandler?: ErrorHandler;\n     initialNavigation?: InitialNavigation;\n     malformedUriErrorHandler?: (error: URIError, urlSerializer: UrlSerializer, url: string) => UrlTree;\n     preloadingStrategy?: any;\n-    // @deprecated\n-    relativeLinkResolution?: 'legacy' | 'corrected';\n     scrollOffset?: [number, number] | (() => [number, number]);\n     useHash?: boolean;\n }\n@@ -653,8 +651,6 @@ export class Router {\n     onSameUrlNavigation: 'reload' | 'ignore';\n     paramsInheritanceStrategy: 'emptyOnly' | 'always';\n     parseUrl(url: string): UrlTree;\n-    // @deprecated\n-    relativeLinkResolution: 'legacy' | 'corrected';\n     resetConfig(config: Routes): void;\n     routeReuseStrategy: RouteReuseStrategy;\n     readonly routerState: RouterState;\n\n---\n file path A: packages/router/src/patchable_relative_link_resolution.ts | file path B: packages/router/src/patchable_relative_link_resolution.ts\n\n@@ -11,3 +11,5 @@\n  */\n export function assignRelativeLinkResolution(\n     router: {relativeLinkResolution: 'legacy'|'corrected'}): void {}\n+\n+export interface InternalExtraOptions {}\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -310,10 +310,6 @@ export function assignExtraOptionsToRouter(opts: ExtraOptions, router: Router):\n     router.paramsInheritanceStrategy = opts.paramsInheritanceStrategy;\n   }\n \n-  if (opts.relativeLinkResolution) {\n-    router.relativeLinkResolution = opts.relativeLinkResolution;\n-  }\n-\n   if (opts.urlUpdateStrategy) {\n     router.urlUpdateStrategy = opts.urlUpdateStrategy;\n   }\n@@ -531,10 +527,9 @@ export class Router {\n   urlUpdateStrategy: 'deferred'|'eager' = 'deferred';\n \n   /**\n-   * Enables a bug fix that corrects relative link resolution in components with empty paths.\n-   * @see `RouterModule`\n-   *\n-   * @deprecated\n+   * TODO(atscott): Remove all references to relativeLinkResolution when internal cleanup is\n+   * finished.\n+   * @internal\n    */\n   relativeLinkResolution: 'legacy'|'corrected' = 'corrected';\n \n\n---\n file path A: packages/router/src/router_config.ts | file path B: packages/router/src/router_config.ts\n\n@@ -8,6 +8,7 @@\n \n import {InjectionToken} from '@angular/core';\n \n+import {InternalExtraOptions} from './patchable_relative_link_resolution';\n import {UrlSerializer, UrlTree} from './url_tree';\n \n const NG_DEV_MODE = typeof ngDevMode === 'undefined' || !!ngDevMode;\n@@ -172,7 +173,8 @@ export interface InMemoryScrollingOptions {\n  *\n  * @publicApi\n  */\n-export interface ExtraOptions extends InMemoryScrollingOptions, RouterConfigOptions {\n+export interface ExtraOptions extends InMemoryScrollingOptions, RouterConfigOptions,\n+                                      InternalExtraOptions {\n   /**\n    * When true, log all internal navigation events to the console.\n    * Use for debugging.\n@@ -234,42 +236,6 @@ export interface ExtraOptions extends InMemoryScrollingOptions, RouterConfigOpti\n    * */\n   malformedUriErrorHandler?:\n       (error: URIError, urlSerializer: UrlSerializer, url: string) => UrlTree;\n-\n-  /**\n-   * Enables a bug fix that corrects relative link resolution in components with empty paths.\n-   * Example:\n-   *\n-   * ```\n-   * const routes = [\n-   *   {\n-   *     path: '',\n-   *     component: ContainerComponent,\n-   *     children: [\n-   *       { path: 'a', component: AComponent },\n-   *       { path: 'b', component: BComponent },\n-   *     ]\n-   *   }\n-   * ];\n-   * ```\n-   *\n-   * From the `ContainerComponent`, you should be able to navigate to `AComponent` using\n-   * the following `routerLink`, but it will not work if `relativeLinkResolution` is set\n-   * to `'legacy'`:\n-   *\n-   * `<a [routerLink]=\"['./a']\">Link to A</a>`\n-   *\n-   * However, this will work:\n-   *\n-   * `<a [routerLink]=\"['../a']\">Link to A</a>`\n-   *\n-   * In other words, you're required to use `../` rather than `./` when the relative link\n-   * resolution is set to `'legacy'`.\n-   *\n-   * The default in v11 is `corrected`.\n-   *\n-   * @deprecated\n-   */\n-  relativeLinkResolution?: 'legacy'|'corrected';\n }\n \n /**\n\n---\n file path A: packages/router/test/integration.spec.ts | file path B: packages/router/test/integration.spec.ts\n\n@@ -83,45 +83,22 @@ describe('Integration', () => {\n          ]);\n        })));\n \n-    describe('relativeLinkResolution', () => {\n-      beforeEach(inject([Router], (router: Router) => {\n-        router.resetConfig([{\n-          path: 'foo',\n-          children: [{path: 'bar', children: [{path: '', component: RelativeLinkCmp}]}]\n-        }]);\n-      }));\n-\n-      it('should not ignore empty paths in legacy mode',\n-         fakeAsync(inject([Router], (router: Router) => {\n-           const warnSpy = spyOn(console, 'warn');\n-           router.relativeLinkResolution = 'legacy';\n \n-           const fixture = createRoot(router, RootCmp);\n-\n-           router.navigateByUrl('/foo/bar');\n-           advance(fixture);\n-\n-           const link = fixture.nativeElement.querySelector('a');\n-           expect(link.getAttribute('href')).toEqual('/foo/bar/simple');\n-           expect(warnSpy.calls.first().args[0])\n-               .toContain('/foo/bar/simple will change to /foo/simple');\n-           expect(warnSpy.calls.first().args[0])\n-               .toContain('relativeLinkResolution: \\'legacy\\' is deprecated');\n-         })));\n-\n-      it('should ignore empty paths in corrected mode',\n-         fakeAsync(inject([Router], (router: Router) => {\n-           router.relativeLinkResolution = 'corrected';\n+    it('should ignore empty paths in relative links',\n+       fakeAsync(inject([Router], (router: Router) => {\n+         router.resetConfig([{\n+           path: 'foo',\n+           children: [{path: 'bar', children: [{path: '', component: RelativeLinkCmp}]}]\n+         }]);\n \n-           const fixture = createRoot(router, RootCmp);\n+         const fixture = createRoot(router, RootCmp);\n \n-           router.navigateByUrl('/foo/bar');\n-           advance(fixture);\n+         router.navigateByUrl('/foo/bar');\n+         advance(fixture);\n \n-           const link = fixture.nativeElement.querySelector('a');\n-           expect(link.getAttribute('href')).toEqual('/foo/simple');\n-         })));\n-    });\n+         const link = fixture.nativeElement.querySelector('a');\n+         expect(link.getAttribute('href')).toEqual('/foo/simple');\n+       })));\n \n     it('should set the restoredState to null when executing imperative navigations',\n        fakeAsync(inject([Router], (router: Router) => {\n@@ -6474,55 +6451,31 @@ describe('Integration', () => {\n          expect(relativeLinkCmp.buttonLink.urlTree.toString()).toEqual('/root/childRoot');\n        }));\n \n-    describe('relativeLinkResolution', () => {\n-      @Component({selector: 'link-cmp', template: `<a [routerLink]=\"['../simple']\">link</a>`})\n-      class RelativeLinkCmp {\n-      }\n-\n-      @NgModule({\n-        declarations: [RelativeLinkCmp],\n-        imports: [RouterModule.forChild([\n-          {path: 'foo/bar', children: [{path: '', component: RelativeLinkCmp}]},\n-        ])]\n-      })\n-      class LazyLoadedModule {\n-      }\n-\n-      it('should not ignore empty path when in legacy mode',\n-         fakeAsync(inject([Router], (router: Router) => {\n-           const warnSpy = spyOn(console, 'warn');\n-           router.relativeLinkResolution = 'legacy';\n-\n-           const fixture = createRoot(router, RootCmp);\n-\n-           router.resetConfig([{path: 'lazy', loadChildren: () => LazyLoadedModule}]);\n-\n-           router.navigateByUrl('/lazy/foo/bar');\n-           advance(fixture);\n-\n-           const link = fixture.nativeElement.querySelector('a');\n-           expect(link.getAttribute('href')).toEqual('/lazy/foo/bar/simple');\n-           expect(warnSpy.calls.first().args[0])\n-               .toContain('/lazy/foo/bar/simple will change to /lazy/foo/simple');\n-           expect(warnSpy.calls.first().args[0])\n-               .toContain('relativeLinkResolution: \\'legacy\\' is deprecated');\n-         })));\n+    it('should ignore empty path for relative links',\n+       fakeAsync(inject([Router], (router: Router) => {\n+         @Component({selector: 'link-cmp', template: `<a [routerLink]=\"['../simple']\">link</a>`})\n+         class RelativeLinkCmp {\n+         }\n \n-      it('should ignore empty path when in corrected mode',\n-         fakeAsync(inject([Router], (router: Router) => {\n-           router.relativeLinkResolution = 'corrected';\n+         @NgModule({\n+           declarations: [RelativeLinkCmp],\n+           imports: [RouterModule.forChild([\n+             {path: 'foo/bar', children: [{path: '', component: RelativeLinkCmp}]},\n+           ])]\n+         })\n+         class LazyLoadedModule {\n+         }\n \n-           const fixture = createRoot(router, RootCmp);\n+         const fixture = createRoot(router, RootCmp);\n \n-           router.resetConfig([{path: 'lazy', loadChildren: () => LazyLoadedModule}]);\n+         router.resetConfig([{path: 'lazy', loadChildren: () => LazyLoadedModule}]);\n \n-           router.navigateByUrl('/lazy/foo/bar');\n-           advance(fixture);\n+         router.navigateByUrl('/lazy/foo/bar');\n+         advance(fixture);\n \n-           const link = fixture.nativeElement.querySelector('a');\n-           expect(link.getAttribute('href')).toEqual('/lazy/foo/simple');\n-         })));\n-    });\n+         const link = fixture.nativeElement.querySelector('a');\n+         expect(link.getAttribute('href')).toEqual('/lazy/foo/simple');\n+       })));\n   });\n \n   describe('Custom Route Reuse Strategy', () => {\n\n\n###\n\n", "completion": "fix(router): Remove deprecated relativeLinkResolution (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,10 @@\n+<a name=\"14.2.5\"></a>\n+# 14.2.5 (2022-10-05)\n+## Special Thanks\n+Alexander Wiebe, Ciprian Sauliuc, Dmytro Mezhenskyi, George Kalpakas, Joe Martin (Crowdstaffing), Jordan, Ole M, Paul Gschwendtner, Pawel Kozlowski and mgechev\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.0.0-next.4\"></a>\n # 15.0.0-next.4 (2022-09-28)\n ## Breaking Changes\n\n\n###\n\n", "completion": "docs: release notes for the v14.2.5 release"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -782,7 +782,6 @@ export class RouterLinkActive implements OnChanges, OnDestroy, AfterContentInit\n \n // @public\n export class RouterLinkWithHref extends RouterLink {\n-    constructor(router: Router, route: ActivatedRoute, locationStrategy: LocationStrategy);\n     // (undocumented)\n     static \u0275dir: i0.\u0275\u0275DirectiveDeclaration<RouterLinkWithHref, \"a[routerLink],area[routerLink]\", never, {}, {}, never, never, true, never>;\n     // (undocumented)\n\n---\n file path A: packages/core/test/bundling/router/bundle.golden_symbols.json | file path B: packages/core/test/bundling/router/bundle.golden_symbols.json\n\n@@ -1091,6 +1091,9 @@\n   {\n     \"name\": \"getFactoryDef\"\n   },\n+  {\n+    \"name\": \"getFactoryOf\"\n+  },\n   {\n     \"name\": \"getFirstLContainer\"\n   },\n@@ -1355,6 +1358,9 @@\n   {\n     \"name\": \"isEmptyError\"\n   },\n+  {\n+    \"name\": \"isForwardRef\"\n+  },\n   {\n     \"name\": \"isFunction\"\n   },\n@@ -1541,6 +1547,9 @@\n   {\n     \"name\": \"noMatch2\"\n   },\n+  {\n+    \"name\": \"noSideEffects\"\n+  },\n   {\n     \"name\": \"nodeChildrenAsMap\"\n   },\n\n---\n file path A: packages/router/src/directives/router_link.ts | file path B: packages/router/src/directives/router_link.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {LocationStrategy} from '@angular/common';\n-import {Attribute, Directive, ElementRef, HostBinding, HostListener, inject, Input, OnChanges, OnDestroy, Renderer2, SimpleChanges, \u0275coerceToBoolean as coerceToBoolean, \u0275\u0275sanitizeUrlOrResourceUrl} from '@angular/core';\n+import {Attribute, Directive, ElementRef, HostBinding, HostListener, Input, OnChanges, OnDestroy, Renderer2, SimpleChanges, \u0275coerceToBoolean as coerceToBoolean, \u0275\u0275sanitizeUrlOrResourceUrl} from '@angular/core';\n import {Subject, Subscription} from 'rxjs';\n \n import {Event, NavigationEnd} from '../events';\n@@ -389,10 +389,4 @@ export class RouterLink implements OnChanges, OnDestroy {\n   standalone: true,\n })\n export class RouterLinkWithHref extends RouterLink {\n-  // For backwards compatibility, constructor arguments retained an old shape.\n-  constructor(router: Router, route: ActivatedRoute, locationStrategy: LocationStrategy) {\n-    super(\n-        router, route, undefined /* tabIndexAttribute */, inject(Renderer2), inject(ElementRef),\n-        locationStrategy);\n-  }\n }\n\n\n###\n\n", "completion": "refactor(router): drop own constructor from the `RouterLinkWithHref` class (#<issue-num>)"}
{"prompt": " file path A: goldens/size-tracking/integration-payloads.json | file path B: goldens/size-tracking/integration-payloads.json\n\n@@ -33,7 +33,7 @@\n   \"cli-hello-world-lazy\": {\n     \"uncompressed\": {\n       \"runtime\": 2835,\n-      \"main\": 225808,\n+      \"main\": 226404,\n       \"polyfills\": 33842,\n       \"src_app_lazy_lazy_routes_ts\": 487\n     }\n\n---\n file path A: packages/router/test/standalone.spec.ts | file path B: packages/router/test/standalone.spec.ts\n\n@@ -350,6 +350,7 @@ describe('standalone in Router API', () => {\n \n       const root = TestBed.createComponent(RootCmp);\n       await TestBed.inject(Router).navigateByUrl('/home');\n+      root.detectChanges();\n \n       expect(root.nativeElement.innerHTML).toContain('default exported');\n     });\n@@ -364,6 +365,7 @@ describe('standalone in Router API', () => {\n \n       const root = TestBed.createComponent(RootCmp);\n       await TestBed.inject(Router).navigateByUrl('/home');\n+      root.detectChanges();\n \n       expect(root.nativeElement.innerHTML).toContain('default exported');\n     });\n\n\n###\n\n", "completion": "test(router): Ensure change detection runs after navigation (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/standalone-components.md | file path B: aio/content/guide/standalone-components.md\n\n@@ -148,6 +148,25 @@ export const ADMIN_ROUTES: Route[] = [\n ];\n ```\n \n+### Lazy loading and default exports\n+\n+When using `loadChildren` and `loadComponent`, the router understands and automatically unwraps dynamic `import()` calls with `default` exports. You can take advantage of this to skip the `.then()` for such lazy loading operations.\n+\n+```ts\n+// In the main application:\n+export const ROUTES: Route[] = [\n+  {path: 'admin', loadChildren: () => import('./admin/routes')},\n+  // ...\n+];\n+\n+// In admin/routes.ts:\n+export default [\n+  {path: 'home', component: AdminHomeComponent},\n+  {path: 'users', component: AdminUsersComponent},\n+  // ...\n+] as Route[];\n+```\n+\n ### Providing services to a subset of routes\n \n The lazy loading API for `NgModule`s (`loadChildren`) creates a new \"module\" injector when it loads the lazily loaded children of a route. This feature was often useful to provide services only to a subset of routes in the application. For example, if all routes under `/admin` were scoped using a `loadChildren` boundary, then admin-only services could be provided only to those routes. Doing this required using the `loadChildren` API, even if lazy loading of the routes in question was unnecessary.\n\n---\n file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -212,6 +212,11 @@ export type Data = {\n // @public\n export type DebugTracingFeature = RouterFeature<RouterFeatureKind.DebugTracingFeature>;\n \n+// @public\n+export interface DefaultExport<T> {\n+    default: T;\n+}\n+\n // @public\n export class DefaultTitleStrategy extends TitleStrategy {\n     constructor(title: Title);\n@@ -359,7 +364,7 @@ export interface IsActiveMatchOptions {\n export type LoadChildren = LoadChildrenCallback | \u0275DeprecatedLoadChildren;\n \n // @public\n-export type LoadChildrenCallback = () => Type<any> | NgModuleFactory<any> | Routes | Observable<Type<any> | Routes> | Promise<NgModuleFactory<any> | Type<any> | Routes>;\n+export type LoadChildrenCallback = () => Type<any> | NgModuleFactory<any> | Routes | Observable<Type<any> | Routes | DefaultExport<Type<any>> | DefaultExport<Routes>> | Promise<NgModuleFactory<any> | Type<any> | Routes | DefaultExport<Type<any>> | DefaultExport<Routes>>;\n \n // @public\n export interface Navigation {\n@@ -588,7 +593,7 @@ export interface Route {\n     component?: Type<any>;\n     data?: Data;\n     loadChildren?: LoadChildren;\n-    loadComponent?: () => Type<unknown> | Observable<Type<unknown>> | Promise<Type<unknown>>;\n+    loadComponent?: () => Type<unknown> | Observable<Type<unknown> | DefaultExport<Type<unknown>>> | Promise<Type<unknown> | DefaultExport<Type<unknown>>>;\n     matcher?: UrlMatcher;\n     outlet?: string;\n     path?: string;\n\n---\n file path A: packages/core/test/bundling/router/bundle.golden_symbols.json | file path B: packages/core/test/bundling/router/bundle.golden_symbols.json\n\n@@ -1481,6 +1481,9 @@\n   {\n     \"name\": \"matrixParamsMatch\"\n   },\n+  {\n+    \"name\": \"maybeUnwrapDefaultExport\"\n+  },\n   {\n     \"name\": \"maybeUnwrapEmpty\"\n   },\n\n---\n file path A: packages/router/src/index.ts | file path B: packages/router/src/index.ts\n\n@@ -12,7 +12,7 @@ export {RouterLink, RouterLinkWithHref} from './directives/router_link';\n export {RouterLinkActive} from './directives/router_link_active';\n export {RouterOutlet, RouterOutletContract} from './directives/router_outlet';\n export {ActivationEnd, ActivationStart, ChildActivationEnd, ChildActivationStart, Event, EventType, GuardsCheckEnd, GuardsCheckStart, NavigationCancel, NavigationCancellationCode as NavigationCancellationCode, NavigationEnd, NavigationError, NavigationStart, ResolveEnd, ResolveStart, RouteConfigLoadEnd, RouteConfigLoadStart, RouterEvent, RoutesRecognized, Scroll} from './events';\n-export {CanActivate, CanActivateChild, CanActivateChildFn, CanActivateFn, CanDeactivate, CanDeactivateFn, CanLoad, CanLoadFn, CanMatch, CanMatchFn, Data, LoadChildren, LoadChildrenCallback, NavigationBehaviorOptions, QueryParamsHandling, Resolve, ResolveData, ResolveFn, Route, Routes, RunGuardsAndResolvers, UrlMatcher, UrlMatchResult} from './models';\n+export {CanActivate, CanActivateChild, CanActivateChildFn, CanActivateFn, CanDeactivate, CanDeactivateFn, CanLoad, CanLoadFn, CanMatch, CanMatchFn, Data, DefaultExport, LoadChildren, LoadChildrenCallback, NavigationBehaviorOptions, QueryParamsHandling, Resolve, ResolveData, ResolveFn, Route, Routes, RunGuardsAndResolvers, UrlMatcher, UrlMatchResult} from './models';\n export {DefaultTitleStrategy, TitleStrategy} from './page_title_strategy';\n export {DebugTracingFeature, DisabledInitialNavigationFeature, EnabledBlockingInitialNavigationFeature, InitialNavigationFeature, InMemoryScrollingFeature, PreloadingFeature, provideRouter, provideRoutes, RouterConfigurationFeature, RouterFeature, RouterFeatures, withDebugTracing, withDisabledInitialNavigation, withEnabledBlockingInitialNavigation, withInMemoryScrolling, withPreloading, withRouterConfig} from './provide_router';\n export {BaseRouteReuseStrategy, DetachedRouteHandle, RouteReuseStrategy} from './route_reuse_strategy';\n\n---\n file path A: packages/router/src/models.ts | file path B: packages/router/src/models.ts\n\n@@ -89,6 +89,22 @@ export type ResolveData = {\n   [key: string|symbol]: any|ResolveFn<unknown>\n };\n \n+/**\n+ * An ES Module object with a default export of the given type.\n+ *\n+ * @see `Route#loadComponent`\n+ * @see `LoadChildrenCallback`\n+ *\n+ * @publicApi\n+ */\n+export interface DefaultExport<T> {\n+  /**\n+   * Default exports are bound under the name `\"default\"`, per the ES Module spec:\n+   * https://tc39.es/ecma262/#table-export-forms-mapping-to-exportentry-records\n+   */\n+  default: T;\n+}\n+\n /**\n  *\n  * A function that is called to resolve a collection of lazy-loaded routes.\n@@ -113,11 +129,19 @@ export type ResolveData = {\n  * }];\n  * ```\n  *\n+ * If the lazy-loaded routes are exported via a `default` export, the `.then` can be omitted:\n+ * ```\n+ * [{\n+ *   path: 'lazy',\n+ *   loadChildren: () => import('./lazy-route/lazy.routes'),\n+ * }];\n+ *\n  * @see [Route.loadChildren](api/router/Route#loadChildren)\n  * @publicApi\n  */\n export type LoadChildrenCallback = () => Type<any>|NgModuleFactory<any>|Routes|\n-    Observable<Type<any>|Routes>|Promise<NgModuleFactory<any>|Type<any>|Routes>;\n+    Observable<Type<any>|Routes|DefaultExport<Type<any>>|DefaultExport<Routes>>|\n+    Promise<NgModuleFactory<any>|Type<any>|Routes|DefaultExport<Type<any>>|DefaultExport<Routes>>;\n \n /**\n  *\n@@ -439,7 +463,8 @@ export interface Route {\n   /**\n    * An object specifying a lazy-loaded component.\n    */\n-  loadComponent?: () => Type<unknown>| Observable<Type<unknown>>| Promise<Type<unknown>>;\n+  loadComponent?: () => Type<unknown>| Observable<Type<unknown>|DefaultExport<Type<unknown>>>|\n+      Promise<Type<unknown>|DefaultExport<Type<unknown>>>;\n   /**\n    * Filled for routes `loadComponent` once the component is loaded.\n    * @internal\n\n---\n file path A: packages/router/src/router_config_loader.ts | file path B: packages/router/src/router_config_loader.ts\n\n@@ -11,7 +11,7 @@ import {ConnectableObservable, from, Observable, of, Subject} from 'rxjs';\n import {catchError, finalize, map, mergeMap, refCount, tap} from 'rxjs/operators';\n \n import {deprecatedLoadChildrenString} from './deprecated_load_children';\n-import {LoadChildren, LoadChildrenCallback, LoadedRouterConfig, Route, Routes} from './models';\n+import {DefaultExport, LoadChildren, LoadChildrenCallback, LoadedRouterConfig, Route, Routes} from './models';\n import {flatten, wrapIntoObservable} from './utils/collection';\n import {assertStandalone, standardizeConfig, validateConfig} from './utils/config';\n \n@@ -56,6 +56,7 @@ export class RouterConfigLoader {\n     }\n     const loadRunner = wrapIntoObservable(route.loadComponent!())\n                            .pipe(\n+                               map(maybeUnwrapDefaultExport),\n                                tap(component => {\n                                  if (this.onLoadEndListener) {\n                                    this.onLoadEndListener(route);\n@@ -127,13 +128,29 @@ export class RouterConfigLoader {\n     if (deprecatedResult) {\n       return deprecatedResult;\n     }\n-\n-    return wrapIntoObservable((loadChildren as LoadChildrenCallback)()).pipe(mergeMap((t) => {\n-      if (t instanceof NgModuleFactory || Array.isArray(t)) {\n-        return of(t);\n-      } else {\n-        return from(this.compiler.compileModuleAsync(t));\n-      }\n-    }));\n+    return wrapIntoObservable((loadChildren as LoadChildrenCallback)())\n+        .pipe(\n+            map(maybeUnwrapDefaultExport),\n+            mergeMap((t) => {\n+              if (t instanceof NgModuleFactory || Array.isArray(t)) {\n+                return of(t);\n+              } else {\n+                return from(this.compiler.compileModuleAsync(t));\n+              }\n+            }),\n+        );\n   }\n }\n+\n+function isWrappedDefaultExport<T>(value: T|DefaultExport<T>): value is DefaultExport<T> {\n+  // We use `in` here with a string key `'default'`, because we expect `DefaultExport` objects to be\n+  // dynamically imported ES modules with a spec-mandated `default` key. Thus we don't expect that\n+  // `default` will be a renamed property.\n+  return value && typeof value === 'object' && 'default' in value;\n+}\n+\n+function maybeUnwrapDefaultExport<T>(input: T|DefaultExport<T>): T {\n+  // As per `isWrappedDefaultExport`, the `default` key here is generated by the browser and not\n+  // subject to property renaming, so we reference it with bracket access.\n+  return isWrappedDefaultExport(input) ? input['default'] : input;\n+}\n\n---\n file path A: None | file path B: packages/router/test/default_export_component.ts\n\n@@ -0,0 +1,17 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Component} from '@angular/core';\n+\n+@Component({\n+  standalone: true,\n+  template: 'default exported',\n+  selector: 'test-route',\n+})\n+export default class TestRoute {\n+}\n\n---\n file path A: None | file path B: packages/router/test/default_export_routes.ts\n\n@@ -0,0 +1,23 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Component} from '@angular/core';\n+import {Routes} from '@angular/router';\n+\n+@Component({\n+  standalone: true,\n+  template: 'default exported',\n+  selector: 'test-route',\n+})\n+export class TestRoute {\n+}\n+\n+\n+export default [\n+  {path: '', pathMatch: 'full', component: TestRoute},\n+] as Routes;\n\n---\n file path A: packages/router/test/standalone.spec.ts | file path B: packages/router/test/standalone.spec.ts\n\n@@ -9,10 +9,9 @@\n import {Component, Injectable, NgModule} from '@angular/core';\n import {ComponentFixture, fakeAsync, TestBed, tick} from '@angular/core/testing';\n import {By} from '@angular/platform-browser';\n-import {Router} from '@angular/router';\n+import {NavigationEnd, Router, RouterModule} from '@angular/router';\n import {RouterTestingModule} from '@angular/router/testing';\n-\n-import {RouterModule} from '../src';\n+import {filter, first} from 'rxjs/operators';\n \n @Component({template: '<div>simple standalone</div>', standalone: true})\n export class SimpleStandaloneComponent {\n@@ -340,6 +339,35 @@ describe('standalone in Router API', () => {\n          expect(() => advance(root)).toThrowError(/.*home.*component must be standalone/);\n        }));\n   });\n+  describe('default export unwrapping', () => {\n+    it('should work for loadComponent', async () => {\n+      TestBed.configureTestingModule({\n+        imports: [RouterTestingModule.withRoutes([{\n+          path: 'home',\n+          loadComponent: () => import('./default_export_component'),\n+        }])],\n+      });\n+\n+      const root = TestBed.createComponent(RootCmp);\n+      await TestBed.inject(Router).navigateByUrl('/home');\n+\n+      expect(root.nativeElement.innerHTML).toContain('default exported');\n+    });\n+\n+    it('should work for loadChildren', async () => {\n+      TestBed.configureTestingModule({\n+        imports: [RouterTestingModule.withRoutes([{\n+          path: 'home',\n+          loadChildren: () => import('./default_export_routes'),\n+        }])],\n+      });\n+\n+      const root = TestBed.createComponent(RootCmp);\n+      await TestBed.inject(Router).navigateByUrl('/home');\n+\n+      expect(root.nativeElement.innerHTML).toContain('default exported');\n+    });\n+  });\n });\n \n function advance(fixture: ComponentFixture<unknown>) {\n\n\n###\n\n", "completion": "feat(router): auto-unwrap default exports when lazy loading (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -356,7 +356,7 @@ export interface IsActiveMatchOptions {\n }\n \n // @public\n-export type LoadChildren = LoadChildrenCallback;\n+export type LoadChildren = LoadChildrenCallback | \u0275DeprecatedLoadChildren;\n \n // @public\n export type LoadChildrenCallback = () => Type<any> | NgModuleFactory<any> | Routes | Observable<Type<any> | Routes> | Promise<NgModuleFactory<any> | Type<any> | Routes>;\n\n---\n file path A: None | file path B: packages/router/src/deprecated_load_children.ts\n\n@@ -0,0 +1,26 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Injector, NgModuleFactory} from '@angular/core';\n+import {Observable} from 'rxjs';\n+\n+// This file exists to support the legacy `loadChildren: string` behavior being patched back into\n+// Angular.\n+\n+/**\n+ * Deprecated `loadChildren` value types.\n+ *\n+ * @publicApi\n+ * @deprecated represents the deprecated type side of `LoadChildren`.\n+ */\n+export type DeprecatedLoadChildren = never;\n+\n+export function deprecatedLoadChildrenString(\n+    injector: Injector, loadChildren: unknown): Observable<NgModuleFactory<any>>|null {\n+  return null;\n+}\n\n---\n file path A: packages/router/src/models.ts | file path B: packages/router/src/models.ts\n\n@@ -9,6 +9,7 @@\n import {EnvironmentInjector, ImportedNgModuleProviders, InjectionToken, NgModuleFactory, Provider, ProviderToken, Type} from '@angular/core';\n import {Observable} from 'rxjs';\n \n+import {DeprecatedLoadChildren} from './deprecated_load_children';\n import {ActivatedRouteSnapshot, RouterStateSnapshot} from './router_state';\n import {UrlSegment, UrlSegmentGroup, UrlTree} from './url_tree';\n \n@@ -125,7 +126,7 @@ export type LoadChildrenCallback = () => Type<any>|NgModuleFactory<any>|Routes|\n  * @see `LoadChildrenCallback`\n  * @publicApi\n  */\n-export type LoadChildren = LoadChildrenCallback;\n+export type LoadChildren = LoadChildrenCallback|DeprecatedLoadChildren;\n \n /**\n  *\n\n---\n file path A: packages/router/src/private_export.ts | file path B: packages/router/src/private_export.ts\n\n@@ -8,6 +8,7 @@\n \n \n export {\u0275EmptyOutletComponent} from './components/empty_outlet';\n+export {DeprecatedLoadChildren as \u0275DeprecatedLoadChildren} from './deprecated_load_children';\n export {withPreloading as \u0275withPreloading} from './provide_router';\n export {assignExtraOptionsToRouter as \u0275assignExtraOptionsToRouter, RestoredState as \u0275RestoredState} from './router';\n export {ROUTER_PROVIDERS as \u0275ROUTER_PROVIDERS} from './router_module';\n\n---\n file path A: packages/router/src/router_config_loader.ts | file path B: packages/router/src/router_config_loader.ts\n\n@@ -10,7 +10,8 @@ import {Compiler, EnvironmentInjector, Injectable, InjectFlags, InjectionToken,\n import {ConnectableObservable, from, Observable, of, Subject} from 'rxjs';\n import {catchError, finalize, map, mergeMap, refCount, tap} from 'rxjs/operators';\n \n-import {LoadChildren, LoadedRouterConfig, Route, Routes} from './models';\n+import {deprecatedLoadChildrenString} from './deprecated_load_children';\n+import {LoadChildren, LoadChildrenCallback, LoadedRouterConfig, Route, Routes} from './models';\n import {flatten, wrapIntoObservable} from './utils/collection';\n import {assertStandalone, standardizeConfig, validateConfig} from './utils/config';\n \n@@ -122,7 +123,12 @@ export class RouterConfigLoader {\n \n   private loadModuleFactoryOrRoutes(loadChildren: LoadChildren):\n       Observable<NgModuleFactory<any>|Routes> {\n-    return wrapIntoObservable(loadChildren()).pipe(mergeMap((t) => {\n+    const deprecatedResult = deprecatedLoadChildrenString(this.injector, loadChildren);\n+    if (deprecatedResult) {\n+      return deprecatedResult;\n+    }\n+\n+    return wrapIntoObservable((loadChildren as LoadChildrenCallback)()).pipe(mergeMap((t) => {\n       if (t instanceof NgModuleFactory || Array.isArray(t)) {\n         return of(t);\n       } else {\n\n\n###\n\n", "completion": "refactor(router): organize deprecated loadChildren code (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/typecheck/api/checker.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/api/checker.ts\n\n@@ -14,7 +14,7 @@ import {ErrorCode} from '../../diagnostics';\n \n import {FullTemplateMapping, NgTemplateDiagnostic, TypeCheckableDirectiveMeta} from './api';\n import {GlobalCompletion} from './completion';\n-import {PipeInScope, PotentialDirective} from './scope';\n+import {PotentialDirective, PotentialPipe} from './scope';\n import {ElementSymbol, Symbol, TcbLocation, TemplateSymbol} from './symbols';\n \n /**\n@@ -137,7 +137,7 @@ export interface TemplateTypeChecker {\n   /**\n    * Get basic metadata on the pipes which are in scope for the given component.\n    */\n-  getPipesInScope(component: ts.ClassDeclaration): PipeInScope[]|null;\n+  getPipesInScope(component: ts.ClassDeclaration): PotentialPipe[]|null;\n \n   /**\n    * Retrieve a `Map` of potential template element tags, to either the `PotentialDirective` that\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/api/scope.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/api/scope.ts\n\n@@ -13,7 +13,7 @@ import {ClassDeclaration} from '../../reflection';\n import {SymbolWithValueDeclaration} from '../../util/src/typescript';\n \n /**\n- * Metadata on a directive which is available in the scope of a template.\n+ * Metadata on a directive which is available in a template.\n  */\n export interface PotentialDirective {\n   ref: Reference<ClassDeclaration>;\n@@ -50,9 +50,9 @@ export interface PotentialDirective {\n }\n \n /**\n- * Metadata for a pipe which is available in the scope of a template.\n+ * Metadata for a pipe which is available in a template.\n  */\n-export interface PipeInScope {\n+export interface PotentialPipe {\n   /**\n    * The `ts.Symbol` for the pipe class.\n    */\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/src/checker.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/src/checker.ts\n\n@@ -20,7 +20,7 @@ import {ClassDeclaration, DeclarationNode, isNamedClassDeclaration, ReflectionHo\n import {ComponentScopeKind, ComponentScopeReader, TypeCheckScopeRegistry} from '../../scope';\n import {isShim} from '../../shims';\n import {getSourceFileOrNull, isSymbolWithValueDeclaration} from '../../util/src/typescript';\n-import {ElementSymbol, FullTemplateMapping, GlobalCompletion, NgTemplateDiagnostic, OptimizeFor, PipeInScope, PotentialDirective, ProgramTypeCheckAdapter, Symbol, TcbLocation, TemplateDiagnostic, TemplateId, TemplateSymbol, TemplateTypeChecker, TypeCheckableDirectiveMeta, TypeCheckingConfig} from '../api';\n+import {ElementSymbol, FullTemplateMapping, GlobalCompletion, NgTemplateDiagnostic, OptimizeFor, PotentialDirective, PotentialPipe, ProgramTypeCheckAdapter, Symbol, TcbLocation, TemplateDiagnostic, TemplateId, TemplateSymbol, TemplateTypeChecker, TypeCheckableDirectiveMeta, TypeCheckingConfig} from '../api';\n import {makeTemplateDiagnostic} from '../diagnostics';\n \n import {CompletionEngine} from './completion';\n@@ -572,7 +572,7 @@ export class TemplateTypeCheckerImpl implements TemplateTypeChecker {\n     return Array.from(resultingDirectives.values());\n   }\n \n-  getPipesInScope(component: ts.ClassDeclaration): PipeInScope[]|null {\n+  getPipesInScope(component: ts.ClassDeclaration): PotentialPipe[]|null {\n     const data = this.getScopeData(component);\n     if (data === null) {\n       return null;\n@@ -910,6 +910,6 @@ class SingleShimTypeCheckingHost extends SingleFileTypeCheckingHost {\n  */\n interface ScopeData {\n   directives: PotentialDirective[];\n-  pipes: PipeInScope[];\n+  pipes: PotentialPipe[];\n   isPoisoned: boolean;\n }\n\n\n###\n\n", "completion": "refactor(compiler): Rename `PipeInScope` -> `PotentialPipe` (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/typecheck/api/checker.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/api/checker.ts\n\n@@ -14,7 +14,7 @@ import {ErrorCode} from '../../diagnostics';\n \n import {FullTemplateMapping, NgTemplateDiagnostic, TypeCheckableDirectiveMeta} from './api';\n import {GlobalCompletion} from './completion';\n-import {DirectiveInScope, PipeInScope} from './scope';\n+import {PipeInScope, PotentialDirective} from './scope';\n import {ElementSymbol, Symbol, TcbLocation, TemplateSymbol} from './symbols';\n \n /**\n@@ -131,7 +131,7 @@ export interface TemplateTypeChecker {\n   /**\n    * Get basic metadata on the directives which are in scope for the given component.\n    */\n-  getDirectivesInScope(component: ts.ClassDeclaration): DirectiveInScope[]|null;\n+  getDirectivesInScope(component: ts.ClassDeclaration): PotentialDirective[]|null;\n \n   /**\n    * Get basic metadata on the pipes which are in scope for the given component.\n@@ -139,11 +139,11 @@ export interface TemplateTypeChecker {\n   getPipesInScope(component: ts.ClassDeclaration): PipeInScope[]|null;\n \n   /**\n-   * Retrieve a `Map` of potential template element tags, to either the `DirectiveInScope` that\n+   * Retrieve a `Map` of potential template element tags, to either the `PotentialDirective` that\n    * declares them (if the tag is from a directive/component), or `null` if the tag originates from\n    * the DOM schema.\n    */\n-  getPotentialElementTags(component: ts.ClassDeclaration): Map<string, DirectiveInScope|null>;\n+  getPotentialElementTags(component: ts.ClassDeclaration): Map<string, PotentialDirective|null>;\n \n   /**\n    * Get the primary decorator for an Angular class (such as @Component). This does not work for\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/api/scope.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/api/scope.ts\n\n@@ -14,7 +14,7 @@ import {SymbolWithValueDeclaration} from '../../util/src/typescript';\n /**\n  * Metadata on a directive which is available in the scope of a template.\n  */\n-export interface DirectiveInScope {\n+export interface PotentialDirective {\n   /**\n    * The `ts.Symbol` for the directive class.\n    */\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/api/symbols.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/api/symbols.ts\n\n@@ -12,7 +12,7 @@ import ts from 'typescript';\n import {AbsoluteFsPath} from '../../file_system';\n import {SymbolWithValueDeclaration} from '../../util/src/typescript';\n \n-import {DirectiveInScope} from './scope';\n+import {PotentialDirective} from './scope';\n \n export enum SymbolKind {\n   Input,\n@@ -262,7 +262,7 @@ export interface TemplateSymbol {\n  * A representation of a directive/component whose selector matches a node in a component\n  * template.\n  */\n-export interface DirectiveSymbol extends DirectiveInScope {\n+export interface DirectiveSymbol extends PotentialDirective {\n   kind: SymbolKind.Directive;\n \n   /** The `ts.Type` for the class declaration. */\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/src/checker.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/src/checker.ts\n\n@@ -20,7 +20,7 @@ import {ClassDeclaration, isNamedClassDeclaration, ReflectionHost} from '../../r\n import {ComponentScopeKind, ComponentScopeReader, TypeCheckScopeRegistry} from '../../scope';\n import {isShim} from '../../shims';\n import {getSourceFileOrNull, isSymbolWithValueDeclaration} from '../../util/src/typescript';\n-import {DirectiveInScope, ElementSymbol, FullTemplateMapping, GlobalCompletion, NgTemplateDiagnostic, OptimizeFor, PipeInScope, ProgramTypeCheckAdapter, Symbol, TcbLocation, TemplateDiagnostic, TemplateId, TemplateSymbol, TemplateTypeChecker, TypeCheckableDirectiveMeta, TypeCheckingConfig} from '../api';\n+import {ElementSymbol, FullTemplateMapping, GlobalCompletion, NgTemplateDiagnostic, OptimizeFor, PipeInScope, PotentialDirective, ProgramTypeCheckAdapter, Symbol, TcbLocation, TemplateDiagnostic, TemplateId, TemplateSymbol, TemplateTypeChecker, TypeCheckableDirectiveMeta, TypeCheckingConfig} from '../api';\n import {makeTemplateDiagnostic} from '../diagnostics';\n \n import {CompletionEngine} from './completion';\n@@ -75,7 +75,7 @@ export class TemplateTypeCheckerImpl implements TemplateTypeChecker {\n    * destroyed when the `ts.Program` changes and the `TemplateTypeCheckerImpl` as a whole is\n    * destroyed and replaced.\n    */\n-  private elementTagCache = new Map<ts.ClassDeclaration, Map<string, DirectiveInScope|null>>();\n+  private elementTagCache = new Map<ts.ClassDeclaration, Map<string, PotentialDirective|null>>();\n \n   private isComplete = false;\n \n@@ -549,7 +549,7 @@ export class TemplateTypeCheckerImpl implements TemplateTypeChecker {\n     return builder;\n   }\n \n-  getDirectivesInScope(component: ts.ClassDeclaration): DirectiveInScope[]|null {\n+  getDirectivesInScope(component: ts.ClassDeclaration): PotentialDirective[]|null {\n     const data = this.getScopeData(component);\n     if (data === null) {\n       return null;\n@@ -572,12 +572,12 @@ export class TemplateTypeCheckerImpl implements TemplateTypeChecker {\n     return this.typeCheckScopeRegistry.getTypeCheckDirectiveMetadata(new Reference(dir));\n   }\n \n-  getPotentialElementTags(component: ts.ClassDeclaration): Map<string, DirectiveInScope|null> {\n+  getPotentialElementTags(component: ts.ClassDeclaration): Map<string, PotentialDirective|null> {\n     if (this.elementTagCache.has(component)) {\n       return this.elementTagCache.get(component)!;\n     }\n \n-    const tagMap = new Map<string, DirectiveInScope|null>();\n+    const tagMap = new Map<string, PotentialDirective|null>();\n \n     for (const tag of REGISTRY.allKnownElementNames()) {\n       tagMap.set(tag, null);\n@@ -886,7 +886,7 @@ class SingleShimTypeCheckingHost extends SingleFileTypeCheckingHost {\n  * Cached scope information for a component.\n  */\n interface ScopeData {\n-  directives: DirectiveInScope[];\n+  directives: PotentialDirective[];\n   pipes: PipeInScope[];\n   isPoisoned: boolean;\n }\n\n---\n file path A: packages/language-service/src/attribute_completions.ts | file path B: packages/language-service/src/attribute_completions.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {CssSelector, SelectorMatcher, TmplAstElement, TmplAstTemplate} from '@angular/compiler';\n-import {DirectiveInScope, ElementSymbol, TemplateSymbol, TemplateTypeChecker, TypeCheckableDirectiveMeta} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n+import {ElementSymbol, PotentialDirective, TemplateSymbol, TemplateTypeChecker, TypeCheckableDirectiveMeta} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n import ts from 'typescript';\n \n import {DisplayInfoKind, unsafeCastDisplayInfoKindToScriptElementKind} from './display_parts';\n@@ -116,7 +116,7 @@ export interface DirectiveAttributeCompletion {\n   /**\n    * The directive whose selector gave rise to this completion.\n    */\n-  directive: DirectiveInScope;\n+  directive: PotentialDirective;\n }\n \n /**\n@@ -135,7 +135,7 @@ export interface DirectiveInputCompletion {\n   /**\n    * The directive which has this input.\n    */\n-  directive: DirectiveInScope;\n+  directive: PotentialDirective;\n \n   /**\n    * The field name on the directive class which corresponds to this input.\n@@ -164,7 +164,7 @@ export interface DirectiveOutputCompletion {\n   /**\n    *The directive which has this output.\n    */\n-  directive: DirectiveInScope;\n+  directive: PotentialDirective;\n \n   /**\n    * The field name on the directive class which corresponds to this output.\n@@ -251,7 +251,8 @@ export function buildAttributeCompletionTable(\n \n   // Next, explore hypothetical directives and determine if the addition of any single attributes\n   // can cause the directive to match the element.\n-  const directivesInScope = checker.getDirectivesInScope(component);\n+  const directivesInScope =\n+      checker.getPotentialTemplateDirectives(component).filter(d => d.isInScope);\n   if (directivesInScope !== null) {\n     const elementSelector = makeElementSelector(element);\n \n\n---\n file path A: packages/language-service/src/completions.ts | file path B: packages/language-service/src/completions.ts\n\n@@ -8,7 +8,7 @@\n \n import {AST, ASTWithSource, BindingPipe, BindingType, Call, EmptyExpr, ImplicitReceiver, LiteralPrimitive, ParsedEventType, ParseSourceSpan, PropertyRead, PropertyWrite, SafePropertyRead, TmplAstBoundAttribute, TmplAstBoundEvent, TmplAstElement, TmplAstNode, TmplAstReference, TmplAstTemplate, TmplAstText, TmplAstTextAttribute, TmplAstVariable} from '@angular/compiler';\n import {NgCompiler} from '@angular/compiler-cli/src/ngtsc/core';\n-import {CompletionKind, DirectiveInScope, SymbolKind, TemplateDeclarationSymbol} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n+import {CompletionKind, PotentialDirective, SymbolKind, TemplateDeclarationSymbol} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n import {BoundEvent, TextAttribute} from '@angular/compiler/src/render3/r3_ast';\n import ts from 'typescript';\n \n@@ -905,7 +905,7 @@ function makeReplacementSpanFromAst(node: PropertyRead|PropertyWrite|SafePropert\n   };\n }\n \n-function tagCompletionKind(directive: DirectiveInScope|null): ts.ScriptElementKind {\n+function tagCompletionKind(directive: PotentialDirective|null): ts.ScriptElementKind {\n   let kind: DisplayInfoKind;\n   if (directive === null) {\n     kind = DisplayInfoKind.ELEMENT;\n\n---\n file path A: packages/language-service/src/display_parts.ts | file path B: packages/language-service/src/display_parts.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {isNamedClassDeclaration} from '@angular/compiler-cli/src/ngtsc/reflection';\n-import {DirectiveInScope, ReferenceSymbol, Symbol, SymbolKind, TcbLocation, VariableSymbol} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n+import {PotentialDirective, ReferenceSymbol, Symbol, SymbolKind, TcbLocation, VariableSymbol} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n import ts from 'typescript';\n \n \n@@ -130,7 +130,7 @@ function getDocumentationFromTypeDefAtLocation(\n }\n \n export function getDirectiveDisplayInfo(\n-    tsLS: ts.LanguageService, dir: DirectiveInScope): DisplayInfo {\n+    tsLS: ts.LanguageService, dir: PotentialDirective): DisplayInfo {\n   const kind = dir.isComponent ? DisplayInfoKind.COMPONENT : DisplayInfoKind.DIRECTIVE;\n   const decl = dir.tsSymbol.declarations.find(ts.isClassDeclaration);\n   if (decl === undefined || decl.name === undefined) {\n\n\n###\n\n", "completion": "refactor(compiler): Rename `DirectiveInScope` -> `PotentialDirective` (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/deprecations.md | file path B: aio/content/guide/deprecations.md\n\n@@ -35,6 +35,7 @@ v11 - v14\n v12 - v15\n v13 - v16\n v14 - v17\n+v15 - v18\n -->\n \n | Area                                | API or Feature                                                                                             | May be removed in        |\n@@ -57,6 +58,7 @@ v14 - v17\n | `@angular/core`                     | [`ComponentFactory`](#core)                                                                                | <!-- v13 --> v16         |\n | `@angular/core`                     | [`ComponentFactoryResolver`](#core)                                                                        | <!-- v13 --> v16         |\n | `@angular/core`                     | [`CompilerOptions.useJit and CompilerOptions.missingTranslation config options`](#core)                    | <!-- v13 --> v16         |\n+| `@angular/core`                     | NgModule and `'any'` options for [`providedIn`](#core) | <!-- v15 --> v17 |\n | `@angular/platform-browser-dynamic` | [`JitCompilerFactory`](#platform-browser-dynamic)                                                          | <!-- v13 --> v16         |\n | `@angular/platform-browser-dynamic` | [`RESOURCE_CACHE_PROVIDER`](#platform-browser-dynamic)                                                     | <!-- v13 --> v16         |\n | `@angular/forms`                    | [`ngModel` with reactive forms](#ngmodel-reactive)                                                         | <!--  v6 --> v11         |\n@@ -141,6 +143,8 @@ In the [API reference section](api) of this site, deprecated APIs are indicated\n | [`ComponentFactory`](api/core/ComponentFactory)                                                            | Use non-factory based framework APIs.                                                                                                                             | v13                   | Since Ivy, Component factories are not required. Angular provides other APIs where Component classes can be used directly.                                                                                                                                         |\n | [`ComponentFactoryResolver`](api/core/ComponentFactoryResolver)                                            | Use non-factory based framework APIs.                                                                                                                             | v13                   | Since Ivy, Component factories are not required, thus there is no need to resolve them.                                                                                                                                                                            |\n | [`CompilerOptions.useJit and CompilerOptions.missingTranslation config options`](api/core/CompilerOptions) | none                                                                                                                                                              | v13                   | Since Ivy, those config options are unused, passing them has no effect.                                                                                                                                                                                            |\n+| [`providedIn`](api/core/Injectable#providedIn) with NgModule | Prefer `'root'` providers, or use NgModule `providers` if scoping to an NgModule is necessary | v15 | none |\n+| [`providedIn: 'any'`](api/core/Injectable#providedIn) | none | v15 | This option has confusing semantics and nearly zero usage. |\n \n <a id=\"testing\"></a>\n \n\n---\n file path A: packages/core/src/di/injectable.ts | file path B: packages/core/src/di/injectable.ts\n\n@@ -64,7 +64,8 @@ export interface Injectable {\n   /**\n    * Determines which injectors will provide the injectable.\n    *\n-   * - `Type<any>` - associates the injectable with an `@NgModule` or other `InjectorType`,\n+   * - `Type<any>` - associates the injectable with an `@NgModule` or other `InjectorType`. This\n+   * option is DEPRECATED.\n    * - 'null' : Equivalent to `undefined`. The injectable is not provided in any scope automatically\n    * and must be added to a `providers` array of an [@NgModule](api/core/NgModule#providers),\n    * [@Component](api/core/Directive#providers) or [@Directive](api/core/Directive#providers).\n@@ -75,7 +76,7 @@ export interface Injectable {\n    * - 'platform' : A special singleton platform injector shared by all\n    * applications on the page.\n    * - 'any' : Provides a unique instance in each lazy loaded module while all eagerly loaded\n-   * modules share one instance.\n+   * modules share one instance. This option is DEPRECATED.\n    *\n    */\n   providedIn?: Type<any>|'root'|'platform'|'any'|null;\n\n---\n file path A: packages/core/src/di/injection_token.ts | file path B: packages/core/src/di/injection_token.ts\n\n@@ -35,8 +35,11 @@ import {\u0275\u0275defineInjectable} from './interface/defs';\n  * As you can see in the Tree-shakable InjectionToken example below.\n  *\n  * Additionally, if a `factory` is specified you can also specify the `providedIn` option, which\n- * overrides the above behavior and marks the token as belonging to a particular `@NgModule`. As\n- * mentioned above, `'root'` is the default value for `providedIn`.\n+ * overrides the above behavior and marks the token as belonging to a particular `@NgModule` (note:\n+ * this option is now deprecated). As mentioned above, `'root'` is the default value for\n+ * `providedIn`.\n+ *\n+ * The `providedIn: NgModule` and `providedIn: 'any'` options are deprecated.\n  *\n  * @usageNotes\n  * ### Basic Examples\n\n\n###\n\n", "completion": "docs(core): deprecate `providedIn: NgModule` and `providedIn: 'any'` (#<issue-num>)"}
{"prompt": " file path A: aio/content/images/bios/jordanpowell.jpg | file path B: aio/content/images/bios/jordanpowell.jpg\n\nBinary files /dev/null and b/aio/content/images/bios/jordanpowell.jpg differ\n\n---\n file path A: aio/content/marketing/contributors.json | file path B: aio/content/marketing/contributors.json\n\n@@ -487,6 +487,14 @@\n     \"twitter\": \"devjoost\",\n     \"bio\": \"Joost is a Software Engineer from the Netherlands with an interest in open source software who likes to learn something new every day. He works at Blueriq during the day and contributes to Angular in his spare time, by working on the Angular compiler and runtime. He may review your PR even if you never asked for it ;)\"\n   },\n+  \"jordanpowell88\": {\n+    \"name\": \"Jordan Powell\",\n+    \"picture\": \"jordanpowell.jpg\",\n+    \"twitter\": \"jordanpowell88\",\n+    \"website\": \"https://jordanpowell88.com\",\n+    \"bio\": \"Jordan is a GDE (Google Developer Expert) and a self taught software engineer who is passionate about writing 'good code' that is easy to read, test and maintain over time. He has over a decade of freelance experience in software development, marketing, design and video production. He currently is a Developer Experience Engineer at Cypress.io and also serves as the CEO & Co-Founder for the non-profit Dream On: Global.\",\n+    \"groups\": [\"GDE\"]\n+  },\n   \"jorgeucano\": {\n     \"name\": \"Jorge Cano\",\n     \"picture\": \"jorgeucano.jpg\",\n\n\n###\n\n", "completion": "docs: add Jordan Powell to GDE resources (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/core/src/host.ts | file path B: packages/compiler-cli/src/ngtsc/core/src/host.ts\n\n@@ -68,6 +68,11 @@ export class DelegatingCompilerHost implements\n   useCaseSensitiveFileNames = this.delegateMethod('useCaseSensitiveFileNames');\n   writeFile = this.delegateMethod('writeFile');\n   getModuleResolutionCache = this.delegateMethod('getModuleResolutionCache');\n+  // @ts-expect-error 'hasInvalidatedResolutions' is visible (and thus required here) in latest TSC\n+  // main. It's already present, so the code works at runtime.\n+  // TODO: remove this comment including the suppression once Angular uses a TSC version that\n+  // includes this change (github.com/microsoft/TypeScript@a455955).\n+  hasInvalidatedResolutions = this.delegateMethod('hasInvalidatedResolutions');\n }\n \n /**\n\n---\n file path A: packages/compiler-cli/src/ngtsc/program_driver/src/ts_create_program_driver.ts | file path B: packages/compiler-cli/src/ngtsc/program_driver/src/ts_create_program_driver.ts\n\n@@ -52,6 +52,11 @@ export class DelegatingCompilerHost implements\n   trace = this.delegateMethod('trace');\n   useCaseSensitiveFileNames = this.delegateMethod('useCaseSensitiveFileNames');\n   getModuleResolutionCache = this.delegateMethod('getModuleResolutionCache');\n+  // @ts-expect-error 'hasInvalidatedResolutions' is visible (and thus required here) in latest TSC\n+  // main. It's already present, so the code works at runtime.\n+  // TODO: remove this comment including the suppression once Angular uses a TSC version that\n+  // includes this change (github.com/microsoft/TypeScript@a455955).\n+  hasInvalidatedResolutions = this.delegateMethod('hasInvalidatedResolutions');\n }\n \n /**\n\n\n###\n\n", "completion": "fix(compiler-cli): support hasInvalidatedResolutions. (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -31,7 +31,6 @@ import { SimpleChanges } from '@angular/core';\n import { Title } from '@angular/platform-browser';\n import { Type } from '@angular/core';\n import { Version } from '@angular/core';\n-import { ViewContainerRef } from '@angular/core';\n \n // @public\n export class ActivatedRoute {\n@@ -800,7 +799,6 @@ export class RouterModule {\n \n // @public\n export class RouterOutlet implements OnDestroy, OnInit, RouterOutletContract {\n-    constructor(parentContexts: ChildrenOutletContexts, location: ViewContainerRef, name: string, changeDetector: ChangeDetectorRef, environmentInjector: EnvironmentInjector);\n     // (undocumented)\n     get activatedRoute(): ActivatedRoute;\n     // (undocumented)\n@@ -821,14 +819,17 @@ export class RouterOutlet implements OnDestroy, OnInit, RouterOutletContract {\n     detachEvents: EventEmitter<unknown>;\n     // (undocumented)\n     get isActivated(): boolean;\n+    name: string;\n+    // (undocumented)\n+    ngOnChanges(changes: SimpleChanges): void;\n     // (undocumented)\n     ngOnDestroy(): void;\n     // (undocumented)\n     ngOnInit(): void;\n     // (undocumented)\n-    static \u0275dir: i0.\u0275\u0275DirectiveDeclaration<RouterOutlet, \"router-outlet\", [\"outlet\"], {}, { \"activateEvents\": \"activate\"; \"deactivateEvents\": \"deactivate\"; \"attachEvents\": \"attach\"; \"detachEvents\": \"detach\"; }, never, never, true, never>;\n+    static \u0275dir: i0.\u0275\u0275DirectiveDeclaration<RouterOutlet, \"router-outlet\", [\"outlet\"], { \"name\": \"name\"; }, { \"activateEvents\": \"activate\"; \"deactivateEvents\": \"deactivate\"; \"attachEvents\": \"attach\"; \"detachEvents\": \"detach\"; }, never, never, true, never>;\n     // (undocumented)\n-    static \u0275fac: i0.\u0275\u0275FactoryDeclaration<RouterOutlet, [null, null, { attribute: \"name\"; }, null, null]>;\n+    static \u0275fac: i0.\u0275\u0275FactoryDeclaration<RouterOutlet, never>;\n }\n \n // @public\n\n---\n file path A: packages/core/test/bundling/router/bundle.golden_symbols.json | file path B: packages/core/test/bundling/router/bundle.golden_symbols.json\n\n@@ -1892,9 +1892,6 @@\n   {\n     \"name\": \"\u0275\u0275inject\"\n   },\n-  {\n-    \"name\": \"\u0275\u0275injectAttribute\"\n-  },\n   {\n     \"name\": \"\u0275\u0275listener\"\n   },\n\n---\n file path A: packages/router/src/directives/router_outlet.ts | file path B: packages/router/src/directives/router_outlet.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Attribute, ChangeDetectorRef, ComponentFactoryResolver, ComponentRef, Directive, EnvironmentInjector, EventEmitter, Injector, OnDestroy, OnInit, Output, ViewContainerRef, \u0275RuntimeError as RuntimeError,} from '@angular/core';\n+import {ChangeDetectorRef, ComponentFactoryResolver, ComponentRef, Directive, EnvironmentInjector, EventEmitter, inject, Injector, Input, OnDestroy, OnInit, Output, SimpleChanges, ViewContainerRef, \u0275RuntimeError as RuntimeError,} from '@angular/core';\n \n import {RuntimeErrorCode} from '../errors';\n import {Data} from '../models';\n@@ -165,7 +165,12 @@ export interface RouterOutletContract {\n export class RouterOutlet implements OnDestroy, OnInit, RouterOutletContract {\n   private activated: ComponentRef<any>|null = null;\n   private _activatedRoute: ActivatedRoute|null = null;\n-  private name: string;\n+  /**\n+   * The name of the outlet\n+   *\n+   * @see [named outlets](guide/router-tutorial-toh#displaying-multiple-routes-in-named-outlets)\n+   */\n+  @Input() name = PRIMARY_OUTLET;\n \n   @Output('activate') activateEvents = new EventEmitter<any>();\n   @Output('deactivate') deactivateEvents = new EventEmitter<any>();\n@@ -180,36 +185,64 @@ export class RouterOutlet implements OnDestroy, OnInit, RouterOutletContract {\n    */\n   @Output('detach') detachEvents = new EventEmitter<unknown>();\n \n-  constructor(\n-      private parentContexts: ChildrenOutletContexts, private location: ViewContainerRef,\n-      @Attribute('name') name: string, private changeDetector: ChangeDetectorRef,\n-      private environmentInjector: EnvironmentInjector) {\n-    this.name = name || PRIMARY_OUTLET;\n-    parentContexts.onChildOutletCreated(this.name, this);\n+  private parentContexts = inject(ChildrenOutletContexts);\n+  private location = inject(ViewContainerRef);\n+  private changeDetector = inject(ChangeDetectorRef);\n+  private environmentInjector = inject(EnvironmentInjector);\n+\n+  /** @nodoc */\n+  ngOnChanges(changes: SimpleChanges) {\n+    if (changes['name']) {\n+      const {firstChange, previousValue} = changes['name'];\n+      if (firstChange) {\n+        // The first change is handled by ngOnInit. Because ngOnChanges doesn't get called when no\n+        // input is set at all, we need to centrally handle the first change there.\n+        return;\n+      }\n+\n+      // unregister with the old name\n+      if (this.isTrackedInParentContexts(previousValue)) {\n+        this.deactivate();\n+        this.parentContexts.onChildOutletDestroyed(previousValue);\n+      }\n+      // register the new name\n+      this.initializeOutletWithName();\n+    }\n   }\n \n   /** @nodoc */\n   ngOnDestroy(): void {\n     // Ensure that the registered outlet is this one before removing it on the context.\n-    if (this.parentContexts.getContext(this.name)?.outlet === this) {\n+    if (this.isTrackedInParentContexts(this.name)) {\n       this.parentContexts.onChildOutletDestroyed(this.name);\n     }\n   }\n \n+  private isTrackedInParentContexts(outletName: string) {\n+    return this.parentContexts.getContext(outletName)?.outlet === this;\n+  }\n+\n   /** @nodoc */\n   ngOnInit(): void {\n-    if (!this.activated) {\n-      // If the outlet was not instantiated at the time the route got activated we need to populate\n-      // the outlet when it is initialized (ie inside a NgIf)\n-      const context = this.parentContexts.getContext(this.name);\n-      if (context && context.route) {\n-        if (context.attachRef) {\n-          // `attachRef` is populated when there is an existing component to mount\n-          this.attach(context.attachRef, context.route);\n-        } else {\n-          // otherwise the component defined in the configuration is created\n-          this.activateWith(context.route, context.injector);\n-        }\n+    this.initializeOutletWithName();\n+  }\n+\n+  private initializeOutletWithName() {\n+    this.parentContexts.onChildOutletCreated(this.name, this);\n+    if (this.activated) {\n+      return;\n+    }\n+\n+    // If the outlet was not instantiated at the time the route got activated we need to populate\n+    // the outlet when it is initialized (ie inside a NgIf)\n+    const context = this.parentContexts.getContext(this.name);\n+    if (context?.route) {\n+      if (context.attachRef) {\n+        // `attachRef` is populated when there is an existing component to mount\n+        this.attach(context.attachRef, context.route);\n+      } else {\n+        // otherwise the component defined in the configuration is created\n+        this.activateWith(context.route, context.injector);\n       }\n     }\n   }\n\n---\n file path A: None | file path B: packages/router/test/directives/router_outlet.spec.ts\n\n@@ -0,0 +1,165 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {CommonModule, NgForOf} from '@angular/common';\n+import {Component, Type} from '@angular/core';\n+import {ComponentFixture, fakeAsync, TestBed, tick} from '@angular/core/testing';\n+import {Router, RouterModule, RouterOutlet} from '@angular/router/src';\n+import {RouterTestingModule} from '@angular/router/testing';\n+\n+\n+describe('router outlet name', () => {\n+  it('should support name binding', fakeAsync(() => {\n+       @Component({\n+         standalone: true,\n+         template: '<router-outlet [name]=\"name\"></router-outlet>',\n+         imports: [RouterOutlet],\n+       })\n+       class RootCmp {\n+         name = 'popup';\n+       }\n+\n+       @Component({\n+         template: 'popup component',\n+         standalone: true,\n+       })\n+       class PopupCmp {\n+       }\n+\n+       TestBed.configureTestingModule({\n+         imports:\n+             [RouterTestingModule.withRoutes([{path: '', outlet: 'popup', component: PopupCmp}])]\n+       });\n+       const router = TestBed.inject(Router);\n+       const fixture = createRoot(router, RootCmp);\n+       expect(fixture.nativeElement.innerHTML).toContain('popup component');\n+     }));\n+\n+  it('should be able to change the name of the outlet', fakeAsync(() => {\n+       @Component({\n+         standalone: true,\n+         template: '<router-outlet [name]=\"name\"></router-outlet>',\n+         imports: [RouterOutlet],\n+       })\n+       class RootCmp {\n+         name = '';\n+       }\n+\n+       @Component({\n+         template: 'hello world',\n+         standalone: true,\n+       })\n+       class GreetingCmp {\n+       }\n+\n+       @Component({\n+         template: 'goodbye cruel world',\n+         standalone: true,\n+       })\n+       class FarewellCmp {\n+       }\n+\n+       TestBed.configureTestingModule({\n+         imports: [RouterTestingModule.withRoutes([\n+           {path: '', outlet: 'greeting', component: GreetingCmp},\n+           {path: '', outlet: 'farewell', component: FarewellCmp},\n+         ])]\n+       });\n+       const router = TestBed.inject(Router);\n+       const fixture = createRoot(router, RootCmp);\n+\n+       expect(fixture.nativeElement.innerHTML).not.toContain('goodbye');\n+       expect(fixture.nativeElement.innerHTML).not.toContain('hello');\n+\n+       fixture.componentInstance.name = 'greeting';\n+       advance(fixture);\n+       expect(fixture.nativeElement.innerHTML).toContain('hello');\n+       expect(fixture.nativeElement.innerHTML).not.toContain('goodbye');\n+\n+       fixture.componentInstance.name = 'goodbye';\n+       advance(fixture);\n+       expect(fixture.nativeElement.innerHTML).toContain('goodbye');\n+       expect(fixture.nativeElement.innerHTML).not.toContain('hello');\n+     }));\n+\n+  it('should support outlets in ngFor', fakeAsync(() => {\n+       @Component({\n+         standalone: true,\n+         template: `\n+            <div *ngFor=\"let outlet of outlets\">\n+                <router-outlet [name]=\"outlet\"></router-outlet>\n+            </div>\n+            `,\n+         imports: [RouterOutlet, NgForOf],\n+       })\n+       class RootCmp {\n+         outlets = ['outlet1', 'outlet2', 'outlet3'];\n+       }\n+\n+       @Component({\n+         template: 'component 1',\n+         standalone: true,\n+       })\n+       class Cmp1 {\n+       }\n+\n+       @Component({\n+         template: 'component 2',\n+         standalone: true,\n+       })\n+       class Cmp2 {\n+       }\n+\n+       @Component({\n+         template: 'component 3',\n+         standalone: true,\n+       })\n+       class Cmp3 {\n+       }\n+\n+       TestBed.configureTestingModule({\n+         imports: [RouterTestingModule.withRoutes([\n+           {path: '1', outlet: 'outlet1', component: Cmp1},\n+           {path: '2', outlet: 'outlet2', component: Cmp2},\n+           {path: '3', outlet: 'outlet3', component: Cmp3},\n+         ])]\n+       });\n+       const router = TestBed.inject(Router);\n+       const fixture = createRoot(router, RootCmp);\n+\n+       router.navigate([{outlets: {'outlet1': '1'}}]);\n+       advance(fixture);\n+       expect(fixture.nativeElement.innerHTML).toContain('component 1');\n+       expect(fixture.nativeElement.innerHTML).not.toContain('component 2');\n+       expect(fixture.nativeElement.innerHTML).not.toContain('component 3');\n+\n+       router.navigate([{outlets: {'outlet1': null, 'outlet2': '2', 'outlet3': '3'}}]);\n+       advance(fixture);\n+       expect(fixture.nativeElement.innerHTML).not.toContain('component 1');\n+       expect(fixture.nativeElement.innerHTML).toMatch('.*component 2.*component 3');\n+\n+       // reverse the outlets\n+       fixture.componentInstance.outlets = ['outlet3', 'outlet2', 'outlet1'];\n+       router.navigate([{outlets: {'outlet1': '1', 'outlet2': '2', 'outlet3': '3'}}]);\n+       advance(fixture);\n+       expect(fixture.nativeElement.innerHTML).toMatch('.*component 3.*component 2.*component 1');\n+     }));\n+});\n+\n+function advance(fixture: ComponentFixture<any>, millis?: number): void {\n+  tick(millis);\n+  fixture.detectChanges();\n+}\n+\n+function createRoot<T>(router: Router, type: Type<T>): ComponentFixture<T> {\n+  const f = TestBed.createComponent(type);\n+  advance(f);\n+  router.initialNavigation();\n+  advance(f);\n+  return f;\n+}\n\n\n###\n\n", "completion": "feat(router): make RouterOutlet name an Input so it can be set dynamically (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/router.md | file path B: aio/content/guide/router.md\n\n@@ -362,6 +362,7 @@ The following route guards are available in Angular:\n *   [`CanActivate`](api/router/CanActivate)\n *   [`CanActivateChild`](api/router/CanActivateChild)\n *   [`CanDeactivate`](api/router/CanDeactivate)\n+*   [`CanMatch`](api/router/CanMatch)\n *   [`Resolve`](api/router/Resolve)\n *   [`CanLoad`](api/router/CanLoad)\n \n\n\n###\n\n", "completion": "docs: add missing link to canMatch guard (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -779,7 +779,6 @@ export class RouterLinkActive implements OnChanges, OnDestroy, AfterContentInit\n // @public\n export class RouterLinkWithHref extends RouterLink {\n     constructor(router: Router, route: ActivatedRoute, locationStrategy: LocationStrategy);\n-    href: string | null;\n     // (undocumented)\n     static \u0275dir: i0.\u0275\u0275DirectiveDeclaration<RouterLinkWithHref, \"a[routerLink],area[routerLink]\", never, {}, {}, never, never, true, never>;\n     // (undocumented)\n\n---\n file path A: goldens/size-tracking/integration-payloads.json | file path B: goldens/size-tracking/integration-payloads.json\n\n@@ -33,7 +33,7 @@\n   \"cli-hello-world-lazy\": {\n     \"uncompressed\": {\n       \"runtime\": 2835,\n-      \"main\": 225269,\n+      \"main\": 225808,\n       \"polyfills\": 33842,\n       \"src_app_lazy_lazy_routes_ts\": 487\n     }\n\n---\n file path A: packages/core/test/bundling/router/bundle.golden_symbols.json | file path B: packages/core/test/bundling/router/bundle.golden_symbols.json\n\n@@ -716,6 +716,9 @@\n   {\n     \"name\": \"allocLFrame\"\n   },\n+  {\n+    \"name\": \"allowSanitizationBypassAndThrow\"\n+  },\n   {\n     \"name\": \"appendChild\"\n   },\n@@ -1187,6 +1190,9 @@\n   {\n     \"name\": \"getResolve\"\n   },\n+  {\n+    \"name\": \"getSanitizer\"\n+  },\n   {\n     \"name\": \"getSelectedIndex\"\n   },\n@@ -1571,6 +1577,9 @@\n   {\n     \"name\": \"pipeFromArray\"\n   },\n+  {\n+    \"name\": \"policy\"\n+  },\n   {\n     \"name\": \"prioritizedGuardValue\"\n   },\n@@ -1796,6 +1805,9 @@\n   {\n     \"name\": \"tree\"\n   },\n+  {\n+    \"name\": \"trustedScriptURLFromStringBypass\"\n+  },\n   {\n     \"name\": \"uniqueIdCounter\"\n   },\n@@ -1805,6 +1817,9 @@\n   {\n     \"name\": \"unwrapRNode\"\n   },\n+  {\n+    \"name\": \"unwrapSafeValue\"\n+  },\n   {\n     \"name\": \"updateMicroTaskStatus\"\n   },\n@@ -1889,6 +1904,9 @@\n   {\n     \"name\": \"\u0275\u0275queryRefresh\"\n   },\n+  {\n+    \"name\": \"\u0275\u0275sanitizeResourceUrl\"\n+  },\n   {\n     \"name\": \"\u0275\u0275sanitizeUrl\"\n   },\n\n---\n file path A: packages/router/src/directives/router_link.ts | file path B: packages/router/src/directives/router_link.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {LocationStrategy} from '@angular/common';\n-import {Attribute, Directive, ElementRef, HostBinding, HostListener, inject, Input, OnChanges, OnDestroy, Renderer2, SimpleChanges, \u0275coerceToBoolean as coerceToBoolean} from '@angular/core';\n+import {Attribute, Directive, ElementRef, HostBinding, HostListener, inject, Input, OnChanges, OnDestroy, Renderer2, SimpleChanges, \u0275coerceToBoolean as coerceToBoolean, \u0275\u0275sanitizeUrlOrResourceUrl} from '@angular/core';\n import {Subject, Subscription} from 'rxjs';\n \n import {Event, NavigationEnd} from '../events';\n@@ -125,9 +125,8 @@ export class RouterLink implements OnChanges, OnDestroy {\n   private _replaceUrl = false;\n \n   /**\n-   * Base class property that represents an `href` attribute binding on\n-   * an `<a>` element. The property is overridden by the `RouterLinkWithHref`\n-   * class using a @HostBinding.\n+   * Represents an `href` attribute value applied to a host element,\n+   * when a host element is `<a>`. For other tags, the value is `null`.\n    */\n   href: string|null = null;\n \n@@ -197,7 +196,7 @@ export class RouterLink implements OnChanges, OnDestroy {\n     if (this.isAnchorElement) {\n       this.subscription = router.events.subscribe((s: Event) => {\n         if (s instanceof NavigationEnd) {\n-          this.updateTargetUrlAndHref();\n+          this.updateHref();\n         }\n       });\n     } else {\n@@ -258,19 +257,13 @@ export class RouterLink implements OnChanges, OnDestroy {\n     if (this.tabIndexAttribute != null /* both `null` and `undefined` */ || this.isAnchorElement) {\n       return;\n     }\n-    const renderer = this.renderer;\n-    const nativeElement = this.el.nativeElement;\n-    if (newTabIndex !== null) {\n-      renderer.setAttribute(nativeElement, 'tabindex', newTabIndex);\n-    } else {\n-      renderer.removeAttribute(nativeElement, 'tabindex');\n-    }\n+    this.applyAttributeValue('tabindex', newTabIndex);\n   }\n \n   /** @nodoc */\n   ngOnChanges(changes: SimpleChanges) {\n     if (this.isAnchorElement) {\n-      this.updateTargetUrlAndHref();\n+      this.updateHref();\n     }\n     // This is subscribed to by `RouterLinkActive` so that it knows to update when there are changes\n     // to the RouterLinks it's tracking.\n@@ -333,10 +326,35 @@ export class RouterLink implements OnChanges, OnDestroy {\n     this.subscription?.unsubscribe();\n   }\n \n-  private updateTargetUrlAndHref(): void {\n+  private updateHref(): void {\n     this.href = this.urlTree !== null && this.locationStrategy ?\n         this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)) :\n         null;\n+\n+    const sanitizedValue = this.href === null ?\n+        null :\n+        // This class represents a directive that can be added to both `<a>` elements,\n+        // as well as other elements. As a result, we can't define security context at\n+        // compile time. So the security context is deferred to runtime.\n+        // The `\u0275\u0275sanitizeUrlOrResourceUrl` selects the necessary sanitizer function\n+        // based on the tag and property names. The logic mimics the one from\n+        // `packages/compiler/src/schema/dom_security_schema.ts`, which is used at compile time.\n+        //\n+        // Note: we should investigate whether we can switch to using `@HostBinding('attr.href')`\n+        // instead of applying a value via a renderer, after a final merge of the\n+        // `RouterLinkWithHref` directive.\n+        \u0275\u0275sanitizeUrlOrResourceUrl(this.href, this.el.nativeElement.tagName.toLowerCase(), 'href');\n+    this.applyAttributeValue('href', sanitizedValue);\n+  }\n+\n+  private applyAttributeValue(attrName: string, attrValue: string|null) {\n+    const renderer = this.renderer;\n+    const nativeElement = this.el.nativeElement;\n+    if (attrValue !== null) {\n+      renderer.setAttribute(nativeElement, attrName, attrValue);\n+    } else {\n+      renderer.removeAttribute(nativeElement, attrName);\n+    }\n   }\n \n   get urlTree(): UrlTree|null {\n@@ -371,17 +389,6 @@ export class RouterLink implements OnChanges, OnDestroy {\n   standalone: true,\n })\n export class RouterLinkWithHref extends RouterLink {\n-  /**\n-   * The url displayed on the anchor element.\n-   * @HostBinding('attr.href') is used rather than @HostBinding() because\n-   * it removes the href attribute when it becomes `null`.\n-   *\n-   * Note: this host binding is retained in the `RouterLinkWithHref` to\n-   * make sure the right security context is selected (which also takes\n-   * into account an element name from the selector).\n-   */\n-  @HostBinding('attr.href') override href: string|null = null;\n-\n   // For backwards compatibility, constructor arguments retained an old shape.\n   constructor(router: Router, route: ActivatedRoute, locationStrategy: LocationStrategy) {\n     super(\n\n\n###\n\n", "completion": "refactor(router): apply `href` value via renderer to further align RouterLink directives (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -19,7 +19,7 @@\n     \"build-local\": \"yarn ~~build\",\n     \"prebuild-local-ci\": \"yarn setup-local-ci\",\n     \"build-local-ci\": \"yarn ~~build --progress=false\",\n-    \"extract-cli-command-docs\": \"node tools/transforms/cli-docs-package/extract-cli-commands.js 556a775f3\",\n+    \"extract-cli-command-docs\": \"node tools/transforms/cli-docs-package/extract-cli-commands.js 77c70052e\",\n     \"lint\": \"yarn check-env && yarn docs-lint && ng lint && yarn example-lint && yarn tools-lint && yarn security-lint\",\n     \"test\": \"yarn check-env && ng test\",\n     \"test:bazel\": \"bazelisk test //aio:test\",\n\n\n###\n\n", "completion": "build(docs-infra): upgrade cli command docs sources to 77c70052e (#<issue-num>)"}
{"prompt": " file path A: package.json | file path B: package.json\n\n@@ -150,7 +150,7 @@\n     \"ngx-flamegraph\": \"0.0.11\",\n     \"nodejs-websocket\": \"^1.7.2\",\n     \"protractor\": \"^7.0.0\",\n-    \"puppeteer\": \"10.2.0\",\n+    \"puppeteer\": \"18.0.5\",\n     \"reflect-metadata\": \"^0.1.3\",\n     \"requirejs\": \"^2.3.6\",\n     \"rollup\": \"~2.79.0\",\n\n---\n file path A: packages/zone.js/test/typings/tsconfig.json | file path B: packages/zone.js/test/typings/tsconfig.json\n\n@@ -8,7 +8,7 @@\n     \"moduleResolution\": \"node\",\n     \"outDir\": \"./build\",\n     \"rootDir\": \".\",\n-    \"target\": \"es5\",\n+    \"target\": \"ES2015\",\n     \"noEmitOnError\": false,\n     \"stripInternal\": false,\n     \"strict\": true,\n\n---\n file path A: scripts/puppeteer-chromedriver-versions.js | file path B: scripts/puppeteer-chromedriver-versions.js\n\n@@ -13,23 +13,6 @@\n // \"chromium_revision\": \"722234\" but this does not map easily to the Chrome version\n // so we use this mapping here instead.\n module.exports = {\n-  '10.2.0': '93.0.4577.63',\n-  '9.0.0': '91.0.4472.19',\n-  '5.4.1': '87.0.4280.0',\n-  '5.3.1': '86.0.4240.0',\n-  '5.2.1': '85.0.4182.0',\n-  '5.1.0': '84.0.4147.0',\n-  '3.3.0': '83.0.4103.0',\n-  '3.2.0': '83.0.4103.0',\n-  '3.1.0': '83.0.4103.0',\n-  '3.0.0': '81.0.4044.0',\n-  '2.1.1': '80.0.3987.0',\n-  '2.1.0': '80.0.3987.0',\n-  '2.0.0': '79.0.3942.0',\n-  '1.20.0': '78.0.3882.0',\n-  '1.19.0': '77.0.3803.0',\n-  '1.17.0': '76.0.3803.0',\n-  '1.15.0': '75.0.3765.0',\n-  '1.13.0': '74.0.3723.0',\n-  '1.12.2': '73.0.3679.0',\n+  '18.0.5' : '106.0.5249.21',\n+  '10.2.0' : '93.0.4577.63',\n };\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -5972,6 +5972,13 @@ cross-env@^7.0.3:\n   dependencies:\n     cross-spawn \"^7.0.1\"\n \n+cross-fetch@3.1.5:\n+  version \"3.1.5\"\n+  resolved \"https://registry.yarnpkg.com/cross-fetch/-/cross-fetch-3.1.5.tgz#e1389f44d9e7ba767907f7af8454787952ab534f\"\n+  integrity sha512-lvb1SBsI0Z7GDwmuid+mU3kWVBwTVUbe7S0H52yaaAdQOXq2YktTCZdlAcNKFzE6QtRz0snpw9bNiPeOIkkQvw==\n+  dependencies:\n+    node-fetch \"2.6.7\"\n+\n cross-spawn@^6.0.5:\n   version \"6.0.5\"\n   resolved \"https://registry.yarnpkg.com/cross-spawn/-/cross-spawn-6.0.5.tgz#4a5ec7c64dfae22c3a14124dbacdee846d80cbc4\"\n@@ -6746,16 +6753,16 @@ dev-ip@^1.0.1:\n   resolved \"https://registry.yarnpkg.com/dev-ip/-/dev-ip-1.0.1.tgz#a76a3ed1855be7a012bb8ac16cb80f3c00dc28f0\"\n   integrity sha512-LmVkry/oDShEgSZPNgqCIp2/TlqtExeGmymru3uCELnfyjY11IzpAproLYs+1X88fXO6DBoYP3ul2Xo2yz2j6A==\n \n+devtools-protocol@0.0.1036444:\n+  version \"0.0.1036444\"\n+  resolved \"https://registry.yarnpkg.com/devtools-protocol/-/devtools-protocol-0.0.1036444.tgz#a570d3cdde61527c82f9b03919847b8ac7b1c2b9\"\n+  integrity sha512-0y4f/T8H9lsESV9kKP1HDUXgHxCdniFeJh6Erq+FbdOEvp/Ydp9t8kcAAM5gOd17pMrTDlFWntoHtzzeTUWKNw==\n+\n devtools-protocol@0.0.818844:\n   version \"0.0.818844\"\n   resolved \"https://registry.yarnpkg.com/devtools-protocol/-/devtools-protocol-0.0.818844.tgz#d1947278ec85b53e4c8ca598f607a28fa785ba9e\"\n   integrity sha512-AD1hi7iVJ8OD0aMLQU5VK0XH9LDlA1+BcPIgrAxPfaibx2DbWucuyOhc4oyQCbnvDDO68nN6/LcKfqTP343Jjg==\n \n-devtools-protocol@0.0.901419:\n-  version \"0.0.901419\"\n-  resolved \"https://registry.yarnpkg.com/devtools-protocol/-/devtools-protocol-0.0.901419.tgz#79b5459c48fe7e1c5563c02bd72f8fec3e0cebcd\"\n-  integrity sha512-4INMPwNm9XRpBukhNbF7OB6fNTTCaI8pzy/fXg0xQzAy5h3zL1P8xT3QazgKqBrb/hAYwIBizqDBZ7GtJE74QQ==\n-\n devtools@6.12.1:\n   version \"6.12.1\"\n   resolved \"https://registry.yarnpkg.com/devtools/-/devtools-6.12.1.tgz#f0298c6d6f46d8d3b751dd8fa4a0c7bc76e1268f\"\n@@ -9370,7 +9377,7 @@ http2-wrapper@^1.0.0-beta.5.2:\n     quick-lru \"^5.1.1\"\n     resolve-alpn \"^1.0.0\"\n \n-https-proxy-agent@5, https-proxy-agent@5.0.0, https-proxy-agent@5.0.1, https-proxy-agent@^2.2.1, https-proxy-agent@^4.0.0, https-proxy-agent@^5.0.0:\n+https-proxy-agent@5, https-proxy-agent@5.0.1, https-proxy-agent@^2.2.1, https-proxy-agent@^4.0.0, https-proxy-agent@^5.0.0:\n   version \"5.0.1\"\n   resolved \"https://registry.yarnpkg.com/https-proxy-agent/-/https-proxy-agent-5.0.1.tgz#c59ef224a04fe8b754f3db0063a25ea30d0005d6\"\n   integrity sha512-dFcAjpTQFgoLMzC2VwU+C/CbS7uRL0lWmxDITmqm7C+7F0Odmj6s9l6alZc6AELXhrnggM2CeWSXHGOdX2YtwA==\n@@ -11447,7 +11454,7 @@ mkdirp-classic@^0.5.2:\n   resolved \"https://registry.yarnpkg.com/mkdirp-classic/-/mkdirp-classic-0.5.3.tgz#fa10c9115cc6d8865be221ba47ee9bed78601113\"\n   integrity sha512-gKLcREMhtuZRwRAfqP3RFW+TK4JqApVBtOIftVgjuABpAtpxhPGaDcfvbhNvD0B8iD1oUr/txX35NjcaY6Ns/A==\n \n-\"mkdirp@>=0.5 0\", mkdirp@^0.5.1, mkdirp@^0.5.3, mkdirp@^0.5.5:\n+\"mkdirp@>=0.5 0\", mkdirp@^0.5.3, mkdirp@^0.5.5:\n   version \"0.5.6\"\n   resolved \"https://registry.yarnpkg.com/mkdirp/-/mkdirp-0.5.6.tgz#7def03d2432dcae4ba1d611445c48396062255f6\"\n   integrity sha512-FP+p8RB8OWpF3YZBCrP5gtADmtXApB5AMLn+vdyA+PyxCjrCs00mjyUozssO33cwDeT3wNGdLxJ5M//YqtHAJw==\n@@ -11633,12 +11640,7 @@ node-emoji@^1.11.0:\n   dependencies:\n     lodash \"^4.17.21\"\n \n-node-fetch@2.6.1:\n-  version \"2.6.1\"\n-  resolved \"https://registry.yarnpkg.com/node-fetch/-/node-fetch-2.6.1.tgz#045bd323631f76ed2e2b55573394416b639a0052\"\n-  integrity sha512-V4aYg89jEoVRxRb2fJdAg8FHvI7cEyYdVAh94HH0UIK8oJxUfkjlDQN9RbMx+bEjP7+ggMiFRprSti032Oipxw==\n-\n-node-fetch@^2.6.1, node-fetch@^2.6.7:\n+node-fetch@2.6.7, node-fetch@^2.6.1, node-fetch@^2.6.7:\n   version \"2.6.7\"\n   resolved \"https://registry.yarnpkg.com/node-fetch/-/node-fetch-2.6.7.tgz#24de9fba827e3b4ae44dc8b20256a379160052ad\"\n   integrity sha512-ZjMPFEfVx5j+y2yF35Kzx5sF7kDzxuDj6ziH4FFbOp87zKDZNx8yExJIb05OGF4Nlt9IHFIMBkRl41VdvcNdbQ==\n@@ -12555,7 +12557,7 @@ piscina@3.2.0:\n   optionalDependencies:\n     nice-napi \"^1.0.2\"\n \n-pkg-dir@4.2.0, pkg-dir@^4.1.0, pkg-dir@^4.2.0:\n+pkg-dir@^4.1.0, pkg-dir@^4.2.0:\n   version \"4.2.0\"\n   resolved \"https://registry.yarnpkg.com/pkg-dir/-/pkg-dir-4.2.0.tgz#f099133df7ede422e81d1d8448270eeb3e4261f3\"\n   integrity sha512-HRDzbaKjC+AOWVXxAU/x54COGeIv9eb+6CkDSQoNTt4XyWoIJvuPsXizxu/Fr23EiekbtZwmh1IcIG/l/a10GQ==\n@@ -12993,12 +12995,7 @@ process-nextick-args@^2.0.0, process-nextick-args@~2.0.0:\n   resolved \"https://registry.yarnpkg.com/process-nextick-args/-/process-nextick-args-2.0.1.tgz#7820d9b16120cc55ca9ae7792680ae7dba6d7fe2\"\n   integrity sha512-3ouUOpQhtgrbOa17J7+uxOTpITYWaGP7/AhoR3+A+/1e9skrzelGi/dXzEYyvbxubEF6Wn2ypscTKiKJFFn1ag==\n \n-progress@2.0.1:\n-  version \"2.0.1\"\n-  resolved \"https://registry.yarnpkg.com/progress/-/progress-2.0.1.tgz#c9242169342b1c29d275889c95734621b1952e31\"\n-  integrity sha512-OE+a6vzqazc+K6LxJrX5UPyKFvGnL5CYmq2jFGNIBWHpc4QyE49/YOumcrpQFJpfejmvRtbJzgO1zPmMCqlbBg==\n-\n-progress@^2.0.1, progress@^2.0.3:\n+progress@2.0.3, progress@^2.0.1, progress@^2.0.3:\n   version \"2.0.3\"\n   resolved \"https://registry.yarnpkg.com/progress/-/progress-2.0.3.tgz#7e8cf8d8f5b8f239c1bc68beb4eb78567d572ef8\"\n   integrity sha512-7PiHtLll5LdnKIMw100I+8xJXR5gW2QwWYkT6iJva0bXitZKa/XMrSbdmg3r2Xnaidz9Qumd0VPaMrZlF9V9sA==\n@@ -13191,23 +13188,22 @@ puppeteer-core@^5.1.0:\n     unbzip2-stream \"^1.3.3\"\n     ws \"^7.2.3\"\n \n-puppeteer@10.2.0:\n-  version \"10.2.0\"\n-  resolved \"https://registry.yarnpkg.com/puppeteer/-/puppeteer-10.2.0.tgz#7d8d7fda91e19a7cfd56986e0275448e6351849e\"\n-  integrity sha512-OR2CCHRashF+f30+LBOtAjK6sNtz2HEyTr5FqAvhf8lR/qB3uBRoIZOwQKgwoyZnMBsxX7ZdazlyBgGjpnkiMw==\n+puppeteer@18.0.5:\n+  version \"18.0.5\"\n+  resolved \"https://registry.yarnpkg.com/puppeteer/-/puppeteer-18.0.5.tgz#873223b17b92345182c5b5e8cfbd6f3117f1547d\"\n+  integrity sha512-s4erjxU0VtKojPvF+KvLKG6OHUPw7gO2YV1dtOsoryyCbhrs444fXb4QZqGWuTv3V/rgSCUzeixxu34g0ZkSMA==\n   dependencies:\n-    debug \"4.3.1\"\n-    devtools-protocol \"0.0.901419\"\n+    cross-fetch \"3.1.5\"\n+    debug \"4.3.4\"\n+    devtools-protocol \"0.0.1036444\"\n     extract-zip \"2.0.1\"\n-    https-proxy-agent \"5.0.0\"\n-    node-fetch \"2.6.1\"\n-    pkg-dir \"4.2.0\"\n-    progress \"2.0.1\"\n+    https-proxy-agent \"5.0.1\"\n+    progress \"2.0.3\"\n     proxy-from-env \"1.1.0\"\n     rimraf \"3.0.2\"\n-    tar-fs \"2.0.0\"\n-    unbzip2-stream \"1.3.3\"\n-    ws \"7.4.6\"\n+    tar-fs \"2.1.1\"\n+    unbzip2-stream \"1.4.3\"\n+    ws \"8.8.1\"\n \n q@1.4.1:\n   version \"1.4.1\"\n@@ -15098,17 +15094,7 @@ tapable@^2.1.1, tapable@^2.2.0:\n   resolved \"https://registry.yarnpkg.com/tapable/-/tapable-2.2.1.tgz#1967a73ef4060a82f12ab96af86d52fdb76eeca0\"\n   integrity sha512-GNzQvQTOIP6RyTfE2Qxb8ZVlNmw0n88vp1szwWRimP02mnTsx3Wtn5qRdqY9w2XduFNUgvOwhNnQsjwCp+kqaQ==\n \n-tar-fs@2.0.0:\n-  version \"2.0.0\"\n-  resolved \"https://registry.yarnpkg.com/tar-fs/-/tar-fs-2.0.0.tgz#677700fc0c8b337a78bee3623fdc235f21d7afad\"\n-  integrity sha512-vaY0obB6Om/fso8a8vakQBzwholQ7v5+uy+tF3Ozvxv1KNezmVQAiWtcNmMHFSFPqL3dJA8ha6gdtFbfX9mcxA==\n-  dependencies:\n-    chownr \"^1.1.1\"\n-    mkdirp \"^0.5.1\"\n-    pump \"^3.0.0\"\n-    tar-stream \"^2.0.0\"\n-\n-tar-fs@^2.0.0:\n+tar-fs@2.1.1, tar-fs@^2.0.0:\n   version \"2.1.1\"\n   resolved \"https://registry.yarnpkg.com/tar-fs/-/tar-fs-2.1.1.tgz#489a15ab85f1f0befabb370b7de4f9eb5cbe8784\"\n   integrity sha512-V0r2Y9scmbDRLCNex/+hYzvp/zyYjvFbHPNgVTKfQvVrb6guiE/fxP+XblDNR011utopbkex2nM4dHNV6GDsng==\n@@ -15131,7 +15117,7 @@ tar-stream@^1.5.2:\n     to-buffer \"^1.1.1\"\n     xtend \"^4.0.0\"\n \n-tar-stream@^2.0.0, tar-stream@^2.1.4, tar-stream@^2.2.0:\n+tar-stream@^2.1.4, tar-stream@^2.2.0:\n   version \"2.2.0\"\n   resolved \"https://registry.yarnpkg.com/tar-stream/-/tar-stream-2.2.0.tgz#acad84c284136b060dc3faa64474aa9aebd77287\"\n   integrity sha512-ujeqbceABgwMZxEJnk2HDY2DlnUZ+9oEcb1KzTVfYHio0UE6dG71n60d8D2I4qNvleWrrXpmjpt7vZeF1LnMZQ==\n@@ -15701,15 +15687,7 @@ uglify-js@^3.1.4:\n   resolved \"https://registry.yarnpkg.com/uglify-js/-/uglify-js-3.16.2.tgz#0481e1dbeed343ad1c2ddf3c6d42e89b7a6d4def\"\n   integrity sha512-AaQNokTNgExWrkEYA24BTNMSjyqEXPSfhqoS0AxmHkCJ4U+Dyy5AvbGV/sqxuxficEfGGoX3zWw9R7QpLFfEsg==\n \n-unbzip2-stream@1.3.3:\n-  version \"1.3.3\"\n-  resolved \"https://registry.yarnpkg.com/unbzip2-stream/-/unbzip2-stream-1.3.3.tgz#d156d205e670d8d8c393e1c02ebd506422873f6a\"\n-  integrity sha512-fUlAF7U9Ah1Q6EieQ4x4zLNejrRvDWUYmxXUpN3uziFYCHapjWFaCAnreY9bGgxzaMCFAPPpYNng57CypwJVhg==\n-  dependencies:\n-    buffer \"^5.2.1\"\n-    through \"^2.3.8\"\n-\n-unbzip2-stream@^1.0.9, unbzip2-stream@^1.3.3:\n+unbzip2-stream@1.4.3, unbzip2-stream@^1.0.9, unbzip2-stream@^1.3.3:\n   version \"1.4.3\"\n   resolved \"https://registry.yarnpkg.com/unbzip2-stream/-/unbzip2-stream-1.4.3.tgz#b0da04c4371311df771cdc215e87f2130991ace7\"\n   integrity sha512-mlExGW4w71ebDJviH16lQLtZS32VKqsSfk80GCfUlwT/4/hNRFsoscrF/c++9xinkMzECL1uL9DDwXqFWkruPg==\n@@ -16585,10 +16563,10 @@ write-file-atomic@^3.0.0:\n     signal-exit \"^3.0.2\"\n     typedarray-to-buffer \"^3.1.5\"\n \n-ws@7.4.6:\n-  version \"7.4.6\"\n-  resolved \"https://registry.yarnpkg.com/ws/-/ws-7.4.6.tgz#5654ca8ecdeee47c33a9a4bf6d28e2be2980377c\"\n-  integrity sha512-YmhHDO4MzaDLB+M9ym/mDA5z0naX8j7SIlT8f8z+I0VtzsRbekxEutHSme7NPS2qE8StCYQNUnfWdXta/Yu85A==\n+ws@8.8.1:\n+  version \"8.8.1\"\n+  resolved \"https://registry.yarnpkg.com/ws/-/ws-8.8.1.tgz#5dbad0feb7ade8ecc99b830c1d77c913d4955ff0\"\n+  integrity sha512-bGy2JzvzkPowEJV++hF07hAD6niYSr0JzBNo/J29WsB57A2r7Wlc1UFcTR9IzrPvuNVO4B8LGqF8qcpsVOhJCA==\n \n ws@>=8.7.0, ws@^8.4.2:\n   version \"8.8.0\"\n\n\n###\n\n", "completion": "build: update puppeteer to 18.0.5 (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/component-interaction/e2e/src/app.e2e-spec.ts | file path B: aio/content/examples/component-interaction/e2e/src/app.e2e-spec.ts\n\n@@ -7,7 +7,7 @@ describe('Component Communication Cookbook Tests', () => {\n   describe('Parent-to-child communication', () => {\n     // #docregion parent-to-child\n     // ...\n-    const heroNames = ['Dr IQ', 'Magneta', 'Bombasto'];\n+    const heroNames = ['Dr. IQ', 'Magneta', 'Bombasto'];\n     const masterName = 'Master';\n \n     it('should pass properties to children properly', async () => {\n@@ -30,7 +30,7 @@ describe('Component Communication Cookbook Tests', () => {\n     // ...\n     it('should display trimmed, non-empty names', async () => {\n       const nonEmptyNameIndex = 0;\n-      const nonEmptyName = '\"Dr IQ\"';\n+      const nonEmptyName = '\"Dr. IQ\"';\n       const parent = element(by.tagName('app-name-parent'));\n       const hero = parent.all(by.tagName('app-name-child')).get(nonEmptyNameIndex);\n \n\n---\n file path A: aio/content/examples/component-interaction/src/app/hero.ts | file path B: aio/content/examples/component-interaction/src/app/hero.ts\n\n@@ -3,7 +3,7 @@ export interface Hero {\n }\n \n export const HEROES = [\n-  {name: 'Dr IQ'},\n+  {name: 'Dr. IQ'},\n   {name: 'Magneta'},\n   {name: 'Bombasto'}\n ];\n\n---\n file path A: aio/content/examples/component-interaction/src/app/name-parent.component.ts | file path B: aio/content/examples/component-interaction/src/app/name-parent.component.ts\n\n@@ -10,7 +10,7 @@ import { Component } from '@angular/core';\n   `\n })\n export class NameParentComponent {\n-  // Displays 'Dr IQ', '<no name set>', 'Bombasto'\n-  names = ['Dr IQ', '   ', '  Bombasto  '];\n+  // Displays 'Dr. IQ', '<no name set>', 'Bombasto'\n+  names = ['Dr. IQ', '   ', '  Bombasto  '];\n }\n // #enddocregion\n\n---\n file path A: aio/content/examples/component-interaction/src/app/votetaker.component.ts | file path B: aio/content/examples/component-interaction/src/app/votetaker.component.ts\n\n@@ -17,7 +17,7 @@ import { Component } from '@angular/core';\n export class VoteTakerComponent {\n   agreed = 0;\n   disagreed = 0;\n-  voters = ['Dr IQ', 'Celeritas', 'Bombasto'];\n+  voters = ['Dr. IQ', 'Celeritas', 'Bombasto'];\n \n   onVoted(agreed: boolean) {\n     if (agreed) {\n\n---\n file path A: aio/content/examples/dependency-injection/src/app/heroes/mock-heroes.ts | file path B: aio/content/examples/dependency-injection/src/app/heroes/mock-heroes.ts\n\n@@ -8,7 +8,7 @@ export const HEROES: Hero[] = [\n   { id: 15, isSecret: false, name: 'Magneta' },\n   { id: 16, isSecret: false, name: 'RubberMan' },\n   { id: 17, isSecret: false, name: 'Dynama' },\n-  { id: 18, isSecret: true,  name: 'Dr IQ' },\n+  { id: 18, isSecret: true,  name: 'Dr. IQ' },\n   { id: 19, isSecret: true,  name: 'Magma' },\n   { id: 20, isSecret: true,  name: 'Tornado' }\n ];\n\n---\n file path A: aio/content/examples/dynamic-component-loader/src/app/ad.service.ts | file path B: aio/content/examples/dynamic-component-loader/src/app/ad.service.ts\n\n@@ -15,7 +15,7 @@ export class AdService {\n       ),\n       new AdItem(\n         HeroProfileComponent,\n-        { name: 'Dr IQ', bio: 'Smart as they come' }\n+        { name: 'Dr. IQ', bio: 'Smart as they come' }\n       ),\n       new AdItem(\n         HeroJobAdComponent,\n\n---\n file path A: aio/content/examples/forms/src/app/hero-form/hero-form.component.ts | file path B: aio/content/examples/forms/src/app/hero-form/hero-form.component.ts\n\n@@ -14,7 +14,7 @@ export class HeroFormComponent {\n   powers = ['Really Smart', 'Super Flexible',\n             'Super Hot', 'Weather Changer'];\n \n-  model = new Hero(18, 'Dr IQ', this.powers[0], 'Chuck Overstreet');\n+  model = new Hero(18, 'Dr. IQ', this.powers[0], 'Chuck Overstreet');\n \n   // #docregion submitted\n   submitted = false;\n\n---\n file path A: aio/content/examples/router/src/app/heroes/mock-heroes.ts | file path B: aio/content/examples/router/src/app/heroes/mock-heroes.ts\n\n@@ -7,7 +7,7 @@ export const HEROES: Hero[] = [\n   { id: 15, name: 'Magneta' },\n   { id: 16, name: 'RubberMan' },\n   { id: 17, name: 'Dynama' },\n-  { id: 18, name: 'Dr IQ' },\n+  { id: 18, name: 'Dr. IQ' },\n   { id: 19, name: 'Magma' },\n   { id: 20, name: 'Tornado' }\n ];\n\n\n###\n\n", "completion": "fix(docs-infra): add punctuation to dr iq (#<issue-num>)"}
{"prompt": " file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -8,12 +8,12 @@\n \n import {CommonModule, DOCUMENT} from '@angular/common';\n import {RuntimeErrorCode} from '@angular/common/src/errors';\n-import {Component, Provider} from '@angular/core';\n+import {Component, Provider, Type} from '@angular/core';\n import {ComponentFixture, TestBed} from '@angular/core/testing';\n import {expect} from '@angular/platform-browser/testing/src/matchers';\n import {withHead} from '@angular/private/testing';\n \n-import {IMAGE_LOADER, ImageLoader, ImageLoaderConfig} from '../../src/directives/ng_optimized_image/image_loaders/image_loader';\n+import {createImageLoader, IMAGE_LOADER, ImageLoader, ImageLoaderConfig} from '../../src/directives/ng_optimized_image/image_loaders/image_loader';\n import {ABSOLUTE_SRCSET_DENSITY_CAP, assertValidNgSrcset, NgOptimizedImage, RECOMMENDED_SRCSET_DENSITY_CAP} from '../../src/directives/ng_optimized_image/ng_optimized_image';\n import {PRECONNECT_CHECK_BLOCKLIST} from '../../src/directives/ng_optimized_image/preconnect_link_checker';\n \n@@ -865,6 +865,32 @@ describe('Image directive', () => {\n       expect(img.src).toBe(`${IMG_BASE_URL}/img.png`);\n     });\n \n+    it(`should allow providing image loaders via Component providers`, withHead('', () => {\n+         const createImgUrl = (path: string, config: ImageLoaderConfig) => `${path}/${config.src}`;\n+         const loaderWithPath = createImageLoader(createImgUrl);\n+\n+         @Component({\n+           selector: 'test-cmp',\n+           template: '<img ngSrc=\"a.png\" width=\"100\" height=\"50\" priority>',\n+           providers: [loaderWithPath('https://component.io')]\n+         })\n+         class TestComponent {\n+         }\n+\n+         setupTestingModule(\n+             {component: TestComponent, extraProviders: [loaderWithPath('https://default.io')]});\n+\n+         const fixture = TestBed.createComponent(TestComponent);\n+         fixture.detectChanges();\n+\n+         const defaultLoader = TestBed.inject(IMAGE_LOADER);\n+         const nativeElement = fixture.nativeElement as HTMLElement;\n+         const img = nativeElement.querySelector('img')!;\n+\n+         expect(defaultLoader({src: 'a.png'})).toBe('https://default.io/a.png');\n+         expect(img.src).toBe('https://component.io/a.png');\n+       }));\n+\n     describe('`ngSrcset` values', () => {\n       let imageLoader!: ImageLoader;\n \n@@ -1033,7 +1059,8 @@ class TestComponent {\n   priority = false;\n }\n \n-function setupTestingModule(config?: {imageLoader?: ImageLoader, extraProviders?: any[]}) {\n+function setupTestingModule(\n+    config?: {imageLoader?: ImageLoader, extraProviders?: Provider[], component?: Type<unknown>}) {\n   const defaultLoader = (config: ImageLoaderConfig) => {\n     const isAbsolute = /^https?:\\/\\//.test(config.src);\n     return isAbsolute ? config.src : window.location.origin + '/' + config.src;\n@@ -1047,7 +1074,7 @@ function setupTestingModule(config?: {imageLoader?: ImageLoader, extraProviders?\n   ];\n \n   TestBed.configureTestingModule({\n-    declarations: [TestComponent],\n+    declarations: [config?.component ?? TestComponent],\n     // Note: the `NgOptimizedImage` directive is experimental and is not a part of the\n     // `CommonModule` yet, so it's imported separately.\n     imports: [CommonModule, NgOptimizedImage],\n\n\n###\n\n", "completion": "test(common): demonstrate that image loaders are configurable on a component level (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/errors.md | file path B: goldens/public-api/common/errors.md\n\n@@ -13,8 +13,6 @@ export const enum RuntimeErrorCode {\n     // (undocumented)\n     INVALID_PIPE_ARGUMENT = 2100,\n     // (undocumented)\n-    INVALID_PRECONNECT_CHECK_BLOCKLIST = 2957,\n-    // (undocumented)\n     LCP_IMG_MISSING_PRIORITY = 2955,\n     // (undocumented)\n     NG_FOR_MISSING_DIFFER = -2200,\n\n---\n file path A: goldens/public-api/common/index.md | file path B: goldens/public-api/common/index.md\n\n@@ -791,24 +791,16 @@ export { PopStateEvent_2 as PopStateEvent }\n export const PRECONNECT_CHECK_BLOCKLIST: InjectionToken<(string | string[])[]>;\n \n // @public\n-export const provideCloudflareLoader: (path: string, options?: {\n-    ensurePreconnect?: boolean | undefined;\n-}) => Provider[];\n+export const provideCloudflareLoader: (path: string) => Provider[];\n \n // @public\n-export const provideCloudinaryLoader: (path: string, options?: {\n-    ensurePreconnect?: boolean | undefined;\n-}) => Provider[];\n+export const provideCloudinaryLoader: (path: string) => Provider[];\n \n // @public\n-export const provideImageKitLoader: (path: string, options?: {\n-    ensurePreconnect?: boolean | undefined;\n-}) => Provider[];\n+export const provideImageKitLoader: (path: string) => Provider[];\n \n // @public\n-export const provideImgixLoader: (path: string, options?: {\n-    ensurePreconnect?: boolean | undefined;\n-}) => Provider[];\n+export const provideImgixLoader: (path: string) => Provider[];\n \n // @public\n export function registerLocaleData(data: any, localeId?: string | any, extraData?: any): void;\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts\n\n@@ -15,10 +15,6 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  * Cloudflare Image Resizing; it will not work with Cloudflare Images or Cloudflare Polish.\n  *\n  * @param path Your domain name, e.g. https://mysite.com\n- * @param options An object with extra configuration:\n- * - `ensurePreconnect`: boolean flag indicating whether the NgOptimizedImage directive\n- *                       should verify that there is a corresponding `<link rel=\"preconnect\">`\n- *                       present in the document's `<head>`.\n  * @returns Provider that provides an ImageLoader function\n  *\n  * @publicApi\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts\n\n@@ -16,10 +16,6 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  * https://res.cloudinary.com/mysite\n  * https://mysite.cloudinary.com\n  * https://subdomain.mysite.com\n- * @param options An object with extra configuration:\n- * - `ensurePreconnect`: boolean flag indicating whether the NgOptimizedImage directive\n- *                       should verify that there is a corresponding `<link rel=\"preconnect\">`\n- *                       present in the document's `<head>`.\n  * @returns Set of providers to configure the Cloudinary loader.\n  *\n  * @publicApi\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts\n\n@@ -9,7 +9,6 @@\n import {InjectionToken, Provider, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../../../errors';\n-import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n import {isAbsoluteUrl, isValidPath, normalizePath, normalizeSrc} from '../url';\n \n /**\n@@ -73,8 +72,7 @@ export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n  */\n export function createImageLoader(\n     buildUrlFn: (path: string, config: ImageLoaderConfig) => string, exampleUrls?: string[]) {\n-  return function provideImageLoader(\n-      path: string, options: {ensurePreconnect?: boolean} = {ensurePreconnect: true}) {\n+  return function provideImageLoader(path: string) {\n     if (!isValidPath(path)) {\n       throwInvalidPathError(path, exampleUrls || []);\n     }\n@@ -95,12 +93,8 @@ export function createImageLoader(\n \n       return buildUrlFn(path, {...config, src: normalizeSrc(config.src)});\n     };\n-    const providers: Provider[] = [{provide: IMAGE_LOADER, useValue: loaderFn}];\n-\n-    if (ngDevMode && options.ensurePreconnect === false) {\n-      providers.push({provide: PRECONNECT_CHECK_BLOCKLIST, useValue: [path], multi: true});\n-    }\n \n+    const providers: Provider[] = [{provide: IMAGE_LOADER, useValue: loaderFn}];\n     return providers;\n   };\n }\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts\n\n@@ -15,10 +15,6 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  * This URL should match one of the following formats:\n  * https://ik.imagekit.io/myaccount\n  * https://subdomain.mysite.com\n- * @param options An object with extra configuration:\n- * - `ensurePreconnect`: boolean flag indicating whether the NgOptimizedImage directive\n- *                       should verify that there is a corresponding `<link rel=\"preconnect\">`\n- *                       present in the document's `<head>`.\n  * @returns Set of providers to configure the ImageKit loader.\n  *\n  * @publicApi\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts\n\n@@ -13,10 +13,6 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  *\n  * @param path path to the desired Imgix origin,\n  * e.g. https://somepath.imgix.net or https://images.mysite.com\n- * @param options An object with extra configuration:\n- * - `ensurePreconnect`: boolean flag indicating whether the NgOptimizedImage directive\n- *                       should verify that there is a corresponding `<link rel=\"preconnect\">`\n- *                       present in the document's `<head>`.\n  * @returns Set of providers to configure the Imgix loader.\n  *\n  * @publicApi\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/preconnect_link_checker.ts | file path B: packages/common/src/directives/ng_optimized_image/preconnect_link_checker.ts\n\n@@ -19,18 +19,18 @@ import {extractHostname, getUrl} from './url';\n const INTERNAL_PRECONNECT_CHECK_BLOCKLIST = new Set(['localhost', '127.0.0.1', '0.0.0.0']);\n \n /**\n- * Multi-provider injection token to configure which origins should be excluded\n+ * Injection token to configure which origins should be excluded\n  * from the preconnect checks. It can either be a single string or an array of strings\n  * to represent a group of origins, for example:\n  *\n  * ```typescript\n- *  {provide: PRECONNECT_CHECK_BLOCKLIST, multi: true, useValue: 'https://your-domain.com'}\n+ *  {provide: PRECONNECT_CHECK_BLOCKLIST, useValue: 'https://your-domain.com'}\n  * ```\n  *\n  * or:\n  *\n  * ```typescript\n- *  {provide: PRECONNECT_CHECK_BLOCKLIST, multi: true,\n+ *  {provide: PRECONNECT_CHECK_BLOCKLIST,\n  *   useValue: ['https://your-domain-1.com', 'https://your-domain-2.com']}\n  * ```\n  *\n@@ -78,16 +78,13 @@ export class PreconnectLinkChecker {\n     }\n   }\n \n-  private populateBlocklist(origins: Array<string|string[]>) {\n+  private populateBlocklist(origins: Array<string|string[]>|string) {\n     if (Array.isArray(origins)) {\n       deepForEach(origins, origin => {\n         this.blocklist.add(extractHostname(origin));\n       });\n     } else {\n-      throw new RuntimeError(\n-          RuntimeErrorCode.INVALID_PRECONNECT_CHECK_BLOCKLIST,\n-          `The blocklist for the preconnect check was not provided as an array. ` +\n-              `Check that the \\`PRECONNECT_CHECK_BLOCKLIST\\` token is configured as a \\`multi: true\\` provider.`);\n+      this.blocklist.add(extractHostname(origins));\n     }\n   }\n \n\n---\n file path A: packages/common/src/errors.ts | file path B: packages/common/src/errors.ts\n\n@@ -28,7 +28,6 @@ export const enum RuntimeErrorCode {\n   REQUIRED_INPUT_MISSING = 2954,\n   LCP_IMG_MISSING_PRIORITY = 2955,\n   PRIORITY_IMG_MISSING_PRECONNECT_TAG = 2956,\n-  INVALID_PRECONNECT_CHECK_BLOCKLIST = 2957,\n   UNEXPECTED_DEV_MODE_CHECK_IN_PROD_MODE = 2958,\n   INVALID_LOADER_ARGUMENTS = 2959,\n   OVERSIZED_IMAGE = 2960,\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -742,7 +742,7 @@ describe('Image directive', () => {\n     describe('PRECONNECT_CHECK_BLOCKLIST token', () => {\n       it(`should allow passing host names`, withHead('', () => {\n            const providers = [\n-             {provide: PRECONNECT_CHECK_BLOCKLIST, useValue: 'angular.io', multi: true},\n+             {provide: PRECONNECT_CHECK_BLOCKLIST, useValue: 'angular.io'},\n            ];\n            setupTestingModule({imageLoader, extraProviders: providers});\n \n@@ -757,7 +757,7 @@ describe('Image directive', () => {\n \n       it(`should allow passing origins`, withHead('', () => {\n            const providers = [\n-             {provide: PRECONNECT_CHECK_BLOCKLIST, useValue: 'https://angular.io', multi: true},\n+             {provide: PRECONNECT_CHECK_BLOCKLIST, useValue: 'https://angular.io'},\n            ];\n            setupTestingModule({imageLoader, extraProviders: providers});\n \n@@ -772,7 +772,7 @@ describe('Image directive', () => {\n \n       it(`should allow passing arrays of host names`, withHead('', () => {\n            const providers = [\n-             {provide: PRECONNECT_CHECK_BLOCKLIST, useValue: ['https://angular.io'], multi: true},\n+             {provide: PRECONNECT_CHECK_BLOCKLIST, useValue: ['https://angular.io']},\n            ];\n            setupTestingModule({imageLoader, extraProviders: providers});\n \n@@ -787,7 +787,7 @@ describe('Image directive', () => {\n \n       it(`should allow passing nested arrays of host names`, withHead('', () => {\n            const providers = [\n-             {provide: PRECONNECT_CHECK_BLOCKLIST, useValue: [['https://angular.io']], multi: true},\n+             {provide: PRECONNECT_CHECK_BLOCKLIST, useValue: [['https://angular.io']]},\n            ];\n            setupTestingModule({imageLoader, extraProviders: providers});\n \n@@ -799,24 +799,6 @@ describe('Image directive', () => {\n            // Expect no warnings in the console.\n            expect(consoleWarnSpy.calls.count()).toBe(0);\n          }));\n-\n-      it(`should throw when PRECONNECT_CHECK_BLOCKLIST is not a multi provider`,\n-         withHead('', () => {\n-           const providers = [\n-             {provide: PRECONNECT_CHECK_BLOCKLIST, useValue: 'https://angular.io'},\n-           ];\n-           setupTestingModule({imageLoader, extraProviders: providers});\n-\n-           const template = '<img ngSrc=\"a.png\" width=\"100\" height=\"50\" priority>';\n-           expect(() => {\n-             const fixture = createTestComponent(template);\n-             fixture.detectChanges();\n-           })\n-               .toThrowError(\n-                   'NG02957: The blocklist for the preconnect check was not ' +\n-                   'provided as an array. Check that the `PRECONNECT_CHECK_BLOCKLIST` token ' +\n-                   'is configured as a `multi: true` provider.');\n-         }));\n     });\n   });\n \n\n---\n file path A: packages/common/test/image_loaders/image_loader_spec.ts | file path B: packages/common/test/image_loaders/image_loader_spec.ts\n\n@@ -6,13 +6,13 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {IMAGE_LOADER, ImageLoader, PRECONNECT_CHECK_BLOCKLIST} from '@angular/common/src/directives/ng_optimized_image';\n+import {IMAGE_LOADER, ImageLoader} from '@angular/common/src/directives/ng_optimized_image';\n import {provideCloudflareLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader';\n import {provideCloudinaryLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader';\n import {provideImageKitLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader';\n import {provideImgixLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/imgix_loader';\n import {isValidPath} from '@angular/common/src/directives/ng_optimized_image/url';\n-import {createEnvironmentInjector, EnvironmentInjector, ValueProvider} from '@angular/core';\n+import {createEnvironmentInjector, EnvironmentInjector} from '@angular/core';\n import {TestBed} from '@angular/core/testing';\n \n const absoluteUrlError = (src: string, path: string) =>\n@@ -184,44 +184,6 @@ describe('Built-in image directive loaders', () => {\n     });\n   });\n \n-  describe('ensurePreconnect option', () => {\n-    const path = 'https://some.host/base';\n-\n-    [provideImgixLoader,\n-     provideCloudinaryLoader,\n-     provideImageKitLoader,\n-     provideCloudflareLoader,\n-    ].forEach(provideImageLoader => {\n-      it(`${provideImageLoader.name} should _not_ block-list path by default`, () => {\n-        const providers = provideImageLoader(path);\n-\n-        expect(providers.length).toBe(1);\n-        const valueProvider = providers[0] as ValueProvider;\n-        expect(valueProvider.provide).not.toBe(PRECONNECT_CHECK_BLOCKLIST);\n-      });\n-\n-      it(`${provideImageLoader.name} should _not_ block-list path when ensurePreconnect is true`,\n-         () => {\n-           const providers = provideImageLoader(path, {ensurePreconnect: true});\n-\n-           expect(providers.length).toBe(1);\n-           const valueProvider = providers[0] as ValueProvider;\n-           expect(valueProvider.provide).not.toBe(PRECONNECT_CHECK_BLOCKLIST);\n-         });\n-\n-      it('`${provideImageLoader.name} should block-list path when ensurePreconnect is false',\n-         () => {\n-           const providers = provideImageLoader(path, {ensurePreconnect: false});\n-           expect(providers.length).toBe(2);\n-\n-           const valueProvider = providers[1] as ValueProvider;\n-           expect(valueProvider.multi).toBeTrue();\n-           expect(valueProvider.useValue).toEqual([path]);\n-           expect(valueProvider.provide).toBe(PRECONNECT_CHECK_BLOCKLIST);\n-         });\n-    });\n-  });\n-\n   describe('loader utils', () => {\n     it('should identify valid paths', () => {\n       expect(isValidPath('https://cdn.imageprovider.com/image-test')).toBe(true);\n\n\n###\n\n", "completion": "refactor(common): decouple preconnect checks from image loaders (#<issue-num>)"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -77,6 +77,7 @@ var_11: &only_release_branches\n # https://circleci.com/developer/orbs.\n orbs:\n   node: circleci/node@5.0.1\n+  devinfra: angular/dev-infra@1.0.6\n \n # Executor Definitions\n # https://circleci.com/docs/2.0/reusing-config/#authoring-reusable-executors\n@@ -218,19 +219,9 @@ jobs:\n       - checkout\n       - save_month_to_file\n       - init_environment\n-      - run:\n-          name: Rebase PR on target branch\n-          # After checkout, rebase on top of target branch.\n-          command: >\n-            if [[ -n \"${CIRCLE_PR_NUMBER}\" ]]; then\n-              # User is required for rebase.\n-              git config user.name \"angular-ci\"\n-              git config user.email \"angular-ci\"\n-              # Rebase PR on top of target branch.\n-              node .circleci/rebase-pr.js\n-            else\n-              echo \"This build is not over a PR, nothing to do.\"\n-            fi\n+      - devinfra/rebase-pr-on-target-branch:\n+          base_revision: << pipeline.git.base_revision >>\n+          head_revision: << pipeline.git.revision >>\n       # This cache is saved in the build-npm-packages so that Bazel cache is also included.\n       - restore_cache:\n           keys:\n\n---\n file path A: .circleci/rebase-pr.js | file path B: None\n\n@@ -1,208 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-/**\n- * Rebases the current branch on top of the GitHub PR target branch.\n- *\n- * **Context:**\n- * Since a GitHub PR is not necessarily up to date with its target branch, it is useful to rebase\n- * prior to testing it on CI to ensure more up to date test results.\n- *\n- * **NOTE:**\n- * This script cannot use external dependencies or be compiled because it needs to run before the\n- * environment is setup.\n- * Use only features supported by the NodeJS versions used in the environment.\n- */\n-// tslint:disable:no-console\n-const {execSync} = require('child_process');\n-\n-\n-/** A regex to select a ref that matches our semver refs. */\n-const semverRegex = /^(\\d+)\\.(\\d+)\\.x$/;\n-\n-// Run\n-_main().catch(err => {\n-  console.log('Failed to rebase on top of target branch.\\n');\n-  console.error(err);\n-  process.exitCode = 1;\n-});\n-\n-// Helpers\n-async function _main() {\n-  const refs = await getRefsAndShasForChange();\n-\n-  // Log known refs and shas\n-  console.log(`--------------------------------`);\n-  console.log(`    Target Branch:                   ${refs.base.ref}`);\n-  console.log(`    Latest Commit for Target Branch: ${refs.target.latestSha}`);\n-  console.log(`    Latest Commit for PR:            ${refs.base.latestSha}`);\n-  console.log(`    First Common Ancestor SHA:       ${refs.commonAncestorSha}`);\n-  console.log(`--------------------------------`);\n-  console.log();\n-\n-  // Get the count of commits between the latest commit from origin and the common ancestor SHA.\n-  const commitCount =\n-      exec(`git rev-list --count origin/${refs.base.ref}...${refs.commonAncestorSha}`);\n-  console.log(`Checking ${commitCount} commits for changes in the CircleCI config file.`);\n-\n-  // Check if the files changed between the latest commit from origin and the common ancestor SHA\n-  // includes the CircleCI config.\n-  const circleCIConfigChanged = exec(`git diff --name-only origin/${refs.base.ref} ${\n-      refs.commonAncestorSha} -- .circleci/config.yml`);\n-\n-  if (!!circleCIConfigChanged) {\n-    throw Error(`\n-        CircleCI config on ${refs.base.ref} has been modified since commit\n-        ${refs.commonAncestorSha.slice(0, 7)}, which this PR is based on.\n-\n-        Please rebase the PR on ${refs.base.ref} after fetching from upstream.\n-\n-        Rebase instructions for PR Author, please run the following commands:\n-\n-          git fetch upstream ${refs.base.ref};\n-          git checkout ${refs.target.ref};\n-          git rebase upstream/${refs.base.ref};\n-          git push --force-with-lease;\n-        `);\n-  } else {\n-    console.log('No change found in the CircleCI config file, continuing.');\n-  }\n-  console.log();\n-\n-  // Rebase the PR.\n-  exec(`git rebase origin/${refs.base.ref}`);\n-  console.log(`Rebased current branch onto ${refs.base.ref}.`);\n-}\n-\n-\n-\n-/**\n- * Sort a list of fullpath refs into a list and then provide the first entry.\n- *\n- * The sort order will first find the the main branch, and then any semver ref, followed\n- * by the rest of the refs in the order provided.\n- *\n- * Branches are sorted in this order as work is primarily done on main branches, and\n- * otherwise on a semver branch. If neither of those were to match, the most\n- * likely correct branch will be the first one encountered in the list.\n- */\n-function getRefFromBranchList(gitOutput) {\n-  const branches = gitOutput.split('\\n').map(b => b.split('/').slice(1).join('/').trim());\n-  return branches.sort((a, b) => {\n-    if (a === 'main') {\n-      return -1;\n-    }\n-    if (b === 'main') {\n-      return 1;\n-    }\n-\n-    const aIsSemver = semverRegex.test(a);\n-    const bIsSemver = semverRegex.test(b);\n-    if (aIsSemver && bIsSemver) {\n-      const [, aMajor, aMinor] = a.match(semverRegex);\n-      const [, bMajor, bMinor] = b.match(semverRegex);\n-      return parseInt(bMajor, 10) - parseInt(aMajor, 10) ||\n-          parseInt(aMinor, 10) - parseInt(bMinor, 10) || 0;\n-    }\n-    if (aIsSemver) {\n-      return -1;\n-    }\n-    if (bIsSemver) {\n-      return 1;\n-    }\n-    return 0;\n-  })[0];\n-}\n-\n-/**\n- * Get the full sha of the ref provided.\n- *\n- * example: 1bc0c1a6c01ede7168f22fa9b3508ba51f1f464e\n- */\n-function getShaFromRef(ref) {\n-  return exec(`git rev-parse ${ref}`);\n-}\n-\n-/**\n- * Get the list of branches which contain the provided sha, sorted in descending order\n- * by committerdate.\n- *\n- * example:\n- *   upstream/main\n- *   upstream/9.0.x\n- *   upstream/test\n- *   upstream/1.1.x\n- */\n-function getBranchListForSha(sha, remote) {\n-  return exec(`git branch -r '${remote}/*' --sort=-committerdate --contains ${sha}`);\n-}\n-\n-/** Get the common ancestor sha of the two provided shas. */\n-function getCommonAncestorSha(sha1, sha2) {\n-  return exec(`git merge-base ${sha1} ${sha2}`);\n-}\n-\n-/**\n- * Adds the remote to git, if it doesn't already exist. Returns a boolean indicating\n- * whether the remote was added by the command.\n- */\n-function addAndFetchRemote(owner, name) {\n-  const remoteName = `${owner}_${name}`;\n-  exec(`git remote add ${remoteName} https://github.com/${owner}/${name}.git`, true);\n-  exec(`git fetch ${remoteName}`);\n-  return remoteName;\n-}\n-\n-\n-/** Get the ref and latest shas for the provided sha on a specific remote. */\n-function getRefAndShas(sha, owner, name) {\n-  const remoteName = addAndFetchRemote(owner, name);\n-\n-  // Get the ref on the remote for the sha provided.\n-  const branches = getBranchListForSha(sha, remoteName);\n-  const ref = getRefFromBranchList(branches);\n-\n-  // Get the latest sha on the discovered remote ref.\n-  const latestSha = getShaFromRef(`${remoteName}/${ref}`);\n-\n-  return {remote: remoteName, ref, latestSha, sha};\n-}\n-\n-\n-/** Gets the refs and shas for the base and target of the current environment. */\n-function getRefsAndShasForChange() {\n-  const base = getRefAndShas(\n-      process.env['CI_GIT_BASE_REVISION'], process.env['CI_REPO_OWNER'],\n-      process.env['CI_REPO_NAME']);\n-  const target = getRefAndShas(\n-      process.env['CI_GIT_REVISION'], process.env['CI_PR_USERNAME'], process.env['CI_PR_REPONAME']);\n-  const commonAncestorSha = getCommonAncestorSha(base.sha, target.sha);\n-  return {\n-    base,\n-    target,\n-    commonAncestorSha,\n-  };\n-}\n-\n-\n-/**\n- * Synchronously executes the command.\n- *\n- * Return the trimmed stdout as a string, with an added attribute of the exit code.\n- */\n-function exec(command, ignoreError = false) {\n-  try {\n-    return execSync(command, {stdio: 'pipe'}).toString().trim();\n-  } catch (err) {\n-    if (ignoreError) {\n-      return '';\n-    }\n-\n-    throw err;\n-  }\n-}\n\n\n###\n\n", "completion": "build: use shared circleci dev-infra for common circleci code (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/dev-infra.yml | file path B: .github/workflows/dev-infra.yml\n\n@@ -13,13 +13,13 @@ jobs:\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3.0.2\n-      - uses: angular/dev-infra/github-actions/commit-message-based-labels@3c526cbb36b8517829dbbf02a7833fa3081479bb\n+      - uses: angular/dev-infra/github-actions/commit-message-based-labels@40aaf3831425d472965dd61e58cbd5854abd7214\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n   post_approval_changes:\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3.0.2\n-      - uses: angular/dev-infra/github-actions/post-approval-changes@3c526cbb36b8517829dbbf02a7833fa3081479bb\n+      - uses: angular/dev-infra/github-actions/post-approval-changes@40aaf3831425d472965dd61e58cbd5854abd7214\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n---\n file path A: .github/workflows/feature-requests.yml | file path B: .github/workflows/feature-requests.yml\n\n@@ -14,6 +14,6 @@ jobs:\n     if: github.repository == 'angular/angular'\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: angular/dev-infra/github-actions/feature-request@3c526cbb36b8517829dbbf02a7833fa3081479bb\n+      - uses: angular/dev-infra/github-actions/feature-request@40aaf3831425d472965dd61e58cbd5854abd7214\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n---\n file path A: .github/workflows/lock-closed.yml | file path B: .github/workflows/lock-closed.yml\n\n@@ -14,6 +14,6 @@ jobs:\n     if: github.repository == 'angular/angular'\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: angular/dev-infra/github-actions/lock-closed@3c526cbb36b8517829dbbf02a7833fa3081479bb\n+      - uses: angular/dev-infra/github-actions/lock-closed@40aaf3831425d472965dd61e58cbd5854abd7214\n         with:\n           lock-bot-key: ${{ secrets.LOCK_BOT_PRIVATE_KEY }}\n\n---\n file path A: .github/workflows/update-events.yml | file path B: .github/workflows/update-events.yml\n\n@@ -35,7 +35,7 @@ jobs:\n       - name: Generate `events.json`\n         run: node aio/scripts/generate-events/index.mjs --ignore-invalid-dates\n       - name: Create a PR (if necessary)\n-        uses: angular/dev-infra/github-actions/create-pr-for-changes@3c526cbb36b8517829dbbf02a7833fa3081479bb\n+        uses: angular/dev-infra/github-actions/create-pr-for-changes@40aaf3831425d472965dd61e58cbd5854abd7214\n         with:\n           branch-prefix: docs-update-events\n           pr-title: 'docs: update events'\n\n---\n file path A: aio/package.json | file path B: aio/package.json\n\n@@ -105,7 +105,7 @@\n     \"zone.js\": \"~0.11.4\"\n   },\n   \"devDependencies\": {\n-    \"@angular-devkit/architect-cli\": \"0.1500.0-next.0\",\n+    \"@angular-devkit/architect-cli\": \"0.1500.0-next.3\",\n     \"@angular-devkit/build-angular\": \"^14.2.1\",\n     \"@angular-eslint/builder\": \"^14.0.0\",\n     \"@angular-eslint/eslint-plugin\": \"^14.0.0\",\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -15,13 +15,13 @@\n     \"@jridgewell/gen-mapping\" \"^0.1.0\"\n     \"@jridgewell/trace-mapping\" \"^0.3.9\"\n \n-\"@angular-devkit/architect-cli@0.1500.0-next.0\":\n-  version \"0.1500.0-next.0\"\n-  resolved \"https://registry.yarnpkg.com/@angular-devkit/architect-cli/-/architect-cli-0.1500.0-next.0.tgz#3faff912d92306dfab8398af776d90262df22762\"\n-  integrity sha512-Y90ZMjOSxYvsWV8tLWz0aABWLuOYpFesaFGedE8VFmAY6uONSOMY+u42auUefX0JLk7DeW/znDQm7DCjyVzwug==\n+\"@angular-devkit/architect-cli@0.1500.0-next.3\":\n+  version \"0.1500.0-next.3\"\n+  resolved \"https://registry.yarnpkg.com/@angular-devkit/architect-cli/-/architect-cli-0.1500.0-next.3.tgz#fd2a09f5c716225c2565b6c41f6bf1795dbc93c6\"\n+  integrity sha512-w+AWzdQfn3udQ0GsMPzxuAdQmrxX33Hjfthz2Z6BLHayLUyMPgdnCftSltSQtrjwe7aD2TYh6CBgpAhVDEoJnA==\n   dependencies:\n-    \"@angular-devkit/architect\" \"0.1500.0-next.0\"\n-    \"@angular-devkit/core\" \"15.0.0-next.0\"\n+    \"@angular-devkit/architect\" \"0.1500.0-next.3\"\n+    \"@angular-devkit/core\" \"15.0.0-next.3\"\n     ansi-colors \"4.1.3\"\n     progress \"2.0.3\"\n     symbol-observable \"4.0.0\"\n@@ -35,12 +35,12 @@\n     \"@angular-devkit/core\" \"14.2.1\"\n     rxjs \"6.6.7\"\n \n-\"@angular-devkit/architect@0.1500.0-next.0\":\n-  version \"0.1500.0-next.0\"\n-  resolved \"https://registry.yarnpkg.com/@angular-devkit/architect/-/architect-0.1500.0-next.0.tgz#71bb79523f5bbff7745d1ecee6aab831589c7dd6\"\n-  integrity sha512-xXxgzkDeD5H1Ia7sKXIekYfeMgSArxB6TOhyDd3F8h/ku7hQaMVnpV98g5ZOU8vIFpXGJ1YiH9al7rq6w+yGWw==\n+\"@angular-devkit/architect@0.1500.0-next.3\":\n+  version \"0.1500.0-next.3\"\n+  resolved \"https://registry.yarnpkg.com/@angular-devkit/architect/-/architect-0.1500.0-next.3.tgz#63353a006e510b8888218ee499856ff14ac33f50\"\n+  integrity sha512-nP0ggLKC7M7RZb5G0YCO9lLutedA68FLF2DlV9gfX3DQFqTo/fGHpxApJmPiKeT9hIWup4pvESGxYnnI5Z4/+w==\n   dependencies:\n-    \"@angular-devkit/core\" \"15.0.0-next.0\"\n+    \"@angular-devkit/core\" \"15.0.0-next.3\"\n     rxjs \"6.6.7\"\n \n \"@angular-devkit/build-angular@^14.2.1\":\n@@ -132,10 +132,10 @@\n     rxjs \"6.6.7\"\n     source-map \"0.7.4\"\n \n-\"@angular-devkit/core@15.0.0-next.0\":\n-  version \"15.0.0-next.0\"\n-  resolved \"https://registry.yarnpkg.com/@angular-devkit/core/-/core-15.0.0-next.0.tgz#fc8a78db96a21e105c1948ef65e5210edca223ea\"\n-  integrity sha512-QNLLgMKSGBNh5iy99F0lzUYBkERft2Qk5CQvYe07AWuQkvzIp+SYDfjugiSnBJbzK79Wja728KETtIz6X9bLaA==\n+\"@angular-devkit/core@15.0.0-next.3\":\n+  version \"15.0.0-next.3\"\n+  resolved \"https://registry.yarnpkg.com/@angular-devkit/core/-/core-15.0.0-next.3.tgz#33db0667aba3dad17b36147426ab02796160f2d6\"\n+  integrity sha512-T1I2rD2p2We1NlwHy0j6kKo0e2ht0rlyyXQaSHAj+nkapzXTCMzBLbIaIAZWsV3Ro25IwmLir41Sze/5eFRjfw==\n   dependencies:\n     ajv \"8.11.0\"\n     ajv-formats \"2.1.1\"\n\n---\n file path A: package.json | file path B: package.json\n\n@@ -179,8 +179,8 @@\n   },\n   \"// 2\": \"devDependencies are not used under Bazel. Many can be removed after test.sh is deleted.\",\n   \"devDependencies\": {\n-    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#c6e22890605f308ccfd504fa9cce7d16662aaa85\",\n-    \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#44bb94e2925b5288b6fbd46a7ed9162262cdfbdd\",\n+    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#6df2d555d326fe6282de28db80c49dd439b42af3\",\n+    \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#8c3a9ec4176a7315d24977cfefb6edee22b724d9\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n     \"@bazel/buildifier\": \"^5.0.0\",\n     \"@bazel/ibazel\": \"^0.16.0\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -254,10 +254,10 @@\n     \"@angular/core\" \"^13.0.0 || ^14.0.0-0\"\n     reflect-metadata \"^0.1.13\"\n \n-\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#c6e22890605f308ccfd504fa9cce7d16662aaa85\":\n-  version \"0.0.0-3c526cbb36b8517829dbbf02a7833fa3081479bb\"\n-  uid c6e22890605f308ccfd504fa9cce7d16662aaa85\n-  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#c6e22890605f308ccfd504fa9cce7d16662aaa85\"\n+\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#6df2d555d326fe6282de28db80c49dd439b42af3\":\n+  version \"0.0.0-40aaf3831425d472965dd61e58cbd5854abd7214\"\n+  uid \"6df2d555d326fe6282de28db80c49dd439b42af3\"\n+  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#6df2d555d326fe6282de28db80c49dd439b42af3\"\n   dependencies:\n     \"@angular-devkit/build-angular\" \"15.0.0-next.0\"\n     \"@angular/benchpress\" \"0.3.0\"\n@@ -362,10 +362,10 @@\n   dependencies:\n     tslib \"^2.3.0\"\n \n-\"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#44bb94e2925b5288b6fbd46a7ed9162262cdfbdd\":\n-  version \"0.0.0-3c526cbb36b8517829dbbf02a7833fa3081479bb\"\n-  uid \"44bb94e2925b5288b6fbd46a7ed9162262cdfbdd\"\n-  resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#44bb94e2925b5288b6fbd46a7ed9162262cdfbdd\"\n+\"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#8c3a9ec4176a7315d24977cfefb6edee22b724d9\":\n+  version \"0.0.0-40aaf3831425d472965dd61e58cbd5854abd7214\"\n+  uid \"8c3a9ec4176a7315d24977cfefb6edee22b724d9\"\n+  resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#8c3a9ec4176a7315d24977cfefb6edee22b724d9\"\n   dependencies:\n     \"@yarnpkg/lockfile\" \"^1.1.0\"\n     typescript \"~4.8.0\"\n\n\n###\n\n", "completion": "build: update cross-repo angular dependencies (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -19,7 +19,7 @@\n     \"build-local\": \"yarn ~~build\",\n     \"prebuild-local-ci\": \"yarn setup-local-ci\",\n     \"build-local-ci\": \"yarn ~~build --progress=false\",\n-    \"extract-cli-command-docs\": \"node tools/transforms/cli-docs-package/extract-cli-commands.js 4a6e62d46\",\n+    \"extract-cli-command-docs\": \"node tools/transforms/cli-docs-package/extract-cli-commands.js 556a775f3\",\n     \"lint\": \"yarn check-env && yarn docs-lint && ng lint && yarn example-lint && yarn tools-lint && yarn security-lint\",\n     \"test\": \"yarn check-env && ng test\",\n     \"test:bazel\": \"bazelisk test //aio:test\",\n\n\n###\n\n", "completion": "build(docs-infra): upgrade cli command docs sources to 556a775f3 (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/pipes/i18n_plural_pipe.ts | file path B: packages/common/src/pipes/i18n_plural_pipe.ts\n\n@@ -39,7 +39,7 @@ export class I18nPluralPipe implements PipeTransform {\n   /**\n    * @param value the number to be formatted\n    * @param pluralMap an object that mimics the ICU format, see\n-   * http://userguide.icu-project.org/formatparse/messages.\n+   * https://unicode-org.github.io/icu/userguide/format_parse/messages/.\n    * @param locale a `string` defining the locale to use (uses the current {@link LOCALE_ID} by\n    * default).\n    */\n\n\n###\n\n", "completion": "docs(common): update reference url to ICU docs (#<issue-num>)"}
{"prompt": " file path A: packages/upgrade/static/test/integration/downgrade_component_spec.ts | file path B: packages/upgrade/static/test/integration/downgrade_component_spec.ts\n\n@@ -915,4 +915,31 @@ withEachNg1Version(() => {\n                              'downgrading more than one Angular module (via \\'downgradeModule()\\').'));\n        }));\n   });\n+\n+  describe('standalone', () => {\n+    beforeEach(() => destroyPlatform());\n+    afterEach(() => destroyPlatform());\n+\n+    it('should downgrade a standalone component using NgModule APIs', waitForAsync(() => {\n+         @Component({selector: 'ng2', standalone: true, template: 'Hi from Angular!'})\n+         class Ng2Component {\n+         }\n+\n+         const ng1Module = angular.module_('ng1', []).directive(\n+             'ng2', downgradeComponent({component: Ng2Component}));\n+\n+\n+         @NgModule({\n+           imports: [BrowserModule, UpgradeModule, Ng2Component],\n+         })\n+         class Ng2Module {\n+           ngDoBootstrap() {}\n+         }\n+\n+         const element = html('<ng2></ng2>');\n+         bootstrap(platformBrowserDynamic(), Ng2Module, element, ng1Module).then(() => {\n+           expect(element.textContent).toBe('Hi from Angular!');\n+         });\n+       }));\n+  });\n });\n\n\n###\n\n", "completion": "test(upgrade): demonstrate that downgraded component can be standalone (#<issue-num>)"}
{"prompt": " file path A: packages/upgrade/static/test/integration/upgrade_component_spec.ts | file path B: packages/upgrade/static/test/integration/upgrade_component_spec.ts\n\n@@ -4293,5 +4293,46 @@ withEachNg1Version(() => {\n                .toBe('ng2A(ng1A(ng2B(ng1B(^^ng1A: ng1A | ?^^ng1B: | ^ng1B: ng1B))))');\n          });\n        }));\n+\n+    describe('standalone', () => {\n+      it('should upgrade to a standalone component in NgModule-bootstrapped application',\n+         waitForAsync(() => {\n+           const ng1Component: angular.IComponent = {template: `I'm from AngularJS!`};\n+\n+           // Define `Ng1ComponentFacade` (standalone)\n+           @Directive({selector: 'ng1', standalone: true})\n+           class Ng1ComponentStandaloneFacade extends UpgradeComponent {\n+             constructor(elementRef: ElementRef, injector: Injector) {\n+               super('ng1', elementRef, injector);\n+             }\n+           }\n+\n+           // Define `Ng2Component`\n+           @Component({selector: 'ng2', template: '<ng1></ng1>'})\n+           class Ng2Component {\n+           }\n+\n+           // Define `ng1Module`\n+           const ng1Module = angular.module_('ng1Module', [])\n+                                 .component('ng1', ng1Component)\n+                                 .directive('ng2', downgradeComponent({component: Ng2Component}));\n+\n+           // Define `Ng2Module`\n+           @NgModule({\n+             declarations: [Ng2Component],\n+             imports: [BrowserModule, UpgradeModule, Ng1ComponentStandaloneFacade]\n+           })\n+           class Ng2Module {\n+             ngDoBootstrap() {}\n+           }\n+\n+           // Bootstrap\n+           const element = html(`<ng2></ng2>`);\n+\n+           bootstrap(platformBrowserDynamic(), Ng2Module, element, ng1Module).then(() => {\n+             expect(multiTrim(element.textContent)).toBe(`I'm from AngularJS!`);\n+           });\n+         }));\n+    });\n   });\n });\n\n\n###\n\n", "completion": "test(upgrade): demonstrate that upgraded component can be standalone (#<issue-num>)"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -293,6 +293,8 @@ groups:\n           'aio/content/guide/lazy-loading-ngmodules.md',\n           'aio/content/examples/lazy-loading-ngmodules/**/{*,.*}',\n           'aio/content/images/guide/lazy-loading-ngmodules/**/{*,.*}',\n+          'aio/content/guide/lifecycle-hook/lifecycle-hook-example.md',\n+          'aio/content/guide/lifecycle-hook/lifecycle-hook-overview.md',\n           'aio/content/guide/lifecycle-hooks.md',\n           'aio/content/examples/lifecycle-hooks/**/{*,.*}',\n           'aio/content/images/guide/lifecycle-hooks/**/{*,.*}',\n\n---\n file path A: None | file path B: aio/content/guide/lifecycle-hook/lifecycle-hook-example.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/lifecycle-hook/lifecycle-hook-overview.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n\n###\n\n", "completion": "docs: Add topics for lifecycle directory (#<issue-num>)"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -228,6 +228,27 @@ groups:\n           'aio/content/images/guide/change-detection/**/{*,.*}',\n           'aio/content/guide/class-binding.md',\n           'aio/content/guide/cheatsheet.md',\n+          'aio/content/guide/component/component-content-projection-complex.md',\n+          'aio/content/guide/component/component-content-projection-conditional.md',\n+          'aio/content/guide/component/component-content-projection-multi-slot.md',\n+          'aio/content/guide/component/component-content-projection-overview.md',\n+          'aio/content/guide/component/component-content-projection-single-slot.md',\n+          'aio/content/guide/component/component-create-cli.md',\n+          'aio/content/guide/component/component-create-manual.md',\n+          'aio/content/guide/component/component-example-dynamic-load.md',\n+          'aio/content/guide/component/component-example-interaction.md',\n+          'aio/content/guide/component/component-example.md',\n+          'aio/content/guide/component/component-exchange-data.md',\n+          'aio/content/guide/component/component-lifecycle-overview.md',\n+          'aio/content/guide/component/component-overview.md',\n+          'aio/content/guide/component/component-share-data-overview.md',\n+          'aio/content/guide/component/component-share-data-to-child.md',\n+          'aio/content/guide/component/component-share-data-to-parent.md',\n+          'aio/content/guide/component/component-structure.md',\n+          'aio/content/guide/component/component-style-overview.md',\n+          'aio/content/guide/component/component-style-view-encapsulate.md',\n+          'aio/content/guide/component/component-style.md',\n+          'aio/content/guide/component/component-use-overview.md',\n           'aio/content/guide/component-interaction.md',\n           'aio/content/examples/component-interaction/**/{*,.*}',\n           'aio/content/images/guide/component-interaction/**/{*,.*}',\n\n---\n file path A: None | file path B: aio/content/guide/component/component-content-projection-complex.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-content-projection-conditional.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-content-projection-multi-slot.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-content-projection-overview.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-content-projection-single-slot.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-create-cli.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-create-manual.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-example-dynamic-load.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-example-interaction.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-example.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-exchange-data.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-lifecycle-overview.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-overview.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-share-data-overview.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-share-data-to-child.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-share-data-to-parent.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-structure.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-style-overview.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-style-view-encapsulate.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-style.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n---\n file path A: None | file path B: aio/content/guide/component/component-use-overview.md\n\n@@ -0,0 +1,9 @@\n+#\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!-- end links -->\n+\n+@reviewed 2022-08-22\n\n\n###\n\n", "completion": "docs: add new files (#<issue-num>)"}
{"prompt": " file path A: aio/src/app/app.component.html | file path B: aio/src/app/app.component.html\n\n@@ -11,7 +11,7 @@\n <header>\n   <mat-toolbar #appToolbar color=\"primary\" class=\"app-toolbar no-print\" [class.transitioning]=\"isTransitioning\">\n     <mat-toolbar-row class=\"notification-container\">\n-      <aio-notification notificationId=\"war-ukraine\" expirationDate=\"null\" [dismissOnContentClick]=\"false\" (dismissed)=\"notificationDismissed()\">\n+      <aio-notification notificationId=\"war-ukraine\" expirationDate=\"2022-09-26\" [dismissOnContentClick]=\"false\" (dismissed)=\"notificationDismissed()\">\n         <a class=\"link\" target=\"_blank\" rel=\"noopener\" href=\"https://www.google.org/ukraine-relief/\">\n           <span class=\"title\">Support Ukraine</span>\n         <mat-icon class=\"icon\" aria-label=\"Ukraine flag\">\n\n\n###\n\n", "completion": "docs: temporarily hide banner to improve survey visibility (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,18 @@\n+<a name=\"14.2.4\"></a>\n+# 14.2.4 (2022-09-28)\n+### compiler-cli\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [a4b66fe1e5](https://github.com/angular/angular/commit/a4b66fe1e5acaf148069933720499652f21a7bce) | perf | cache source file for reporting type-checking diagnostics ([#47508](https://github.com/angular/angular/pull/47508)) |\n+### core\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [2c46b5ab24](https://github.com/angular/angular/commit/2c46b5ab24e209381bca70d875bf0e98a2846ef5) | fix | correctly check for `typeof` of undefined in `ngDevMode` check ([#47480](https://github.com/angular/angular/pull/47480)) |\n+## Special Thanks\n+Alan Agius, Ashley Hunter, Doug Parker, Jessica Janiuk, JoostK, Kristiyan Kostadinov, Rokas Brazd\u017eionis and Simona Cotin\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.0.0-next.3\"></a>\n # 15.0.0-next.3 (2022-09-21)\n ### animations\n\n\n###\n\n", "completion": "docs: release notes for the v14.2.4 release"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -74,7 +74,7 @@ export class ActivatedRouteSnapshot {\n     queryParams: Params;\n     get root(): ActivatedRouteSnapshot;\n     readonly routeConfig: Route | null;\n-    readonly title?: string;\n+    get title(): string | undefined;\n     // (undocumented)\n     toString(): string;\n     url: UrlSegment[];\n\n---\n file path A: packages/router/src/router_state.ts | file path B: packages/router/src/router_state.ts\n\n@@ -308,7 +308,11 @@ export class ActivatedRouteSnapshot {\n   _queryParamMap!: ParamMap;\n \n   /** The resolved route title */\n-  readonly title?: string = this.data?.[RouteTitleKey];\n+  get title(): string|undefined {\n+    // Note: This _must_ be a getter because the data is mutated in the resolvers. Title will not be\n+    // available at the time of class instantiation.\n+    return this.data?.[RouteTitleKey];\n+  }\n \n   /** @internal */\n   constructor(\n\n---\n file path A: packages/router/test/page_title_strategy_spec.ts | file path B: packages/router/test/page_title_strategy_spec.ts\n\n@@ -9,7 +9,7 @@\n import {DOCUMENT} from '@angular/common';\n import {Component, Inject, Injectable, NgModule} from '@angular/core';\n import {fakeAsync, TestBed, tick} from '@angular/core/testing';\n-import {Router, RouterModule, RouterStateSnapshot, TitleStrategy} from '@angular/router';\n+import {NavigationEnd, Router, RouterModule, RouterStateSnapshot, TitleStrategy} from '@angular/router';\n \n import {provideRouterForTesting} from '../testing/src/provide_router_for_testing';\n \n@@ -99,6 +99,18 @@ describe('title strategy', () => {\n          tick();\n          expect(document.title).toBe('resolved title');\n        }));\n+\n+    it('can get the title from the ActivatedRouteSnapshot', async () => {\n+      router.resetConfig([\n+        {\n+          path: 'home',\n+          title: 'My Application',\n+          component: BlankCmp,\n+        },\n+      ]);\n+      await router.navigateByUrl('home');\n+      expect(router.routerState.snapshot.root.firstChild!.title).toEqual('My Application');\n+    });\n   });\n \n   describe('custom strategies', () => {\n\n\n###\n\n", "completion": "fix(router): Ensure ActivatedRouteSnapshot#title has correct value (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/dependency-injection-overview.md | file path B: aio/content/guide/dependency-injection-overview.md\n\n@@ -6,7 +6,7 @@ In Angular, dependencies are typically services, but they also can be values, su\n \n <div class=\"alert is-helpful\">\n \n-See the <live-example></live-example> for a working example containing the code snippets in this guide.\n+See the <live-example name=\"dependency-injection\"></live-example> for a working example containing the code snippets in this guide.\n \n </div>\n \n@@ -41,4 +41,4 @@ You should be familiar with the Angular apps in general, and have the fundamenta\n   </a>\n </div>\n \n-@reviewed 2022-08-02\n\\ No newline at end of file\n+@reviewed 2022-08-02\n\n\n###\n\n", "completion": "docs: update broken link (#<issue-num>)"}
{"prompt": " file path A: aio/content/marketing/analytics.md | file path B: aio/content/marketing/analytics.md\n\n@@ -13,8 +13,8 @@ Usage analytics may include the following information:\n *   Node and Angular CLI version \\(local version only\\).\n *   How long each command took to initialize and execute.\n *   Command name that was run.\n-*   For Schematics commands \\(add, generate, new and update\\), a list of selected flags.\n-*   For build commands \\(build, serve\\), the number and size of bundles \\(initial and lazy\\), compilation units, the time it took to build and rebuild, and basic Angular-specific API usage.\n+*   For Schematics commands \\(add, generate and new\\), the schematic collection and name and a list of selected flags.\n+*   For build commands \\(build, serve\\), the builder name, the number and size of bundles \\(initial and lazy\\), compilation units, the time it took to build and rebuild, and basic Angular-specific API usage.\n *   Error code of exceptions and crash data. No stack trace is collected.\n \n Only Angular owned and developed schematics and builders are reported.\n@@ -35,7 +35,7 @@ To disable analytics gathering, run the following command:\n <code-example format=\"shell\" language=\"shell\">\n \n &num; Disable all usage analytics.\n-ng analytics off\n+ng analytics disable\n \n </code-example>\n \n@@ -46,7 +46,7 @@ To enable usage analytics, run the following command:\n <code-example format=\"shell\" language=\"shell\">\n \n &num; Enable all usage analytics.\n-ng analytics on\n+ng analytics enable\n \n </code-example>\n \n\n\n###\n\n", "completion": "docs: update what what the CLI collects in analytics (#<issue-num>)"}
{"prompt": " file path A: packages/language-service/src/codefixes/all_codefixes_metas.ts | file path B: packages/language-service/src/codefixes/all_codefixes_metas.ts\n\n@@ -6,7 +6,11 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {fixInvalidBananaInBoxMeta} from './fix_invalid_banana_in_box';\n import {missingMemberMeta} from './fix_missing_member';\n import {CodeActionMeta} from './utils';\n \n-export const ALL_CODE_FIXES_METAS: CodeActionMeta[] = [missingMemberMeta];\n+export const ALL_CODE_FIXES_METAS: CodeActionMeta[] = [\n+  missingMemberMeta,\n+  fixInvalidBananaInBoxMeta,\n+];\n\n---\n file path A: packages/language-service/src/codefixes/code_fixes.ts | file path B: packages/language-service/src/codefixes/code_fixes.ts\n\n@@ -43,8 +43,8 @@ export class CodeFixes {\n    * and collect all the responses from the `codeActionMetas` which could handle the `errorCodes`.\n    */\n   getCodeFixesAtPosition(\n-      templateInfo: TemplateInfo, compiler: NgCompiler, start: number, end: number,\n-      errorCodes: readonly number[], diagnostics: tss.Diagnostic[],\n+      fileName: string, templateInfo: TemplateInfo, compiler: NgCompiler, start: number,\n+      end: number, errorCodes: readonly number[], diagnostics: tss.Diagnostic[],\n       formatOptions: tss.FormatCodeSettings,\n       preferences: tss.UserPreferences): readonly tss.CodeFixAction[] {\n     const codeActions: tss.CodeFixAction[] = [];\n@@ -55,6 +55,7 @@ export class CodeFixes {\n       }\n       for (const meta of metas) {\n         const codeActionsForMeta = meta.getCodeActions({\n+          fileName,\n           templateInfo,\n           compiler,\n           start,\n@@ -98,7 +99,8 @@ export class CodeFixes {\n       preferences,\n       tsLs: this.tsLS,\n       scope,\n-      diagnostics,\n+      // only pass the diagnostics the `meta` cares about.\n+      diagnostics: diagnostics.filter(diag => meta.errorCodes.includes(diag.code)),\n     });\n   }\n }\n\n---\n file path A: None | file path B: packages/language-service/src/codefixes/fix_invalid_banana_in_box.ts\n\n@@ -0,0 +1,124 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {ErrorCode, ngErrorCode} from '@angular/compiler-cli/src/ngtsc/diagnostics';\n+import {BoundEvent} from '@angular/compiler/src/render3/r3_ast';\n+import * as tss from 'typescript/lib/tsserverlibrary';\n+\n+import {getTargetAtPosition, TargetNodeKind} from '../template_target';\n+import {getTemplateInfoAtPosition, TemplateInfo} from '../utils';\n+\n+import {CodeActionMeta, FixIdForCodeFixesAll} from './utils';\n+\n+/**\n+ * fix [invalid banana-in-box](https://angular.io/extended-diagnostics/NG8101)\n+ */\n+export const fixInvalidBananaInBoxMeta: CodeActionMeta = {\n+  errorCodes: [ngErrorCode(ErrorCode.INVALID_BANANA_IN_BOX)],\n+  getCodeActions({start, fileName, templateInfo}) {\n+    const boundEvent = getTheBoundEventAtPosition(templateInfo, start);\n+    if (boundEvent === null) {\n+      return [];\n+    }\n+    const textChanges = convertBoundEventToTsTextChange(boundEvent);\n+    return [{\n+      fixName: FixIdForCodeFixesAll.FIX_INVALID_BANANA_IN_BOX,\n+      fixId: FixIdForCodeFixesAll.FIX_INVALID_BANANA_IN_BOX,\n+      fixAllDescription: 'fix all invalid banana-in-box',\n+      description: `fix invalid banana-in-box for '${boundEvent.sourceSpan.toString()}'`,\n+      changes: [{\n+        fileName,\n+        textChanges,\n+      }],\n+    }];\n+  },\n+  fixIds: [FixIdForCodeFixesAll.FIX_INVALID_BANANA_IN_BOX],\n+  getAllCodeActions({diagnostics, compiler}) {\n+    const fileNameToTextChangesMap = new Map<string, tss.TextChange[]>();\n+    for (const diag of diagnostics) {\n+      const fileName = diag.file?.fileName;\n+      if (fileName === undefined) {\n+        continue;\n+      }\n+      const start = diag.start;\n+      if (start === undefined) {\n+        continue;\n+      }\n+      const templateInfo = getTemplateInfoAtPosition(fileName, start, compiler);\n+      if (templateInfo === undefined) {\n+        continue;\n+      }\n+\n+      /**\n+       * This diagnostic has detected a likely mistake that puts the square brackets inside the\n+       * parens (the BoundEvent `([thing])`) when it should be the other way around `[(thing)]` so\n+       * this function is trying to find the bound event in order to flip the syntax.\n+       */\n+      const boundEvent = getTheBoundEventAtPosition(templateInfo, start);\n+      if (boundEvent === null) {\n+        continue;\n+      }\n+\n+      if (!fileNameToTextChangesMap.has(fileName)) {\n+        fileNameToTextChangesMap.set(fileName, []);\n+      }\n+      const fileTextChanges = fileNameToTextChangesMap.get(fileName)!;\n+      const textChanges = convertBoundEventToTsTextChange(boundEvent);\n+      fileTextChanges.push(...textChanges);\n+    }\n+\n+    const fileTextChanges: tss.FileTextChanges[] = [];\n+    for (const [fileName, textChanges] of fileNameToTextChangesMap) {\n+      fileTextChanges.push({\n+        fileName,\n+        textChanges,\n+      });\n+    }\n+    return {\n+      changes: fileTextChanges,\n+    };\n+  },\n+};\n+\n+function getTheBoundEventAtPosition(templateInfo: TemplateInfo, start: number): BoundEvent|null {\n+  // It's safe to get the bound event at the position `start + 1` because the `start` is at the\n+  // start of the diagnostic, and the node outside the attribute key and value spans are skipped by\n+  // the function `getTargetAtPosition`.\n+  // https://github.com/angular/vscode-ng-language-service/blob/8553115972ca40a55602747667c3d11d6f47a6f8/server/src/session.ts#L220\n+  // https://github.com/angular/angular/blob/4e10a7494130b9bb4772ee8f76b66675867b2145/packages/language-service/src/template_target.ts#L347-L356\n+  const positionDetail = getTargetAtPosition(templateInfo.template, start + 1);\n+  if (positionDetail === null) {\n+    return null;\n+  }\n+\n+  if (positionDetail.context.kind !== TargetNodeKind.AttributeInKeyContext ||\n+      !(positionDetail.context.node instanceof BoundEvent)) {\n+    return null;\n+  }\n+\n+  return positionDetail.context.node;\n+}\n+\n+/**\n+ * Flip the invalid \"box in a banana\" `([thing])` to the correct \"banana in a box\" `[(thing)]`.\n+ */\n+function convertBoundEventToTsTextChange(node: BoundEvent): readonly tss.TextChange[] {\n+  const name = node.name;\n+  const boundSyntax = node.sourceSpan.toString();\n+  const expectedBoundSyntax = boundSyntax.replace(`(${name})`, `[(${name.slice(1, -1)})]`);\n+\n+  return [\n+    {\n+      span: {\n+        start: node.sourceSpan.start.offset,\n+        length: boundSyntax.length,\n+      },\n+      newText: expectedBoundSyntax,\n+    },\n+  ];\n+}\n\n---\n file path A: packages/language-service/src/codefixes/utils.ts | file path B: packages/language-service/src/codefixes/utils.ts\n\n@@ -21,6 +21,7 @@ import {TemplateInfo} from '../utils';\n  */\n export interface CodeActionContext {\n   templateInfo: TemplateInfo;\n+  fileName: string;\n   compiler: NgCompiler;\n   start: number;\n   end: number;\n@@ -132,4 +133,5 @@ export function isFixAllAvailable(meta: CodeActionMeta, diagnostics: tss.Diagnos\n export enum FixIdForCodeFixesAll {\n   FIX_SPELLING = 'fixSpelling',\n   FIX_MISSING_MEMBER = 'fixMissingMember',\n+  FIX_INVALID_BANANA_IN_BOX = 'fixInvalidBananaInBox',\n }\n\n---\n file path A: packages/language-service/src/language_service.ts | file path B: packages/language-service/src/language_service.ts\n\n@@ -307,7 +307,8 @@ export class LanguageService {\n             return [];\n           }\n           return this.codeFixes.getCodeFixesAtPosition(\n-              templateInfo, compiler, start, end, errorCodes, diags, formatOptions, preferences);\n+              fileName, templateInfo, compiler, start, end, errorCodes, diags, formatOptions,\n+              preferences);\n         });\n   }\n \n\n---\n file path A: packages/language-service/test/code_fixes_spec.ts | file path B: packages/language-service/test/code_fixes_spec.ts\n\n@@ -8,6 +8,7 @@\n \n import {initMockFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n \n+import {FixIdForCodeFixesAll} from '../src/codefixes/utils';\n import {createModuleAndProjectWithDeclarations, LanguageServiceTestEnv} from '../testing';\n \n describe('code fixes', () => {\n@@ -157,6 +158,74 @@ describe('code fixes', () => {\n       fileName: 'app.ts'\n     });\n   });\n+\n+  it('should fix invalid banana-in-box error', () => {\n+    const files = {\n+      'app.ts': `\n+      import {Component, NgModule} from '@angular/core';\n+\n+      @Component({\n+        templateUrl: './app.html'\n+      })\n+      export class AppComponent {\n+        title = '';\n+      }\n+    `,\n+      'app.html': `<input ([ngModel])=\"title\">`,\n+    };\n+\n+    const project = createModuleAndProjectWithDeclarations(env, 'test', files);\n+    const diags = project.getDiagnosticsForFile('app.html');\n+    const appFile = project.openFile('app.html');\n+    appFile.moveCursorToText('\u00a6([ngModel');\n+\n+    const codeActions =\n+        project.getCodeFixesAtPosition('app.html', appFile.cursor, appFile.cursor, [diags[0].code]);\n+    expectIncludeReplacementText({\n+      codeActions,\n+      content: appFile.contents,\n+      text: `([ngModel])=\"title\"`,\n+      newText: `[(ngModel)]=\"title\"`,\n+      fileName: 'app.html',\n+      description: `fix invalid banana-in-box for '([ngModel])=\"title\"'`\n+    });\n+  });\n+\n+  it('should fix all invalid banana-in-box errors', () => {\n+    const files = {\n+      'app.ts': `\n+      import {Component, NgModule} from '@angular/core';\n+\n+      @Component({\n+        template: '<input ([ngModel])=\"title\"><input ([value])=\"title\">',\n+      })\n+      export class AppComponent {\n+        title = '';\n+        banner = '';\n+      }\n+    `,\n+    };\n+\n+    const project = createModuleAndProjectWithDeclarations(env, 'test', files);\n+    const appFile = project.openFile('app.ts');\n+\n+    const fixesAllActions =\n+        project.getCombinedCodeFix('app.ts', FixIdForCodeFixesAll.FIX_INVALID_BANANA_IN_BOX);\n+    expectIncludeReplacementTextForFileTextChange({\n+      fileTextChanges: fixesAllActions.changes,\n+      content: appFile.contents,\n+      text: `([ngModel])=\"title\"`,\n+      newText: `[(ngModel)]=\"title\"`,\n+      fileName: 'app.ts'\n+    });\n+    expectIncludeReplacementTextForFileTextChange({\n+      fileTextChanges: fixesAllActions.changes,\n+      content: appFile.contents,\n+      text: `([value])=\"title\"`,\n+      newText: `[(value)]=\"title\"`,\n+      fileName: 'app.ts'\n+    });\n+  });\n });\n \n function expectNotIncludeFixAllInfo(codeActions: readonly ts.CodeFixAction[]) {\n@@ -166,14 +235,22 @@ function expectNotIncludeFixAllInfo(codeActions: readonly ts.CodeFixAction[]) {\n   }\n }\n \n-function expectIncludeReplacementText({codeActions, content, text, newText, fileName}: {\n-  codeActions: readonly ts.CodeAction[]; content: string; text: string; newText: string;\n-  fileName: string;\n-}) {\n+/**\n+ * The `description` is optional because if the description comes from the ts server, no need to\n+ * check it.\n+ */\n+function expectIncludeReplacementText(\n+    {codeActions, content, text, newText, fileName, description}: {\n+      codeActions: readonly ts.CodeAction[]; content: string; text: string; newText: string;\n+      fileName: string;\n+      description?: string;\n+    }) {\n   let includeReplacementText = false;\n   for (const codeAction of codeActions) {\n-    includeReplacementText = includeReplacementTextInChanges(\n-        {fileTextChanges: codeAction.changes, content, text, newText, fileName});\n+    includeReplacementText =\n+        includeReplacementTextInChanges(\n+            {fileTextChanges: codeAction.changes, content, text, newText, fileName}) &&\n+        (description === undefined ? true : (description === codeAction.description));\n     if (includeReplacementText) {\n       return;\n     }\n\n\n###\n\n", "completion": "feat(language-service): support to fix invalid banana in box (#<issue-num>)"}
{"prompt": " file path A: integration/typings_test_rxjs7/package.json | file path B: integration/typings_test_rxjs7/package.json\n\n@@ -18,6 +18,7 @@\n     \"@angular/service-worker\": \"file:../../dist/packages-dist/service-worker\",\n     \"@angular/upgrade\": \"file:../../dist/packages-dist/upgrade\",\n     \"@types/jasmine\": \"file:../../node_modules/@types/jasmine\",\n+    \"@types/node\": \"file:../../node_modules/@types/node\",\n     \"rxjs\": \"^7.4.0\",\n     \"typescript\": \"file:../../node_modules/typescript\",\n     \"zone.js\": \"file:../../dist/zone.js-dist/archive/zone.js.tgz\"\n@@ -25,4 +26,4 @@\n   \"scripts\": {\n     \"test\": \"tsc\"\n   }\n-}\n\\ No newline at end of file\n+}\n\n\n###\n\n", "completion": "build: fix rxjs 7 build failure (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/standalone-components.md | file path B: aio/content/guide/standalone-components.md\n\n@@ -220,7 +220,7 @@ This pattern is useful for Angular libraries that publish a set of cooperating d\n As an alternative to publishing a `NgModule`, library authors might want to export an array of cooperating directives:\n \n ```ts\n-export CAROUSEL_DIRECTIVES = [ImageCarouselComponent, ImageSlideComponent] as const;\n+export const CAROUSEL_DIRECTIVES = [ImageCarouselComponent, ImageSlideComponent] as const;\n ```\n \n Such an array could be imported by applications using `NgModule`s and added to the `@NgModule.imports`. Please note the presence of the TypeScript\u2019s `as const` construct: it gives Angular compiler additional information required for proper compilation and is a recommended practice (as it makes the exported array immutable from the TypeScript point of view).\n\n\n###\n\n", "completion": "docs: fixing standalone components sample code (#<issue-num>)"}
{"prompt": " file path A: goldens/size-tracking/integration-payloads.json | file path B: goldens/size-tracking/integration-payloads.json\n\n@@ -33,7 +33,7 @@\n   \"cli-hello-world-lazy\": {\n     \"uncompressed\": {\n       \"runtime\": 2835,\n-      \"main\": 226893,\n+      \"main\": 226324,\n       \"polyfills\": 33842,\n       \"src_app_lazy_lazy_routes_ts\": 487\n     }\n\n---\n file path A: packages/zone.js/lib/zone-spec/async-stack-tagging.ts | file path B: packages/core/src/zone/async-stack-tagging.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-interface Console {\n+interface ConsoleWithAsyncTagging {\n   createTask(name: string): ConsoleTask;\n }\n \n@@ -14,30 +14,31 @@ interface ConsoleTask {\n   run<T>(f: () => T): T;\n }\n \n-interface Task {\n+interface ZoneConsoleTask extends Task {\n   consoleTask?: ConsoleTask;\n }\n \n-class AsyncStackTaggingZoneSpec implements ZoneSpec {\n-  createTask: Console['createTask'];\n+export class AsyncStackTaggingZoneSpec implements ZoneSpec {\n+  createTask: ConsoleWithAsyncTagging['createTask'];\n \n-  constructor(namePrefix: string, consoleAsyncStackTaggingImpl: Console = console) {\n+  constructor(\n+      namePrefix: string, consoleAsyncStackTaggingImpl: ConsoleWithAsyncTagging = console as any) {\n     this.name = 'asyncStackTagging for ' + namePrefix;\n-    this.createTask = consoleAsyncStackTaggingImpl?.createTask ?? (() => {});\n+    this.createTask = consoleAsyncStackTaggingImpl?.createTask ?? (() => null);\n   }\n \n   // ZoneSpec implementation below.\n-\n   name: string;\n \n-  onScheduleTask(delegate: ZoneDelegate, _current: Zone, target: Zone, task: Task): Task {\n+  onScheduleTask(delegate: ZoneDelegate, _current: Zone, target: Zone, task: ZoneConsoleTask):\n+      Task {\n     task.consoleTask = this.createTask(`Zone - ${task.source || task.type}`);\n     return delegate.scheduleTask(target, task);\n   }\n \n   onInvokeTask(\n-      delegate: ZoneDelegate, _currentZone: Zone, targetZone: Zone, task: Task, applyThis: any,\n-      applyArgs?: any[]) {\n+      delegate: ZoneDelegate, _currentZone: Zone, targetZone: Zone, task: ZoneConsoleTask,\n+      applyThis: any, applyArgs?: any[]) {\n     let ret;\n     if (task.consoleTask) {\n       ret = task.consoleTask.run(() => delegate.invokeTask(targetZone, task, applyThis, applyArgs));\n@@ -47,7 +48,3 @@ class AsyncStackTaggingZoneSpec implements ZoneSpec {\n     return ret;\n   }\n }\n-\n-// Export the class so that new instances can be created with proper\n-// constructor params.\n-(Zone as any)['AsyncStackTaggingZoneSpec'] = AsyncStackTaggingZoneSpec;\n\n---\n file path A: packages/core/src/zone/ng_zone.ts | file path B: packages/core/src/zone/ng_zone.ts\n\n@@ -12,6 +12,7 @@ import {global} from '../util/global';\n import {noop} from '../util/noop';\n import {getNativeRequestAnimationFrame} from '../util/raf';\n \n+import {AsyncStackTaggingZoneSpec} from './async-stack-tagging';\n \n /**\n  * An injectable service for executing work inside or outside of the Angular zone.\n@@ -138,8 +139,12 @@ export class NgZone {\n \n     self._outer = self._inner = Zone.current;\n \n-    if ((Zone as any)['AsyncStackTaggingZoneSpec']) {\n-      const AsyncStackTaggingZoneSpec = (Zone as any)['AsyncStackTaggingZoneSpec'];\n+    // AsyncStackTaggingZoneSpec provides `linked stack traces` to show\n+    // where the async operation is scheduled. For more details, refer\n+    // to this article, https://developer.chrome.com/blog/devtools-better-angular-debugging/\n+    // And we only import this AsyncStackTaggingZoneSpec in development mode,\n+    // in the production mode, the AsyncStackTaggingZoneSpec will be tree shaken away.\n+    if (ngDevMode) {\n       self._inner = self._inner.fork(new AsyncStackTaggingZoneSpec('Angular'));\n     }\n \n\n---\n file path A: packages/zone.js/test/zone-spec/async-tagging-console.spec.ts | file path B: packages/core/test/zone/async-tagging-console.spec.ts\n\n@@ -5,12 +5,9 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-\n-import {ifEnvSupports, ifEnvSupportsWithDone} from '../test-util';\n+import {AsyncStackTaggingZoneSpec} from '../../src/zone/async-stack-tagging';\n \n describe('AsyncTaggingConsoleTest', () => {\n-  const AsyncStackTaggingZoneSpec = (Zone as any)['AsyncStackTaggingZoneSpec'];\n-\n   describe('should call console async stack tagging API', () => {\n     const startAsyncTaskSpy = jasmine.createSpy('startAsyncTask');\n     const finishAsyncTaskSpy = jasmine.createSpy('finishAsyncTask');\n@@ -91,45 +88,51 @@ describe('AsyncTaggingConsoleTest', () => {\n       });\n     });\n \n-    it('XMLHttpRequest', ifEnvSupportsWithDone('XMLHttpRequest', (done: DoneFn) => {\n-         asyncStackTaggingZone.run(() => {\n-           const req = new XMLHttpRequest();\n-           req.onload = () => {\n-             Zone.root.run(() => {\n-               setTimeout(() => {\n-                 expect(scheduleAsyncTaskSpy.calls.all()[0].args).toEqual([\n-                   'Zone - XMLHttpRequest.addEventListener:load',\n-                 ]);\n-                 expect(scheduleAsyncTaskSpy.calls.all()[1].args).toEqual([\n-                   'Zone - XMLHttpRequest.send',\n-                 ]);\n-                 expect(startAsyncTaskSpy.calls.count()).toBe(2);\n-                 expect(finishAsyncTaskSpy.calls.count()).toBe(2);\n-                 done();\n-               });\n-             });\n-           };\n-           req.open('get', '/', true);\n-           req.send();\n-         });\n-       }));\n+    if (global.XMLHttpRequest) {\n+      it('XMLHttpRequest', (done: DoneFn) => {\n+        asyncStackTaggingZone.run(() => {\n+          const req = new XMLHttpRequest();\n+          req.onload = () => {\n+            Zone.root.run(() => {\n+              setTimeout(() => {\n+                expect(scheduleAsyncTaskSpy.calls.all()[0].args).toEqual([\n+                  'Zone - XMLHttpRequest.addEventListener:load',\n+                ]);\n+                expect(scheduleAsyncTaskSpy.calls.all()[1].args).toEqual([\n+                  'Zone - XMLHttpRequest.send',\n+                ]);\n+                expect(startAsyncTaskSpy.calls.count()).toBe(2);\n+                expect(finishAsyncTaskSpy.calls.count()).toBe(2);\n+                done();\n+              });\n+            });\n+          };\n+          req.open('get', '/', true);\n+          req.send();\n+        });\n+      });\n+    }\n \n-    it('button click', ifEnvSupports('document', () => {\n-         asyncStackTaggingZone.run(() => {\n-           const button = document.createElement('button');\n-           const clickEvent = document.createEvent('Event');\n-           clickEvent.initEvent('click', true, true);\n-           document.body.appendChild(button);\n-           const handler = () => {};\n-           button.addEventListener('click', handler);\n-           button.dispatchEvent(clickEvent);\n-           button.dispatchEvent(clickEvent);\n-           button.removeEventListener('click', handler);\n-           expect(scheduleAsyncTaskSpy)\n-               .toHaveBeenCalledWith('Zone - HTMLButtonElement.addEventListener:click');\n-           expect(startAsyncTaskSpy.calls.count()).toBe(2);\n-           expect(finishAsyncTaskSpy.calls.count()).toBe(2);\n-         });\n-       }));\n+    // Only run test when addEventListener is patched by zone.js\n+    if (document && document.addEventListener &&\n+        (document.addEventListener as any)[Zone.__symbol__('OriginalDelegate')]) {\n+      it('button click', () => {\n+        asyncStackTaggingZone.run(() => {\n+          const button = document.createElement('button');\n+          const clickEvent = document.createEvent('Event');\n+          clickEvent.initEvent('click', true, true);\n+          document.body.appendChild(button);\n+          const handler = () => {};\n+          button.addEventListener('click', handler);\n+          button.dispatchEvent(clickEvent);\n+          button.dispatchEvent(clickEvent);\n+          button.removeEventListener('click', handler);\n+          expect(scheduleAsyncTaskSpy)\n+              .toHaveBeenCalledWith('Zone - HTMLButtonElement.addEventListener:click');\n+          expect(startAsyncTaskSpy.calls.count()).toBe(2);\n+          expect(finishAsyncTaskSpy.calls.count()).toBe(2);\n+        });\n+      });\n+    }\n   });\n });\n\n---\n file path A: packages/zone.js/bundles.bzl | file path B: packages/zone.js/bundles.bzl\n\n@@ -19,9 +19,6 @@ BUNDLES_ENTRY_POINTS = {\n     \"async-test\": {\n         \"entrypoint\": _DIR + \"testing/async-testing\",\n     },\n-    \"async-stack-tagging\": {\n-        \"entrypoint\": _DIR + \"zone-spec/async-stack-tagging\",\n-    },\n     \"fake-async-test\": {\n         \"entrypoint\": _DIR + \"testing/fake-async\",\n     },\n\n---\n file path A: packages/zone.js/dist/BUILD.bazel | file path B: packages/zone.js/dist/BUILD.bazel\n\n@@ -45,8 +45,6 @@ js_library(\n filegroup(\n     name = \"dist_bundle_group\",\n     srcs = [\n-        \":async-stack-tagging.js\",\n-        \":async-stack-tagging.min.js\",\n         \":async-test.js\",\n         \":async-test.min.js\",\n         \":fake-async-test.js\",\n\n---\n file path A: packages/zone.js/dist/tools.bzl | file path B: packages/zone.js/dist/tools.bzl\n\n@@ -4,7 +4,6 @@ ES5_BUNDLES = [\n     \"zone-node\",\n     \"zone-testing-node-bundle\",\n     \"async-test\",\n-    \"async-stack-tagging\",\n     \"fake-async-test\",\n     \"long-stack-trace-zone\",\n     \"proxy\",\n\n---\n file path A: packages/zone.js/plugins/BUILD.bazel | file path B: packages/zone.js/plugins/BUILD.bazel\n\n@@ -3,8 +3,6 @@ package(default_visibility = [\"//visibility:public\"])\n filegroup(\n     name = \"plugin_bundle_group\",\n     srcs = [\n-        \"//packages/zone.js/plugins:async-stack-tagging.min/package.json\",\n-        \"//packages/zone.js/plugins:async-stack-tagging/package.json\",\n         \"//packages/zone.js/plugins:async-test.min/package.json\",\n         \"//packages/zone.js/plugins:async-test/package.json\",\n         \"//packages/zone.js/plugins:fake-async-test.min/package.json\",\n\n---\n file path A: packages/zone.js/plugins/async-stack-tagging.min/package.json | file path B: None\n\n@@ -1,7 +0,0 @@\n-{\n-  \"name\": \"zone.js/async-stack-tagging.min\",\n-  \"main\": \"../../bundles/async-stack-tagging.umd.min.js\",\n-  \"fesm2015\": \"../../fesm2015/async-stack-tagging.min.js\",\n-  \"es2015\": \"../../fesm2015/async-stack-tagging.min.js\",\n-  \"module\": \"../../fesm2015/async-stack-tagging.min.js\"\n-}\n\n---\n file path A: packages/zone.js/plugins/async-stack-tagging/package.json | file path B: None\n\n@@ -1,7 +0,0 @@\n-{\n-  \"name\": \"zone.js/async-stack-tagging\",\n-  \"main\": \"../../bundles/async-stack-tagging.umd.js\",\n-  \"fesm2015\": \"../../fesm2015/async-stack-tagging.js\",\n-  \"es2015\": \"../../fesm2015/async-stack-tagging.js\",\n-  \"module\": \"../../fesm2015/async-stack-tagging.js\"\n-}\n\n---\n file path A: packages/zone.js/test/BUILD.bazel | file path B: packages/zone.js/test/BUILD.bazel\n\n@@ -34,7 +34,6 @@ ts_library(\n         exclude = [\n             \"common/Error.spec.ts\",\n             \"common/promise-disable-wrap-uncaught-promise-rejection.spec.ts\",\n-            \"zone-spec/async-tagging-console.spec.ts\",\n         ],\n     ),\n     deps = [\n@@ -265,7 +264,6 @@ test_srcs = glob(\n     \"jasmine-patch.spec.ts\",\n     \"common_tests.ts\",\n     \"browser_entry_point.ts\",\n-    \"zone-spec/async-tagging-console.spec.ts\",\n ]\n \n test_deps = [\n\n---\n file path A: packages/zone.js/test/browser-zone-setup.ts | file path B: packages/zone.js/test/browser-zone-setup.ts\n\n@@ -21,7 +21,6 @@ import '../lib/browser/webapis-media-query';\n import '../lib/testing/zone-testing';\n import '../lib/zone-spec/task-tracking';\n import '../lib/zone-spec/wtf';\n-import '../lib/zone-spec/async-stack-tagging';\n import '../lib/extra/cordova';\n import '../lib/testing/promise-testing';\n import '../lib/testing/async-testing';\n\n---\n file path A: packages/zone.js/test/browser_entry_point.ts | file path B: packages/zone.js/test/browser_entry_point.ts\n\n@@ -29,4 +29,3 @@ import './jasmine-patch.spec';\n import './browser/messageport.spec';\n import './extra/cordova.spec';\n import './browser/queue-microtask.spec';\n-import './zone-spec/async-tagging-console.spec';\n\n---\n file path A: packages/zone.js/test/karma_test.bzl | file path B: packages/zone.js/test/karma_test.bzl\n\n@@ -58,7 +58,6 @@ def karma_test(name, env_srcs, env_deps, env_entry_point, test_srcs, test_deps,\n             \"//packages/zone.js/bundles:zone-patch-resize-observer.umd.js\",\n             \"//packages/zone.js/bundles:zone-patch-message-port.umd.js\",\n             \"//packages/zone.js/bundles:zone-patch-user-media.umd.js\",\n-            \"//packages/zone.js/bundles:async-stack-tagging.umd.js\",\n             \":\" + name + \"_rollup.umd\",\n         ]\n \n\n---\n file path A: packages/zone.js/test/npm_package/npm_package.spec.ts | file path B: packages/zone.js/test/npm_package/npm_package.spec.ts\n\n@@ -115,8 +115,6 @@ describe('Zone.js npm_package', () => {\n     describe('plugins folder check', () => {\n       it('should contain all plugin folders in ./plugins', () => {\n         const expected = [\n-          'async-stack-tagging',\n-          'async-stack-tagging.min',\n           'async-test',\n           'async-test.min',\n           'fake-async-test',\n@@ -197,8 +195,6 @@ describe('Zone.js npm_package', () => {\n     describe('bundles file list', () => {\n       it('should contain all files', () => {\n         const expected = [\n-          'async-stack-tagging.js',\n-          'async-stack-tagging.min.js',\n           'async-test.js',\n           'async-test.min.js',\n           'fake-async-test.js',\n@@ -293,8 +289,6 @@ describe('Zone.js npm_package', () => {\n       it('should contain all original folders in /dist', () => {\n         const list = shx.ls('./dist').stdout.split('\\n').sort().slice(1);\n         const expected = [\n-          'async-stack-tagging.js',\n-          'async-stack-tagging.min.js',\n           'async-test.js',\n           'async-test.min.js',\n           'fake-async-test.js',\n\n\n###\n\n", "completion": "refactor(zone.js): remove zone-async-tagging from zone.js (#<issue-num>)"}
{"prompt": " file path A: aio/src/app/search/search-box/search-box.component.ts | file path B: aio/src/app/search/search-box/search-box.component.ts\n\n@@ -24,6 +24,7 @@ import { debounceTime, distinctUntilChanged } from 'rxjs/operators';\n     (keyup)=\"doSearch()\"\n     (focus)=\"doFocus()\"\n     (click)=\"doSearch()\">\n+  <div class=\"search-box-shortcut\">/</div>\n   <mat-icon\n     *ngIf=\"searchBox.value\"\n     (click)=\"searchBox.value = ''; searchBox.focus()\">\n\n---\n file path A: aio/src/styles/1-layouts/top-menu/_top-menu-theme.scss | file path B: aio/src/styles/1-layouts/top-menu/_top-menu-theme.scss\n\n@@ -88,6 +88,11 @@\n           color: constants.$mediumgray;\n         }\n       }\n+\n+      .search-box-shortcut {\n+        border-color: constants.$mediumgray;\n+        color: constants.$mediumgray;\n+      }\n     }\n \n     aio-theme-toggle {\n\n---\n file path A: aio/src/styles/1-layouts/top-menu/_top-menu.scss | file path B: aio/src/styles/1-layouts/top-menu/_top-menu.scss\n\n@@ -208,6 +208,24 @@ mat-toolbar.app-toolbar {\n       }\n     }\n \n+    .search-box-shortcut {\n+      display: none;\n+      position: absolute;\n+      right: 16px;\n+      font-size: 1.2rem;\n+      line-height: 2.2rem;\n+      padding: 0 0.8rem;\n+      pointer-events: none;\n+      font-weight: bold;\n+      text-align: center;\n+      border-radius: 4px;\n+      border: 1px solid;\n+    }\n+\n+    input:not(:focus):placeholder-shown + .search-box-shortcut {\n+      display: block;\n+    }\n+\n     mat-icon {\n       position: absolute;\n       color: constants.$blue;\n\n\n###\n\n", "completion": "docs: visualize keyboard shortcut for search (#<issue-num>)"}
{"prompt": " file path A: docs/SAVED_REPLIES.md | file path B: docs/SAVED_REPLIES.md\n\n@@ -71,3 +71,15 @@ Hello, we reviewed this issue and determined that it doesn't fall into the bug r\n \n If you are wondering why we don't resolve support issues via the issue tracker, please [check out this explanation](https://github.com/angular/angular/blob/main/CONTRIBUTING.md#question).\n ```\n+\n+## Angular: Commit Header\n+```\n+It looks like you need to update your commit header to match our requirements. This is different from the PR title. To update the commit header, use the command `git commit --amend` and update the header there.\n+\n+Once you've finished that update, you will need to force push using `git push [origin name] [branch name] --force`. That should address this.\n+```\n+\n+## Angular: Rebase and Squash\n+```\n+Please rebase and squash your commits. To do this, make sure to `git fetch upstream` to get the latest changes from the angular repository. Then in your branch run `git rebase upstream/main -i` to do an interactive rebase. This should allow you to fixup or drop any unnecessary commits. After you finish the rebase, force push using `git push [origin name] [branch name] --force`.\n+```\n\n\n###\n\n", "completion": "docs: Add new PR response templates (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/util/is_dev_mode.ts | file path B: packages/core/src/util/is_dev_mode.ts\n\n@@ -38,7 +38,7 @@ export function isDevMode(): boolean {\n export function enableProdMode(): void {\n   // The below check is there so when ngDevMode is set via terser\n   // `global['ngDevMode'] = false;` is also dropped.\n-  if (typeof ngDevMode === undefined || !!ngDevMode) {\n+  if (typeof ngDevMode === 'undefined' || ngDevMode) {\n     global['ngDevMode'] = false;\n   }\n }\n\n\n###\n\n", "completion": "fix(core): correctly check for `typeof` of undefined in `ngDevMode` check (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/releases.md | file path B: aio/content/guide/releases.md\n\n@@ -108,6 +108,16 @@ Dates are offered as general guidance and are subject to change.\n \n </div>\n \n+### Release schedule\n+\n+| Version | Date               |\n+| :---    | :---               |\n+| v14.1   | Week of 2022-07-18 |\n+| v14.2   | Week of 2022-08-22 |\n+| v15.0   | Week of 2022-11-18 |\n+\n+### Support window\n+\n All major releases are typically supported for 18 months.\n \n | Support stage     | Support Timing | Details |\n@@ -115,6 +125,8 @@ All major releases are typically supported for 18 months.\n | Active            | 6 months       | Regularly-scheduled updates and patches are released                |\n | Long-term \\(LTS\\) | 12 months      | Only [critical fixes and security patches](#lts-fixes) are released |\n \n+### Actively supported versions\n+\n The following table provides the status for Angular versions under support.\n \n | Version | Status | Released   | Active ends | LTS ends   |\n\n\n###\n\n", "completion": "docs: add v15 scheduled release dates (#<issue-num>)"}
{"prompt": " file path A: packages/compiler/src/config.ts | file path B: packages/compiler/src/config.ts\n\n@@ -12,7 +12,6 @@ import {noUndefined} from './util';\n export class CompilerConfig {\n   public defaultEncapsulation: ViewEncapsulation|null;\n   public useJit: boolean;\n-  public jitDevMode: boolean;\n   public missingTranslation: MissingTranslationStrategy|null;\n   public preserveWhitespaces: boolean;\n   public strictInjectionParameters: boolean;\n@@ -20,21 +19,18 @@ export class CompilerConfig {\n   constructor({\n     defaultEncapsulation = ViewEncapsulation.Emulated,\n     useJit = true,\n-    jitDevMode = false,\n     missingTranslation = null,\n     preserveWhitespaces,\n     strictInjectionParameters\n   }: {\n     defaultEncapsulation?: ViewEncapsulation,\n     useJit?: boolean,\n-    jitDevMode?: boolean,\n     missingTranslation?: MissingTranslationStrategy|null,\n     preserveWhitespaces?: boolean,\n     strictInjectionParameters?: boolean,\n   } = {}) {\n     this.defaultEncapsulation = defaultEncapsulation;\n     this.useJit = !!useJit;\n-    this.jitDevMode = !!jitDevMode;\n     this.missingTranslation = missingTranslation;\n     this.preserveWhitespaces = preserveWhitespacesDefault(noUndefined(preserveWhitespaces));\n     this.strictInjectionParameters = strictInjectionParameters === true;\n\n---\n file path A: packages/core/src/util/is_dev_mode.ts | file path B: packages/core/src/util/is_dev_mode.ts\n\n@@ -9,27 +9,16 @@\n import {global} from './global';\n \n /**\n- * This file is used to control if the default rendering pipeline should be `ViewEngine` or `Ivy`.\n+ * Returns whether Angular is in development mode.\n  *\n- * For more information on how to run and debug tests with either Ivy or View Engine (legacy),\n- * please see [BAZEL.md](./docs/BAZEL.md).\n- */\n-\n-let _devMode: boolean = true;\n-let _runModeLocked: boolean = false;\n-\n-\n-/**\n- * Returns whether Angular is in development mode. After called once,\n- * the value is locked and won't change any more.\n- *\n- * By default, this is true, unless a user calls `enableProdMode` before calling this.\n+ * By default, this is true, unless `enableProdMode` is invoked prior to calling this method or the\n+ * application is built using the Angular CLI with the `optimization` option.\n+ * @see {@link cli/build ng build}\n  *\n  * @publicApi\n  */\n export function isDevMode(): boolean {\n-  _runModeLocked = true;\n-  return _devMode;\n+  return typeof ngDevMode === 'undefined' || !!ngDevMode;\n }\n \n /**\n@@ -40,18 +29,16 @@ export function isDevMode(): boolean {\n  * does not result in additional changes to any bindings (also known as\n  * unidirectional data flow).\n  *\n+ * Using this method is discouraged as the Angular CLI will set production mode when using the\n+ * `optimization` option.\n+ * @see {@link cli/build ng build}\n+ *\n  * @publicApi\n  */\n export function enableProdMode(): void {\n-  if (_runModeLocked) {\n-    throw new Error('Cannot enable prod mode after platform setup.');\n-  }\n-\n   // The below check is there so when ngDevMode is set via terser\n   // `global['ngDevMode'] = false;` is also dropped.\n   if (typeof ngDevMode === undefined || !!ngDevMode) {\n     global['ngDevMode'] = false;\n   }\n-\n-  _devMode = false;\n }\n\n---\n file path A: packages/platform-browser-dynamic/src/compiler_factory.ts | file path B: packages/platform-browser-dynamic/src/compiler_factory.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {CompilerConfig} from '@angular/compiler';\n-import {Compiler, CompilerFactory, CompilerOptions, InjectionToken, Injector, isDevMode, MissingTranslationStrategy, PACKAGE_ROOT_URL, StaticProvider, ViewEncapsulation} from '@angular/core';\n+import {Compiler, CompilerFactory, CompilerOptions, InjectionToken, Injector, MissingTranslationStrategy, PACKAGE_ROOT_URL, StaticProvider, ViewEncapsulation} from '@angular/core';\n \n export const ERROR_COLLECTOR_TOKEN = new InjectionToken('ErrorCollector');\n \n@@ -52,7 +52,6 @@ export class JitCompilerFactory implements CompilerFactory {\n             // let explicit values from the compiler options overwrite options\n             // from the app providers\n             useJit: opts.useJit,\n-            jitDevMode: isDevMode(),\n             // let explicit values from the compiler options overwrite options\n             // from the app providers\n             defaultEncapsulation: opts.defaultEncapsulation,\n\n\n###\n\n", "completion": "fix(core): update `isDevMode` to rely on `ngDevMode` (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,14 @@\n+<a name=\"14.2.3\"></a>\n+# 14.2.3 (2022-09-21)\n+### animations\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [bba2dae812](https://github.com/angular/angular/commit/bba2dae81263d07c55cd059eb8ef51baa7774055) | fix | make sure that the useAnimation function delay is applied ([#47468](https://github.com/angular/angular/pull/47468)) |\n+## Special Thanks\n+AleksanderBodurri, Andrew Kushnir, Andrew Scott, Bob Watson, George Kalpakas, Joey Perrott, Mauro Mattos, dario-piotrowicz, fabioemoutinho and famzila\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.0.0-next.2\"></a>\n # 15.0.0-next.2 (2022-09-14)\n ### animations\n\n\n###\n\n", "completion": "docs: release notes for the v14.2.3 release"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/typecheck/diagnostics/src/diagnostic.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/diagnostics/src/diagnostic.ts\n\n@@ -10,7 +10,7 @@ import {ParseSourceSpan} from '@angular/compiler';\n import ts from 'typescript';\n \n import {addDiagnosticChain, makeDiagnosticChain} from '../../../diagnostics';\n-import {ExternalTemplateSourceMapping, TemplateDiagnostic, TemplateId, TemplateSourceMapping} from '../../api';\n+import {ExternalTemplateSourceMapping, IndirectTemplateSourceMapping, TemplateDiagnostic, TemplateId, TemplateSourceMapping} from '../../api';\n \n /**\n  * Constructs a `ts.Diagnostic` for a given `ParseSourceSpan` within a template.\n@@ -82,7 +82,7 @@ export function makeTemplateDiagnostic(\n \n     let sf: ts.SourceFile;\n     try {\n-      sf = parseTemplateAsSourceFile(fileName, mapping.template);\n+      sf = getParsedTemplateSourceFile(fileName, mapping);\n     } catch (e) {\n       const failureChain = makeDiagnosticChain(\n           `Failed to report an error in '${fileName}' at ${span.start.line + 1}:${\n@@ -135,6 +135,22 @@ export function makeTemplateDiagnostic(\n   }\n }\n \n+const TemplateSourceFile = Symbol('TemplateSourceFile');\n+\n+type TemplateSourceMappingWithSourceFile =\n+    (ExternalTemplateSourceMapping|IndirectTemplateSourceMapping)&{\n+  [TemplateSourceFile]?: ts.SourceFile;\n+};\n+\n+function getParsedTemplateSourceFile(\n+    fileName: string, mapping: TemplateSourceMappingWithSourceFile): ts.SourceFile {\n+  if (mapping[TemplateSourceFile] === undefined) {\n+    mapping[TemplateSourceFile] = parseTemplateAsSourceFile(fileName, mapping.template);\n+  }\n+\n+  return mapping[TemplateSourceFile];\n+}\n+\n let parseTemplateAsSourceFileForTest: typeof parseTemplateAsSourceFile|null = null;\n \n export function setParseTemplateAsSourceFileForTest(fn: typeof parseTemplateAsSourceFile): void {\n@@ -152,7 +168,6 @@ function parseTemplateAsSourceFile(fileName: string, template: string): ts.Sourc\n \n   // TODO(alxhub): investigate creating a fake `ts.SourceFile` here instead of invoking the TS\n   // parser against the template (HTML is just really syntactically invalid TypeScript code ;).\n-  // Also investigate caching the file to avoid running the parser multiple times.\n   return ts.createSourceFile(\n       fileName, template, ts.ScriptTarget.Latest, /* setParentNodes */ false, ts.ScriptKind.JSX);\n }\n\n\n###\n\n", "completion": "perf(compiler-cli): cache source file for reporting type-checking diagnostics (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -131,7 +131,7 @@\n     \"cross-spawn\": \"^7.0.3\",\n     \"css-selector-parser\": \"^1.4.1\",\n     \"dgeni\": \"^0.4.14\",\n-    \"dgeni-packages\": \"^0.29.5\",\n+    \"dgeni-packages\": \"^0.30.0\",\n     \"entities\": \"^4.0.0\",\n     \"eslint\": \"^8.0.0\",\n     \"eslint-plugin-import\": \"^2.23.4\",\n@@ -147,8 +147,8 @@\n     \"html\": \"^1.0.0\",\n     \"ignore\": \"^5.1.8\",\n     \"image-size\": \"^1.0.0\",\n-    \"jasmine\": \"~4.3.0\",\n-    \"jasmine-core\": \"~4.3.0\",\n+    \"jasmine\": \"~4.4.0\",\n+    \"jasmine-core\": \"~4.4.0\",\n     \"jasmine-spec-reporter\": \"~7.0.0\",\n     \"jsdom\": \"^20.0.0\",\n     \"json-schema-traverse\": \"^1.0.0\",\n\n---\n file path A: aio/tools/examples/shared/package.json | file path B: aio/tools/examples/shared/package.json\n\n@@ -66,7 +66,7 @@\n     \"concurrently\": \"^7.0.0\",\n     \"copyfiles\": \"^2.4.1\",\n     \"http-server\": \"^14.0.0\",\n-    \"jasmine-core\": \"~4.3.0\",\n+    \"jasmine-core\": \"~4.4.0\",\n     \"jasmine-marbles\": \"~0.9.2\",\n     \"jasmine-spec-reporter\": \"~7.0.0\",\n     \"karma\": \"~6.4.0\",\n\n---\n file path A: aio/tools/examples/shared/yarn.lock | file path B: aio/tools/examples/shared/yarn.lock\n\n@@ -5204,10 +5204,10 @@ jasmine-core@~2.8.0:\n   resolved \"https://registry.yarnpkg.com/jasmine-core/-/jasmine-core-2.8.0.tgz#bcc979ae1f9fd05701e45e52e65d3a5d63f1a24e\"\n   integrity sha512-SNkOkS+/jMZvLhuSx1fjhcNWUC/KG6oVyFUGkSBEr9n1axSNduWU8GlI7suaHXr4yxjet6KjrUZxUTE5WzzWwQ==\n \n-jasmine-core@~4.3.0:\n-  version \"4.3.0\"\n-  resolved \"https://registry.yarnpkg.com/jasmine-core/-/jasmine-core-4.3.0.tgz#aee841fbe7373c2586ed8d8d48f5cc4a88be8390\"\n-  integrity sha512-qybtBUesniQdW6n+QIHMng2vDOHscIC/dEXjW+JzO9+LoAZMb03RCUC5xFOv/btSKPm1xL42fn+RjlU4oB42Lg==\n+jasmine-core@~4.4.0:\n+  version \"4.4.0\"\n+  resolved \"https://registry.yarnpkg.com/jasmine-core/-/jasmine-core-4.4.0.tgz#848fe45c1839cacaf1f2429d400d1d4f85d2856a\"\n+  integrity sha512-+l482uImx5BVd6brJYlaHe2UwfKoZBqQfNp20ZmdNfsjGFTemGfqHLsXjKEW23w9R/m8WYeFc9JmIgjj6dUtAA==\n \n jasmine-marbles@~0.9.2:\n   version \"0.9.2\"\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -4520,10 +4520,10 @@ devtools-protocol@0.0.981744:\n   resolved \"https://registry.yarnpkg.com/devtools-protocol/-/devtools-protocol-0.0.981744.tgz#9960da0370284577d46c28979a0b32651022bacf\"\n   integrity sha512-0cuGS8+jhR67Fy7qG3i3Pc7Aw494sb9yG9QgpG97SFVWwolgYjlhJg7n+UaHxOQT30d1TYu/EYe9k01ivLErIg==\n \n-dgeni-packages@^0.29.5:\n-  version \"0.29.5\"\n-  resolved \"https://registry.yarnpkg.com/dgeni-packages/-/dgeni-packages-0.29.5.tgz#6e94ec4b343fa3b1bdd517dbdee05166a05b10ef\"\n-  integrity sha512-jKwWNA10+p/TDKPEFnsbeRQ027CpmM+cWhh3Fp8dRI+2e2FkedoccPiQhoG5/kzheQFxcsMGB6/h63OXYNdz0A==\n+dgeni-packages@^0.30.0:\n+  version \"0.30.0\"\n+  resolved \"https://registry.yarnpkg.com/dgeni-packages/-/dgeni-packages-0.30.0.tgz#7e8002ee154fed7bc97841222e0f25628cf2285d\"\n+  integrity sha512-k5y9HSwJzWgc8S7bHxejojJfuo2heltY9lTa5UgfqoBv2vubCwqXhVxFBXr3nKfymc9YOALCnk10JYeOdVLLWQ==\n   dependencies:\n     canonical-path \"^1.0.0\"\n     catharsis \"^0.8.1\"\n@@ -7424,10 +7424,10 @@ jasmine-core@^4.1.0:\n   resolved \"https://registry.yarnpkg.com/jasmine-core/-/jasmine-core-4.2.0.tgz#0605bea284d6d78276f43c47de2532ecd4a73b00\"\n   integrity sha512-OcFpBrIhnbmb9wfI8cqPSJ50pv3Wg4/NSgoZIqHzIwO/2a9qivJWzv8hUvaREIMYYJBas6AvfXATFdVuzzCqVw==\n \n-jasmine-core@^4.3.0, jasmine-core@~4.3.0:\n-  version \"4.3.0\"\n-  resolved \"https://registry.yarnpkg.com/jasmine-core/-/jasmine-core-4.3.0.tgz#aee841fbe7373c2586ed8d8d48f5cc4a88be8390\"\n-  integrity sha512-qybtBUesniQdW6n+QIHMng2vDOHscIC/dEXjW+JzO9+LoAZMb03RCUC5xFOv/btSKPm1xL42fn+RjlU4oB42Lg==\n+jasmine-core@^4.4.0, jasmine-core@~4.4.0:\n+  version \"4.4.0\"\n+  resolved \"https://registry.yarnpkg.com/jasmine-core/-/jasmine-core-4.4.0.tgz#848fe45c1839cacaf1f2429d400d1d4f85d2856a\"\n+  integrity sha512-+l482uImx5BVd6brJYlaHe2UwfKoZBqQfNp20ZmdNfsjGFTemGfqHLsXjKEW23w9R/m8WYeFc9JmIgjj6dUtAA==\n \n jasmine-core@~2.8.0:\n   version \"2.8.0\"\n@@ -7450,13 +7450,13 @@ jasmine@2.8.0:\n     glob \"^7.0.6\"\n     jasmine-core \"~2.8.0\"\n \n-jasmine@~4.3.0:\n-  version \"4.3.0\"\n-  resolved \"https://registry.yarnpkg.com/jasmine/-/jasmine-4.3.0.tgz#f99e9bc2a94e8281d2490482d53a3406760bd7f4\"\n-  integrity sha512-ieBmwkd8L1DXnvSnxx7tecXgA0JDgMXPAwBcqM4lLPedJeI9hTHuWifPynTC+dLe4Y+GkSPSlbqqrmYIgGzYUw==\n+jasmine@~4.4.0:\n+  version \"4.4.0\"\n+  resolved \"https://registry.yarnpkg.com/jasmine/-/jasmine-4.4.0.tgz#e3e359723d9679993b70de3e0441517c154b9647\"\n+  integrity sha512-xrbOyYkkCvgduNw7CKktDtNb+BwwBv/zvQeHpTkbxqQ37AJL5V4sY3jHoMIJPP/hTc3QxLVwOyxc87AqA+kw5g==\n   dependencies:\n     glob \"^7.1.6\"\n-    jasmine-core \"^4.3.0\"\n+    jasmine-core \"^4.4.0\"\n \n jasminewd2@^2.1.0:\n   version \"2.2.0\"\n\n---\n file path A: package.json | file path B: package.json\n\n@@ -88,7 +88,7 @@\n     \"@types/babel__traverse\": \"7.18.1\",\n     \"@types/base64-js\": \"1.3.0\",\n     \"@types/bluebird\": \"^3.5.27\",\n-    \"@types/chrome\": \"^0.0.196\",\n+    \"@types/chrome\": \"^0.0.197\",\n     \"@types/convert-source-map\": \"^1.5.1\",\n     \"@types/diff\": \"^5.0.0\",\n     \"@types/events\": \"3.0.0\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -2953,10 +2953,10 @@\n     \"@types/node\" \"*\"\n     \"@types/responselike\" \"*\"\n \n-\"@types/chrome@^0.0.196\":\n-  version \"0.0.196\"\n-  resolved \"https://registry.yarnpkg.com/@types/chrome/-/chrome-0.0.196.tgz#9e0196a6fcdf3c0e12cfbcd086cd28feb5206990\"\n-  integrity sha512-LAjGIQYC0wyiYu6lVT03dBrHBfYTMsM8EmNfQ+UdZipGZe8OUiir6weoa9oQoBw3T3RLzBCp9m904T+rFtpPAg==\n+\"@types/chrome@^0.0.197\":\n+  version \"0.0.197\"\n+  resolved \"https://registry.yarnpkg.com/@types/chrome/-/chrome-0.0.197.tgz#c1b50cdb72ee40f9bc1411506031a9f8a925ab35\"\n+  integrity sha512-m1NfS5bOjaypyqQfaX6CxmJodZVcvj5+Mt/K94EBHkflYjPNmXHAzbxfifdLMa0YM3PDyOxohoTS5ug/e6p5jA==\n   dependencies:\n     \"@types/filesystem\" \"*\"\n     \"@types/har-format\" \"*\"\n\n\n###\n\n", "completion": "build: update all non-major dependencies (#<issue-num>)"}
{"prompt": " file path A: goldens/size-tracking/aio-payloads.json | file path B: goldens/size-tracking/aio-payloads.json\n\n@@ -12,7 +12,7 @@\n   \"aio-local\": {\n     \"uncompressed\": {\n       \"runtime\": 4325,\n-      \"main\": 454655,\n+      \"main\": 455234,\n       \"polyfills\": 33922,\n       \"styles\": 73640,\n       \"light-theme\": 78045,\n\n---\n file path A: goldens/size-tracking/integration-payloads.json | file path B: goldens/size-tracking/integration-payloads.json\n\n@@ -2,7 +2,7 @@\n   \"cli-hello-world\": {\n     \"uncompressed\": {\n       \"runtime\": 1083,\n-      \"main\": 124633,\n+      \"main\": 125134,\n       \"polyfills\": 33824\n     }\n   },\n@@ -19,7 +19,7 @@\n   \"cli-hello-world-ivy-compat\": {\n     \"uncompressed\": {\n       \"runtime\": 1102,\n-      \"main\": 131619,\n+      \"main\": 132120,\n       \"polyfills\": 33957\n     }\n   },\n@@ -55,7 +55,7 @@\n   \"standalone-bootstrap\": {\n     \"uncompressed\": {\n       \"runtime\": 1090,\n-      \"main\": 82906,\n+      \"main\": 83452,\n       \"polyfills\": 33945\n     }\n   },\n\n---\n file path A: packages/core/src/render3/component_ref.ts | file path B: packages/core/src/render3/component_ref.ts\n\n@@ -364,7 +364,7 @@ export function createRootComponentView(\n \n   if (tView.firstCreatePass) {\n     diPublicInInjector(getOrCreateNodeInjectorForNode(tNode, rootView), tView, def.type);\n-    markAsComponentHost(tView, tNode);\n+    markAsComponentHost(tView, tNode, 0);\n     initTNodeFlags(tNode, rootView.length, 1);\n   }\n \n\n---\n file path A: packages/core/src/render3/context_discovery.ts | file path B: packages/core/src/render3/context_discovery.ts\n\n@@ -304,17 +304,21 @@ function findViaDirective(lView: LView, directiveInstance: {}): number {\n export function getDirectivesAtNodeIndex(\n     nodeIndex: number, lView: LView, includeComponents: boolean): any[]|null {\n   const tNode = lView[TVIEW].data[nodeIndex] as TNode;\n-  let directiveStartIndex = tNode.directiveStart;\n-  if (directiveStartIndex == 0) return EMPTY_ARRAY;\n-  const directiveEndIndex = tNode.directiveEnd;\n-  if (!includeComponents && tNode.flags & TNodeFlags.isComponentHost) directiveStartIndex++;\n-  return lView.slice(directiveStartIndex, directiveEndIndex);\n+  if (tNode.directiveStart === 0) return EMPTY_ARRAY;\n+  const results: any[] = [];\n+  for (let i = tNode.directiveStart; i < tNode.directiveEnd; i++) {\n+    const directiveInstance = lView[i];\n+    if (!isComponentInstance(directiveInstance) || includeComponents) {\n+      results.push(directiveInstance);\n+    }\n+  }\n+  return results;\n }\n \n export function getComponentAtNodeIndex(nodeIndex: number, lView: LView): {}|null {\n   const tNode = lView[TVIEW].data[nodeIndex] as TNode;\n-  let directiveStartIndex = tNode.directiveStart;\n-  return tNode.flags & TNodeFlags.isComponentHost ? lView[directiveStartIndex] : null;\n+  const {directiveStart, componentOffset} = tNode;\n+  return componentOffset > -1 ? lView[directiveStart + componentOffset] : null;\n }\n \n /**\n\n---\n file path A: packages/core/src/render3/instructions/listener.ts | file path B: packages/core/src/render3/instructions/listener.ts\n\n@@ -255,9 +255,8 @@ function wrapListener(\n \n     // In order to be backwards compatible with View Engine, events on component host nodes\n     // must also mark the component view itself dirty (i.e. the view that it owns).\n-    const startView = tNode.flags & TNodeFlags.isComponentHost ?\n-        getComponentLViewByIndex(tNode.index, lView) :\n-        lView;\n+    const startView =\n+        tNode.componentOffset > -1 ? getComponentLViewByIndex(tNode.index, lView) : lView;\n     markViewDirty(startView);\n \n     let result = executeListenerWithErrorHandling(lView, context, listenerFn, e);\n\n---\n file path A: packages/core/src/render3/instructions/lview_debug.ts | file path B: packages/core/src/render3/instructions/lview_debug.ts\n\n@@ -181,6 +181,7 @@ class TNode implements ITNode {\n       public index: number,                                                          //\n       public insertBeforeIndex: InsertBeforeIndex,                                   //\n       public injectorIndex: number,                                                  //\n+      public componentOffset: number,                                                //\n       public directiveStart: number,                                                 //\n       public directiveEnd: number,                                                   //\n       public directiveStylingLast: number,                                           //\n@@ -263,7 +264,6 @@ class TNode implements ITNode {\n     if (this.flags & TNodeFlags.hasContentQuery) flags.push('TNodeFlags.hasContentQuery');\n     if (this.flags & TNodeFlags.hasStyleInput) flags.push('TNodeFlags.hasStyleInput');\n     if (this.flags & TNodeFlags.hasHostBindings) flags.push('TNodeFlags.hasHostBindings');\n-    if (this.flags & TNodeFlags.isComponentHost) flags.push('TNodeFlags.isComponentHost');\n     if (this.flags & TNodeFlags.isDirectiveHost) flags.push('TNodeFlags.isDirectiveHost');\n     if (this.flags & TNodeFlags.isDetached) flags.push('TNodeFlags.isDetached');\n     if (this.flags & TNodeFlags.isProjected) flags.push('TNodeFlags.isProjected');\n\n---\n file path A: packages/core/src/render3/instructions/shared.ts | file path B: packages/core/src/render3/instructions/shared.ts\n\n@@ -14,7 +14,7 @@ import {SchemaMetadata} from '../../metadata/schema';\n import {ViewEncapsulation} from '../../metadata/view';\n import {validateAgainstEventAttributes, validateAgainstEventProperties} from '../../sanitization/sanitization';\n import {Sanitizer} from '../../sanitization/sanitizer';\n-import {assertDefined, assertEqual, assertGreaterThanOrEqual, assertIndexInRange, assertNotEqual, assertNotSame, assertSame, assertString} from '../../util/assert';\n+import {assertDefined, assertEqual, assertGreaterThan, assertGreaterThanOrEqual, assertIndexInRange, assertNotEqual, assertNotSame, assertSame, assertString} from '../../util/assert';\n import {escapeCommentText} from '../../util/dom';\n import {normalizeDebugBindingName, normalizeDebugBindingValue} from '../../util/ng_reflect';\n import {stringify} from '../../util/stringify';\n@@ -789,6 +789,7 @@ export function createTNode(\n           index,          // index: number\n           null,           // insertBeforeIndex: null|-1|number|number[]\n           injectorIndex,  // injectorIndex: number\n+          -1,             // componentOffset: number\n           -1,             // directiveStart: number\n           -1,             // directiveEnd: number\n           -1,             // directiveStylingLast: number\n@@ -825,6 +826,7 @@ export function createTNode(\n         directiveStart: -1,\n         directiveEnd: -1,\n         directiveStylingLast: -1,\n+        componentOffset: -1,\n         propertyBindings: null,\n         flags: 0,\n         providerIndexes: 0,\n@@ -1040,8 +1042,9 @@ export function instantiateRootComponent<T>(tView: TView, lView: LView, def: Com\n     configureViewWithDirective(tView, rootTNode, lView, directiveIndex, def);\n     initializeInputAndOutputAliases(tView, rootTNode);\n   }\n-  const directive =\n-      getNodeInjectable(lView, tView, rootTNode.directiveStart, rootTNode as TElementNode);\n+  const directive = getNodeInjectable(\n+      lView, tView, rootTNode.directiveStart + rootTNode.componentOffset,\n+      rootTNode as TElementNode);\n   attachPatchData(directive, lView);\n   const native = getNativeByTNode(rootTNode, lView);\n   if (native) {\n@@ -1279,13 +1282,13 @@ function findDirectiveDefMatches(\n                 `\"${tNode.value}\" tags cannot be used as component hosts. ` +\n                     `Please use a different tag to activate the ${stringify(def.type)} component.`);\n \n-            if (tNode.flags & TNodeFlags.isComponentHost) {\n+            if (isComponentHost(tNode)) {\n               // If another component has been matched previously, it's the first element in the\n               // `matches` array, see how we store components/directives in `matches` below.\n               throwMultipleComponentError(tNode, matches[0].type, def.type);\n             }\n           }\n-          markAsComponentHost(tView, tNode);\n+          markAsComponentHost(tView, tNode, 0);\n           // The component is always stored first with directives after.\n           matches.unshift(def);\n         } else {\n@@ -1299,12 +1302,13 @@ function findDirectiveDefMatches(\n \n /**\n  * Marks a given TNode as a component's host. This consists of:\n- * - setting appropriate TNode flags;\n+ * - setting the component offset on the TNode.\n  * - storing index of component's host element so it will be queued for view refresh during CD.\n  */\n-export function markAsComponentHost(tView: TView, hostTNode: TNode): void {\n+export function markAsComponentHost(tView: TView, hostTNode: TNode, componentOffset: number): void {\n   ngDevMode && assertFirstCreatePass(tView);\n-  hostTNode.flags |= TNodeFlags.isComponentHost;\n+  ngDevMode && assertGreaterThan(componentOffset, -1, 'componentOffset must be great than -1');\n+  hostTNode.componentOffset = componentOffset;\n   (tView.components || (tView.components = ngDevMode ? new TViewComponents() : []))\n       .push(hostTNode.index);\n }\n\n---\n file path A: packages/core/src/render3/interfaces/node.ts | file path B: packages/core/src/render3/interfaces/node.ts\n\n@@ -7,6 +7,7 @@\n  */\n import {KeyValueArray} from '../../util/array_utils';\n import {TStylingRange} from '../interfaces/styling';\n+\n import {TIcu} from './i18n';\n import {CssSelector} from './projection';\n import {RNode} from './renderer_dom';\n@@ -102,35 +103,28 @@ export const enum TNodeFlags {\n   /** Bit #1 - This bit is set if the node is a host for any directive (including a component) */\n   isDirectiveHost = 0x1,\n \n-  /**\n-   * Bit #2 - This bit is set if the node is a host for a component.\n-   *\n-   * Setting this bit implies that the `isDirectiveHost` bit is set as well.\n-   * */\n-  isComponentHost = 0x2,\n+  /** Bit #2 - This bit is set if the node has been projected */\n+  isProjected = 0x2,\n \n-  /** Bit #3 - This bit is set if the node has been projected */\n-  isProjected = 0x4,\n+  /** Bit #3 - This bit is set if any directive on this node has content queries */\n+  hasContentQuery = 0x4,\n \n-  /** Bit #4 - This bit is set if any directive on this node has content queries */\n-  hasContentQuery = 0x8,\n+  /** Bit #4 - This bit is set if the node has any \"class\" inputs */\n+  hasClassInput = 0x8,\n \n-  /** Bit #5 - This bit is set if the node has any \"class\" inputs */\n-  hasClassInput = 0x10,\n+  /** Bit #5 - This bit is set if the node has any \"style\" inputs */\n+  hasStyleInput = 0x10,\n \n-  /** Bit #6 - This bit is set if the node has any \"style\" inputs */\n-  hasStyleInput = 0x20,\n-\n-  /** Bit #7 This bit is set if the node has been detached by i18n */\n-  isDetached = 0x40,\n+  /** Bit #6 This bit is set if the node has been detached by i18n */\n+  isDetached = 0x20,\n \n   /**\n-   * Bit #8 - This bit is set if the node has directives with host bindings.\n+   * Bit #7 - This bit is set if the node has directives with host bindings.\n    *\n    * This flags allows us to guard host-binding logic and invoke it only on nodes\n    * that actually have directives with host bindings.\n    */\n-  hasHostBindings = 0x80,\n+  hasHostBindings = 0x40,\n }\n \n /**\n@@ -407,11 +401,7 @@ export interface TNode {\n    */\n   injectorIndex: number;\n \n-  /**\n-   * Stores starting index of the directives.\n-   *\n-   * NOTE: The first directive is always component (if present).\n-   */\n+  /** Stores starting index of the directives. */\n   directiveStart: number;\n \n   /**\n@@ -423,6 +413,13 @@ export interface TNode {\n    */\n   directiveEnd: number;\n \n+  /**\n+   * Offset from the `directiveStart` at which the component (one at most) of the node is stored.\n+   * Set to -1 if no components have been applied to the node. Component index can be found using\n+   * `directiveStart + componentOffset`.\n+   */\n+  componentOffset: number;\n+\n   /**\n    * Stores the last directive which had a styling instruction.\n    *\n\n---\n file path A: packages/core/src/render3/interfaces/type_checks.ts | file path B: packages/core/src/render3/interfaces/type_checks.ts\n\n@@ -34,7 +34,7 @@ export function isContentQueryHost(tNode: TNode): boolean {\n }\n \n export function isComponentHost(tNode: TNode): boolean {\n-  return (tNode.flags & TNodeFlags.isComponentHost) === TNodeFlags.isComponentHost;\n+  return tNode.componentOffset > -1;\n }\n \n export function isDirectiveHost(tNode: TNode): boolean {\n\n---\n file path A: packages/core/src/render3/node_manipulation.ts | file path B: packages/core/src/render3/node_manipulation.ts\n\n@@ -576,10 +576,11 @@ export function getClosestRElement(tView: TView, tNode: TNode|null, lView: LView\n     return lView[HOST];\n   } else {\n     ngDevMode && assertTNodeType(parentTNode, TNodeType.AnyRNode | TNodeType.Container);\n-    if (parentTNode.flags & TNodeFlags.isComponentHost) {\n+    const {componentOffset} = parentTNode;\n+    if (componentOffset > -1) {\n       ngDevMode && assertTNodeForLView(parentTNode, lView);\n-      const encapsulation =\n-          (tView.data[parentTNode.directiveStart] as ComponentDef<unknown>).encapsulation;\n+      const {encapsulation} =\n+          (tView.data[parentTNode.directiveStart + componentOffset] as ComponentDef<unknown>);\n       // We've got a parent which is an element in the current view. We just need to verify if the\n       // parent element is not a component. Component's content nodes are not inserted immediately\n       // because they will be projected, and so doing insert at this point would be wasteful.\n\n---\n file path A: packages/core/src/render3/node_manipulation_i18n.ts | file path B: packages/core/src/render3/node_manipulation_i18n.ts\n\n@@ -62,7 +62,7 @@ export function processI18nInsertBefore(\n       anchorRNode = i18nParent;\n       i18nParent = parentRElement;\n     }\n-    if (i18nParent !== null && (childTNode.flags & TNodeFlags.isComponentHost) === 0) {\n+    if (i18nParent !== null && childTNode.componentOffset === -1) {\n       for (let i = 1; i < tNodeInsertBeforeIndex.length; i++) {\n         // No need to `unwrapRNode` because all of the indexes point to i18n text nodes.\n         // see `assertDomNode` below.\n\n---\n file path A: packages/core/test/render3/is_shape_of.ts | file path B: packages/core/test/render3/is_shape_of.ts\n\n@@ -154,6 +154,7 @@ const ShapeOfTNode: ShapeOf<TNode> = {\n   directiveStart: true,\n   directiveEnd: true,\n   directiveStylingLast: true,\n+  componentOffset: true,\n   propertyBindings: true,\n   flags: true,\n   providerIndexes: true,\n\n\n###\n\n", "completion": "refactor(core): remove assumptions that component will be first in directives list (#<issue-num>)"}
{"prompt": " file path A: packages/animations/browser/src/dsl/animation_timeline_builder.ts | file path B: packages/animations/browser/src/dsl/animation_timeline_builder.ts\n\n@@ -183,32 +183,25 @@ export class AnimationTimelineBuilderVisitor implements AstVisitor {\n   visitAnimateRef(ast: AnimateRefAst, context: AnimationTimelineContext): any {\n     const innerContext = context.createSubContext(ast.options);\n     innerContext.transformIntoNewTimeline();\n-    this._applyAnimateRefDelay(ast.animation, context, innerContext);\n+    this._applyAnimationRefDelays([ast.options, ast.animation.options], context, innerContext);\n     this.visitReference(ast.animation, innerContext);\n     context.transformIntoNewTimeline(innerContext.currentTimeline.currentTime);\n     context.previousNode = ast;\n   }\n \n-  private _applyAnimateRefDelay(\n-      animation: ReferenceAst, context: AnimationTimelineContext,\n+  private _applyAnimationRefDelays(\n+      animationsRefsOptions: (AnimationOptions|null)[], context: AnimationTimelineContext,\n       innerContext: AnimationTimelineContext) {\n-    const animationDelay = animation.options?.delay;\n-\n-    if (!animationDelay) {\n-      return;\n-    }\n-\n-    let animationDelayValue: number;\n-\n-    if (typeof animationDelay === 'string') {\n-      const interpolatedDelay =\n-          interpolateParams(animationDelay, animation.options?.params ?? {}, context.errors);\n-      animationDelayValue = resolveTimingValue(interpolatedDelay);\n-    } else {\n-      animationDelayValue = animationDelay;\n+    for (const animationRefOptions of animationsRefsOptions) {\n+      const animationDelay = animationRefOptions?.delay;\n+      if (animationDelay) {\n+        const animationDelayValue = typeof animationDelay === 'number' ?\n+            animationDelay :\n+            resolveTimingValue(interpolateParams(\n+                animationDelay, animationRefOptions?.params ?? {}, context.errors));\n+        innerContext.delayNextStep(animationDelayValue);\n+      }\n     }\n-\n-    innerContext.delayNextStep(animationDelayValue);\n   }\n \n   private _visitSubInstructions(\n\n---\n file path A: packages/core/test/animation/animation_integration_spec.ts | file path B: packages/core/test/animation/animation_integration_spec.ts\n\n@@ -3923,13 +3923,57 @@ describe('animation tests', function() {\n       ]);\n     });\n \n-    it('should combine the delay specified in the animation with that of the caller', () => {\n+    it('should apply the delay specified in the useAnimation call', () => {\n+      const animationMetaData = animation([\n+        style({color: 'red'}),\n+        animate(550, style({color: 'green'})),\n+      ]);\n+\n+      @Component({\n+        selector: 'cmp',\n+        template: `\n+         <div @anim *ngIf=\"exp\">\n+         </div>\n+       `,\n+        animations: [\n+          trigger('anim', [transition(\n+                              ':enter',\n+                              useAnimation(animationMetaData, {delay: 1500}),\n+                              )]),\n+        ]\n+      })\n+      class Cmp {\n+        exp: boolean = false;\n+      }\n+\n+      TestBed.configureTestingModule({declarations: [Cmp]});\n+\n+      const engine = TestBed.inject(\u0275AnimationEngine);\n+      const fixture = TestBed.createComponent(Cmp);\n+      const cmp = fixture.componentInstance;\n+      cmp.exp = true;\n+\n+      fixture.detectChanges();\n+      engine.flush();\n+\n+      const players = getLog();\n+      expect(players.length).toEqual(1);\n+      const [player] = players;\n+      expect(player.delay).toEqual(1500);\n+      expect(player.duration).toEqual(550);\n+      expect(player.keyframes).toEqual([\n+        new Map<string, string|number>([['color', 'red'], ['offset', 0]]),\n+        new Map<string, string|number>([['color', 'green'], ['offset', 1]]),\n+      ]);\n+    });\n+\n+    it('should apply the delay specified in the useAnimation call using params', () => {\n       const animationMetaData = animation(\n           [\n             style({color: 'red'}),\n-            animate(500, style({color: 'green'})),\n+            animate(700, style({color: 'green'})),\n           ],\n-          {delay: 2000});\n+      );\n \n       @Component({\n         selector: 'cmp',\n@@ -3938,7 +3982,13 @@ describe('animation tests', function() {\n          </div>\n        `,\n         animations: [\n-          trigger('anim', [transition(':enter', useAnimation(animationMetaData), {delay: 750})]),\n+          trigger('anim', [transition(\n+                              ':enter',\n+                              useAnimation(animationMetaData, {\n+                                delay: '{{useAnimationDelay}}ms',\n+                                params: {useAnimationDelay: 7500}\n+                              }),\n+                              )]),\n         ]\n       })\n       class Cmp {\n@@ -3958,13 +4008,59 @@ describe('animation tests', function() {\n       const players = getLog();\n       expect(players.length).toEqual(1);\n       const [player] = players;\n-      expect(player.delay).toEqual(2750);\n-      expect(player.duration).toEqual(500);\n+      expect(player.delay).toEqual(7500);\n+      expect(player.duration).toEqual(700);\n       expect(player.keyframes).toEqual([\n         new Map<string, string|number>([['color', 'red'], ['offset', 0]]),\n         new Map<string, string|number>([['color', 'green'], ['offset', 1]]),\n       ]);\n     });\n+\n+    it('should combine the delays specified in the animation and the useAnimation with that of the caller',\n+       () => {\n+         const animationMetaData = animation(\n+             [\n+               style({color: 'red'}),\n+               animate(567, style({color: 'green'})),\n+             ],\n+             {delay: 1000});\n+\n+         @Component({\n+           selector: 'cmp',\n+           template: `\n+         <div @anim *ngIf=\"exp\">\n+         </div>\n+       `,\n+           animations: [\n+             trigger('anim', [transition(\n+                                 ':enter', useAnimation(animationMetaData, {delay: 34}),\n+                                 {delay: 200})]),\n+           ]\n+         })\n+         class Cmp {\n+           exp: boolean = false;\n+         }\n+\n+         TestBed.configureTestingModule({declarations: [Cmp]});\n+\n+         const engine = TestBed.inject(\u0275AnimationEngine);\n+         const fixture = TestBed.createComponent(Cmp);\n+         const cmp = fixture.componentInstance;\n+         cmp.exp = true;\n+\n+         fixture.detectChanges();\n+         engine.flush();\n+\n+         const players = getLog();\n+         expect(players.length).toEqual(1);\n+         const [player] = players;\n+         expect(player.delay).toEqual(1234);\n+         expect(player.duration).toEqual(567);\n+         expect(player.keyframes).toEqual([\n+           new Map<string, string|number>([['color', 'red'], ['offset', 0]]),\n+           new Map<string, string|number>([['color', 'green'], ['offset', 1]]),\n+         ]);\n+       });\n   });\n \n   it('should combine multiple errors together into one exception when an animation fails to be built',\n\n\n###\n\n", "completion": "fix(animations): make sure that the useAnimation function delay is applied (#<issue-num>)"}
{"prompt": " file path A: devtools/projects/ng-devtools/src/lib/application-operations/index.ts | file path B: devtools/projects/ng-devtools/src/lib/application-operations/index.ts\n\n@@ -9,7 +9,7 @@\n import {DirectivePosition, ElementPosition} from 'protocol';\n \n export abstract class ApplicationOperations {\n-  abstract viewSource(position: ElementPosition): void;\n+  abstract viewSource(position: ElementPosition, directiveIndex?: number): void;\n   abstract selectDomElement(position: ElementPosition): void;\n   abstract inspect(directivePosition: DirectivePosition, objectPath: string[]): void;\n }\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-explorer.component.html | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-explorer.component.html\n\n@@ -31,7 +31,7 @@\n       <ng-property-tab\n         [currentSelectedElement]=\"currentSelectedElement\"\n         (inspect)=\"inspect($event)\"\n-        (viewSource)=\"viewSource()\"\n+        (viewSource)=\"viewSource($event)\"\n       ></ng-property-tab>\n     </div>\n   </as-split-area>\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-explorer.component.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-explorer.component.ts\n\n@@ -139,11 +139,24 @@ export class DirectiveExplorerComponent implements OnInit, OnDestroy {\n     }\n   }\n \n-  viewSource(): void {\n+  viewSource(directiveName: string): void {\n+    // find the index of the directive with directiveName in this.currentSelectedElement.directives\n+\n     if (!this.currentSelectedElement) {\n       return;\n     }\n-    this._appOperations.viewSource(this.currentSelectedElement.position);\n+\n+    const directiveIndex = this.currentSelectedElement.directives.findIndex(\n+        directive => directive.name === directiveName);\n+\n+    if (directiveIndex === -1) {\n+      // view the component definition\n+      this._appOperations.viewSource(this.currentSelectedElement.position);\n+      return;\n+    }\n+\n+    // view the directive definition\n+    this._appOperations.viewSource(this.currentSelectedElement.position, directiveIndex);\n   }\n \n   handleSelectDomElement(node: IndexedNode): void {\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-tab-header.component.html | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-tab-header.component.html\n\n@@ -7,9 +7,6 @@\n             <mat-panel-title>\n               <div class=\"element-header\">\n                 <div class=\"component-name\">{{ currentSelectedElement.component.name }}</div>\n-                <button matTooltip=\"Open component source\" mat-icon-button (click)=\"handleViewSource($event)\">\n-                  <mat-icon> code </mat-icon>\n-                </button>\n               </div>\n             </mat-panel-title>\n           </mat-expansion-panel-header>\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-tab-header.component.scss | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-tab-header.component.scss\n\n@@ -5,12 +5,6 @@\n   align-items: center;\n   font-size: 11px;\n \n-  .mat-icon-button {\n-    height: 25px;\n-    width: 25px;\n-    line-height: 25px;\n-  }\n-\n   .component-name {\n     margin-left: 10px;\n     font-weight: 700;\n@@ -49,9 +43,3 @@\n     }\n   }\n }\n-\n-:host-context(.dark-theme) {\n-  .mat-icon-button {\n-    fill: #fff;\n-  }\n-}\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-tab-header.component.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-tab-header.component.ts\n\n@@ -19,10 +19,4 @@ import {IndexedNode} from '../directive-forest/index-forest';\n export class PropertyTabHeaderComponent {\n   @Input() currentSelectedElement: IndexedNode;\n   @Input() currentDirectives: string[]|undefined;\n-  @Output() viewSource = new EventEmitter<void>();\n-\n-  handleViewSource(event: MouseEvent): void {\n-    event.stopPropagation();\n-    this.viewSource.emit();\n-  }\n }\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-tab.component.html | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-tab.component.html\n\n@@ -1,4 +1,4 @@\n-<ng-property-tab-header [currentSelectedElement]=\"currentSelectedElement\" (viewSource)=\"viewSource.emit()\">\n+<ng-property-tab-header [currentSelectedElement]=\"currentSelectedElement\">\n </ng-property-tab-header>\n-<ng-property-tab-body (inspect)=\"inspect.emit($event)\" [currentSelectedElement]=\"currentSelectedElement\">\n+<ng-property-tab-body (inspect)=\"inspect.emit($event)\" (viewSource)=\"viewSource.emit($event)\" [currentSelectedElement]=\"currentSelectedElement\">\n </ng-property-tab-body>\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-tab.component.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-tab.component.ts\n\n@@ -18,6 +18,6 @@ import {FlatNode} from '../property-resolver/element-property-resolver';\n })\n export class PropertyTabComponent {\n   @Input() currentSelectedElement: IndexedNode;\n-  @Output() viewSource = new EventEmitter<void>();\n+  @Output() viewSource = new EventEmitter<string>();\n   @Output() inspect = new EventEmitter<{node: FlatNode; directivePosition: DirectivePosition}>();\n }\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-tab-body.component.html | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-tab-body.component.html\n\n@@ -1,5 +1,5 @@\n <ng-container *ngIf=\"currentSelectedElement\">\n   <div *ngFor=\"let directive of getCurrentDirectives()\" class=\"explorer-panel\">\n-    <ng-property-view (inspect)=\"inspect.emit($event)\" [directive]=\"directive\"></ng-property-view>\n+    <ng-property-view (inspect)=\"inspect.emit($event)\" (viewSource)=\"viewSource.emit(directive)\" [directive]=\"directive\"></ng-property-view>\n   </div>\n </ng-container>\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-tab-body.component.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-tab-body.component.ts\n\n@@ -20,6 +20,7 @@ import {FlatNode} from '../../property-resolver/element-property-resolver';\n export class PropertyTabBodyComponent {\n   @Input() currentSelectedElement: IndexedNode|null;\n   @Output() inspect = new EventEmitter<{node: FlatNode; directivePosition: DirectivePosition}>();\n+  @Output() viewSource = new EventEmitter<string>();\n \n   getCurrentDirectives(): string[]|undefined {\n     if (!this.currentSelectedElement) {\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-view-header.component.html | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-view-header.component.html\n\n@@ -1 +1,6 @@\n-<mat-toolbar>{{ directive }}</mat-toolbar>\n+<mat-toolbar>\n+    {{ directive }}\n+    <button matTooltip=\"Open source\" mat-icon-button (click)=\"handleViewSource($event)\">\n+        <mat-icon> code </mat-icon>\n+    </button>\n+</mat-toolbar>\n\\ No newline at end of file\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-view-header.component.scss | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-view-header.component.scss\n\n@@ -1,6 +1,6 @@\n mat-toolbar {\n   padding-left: 10px;\n-  display: block;\n+  justify-content: space-between;\n   text-overflow: ellipsis;\n   overflow: hidden;\n   line-height: 25px;\n@@ -8,3 +8,20 @@ mat-toolbar {\n   font-weight: 500;\n   height: auto;\n }\n+\n+.mat-icon-button {\n+  font-size:16px;\n+  line-height: 10px;\n+}\n+\n+.button {\n+  height: 20px;\n+  width: 20px;\n+  float: right;\n+}\n+\n+:host-context(.dark-theme) {\n+  .mat-icon-button {\n+    fill: #fff;\n+  }\n+}\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-view-header.component.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-view-header.component.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Component, Input} from '@angular/core';\n+import {Component, EventEmitter, Input, Output} from '@angular/core';\n \n @Component({\n   selector: 'ng-property-view-header',\n@@ -15,4 +15,11 @@ import {Component, Input} from '@angular/core';\n })\n export class PropertyViewHeaderComponent {\n   @Input() directive: string;\n+  @Output() viewSource = new EventEmitter<void>();\n+\n+  // output that emits directive\n+  handleViewSource(event: MouseEvent): void {\n+    event.stopPropagation();\n+    this.viewSource.emit();\n+  }\n }\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-view.component.html | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-view.component.html\n\n@@ -1,4 +1,4 @@\n-<ng-property-view-header [directive]=\"directive\"></ng-property-view-header>\n+<ng-property-view-header [directive]=\"directive\" (viewSource)=\"viewSource.emit()\"></ng-property-view-header>\n <ng-property-view-body\n   [controller]=\"controller\"\n   [directiveInputControls]=\"directiveInputControls\"\n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-view.component.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-view.component.ts\n\n@@ -20,6 +20,7 @@ import {ElementPropertyResolver, FlatNode} from '../../property-resolver/element\n export class PropertyViewComponent {\n   @Input() directive: string;\n   @Output() inspect = new EventEmitter<{node: FlatNode; directivePosition: DirectivePosition}>();\n+  @Output() viewSource = new EventEmitter<void>();\n \n   constructor(private _nestedProps: ElementPropertyResolver) {}\n \n\n---\n file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-view.module.ts | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-view.module.ts\n\n@@ -10,6 +10,7 @@ import {DragDropModule} from '@angular/cdk/drag-drop';\n import {CommonModule} from '@angular/common';\n import {NgModule} from '@angular/core';\n import {FormsModule} from '@angular/forms';\n+import {MatButtonModule} from '@angular/material/button';\n import {MatExpansionModule} from '@angular/material/expansion';\n import {MatIconModule} from '@angular/material/icon';\n import {MatToolbarModule} from '@angular/material/toolbar';\n@@ -36,6 +37,7 @@ import {PropertyViewComponent} from './property-view.component';\n   ],\n   imports: [\n     MatToolbarModule,\n+    MatButtonModule,\n     MatIconModule,\n     MatTreeModule,\n     MatTooltipModule,\n\n---\n file path A: devtools/projects/shell-browser/src/app/chrome-application-operations.ts | file path B: devtools/projects/shell-browser/src/app/chrome-application-operations.ts\n\n@@ -12,10 +12,11 @@ import {ApplicationOperations} from 'ng-devtools';\n import {DirectivePosition, ElementPosition} from 'protocol';\n \n export class ChromeApplicationOperations extends ApplicationOperations {\n-  viewSource(position: ElementPosition): void {\n+  viewSource(position: ElementPosition, directiveIndex: number): void {\n     if (chrome.devtools) {\n       chrome.devtools.inspectedWindow.eval(\n-          `inspect(inspectedApplication.findConstructorByPosition('${position}'))`);\n+          `inspect(inspectedApplication.findConstructorByPosition('${position}', ${\n+              directiveIndex}))`);\n     }\n   }\n \n\n---\n file path A: devtools/projects/shell-browser/src/app/chrome-window-extensions.ts | file path B: devtools/projects/shell-browser/src/app/chrome-window-extensions.ts\n\n@@ -25,12 +25,22 @@ const extendWindowOperations = <T extends {}>(target, classImpl: T) => {\n };\n \n const chromeWindowExtensions = {\n-  findConstructorByPosition: (serializedId: string): Element | undefined => {\n+  findConstructorByPosition: (serializedId: string, directiveIndex: number):\n+                                 Element | undefined => {\n     const node = findNodeFromSerializedPosition(serializedId);\n     if (node === null) {\n       console.error(`Cannot find element associated with node ${serializedId}`);\n       return;\n     }\n+    if (directiveIndex !== undefined) {\n+      if (node.directives[directiveIndex]) {\n+        return node.directives[directiveIndex].instance.constructor;\n+      } else {\n+        console.error(\n+            `Could not find the directive in the current node at index ${directiveIndex}`);\n+        return;\n+      }\n+    }\n     if (node.component) {\n       return node.component.instance.constructor;\n     } else {\n\n\n###\n\n", "completion": "feat(devtools): implement inspect functionality for directives (#<issue-num>)"}
{"prompt": " file path A: aio/content/images/bios/famzil.jpg | file path B: aio/content/images/bios/famzil.jpg\n\nBinary files /dev/null and b/aio/content/images/bios/famzil.jpg differ\n\n---\n file path A: aio/content/marketing/contributors.json | file path B: aio/content/marketing/contributors.json\n\n@@ -368,6 +368,14 @@\n     \"bio\": \"Fabian Gosebrink is a Google Developer Expert for Angular and Web Technologies, Microsoft MVP and Web Developer for ASP.NET Core and Angular. As a professional software engineer, consultant and trainer, he advises and supports customers in the implementation of frontend, backend, and mobile development of web applications.\",\n     \"groups\": [\"GDE\"]\n   },\n+  \"famzil\": {\n+    \"name\": \"Fatima AMZIL\",\n+    \"picture\": \"famzil.jpg\",\n+    \"twitter\": \"fati_amzil\",\n+    \"website\": \"https://fatimaamzil.com\",\n+    \"bio\": \"Frontend software engineer and Google Developer Expert for Angular\",\n+    \"groups\": [\"GDE\"]\n+  },\n   \"filipesilva\": {\n     \"name\": \"Filipe Silva\",\n     \"picture\": \"filipe-silva.jpg\",\n\n\n###\n\n", "completion": "docs: add fatima amzil to contributors (#<issue-num>)"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -62,9 +62,8 @@\n \n version: 3\n \n-availability:\n-  users_unavailable:\n-    - atscott # August 15 - September 20 (at least)\n+# availability:\n+#   users_unavailable:\n \n # Meta field that goes unused by PullApprove to allow for defining aliases to be\n # used throughout the config.\n\n\n###\n\n", "completion": "ci: remove atscott from unavailable list (#<issue-num>)"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -1085,7 +1085,7 @@ groups:\n           ])\n     reviewers:\n       users:\n-        - aleksanderbodurri\n+        - AleksanderBodurri\n         - devversion\n         - josephperrott\n         - mgechev\n@@ -1323,7 +1323,7 @@ groups:\n     reviewers:\n       users:\n         - alan-agius4 # Alan Agius\n-        - aleksanderbodurri # Aleksander Bodurri\n+        - AleksanderBodurri # Aleksander Bodurri\n         - alxhub # Alex Rickabaugh\n         - AndrewKushnir # Andrew Kushnir\n         - andrewseguin # Andrew Seguin\n\n\n###\n\n", "completion": "build: fix AleksanderBodurri to be the correct capitalization in pullapprove config (#<issue-num>)"}
{"prompt": " file path A: package.json | file path B: package.json\n\n@@ -128,7 +128,7 @@\n     \"diff\": \"^5.0.0\",\n     \"document-register-element\": \"^1.7.2\",\n     \"domino\": \"~2.1.6\",\n-    \"google-closure-compiler\": \"20220719.0.0\",\n+    \"google-closure-compiler\": \"20220905.0.0\",\n     \"graceful-fs\": \"4.2.10\",\n     \"hammerjs\": \"~2.0.8\",\n     \"http-server\": \"^14.0.0\",\n\n---\n file path A: packages/zone.js/package.json | file path B: packages/zone.js/package.json\n\n@@ -15,7 +15,7 @@\n     \"@types/node\": \"^10.9.4\",\n     \"domino\": \"2.1.6\",\n     \"jest\": \"^26.4\",\n-    \"google-closure-compiler\": \"^20220719.0.0\",\n+    \"google-closure-compiler\": \"^20220905.0.0\",\n     \"mocha\": \"^10.0.0\",\n     \"mock-require\": \"3.0.3\",\n     \"promises-aplus-tests\": \"^2.1.2\",\n\n---\n file path A: packages/zone.js/yarn.lock | file path B: packages/zone.js/yarn.lock\n\n@@ -975,7 +975,15 @@ capture-exit@^2.0.0:\n   dependencies:\n     rsvp \"^4.8.4\"\n \n-chalk@2.x, chalk@^2.0.0:\n+chalk@4.x, chalk@^4.0.0, chalk@^4.1.0:\n+  version \"4.1.2\"\n+  resolved \"https://registry.yarnpkg.com/chalk/-/chalk-4.1.2.tgz#aac4e2b7734a740867aeb16bf02aad556a1e7a01\"\n+  integrity sha512-oKnbhFyRIXpUuez8iBMmyEa4nbj4IOQyuhc/wy9kY7/WVPcwIO9VA668Pu8RkO7+0G76SLROeyw9CpQ061i4mA==\n+  dependencies:\n+    ansi-styles \"^4.1.0\"\n+    supports-color \"^7.1.0\"\n+\n+chalk@^2.0.0:\n   version \"2.4.2\"\n   resolved \"https://registry.yarnpkg.com/chalk/-/chalk-2.4.2.tgz#cd42541677a54333cf541a49108c1432b44c9424\"\n   integrity sha512-Mti+f9lpJNcwF4tWV8/OrTTtF1gZi+f8FqlyAdouralcFWFQWF2+NgCHShjkCb+IFBLq9buZwE1xckQU4peSuQ==\n@@ -984,14 +992,6 @@ chalk@2.x, chalk@^2.0.0:\n     escape-string-regexp \"^1.0.5\"\n     supports-color \"^5.3.0\"\n \n-chalk@^4.0.0, chalk@^4.1.0:\n-  version \"4.1.2\"\n-  resolved \"https://registry.yarnpkg.com/chalk/-/chalk-4.1.2.tgz#aac4e2b7734a740867aeb16bf02aad556a1e7a01\"\n-  integrity sha512-oKnbhFyRIXpUuez8iBMmyEa4nbj4IOQyuhc/wy9kY7/WVPcwIO9VA668Pu8RkO7+0G76SLROeyw9CpQ061i4mA==\n-  dependencies:\n-    ansi-styles \"^4.1.0\"\n-    supports-color \"^7.1.0\"\n-\n char-regex@^1.0.2:\n   version \"1.0.2\"\n   resolved \"https://registry.yarnpkg.com/char-regex/-/char-regex-1.0.2.tgz#d744358226217f981ed58f479b1d6bcc29545dcf\"\n@@ -1755,40 +1755,40 @@ globals@^11.1.0:\n   resolved \"https://registry.yarnpkg.com/globals/-/globals-11.12.0.tgz#ab8795338868a0babd8525758018c2a7eb95c42e\"\n   integrity sha512-WOBp/EEGUiIsJSp7wcv/y6MO+lV9UoncWqxuFfm8eBwzWNgyfBd6Gz+IeKQ9jCmyhoH99g15M3T+QaVHFjizVA==\n \n-google-closure-compiler-java@^20220719.0.0:\n-  version \"20220719.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-java/-/google-closure-compiler-java-20220719.0.0.tgz#a6dc7c7a7e58670d17467c64a77b2fd94418e38e\"\n-  integrity sha512-tjWdQSkFqxaFCgzUBaiJj2CxrWUYV0Ij2txp9Um+GyvrzMeX9rqHSUeW4I9cGpOrXkamvWCyAig4Yi0NZXApdg==\n-\n-google-closure-compiler-linux@^20220719.0.0:\n-  version \"20220719.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-linux/-/google-closure-compiler-linux-20220719.0.0.tgz#85ebdf3da6aaeee094295d6fc2be23324cf386c9\"\n-  integrity sha512-Em8QEAH7RC8T41QgTZC2keO0gsNdQgburXuXoF6gv2ySD/kJvNqrlZCCqLZMZUF6iuCpu3PgnMahdd3IrLpprA==\n-\n-google-closure-compiler-osx@^20220719.0.0:\n-  version \"20220719.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-osx/-/google-closure-compiler-osx-20220719.0.0.tgz#e97246adffc109a64bd79bcfdf964c78664c66da\"\n-  integrity sha512-NwOLgq0ftq0kY1jum6vrafwUMQrCJEpJu6wv5fW/TnYUprPJb1J0T7c4Su8wSm9rdvpqkkqWWMGpfb9RJBuM0g==\n-\n-google-closure-compiler-windows@^20220719.0.0:\n-  version \"20220719.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-windows/-/google-closure-compiler-windows-20220719.0.0.tgz#1177d2d27515d7d0867cdc4e258b32b499a6c005\"\n-  integrity sha512-Qi88lkU7a45SzCwdd9CV1D6paiiF7cEpBefkJIaNKi9MBfOZueHZH7Y8/56rdMhJLRjv5VMCGoJY4xH6FcXkvg==\n-\n-google-closure-compiler@^20220719.0.0:\n-  version \"20220719.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler/-/google-closure-compiler-20220719.0.0.tgz#234a53e0a09ea04ae04df6bab877e9c833afbd8f\"\n-  integrity sha512-0KTxUoX8WBZGeprvZfzp+czdi6wJ5wfJnG4RsIMEPFLR67fW4f+ghh04WSBLBt8kgT64NxaZGESjq23v0dbYNg==\n-  dependencies:\n-    chalk \"2.x\"\n-    google-closure-compiler-java \"^20220719.0.0\"\n+google-closure-compiler-java@^20220905.0.0:\n+  version \"20220905.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-java/-/google-closure-compiler-java-20220905.0.0.tgz#53d4b081c63fac09b6589729f5f359c8ec3ce27e\"\n+  integrity sha512-wxGxNla/0UDS1Lm0cRxEy85KhVRd0vNlsTclnIJ9f1gRWzvvTsJ4lwz+PdT60R6y2hKAOBvydIJHh+B8XJastA==\n+\n+google-closure-compiler-linux@^20220905.0.0:\n+  version \"20220905.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-linux/-/google-closure-compiler-linux-20220905.0.0.tgz#4cefd19938b522c1ac9b8254a44ecfffcb3354d8\"\n+  integrity sha512-kH09S66sz9+6wZmYM22VX8vG8KhCKJwFwXCfHx/ZOU6DBEzni6KfWrP+87CzTmZFEivclBhWAndm5HgNhSOEXQ==\n+\n+google-closure-compiler-osx@^20220905.0.0:\n+  version \"20220905.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-osx/-/google-closure-compiler-osx-20220905.0.0.tgz#0e685fb886db298af88b96ba683a04601f8c168b\"\n+  integrity sha512-4uo2GAz77gI8nDt4OA8VUYh/FNdjmTLOIRDazl7si+BOjgp9bC6C3E/88o+YHETsVtrPmZk57/W7vH0lftyTAw==\n+\n+google-closure-compiler-windows@^20220905.0.0:\n+  version \"20220905.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-windows/-/google-closure-compiler-windows-20220905.0.0.tgz#89b8767c4b6d95b4e8d13cc01bc6e4acdc5700dd\"\n+  integrity sha512-TZKHu6RHnrmgV90Gyen8+TGc0vgjgds80ErR+al5CqmfP9p+AskBbOe5CWZJht0bANrUhaeBMCrbs+7loFv06Q==\n+\n+google-closure-compiler@^20220905.0.0:\n+  version \"20220905.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler/-/google-closure-compiler-20220905.0.0.tgz#3e31cc164cea63789c04fca67f89661efec749de\"\n+  integrity sha512-idZavy2vn91HCmqEepjmLFjfOdYoRsh9PggUbazUpjAOrBQz0HOm3WjOICMiywre+EnY1QGss0srEBtFtukM6w==\n+  dependencies:\n+    chalk \"4.x\"\n+    google-closure-compiler-java \"^20220905.0.0\"\n     minimist \"1.x\"\n     vinyl \"2.x\"\n     vinyl-sourcemaps-apply \"^0.2.0\"\n   optionalDependencies:\n-    google-closure-compiler-linux \"^20220719.0.0\"\n-    google-closure-compiler-osx \"^20220719.0.0\"\n-    google-closure-compiler-windows \"^20220719.0.0\"\n+    google-closure-compiler-linux \"^20220905.0.0\"\n+    google-closure-compiler-osx \"^20220905.0.0\"\n+    google-closure-compiler-windows \"^20220905.0.0\"\n \n graceful-fs@^4.2.4:\n   version \"4.2.10\"\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -4993,14 +4993,13 @@ chainsaw@~0.1.0:\n   dependencies:\n     traverse \">=0.3.0 <0.4\"\n \n-chalk@2.x, chalk@^2.0.0, chalk@^2.3.0:\n-  version \"2.4.2\"\n-  resolved \"https://registry.yarnpkg.com/chalk/-/chalk-2.4.2.tgz#cd42541677a54333cf541a49108c1432b44c9424\"\n-  integrity sha512-Mti+f9lpJNcwF4tWV8/OrTTtF1gZi+f8FqlyAdouralcFWFQWF2+NgCHShjkCb+IFBLq9buZwE1xckQU4peSuQ==\n+chalk@4.x, chalk@^4.0.0, chalk@^4.1.0, chalk@^4.1.1, chalk@^4.1.2:\n+  version \"4.1.2\"\n+  resolved \"https://registry.yarnpkg.com/chalk/-/chalk-4.1.2.tgz#aac4e2b7734a740867aeb16bf02aad556a1e7a01\"\n+  integrity sha512-oKnbhFyRIXpUuez8iBMmyEa4nbj4IOQyuhc/wy9kY7/WVPcwIO9VA668Pu8RkO7+0G76SLROeyw9CpQ061i4mA==\n   dependencies:\n-    ansi-styles \"^3.2.1\"\n-    escape-string-regexp \"^1.0.5\"\n-    supports-color \"^5.3.0\"\n+    ansi-styles \"^4.1.0\"\n+    supports-color \"^7.1.0\"\n \n chalk@^1.1.1, chalk@^1.1.3:\n   version \"1.1.3\"\n@@ -5013,6 +5012,15 @@ chalk@^1.1.1, chalk@^1.1.3:\n     strip-ansi \"^3.0.0\"\n     supports-color \"^2.0.0\"\n \n+chalk@^2.0.0, chalk@^2.3.0:\n+  version \"2.4.2\"\n+  resolved \"https://registry.yarnpkg.com/chalk/-/chalk-2.4.2.tgz#cd42541677a54333cf541a49108c1432b44c9424\"\n+  integrity sha512-Mti+f9lpJNcwF4tWV8/OrTTtF1gZi+f8FqlyAdouralcFWFQWF2+NgCHShjkCb+IFBLq9buZwE1xckQU4peSuQ==\n+  dependencies:\n+    ansi-styles \"^3.2.1\"\n+    escape-string-regexp \"^1.0.5\"\n+    supports-color \"^5.3.0\"\n+\n chalk@^3.0.0:\n   version \"3.0.0\"\n   resolved \"https://registry.yarnpkg.com/chalk/-/chalk-3.0.0.tgz#3f73c2bf526591f574cc492c51e2456349f844e4\"\n@@ -5021,14 +5029,6 @@ chalk@^3.0.0:\n     ansi-styles \"^4.1.0\"\n     supports-color \"^7.1.0\"\n \n-chalk@^4.0.0, chalk@^4.1.0, chalk@^4.1.1, chalk@^4.1.2:\n-  version \"4.1.2\"\n-  resolved \"https://registry.yarnpkg.com/chalk/-/chalk-4.1.2.tgz#aac4e2b7734a740867aeb16bf02aad556a1e7a01\"\n-  integrity sha512-oKnbhFyRIXpUuez8iBMmyEa4nbj4IOQyuhc/wy9kY7/WVPcwIO9VA668Pu8RkO7+0G76SLROeyw9CpQ061i4mA==\n-  dependencies:\n-    ansi-styles \"^4.1.0\"\n-    supports-color \"^7.1.0\"\n-\n chalk@^5.0.0:\n   version \"5.0.1\"\n   resolved \"https://registry.yarnpkg.com/chalk/-/chalk-5.0.1.tgz#ca57d71e82bb534a296df63bbacc4a1c22b2a4b6\"\n@@ -8718,40 +8718,40 @@ google-auth-library@^8.0.2:\n     jws \"^4.0.0\"\n     lru-cache \"^6.0.0\"\n \n-google-closure-compiler-java@^20220719.0.0:\n-  version \"20220719.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-java/-/google-closure-compiler-java-20220719.0.0.tgz#a6dc7c7a7e58670d17467c64a77b2fd94418e38e\"\n-  integrity sha512-tjWdQSkFqxaFCgzUBaiJj2CxrWUYV0Ij2txp9Um+GyvrzMeX9rqHSUeW4I9cGpOrXkamvWCyAig4Yi0NZXApdg==\n-\n-google-closure-compiler-linux@^20220719.0.0:\n-  version \"20220719.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-linux/-/google-closure-compiler-linux-20220719.0.0.tgz#85ebdf3da6aaeee094295d6fc2be23324cf386c9\"\n-  integrity sha512-Em8QEAH7RC8T41QgTZC2keO0gsNdQgburXuXoF6gv2ySD/kJvNqrlZCCqLZMZUF6iuCpu3PgnMahdd3IrLpprA==\n-\n-google-closure-compiler-osx@^20220719.0.0:\n-  version \"20220719.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-osx/-/google-closure-compiler-osx-20220719.0.0.tgz#e97246adffc109a64bd79bcfdf964c78664c66da\"\n-  integrity sha512-NwOLgq0ftq0kY1jum6vrafwUMQrCJEpJu6wv5fW/TnYUprPJb1J0T7c4Su8wSm9rdvpqkkqWWMGpfb9RJBuM0g==\n-\n-google-closure-compiler-windows@^20220719.0.0:\n-  version \"20220719.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-windows/-/google-closure-compiler-windows-20220719.0.0.tgz#1177d2d27515d7d0867cdc4e258b32b499a6c005\"\n-  integrity sha512-Qi88lkU7a45SzCwdd9CV1D6paiiF7cEpBefkJIaNKi9MBfOZueHZH7Y8/56rdMhJLRjv5VMCGoJY4xH6FcXkvg==\n-\n-google-closure-compiler@20220719.0.0:\n-  version \"20220719.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler/-/google-closure-compiler-20220719.0.0.tgz#234a53e0a09ea04ae04df6bab877e9c833afbd8f\"\n-  integrity sha512-0KTxUoX8WBZGeprvZfzp+czdi6wJ5wfJnG4RsIMEPFLR67fW4f+ghh04WSBLBt8kgT64NxaZGESjq23v0dbYNg==\n-  dependencies:\n-    chalk \"2.x\"\n-    google-closure-compiler-java \"^20220719.0.0\"\n+google-closure-compiler-java@^20220905.0.0:\n+  version \"20220905.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-java/-/google-closure-compiler-java-20220905.0.0.tgz#53d4b081c63fac09b6589729f5f359c8ec3ce27e\"\n+  integrity sha512-wxGxNla/0UDS1Lm0cRxEy85KhVRd0vNlsTclnIJ9f1gRWzvvTsJ4lwz+PdT60R6y2hKAOBvydIJHh+B8XJastA==\n+\n+google-closure-compiler-linux@^20220905.0.0:\n+  version \"20220905.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-linux/-/google-closure-compiler-linux-20220905.0.0.tgz#4cefd19938b522c1ac9b8254a44ecfffcb3354d8\"\n+  integrity sha512-kH09S66sz9+6wZmYM22VX8vG8KhCKJwFwXCfHx/ZOU6DBEzni6KfWrP+87CzTmZFEivclBhWAndm5HgNhSOEXQ==\n+\n+google-closure-compiler-osx@^20220905.0.0:\n+  version \"20220905.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-osx/-/google-closure-compiler-osx-20220905.0.0.tgz#0e685fb886db298af88b96ba683a04601f8c168b\"\n+  integrity sha512-4uo2GAz77gI8nDt4OA8VUYh/FNdjmTLOIRDazl7si+BOjgp9bC6C3E/88o+YHETsVtrPmZk57/W7vH0lftyTAw==\n+\n+google-closure-compiler-windows@^20220905.0.0:\n+  version \"20220905.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-windows/-/google-closure-compiler-windows-20220905.0.0.tgz#89b8767c4b6d95b4e8d13cc01bc6e4acdc5700dd\"\n+  integrity sha512-TZKHu6RHnrmgV90Gyen8+TGc0vgjgds80ErR+al5CqmfP9p+AskBbOe5CWZJht0bANrUhaeBMCrbs+7loFv06Q==\n+\n+google-closure-compiler@20220905.0.0:\n+  version \"20220905.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler/-/google-closure-compiler-20220905.0.0.tgz#3e31cc164cea63789c04fca67f89661efec749de\"\n+  integrity sha512-idZavy2vn91HCmqEepjmLFjfOdYoRsh9PggUbazUpjAOrBQz0HOm3WjOICMiywre+EnY1QGss0srEBtFtukM6w==\n+  dependencies:\n+    chalk \"4.x\"\n+    google-closure-compiler-java \"^20220905.0.0\"\n     minimist \"1.x\"\n     vinyl \"2.x\"\n     vinyl-sourcemaps-apply \"^0.2.0\"\n   optionalDependencies:\n-    google-closure-compiler-linux \"^20220719.0.0\"\n-    google-closure-compiler-osx \"^20220719.0.0\"\n-    google-closure-compiler-windows \"^20220719.0.0\"\n+    google-closure-compiler-linux \"^20220905.0.0\"\n+    google-closure-compiler-osx \"^20220905.0.0\"\n+    google-closure-compiler-windows \"^20220905.0.0\"\n \n google-gax@^3.0.1:\n   version \"3.1.3\"\n\n\n###\n\n", "completion": "build: update dependency google-closure-compiler to v20220905 (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/standalone-components.md | file path B: aio/content/guide/standalone-components.md\n\n@@ -11,6 +11,8 @@ In v14 and higher, **standalone components** provide a simplified way to build A\n \n ## Creating standalone components\n \n+<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/x5PZwb4XurU\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n+\n ### The `standalone` flag and component `imports`\n \n Components, directives, and pipes can now be marked as `standalone: true`. Angular classes marked as standalone do not need to be declared in an `NgModule` (the Angular compiler will report an error if you try).\n\n\n###\n\n", "completion": "docs: add standalone component intro video (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/typed-forms.md | file path B: aio/content/guide/typed-forms.md\n\n@@ -12,6 +12,8 @@ As background for this guide, you should already be familiar with [Angular React\n \n ## Overview of Typed Forms\n \n+<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/L-odCf4MfJc\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n+\n With Angular reactive forms, you explicitly specify a *form model*. As a simple example, consider this basic user login form:\n \n ```ts\n\n\n###\n\n", "completion": "docs: add link to YouTube video of Typed Forms (#<issue-num>)"}
{"prompt": " file path A: None | file path B: .github/ISSUE_TEMPLATE/4-devtools.yaml\n\n@@ -0,0 +1,54 @@\n+name: 'Angular DevTools'\n+description: Report an issue or suggest a feature for Angular DevTools\n+\n+body:\n+  - type: checkboxes\n+    id: bug-report-or-feature-request\n+    attributes:\n+      label: Is this a bug report or a feature request?\n+      description: Select one.\n+      options:\n+        - label: Bug Report\n+        - label: Feature Request\n+\n+  - type: textarea\n+    id: reproduction-steps\n+    attributes:\n+      label: Please provide the steps to reproduce the issue [Bug Report only]\n+\n+  - type: textarea\n+    id: expected-vs-actual-behavior\n+    attributes:\n+      label: Please provide the expected behavior vs the actual behavior you encountered [Bug Report only]\n+\n+  - type: textarea\n+    id: screenshot\n+    attributes:\n+      label: Please provide a screenshot if possible [Bug Report only]\n+\n+  - type: textarea\n+    id: exception-or-error\n+    attributes:\n+      label: Please provide the exception or error you saw [Bug Report only]\n+      render: true\n+\n+  - type: textarea\n+    id: browser-info\n+    attributes:\n+      label: Is this a browser-specific issue? If so, please specify the device, browser, and version. [Bug Report only]\n+      render: true\n+\n+  - type: textarea\n+    id: description\n+    attributes:\n+      label: Description [Feature Request only]\n+\n+  - type: textarea\n+    id: proposed-solution\n+    attributes:\n+      label: Proposed solution [Feature Request only]\n+\n+  - type: textarea\n+    id: alternatives-considered\n+    attributes:\n+      label: Alternatives considered [Feature Request only]\n\n\n###\n\n", "completion": "docs: add issue template for Angular DevTools (#<issue-num>)"}
{"prompt": " file path A: aio/content/marketing/events.json | file path B: aio/content/marketing/events.json\n\n@@ -1028,54 +1028,63 @@\n     \"date\": {\n       \"start\": \"2022-08-31\"\n     },\n+    \"linkUrl\": \"https://2022.ng-conf.org/\",\n     \"name\": \"ng-conf\"\n   },\n   {\n     \"date\": {\n       \"start\": \"2022-09-12\"\n     },\n+    \"linkUrl\": \"https://www.telerik.com/devreach-2022\",\n     \"name\": \"DevReach\"\n   },\n   {\n     \"date\": {\n       \"start\": \"2022-10-06\"\n     },\n+    \"linkUrl\": \"https://ng-de.org/\",\n     \"name\": \"NG-DE\"\n   },\n   {\n     \"date\": {\n       \"start\": \"2022-10-06\"\n     },\n+    \"linkUrl\": \"https://nordicjs.com/2022\",\n     \"name\": \"Nordic.js\"\n   },\n   {\n     \"date\": {\n       \"start\": \"2022-10-07\"\n     },\n+    \"linkUrl\": \"https://2022.angularday.it/\",\n     \"name\": \"angularday\"\n   },\n   {\n     \"date\": {\n       \"start\": \"2022-10-18\"\n     },\n+    \"linkUrl\": \"https://extra.codemotion.com/conference-milan-2022\",\n     \"name\": \"Codemotion Milan\"\n   },\n   {\n     \"date\": {\n       \"start\": \"2022-10-25\"\n     },\n+    \"linkUrl\": \"http://ng-poland.pl/\",\n     \"name\": \"NG-Poland\"\n   },\n   {\n     \"date\": {\n       \"start\": \"2022-10-26\"\n     },\n+    \"linkUrl\": \"http://js-poland.pl/\",\n     \"name\": \"JS Poland\"\n   },\n   {\n     \"date\": {\n       \"start\": \"2022-10-27\"\n     },\n+    \"linkUrl\": \"https://portotechhub.com/conference-2022\",\n     \"name\": \"Porto Tech Hub\"\n   },\n   {\n@@ -1088,6 +1097,7 @@\n     \"date\": {\n       \"start\": \"2022-12-02\"\n     },\n+    \"linkUrl\": \"https://ngrome.io/\",\n     \"name\": \"ngRome\"\n   },\n   {\n\n\n###\n\n", "completion": "docs: update events (#<issue-num>)"}
{"prompt": " file path A: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-view-tree.component.scss | file path B: devtools/projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/property-view-tree.component.scss\n\n@@ -18,6 +18,8 @@\n         font-size: 11px;\n         width: 8px;\n         height: 16px;\n+        position: relative;\n+        top: 6px;\n       }\n     }\n   }\n\n\n###\n\n", "completion": "fix(devtools): fix positioning of property explorer expansion icon (#<issue-num>)"}
{"prompt": " file path A: aio/src/styles/2-modules/table/_table.scss | file path B: aio/src/styles/2-modules/table/_table.scss\n\n@@ -37,7 +37,7 @@ table {\n       padding: 16px;\n       text-align: left;\n       @include mixins.line-height(24);\n-      vertical-align: top;\n+      vertical-align: baseline;\n \n       @media (max-width: 480px) {\n         &:before {\n\n\n###\n\n", "completion": "fix(docs-infra): apply `text-top` instead of `top` for table alignment (#<issue-num>)"}
{"prompt": " file path A: aio/src/app/custom-elements/search/file-not-found-search.component.spec.ts | file path B: aio/src/app/custom-elements/search/file-not-found-search.component.spec.ts\n\n@@ -7,7 +7,13 @@ import { SearchResults } from 'app/search/interfaces';\n import { SearchResultsComponent } from 'app/shared/search-results/search-results.component';\n import { SearchService } from 'app/search/search.service';\n import { FileNotFoundSearchComponent } from './file-not-found-search.component';\n+import { Component } from '@angular/core';\n \n+@Component({\n+  selector: 'mat-icon',\n+  template: '',\n+})\n+class MockMatIcon {}\n \n describe('FileNotFoundSearchComponent', () => {\n   let fixture: ComponentFixture<FileNotFoundSearchComponent>;\n@@ -17,7 +23,7 @@ describe('FileNotFoundSearchComponent', () => {\n   beforeEach(() => {\n \n     TestBed.configureTestingModule({\n-      declarations: [ FileNotFoundSearchComponent, SearchResultsComponent ],\n+      declarations: [ FileNotFoundSearchComponent, SearchResultsComponent, MockMatIcon ],\n       providers: [\n         { provide: LocationService, useValue: new MockLocationService('base/initial-url?some-query') },\n         SearchService\n\n---\n file path A: aio/src/app/shared/search-results/search-results.component.spec.ts | file path B: aio/src/app/shared/search-results/search-results.component.spec.ts\n\n@@ -1,9 +1,15 @@\n-import { DebugElement } from '@angular/core';\n+import { Component, DebugElement } from '@angular/core';\n import { ComponentFixture, TestBed } from '@angular/core/testing';\n import { By } from '@angular/platform-browser';\n import { SearchResult } from 'app/search/interfaces';\n import { SearchResultsComponent } from './search-results.component';\n \n+@Component({\n+  selector: 'mat-icon',\n+  template: '',\n+})\n+class MockMatIcon {}\n+\n describe('SearchResultsComponent', () => {\n \n   let component: SearchResultsComponent;\n@@ -76,7 +82,7 @@ describe('SearchResultsComponent', () => {\n \n   beforeEach(() => {\n     TestBed.configureTestingModule({\n-      declarations: [ SearchResultsComponent ]\n+      declarations: [ SearchResultsComponent, MockMatIcon ]\n     });\n   });\n \n\n\n###\n\n", "completion": "test(docs-infra): add mocks for missing mat-icons (#<issue-num>)"}
{"prompt": " file path A: docs/DEVELOPER.md | file path B: docs/DEVELOPER.md\n\n@@ -100,6 +100,24 @@ This can be done by running:\n yarn ng-dev misc build-and-link <path-to-local-project-root>\n ```\n \n+### Building and serving a project\n+\n+#### Cache\n+\n+When making changes to Angular packages and testing in a local library/project you need to run `ng cache disable` to disable the Angular CLI disk cache. If you are making changes that are not reflected in your locally served library/project, verify if you have [CLI Cache](https://angular.io/guide/workspace-config#cache-options) disabled.\n+\n+#### Invoking the Angular CLI\n+\n+The Angular CLI needs to be invoked using Node.js [`--preserve-symlinks`](https://nodejs.org/api/cli.html#--preserve-symlinks) flag. Otherwise the symbolic links will be resolved using their real path which causes node module resolution to fail.\n+\n+##### Windows\n+\n+`set BAZEL_TARGET=\"1\" && node --preserve-symlinks node_modules/@angular/cli/lib/init.js serve`\n+\n+##### Unix Systems\n+\n+`BAZEL_TARGET=\"1\" node --preserve-symlinks node_modules/.bin/ng serve`\n+\n ## Formatting your source code\n \n Angular uses [clang-format](https://clang.llvm.org/docs/ClangFormat.html) to format the source code.\n\n\n###\n\n", "completion": "docs: update contribution docs for serving a local library/project (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/getting-started/src/app/cart.service.ts | file path B: aio/content/examples/getting-started/src/app/cart.service.ts\n\n@@ -1,14 +1,14 @@\n // #docregion import-http\n-import { Injectable } from '@angular/core';\n import { HttpClient } from '@angular/common/http';\n // #docregion props\n import { Product } from './products';\n+import { Injectable } from '@angular/core';\n // #enddocregion props, import-http\n \n+// #docregion props, methods, inject-http, get-shipping\n @Injectable({\n   providedIn: 'root'\n })\n-// #docregion props, methods, inject-http, get-shipping\n export class CartService {\n // #enddocregion get-shipping\n   items: Product[] = [];\n\n\n###\n\n", "completion": "docs(docs-infra): add missing decorator in tutorial step (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/image-directive-setup.md | file path B: aio/content/guide/image-directive-setup.md\n\n@@ -1,5 +1,12 @@\n # Setting up `NgOptimizedImage`\n \n+<div class=\"alert is-important\">\n+\n+The `NgOptimizedImage` directive is available for [developer preview](https://angular.io/guide/releases#developer-preview).\n+It's ready for you to try, but it might change before it is stable.\n+\n+</div>\n+\n This tutorial explains how to set up the `NgOptimizedImage`. For information on using `NgOptimizedImage`, see [Getting Started with NgOptimizedImage](/guide/image-directive).\n \n ## Import `NgOptimizedImage`\n\n---\n file path A: aio/content/guide/image-directive.md | file path B: aio/content/guide/image-directive.md\n\n@@ -1,6 +1,11 @@\n # Getting started with NgOptimizedImage\n \n-Note: the `NgOptimizedImage` directive is currently in the [\"Developer Preview\" mode](https://angular.io/guide/releases#developer-preview). The Angular team will stabilize the APIs based on the feedback and will make an announcement once the APIs are fully stable.\n+<div class=\"alert is-important\">\n+\n+The `NgOptimizedImage` directive is available for [developer preview](https://angular.io/guide/releases#developer-preview).\n+It's ready for you to try, but it might change before it is stable.\n+\n+</div>\n \n The `NgOptimizedImage` directive makes it easy to adopt performance best practices for loading images.\n \n\n---\n file path A: aio/content/guide/standalone-components.md | file path B: aio/content/guide/standalone-components.md\n\n@@ -1,14 +1,14 @@\n # Getting started with standalone components\n \n-In v14 and higher, **standalone components** provide a simplified way to build Angular applications. Standalone components, directives, and pipes aim to streamline the authoring experience by reducing the need for `NgModule`s. Existing applications can optionally and incrementally adopt the new standalone style without any breaking changes.\n-\n <div class=\"alert is-important\">\n \n-The standalone component feature is available for developer preview. \n-It's ready for you to try; but it might change before it is stable.\n+The standalone component feature is available for [developer preview](https://angular.io/guide/releases#developer-preview).\n+It's ready for you to try, but it might change before it is stable.\n \n </div>\n \n+In v14 and higher, **standalone components** provide a simplified way to build Angular applications. Standalone components, directives, and pipes aim to streamline the authoring experience by reducing the need for `NgModule`s. Existing applications can optionally and incrementally adopt the new standalone style without any breaking changes.\n+\n ## Creating standalone components\n \n ### The `standalone` flag and component `imports`\n\n---\n file path A: aio/content/navigation.json | file path B: aio/content/navigation.json\n\n@@ -637,11 +637,6 @@\n           \"url\": \"guide/prerendering\",\n           \"title\": \"Prerendering\",\n           \"tooltip\": \"Prerender HTML server-side with Angular Universal.\"\n-        },\n-        {\n-          \"url\": \"guide/image-directive\",\n-          \"title\": \"Image Directive\",\n-          \"tooltip\": \"Performant images with the Angular image directive.\"\n         }\n       ]\n     },\n@@ -861,6 +856,11 @@\n           \"url\": \"guide/standalone-components\",\n           \"title\": \"Standalone components\",\n           \"tooltip\": \"Standalone components, directives and pipes\"\n+        },\n+        {\n+          \"url\": \"guide/image-directive\",\n+          \"title\": \"Image Directive\",\n+          \"tooltip\": \"Performant images with the Angular image directive.\"\n         }\n       ]\n     },\n\n\n###\n\n", "completion": "docs: move Image Directive guide link to the Feature Preview section (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/update-events.yml | file path B: .github/workflows/update-events.yml\n\n@@ -11,7 +11,7 @@ on:\n     inputs: {}\n   schedule:\n     # Run every day at 15:00.\n-    - cron: 0 15 * * *\n+    - cron: '0 15 * * *'\n \n # Declare default permissions as read only.\n permissions:\n@@ -45,4 +45,4 @@ jobs:\n             action: review\n             comp: docs\n             target: patch\n-          angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n+          angular-robot-token: ${{ secrets.ANGULAR_ROBOT_ACCESS_TOKEN }}\n\n\n###\n\n", "completion": "fix(docs-infra): fix `Update AIO events` GitHub Action (#<issue-num>)"}
{"prompt": " file path A: aio/src/app/custom-elements/events/events.component.html | file path B: aio/src/app/custom-elements/events/events.component.html\n\n@@ -1,5 +1,5 @@\n <h2>Where we'll be presenting:</h2>\n-<ng-container [ngSwitch]=\"!!upcomingEvents?.length\">\n+<ng-container [ngSwitch]=\"!!upcomingEvents.length\">\n   <div *ngSwitchCase=\"false\">\n     <p>We don't have any upcoming speaking engagements at the moment.</p>\n     <p>\n\n---\n file path A: aio/src/app/custom-elements/events/events.component.spec.ts | file path B: aio/src/app/custom-elements/events/events.component.spec.ts\n\n@@ -20,11 +20,11 @@ describe('EventsComponent', () => {\n   });\n \n   it('should have no pastEvents when first created', () => {\n-    expect(component.pastEvents).toBeUndefined();\n+    expect(component.pastEvents.length).toEqual(0);\n   });\n \n   it('should have no upcoming when first created', () => {\n-    expect(component.upcomingEvents).toBeUndefined();\n+    expect(component.upcomingEvents.length).toEqual(0);\n   });\n \n   describe('ngOnInit()', () => {\n\n---\n file path A: aio/src/app/custom-elements/events/events.component.ts | file path B: aio/src/app/custom-elements/events/events.component.ts\n\n@@ -18,8 +18,8 @@ export interface AngularEvent {\n })\n export class EventsComponent implements OnInit {\n \n-  pastEvents: AngularEvent[];\n-  upcomingEvents: AngularEvent[];\n+  pastEvents: AngularEvent[] = [];\n+  upcomingEvents: AngularEvent[] = [];\n \n   constructor(private eventsService: EventsService) { }\n \n\n\n###\n\n", "completion": "fix(docs-infra): initialize events arrays in EventsComponent (#<issue-num>)"}
{"prompt": " file path A: CODE_OF_CONDUCT.md | file path B: CODE_OF_CONDUCT.md\n\n@@ -2,7 +2,7 @@\n \n ## Our Pledge\n \n-In the interest of fostering an safe and welcoming environment, we as\n+In the interest of fostering a safe and welcoming environment, we as\n the Angular team pledge to make participation in our project and\n our community a harassment-free experience for everyone, regardless of age, body\n size, disability, ethnicity, sex characteristics, gender identity, gender expression,\n\n---\n file path A: CODE_OF_CONDUCT.md | file path B: CODE_OF_CONDUCT.md\n\n@@ -2,7 +2,7 @@\n \n ## Our Pledge\n \n-In the interest of fostering a safe and welcoming environment, we as\n+In the interest of fostering an safe and welcoming environment, we as\n the Angular team pledge to make participation in our project and\n our community a harassment-free experience for everyone, regardless of age, body\n size, disability, ethnicity, sex characteristics, gender identity, gender expression,\n\n\n###\n\n", "completion": "build: update `CODE_OF_CONDUCT.md` to match the content of `angular/.github`"}
{"prompt": " file path A: goldens/size-tracking/integration-payloads.json | file path B: goldens/size-tracking/integration-payloads.json\n\n@@ -48,7 +48,7 @@\n   \"animations\": {\n     \"uncompressed\": {\n       \"runtime\": 1070,\n-      \"main\": 156736,\n+      \"main\": 156816,\n       \"polyfills\": 33814\n     }\n   },\n\n---\n file path A: packages/core/src/render3/instructions/shared.ts | file path B: packages/core/src/render3/instructions/shared.ts\n\n@@ -893,19 +893,20 @@ export function initializeInputAndOutputAliases(tView: TView, tNode: TNode): voi\n   const inputsFromAttrs: InitialInputData = ngDevMode ? new TNodeInitialInputs() : [];\n   let inputsStore: PropertyAliases|null = null;\n   let outputsStore: PropertyAliases|null = null;\n+\n   for (let i = start; i < end; i++) {\n     const directiveDef = tViewData[i] as DirectiveDef<any>;\n-    const directiveInputs = directiveDef.inputs;\n+    inputsStore = generatePropertyAliases(directiveDef.inputs, i, inputsStore);\n+    outputsStore = generatePropertyAliases(directiveDef.outputs, i, outputsStore);\n     // Do not use unbound attributes as inputs to structural directives, since structural\n     // directive inputs can only be set using microsyntax (e.g. `<div *dir=\"exp\">`).\n     // TODO(FW-1930): microsyntax expressions may also contain unbound/static attributes, which\n     // should be set for inline templates.\n-    const initialInputs = (tNodeAttrs !== null && !isInlineTemplate(tNode)) ?\n-        generateInitialInputs(directiveInputs, tNodeAttrs) :\n+    const initialInputs =\n+        (inputsStore !== null && tNodeAttrs !== null && !isInlineTemplate(tNode)) ?\n+        generateInitialInputs(inputsStore, i, tNodeAttrs) :\n         null;\n     inputsFromAttrs.push(initialInputs);\n-    inputsStore = generatePropertyAliases(directiveInputs, i, inputsStore);\n-    outputsStore = generatePropertyAliases(directiveDef.outputs, i, outputsStore);\n   }\n \n   if (inputsStore !== null) {\n@@ -1487,11 +1488,12 @@ function setInputsFromAttrs<T>(\n  *\n  * <my-component name=\"Bess\"></my-component>\n  *\n- * @param inputs The list of inputs from the directive def\n- * @param attrs The static attrs on this node\n+ * @param inputs Input alias map that was generated from the directive def inputs.\n+ * @param directiveIndex Index of the directive that is currently being processed.\n+ * @param attrs Static attrs on this node.\n  */\n-function generateInitialInputs(inputs: {[key: string]: string}, attrs: TAttributes): InitialInputs|\n-    null {\n+function generateInitialInputs(\n+    inputs: PropertyAliases, directiveIndex: number, attrs: TAttributes): InitialInputs|null {\n   let inputsToStore: InitialInputs|null = null;\n   let i = 0;\n   while (i < attrs.length) {\n@@ -1511,7 +1513,19 @@ function generateInitialInputs(inputs: {[key: string]: string}, attrs: TAttribut\n \n     if (inputs.hasOwnProperty(attrName as string)) {\n       if (inputsToStore === null) inputsToStore = [];\n-      inputsToStore.push(attrName as string, inputs[attrName as string], attrs[i + 1] as string);\n+\n+      // Find the input's public name from the input store. Note that we can be found easier\n+      // through the directive def, but we want to do it using the inputs store so that it can\n+      // account for host directive aliases.\n+      const inputConfig = inputs[attrName as string];\n+      for (let j = 0; j < inputConfig.length; j += 2) {\n+        if (inputConfig[j] === directiveIndex) {\n+          inputsToStore.push(\n+              attrName as string, inputConfig[j + 1] as string, attrs[i + 1] as string);\n+          // A directive can't have multiple inputs with the same name so we can break here.\n+          break;\n+        }\n+      }\n     }\n \n     i += 2;\n\n\n###\n\n", "completion": "refactor(core): generate initial inputs from inputs map (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/update-events.yml | file path B: .github/workflows/update-events.yml\n\n@@ -1,3 +1,9 @@\n+# Update the `events.json` file that powers the [AIO events page](https://angular.io/events) (if\n+# necessary) and create a pull request.\n+#\n+# For more details on the overall process, see\n+# [aio/scripts/generate-events/README.md](../../aio/scripts/generate-events/README.md).\n+\n name: Update AIO events\n \n on:\n\n---\n file path A: aio/scripts/generate-events/README.md | file path B: aio/scripts/generate-events/README.md\n\n@@ -43,7 +43,8 @@ In a nutshell, the setup can be summarized as follows:\n \n 1. The DevRel team keeps information about events in a Google Sheets spreadsheet (in the appropriate format).\n 2. An Apps Script extension on the spreadsheet periodically saves the relevant information (such as event names and dates) in a Firebase Realtime Database.\n-3. There is a script (that can be run periodically) which can query the database and generate `events.json` based on the latest data.\n+3. There is a script which can query the database and generate `events.json` based on the latest data.\n+4. A GitHub Actions periodically runs the script and creates a pull request if there are updates.\n \n \n #### Apps Script extension overview\n@@ -68,6 +69,8 @@ Useful resource: https://stackoverflow.com/questions/53207906/how-to-integrate-f\n   - Each team allocation sheet should have the event names on the second row (each under the corresponding date cell).\n     Event names can optionally be links pointing to the event's web page.\n \n+  _**NOTE:** For this project, we use our [Angular Conferences Speaker Tracker](https://docs.google.com/spreadsheets/d/1B_2VUYMmaNhjCTIFKYluI7BwOYj1rEcRJX1ttniqteQ) spreadsheet._\n+\n 2. Create an [Apps Script extension](https://developers.google.com/apps-script/guides/sheets) for the aforementioned spreadsheet with the source code from the [apps-script-extension/](./apps-script-extension/) directory.\n   To do this, open the spreadsheet, click on `Extensions > Apps Script`, create the necessary files as seen in the source code (with the difference that the `.js` extension must be replaced with `.gs`) and copy the source code.\n   For `appsscript.json`, follow the instructions [here](https://developers.google.com/apps-script/concepts/manifests#editing_a_manifest) to make it appear in the in-browser editor.\n@@ -80,12 +83,14 @@ Useful resource: https://stackoverflow.com/questions/53207906/how-to-integrate-f\n 5. Follow the instructions [here](https://firebase.google.com/docs/rules/manage-deploy#generate_a_configuration_file) to set up [security rules](https://firebase.google.com/docs/rules) and make sure they are deployed to the Firebase project as needed.\n   You can see the database security rules used for this project in [database.rules.json](../../database.rules.json).\n   These rules will allow anyone to read the events from the database, but only someone with access to the Firebase project will be able to update the events in the database.\n-  NOTE: For this project, the rules are deployed as part of the `deploy_aio` CI job.\n+\n+  _**NOTE:** For this project, the rules are deployed as part of the `deploy_aio` CI job._\n \n 6. Ensure that the account that was used to create the Google Sheets trigger on step 3 also has access to the Firebase project (otherwise, the trigger will fail to update the database when events change in the spreadsheet).\n \n 7. Wire the [index.mjs](./index.mjs) script to run when necessary to generate an updated `events.json` file.\n-  NOTE: For this project, there is a [GitHub Action](https://github.com/angular/angular/blob/main/.github/workflows/update-events.yml) that periodically runs the script and creates a pull request (if necessary).\n+\n+  _**NOTE:** For this project, there is a [GitHub Action](../../../.github/workflows/update-events.yml) that periodically runs the script and creates a pull request (if necessary)._\n \n 8. Ensure that both [constants.gs](./apps-script-extension/constants.js) and [index.mjs](./index.mjs) point to the correct database URL.\n \n@@ -96,6 +101,41 @@ Although the source code in [apps-script-extension/](./apps-script-extension/) a\n Whenever a change is needed to be made to the Apps Script extension, the change should be applied in both places.\n \n \n+### How to debug\n+\n+If the process does not work as expected, i.e. changes are made to the spreadsheet but no pull request is created to update `event.json`, there are three places where one can look to find out at which point the process breaks:\n+\n+1. Ensure that the Apps Script extension runs successfully:\n+\n+  - You can check the previous executions of the `updateEventsOnFirebase()` function by opening the spreadsheet and clicking on `Extensions > Apps Script > Executions`.\n+    There, you can see when the extension ran and also click on an execution to see the output log.\n+\n+    _**NOTE:** For this project, executions can be found [here](https://script.google.com/home/projects/1X4IxdwG3WBE-jGK_3PZi5Ud1y-A3V2x_ZbKd0dHZGudRJgL_ssLVS9y2/executions)._\n+\n+  - You can also manually run the `updateEventsOnFirebase()` function by opening the spreadsheet and clicking on `Extensions > Apps Script > Editor > persister.gs`.\n+    From there, choose the function in the dropdown at the top of the editor and click the `Run` button.\n+\n+    _**NOTE:** For this project, the editor can be found [here](https://script.google.com/home/projects/1X4IxdwG3WBE-jGK_3PZi5Ud1y-A3V2x_ZbKd0dHZGudRJgL_ssLVS9y2/edit)._\n+\n+2. Ensure that the database contains the correct data:\n+\n+  - Visit the [Firebase console](https://console.firebase.google.com/), open the targeted project and click on `Realtime Database`.\n+\n+  - From there, you can explore the data and ensure that the `events` node contains the expected data.\n+\n+  _**NOTE:** For this project, the database can be found [here](https://console.firebase.google.com/project/angular-io/database/angular-io/data)._\n+\n+3. If you have set up a GitHub Action, ensure that it runs successfully:\n+\n+  - You can check the previous runs of the GitHub action by visiting the repository page on GitHub, clicking the `Actions` tab and then choosing the correct workflow from the list on the left.\n+\n+  - From there, you can see when the action was run and also click on a run to see the completion status of each job and the output log.\n+\n+  - You can also manually run the action, by clicking the `Run workflow` button.\n+\n+  _**NOTE:** For this project, you can see runs of the `Update AIO events` GitHub Action [here](https://github.com/angular/angular/actions/workflows/update-events.yml)._\n+\n+\n ### Trade-offs/Alternatives considered\n \n This section describes trade-offs made and alternative implementations/variations that were considered.\n\n\n###\n\n", "completion": "docs(docs-infra): add documentation on debugging the events generation process (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,26 @@\n+<a name=\"14.2.2\"></a>\n+# 14.2.2 (2022-09-14)\n+### animations\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [937e6c5b3d](https://github.com/angular/angular/commit/937e6c5b3d4c4bfc6ba202ee6692bc2fd8a35b89) | fix | make sure that the animation function delay is applied ([#47285](https://github.com/angular/angular/pull/47285)) |\n+### common\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [c9bdf9bab1](https://github.com/angular/angular/commit/c9bdf9bab1bc4cc4da207f6bfc8ebc75eb605486) | fix | rename `rawSrc` -> `ngSrc` in NgOptimizedImage directive ([#47362](https://github.com/angular/angular/pull/47362)) ([#47396](https://github.com/angular/angular/pull/47396)) |\n+### core\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [a3e1303f04](https://github.com/angular/angular/commit/a3e1303f04d4afe456f3728939b3aa54e29f9fb3) | fix | imply @Optional flag when a default value is provided ([#47242](https://github.com/angular/angular/pull/47242)) |\n+### forms\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [80c66a1e57](https://github.com/angular/angular/commit/80c66a1e57af33342ed851a0de886fc17b53f7a3) | fix | don't prevent default behavior for forms with method=\"dialog\" ([#47308](https://github.com/angular/angular/pull/47308)) |\n+## Special Thanks\n+Abhishek Rawat, Andrew Kushnir, Benjamin Chanudet, Bob Watson, George Kalpakas, Ikko Ashimine, Kristiyan Kostadinov, Marc Wrobel, Mariia Subkov, Pawel Kozlowski, Sebastian, abergquist, dario-piotrowicz, onrails and vyom1611\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.0.0-next.1\"></a>\n # 15.0.0-next.1 (2022-09-07)\n ## Breaking Changes\n\n\n###\n\n", "completion": "docs: release notes for the v14.2.2 release"}
{"prompt": " file path A: package.json | file path B: package.json\n\n@@ -207,7 +207,7 @@\n     \"minimist\": \"^1.2.0\",\n     \"multimatch\": \"^6.0.0\",\n     \"prettier\": \"^2.5.1\",\n-    \"sauce-connect\": \"https://saucelabs.com/downloads/sc-4.7.1-linux.tar.gz\",\n+    \"sauce-connect\": \"https://saucelabs.com/downloads/sc-4.8.1-linux.tar.gz\",\n     \"semver\": \"^7.3.5\",\n     \"send\": \"^0.18.0\",\n     \"ts-node\": \"^10.8.1\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -256,7 +256,6 @@\n \n \"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#f2a04c81f9cfbf8a86e595ca5d1ca1da50ddf9dd\":\n   version \"0.0.0-1c648b45459fa32ffd7de8a8fc07bde6bdbef923\"\n-  uid f2a04c81f9cfbf8a86e595ca5d1ca1da50ddf9dd\n   resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#f2a04c81f9cfbf8a86e595ca5d1ca1da50ddf9dd\"\n   dependencies:\n     \"@angular-devkit/build-angular\" \"14.2.0-rc.0\"\n@@ -364,7 +363,6 @@\n \n \"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#20aa4d8a5ec774e1f21fbc50bca511c229a1a7f8\":\n   version \"0.0.0-1c648b45459fa32ffd7de8a8fc07bde6bdbef923\"\n-  uid \"20aa4d8a5ec774e1f21fbc50bca511c229a1a7f8\"\n   resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#20aa4d8a5ec774e1f21fbc50bca511c229a1a7f8\"\n   dependencies:\n     \"@yarnpkg/lockfile\" \"^1.1.0\"\n@@ -13402,9 +13400,9 @@ sass@1.54.4:\n     immutable \"^4.0.0\"\n     source-map-js \">=0.6.2 <2.0.0\"\n \n-\"sauce-connect@https://saucelabs.com/downloads/sc-4.7.1-linux.tar.gz\":\n+\"sauce-connect@https://saucelabs.com/downloads/sc-4.8.1-linux.tar.gz\":\n   version \"0.0.0\"\n-  resolved \"https://saucelabs.com/downloads/sc-4.7.1-linux.tar.gz#e5d7f82ad98251a653d1b0537f1103e49eda5e11\"\n+  resolved \"https://saucelabs.com/downloads/sc-4.8.1-linux.tar.gz#9c16682e4c9716734432789884f868212f95f563\"\n \n saucelabs@7.2.0, saucelabs@^1.5.0, saucelabs@^4.6.3:\n   version \"7.2.0\"\n\n\n###\n\n", "completion": "build: update saucelabs connect version (#<issue-num>)"}
{"prompt": " file path A: goldens/size-tracking/integration-payloads.json | file path B: goldens/size-tracking/integration-payloads.json\n\n@@ -48,7 +48,7 @@\n   \"animations\": {\n     \"uncompressed\": {\n       \"runtime\": 1070,\n-      \"main\": 156225,\n+      \"main\": 156736,\n       \"polyfills\": 33814\n     }\n   },\n\n\n###\n\n", "completion": "ci: update payload size for Animations integration test (#<issue-num>)"}
{"prompt": " file path A: packages/animations/browser/src/dsl/animation_timeline_builder.ts | file path B: packages/animations/browser/src/dsl/animation_timeline_builder.ts\n\n@@ -183,11 +183,34 @@ export class AnimationTimelineBuilderVisitor implements AstVisitor {\n   visitAnimateRef(ast: AnimateRefAst, context: AnimationTimelineContext): any {\n     const innerContext = context.createSubContext(ast.options);\n     innerContext.transformIntoNewTimeline();\n+    this._applyAnimateRefDelay(ast.animation, context, innerContext);\n     this.visitReference(ast.animation, innerContext);\n     context.transformIntoNewTimeline(innerContext.currentTimeline.currentTime);\n     context.previousNode = ast;\n   }\n \n+  private _applyAnimateRefDelay(\n+      animation: ReferenceAst, context: AnimationTimelineContext,\n+      innerContext: AnimationTimelineContext) {\n+    const animationDelay = animation.options?.delay;\n+\n+    if (!animationDelay) {\n+      return;\n+    }\n+\n+    let animationDelayValue: number;\n+\n+    if (typeof animationDelay === 'string') {\n+      const interpolatedDelay =\n+          interpolateParams(animationDelay, animation.options?.params ?? {}, context.errors);\n+      animationDelayValue = resolveTimingValue(interpolatedDelay);\n+    } else {\n+      animationDelayValue = animationDelay;\n+    }\n+\n+    innerContext.delayNextStep(animationDelayValue);\n+  }\n+\n   private _visitSubInstructions(\n       instructions: AnimationTimelineInstruction[], context: AnimationTimelineContext,\n       options: AnimateChildOptions): number {\n\n---\n file path A: packages/core/test/animation/animation_integration_spec.ts | file path B: packages/core/test/animation/animation_integration_spec.ts\n\n@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {animate, animateChild, AnimationEvent, AnimationMetadata, AnimationOptions, AUTO_STYLE, group, keyframes, query, state, style, transition, trigger, \u0275PRE_STYLE as PRE_STYLE} from '@angular/animations';\n+import {animate, animateChild, animation, AnimationEvent, AnimationMetadata, AnimationOptions, AUTO_STYLE, group, keyframes, query, state, style, transition, trigger, useAnimation, \u0275PRE_STYLE as PRE_STYLE} from '@angular/animations';\n import {AnimationDriver, \u0275AnimationEngine, \u0275NoopAnimationDriver as NoopAnimationDriver} from '@angular/animations/browser';\n import {MockAnimationDriver, MockAnimationPlayer} from '@angular/animations/browser/testing';\n import {ChangeDetectorRef, Component, HostBinding, HostListener, Inject, RendererFactory2, ViewChild} from '@angular/core';\n@@ -3830,6 +3830,143 @@ describe('animation tests', function() {\n             /only state\\(\\) and transition\\(\\) definitions can sit inside of a trigger\\(\\)/);\n   });\n \n+  describe('animation and useAnimation functions', () => {\n+    it('should apply the delay specified in the animation', () => {\n+      const animationMetaData = animation(\n+          [\n+            style({color: 'red'}),\n+            animate(1000, style({color: 'green'})),\n+          ],\n+          {delay: 3000});\n+\n+      @Component({\n+        selector: 'cmp',\n+        template: `\n+         <div @anim *ngIf=\"exp\">\n+         </div>\n+       `,\n+        animations: [\n+          trigger('anim', [transition(\n+                              ':enter',\n+                              useAnimation(animationMetaData),\n+                              )]),\n+        ]\n+      })\n+      class Cmp {\n+        exp: boolean = false;\n+      }\n+\n+      TestBed.configureTestingModule({declarations: [Cmp]});\n+\n+      const engine = TestBed.inject(\u0275AnimationEngine);\n+      const fixture = TestBed.createComponent(Cmp);\n+      const cmp = fixture.componentInstance;\n+      cmp.exp = true;\n+\n+      fixture.detectChanges();\n+      engine.flush();\n+\n+      const players = getLog();\n+      expect(players.length).toEqual(1);\n+      const [player] = players;\n+      expect(player.delay).toEqual(3000);\n+      expect(player.duration).toEqual(1000);\n+      expect(player.keyframes).toEqual([\n+        new Map<string, string|number>([['color', 'red'], ['offset', 0]]),\n+        new Map<string, string|number>([['color', 'green'], ['offset', 1]]),\n+      ]);\n+    });\n+\n+    it('should apply the delay specified in the animation using params', () => {\n+      const animationMetaData = animation(\n+          [\n+            style({color: 'red'}),\n+            animate(500, style({color: 'green'})),\n+          ],\n+          {delay: '{{animationDelay}}ms', params: {animationDelay: 5500}});\n+\n+      @Component({\n+        selector: 'cmp',\n+        template: `\n+         <div @anim *ngIf=\"exp\">\n+         </div>\n+       `,\n+        animations: [\n+          trigger('anim', [transition(\n+                              ':enter',\n+                              useAnimation(animationMetaData),\n+                              )]),\n+        ]\n+      })\n+      class Cmp {\n+        exp: boolean = false;\n+      }\n+\n+      TestBed.configureTestingModule({declarations: [Cmp]});\n+\n+      const engine = TestBed.inject(\u0275AnimationEngine);\n+      const fixture = TestBed.createComponent(Cmp);\n+      const cmp = fixture.componentInstance;\n+      cmp.exp = true;\n+\n+      fixture.detectChanges();\n+      engine.flush();\n+\n+      const players = getLog();\n+      expect(players.length).toEqual(1);\n+      const [player] = players;\n+      expect(player.delay).toEqual(5500);\n+      expect(player.duration).toEqual(500);\n+      expect(player.keyframes).toEqual([\n+        new Map<string, string|number>([['color', 'red'], ['offset', 0]]),\n+        new Map<string, string|number>([['color', 'green'], ['offset', 1]]),\n+      ]);\n+    });\n+\n+    it('should combine the delay specified in the animation with that of the caller', () => {\n+      const animationMetaData = animation(\n+          [\n+            style({color: 'red'}),\n+            animate(500, style({color: 'green'})),\n+          ],\n+          {delay: 2000});\n+\n+      @Component({\n+        selector: 'cmp',\n+        template: `\n+         <div @anim *ngIf=\"exp\">\n+         </div>\n+       `,\n+        animations: [\n+          trigger('anim', [transition(':enter', useAnimation(animationMetaData), {delay: 750})]),\n+        ]\n+      })\n+      class Cmp {\n+        exp: boolean = false;\n+      }\n+\n+      TestBed.configureTestingModule({declarations: [Cmp]});\n+\n+      const engine = TestBed.inject(\u0275AnimationEngine);\n+      const fixture = TestBed.createComponent(Cmp);\n+      const cmp = fixture.componentInstance;\n+      cmp.exp = true;\n+\n+      fixture.detectChanges();\n+      engine.flush();\n+\n+      const players = getLog();\n+      expect(players.length).toEqual(1);\n+      const [player] = players;\n+      expect(player.delay).toEqual(2750);\n+      expect(player.duration).toEqual(500);\n+      expect(player.keyframes).toEqual([\n+        new Map<string, string|number>([['color', 'red'], ['offset', 0]]),\n+        new Map<string, string|number>([['color', 'green'], ['offset', 1]]),\n+      ]);\n+    });\n+  });\n+\n   it('should combine multiple errors together into one exception when an animation fails to be built',\n      () => {\n        @Component({\n\n\n###\n\n", "completion": "fix(animations): make sure that the animation function delay is applied (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/render3/interfaces/injector.ts | file path B: packages/core/src/render3/interfaces/injector.ts\n\n@@ -204,11 +204,11 @@ export class NodeInjectorFactory {\n    * If we have a component and directive active an a single element as declared here\n    * ```\n    * component:\n-   *   provides: [ {provide: String, useValue: 'component', multi: true} ],\n-   *   viewProvides: [ {provide: String, useValue: 'componentView', multi: true} ],\n+   *   providers: [ {provide: String, useValue: 'component', multi: true} ],\n+   *   viewProviders: [ {provide: String, useValue: 'componentView', multi: true} ],\n    *\n    * directive:\n-   *   provides: [ {provide: String, useValue: 'directive', multi: true} ],\n+   *   providers: [ {provide: String, useValue: 'directive', multi: true} ],\n    * ```\n    *\n    * Then the expected results are:\n@@ -231,23 +231,23 @@ export class NodeInjectorFactory {\n   index?: number;\n \n   /**\n-   * Because the same `multi` provider can be declared in `provides` and `viewProvides` it is\n-   * possible for `viewProvides` to shadow the `provides`. For this reason we store the\n+   * Because the same `multi` provider can be declared in `providers` and `viewProviders` it is\n+   * possible for `viewProviders` to shadow the `providers`. For this reason we store the\n    * `provideFactory` of the `providers` so that `providers` can be extended with `viewProviders`.\n    *\n    * Example:\n    *\n    * Given:\n    * ```\n-   * provides: [ {provide: String, useValue: 'all', multi: true} ],\n-   * viewProvides: [ {provide: String, useValue: 'viewOnly', multi: true} ],\n+   * providers: [ {provide: String, useValue: 'all', multi: true} ],\n+   * viewProviders: [ {provide: String, useValue: 'viewOnly', multi: true} ],\n    * ```\n    *\n    * We have to return `['all']` in case of content injection, but `['all', 'viewOnly']` in case\n    * of view injection. We further have to make sure that the shared instances (in our case\n    * `all`) are the exact same instance in both the content as well as the view injection. (We\n-   * have to make sure that we don't double instantiate.) For this reason the `viewProvides`\n-   * `Factory` has a pointer to the shadowed `provides` factory so that it can instantiate the\n+   * have to make sure that we don't double instantiate.) For this reason the `viewProviders`\n+   * `Factory` has a pointer to the shadowed `providers` factory so that it can instantiate the\n    * `providers` (`['all']`) and then extend it with `viewProviders` (`['all'] + ['viewOnly'] =\n    * ['all', 'viewOnly']`).\n    */\n\n\n###\n\n", "completion": "docs(core): fix viewProviders & providers typos in NodeInjectorFactory (#<issue-num>)"}
{"prompt": " file path A: aio/tools/examples/shared/boilerplate/cli-ajs/package.json | file path B: aio/tools/examples/shared/boilerplate/cli-ajs/package.json\n\n@@ -36,7 +36,7 @@\n     \"@types/angular-route\": \"^1.7.2\",\n     \"@types/jasmine\": \"~4.3.0\",\n     \"@types/node\": \"^16.11.35\",\n-    \"jasmine-core\": \"~4.3.0\",\n+    \"jasmine-core\": \"~4.4.0\",\n     \"jasmine-marbles\": \"~0.9.2\",\n     \"jasmine-spec-reporter\": \"~7.0.0\",\n     \"karma\": \"~6.4.0\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/cli/package.json | file path B: aio/tools/examples/shared/boilerplate/cli/package.json\n\n@@ -33,7 +33,7 @@\n     \"@types/jasmine\": \"~4.3.0\",\n     \"@types/node\": \"^16.11.35\",\n     \"copyfiles\": \"^2.4.1\",\n-    \"jasmine-core\": \"~4.3.0\",\n+    \"jasmine-core\": \"~4.4.0\",\n     \"jasmine-marbles\": \"~0.9.2\",\n     \"jasmine-spec-reporter\": \"~7.0.0\",\n     \"karma\": \"~6.4.0\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/elements/package.json | file path B: aio/tools/examples/shared/boilerplate/elements/package.json\n\n@@ -33,7 +33,7 @@\n     \"@angular/compiler-cli\": \"^14.2.0\",\n     \"@types/jasmine\": \"~4.3.0\",\n     \"@types/node\": \"^16.11.35\",\n-    \"jasmine-core\": \"~4.3.0\",\n+    \"jasmine-core\": \"~4.4.0\",\n     \"jasmine-marbles\": \"~0.9.2\",\n     \"jasmine-spec-reporter\": \"~7.0.0\",\n     \"karma\": \"~6.4.0\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/i18n/package.json | file path B: aio/tools/examples/shared/boilerplate/i18n/package.json\n\n@@ -35,7 +35,7 @@\n     \"@angular/compiler-cli\": \"^14.2.0\",\n     \"@types/jasmine\": \"~4.3.0\",\n     \"@types/node\": \"^16.11.35\",\n-    \"jasmine-core\": \"~4.3.0\",\n+    \"jasmine-core\": \"~4.4.0\",\n     \"jasmine-marbles\": \"~0.9.2\",\n     \"jasmine-spec-reporter\": \"~7.0.0\",\n     \"karma\": \"~6.4.0\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/service-worker/package.json | file path B: aio/tools/examples/shared/boilerplate/service-worker/package.json\n\n@@ -33,7 +33,7 @@\n     \"@angular/compiler-cli\": \"^14.2.0\",\n     \"@types/jasmine\": \"~4.3.0\",\n     \"@types/node\": \"^16.11.35\",\n-    \"jasmine-core\": \"~4.3.0\",\n+    \"jasmine-core\": \"~4.4.0\",\n     \"jasmine-marbles\": \"~0.9.2\",\n     \"jasmine-spec-reporter\": \"~7.0.0\",\n     \"karma\": \"~6.4.0\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/systemjs/package.json | file path B: aio/tools/examples/shared/boilerplate/systemjs/package.json\n\n@@ -54,7 +54,7 @@\n     \"@types/node\": \"^16.11.35\",\n     \"concurrently\": \"^7.0.0\",\n     \"http-server\": \"^14.0.0\",\n-    \"jasmine-core\": \"~4.3.0\",\n+    \"jasmine-core\": \"~4.4.0\",\n     \"karma\": \"~6.4.0\",\n     \"karma-chrome-launcher\": \"~3.1.0\",\n     \"karma-jasmine\": \"~5.1.0\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/universal/package.json | file path B: aio/tools/examples/shared/boilerplate/universal/package.json\n\n@@ -41,7 +41,7 @@\n     \"@types/express\": \"^4.17.13\",\n     \"@types/jasmine\": \"~4.3.0\",\n     \"@types/node\": \"^16.11.35\",\n-    \"jasmine-core\": \"~4.3.0\",\n+    \"jasmine-core\": \"~4.4.0\",\n     \"jasmine-marbles\": \"~0.9.2\",\n     \"jasmine-spec-reporter\": \"~7.0.0\",\n     \"karma\": \"~6.4.0\",\n\n---\n file path A: integration/bazel_workspace_tests/bazel_ngtsc_plugin/WORKSPACE | file path B: integration/bazel_workspace_tests/bazel_ngtsc_plugin/WORKSPACE\n\n@@ -12,10 +12,10 @@ http_archive(\n # Fetch sass rules for compiling sass files\n http_archive(\n     name = \"io_bazel_rules_sass\",\n-    sha256 = \"0ba1a6a4ec9c8ea122eabd8d6128b03fb37745a9f2027dbd1e1d732a8d966f23\",\n-    strip_prefix = \"rules_sass-1.54.8\",\n+    sha256 = \"2f239bf002419ee904e61b4fda278aefdf93bae29257f50052a515f2d100b6a3\",\n+    strip_prefix = \"rules_sass-1.54.9\",\n     urls = [\n-        \"https://github.com/bazelbuild/rules_sass/archive/1.54.8.zip\",\n+        \"https://github.com/bazelbuild/rules_sass/archive/1.54.9.zip\",\n     ],\n )\n \n\n\n###\n\n", "completion": "build: update all non-major dependencies (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/update-events.yml | file path B: .github/workflows/update-events.yml\n\n@@ -29,7 +29,7 @@ jobs:\n       - name: Generate `events.json`\n         run: node aio/scripts/generate-events/index.mjs --ignore-invalid-dates\n       - name: Create a PR (if necessary)\n-        uses: gkalpak/dev-infra/github-actions/create-pr-for-changes@88c198ae1a3462223cb5c1e83338e4b94b435283\n+        uses: angular/dev-infra/github-actions/create-pr-for-changes@bf4bb09bb2d32015f71943371c7484cb845f8c33\n         with:\n           branch-prefix: docs-update-events\n           pr-title: 'docs: update events'\n\n\n###\n\n", "completion": "build: use the `create-pr-for-changes` action from `angular/dev-infra` (#<issue-num>)"}
{"prompt": " file path A: packages/forms/src/form_builder.ts | file path B: packages/forms/src/form_builder.ts\n\n@@ -153,7 +153,7 @@ export class FormBuilder {\n \n   /**\n    * @description\n-   * Construct a new `FormGroup` instance. Accepts a single generic argument, which is an object\n+   * Constructs a new `FormGroup` instance. Accepts a single generic argument, which is an object\n    * containing all the keys and corresponding inner control types.\n    *\n    * @param controls A collection of child controls. The key for each child is the name\n@@ -173,7 +173,7 @@ export class FormBuilder {\n \n   /**\n    * @description\n-   * Construct a new `FormGroup` instance.\n+   * Constructs a new `FormGroup` instance.\n    *\n    * @deprecated This API is not typesafe and can result in issues with Closure Compiler renaming.\n    * Use the `FormBuilder#group` overload with `AbstractControlOptions` instead.\n@@ -217,7 +217,7 @@ export class FormBuilder {\n \n   /**\n    * @description\n-   * Construct a new `FormRecord` instance. Accepts a single generic argument, which is an object\n+   * Constructs a new `FormRecord` instance. Accepts a single generic argument, which is an object\n    * containing all the keys and corresponding inner control types.\n    *\n    * @param controls A collection of child controls. The key for each child is the name\n@@ -259,7 +259,7 @@ export class FormBuilder {\n \n   /**\n    * @description\n-   * Construct a new `FormControl` with the given state, validators and options. Set\n+   * Constructs a new `FormControl` with the given state, validators and options. Sets\n    * `{nonNullable: true}` in the options to get a non-nullable control. Otherwise, the\n    * control will be nullable. Accepts a single generic argument, which is the type  of the\n    * control's value.\n\n\n###\n\n", "completion": "docs(forms): correcting description verbs of formGroup methods  (#<issue-num>)"}
{"prompt": " file path A: .github/ISSUE_TEMPLATE/3-docs-bug.yaml | file path B: .github/ISSUE_TEMPLATE/3-docs-bug.yaml\n\n@@ -5,38 +5,54 @@ body:\n   - type: textarea\n     id: description\n     attributes:\n-      label: Description\n+      label: Describe the problem that you experienced\n     validations:\n       required: true\n \n   - type: input\n     id: affected-url\n     attributes:\n-      label: What is the affected URL?\n+      label: Enter the URL of the topic with the problem\n+\n+  - type: textarea\n+    id: documentation-goal\n+    attributes:\n+      label: Describe what you were looking for in the documentation\n \n   - type: textarea\n     id: reproduction-steps\n     attributes:\n-      label: Please provide the steps to reproduce the issue\n+      label: Describe the actions that led you to experience the problem\n \n   - type: textarea\n     id: expected-vs-actual-behavior\n     attributes:\n-      label: Please provide the expected behavior vs the actual behavior you encountered\n+      label: Describe what you want to experience that would fix the problem\n \n   - type: textarea\n     id: screenshot\n     attributes:\n-      label: Please provide a screenshot if possible\n+      label: Add a screenshot if that helps illustrate the problem\n \n   - type: textarea\n     id: exception-or-error\n     attributes:\n-      label: Please provide the exception or error you saw\n+      label: If this problem caused an exception or error, please paste it here\n       render: true\n+      placeholder: |\n+        ```\n+        Paste the exception or error here inside a markdown code block,\n+        which is annotated by three grave \\(&grave;\\) characters before and after the text block.\n+        ```\n \n   - type: textarea\n     id: browser-info\n     attributes:\n-      label: Is this a browser-specific issue? If so, please specify the device, browser, and version.\n+      label: If the problem is browser-specific, please specify the device, OS, browser, and version\n+      render: true\n+\n+  - type: textarea\n+    id: additional-info\n+    attributes:\n+      label: Provide any additional information here in as much as detail as you can\n       render: true\n\n\n###\n\n", "completion": "docs: update prompts in the doc issue template (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/i18n-common-translation-files.md | file path B: aio/content/guide/i18n-common-translation-files.md\n\n@@ -33,7 +33,7 @@ Use the following [`extract-i18n`][AioCliExtractI18n] command options to change\n | Command option  | Details |\n |:---             |:---     |\n | `--format`      | Set the format of the output file    |\n-| `--outFile`     | Set the name of the output file      |\n+| `--out-file`     | Set the name of the output file      |\n | `--output-path` | Set the path of the output directory |\n \n ### Change the source language file location\n@@ -74,7 +74,7 @@ The following example demonstrates several translation formats.\n \n ### Change the source language file name\n \n-To change the name of the source language file generated by the extraction tool, use the `--outFile` command option.\n+To change the name of the source language file generated by the extraction tool, use the `--out-file` command option.\n \n #### `extract-i18n --out-file` example\n \n\n\n###\n\n", "completion": "docs: replace deprecated --outFile option for ng extract-i18n (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/cheatsheet.md | file path B: aio/content/guide/cheatsheet.md\n\n@@ -72,8 +72,8 @@\n | Class field decorators for directives and components                                                                                                     | Details |\n |:---                                                                                                                                                      |:---     |\n | <code-example format=\"typescript\" hideCopy language=\"typescript\"> import { Input, &hellip; } from '&commat;angular/core'; </code-example>                | Import `Input, ...` from `@angular/core`.                                                                                                         |\n-| <code-example format=\"typescript\" hideCopy language=\"typescript\"> &commat;Input() myProperty; </code-example>                                            | Declares an input property that you can update using property binding \\(example: `&lt;my-cmp [myProperty]=\"someExpression\"&gt;`\\).                     |\n-| <code-example format=\"typescript\" hideCopy language=\"typescript\"> &commat;Output() myEvent = new EventEmitter(); </code-example>                         | Declares an output property that fires events that you can subscribe to with an event binding \\(example: `&lt;my-cmp (myEvent)=\"doSomething()\"&gt;`\\). |\n+| <code-example format=\"typescript\" hideCopy language=\"typescript\"> &commat;Input() myProperty; </code-example>                                            | Declares an input property that you can update using property binding \\(example: `<my-cmp [myProperty]=\"someExpression\">`\\).                     |\n+| <code-example format=\"typescript\" hideCopy language=\"typescript\"> &commat;Output() myEvent = new EventEmitter(); </code-example>                         | Declares an output property that fires events that you can subscribe to with an event binding \\(example: `<my-cmp (myEvent)=\"doSomething()\">`\\). |\n | <code-example format=\"typescript\" hideCopy language=\"typescript\"> &commat;HostBinding('class.valid') isValid; </code-example>                            | Binds a host element property \\(here, the CSS class `valid`\\) to a directive/component property \\(`isValid`\\).                                         |\n | <code-example format=\"typescript\" hideCopy language=\"typescript\"> &commat;HostListener('click', ['&dollar;event']) onClick(e) {&hellip;} </code-example> | Subscribes to a host element event \\(`click`\\) with a directive/component method \\(`onClick`\\), optionally passing an argument \\(`$event`\\).           |\n | <code-example format=\"typescript\" hideCopy language=\"typescript\"> &commat;ContentChild(myPredicate) myChildComponent; </code-example>                    | Binds the first result of the component content query \\(`myPredicate`\\) to a property \\(`myChildComponent`\\) of the class.                             |\n\n\n###\n\n", "completion": "docs: fix angle brackets in details code block (#<issue-num>)"}
{"prompt": " file path A: packages/compiler/src/schema/dom_security_schema.ts | file path B: packages/compiler/src/schema/dom_security_schema.ts\n\n@@ -35,10 +35,24 @@ export function SECURITY_SCHEMA(): {[k: string]: SecurityContext} {\n     registerContext(SecurityContext.STYLE, ['*|style']);\n     // NB: no SCRIPT contexts here, they are never allowed due to the parser stripping them.\n     registerContext(SecurityContext.URL, [\n-      '*|formAction', 'area|href',       'area|ping',       'audio|src',    'a|href',\n-      'a|ping',       'blockquote|cite', 'body|background', 'del|cite',     'form|action',\n-      'img|src',      'img|srcset',      'input|src',       'ins|cite',     'q|cite',\n-      'source|src',   'source|srcset',   'track|src',       'video|poster', 'video|src',\n+      '*|formAction',\n+      'area|href',\n+      'area|ping',\n+      'audio|src',\n+      'a|href',\n+      'a|ping',\n+      'blockquote|cite',\n+      'body|background',\n+      'del|cite',\n+      'form|action',\n+      'img|src',\n+      'input|src',\n+      'ins|cite',\n+      'q|cite',\n+      'source|src',\n+      'track|src',\n+      'video|poster',\n+      'video|src',\n     ]);\n     registerContext(SecurityContext.RESOURCE_URL, [\n       'applet|code',\n\n---\n file path A: packages/core/src/render3/i18n/i18n_parse.ts | file path B: packages/core/src/render3/i18n/i18n_parse.ts\n\n@@ -8,9 +8,9 @@\n import '../../util/ng_dev_mode';\n import '../../util/ng_i18n_closure_mode';\n \n-import {getTemplateContent, SRCSET_ATTRS, URI_ATTRS, VALID_ATTRS, VALID_ELEMENTS} from '../../sanitization/html_sanitizer';\n+import {getTemplateContent, URI_ATTRS, VALID_ATTRS, VALID_ELEMENTS} from '../../sanitization/html_sanitizer';\n import {getInertBodyHelper} from '../../sanitization/inert_body';\n-import {_sanitizeUrl, sanitizeSrcset} from '../../sanitization/url_sanitizer';\n+import {_sanitizeUrl} from '../../sanitization/url_sanitizer';\n import {assertDefined, assertEqual, assertGreaterThanOrEqual, assertOneOf, assertString} from '../../util/assert';\n import {CharCode} from '../../util/char_code';\n import {loadIcuContainerVisitor} from '../instructions/i18n_icu_container_visitor';\n@@ -624,9 +624,6 @@ function walkIcuTree(\n                 if (URI_ATTRS[lowerAttrName]) {\n                   generateBindingUpdateOpCodes(\n                       update, attr.value, newIndex, attr.name, 0, _sanitizeUrl);\n-                } else if (SRCSET_ATTRS[lowerAttrName]) {\n-                  generateBindingUpdateOpCodes(\n-                      update, attr.value, newIndex, attr.name, 0, sanitizeSrcset);\n                 } else {\n                   generateBindingUpdateOpCodes(update, attr.value, newIndex, attr.name, 0, null);\n                 }\n\n---\n file path A: packages/core/src/sanitization/html_sanitizer.ts | file path B: packages/core/src/sanitization/html_sanitizer.ts\n\n@@ -8,8 +8,9 @@\n \n import {TrustedHTML} from '../util/security/trusted_type_defs';\n import {trustedHTMLFromString} from '../util/security/trusted_types';\n+\n import {getInertBodyHelper, InertBodyHelper} from './inert_body';\n-import {_sanitizeUrl, sanitizeSrcset} from './url_sanitizer';\n+import {_sanitizeUrl} from './url_sanitizer';\n \n function tagSet(tags: string): {[k: string]: boolean} {\n   const res: {[k: string]: boolean} = {};\n@@ -64,14 +65,11 @@ export const VALID_ELEMENTS =\n // Attributes that have href and hence need to be sanitized\n export const URI_ATTRS = tagSet('background,cite,href,itemtype,longdesc,poster,src,xlink:href');\n \n-// Attributes that have special href set hence need to be sanitized\n-export const SRCSET_ATTRS = tagSet('srcset');\n-\n const HTML_ATTRS = tagSet(\n     'abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,' +\n     'compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,' +\n     'ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,' +\n-    'scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,' +\n+    'scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,' +\n     'valign,value,vspace,width');\n \n // Accessibility attributes as per WAI-ARIA 1.1 (W3C Working Draft 14 December 2018)\n@@ -92,7 +90,7 @@ const ARIA_ATTRS = tagSet(\n // can be sanitized, but they increase security surface area without a legitimate use case, so they\n // are left out here.\n \n-export const VALID_ATTRS = merge(URI_ATTRS, SRCSET_ATTRS, HTML_ATTRS, ARIA_ATTRS);\n+export const VALID_ATTRS = merge(URI_ATTRS, HTML_ATTRS, ARIA_ATTRS);\n \n // Elements whose content should not be traversed/preserved, if the elements themselves are invalid.\n //\n@@ -177,7 +175,6 @@ class SanitizingHtmlSerializer {\n       let value = elAttr!.value;\n       // TODO(martinprobst): Special case image URIs for data:image/...\n       if (URI_ATTRS[lower]) value = _sanitizeUrl(value);\n-      if (SRCSET_ATTRS[lower]) value = sanitizeSrcset(value);\n       this.buf.push(' ', attrName, '=\"', encodeEntities(value), '\"');\n     }\n     this.buf.push('>');\n\n---\n file path A: packages/core/src/sanitization/url_sanitizer.ts | file path B: packages/core/src/sanitization/url_sanitizer.ts\n\n@@ -45,8 +45,3 @@ export function _sanitizeUrl(url: string): string {\n \n   return 'unsafe:' + url;\n }\n-\n-export function sanitizeSrcset(srcset: string): string {\n-  srcset = String(srcset);\n-  return srcset.split(',').map((srcset) => _sanitizeUrl(srcset.trim())).join(', ');\n-}\n\n---\n file path A: packages/core/test/sanitization/html_sanitizer_spec.ts | file path B: packages/core/test/sanitization/html_sanitizer_spec.ts\n\n@@ -69,9 +69,15 @@ function sanitizeHtml(defaultDoc: any, unsafeHtmlInput: string): string {\n           .toEqual('<img src=\"pteranodon.jpg\" aria-details=\"details\">');\n     });\n \n-    it('sanitizes srcset attributes', () => {\n+    it('ignores srcset attributes', () => {\n+      // Modern browsers can handle `srcset` safely without any additional sanitization.\n       expect(sanitizeHtml(defaultDoc, '<img srcset=\"/foo.png 400px, javascript:evil() 23px\">'))\n-          .toEqual('<img srcset=\"/foo.png 400px, unsafe:javascript:evil() 23px\">');\n+          .toEqual('<img srcset=\"/foo.png 400px, javascript:evil() 23px\">');\n+\n+      // Verify that complex `srcset` with URLs that contain commas are retained as is.\n+      const content = '<img src=\"https://localhost/h_450,w_450/logo.jpg\" ' +\n+          'srcset=\"https://localhost/h_450,w_450/logo.jpg 450w, https://localhost/h_300,w_300/logo.jpg 300w\">';\n+      expect(sanitizeHtml(defaultDoc, content)).toEqual(content);\n     });\n \n     it('supports sanitizing plain text', () => {\n\n---\n file path A: packages/core/test/sanitization/url_sanitizer_spec.ts | file path B: packages/core/test/sanitization/url_sanitizer_spec.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {_sanitizeUrl, sanitizeSrcset} from '../../src/sanitization/url_sanitizer';\n+import {_sanitizeUrl} from '../../src/sanitization/url_sanitizer';\n \n {\n   describe('URL sanitizer', () => {\n@@ -71,42 +71,5 @@ import {_sanitizeUrl, sanitizeSrcset} from '../../src/sanitization/url_sanitizer\n         it(`valid ${url}`, () => expect(_sanitizeUrl(url)).toMatch(/^unsafe:/));\n       }\n     });\n-\n-    describe('valid srcsets', () => {\n-      const validSrcsets = [\n-        '',\n-        'http://angular.io/images/test.png',\n-        'http://angular.io/images/test.png, http://angular.io/images/test.png',\n-        'http://angular.io/images/test.png, http://angular.io/images/test.png, http://angular.io/images/test.png',\n-        'http://angular.io/images/test.png 2x',\n-        'http://angular.io/images/test.png 2x, http://angular.io/images/test.png 3x',\n-        'http://angular.io/images/test.png 1.5x',\n-        'http://angular.io/images/test.png 1.25x',\n-        'http://angular.io/images/test.png 200w, http://angular.io/images/test.png 300w',\n-        'https://angular.io/images/test.png, http://angular.io/images/test.png',\n-        'http://angular.io:80/images/test.png, http://angular.io:8080/images/test.png',\n-        'http://www.angular.io:80/images/test.png, http://www.angular.io:8080/images/test.png',\n-        'https://angular.io/images/test.png, https://angular.io/images/test.png',\n-        '//angular.io/images/test.png, //angular.io/images/test.png',\n-        '/images/test.png, /images/test.png',\n-        'images/test.png, images/test.png',\n-        'http://angular.io/images/test.png?12345, http://angular.io/images/test.png?12345',\n-        'http://angular.io/images/test.png?maxage, http://angular.io/images/test.png?maxage',\n-        'http://angular.io/images/test.png?maxage=234, http://angular.io/images/test.png?maxage=234',\n-      ];\n-      for (const srcset of validSrcsets) {\n-        it(`valid ${srcset}`, () => expect(sanitizeSrcset(srcset)).toEqual(srcset));\n-      }\n-    });\n-\n-    describe('invalid srcsets', () => {\n-      const invalidSrcsets = [\n-        'ht:tp://angular.io/images/test.png',\n-        'http://angular.io/images/test.png, ht:tp://angular.io/images/test.png',\n-      ];\n-      for (const srcset of invalidSrcsets) {\n-        it(`valid ${srcset}`, () => expect(sanitizeSrcset(srcset)).toMatch(/unsafe:/));\n-      }\n-    });\n   });\n }\n\n\n###\n\n", "completion": "refactor(common): drop unnecessary srcset sanitization (#<issue-num>)"}
{"prompt": " file path A: packages/forms/src/directives/ng_form.ts | file path B: packages/forms/src/directives/ng_form.ts\n\n@@ -298,7 +298,9 @@ export class NgForm extends ControlContainer implements Form, AfterViewInit {\n     (this as {submitted: boolean}).submitted = true;\n     syncPendingControls(this.form, this._directives);\n     this.ngSubmit.emit($event);\n-    return false;\n+    // Forms with `method=\"dialog\"` have some special behavior\n+    // that won't reload the page and that shouldn't be prevented.\n+    return ($event?.target as HTMLFormElement | null)?.method === 'dialog';\n   }\n \n   /**\n\n---\n file path A: packages/forms/src/directives/reactive_directives/form_group_directive.ts | file path B: packages/forms/src/directives/reactive_directives/form_group_directive.ts\n\n@@ -94,8 +94,8 @@ export class FormGroupDirective extends ControlContainer implements Form, OnChan\n   @Output() ngSubmit = new EventEmitter();\n \n   constructor(\n-      @Optional() @Self() @Inject(NG_VALIDATORS) private validators: (Validator|ValidatorFn)[],\n-      @Optional() @Self() @Inject(NG_ASYNC_VALIDATORS) private asyncValidators:\n+      @Optional() @Self() @Inject(NG_VALIDATORS) validators: (Validator|ValidatorFn)[],\n+      @Optional() @Self() @Inject(NG_ASYNC_VALIDATORS) asyncValidators:\n           (AsyncValidator|AsyncValidatorFn)[]) {\n     super();\n     this._setValidators(validators);\n@@ -271,7 +271,10 @@ export class FormGroupDirective extends ControlContainer implements Form, OnChan\n     (this as {submitted: boolean}).submitted = true;\n     syncPendingControls(this.form, this.directives);\n     this.ngSubmit.emit($event);\n-    return false;\n+    // Forms with `method=\"dialog\"` have some special behavior that won't reload the page and that\n+    // shouldn't be prevented. Note that we need to null check the `event` and the `target`, because\n+    // some internal apps call this method directly with the wrong arguments.\n+    return ($event?.target as HTMLFormElement | null)?.method === 'dialog';\n   }\n \n   /**\n\n---\n file path A: packages/forms/test/reactive_integration_spec.ts | file path B: packages/forms/test/reactive_integration_spec.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {\u0275getDOM as getDOM} from '@angular/common';\n-import {Component, Directive, forwardRef, Input, NgModule, OnDestroy, Type} from '@angular/core';\n+import {Component, Directive, ElementRef, forwardRef, Input, NgModule, OnDestroy, Type, ViewChild} from '@angular/core';\n import {ComponentFixture, fakeAsync, TestBed, tick} from '@angular/core/testing';\n import {AbstractControl, AsyncValidator, AsyncValidatorFn, COMPOSITION_BUFFER_MODE, ControlValueAccessor, DefaultValueAccessor, FormArray, FormBuilder, FormControl, FormControlDirective, FormControlName, FormGroup, FormGroupDirective, FormsModule, MaxValidator, MinLengthValidator, MinValidator, NG_ASYNC_VALIDATORS, NG_VALIDATORS, NG_VALUE_ACCESSOR, ReactiveFormsModule, Validator, Validators} from '@angular/forms';\n import {By} from '@angular/platform-browser/src/dom/debug/by';\n@@ -2114,6 +2114,20 @@ const ValueAccessorB = createControlValueAccessor('[cva-b]');\n           expect(passwordControl.value).toEqual('Carson', 'Expected value to change on submit.');\n           expect(passwordControl.valid).toBe(true, 'Expected validation to run on submit.');\n         });\n+\n+        it('should not prevent the default action on forms with method=\"dialog\"', fakeAsync(() => {\n+             if (typeof HTMLDialogElement === 'undefined') {\n+               return;\n+             }\n+\n+             const fixture = initTest(NativeDialogForm);\n+             fixture.detectChanges();\n+             tick();\n+             const event = dispatchEvent(fixture.componentInstance.form.nativeElement, 'submit');\n+             fixture.detectChanges();\n+\n+             expect(event.defaultPrevented).toBe(false);\n+           }));\n       });\n     });\n \n@@ -5437,3 +5451,17 @@ class MinMaxFormControlComp {\n   min: number|string = 1;\n   max: number|string = 10;\n }\n+\n+@Component({\n+  template: `\n+    <dialog open>\n+      <form #form method=\"dialog\" [formGroup]=\"formGroup\">\n+        <button>Submit</button>\n+      </form>\n+    </dialog>\n+  `\n+})\n+class NativeDialogForm {\n+  @ViewChild('form') form!: ElementRef<HTMLFormElement>;\n+  formGroup = new FormGroup({});\n+}\n\n---\n file path A: packages/forms/test/template_integration_spec.ts | file path B: packages/forms/test/template_integration_spec.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {CommonModule, \u0275getDOM as getDOM} from '@angular/common';\n-import {Component, Directive, forwardRef, Input, Type, ViewChild} from '@angular/core';\n+import {Component, Directive, ElementRef, forwardRef, Input, Type, ViewChild} from '@angular/core';\n import {ComponentFixture, fakeAsync, TestBed, tick, waitForAsync} from '@angular/core/testing';\n import {AbstractControl, AsyncValidator, COMPOSITION_BUFFER_MODE, ControlValueAccessor, FormControl, FormsModule, MaxLengthValidator, MaxValidator, MinLengthValidator, MinValidator, NG_ASYNC_VALIDATORS, NG_VALIDATORS, NG_VALUE_ACCESSOR, NgForm, NgModel, Validator} from '@angular/forms';\n import {By} from '@angular/platform-browser/src/dom/debug/by';\n@@ -1062,6 +1062,21 @@ import {NgModelCustomComp, NgModelCustomWrapper} from './value_accessor_integrat\n                      ['fired', 'fired'],\n                      'Expected ngModelChanges to fire again on submit if value changed.');\n            }));\n+\n+\n+        it('should not prevent the default action on forms with method=\"dialog\"', fakeAsync(() => {\n+             if (typeof HTMLDialogElement === 'undefined') {\n+               return;\n+             }\n+\n+             const fixture = initTest(NativeDialogForm);\n+             fixture.detectChanges();\n+             tick();\n+             const event = dispatchEvent(fixture.componentInstance.form.nativeElement, 'submit');\n+             fixture.detectChanges();\n+\n+             expect(event.defaultPrevented).toBe(false);\n+           }));\n       });\n \n       describe('ngFormOptions', () => {\n@@ -2932,3 +2947,17 @@ class NgModelNoMinMaxValidator {\n   max!: number;\n   @ViewChild('myDir') myDir: any;\n }\n+\n+@Component({\n+  selector: 'ng-model-nested',\n+  template: `\n+    <dialog open>\n+      <form #form method=\"dialog\">\n+        <button>Submit</button>\n+      </form>\n+    </dialog>\n+  `\n+})\n+class NativeDialogForm {\n+  @ViewChild('form') form!: ElementRef<HTMLFormElement>;\n+}\n\n---\n file path A: packages/platform-browser/testing/src/browser_util.ts | file path B: packages/platform-browser/testing/src/browser_util.ts\n\n@@ -97,10 +97,11 @@ export class BrowserDetection {\n \n export const browserDetection: BrowserDetection = BrowserDetection.setup();\n \n-export function dispatchEvent(element: any, eventType: any): void {\n+export function dispatchEvent(element: any, eventType: any): Event {\n   const evt: Event = getDOM().getDefaultDocument().createEvent('Event');\n   evt.initEvent(eventType, true, true);\n   getDOM().dispatchEvent(element, evt);\n+  return evt;\n }\n \n export function createMouseEvent(eventType: string): MouseEvent {\n\n\n###\n\n", "completion": "fix(forms): don't prevent default behavior for forms with method=\"dialog\" (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/what-is-angular/src/app/hello-world-bindings/hello-world-bindings.component.ts | file path B: aio/content/examples/what-is-angular/src/app/hello-world-bindings/hello-world-bindings.component.ts\n\n@@ -15,5 +15,4 @@ export class HelloWorldBindingsComponent {\n     alert(this.message);\n   }\n // #enddocregion\n-\n }\n\n\n###\n\n", "completion": "docs: Removed unnecessary blank line (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/index.md | file path B: goldens/public-api/common/index.md\n\n@@ -450,7 +450,7 @@ export class NgComponentOutlet implements OnChanges, OnDestroy {\n }\n \n // @public\n-export class NgForOf<T, U extends NgIterable<T> = NgIterable<T>> implements DoCheck {\n+class NgForOf<T, U extends NgIterable<T> = NgIterable<T>> implements DoCheck {\n     constructor(_viewContainer: ViewContainerRef, _template: TemplateRef<NgForOfContext<T, U>>, _differs: IterableDiffers);\n     ngDoCheck(): void;\n     set ngForOf(ngForOf: U & NgIterable<T> | undefined | null);\n@@ -464,6 +464,8 @@ export class NgForOf<T, U extends NgIterable<T> = NgIterable<T>> implements DoCh\n     // (undocumented)\n     static \u0275fac: i0.\u0275\u0275FactoryDeclaration<NgForOf<any, any>, never>;\n }\n+export { NgForOf as NgFor }\n+export { NgForOf }\n \n // @public (undocumented)\n export class NgForOfContext<T, U extends NgIterable<T> = NgIterable<T>> {\n\n---\n file path A: packages/common/src/common.ts | file path B: packages/common/src/common.ts\n\n@@ -20,7 +20,7 @@ export {registerLocaleData} from './i18n/locale_data';\n export {Plural, NumberFormatStyle, FormStyle, Time, TranslationWidth, FormatWidth, NumberSymbol, WeekDay, getNumberOfCurrencyDigits, getCurrencySymbol, getLocaleDayPeriods, getLocaleDayNames, getLocaleMonthNames, getLocaleId, getLocaleEraNames, getLocaleWeekEndRange, getLocaleFirstDayOfWeek, getLocaleDateFormat, getLocaleDateTimeFormat, getLocaleExtraDayPeriodRules, getLocaleExtraDayPeriods, getLocalePluralCase, getLocaleTimeFormat, getLocaleNumberSymbol, getLocaleNumberFormat, getLocaleCurrencyCode, getLocaleCurrencyName, getLocaleCurrencySymbol, getLocaleDirection} from './i18n/locale_data_api';\n export {parseCookieValue as \u0275parseCookieValue} from './cookie';\n export {CommonModule} from './common_module';\n-export {NgClass, NgForOf, NgForOfContext, NgIf, NgIfContext, NgPlural, NgPluralCase, NgStyle, NgSwitch, NgSwitchCase, NgSwitchDefault, NgTemplateOutlet, NgComponentOutlet} from './directives/index';\n+export {NgClass, NgFor, NgForOf, NgForOfContext, NgIf, NgIfContext, NgPlural, NgPluralCase, NgStyle, NgSwitch, NgSwitchCase, NgSwitchDefault, NgTemplateOutlet, NgComponentOutlet} from './directives/index';\n export {DOCUMENT} from './dom_tokens';\n export {AsyncPipe, DatePipe, DATE_PIPE_DEFAULT_TIMEZONE, I18nPluralPipe, I18nSelectPipe, JsonPipe, LowerCasePipe, CurrencyPipe, DecimalPipe, PercentPipe, SlicePipe, UpperCasePipe, TitleCasePipe, KeyValuePipe, KeyValue} from './pipes/index';\n export {PLATFORM_BROWSER_ID as \u0275PLATFORM_BROWSER_ID, PLATFORM_SERVER_ID as \u0275PLATFORM_SERVER_ID, PLATFORM_WORKER_APP_ID as \u0275PLATFORM_WORKER_APP_ID, PLATFORM_WORKER_UI_ID as \u0275PLATFORM_WORKER_UI_ID, isPlatformBrowser, isPlatformServer, isPlatformWorkerApp, isPlatformWorkerUi} from './platform_id';\n\n---\n file path A: packages/common/src/directives/index.ts | file path B: packages/common/src/directives/index.ts\n\n@@ -7,9 +7,10 @@\n  */\n \n import {Provider} from '@angular/core';\n+\n import {NgClass} from './ng_class';\n import {NgComponentOutlet} from './ng_component_outlet';\n-import {NgForOf, NgForOfContext} from './ng_for_of';\n+import {NgFor, NgForOf, NgForOfContext} from './ng_for_of';\n import {NgIf, NgIfContext} from './ng_if';\n import {NgPlural, NgPluralCase} from './ng_plural';\n import {NgStyle} from './ng_style';\n@@ -19,6 +20,7 @@ import {NgTemplateOutlet} from './ng_template_outlet';\n export {\n   NgClass,\n   NgComponentOutlet,\n+  NgFor,\n   NgForOf,\n   NgForOfContext,\n   NgIf,\n\n---\n file path A: packages/common/src/directives/ng_for_of.ts | file path B: packages/common/src/directives/ng_for_of.ts\n\n@@ -290,6 +290,11 @@ export class NgForOf<T, U extends NgIterable<T> = NgIterable<T>> implements DoCh\n   }\n }\n \n+// Also export the `NgForOf` class as `NgFor` to improve the DX for\n+// cases when the directive is used as standalone, so the class name\n+// matches the CSS selector (*ngFor).\n+export {NgForOf as NgFor};\n+\n function applyViewChange<T>(\n     view: EmbeddedViewRef<NgForOfContext<T>>, record: IterableChangeRecord<T>) {\n   view.context.$implicit = record.item;\n\n---\n file path A: packages/common/test/directives/ng_for_spec.ts | file path B: packages/common/test/directives/ng_for_spec.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {CommonModule, NgForOf} from '@angular/common';\n+import {CommonModule, NgFor, NgForOf} from '@angular/common';\n import {Component} from '@angular/core';\n import {ComponentFixture, TestBed, waitForAsync} from '@angular/core/testing';\n import {By} from '@angular/platform-browser/src/dom/debug/by';\n@@ -408,6 +408,25 @@ let thisArg: any;\n \n       expect(fixture.nativeElement.textContent).toBe('1|2|3|');\n     });\n+\n+    it('should be available as a standalone directive using an `NgFor` alias', () => {\n+      @Component({\n+        selector: 'test-component',\n+        imports: [NgFor],\n+        template: `\n+          <ng-container *ngFor=\"let item of items\">{{ item }}|</ng-container>\n+        `,\n+        standalone: true,\n+      })\n+      class TestComponent {\n+        items = [1, 2, 3];\n+      }\n+\n+      const fixture = TestBed.createComponent(TestComponent);\n+      fixture.detectChanges();\n+\n+      expect(fixture.nativeElement.textContent).toBe('1|2|3|');\n+    });\n   });\n }\n \n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/extended/checks/missing_control_flow_directive/index.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/extended/checks/missing_control_flow_directive/index.ts\n\n@@ -24,7 +24,7 @@ import {TemplateCheckFactory, TemplateCheckWithVisitor, TemplateContext} from '.\n  * `CommonModule` is included, the `ngSwitch` would also be covered.\n  */\n export const KNOWN_CONTROL_FLOW_DIRECTIVES = new Map([\n-  ['ngIf', 'NgIf'], ['ngFor', 'NgForOf'], ['ngSwitchCase', 'NgSwitchCase'],\n+  ['ngIf', 'NgIf'], ['ngFor', 'NgFor'], ['ngSwitchCase', 'NgSwitchCase'],\n   ['ngSwitchDefault', 'NgSwitchDefault']\n ]);\n \n\n---\n file path A: packages/core/src/render3/instructions/element_validation.ts | file path B: packages/core/src/render3/instructions/element_validation.ts\n\n@@ -282,7 +282,7 @@ function getTemplateLocationDetails(lView: LView): string {\n  * that the `CommonModule` should also be included.\n  */\n export const KNOWN_CONTROL_FLOW_DIRECTIVES = new Map([\n-  ['ngIf', 'NgIf'], ['ngFor', 'NgForOf'], ['ngSwitchCase', 'NgSwitchCase'],\n+  ['ngIf', 'NgIf'], ['ngFor', 'NgFor'], ['ngSwitchCase', 'NgSwitchCase'],\n   ['ngSwitchDefault', 'NgSwitchDefault']\n ]);\n /**\n\n\n###\n\n", "completion": "refactor(common): create an `NgFor` alias for `NgForOf` directive (#<issue-num>)"}
{"prompt": " file path A: aio/src/app/app.component.ts | file path B: aio/src/app/app.component.ts\n\n@@ -54,7 +54,7 @@ export class AppComponent implements OnInit {\n    */\n   pageId: string;\n   /**\n-   * An HTML friendly identifer for the \"folder\" of the currently displayed page.\n+   * An HTML friendly identifier for the \"folder\" of the currently displayed page.\n    * This is computed by taking everything up to the first `/` in the `currentDocument.id`\n    */\n   folderId: string;\n\n\n###\n\n", "completion": "docs: fix typo in app.component.ts (#<issue-num>)"}
{"prompt": " file path A: aio/aio-builds-setup/dockerbuild/Dockerfile | file path B: aio/aio-builds-setup/dockerbuild/Dockerfile\n\n@@ -40,7 +40,7 @@ ARG      AIO_TRUSTED_PR_LABEL=\"aio: preview\"\n ARG TEST_AIO_TRUSTED_PR_LABEL=$AIO_TRUSTED_PR_LABEL\n ARG      AIO_PREVIEW_SERVER_HOSTNAME=preview.localhost\n ARG TEST_AIO_PREVIEW_SERVER_HOSTNAME=$AIO_PREVIEW_SERVER_HOSTNAME\n-ARG      AIO_ARTIFACT_MAX_SIZE=26214400\n+ARG      AIO_ARTIFACT_MAX_SIZE=36700160\n ARG TEST_AIO_ARTIFACT_MAX_SIZE=200\n ARG      AIO_PREVIEW_SERVER_PORT=3000\n ARG TEST_AIO_PREVIEW_SERVER_PORT=3001\n\n\n###\n\n", "completion": "docs: increase aio-preview size limit (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/render3/di.ts | file path B: packages/core/src/render3/di.ts\n\n@@ -334,7 +334,7 @@ export function injectAttributeImpl(tNode: TNode, attrNameToInject: string): str\n \n function notFoundValueOrThrow<T>(\n     notFoundValue: T|null, token: ProviderToken<T>, flags: InjectFlags): T|null {\n-  if (flags & InjectFlags.Optional) {\n+  if ((flags & InjectFlags.Optional) || notFoundValue !== undefined) {\n     return notFoundValue;\n   } else {\n     throwProviderNotFoundError(token, 'NodeInjector');\n@@ -352,7 +352,7 @@ function notFoundValueOrThrow<T>(\n  */\n function lookupTokenUsingModuleInjector<T>(\n     lView: LView, token: ProviderToken<T>, flags: InjectFlags, notFoundValue?: any): T|null {\n-  if (flags & InjectFlags.Optional && notFoundValue === undefined) {\n+  if ((flags & InjectFlags.Optional) && notFoundValue === undefined) {\n     // This must be set or the NullInjector will throw for optional deps\n     notFoundValue = null;\n   }\n\n---\n file path A: packages/core/test/acceptance/di_spec.ts | file path B: packages/core/test/acceptance/di_spec.ts\n\n@@ -1025,6 +1025,24 @@ describe('di', () => {\n           const dirC = fixture.componentInstance.dirC;\n           expect(dirC.dirB).toBeNull();\n         });\n+\n+        it('should imply @Optional in presence of a default value', () => {\n+          const NON_EXISTING_PROVIDER = new InjectionToken<string>('non-existing');\n+\n+          @Component({template: ''})\n+          class MyComp {\n+            value: string|undefined;\n+            constructor(injector: Injector) {\n+              this.value = injector.get(NON_EXISTING_PROVIDER, 'default', InjectFlags.Host);\n+            }\n+          }\n+\n+          const injector = Injector.create({providers: []});\n+          expect(injector.get(NON_EXISTING_PROVIDER, 'default', InjectFlags.Host)).toBe('default');\n+\n+          const fixture = TestBed.createComponent(MyComp);\n+          expect(fixture.componentInstance.value).toBe('default');\n+        });\n       });\n \n       it('should check only the current node with @Self', () => {\n\n\n###\n\n", "completion": "fix(core): imply @Optional flag when a default value is provided (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/typescript-configuration.md | file path B: aio/content/guide/typescript-configuration.md\n\n@@ -148,7 +148,7 @@ For instance, to install typings for `chai` you run `npm install @types/chai --s\n \n ### `target`\n \n-By default, the target is `es2017`, which is supported in modern browsers.\n+By default, the target is `es2020`, which is supported in modern browsers.\n \n <!-- links -->\n \n\n\n###\n\n", "completion": "docs: updates es version based on issue #47335 (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/accessibility.md | file path B: aio/content/guide/accessibility.md\n\n@@ -169,8 +169,8 @@ Books\n \n <!-- vale Angular.Google_Quotes = NO -->\n \n-*   \"A Web for Everyone: Designing Accessible User Experiences\", Sarah Horton and Whitney Quesenbery\n-*   \"Inclusive Design Patterns\", Heydon Pickering\n+*   \"A Web for Everyone: Designing Accessible User Experiences,\" Sarah Horton and Whitney Quesenbery\n+*   \"Inclusive Design Patterns,\" Heydon Pickering\n \n <!-- vale Angular.Google_Quotes = YES -->\n \n\n\n###\n\n", "completion": "docs: fix linter errors for accessibility page (#<issue-num>)"}
{"prompt": " file path A: docs/BAZEL.md | file path B: docs/BAZEL.md\n\n@@ -239,7 +239,7 @@ yarn bazel analyze-profile filename_name.profile --html --html_details --html_hi\n \n This will generate a `filename_name.profile.html` file that you can open in your browser.\n \n-In the upper right corner that is a small table of contents with links to three areas: Tasks, Legend and Statistics.\n+In the upper right corner that is a small table of contents with links to three areas: Tasks, Legend, and Statistics.\n \n In the Tasks section you will find a graph of where time is spent. Legend shows what the colors in the Tasks graph mean.\n Hovering over the background will show what phase that is, while hovering over bars will show more details about that specific action.\n\n---\n file path A: docs/CODING_STANDARDS.md | file path B: docs/CODING_STANDARDS.md\n\n@@ -82,7 +82,7 @@ Avoid `any` where possible. If you find yourself using `any`, consider whether a\n \n #### Getters and Setters\n \n-Getters and setters introduce openings for side-effects, add more complexity for code readers,\n+Getters and setters introduce openings for side effects, add more complexity for code readers,\n and generate additional code when targeting older browsers.\n \n * Only use getters and setters for `@Input` properties or when otherwise required for API\n\n---\n file path A: docs/DEVELOPER.md | file path B: docs/DEVELOPER.md\n\n@@ -146,8 +146,8 @@ $ yarn lint\n ## Publishing Snapshot Builds\n \n When a build of any branch on the upstream fork angular/angular is green on CircleCI, it\n-automatically publishes build artifacts to repositories in the Angular org, for example, the `@angular/core`\n-package is published to https://github.com/angular/core-builds.\n+automatically publishes build artifacts to repositories in the Angular org. For example,\n+the `@angular/core` package is published to https://github.com/angular/core-builds.\n \n You may find that your un-merged change needs some validation from external participants.\n Rather than requiring them to pull your Pull Request and build Angular locally, they can depend on\n\n---\n file path A: docs/PUBLIC_API.md | file path B: docs/PUBLIC_API.md\n\n@@ -15,7 +15,7 @@ Our semver, timed-release cycle and deprecation policy currently applies to thes\n - `@angular/service-worker`\n \n \n-One intentional omission from this list is `@angular/compiler`, which is currently considered a low level api and is subject to internal changes. These changes will not affect any applications or libraries using the higher-level apis (the command line interface or JIT compilation via `@angular/platform-browser-dynamic`). Only very specific use-cases require direct access to the compiler API (mostly tooling integration for IDEs, linters, etc). If you are working on this kind of integration, please reach out to us first.\n+One intentional omission from this list is `@angular/compiler`, which is currently considered a low level API and is subject to internal changes. These changes will not affect any applications or libraries using the higher-level APIs (the command line interface or JIT compilation via `@angular/platform-browser-dynamic`). Only very specific use-cases, such as tooling integration for IDEs and linters, require direct access to the compiler API. If you are working on this kind of integration, please reach out to us first.\n \n Package `@angular/bazel` is currently an Angular Labs project and not covered by the public API guarantees.\n \n\n\n###\n\n", "completion": "docs: fix minor typos in various documentations (#<issue-num>) (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,24 @@\n+<a name=\"14.2.1\"></a>\n+# 14.2.1 (2022-09-07)\n+### common\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [c0d7ac9ec2](https://github.com/angular/angular/commit/c0d7ac9ec2df9af36d80382bc70c4580720f35a3) | fix | improve formatting of image warnings ([#47299](https://github.com/angular/angular/pull/47299)) |\n+| [1875ce520a](https://github.com/angular/angular/commit/1875ce520afe7b5c55680b8c6a938a2331dda599) | fix | use DOCUMENT token to query for preconnect links ([#47353](https://github.com/angular/angular/pull/47353)) |\n+### compiler\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [0e35829580](https://github.com/angular/angular/commit/0e3582958079f798a75240873aebf3c4f5e3df5b) | fix | avoid errors for inputs with Object-builtin names ([#47220](https://github.com/angular/angular/pull/47220)) |\n+### service-worker\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [6091786696](https://github.com/angular/angular/commit/60917866961b7ab80ec9637c72300f2707aadd09) | fix | include headers in requests for assets ([#47260](https://github.com/angular/angular/pull/47260)) |\n+| [28d33505fd](https://github.com/angular/angular/commit/28d33505fd4be00eaf4bf417cd27e20733ddfb80) | fix | only consider GET requests as navigation requests ([#47263](https://github.com/angular/angular/pull/47263)) |\n+## Special Thanks\n+Aristeidis Bampakos, Asaf M, Bingo's Code, Bob Watson, Daniel Ostrovsky, George Kalpakas, Giovanni Alberto Rivas, Jeremy Elbourn, Jobayer Hossain, Joe Martin (Crowdstaffing), Joey Perrott, JoostK, Kara Erickson, Kristiyan Kostadinov, Maina Wycliffe, Sabareesh Kappagantu, Simona Cotin, Sonu Sindhu, Yann Provoost, abergquist, jaybell and vyom1611\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"15.0.0-next.0\"></a>\n ### router\n | Commit | Type | Description |\n\n\n###\n\n", "completion": "docs: release notes for the v14.2.1 release"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/typecheck/src/type_check_block.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/src/type_check_block.ts\n\n@@ -864,7 +864,7 @@ class TcbDomSchemaCheckerOp extends TcbOp {\n       if (binding.type === BindingType.Property) {\n         if (binding.name !== 'style' && binding.name !== 'class') {\n           // A direct binding to a property.\n-          const propertyName = ATTR_TO_PROP[binding.name] || binding.name;\n+          const propertyName = ATTR_TO_PROP.get(binding.name) ?? binding.name;\n           this.tcb.domSchemaChecker.checkProperty(\n               this.tcb.id, this.element, propertyName, binding.sourceSpan, this.tcb.schemas,\n               this.tcb.hostIsStandalone);\n@@ -880,14 +880,14 @@ class TcbDomSchemaCheckerOp extends TcbOp {\n  * Mapping between attributes names that don't correspond to their element property names.\n  * Note: this mapping has to be kept in sync with the equally named mapping in the runtime.\n  */\n-const ATTR_TO_PROP: {[name: string]: string} = {\n+const ATTR_TO_PROP = new Map(Object.entries({\n   'class': 'className',\n   'for': 'htmlFor',\n   'formaction': 'formAction',\n   'innerHtml': 'innerHTML',\n   'readonly': 'readOnly',\n   'tabindex': 'tabIndex',\n-};\n+}));\n \n /**\n  * A `TcbOp` which generates code to check \"unclaimed inputs\" - bindings on an element which were\n@@ -930,7 +930,7 @@ class TcbUnclaimedInputsOp extends TcbOp {\n             elId = this.scope.resolve(this.element);\n           }\n           // A direct binding to a property.\n-          const propertyName = ATTR_TO_PROP[binding.name] || binding.name;\n+          const propertyName = ATTR_TO_PROP.get(binding.name) ?? binding.name;\n           const prop = ts.factory.createElementAccessExpression(\n               elId, ts.factory.createStringLiteral(propertyName));\n           const stmt = ts.factory.createBinaryExpression(\n\n---\n file path A: packages/compiler-cli/test/ngtsc/ngtsc_spec.ts | file path B: packages/compiler-cli/test/ngtsc/ngtsc_spec.ts\n\n@@ -3669,6 +3669,24 @@ function allTests(os: string) {\n       expect(trim(jsContents)).toContain(trim(hostBindingsFn));\n     });\n \n+    // https://github.com/angular/angular/issues/46936\n+    it('should support bindings with Object builtin names', () => {\n+      env.write('test.ts', `\n+        import {Component} from '@angular/core';\n+\n+        @Component({\n+          selector: 'test-cmp',\n+          template: '<div [valueOf]=\"123\"></div>',\n+        })\n+        export class TestCmp {}\n+    `);\n+\n+      const errors = env.driveDiagnostics();\n+      expect(errors.length).toBe(1);\n+      expect(errors[0].messageText)\n+          .toContain(`Can't bind to 'valueOf' since it isn't a known property of 'div'.`);\n+    });\n+\n     it('should handle $any used inside a listener', () => {\n       env.write('test.ts', `\n         import {Component} from '@angular/core';\n\n---\n file path A: packages/compiler/src/schema/dom_element_schema_registry.ts | file path B: packages/compiler/src/schema/dom_element_schema_registry.ts\n\n@@ -7,7 +7,6 @@\n  */\n \n import {CUSTOM_ELEMENTS_SCHEMA, NO_ERRORS_SCHEMA, SchemaMetadata, SecurityContext} from '../core';\n-\n import {isNgContainer, isNgContent} from '../ml_parser/tags';\n import {dashCaseToCamelCase} from '../util';\n \n@@ -232,46 +231,46 @@ const SCHEMA: string[] = [\n   ':svg:cursor^:svg:|',\n ];\n \n-const _ATTR_TO_PROP: {[name: string]: string} = {\n+const _ATTR_TO_PROP = new Map(Object.entries({\n   'class': 'className',\n   'for': 'htmlFor',\n   'formaction': 'formAction',\n   'innerHtml': 'innerHTML',\n   'readonly': 'readOnly',\n   'tabindex': 'tabIndex',\n-};\n+}));\n \n // Invert _ATTR_TO_PROP.\n-const _PROP_TO_ATTR: {[name: string]: string} =\n-    Object.keys(_ATTR_TO_PROP).reduce((inverted, attr) => {\n-      inverted[_ATTR_TO_PROP[attr]] = attr;\n+const _PROP_TO_ATTR =\n+    Array.from(_ATTR_TO_PROP).reduce((inverted, [propertyName, attributeName]) => {\n+      inverted.set(propertyName, attributeName);\n       return inverted;\n-    }, {} as {[prop: string]: string});\n+    }, new Map<string, string>());\n \n export class DomElementSchemaRegistry extends ElementSchemaRegistry {\n-  private _schema: {[element: string]: {[property: string]: string}} = {};\n+  private _schema = new Map<string, Map<string, string>>();\n   // We don't allow binding to events for security reasons. Allowing event bindings would almost\n   // certainly introduce bad XSS vulnerabilities. Instead, we store events in a separate schema.\n-  private _eventSchema: {[element: string]: Set<string>} = {};\n+  private _eventSchema = new Map<string, Set<string>>;\n \n   constructor() {\n     super();\n     SCHEMA.forEach(encodedType => {\n-      const type: {[property: string]: string} = {};\n+      const type = new Map<string, string>();\n       const events: Set<string> = new Set();\n       const [strType, strProperties] = encodedType.split('|');\n       const properties = strProperties.split(',');\n       const [typeNames, superName] = strType.split('^');\n       typeNames.split(',').forEach(tag => {\n-        this._schema[tag.toLowerCase()] = type;\n-        this._eventSchema[tag.toLowerCase()] = events;\n+        this._schema.set(tag.toLowerCase(), type);\n+        this._eventSchema.set(tag.toLowerCase(), events);\n       });\n-      const superType = superName && this._schema[superName.toLowerCase()];\n+      const superType = superName && this._schema.get(superName.toLowerCase());\n       if (superType) {\n-        Object.keys(superType).forEach((prop: string) => {\n-          type[prop] = superType[prop];\n-        });\n-        for (const superEvent of this._eventSchema[superName.toLowerCase()]) {\n+        for (const [prop, value] of superType) {\n+          type.set(prop, value);\n+        }\n+        for (const superEvent of this._eventSchema.get(superName.toLowerCase())!) {\n           events.add(superEvent);\n         }\n       }\n@@ -282,16 +281,16 @@ export class DomElementSchemaRegistry extends ElementSchemaRegistry {\n               events.add(property.substring(1));\n               break;\n             case '!':\n-              type[property.substring(1)] = BOOLEAN;\n+              type.set(property.substring(1), BOOLEAN);\n               break;\n             case '#':\n-              type[property.substring(1)] = NUMBER;\n+              type.set(property.substring(1), NUMBER);\n               break;\n             case '%':\n-              type[property.substring(1)] = OBJECT;\n+              type.set(property.substring(1), OBJECT);\n               break;\n             default:\n-              type[property] = STRING;\n+              type.set(property, STRING);\n           }\n         }\n       });\n@@ -315,8 +314,9 @@ export class DomElementSchemaRegistry extends ElementSchemaRegistry {\n       }\n     }\n \n-    const elementProperties = this._schema[tagName.toLowerCase()] || this._schema['unknown'];\n-    return !!elementProperties[propName];\n+    const elementProperties =\n+        this._schema.get(tagName.toLowerCase()) || this._schema.get('unknown')!;\n+    return elementProperties.has(propName);\n   }\n \n   override hasElement(tagName: string, schemaMetas: SchemaMetadata[]): boolean {\n@@ -335,7 +335,7 @@ export class DomElementSchemaRegistry extends ElementSchemaRegistry {\n       }\n     }\n \n-    return !!this._schema[tagName.toLowerCase()];\n+    return this._schema.has(tagName.toLowerCase());\n   }\n \n   /**\n@@ -368,7 +368,7 @@ export class DomElementSchemaRegistry extends ElementSchemaRegistry {\n   }\n \n   override getMappedPropName(propName: string): string {\n-    return _ATTR_TO_PROP[propName] || propName;\n+    return _ATTR_TO_PROP.get(propName) ?? propName;\n   }\n \n   override getDefaultComponentElementName(): string {\n@@ -398,17 +398,18 @@ export class DomElementSchemaRegistry extends ElementSchemaRegistry {\n   }\n \n   override allKnownElementNames(): string[] {\n-    return Object.keys(this._schema);\n+    return Array.from(this._schema.keys());\n   }\n \n   allKnownAttributesOfElement(tagName: string): string[] {\n-    const elementProperties = this._schema[tagName.toLowerCase()] || this._schema['unknown'];\n+    const elementProperties =\n+        this._schema.get(tagName.toLowerCase()) || this._schema.get('unknown')!;\n     // Convert properties to attributes.\n-    return Object.keys(elementProperties).map(prop => _PROP_TO_ATTR[prop] ?? prop);\n+    return Array.from(elementProperties.keys()).map(prop => _PROP_TO_ATTR.get(prop) ?? prop);\n   }\n \n   allKnownEventsOfElement(tagName: string): string[] {\n-    return Array.from(this._eventSchema[tagName.toLowerCase()] ?? []);\n+    return Array.from(this._eventSchema.get(tagName.toLowerCase()) ?? []);\n   }\n \n   override normalizeAnimationStyleProperty(propName: string): string {\n\n\n###\n\n", "completion": "fix(compiler): avoid errors for inputs with Object-builtin names (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/diagnostics/index.ts | file path B: packages/compiler-cli/src/ngtsc/diagnostics/index.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n export {COMPILER_ERRORS_WITH_GUIDES} from './src/docs';\n-export {FatalDiagnosticError, isFatalDiagnosticError, makeDiagnostic, makeDiagnosticChain, makeRelatedInformation} from './src/error';\n+export {addDiagnosticChain, FatalDiagnosticError, isFatalDiagnosticError, makeDiagnostic, makeDiagnosticChain, makeRelatedInformation} from './src/error';\n export {ErrorCode} from './src/error_code';\n export {ERROR_DETAILS_PAGE_BASE_URL} from './src/error_details_base_url';\n export {ExtendedTemplateDiagnosticName} from './src/extended_template_diagnostic_name';\n\n---\n file path A: packages/compiler-cli/src/ngtsc/diagnostics/src/error.ts | file path B: packages/compiler-cli/src/ngtsc/diagnostics/src/error.ts\n\n@@ -65,6 +65,22 @@ export function makeRelatedInformation(\n   };\n }\n \n+export function addDiagnosticChain(\n+    messageText: string|ts.DiagnosticMessageChain,\n+    add: ts.DiagnosticMessageChain[]): ts.DiagnosticMessageChain {\n+  if (typeof messageText === 'string') {\n+    return makeDiagnosticChain(messageText, add);\n+  }\n+\n+  if (messageText.next === undefined) {\n+    messageText.next = add;\n+  } else {\n+    messageText.next.push(...add);\n+  }\n+\n+  return messageText;\n+}\n+\n export function isFatalDiagnosticError(err: any): err is FatalDiagnosticError {\n   return err._isFatalDiagnosticError === true;\n }\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/diagnostics/BUILD.bazel | file path B: packages/compiler-cli/src/ngtsc/typecheck/diagnostics/BUILD.bazel\n\n@@ -9,6 +9,7 @@ ts_library(\n     deps = [\n         \"//packages:types\",\n         \"//packages/compiler\",\n+        \"//packages/compiler-cli/src/ngtsc/diagnostics\",\n         \"//packages/compiler-cli/src/ngtsc/reflection\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/api\",\n         \"@npm//typescript\",\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/diagnostics/src/diagnostic.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/diagnostics/src/diagnostic.ts\n\n@@ -9,6 +9,7 @@\n import {ParseSourceSpan} from '@angular/compiler';\n import ts from 'typescript';\n \n+import {addDiagnosticChain, makeDiagnosticChain} from '../../../diagnostics';\n import {ExternalTemplateSourceMapping, TemplateDiagnostic, TemplateId, TemplateSourceMapping} from '../../api';\n \n /**\n@@ -64,11 +65,6 @@ export function makeTemplateDiagnostic(\n     const fileName = mapping.type === 'indirect' ?\n         `${componentSf.fileName} (${componentName} template)` :\n         (mapping as ExternalTemplateSourceMapping).templateUrl;\n-    // TODO(alxhub): investigate creating a fake `ts.SourceFile` here instead of invoking the TS\n-    // parser against the template (HTML is just really syntactically invalid TypeScript code ;).\n-    // Also investigate caching the file to avoid running the parser multiple times.\n-    const sf = ts.createSourceFile(\n-        fileName, mapping.template, ts.ScriptTarget.Latest, false, ts.ScriptKind.JSX);\n \n     let relatedInformation: ts.DiagnosticRelatedInformation[] = [];\n     if (relatedMessages !== undefined) {\n@@ -84,6 +80,32 @@ export function makeTemplateDiagnostic(\n       }\n     }\n \n+    let sf: ts.SourceFile;\n+    try {\n+      sf = parseTemplateAsSourceFile(fileName, mapping.template);\n+    } catch (e) {\n+      const failureChain = makeDiagnosticChain(\n+          `Failed to report an error in '${fileName}' at ${span.start.line + 1}:${\n+              span.start.col + 1}`,\n+          [\n+            makeDiagnosticChain((e as Error)?.stack ?? `${e}`),\n+          ]);\n+      return {\n+        source: 'ngtsc',\n+        category,\n+        code,\n+        messageText: addDiagnosticChain(messageText, [failureChain]),\n+        file: componentSf,\n+        componentFile: componentSf,\n+        templateId,\n+        // mapping.node represents either the 'template' or 'templateUrl' expression. getStart()\n+        // and getEnd() are used because they don't include surrounding whitespace.\n+        start: mapping.node.getStart(),\n+        length: mapping.node.getEnd() - mapping.node.getStart(),\n+        relatedInformation,\n+      };\n+    }\n+\n     relatedInformation.push({\n       category: ts.DiagnosticCategory.Message,\n       code: 0,\n@@ -113,6 +135,28 @@ export function makeTemplateDiagnostic(\n   }\n }\n \n+let parseTemplateAsSourceFileForTest: typeof parseTemplateAsSourceFile|null = null;\n+\n+export function setParseTemplateAsSourceFileForTest(fn: typeof parseTemplateAsSourceFile): void {\n+  parseTemplateAsSourceFileForTest = fn;\n+}\n+\n+export function resetParseTemplateAsSourceFileForTest(): void {\n+  parseTemplateAsSourceFileForTest = null;\n+}\n+\n+function parseTemplateAsSourceFile(fileName: string, template: string): ts.SourceFile {\n+  if (parseTemplateAsSourceFileForTest !== null) {\n+    return parseTemplateAsSourceFileForTest(fileName, template);\n+  }\n+\n+  // TODO(alxhub): investigate creating a fake `ts.SourceFile` here instead of invoking the TS\n+  // parser against the template (HTML is just really syntactically invalid TypeScript code ;).\n+  // Also investigate caching the file to avoid running the parser multiple times.\n+  return ts.createSourceFile(\n+      fileName, template, ts.ScriptTarget.Latest, /* setParentNodes */ false, ts.ScriptKind.JSX);\n+}\n+\n export function isTemplateDiagnostic(diagnostic: ts.Diagnostic): diagnostic is TemplateDiagnostic {\n   return diagnostic.hasOwnProperty('componentFile') &&\n       ts.isSourceFile((diagnostic as any).componentFile);\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/test/diagnostics_spec.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/test/diagnostics_spec.ts\n\n@@ -11,6 +11,7 @@ import ts from 'typescript';\n import {absoluteFrom, getSourceFileOrError} from '../../file_system';\n import {runInEachFileSystem, TestFile} from '../../file_system/testing';\n import {OptimizeFor, TypeCheckingConfig} from '../api';\n+import {resetParseTemplateAsSourceFileForTest, setParseTemplateAsSourceFileForTest} from '../diagnostics';\n import {ngForDeclaration, ngForDts, ngIfDeclaration, ngIfDts, setup, TestDeclaration} from '../testing';\n \n runInEachFileSystem(() => {\n@@ -488,7 +489,8 @@ runInEachFileSystem(() => {\n           }`);\n \n         expect(messages).toEqual([\n-          `TestComponent.html(1, 19): Argument of type 'string | undefined' is not assignable to parameter of type 'string'.`\n+          `TestComponent.html(1, 19): Argument of type 'string | undefined' is not assignable to parameter of type 'string'.\n+  Type 'undefined' is not assignable to type 'string'.`\n         ]);\n       });\n \n@@ -517,7 +519,8 @@ runInEachFileSystem(() => {\n           }`);\n \n         expect(messages).toEqual([\n-          `TestComponent.html(1, 19): Argument of type 'string | undefined' is not assignable to parameter of type 'string'.`\n+          `TestComponent.html(1, 19): Argument of type 'string | undefined' is not assignable to parameter of type 'string'.\n+  Type 'undefined' is not assignable to type 'string'.`\n         ]);\n       });\n     });\n@@ -852,6 +855,64 @@ class TestComponent {\n       ]);\n     });\n   });\n+\n+  // https://github.com/angular/angular/issues/43970\n+  describe('template parse failures', () => {\n+    afterEach(resetParseTemplateAsSourceFileForTest);\n+\n+    it('baseline test without parse failure', () => {\n+      const messages = diagnose(`<div (click)=\"test(name)\"></div>`, `\n+      export class TestComponent {\n+        name: string | undefined;\n+        test(n: string): void {}\n+      }`);\n+\n+      expect(messages).toEqual([\n+        `TestComponent.html(1, 20): Argument of type 'string | undefined' is not assignable to parameter of type 'string'.\n+  Type 'undefined' is not assignable to type 'string'.`\n+      ]);\n+    });\n+\n+    it('should handle TypeScript parse failures gracefully', () => {\n+      setParseTemplateAsSourceFileForTest(() => {\n+        throw new Error('Simulated parse failure');\n+      });\n+\n+      const messages = diagnose(`<div (click)=\"test(name)\"></div>`, `\n+      export class TestComponent {\n+        name: string | undefined;\n+        test(n: string): void {}\n+      }`);\n+\n+      expect(messages.length).toBe(1);\n+      expect(messages[0])\n+          .toContain(\n+              `main.ts(2, 20): Argument of type 'string | undefined' is not assignable to parameter of type 'string'.\n+  Type 'undefined' is not assignable to type 'string'.\n+  Failed to report an error in 'TestComponent.html' at 1:20\n+    Error: Simulated parse failure`);\n+    });\n+\n+    it('should handle non-Error failures gracefully', () => {\n+      setParseTemplateAsSourceFileForTest(() => {\n+        throw 'Simulated parse failure';\n+      });\n+\n+      const messages = diagnose(`<div (click)=\"test(name)\"></div>`, `\n+      export class TestComponent {\n+        name: string | undefined;\n+        test(n: string): void {}\n+      }`);\n+\n+      expect(messages.length).toBe(1);\n+      expect(messages[0])\n+          .toContain(\n+              `main.ts(2, 20): Argument of type 'string | undefined' is not assignable to parameter of type 'string'.\n+  Type 'undefined' is not assignable to type 'string'.\n+  Failed to report an error in 'TestComponent.html' at 1:20\n+    Simulated parse failure`);\n+    });\n+  });\n });\n \n function diagnose(\n@@ -879,8 +940,7 @@ function diagnose(\n   const sf = getSourceFileOrError(program, sfPath);\n   const diagnostics = templateTypeChecker.getDiagnosticsForFile(sf, OptimizeFor.WholeProgram);\n   return diagnostics.map(diag => {\n-    const text =\n-        typeof diag.messageText === 'string' ? diag.messageText : diag.messageText.messageText;\n+    const text = ts.flattenDiagnosticMessageText(diag.messageText, '\\n');\n     const fileName = diag.file!.fileName;\n     const {line, character} = ts.getLineAndCharacterOfPosition(diag.file!, diag.start!);\n     return `${fileName}(${line + 1}, ${character + 1}): ${text}`;\n\n\n###\n\n", "completion": "refactor(compiler): show meaningful diagnostic when reporting a template error fails (#<issue-num>)"}
{"prompt": " file path A: devtools/tsconfig.json | file path B: devtools/tsconfig.json\n\n@@ -52,7 +52,6 @@\n   },\n   \"angularCompilerOptions\": {\n     \"fullTemplateTypeCheck\": true,\n-    \"strictInjectionParameters\": true,\n-    \"enableIvy\": true\n+    \"strictInjectionParameters\": true\n   }\n-}\n\\ No newline at end of file\n+}\n\n---\n file path A: goldens/public-api/compiler-cli/compiler_options.md | file path B: goldens/public-api/compiler-cli/compiler_options.md\n\n@@ -58,7 +58,6 @@ export interface MiscOptions {\n \n // @public\n export interface NgcCompatibilityOptions {\n-    enableIvy?: boolean | 'ngtsc';\n     generateNgFactoryShims?: boolean;\n     generateNgSummaryShims?: boolean;\n }\n\n---\n file path A: integration/ivy-i18n/tsconfig.legacy-xmb.json | file path B: integration/ivy-i18n/tsconfig.legacy-xmb.json\n\n@@ -1,7 +1,6 @@\n {\n   \"extends\": \"./tsconfig.app.json\",\n   \"angularCompilerOptions\": {\n-    \"enableIvy\": true,\n     \"i18nInFormat\": \"xmb\"\n   }\n }\n\n---\n file path A: integration/ivy-i18n/tsconfig.legacy.json | file path B: integration/ivy-i18n/tsconfig.legacy.json\n\n@@ -1,7 +1,6 @@\n {\n   \"extends\": \"./tsconfig.app.json\",\n   \"angularCompilerOptions\": {\n-    \"enableIvy\": true,\n     \"i18nInFormat\": \"xlf\"\n   }\n }\n\n---\n file path A: integration/ngcc/tsconfig-app.json | file path B: integration/ngcc/tsconfig-app.json\n\n@@ -13,8 +13,5 @@\n   },\n   \"files\": [\n     \"src/main.ts\"\n-  ],\n-  \"angularCompilerOptions\": {\n-    \"enableIvy\": \"ngtsc\"\n-  }\n-}\n\\ No newline at end of file\n+  ]\n+}\n\n---\n file path A: packages/bazel/src/ngc-wrapped/index.ts | file path B: packages/bazel/src/ngc-wrapped/index.ts\n\n@@ -232,7 +232,6 @@ export function compile({\n   }\n \n   // Detect from compilerOpts whether the entrypoint is being invoked in Ivy mode.\n-  const isInIvyMode = !!compilerOpts.enableIvy;\n   if (!compilerOpts.rootDirs) {\n     throw new Error('rootDirs is not set!');\n   }\n@@ -259,16 +258,14 @@ export function compile({\n     bazelHost = new CompilerHost(files, compilerOpts, bazelOpts, tsHost, fileLoader);\n   }\n \n-  if (isInIvyMode) {\n-    const delegate = bazelHost.shouldSkipTsickleProcessing.bind(bazelHost);\n-    bazelHost.shouldSkipTsickleProcessing = (fileName: string) => {\n-      // The base implementation of shouldSkipTsickleProcessing checks whether `fileName` is part of\n-      // the original `srcs[]`. For Angular (Ivy) compilations, ngfactory/ngsummary files that are\n-      // shims for original .ts files in the program should be treated identically. Thus, strip the\n-      // '.ngfactory' or '.ngsummary' part of the filename away before calling the delegate.\n-      return delegate(fileName.replace(/\\.(ngfactory|ngsummary)\\.ts$/, '.ts'));\n-    };\n-  }\n+  const delegate = bazelHost.shouldSkipTsickleProcessing.bind(bazelHost);\n+  bazelHost.shouldSkipTsickleProcessing = (fileName: string) => {\n+    // The base implementation of shouldSkipTsickleProcessing checks whether `fileName` is part of\n+    // the original `srcs[]`. For Angular (Ivy) compilations, ngfactory/ngsummary files that are\n+    // shims for original .ts files in the program should be treated identically. Thus, strip the\n+    // '.ngfactory' or '.ngsummary' part of the filename away before calling the delegate.\n+    return delegate(fileName.replace(/\\.(ngfactory|ngsummary)\\.ts$/, '.ts'));\n+  };\n \n   // By default, disable tsickle decorator transforming in the tsickle compiler host.\n   // The Angular compilers have their own logic for decorator processing and we wouldn't\n@@ -286,9 +283,7 @@ export function compile({\n       // decorator transformation is still needed. This might be because of custom decorators\n       // with the `@Annotation` JSDoc that will be processed by the tsickle decorator transform.\n       // TODO: Figure out why this is needed in g3 and how we can improve this. FW-2225\n-      if (isInIvyMode) {\n-        bazelHost.transformDecorators = true;\n-      }\n+      bazelHost.transformDecorators = true;\n     } else {\n       compilerOpts.annotateForClosureCompiler = false;\n     }\n\n---\n file path A: packages/compiler-cli/integrationtest/flat_module/tsconfig-build.json | file path B: packages/compiler-cli/integrationtest/flat_module/tsconfig-build.json\n\n@@ -2,8 +2,7 @@\n   \"angularCompilerOptions\": {\n     \"flatModuleId\": \"flat_module\",\n     \"flatModuleOutFile\": \"index.js\",\n-    \"skipTemplateCodegen\": true,\n-    \"enableIvy\": false\n+    \"skipTemplateCodegen\": true\n   },\n \n   \"compilerOptions\": {\n\n---\n file path A: packages/compiler-cli/integrationtest/ngtools_src/tsconfig-build.json | file path B: packages/compiler-cli/integrationtest/ngtools_src/tsconfig-build.json\n\n@@ -1,7 +1,6 @@\n {\n   \"angularCompilerOptions\": {\n-    \"debug\": true,\n-    \"enableIvy\": false\n+    \"debug\": true\n   },\n \n   \"compilerOptions\": {\n\n---\n file path A: packages/compiler-cli/integrationtest/third_party_src/tsconfig-build.json | file path B: packages/compiler-cli/integrationtest/third_party_src/tsconfig-build.json\n\n@@ -1,7 +1,6 @@\n {\n   \"angularCompilerOptions\": {\n-    \"skipTemplateCodegen\": true,\n-    \"enableIvy\": false\n+    \"skipTemplateCodegen\": true\n   },\n \n   \"compilerOptions\": {\n\n---\n file path A: packages/compiler-cli/integrationtest/tsconfig-build.json | file path B: packages/compiler-cli/integrationtest/tsconfig-build.json\n\n@@ -4,8 +4,7 @@\n     \"annotationsAs\": \"static fields\",\n     \"debug\": true,\n     \"enableSummariesForJit\": true,\n-    \"i18nFormat\": \"xlf\",\n-    \"enableIvy\": false\n+    \"i18nFormat\": \"xlf\"\n   },\n \n   \"compilerOptions\": {\n\n---\n file path A: packages/compiler-cli/integrationtest/tsconfig-xi18n.json | file path B: packages/compiler-cli/integrationtest/tsconfig-xi18n.json\n\n@@ -1,8 +1,7 @@\n {\n   \"angularCompilerOptions\": {\n     \"debug\": true,\n-    \"enableSummariesForJit\": true,\n-    \"enableIvy\": false\n+    \"enableSummariesForJit\": true\n   },\n \n   \"compilerOptions\": {\n\n---\n file path A: packages/compiler-cli/src/main.ts | file path B: packages/compiler-cli/src/main.ts\n\n@@ -12,7 +12,6 @@ import yargs from 'yargs';\n import {exitCodeFromResult, formatDiagnostics, ParsedConfiguration, performCompilation, readConfiguration} from './perform_compile';\n import {createPerformWatchHost, performWatchCompilation} from './perform_watch';\n import * as api from './transformers/api';\n-import {GENERATED_FILES} from './transformers/util';\n \n type TsickleModule = typeof import('tsickle');\n \n@@ -106,9 +105,7 @@ function createEmitCallback(\n       'fileNameToModuleId'|'googmodule'|'untyped'|'convertIndexImportShorthand'|\n       'transformDecorators'|'transformTypesToClosure'|'generateExtraSuppressions'|\n       'rootDirsRelative'> = {\n-    shouldSkipTsickleProcessing: (fileName) => /\\.d\\.ts$/.test(fileName) ||\n-        // View Engine's generated files were never intended to be processed with tsickle.\n-        (!options.enableIvy && GENERATED_FILES.test(fileName)),\n+    shouldSkipTsickleProcessing: (fileName) => fileName.endsWith('.d.ts'),\n     pathToModuleName: (context, importPath) => '',\n     shouldIgnoreWarningsForPath: (filePath) => false,\n     fileNameToModuleId: (fileName) => fileName,\n\n---\n file path A: packages/compiler-cli/src/ngtsc/core/api/src/public_options.ts | file path B: packages/compiler-cli/src/ngtsc/core/api/src/public_options.ts\n\n@@ -110,18 +110,6 @@ export interface NgcCompatibilityOptions {\n    * `TestBed`, which is a no-op in Ivy.\n    */\n   generateNgSummaryShims?: boolean;\n-\n-  /**\n-   * Tells the compiler to generate definitions using the Render3 style code generation.\n-   * This option defaults to `true`.\n-   *\n-   * Acceptable values are as follows:\n-   *\n-   * `false` - run ngc normally\n-   * `true` - run the ngtsc compiler instead of the normal ngc compiler\n-   * `ngtsc` - alias for `true`\n-   */\n-  enableIvy?: boolean|'ngtsc';\n }\n \n /**\n@@ -385,7 +373,6 @@ export interface I18nOptions {\n   /**\n    * Render `$localize` messages with legacy format ids.\n    *\n-   * This is only active if we are building with `enableIvy: true`.\n    * The default value for now is `true`.\n    *\n    * Use this option when use are using the `$localize` based localization messages but\n@@ -437,7 +424,7 @@ export interface TargetOptions {\n export interface MiscOptions {\n   /**\n    * Whether the compiler should avoid generating code for classes that haven't been exported.\n-   * This is only active when building with `enableIvy: true`. Defaults to `true`.\n+   * Defaults to `true`.\n    */\n   compileNonExportedClasses?: boolean;\n \n\n---\n file path A: packages/compiler-cli/src/perform_compile.ts | file path B: packages/compiler-cli/src/perform_compile.ts\n\n@@ -119,9 +119,6 @@ export function readConfiguration(\n         ts.parseJsonConfigFileContent(\n             config, parseConfigHost, basePath, existingCompilerOptions, configFileName);\n \n-    // Coerce to boolean as `enableIvy` can be `ngtsc|true|false|undefined` here.\n-    options.enableIvy = !!(options.enableIvy ?? true);\n-\n     let emitFlags = api.EmitFlags.Default;\n     if (!(options.skipMetadataEmit || options.flatModuleOutFile)) {\n       emitFlags |= api.EmitFlags.Metadata;\n\n---\n file path A: packages/compiler-cli/src/transformers/util.ts | file path B: packages/compiler-cli/src/transformers/util.ts\n\n@@ -8,9 +8,8 @@\n \n import ts from 'typescript';\n \n-import {CompilerOptions, DEFAULT_ERROR_CODE, SOURCE} from './api';\n+import {DEFAULT_ERROR_CODE, SOURCE} from './api';\n \n-export const GENERATED_FILES = /(.*?)\\.(ngfactory|shim\\.ngstyle|ngstyle|ngsummary)\\.(js|d\\.ts|ts)$/;\n \n export function error(msg: string): never {\n   throw new Error(`Internal error: ${msg}`);\n\n---\n file path A: packages/compiler-cli/test/compliance/test_helpers/compile_test.ts | file path B: packages/compiler-cli/test/compliance/test_helpers/compile_test.ts\n\n@@ -117,7 +117,6 @@ function getOptions(\n     moduleResolution: ts.ModuleResolutionKind.NodeJs,\n     typeRoots: ['node_modules/@types'],\n     ...convertedCompilerOptions.options,\n-    enableIvy: true,\n     enableI18nLegacyMessageIdFormat: false,\n     ...angularCompilerOptions,\n   };\n\n---\n file path A: packages/compiler-cli/test/ngtsc/env.ts | file path B: packages/compiler-cli/test/ngtsc/env.ts\n\n@@ -78,9 +78,6 @@ export class NgtscTestEnvironment {\n         \"lib\": [\"es2015\", \"dom\"],\n         \"typeRoots\": [\"node_modules/@types\"]\n       },\n-      \"angularCompilerOptions\": {\n-        \"enableIvy\": true,\n-      },\n       \"exclude\": [\n         \"built\"\n       ]\n@@ -195,7 +192,7 @@ export class NgtscTestEnvironment {\n   tsconfig(extraOpts: TsConfigOptions = {}, extraRootDirs?: string[], files?: string[]): void {\n     const tsconfig: {[key: string]: any} = {\n       extends: './tsconfig-base.json',\n-      angularCompilerOptions: {...extraOpts, enableIvy: true},\n+      angularCompilerOptions: extraOpts,\n     };\n     if (files !== undefined) {\n       tsconfig['files'] = files;\n\n---\n file path A: packages/compiler-cli/test/ngtsc/ngtsc_spec.ts | file path B: packages/compiler-cli/test/ngtsc/ngtsc_spec.ts\n\n@@ -1905,7 +1905,6 @@ function allTests(os: string) {\n       it('should be able to use abstract directive in other compilation units', () => {\n         env.write('tsconfig.json', JSON.stringify({\n           extends: './tsconfig-base.json',\n-          angularCompilerOptions: {enableIvy: true},\n           compilerOptions: {rootDir: '.', outDir: '../node_modules/lib1_built'},\n         }));\n         env.write('index.ts', `\n\n---\n file path A: packages/compiler-cli/test/perform_compile_spec.ts | file path B: packages/compiler-cli/test/perform_compile_spec.ts\n\n@@ -51,33 +51,31 @@ describe('perform_compile', () => {\n   it('should merge tsconfig \"angularCompilerOptions\"', () => {\n     writeSomeConfigs();\n     const {options} = readConfiguration(path.resolve(basePath, 'tsconfig-level-1.json'));\n-    expect(options.annotateForClosureCompiler).toBe(true);\n+    expect(options.annotateForClosureCompiler).toBeTrue();\n     expect(options.annotationsAs).toBe('decorators');\n-    expect(options.skipMetadataEmit).toBe(true);\n+    expect(options.skipMetadataEmit).toBeTrue();\n   });\n \n-  it(`should return 'enableIvy: true' when enableIvy is not defined in \"angularCompilerOptions\"`,\n-     () => {\n-       writeSomeConfigs();\n-       const {options} = readConfiguration(path.resolve(basePath, 'tsconfig-level-1.json'));\n-       expect(options.enableIvy).toBe(true);\n-     });\n+  it(`should return undefined when debug is not defined in \"angularCompilerOptions\"`, () => {\n+    writeSomeConfigs();\n+    const {options} = readConfiguration(path.resolve(basePath, 'tsconfig-level-1.json'));\n+    expect(options.debug).toBeUndefined();\n+  });\n \n-  it(`should return 'enableIvy: false' when enableIvy is disabled in \"angularCompilerOptions\"`,\n-     () => {\n-       writeSomeConfigs();\n-       support.writeFiles({\n-         'tsconfig-level-3.json': `{\n+  it(`should return 'debug: false' when debug is disabled in \"angularCompilerOptions\"`, () => {\n+    writeSomeConfigs();\n+    support.writeFiles({\n+      'tsconfig-level-3.json': `{\n           \"angularCompilerOptions\": {\n-            \"enableIvy\": false\n+            \"debug\": false\n           }\n         }\n       `,\n-       });\n+    });\n \n-       const {options} = readConfiguration(path.resolve(basePath, 'tsconfig-level-1.json'));\n-       expect(options.enableIvy).toBe(false);\n-     });\n+    const {options} = readConfiguration(path.resolve(basePath, 'tsconfig-level-1.json'));\n+    expect(options.debug).toBeFalse();\n+  });\n \n   it('should override options defined in tsconfig with those defined in `existingOptions`', () => {\n     support.writeFiles({\n@@ -89,15 +87,17 @@ describe('perform_compile', () => {\n             \"annotateForClosureCompiler\": true\n           }\n         }\n-      `\n+      `,\n     });\n \n-    const {options} = readConfiguration(\n-        path.resolve(basePath, 'tsconfig-level-1.json'),\n-        {annotateForClosureCompiler: false, target: ts.ScriptTarget.ES2015, enableIvy: false});\n+    const {options} = readConfiguration(path.resolve(basePath, 'tsconfig-level-1.json'), {\n+      annotateForClosureCompiler: false,\n+      target: ts.ScriptTarget.ES2015,\n+      debug: false,\n+    });\n \n     expect(options).toEqual(jasmine.objectContaining({\n-      enableIvy: false,\n+      debug: false,\n       target: ts.ScriptTarget.ES2015,\n       annotateForClosureCompiler: false,\n     }));\n@@ -108,7 +108,7 @@ describe('perform_compile', () => {\n       'tsconfig-level-1.json': `{\n           \"extends\": \"@angular-ru/tsconfig\",\n           \"angularCompilerOptions\": {\n-            \"enableIvy\": false\n+            \"debug\": false\n           }\n         }\n       `,\n@@ -133,7 +133,7 @@ describe('perform_compile', () => {\n     expect(options).toEqual(jasmine.objectContaining({\n       strict: true,\n       skipMetadataEmit: true,\n-      enableIvy: false,\n+      debug: false,\n     }));\n   });\n \n@@ -143,7 +143,7 @@ describe('perform_compile', () => {\n          'tsconfig-level-1.json': `{\n             \"extends\": \"@1stg/tsconfig/angular\",\n             \"angularCompilerOptions\": {\n-              \"enableIvy\": false\n+              \"debug\": false\n             }\n           }`,\n          'node_modules/@1stg/tsconfig/angular.json': `{\n@@ -164,7 +164,7 @@ describe('perform_compile', () => {\n        expect(options).toEqual(jasmine.objectContaining({\n          strict: true,\n          skipMetadataEmit: true,\n-         enableIvy: false,\n+         debug: false,\n        }));\n      });\n \n@@ -174,7 +174,7 @@ describe('perform_compile', () => {\n          'tsconfig-level-1.json': `{\n             \"extends\": \"./tsconfig.app\",\n             \"angularCompilerOptions\": {\n-              \"enableIvy\": false\n+              \"debug\": false\n             }\n           }`,\n          'tsconfig.app.json': `{\n@@ -191,7 +191,7 @@ describe('perform_compile', () => {\n        expect(options).toEqual(jasmine.objectContaining({\n          strict: true,\n          skipMetadataEmit: true,\n-         enableIvy: false,\n+         debug: false,\n        }));\n      });\n });\n\n---\n file path A: packages/language-service/test/legacy/language_service_spec.ts | file path B: packages/language-service/test/legacy/language_service_spec.ts\n\n@@ -34,7 +34,6 @@ describe('language service adapter', () => {\n   describe('parse compiler options', () => {\n     it('should initialize with angularCompilerOptions from tsconfig.json', () => {\n       expect(ngLS.getCompilerOptions()).toEqual(jasmine.objectContaining({\n-        enableIvy: true,  // default for ivy is true\n         strictTemplates: true,\n         strictInjectionParameters: true,\n       }));\n@@ -42,7 +41,6 @@ describe('language service adapter', () => {\n \n     it('should reparse angularCompilerOptions on tsconfig.json change', () => {\n       expect(ngLS.getCompilerOptions()).toEqual(jasmine.objectContaining({\n-        enableIvy: true,  // default for ivy is true\n         strictTemplates: true,\n         strictInjectionParameters: true,\n       }));\n@@ -66,7 +64,6 @@ describe('language service adapter', () => {\n \n       // First make sure the default for strictTemplates is true\n       expect(ngLS.getCompilerOptions()).toEqual(jasmine.objectContaining({\n-        enableIvy: true,  // default for ivy is true\n         strictTemplates: true,\n         strictInjectionParameters: true,\n       }));\n\n\n###\n\n", "completion": "refactor(compiler-cli): remove `enableIvy` options (#<issue-num>)"}
{"prompt": " file path A: aio/tools/doc-linter/styles/Angular/Google_WordListWarnings.yml | file path B: aio/tools/doc-linter/styles/Angular/Google_WordListWarnings.yml\n\n@@ -58,6 +58,7 @@ swap:\n   curated roles: predefined roles\n   datasource: data source\n   Developers Console: Google API Console|API Console\n+  entrypoint: entry point\n   ephemeral IP address: ephemeral external IP address\n   execute: run|call\n   fewer data: less data\n\n---\n file path A: aio/tools/doc-linter/styles/Angular/WriteGood_Illusions.yml | file path B: aio/tools/doc-linter/styles/Angular/WriteGood_Illusions.yml\n\n@@ -4,4 +4,4 @@ level: warning\n ignorecase: true\n alpha: true\n tokens:\n-  - '[\\w]+'\n+  - '[^\\s]+'\n\n---\n file path A: aio/tools/doc-linter/styles/Vocab/Jargon.txt | file path B: aio/tools/doc-linter/styles/Vocab/Jargon.txt\n\n@@ -74,12 +74,17 @@ polyfills\n preprocess\n preprocessor\n preprocessors\n+rebase\n+rebased\n+rebasing\n refactorings\n reflows\n reimagined\n renderers\n repo\n+repos\n repurpose\n+resync\n reusability\n rollup\n runtimes\n@@ -133,4 +138,4 @@ untrusted\n untyped\n validator\n validators\n-walkthrough\n\\ No newline at end of file\n+walkthrough\n\n---\n file path A: aio/tools/doc-linter/styles/Vocab/Names.txt | file path B: aio/tools/doc-linter/styles/Vocab/Names.txt\n\n@@ -26,3 +26,4 @@ tsickle\n tslib\n tslint\n vercel\n+vmware\n\n\n###\n\n", "completion": "docs: add new words to vocabulary (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/image-directive.md | file path B: aio/content/guide/image-directive.md\n\n@@ -1,6 +1,6 @@\n # Getting started with NgOptimizedImage\n \n-Note: the `NgOptimizedImage` directive is currently in the [\u201cDeveloper Preview\u201d mode](https://angular.io/guide/releases#developer-preview). The Angular team will stabilize the APIs based on the feedback and will make an announcement once the APIs are fully stable.\n+Note: the `NgOptimizedImage` directive is currently in the [\"Developer Preview\" mode](https://angular.io/guide/releases#developer-preview). The Angular team will stabilize the APIs based on the feedback and will make an announcement once the APIs are fully stable.\n \n The `NgOptimizedImage` directive makes it easy to adopt performance best practices for loading images.\n \n@@ -27,8 +27,10 @@ You will need to import the directive into your application. In addition, you wi\n \n To activate the `NgOptimizedImage` directive, replace your image's `src` attribute with `rawSrc`.\n \n-<code-example format=\"html\" language=\"html\">\n-  &lt;img rawSrc=\u201dcat.jpg\" width=\"400\" height=\"200\"&gt;\n+<code-example format=\"typescript\" language=\"typescript\">\n+\n+&lt;img rawSrc=\"cat.jpg\" width=\"400\" height=\"200\"&gt;\n+\n </code-example>\n \n The built-in third-party loaders prepend a shared base URL to `src`. If you're using one of these loaders (or any other loader that does this), make sure to omit the shared base URL path from `src` to prevent unnecessary duplication.\n@@ -39,23 +41,27 @@ You must also set the `width` and `height` attributes. This is done to prevent [\n \n Always mark the [LCP image](https://web.dev/lcp/#what-elements-are-considered) on your page as `priority` to prioritize its loading.\n \n-<code-example format=\"html\" language=\"html\">\n-  &lt;img rawSrc=\"cat.jpg\" width=\"400\" height=\"200\" priority&gt;\n+<code-example format=\"typescript\" language=\"typescript\">\n+\n+&lt;img rawSrc=\"cat.jpg\" width=\"400\" height=\"200\" priority&gt;\n+\n </code-example>\n \n Marking an image as `priority` applies the following optimizations:\n \n-*   Sets `fetchpriority=high` (read more about priority hints [here](https://web.dev/priority-hints/))\n-*   Sets `loading=eager` (read more about native lazy loading [here](https://web.dev/browser-level-image-lazy-loading/))\n+*   Sets `fetchpriority=high` (read more about priority hints [here](https://web.dev/priority-hints))\n+*   Sets `loading=eager` (read more about native lazy loading [here](https://web.dev/browser-level-image-lazy-loading))\n \n Angular displays a warning during development if the LCP element is an image that does not have the `priority` attribute. A page\u2019s LCP element can vary based on a number of factors - such as the dimensions of a user's screen. A page may have multiple images that should be marked `priority`. See [CSS for Web Vitals](https://web.dev/css-web-vitals/#images-and-largest-contentful-paint-lcp) for more details.\n \n ### Adding resource hints\n \n-You can add a [`preconnect` resource hint](https://web.dev/preconnect-and-dns-prefetch/) for your image origin to ensure that the LCP image loads as quickly as possible. Always put resource hints in the `<head>` of the document.\n+You can add a [`preconnect` resource hint](https://web.dev/preconnect-and-dns-prefetch) for your image origin to ensure that the LCP image loads as quickly as possible. Always put resource hints in the `<head>` of the document.\n \n <code-example format=\"html\" language=\"html\">\n-  &lt;link rel=\"preconnect\" href=\"https://my.cdn.origin\" &gt;\n+\n+&lt;link rel=\"preconnect\" href=\"https://my.cdn.origin\" /&gt;\n+\n </code-example>\n \n By default, if you use a loader for a third-party image service, the `NgOptimizedImage` directive will warn during development if it detects that there is no `preconnect` resource hint for the origin that serves the LCP image.\n@@ -63,23 +69,27 @@ By default, if you use a loader for a third-party image service, the `NgOptimize\n To disable these warnings, add `{ensurePreconnect: false}` to the arguments passed to the provider factory for your chosen image service:\n \n <code-example format=\"typescript\" language=\"typescript\">\n+\n providers: [\n   provideImgixLoader('https://my.base.url', {ensurePreconnect: false})\n ],\n+\n </code-example>\n \n ### Adjusting image styling\n \n Depending on the image's styling, adding `width` and `height` attributes may cause the image to render differently. `NgOptimizedImage` warns you if your image styling renders the image at a distorted aspect ratio.\n \n-You can typically fix this by adding `height: auto` or `width: auto` to your image styles. For more information, see the [web.dev article on the `<img>` tag](https://web.dev/patterns/web-vitals-patterns/images/img-tag/).\n+You can typically fix this by adding `height: auto` or `width: auto` to your image styles. For more information, see the [web.dev article on the `<img>` tag](https://web.dev/patterns/web-vitals-patterns/images/img-tag).\n \n ### Handling `srcset` attributes\n \n If your `<img>` tag defines a `srcset` attribute, replace it with `rawSrcset`.\n \n <code-example format=\"html\" language=\"html\">\n-  &lt;img rawSrc=\"hero.jpg\" rawSrcset=\"100w, 200w, 300w\"&gt;\n+\n+&lt;img rawSrc=\"hero.jpg\" rawSrcset=\"100w, 200w, 300w\"&gt;\n+\n </code-example>\n \n If the `rawSrcset` attribute is present, `NgOptimizedImage` generates and sets the [`srcset` attribute](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/srcset) using the configured image loader. Do not include image file names in `rawSrcset` - the directive infers this information from `rawSrc`. The directive supports both width descriptors (e.g. `100w`) and density descriptors (e.g. `1x`) are supported.\n@@ -87,7 +97,9 @@ If the `rawSrcset` attribute is present, `NgOptimizedImage` generates and sets t\n You can also use `rawSrcset` with the standard image [`sizes` attribute](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/sizes).\n \n <code-example format=\"html\" language=\"html\">\n-  &lt;img rawSrc=\"hero.jpg\" rawSrcset=\"100w, 200w, 300w\" sizes=\u201d50vw\u201d&gt;\n+\n+&lt;img rawSrc=\"hero.jpg\" rawSrcset=\"100w, 200w, 300w\" sizes=\"50vw\"&gt;\n+\n </code-example>\n \n ### Disabling image lazy loading\n@@ -95,5 +107,15 @@ You can also use `rawSrcset` with the standard image [`sizes` attribute](https:/\n By default, `NgOptimizedImage` sets `loading=lazy` for all images that are not marked `priority`. You can disable this behavior for non-priority images by setting the `loading` attribute. This attribute accepts values: `eager`, `auto`, and `lazy`. [See the documentation for the standard image `loading` attribute for details](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/loading#value).\n \n <code-example format=\"html\" language=\"html\">\n-  &lt;img rawSrc=\"cat.jpg\" width=\"400\" height=\"200\" loading=\"eager\"&gt;\n+\n+&lt;img rawSrc=\"cat.jpg\" width=\"400\" height=\"200\" loading=\"eager\"&gt;\n+\n </code-example>\n+\n+<!-- links -->\n+\n+<!-- external links -->\n+\n+<!--end links -->\n+\n+@reviewed 2022-08-25\n\n\n###\n\n", "completion": "docs: Update markdown and formatting in image-directive topic. (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/dev-infra.yml | file path B: .github/workflows/dev-infra.yml\n\n@@ -13,13 +13,13 @@ jobs:\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3.0.2\n-      - uses: angular/dev-infra/github-actions/commit-message-based-labels@5ffe2357f61a57d16f44a3209cd880c211c575b5\n+      - uses: angular/dev-infra/github-actions/commit-message-based-labels@1c648b45459fa32ffd7de8a8fc07bde6bdbef923\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n   post_approval_changes:\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3.0.2\n-      - uses: angular/dev-infra/github-actions/post-approval-changes@5ffe2357f61a57d16f44a3209cd880c211c575b5\n+      - uses: angular/dev-infra/github-actions/post-approval-changes@1c648b45459fa32ffd7de8a8fc07bde6bdbef923\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n---\n file path A: .github/workflows/feature-requests.yml | file path B: .github/workflows/feature-requests.yml\n\n@@ -14,6 +14,6 @@ jobs:\n     if: github.repository == 'angular/angular'\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: angular/dev-infra/github-actions/feature-request@5ffe2357f61a57d16f44a3209cd880c211c575b5\n+      - uses: angular/dev-infra/github-actions/feature-request@1c648b45459fa32ffd7de8a8fc07bde6bdbef923\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n---\n file path A: .github/workflows/lock-closed.yml | file path B: .github/workflows/lock-closed.yml\n\n@@ -14,6 +14,6 @@ jobs:\n     if: github.repository == 'angular/angular'\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: angular/dev-infra/github-actions/lock-closed@5ffe2357f61a57d16f44a3209cd880c211c575b5\n+      - uses: angular/dev-infra/github-actions/lock-closed@1c648b45459fa32ffd7de8a8fc07bde6bdbef923\n         with:\n           lock-bot-key: ${{ secrets.LOCK_BOT_PRIVATE_KEY }}\n\n---\n file path A: package.json | file path B: package.json\n\n@@ -179,8 +179,8 @@\n   },\n   \"// 2\": \"devDependencies are not used under Bazel. Many can be removed after test.sh is deleted.\",\n   \"devDependencies\": {\n-    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#2c68d0f9752df9bdbb185b89630ea085a2e62484\",\n-    \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#da938be2693c1c05ad7ab74b5f6c0dedc2ffa5ca\",\n+    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#f2a04c81f9cfbf8a86e595ca5d1ca1da50ddf9dd\",\n+    \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#20aa4d8a5ec774e1f21fbc50bca511c229a1a7f8\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n     \"@bazel/buildifier\": \"^5.0.0\",\n     \"@bazel/ibazel\": \"^0.16.0\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -254,9 +254,10 @@\n     \"@angular/core\" \"^13.0.0 || ^14.0.0-0\"\n     reflect-metadata \"^0.1.13\"\n \n-\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#2c68d0f9752df9bdbb185b89630ea085a2e62484\":\n-  version \"0.0.0-5ffe2357f61a57d16f44a3209cd880c211c575b5\"\n-  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#2c68d0f9752df9bdbb185b89630ea085a2e62484\"\n+\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#f2a04c81f9cfbf8a86e595ca5d1ca1da50ddf9dd\":\n+  version \"0.0.0-1c648b45459fa32ffd7de8a8fc07bde6bdbef923\"\n+  uid f2a04c81f9cfbf8a86e595ca5d1ca1da50ddf9dd\n+  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#f2a04c81f9cfbf8a86e595ca5d1ca1da50ddf9dd\"\n   dependencies:\n     \"@angular-devkit/build-angular\" \"14.2.0-rc.0\"\n     \"@angular/benchpress\" \"0.3.0\"\n@@ -268,7 +269,7 @@\n     \"@bazel/runfiles\" \"5.5.3\"\n     \"@bazel/terser\" \"5.5.3\"\n     \"@bazel/typescript\" \"5.5.3\"\n-    \"@microsoft/api-extractor\" \"7.29.3\"\n+    \"@microsoft/api-extractor\" \"7.29.5\"\n     \"@types/browser-sync\" \"^2.26.3\"\n     \"@types/node\" \"16.10.9\"\n     \"@types/selenium-webdriver\" \"^4.0.18\"\n@@ -287,7 +288,7 @@\n     tmp \"^0.2.1\"\n     \"true-case-path\" \"^2.2.1\"\n     tslib \"^2.3.0\"\n-    typescript \"~4.7.3\"\n+    typescript \"~4.8.0\"\n     uuid \"^8.3.2\"\n     yargs \"^17.0.0\"\n \n@@ -361,12 +362,13 @@\n   dependencies:\n     tslib \"^2.3.0\"\n \n-\"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#da938be2693c1c05ad7ab74b5f6c0dedc2ffa5ca\":\n-  version \"0.0.0-806c568a439877f69b975aedbf5e4eb26fd7eaaf\"\n-  resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#da938be2693c1c05ad7ab74b5f6c0dedc2ffa5ca\"\n+\"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#20aa4d8a5ec774e1f21fbc50bca511c229a1a7f8\":\n+  version \"0.0.0-1c648b45459fa32ffd7de8a8fc07bde6bdbef923\"\n+  uid \"20aa4d8a5ec774e1f21fbc50bca511c229a1a7f8\"\n+  resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#20aa4d8a5ec774e1f21fbc50bca511c229a1a7f8\"\n   dependencies:\n     \"@yarnpkg/lockfile\" \"^1.1.0\"\n-    typescript \"~4.7.3\"\n+    typescript \"~4.8.0\"\n \n \"@angular/platform-browser-12@npm:@angular/platform-browser@12.2.13\":\n   version \"12.2.13\"\n@@ -2062,24 +2064,24 @@\n     \"@microsoft/tsdoc-config\" \"~0.16.1\"\n     \"@rushstack/node-core-library\" \"3.49.0\"\n \n-\"@microsoft/api-extractor-model@7.23.1\":\n-  version \"7.23.1\"\n-  resolved \"https://registry.yarnpkg.com/@microsoft/api-extractor-model/-/api-extractor-model-7.23.1.tgz#d93704882241e7720094d41c7005b07eb593c073\"\n-  integrity sha512-axlZ33H2LfYX7goAaWpzABWZl3JtX/EUkfVBsI4SuMn3AZYBJsP5MVpMCq7jt0PCefWGwwO+Rv+lCmmJIjFhlQ==\n+\"@microsoft/api-extractor-model@7.23.3\":\n+  version \"7.23.3\"\n+  resolved \"https://registry.yarnpkg.com/@microsoft/api-extractor-model/-/api-extractor-model-7.23.3.tgz#82961ebaddd7427112afbfc4c1d7c76a9932f2fc\"\n+  integrity sha512-HpsWzG6jrWHrTlIg53kmp/IVQPBHUZc+8dunnr9VXrmDjVBehaXxp9A6jhTQ/bd7W1m5TYfAvwCmseC1+9FCuA==\n   dependencies:\n     \"@microsoft/tsdoc\" \"0.14.1\"\n     \"@microsoft/tsdoc-config\" \"~0.16.1\"\n-    \"@rushstack/node-core-library\" \"3.50.2\"\n+    \"@rushstack/node-core-library\" \"3.51.1\"\n \n-\"@microsoft/api-extractor@7.29.3\":\n-  version \"7.29.3\"\n-  resolved \"https://registry.yarnpkg.com/@microsoft/api-extractor/-/api-extractor-7.29.3.tgz#f91ca61833c170c6c47a0fc064fa010460a11457\"\n-  integrity sha512-PHq+Oo8yiXhwi11VQ1Nz36s+aZwgFqjtkd41udWHtSpyMv2slJ74m1cHdpWbs2ovGUCfldayzdpGwnexZLd2bA==\n+\"@microsoft/api-extractor@7.29.5\":\n+  version \"7.29.5\"\n+  resolved \"https://registry.yarnpkg.com/@microsoft/api-extractor/-/api-extractor-7.29.5.tgz#8afafc8b2c27d8334579434971f718b347634f35\"\n+  integrity sha512-+vqO/TAGw9xXANpvTjA4y5ADcaRuYuBoJ9IfoAHubrGuxKG6GoW3P2tfdgwteLz95CnlftBxYp+3NG/mf05P9Q==\n   dependencies:\n-    \"@microsoft/api-extractor-model\" \"7.23.1\"\n+    \"@microsoft/api-extractor-model\" \"7.23.3\"\n     \"@microsoft/tsdoc\" \"0.14.1\"\n     \"@microsoft/tsdoc-config\" \"~0.16.1\"\n-    \"@rushstack/node-core-library\" \"3.50.2\"\n+    \"@rushstack/node-core-library\" \"3.51.1\"\n     \"@rushstack/rig-package\" \"0.3.14\"\n     \"@rushstack/ts-command-line\" \"4.12.2\"\n     colors \"~1.2.1\"\n@@ -2391,10 +2393,10 @@\n     timsort \"~0.3.0\"\n     z-schema \"~5.0.2\"\n \n-\"@rushstack/node-core-library@3.50.2\":\n-  version \"3.50.2\"\n-  resolved \"https://registry.yarnpkg.com/@rushstack/node-core-library/-/node-core-library-3.50.2.tgz#43df3f8422898a448114fcb9c7d4e967625da585\"\n-  integrity sha512-+zpZBcaX5s+wA0avF0Lk3sd5jbGRo5SmsEJpElJbqQd3KGFvc/hcyeNSMqV5+esJ1JuTfnE1QyRt8nvxFNTaQg==\n+\"@rushstack/node-core-library@3.51.1\":\n+  version \"3.51.1\"\n+  resolved \"https://registry.yarnpkg.com/@rushstack/node-core-library/-/node-core-library-3.51.1.tgz#e123053c4924722cc9614c0091fda5ed7bbc6c9d\"\n+  integrity sha512-xLoUztvGpaT5CphDexDPt2WbBx8D68VS5tYOkwfr98p90y0f/wepgXlTA/q5MUeZGGucASiXKp5ysdD+GPYf9A==\n   dependencies:\n     \"@types/node\" \"12.20.24\"\n     colors \"~1.2.1\"\n@@ -2403,7 +2405,6 @@\n     jju \"~1.4.0\"\n     resolve \"~1.17.0\"\n     semver \"~7.3.0\"\n-    timsort \"~0.3.0\"\n     z-schema \"~5.0.2\"\n \n \"@rushstack/rig-package@0.3.13\":\n@@ -15054,7 +15055,7 @@ typescript@^3.9.10, typescript@^3.9.5, typescript@^3.9.7:\n   resolved \"https://registry.yarnpkg.com/typescript/-/typescript-3.9.10.tgz#70f3910ac7a51ed6bef79da7800690b19bf778b8\"\n   integrity sha512-w6fIxVE/H1PkLKcCPsFqKE7Kv7QUwhU8qQY2MueZXWx5cPZdwFupLgKK3vntcK98BtNHZtAF4LA/yl2a7k8R6Q==\n \n-typescript@^4.6.2, typescript@~4.7.3, typescript@~4.7.4:\n+typescript@^4.6.2, typescript@~4.7.4:\n   version \"4.7.4\"\n   resolved \"https://registry.yarnpkg.com/typescript/-/typescript-4.7.4.tgz#1a88596d1cf47d59507a1bcdfb5b9dfe4d488235\"\n   integrity sha512-C0WQT0gezHuw6AdY1M2jxUO83Rjf0HP7Sk1DtXj6j1EwkQNZrHAg2XPWlq62oqEhYvONq5pkC2Y9oPljWToLmQ==\n@@ -15064,7 +15065,7 @@ typescript@~4.6.3:\n   resolved \"https://registry.yarnpkg.com/typescript/-/typescript-4.6.4.tgz#caa78bbc3a59e6a5c510d35703f6a09877ce45e9\"\n   integrity sha512-9ia/jWHIEbo49HfjrLGfKbZSuWo9iTMwXO+Ca3pRsSpbsMbc7/IU8NKdCZVRRBafVPGnoJeFL76ZOAA84I9fEg==\n \n-typescript@~4.8.2:\n+typescript@~4.8.0, typescript@~4.8.2:\n   version \"4.8.2\"\n   resolved \"https://registry.yarnpkg.com/typescript/-/typescript-4.8.2.tgz#e3b33d5ccfb5914e4eeab6699cf208adee3fd790\"\n   integrity sha512-C0I1UsrrDHo2fYI5oaCGbSejwX4ch+9Y5jTQELvovfmFkK3HHSZJB8MSJcWLmCUBzQBchCrZ9rMRV6GuNrvGtw==\n\n\n###\n\n", "completion": "build: update cross-repo angular dependencies to f2a04c8 (#<issue-num>)"}
{"prompt": " file path A: packages/service-worker/worker/src/app-version.ts | file path B: packages/service-worker/worker/src/app-version.ts\n\n@@ -194,7 +194,7 @@ export class AppVersion implements UpdateSource {\n       }\n \n       // This was a navigation request. Re-enter `handleFetch` with a request for\n-      // the URL.\n+      // the index URL.\n       return this.handleFetch(this.adapter.newRequest(this.indexUrl), event);\n     }\n \n\n---\n file path A: packages/service-worker/worker/src/assets.ts | file path B: packages/service-worker/worker/src/assets.ts\n\n@@ -150,10 +150,8 @@ export abstract class AssetGroup {\n         }\n       }\n \n-      // No already-cached response exists, so attempt a fetch/cache operation. The original request\n-      // may specify things like credential inclusion, but for assets these are not honored in order\n-      // to avoid issues with opaque responses. The SW requests the data itself.\n-      const res = await this.fetchAndCacheOnce(this.adapter.newRequest(req.url));\n+      // No already-cached response exists, so attempt a fetch/cache operation.\n+      const res = await this.fetchAndCacheOnce(this.newRequestWithMetadata(req.url, req));\n \n       // If this is successful, the response needs to be cloned as it might be used to respond to\n       // multiple fetch operations at the same time.\n@@ -360,7 +358,7 @@ export abstract class AssetGroup {\n       }\n \n       // Unwrap the redirect directly.\n-      return this.fetchFromNetwork(this.adapter.newRequest(res.url), redirectLimit - 1);\n+      return this.fetchFromNetwork(this.newRequestWithMetadata(res.url, req), redirectLimit - 1);\n     }\n \n     return res;\n@@ -413,7 +411,7 @@ export abstract class AssetGroup {\n         // data, or because the version on the server really doesn't match. A cache-busting\n         // request will differentiate these two situations.\n         // TODO: handle case where the URL has parameters already (unlikely for assets).\n-        const cacheBustReq = this.adapter.newRequest(this.cacheBust(req.url));\n+        const cacheBustReq = this.newRequestWithMetadata(this.cacheBust(req.url), req);\n         response = await this.safeFetch(cacheBustReq);\n \n         // If the response was successful, check the contents against the canonical hash.\n@@ -476,6 +474,24 @@ export abstract class AssetGroup {\n     return false;\n   }\n \n+  /**\n+   * Create a new `Request` based on the specified URL and `RequestInit` options, preserving only\n+   * metadata that are known to be safe.\n+   *\n+   * Currently, only headers are preserved.\n+   *\n+   * NOTE:\n+   *   Things like credential inclusion are intentionally omitted to avoid issues with opaque\n+   *   responses.\n+   *\n+   * TODO(gkalpak):\n+   *   Investigate preserving more metadata. See, also, discussion on preserving `mode`:\n+   *   https://github.com/angular/angular/issues/41931#issuecomment-1227601347\n+   */\n+  private newRequestWithMetadata(url: string, options: RequestInit): Request {\n+    return this.adapter.newRequest(url, {headers: options.headers});\n+  }\n+\n   /**\n    * Construct a cache-busting URL for a given URL.\n    */\n\n---\n file path A: packages/service-worker/worker/test/happy_spec.ts | file path B: packages/service-worker/worker/test/happy_spec.ts\n\n@@ -35,6 +35,7 @@ const dist =\n         .addFile('/redirect-target.txt', 'this was a redirect')\n         .addFile('/lazy/unchanged1.txt', 'this is unchanged (1)')\n         .addFile('/lazy/unchanged2.txt', 'this is unchanged (2)')\n+        .addFile('/lazy/redirect-target.txt', 'this was a redirect too')\n         .addUnhashedFile('/unhashed/a.txt', 'this is unhashed', {'Cache-Control': 'max-age=10'})\n         .addUnhashedFile('/unhashed/b.txt', 'this is unhashed b', {'Cache-Control': 'no-cache'})\n         .addUnhashedFile('/api/foo', 'this is api foo', {'Cache-Control': 'no-cache'})\n@@ -161,6 +162,7 @@ const manifest: Manifest = {\n       urls: [\n         '/baz.txt',\n         '/qux.txt',\n+        '/lazy/redirected.txt',\n       ],\n       patterns: [],\n       cacheQueryOptions: {ignoreVary: true},\n@@ -270,6 +272,7 @@ const manifestUpdate: Manifest = {\n const serverBuilderBase = new MockServerStateBuilder()\n                               .withStaticFiles(dist)\n                               .withRedirect('/redirected.txt', '/redirect-target.txt')\n+                              .withRedirect('/lazy/redirected.txt', '/lazy/redirect-target.txt')\n                               .withError('/error.txt');\n \n const server = serverBuilderBase.withManifest(manifest).build();\n@@ -1578,6 +1581,71 @@ describe('Driver', () => {\n     });\n   });\n \n+  describe('request metadata', () => {\n+    it('passes headers through to the server', async () => {\n+      // Request a lazy-cached asset (so that it is fetched from the network) and provide headers.\n+      const reqInit = {\n+        headers: {SomeHeader: 'SomeValue'},\n+      };\n+      expect(await makeRequest(scope, '/baz.txt', undefined, reqInit)).toBe('this is baz');\n+\n+      // Verify that the headers were passed through to the network.\n+      const [bazReq] = server.getRequestsFor('/baz.txt');\n+      expect(bazReq.headers.get('SomeHeader')).toBe('SomeValue');\n+    });\n+\n+    it('does not pass non-allowed metadata through to the server', async () => {\n+      // Request a lazy-cached asset (so that it is fetched from the network) and provide some\n+      // metadata.\n+      const reqInit = {\n+        credentials: 'include',\n+        mode: 'same-origin',\n+        unknownOption: 'UNKNOWN',\n+      };\n+      expect(await makeRequest(scope, '/baz.txt', undefined, reqInit)).toBe('this is baz');\n+\n+      // Verify that the metadata were not passed through to the network.\n+      const [bazReq] = server.getRequestsFor('/baz.txt');\n+      expect(bazReq.credentials).toBe('same-origin');  // The default value.\n+      expect(bazReq.mode).toBe('cors');                // The default value.\n+      expect((bazReq as any).unknownOption).toBeUndefined();\n+    });\n+\n+    describe('for redirect requests', () => {\n+      it('passes headers through to the server', async () => {\n+        // Request a redirected, lazy-cached asset (so that it is fetched from the network) and\n+        // provide headers.\n+        const reqInit = {\n+          headers: {SomeHeader: 'SomeValue'},\n+        };\n+        expect(await makeRequest(scope, '/lazy/redirected.txt', undefined, reqInit))\n+            .toBe('this was a redirect too');\n+\n+        // Verify that the headers were passed through to the network.\n+        const [redirectReq] = server.getRequestsFor('/lazy/redirect-target.txt');\n+        expect(redirectReq.headers.get('SomeHeader')).toBe('SomeValue');\n+      });\n+\n+      it('does not pass non-allowed metadata through to the server', async () => {\n+        // Request a redirected, lazy-cached asset (so that it is fetched from the network) and\n+        // provide some metadata.\n+        const reqInit = {\n+          credentials: 'include',\n+          mode: 'same-origin',\n+          unknownOption: 'UNKNOWN',\n+        };\n+        expect(await makeRequest(scope, '/lazy/redirected.txt', undefined, reqInit))\n+            .toBe('this was a redirect too');\n+\n+        // Verify that the metadata were not passed through to the network.\n+        const [redirectReq] = server.getRequestsFor('/lazy/redirect-target.txt');\n+        expect(redirectReq.credentials).toBe('same-origin');  // The default value.\n+        expect(redirectReq.mode).toBe('cors');                // The default value.\n+        expect((redirectReq as any).unknownOption).toBeUndefined();\n+      });\n+    });\n+  });\n+\n   describe('unhashed requests', () => {\n     beforeEach(async () => {\n       expect(await makeRequest(scope, '/foo.txt')).toEqual('this is foo');\n\n---\n file path A: packages/service-worker/worker/testing/mock.ts | file path B: packages/service-worker/worker/testing/mock.ts\n\n@@ -179,6 +179,10 @@ export class MockServerState {\n     this.resolve = null;\n   }\n \n+  getRequestsFor(url: string): Request[] {\n+    return this.requests.filter(req => req.url.split('?')[0] === url);\n+  }\n+\n   assertSawRequestFor(url: string): void {\n     if (!this.sawRequestFor(url)) {\n       throw new Error(`Expected request for ${url}, got none.`);\n@@ -192,7 +196,7 @@ export class MockServerState {\n   }\n \n   sawRequestFor(url: string): boolean {\n-    const matching = this.requests.filter(req => req.url.split('?')[0] === url);\n+    const matching = this.getRequestsFor(url);\n     if (matching.length > 0) {\n       this.requests = this.requests.filter(req => req !== matching[0]);\n       return true;\n\n\n###\n\n", "completion": "fix(service-worker): include headers in requests for assets (#<issue-num>)"}
{"prompt": " file path A: packages/service-worker/worker/test/happy_spec.ts | file path B: packages/service-worker/worker/test/happy_spec.ts\n\n@@ -32,6 +32,7 @@ const dist =\n         .addFile('/qux.txt', 'this is qux')\n         .addFile('/quux.txt', 'this is quux')\n         .addFile('/quuux.txt', 'this is quuux')\n+        .addFile('/redirect-target.txt', 'this was a redirect')\n         .addFile('/lazy/unchanged1.txt', 'this is unchanged (1)')\n         .addFile('/lazy/unchanged2.txt', 'this is unchanged (2)')\n         .addUnhashedFile('/unhashed/a.txt', 'this is unhashed', {'Cache-Control': 'max-age=10'})\n@@ -48,6 +49,7 @@ const distUpdate =\n         .addFile('/qux.txt', 'this is qux v2')\n         .addFile('/quux.txt', 'this is quux v2')\n         .addFile('/quuux.txt', 'this is quuux v2')\n+        .addFile('/redirect-target.txt', 'this was a redirect')\n         .addFile('/lazy/unchanged1.txt', 'this is unchanged (1)')\n         .addFile('/lazy/unchanged2.txt', 'this is unchanged (2)')\n         .addUnhashedFile('/unhashed/a.txt', 'this is unhashed v2', {'Cache-Control': 'max-age=10'})\n@@ -265,23 +267,21 @@ const manifestUpdate: Manifest = {\n   hashTable: tmpHashTableForFs(distUpdate),\n };\n \n-const serverBuilderBase =\n-    new MockServerStateBuilder()\n-        .withStaticFiles(dist)\n-        .withRedirect('/redirected.txt', '/redirect-target.txt', 'this was a redirect')\n-        .withError('/error.txt');\n+const serverBuilderBase = new MockServerStateBuilder()\n+                              .withStaticFiles(dist)\n+                              .withRedirect('/redirected.txt', '/redirect-target.txt')\n+                              .withError('/error.txt');\n \n const server = serverBuilderBase.withManifest(manifest).build();\n \n const serverRollback =\n     serverBuilderBase.withManifest({...manifest, timestamp: manifest.timestamp + 1}).build();\n \n-const serverUpdate =\n-    new MockServerStateBuilder()\n-        .withStaticFiles(distUpdate)\n-        .withManifest(manifestUpdate)\n-        .withRedirect('/redirected.txt', '/redirect-target.txt', 'this was a redirect')\n-        .build();\n+const serverUpdate = new MockServerStateBuilder()\n+                         .withStaticFiles(distUpdate)\n+                         .withManifest(manifestUpdate)\n+                         .withRedirect('/redirected.txt', '/redirect-target.txt')\n+                         .build();\n \n const brokenServer =\n     new MockServerStateBuilder().withStaticFiles(brokenFs).withManifest(brokenManifest).build();\n\n---\n file path A: packages/service-worker/worker/testing/mock.ts | file path B: packages/service-worker/worker/testing/mock.ts\n\n@@ -104,9 +104,8 @@ export class MockServerStateBuilder {\n     return this;\n   }\n \n-  withRedirect(from: string, to: string, toContents: string): MockServerStateBuilder {\n-    this.resources.set(from, new MockResponse(toContents, {redirected: true, url: to}));\n-    this.resources.set(to, new MockResponse(toContents));\n+  withRedirect(from: string, to: string): MockServerStateBuilder {\n+    this.resources.set(from, new MockResponse('', {redirected: true, url: to}));\n     return this;\n   }\n \n\n\n###\n\n", "completion": "test(service-worker): simplify how redirects are defined in `MockServerState` (#<issue-num>)"}
{"prompt": " file path A: packages/service-worker/worker/testing/fetch.ts | file path B: packages/service-worker/worker/testing/fetch.ts\n\n@@ -100,7 +100,7 @@ export class MockRequest extends MockBody implements Request {\n   readonly isHistoryNavigation: boolean = false;\n   readonly isReloadNavigation: boolean = false;\n   readonly cache: RequestCache = 'default';\n-  readonly credentials: RequestCredentials = 'omit';\n+  readonly credentials: RequestCredentials = 'same-origin';\n   readonly destination: RequestDestination = 'document';\n   readonly headers: Headers = new MockHeaders();\n   readonly integrity: string = '';\n\n\n###\n\n", "completion": "test(service-worker): fix default value of `Request#credentials` (`omit` --> `same-origin`) (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/service-worker-config.md | file path B: aio/content/guide/service-worker-config.md\n\n@@ -376,6 +376,7 @@ This optional section enables you to specify a custom list of URLs that will be\n The ServiceWorker redirects navigation requests that don't match any `asset` or `data` group to the specified [index file](#index-file).\n A request is considered to be a navigation request if:\n \n+*   Its [method](https://developer.mozilla.org/docs/Web/API/Request/method) is `GET`\n *   Its [mode](https://developer.mozilla.org/docs/Web/API/Request/mode) is `navigation`\n *   It accepts a `text/html` response as determined by the value of the `Accept` header\n *   Its URL matches the following criteria:\n\n---\n file path A: packages/service-worker/worker/src/app-version.ts | file path B: packages/service-worker/worker/src/app-version.ts\n\n@@ -203,10 +203,10 @@ export class AppVersion implements UpdateSource {\n \n   /**\n    * Determine whether the request is a navigation request.\n-   * Takes into account: Request mode, `Accept` header, `navigationUrls` patterns.\n+   * Takes into account: Request method and mode, `Accept` header, `navigationUrls` patterns.\n    */\n   isNavigationRequest(req: Request): boolean {\n-    if (req.mode !== 'navigate') {\n+    if (req.method !== 'GET' || req.mode !== 'navigate') {\n       return false;\n     }\n \n\n---\n file path A: packages/service-worker/worker/test/happy_spec.ts | file path B: packages/service-worker/worker/test/happy_spec.ts\n\n@@ -1704,6 +1704,14 @@ describe('Driver', () => {\n       server.assertNoOtherRequests();\n     });\n \n+    it('does not redirect to index on a non-GET request', async () => {\n+      expect(await navRequest('/baz', {method: 'POST'})).toBeNull();\n+      server.assertSawRequestFor('/baz');\n+\n+      expect(await navRequest('/qux', {method: 'PUT'})).toBeNull();\n+      server.assertSawRequestFor('/qux');\n+    });\n+\n     it('does not redirect to index on a non-navigation request', async () => {\n       expect(await navRequest('/baz', {mode: undefined})).toBeNull();\n       server.assertSawRequestFor('/baz');\n\n\n###\n\n", "completion": "fix(service-worker): only consider GET requests as navigation requests (#<issue-num>)"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -158,10 +158,10 @@ cldr_xml_data_repository(\n # sass rules\n http_archive(\n     name = \"io_bazel_rules_sass\",\n-    sha256 = \"926cdd6133926a69e557172cb3232d5dac64ec6b8f167b7dceecd96cc4c6f19b\",\n-    strip_prefix = \"rules_sass-6802532fce57dee2a17be221d82cf441a923aeb7\",\n+    sha256 = \"a5ff47737667d644dba00af5444b6723fd5ddae2db80ee2f1e202bf0ccfcd4ef\",\n+    strip_prefix = \"rules_sass-f3874ae3ddbdab73a0a0e7bc14909d498c464ad9\",\n     urls = [\n-        \"https://github.com/bazelbuild/rules_sass/archive/6802532fce57dee2a17be221d82cf441a923aeb7.zip\",\n+        \"https://github.com/bazelbuild/rules_sass/archive/f3874ae3ddbdab73a0a0e7bc14909d498c464ad9.zip\",\n     ],\n )\n \n\n\n###\n\n", "completion": "build: update io_bazel_rules_sass digest to f3874ae (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/provide_router.ts | file path B: packages/router/src/provide_router.ts\n\n@@ -290,7 +290,7 @@ export function withEnabledBlockingInitialNavigation(): EnabledBlockingInitialNa\n       deps: [Injector],\n       useFactory: (injector: Injector) => {\n         const locationInitialized: Promise<any> =\n-            injector.get(LOCATION_INITIALIZED, Promise.resolve(null));\n+            injector.get(LOCATION_INITIALIZED, Promise.resolve());\n         let initNavigation = false;\n \n         /**\n\n\n###\n\n", "completion": "refactor(router): remove unnecesary `null` (#<issue-num>)"}
{"prompt": " file path A: packages/common/testing/src/mock_platform_location.ts | file path B: packages/common/testing/src/mock_platform_location.ts\n\n@@ -240,5 +240,5 @@ export class MockPlatformLocation implements PlatformLocation {\n }\n \n export function scheduleMicroTask(cb: () => any) {\n-  Promise.resolve(null).then(cb);\n+  Promise.resolve().then(cb);\n }\n\n\n###\n\n", "completion": "refactor(common): remove unnecesary `null` (#<issue-num>)"}
{"prompt": " file path A: packages/animations/src/util.ts | file path B: packages/animations/src/util.ts\n\n@@ -6,5 +6,5 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n export function scheduleMicroTask(cb: () => any) {\n-  Promise.resolve(null).then(cb);\n+  Promise.resolve().then(cb);\n }\n\n---\n file path A: packages/animations/test/util_spec.ts | file path B: packages/animations/test/util_spec.ts\n\n@@ -14,7 +14,7 @@ import {scheduleMicroTask} from '../src/util';\n       scheduleMicroTask(() => count++);\n \n       expect(count).toEqual(0);\n-      Promise.resolve(null).then(() => {\n+      Promise.resolve().then(() => {\n         expect(count).toEqual(1);\n         done();\n       });\n\n\n###\n\n", "completion": "refactor(animations): remove unnecesary `null` (#<issue-num>)"}
{"prompt": " file path A: packages/forms/src/directives/ng_form.ts | file path B: packages/forms/src/directives/ng_form.ts\n\n@@ -26,7 +26,7 @@ export const formDirectiveProvider: any = {\n   useExisting: forwardRef(() => NgForm)\n };\n \n-const resolvedPromise = (() => Promise.resolve(null))();\n+const resolvedPromise = (() => Promise.resolve())();\n \n /**\n  * @description\n\n---\n file path A: packages/forms/src/directives/ng_model.ts | file path B: packages/forms/src/directives/ng_model.ts\n\n@@ -44,7 +44,7 @@ export const formControlBinding: any = {\n  * - this is just one extra run no matter how many `ngModel`s have been changed.\n  * - this is a general problem when using `exportAs` for directives!\n  */\n-const resolvedPromise = (() => Promise.resolve(null))();\n+const resolvedPromise = (() => Promise.resolve())();\n \n /**\n  * @description\n\n---\n file path A: packages/forms/test/util.ts | file path B: packages/forms/test/util.ts\n\n@@ -80,7 +80,7 @@ export function currentStateOf(controls: AbstractControl[]):\n  */\n export function asyncValidatorReturningObservable(c: AbstractControl): EventEmitter<any> {\n   const e = new EventEmitter();\n-  Promise.resolve(null).then(() => {\n+  Promise.resolve().then(() => {\n     e.emit({'async': true});\n   });\n   return e;\n\n\n###\n\n", "completion": "refactor(forms): remove unnecesary `null` (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/preconnect_link_checker.ts | file path B: packages/common/src/directives/ng_optimized_image/preconnect_link_checker.ts\n\n@@ -49,6 +49,8 @@ export const PRECONNECT_CHECK_BLOCKLIST =\n  */\n @Injectable({providedIn: 'root'})\n export class PreconnectLinkChecker {\n+  private document = inject(DOCUMENT);\n+\n   /**\n    * Set of <link rel=\"preconnect\"> tags found on this page.\n    * The `null` value indicates that there was no DOM query operation performed.\n@@ -66,7 +68,7 @@ export class PreconnectLinkChecker {\n \n   constructor() {\n     assertDevMode('preconnect link checker');\n-    const win = inject(DOCUMENT).defaultView;\n+    const win = this.document.defaultView;\n     if (typeof win !== 'undefined') {\n       this.window = win;\n     }\n@@ -127,7 +129,7 @@ export class PreconnectLinkChecker {\n   private queryPreconnectLinks(): Set<string> {\n     const preconnectUrls = new Set<string>();\n     const selector = 'link[rel=preconnect]';\n-    const links: HTMLLinkElement[] = Array.from(document.querySelectorAll(selector));\n+    const links: HTMLLinkElement[] = Array.from(this.document.querySelectorAll(selector));\n     for (let link of links) {\n       const url = getUrl(link.href, this.window!);\n       preconnectUrls.add(url.origin);\n\n\n###\n\n", "completion": "fix(common): use DOCUMENT token to query for preconnect links (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -585,19 +585,19 @@ function assertNoImageDistortion(\n           RuntimeErrorCode.INVALID_INPUT,\n           `${imgDirectiveDetails(dir.rawSrc)} the aspect ratio of the image does not match ` +\n               `the aspect ratio indicated by the width and height attributes. ` +\n-              `Intrinsic image size: ${intrinsicWidth}w x ${intrinsicHeight}h ` +\n-              `(aspect-ratio: ${intrinsicAspectRatio}). Supplied width and height attributes: ` +\n+              `\\nIntrinsic image size: ${intrinsicWidth}w x ${intrinsicHeight}h ` +\n+              `(aspect-ratio: ${intrinsicAspectRatio}). \\nSupplied width and height attributes: ` +\n               `${suppliedWidth}w x ${suppliedHeight}h (aspect-ratio: ${suppliedAspectRatio}). ` +\n-              `To fix this, update the width and height attributes.`));\n+              `\\nTo fix this, update the width and height attributes.`));\n     } else if (stylingDistortion) {\n       console.warn(formatRuntimeError(\n           RuntimeErrorCode.INVALID_INPUT,\n           `${imgDirectiveDetails(dir.rawSrc)} the aspect ratio of the rendered image ` +\n               `does not match the image's intrinsic aspect ratio. ` +\n-              `Intrinsic image size: ${intrinsicWidth}w x ${intrinsicHeight}h ` +\n-              `(aspect-ratio: ${intrinsicAspectRatio}). Rendered image size: ` +\n+              `\\nIntrinsic image size: ${intrinsicWidth}w x ${intrinsicHeight}h ` +\n+              `(aspect-ratio: ${intrinsicAspectRatio}). \\nRendered image size: ` +\n               `${renderedWidth}w x ${renderedHeight}h (aspect-ratio: ` +\n-              `${renderedAspectRatio}). This issue can occur if \"width\" and \"height\" ` +\n+              `${renderedAspectRatio}). \\nThis issue can occur if \"width\" and \"height\" ` +\n               `attributes are added to an image without updating the corresponding ` +\n               `image styling. To fix this, adjust image styling. In most cases, ` +\n               `adding \"height: auto\" or \"width: auto\" to the image styling will fix ` +\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/image-distortion/image-distortion.e2e-spec.ts | file path B: packages/core/test/bundling/image-directive/e2e/image-distortion/image-distortion.e2e-spec.ts\n\n@@ -38,18 +38,18 @@ describe('NgOptimizedImage directive', () => {\n         'The NgOptimizedImage directive (activated on an \\\\u003Cimg> element ' +\n             'with the \\`rawSrc=\\\\\"/e2e/b.png\\\\\"`) has detected that ' +\n             'the aspect ratio of the image does not match the aspect ratio indicated by the width and height attributes. ' +\n-            'Intrinsic image size: 250w x 250h (aspect-ratio: 1). ' +\n-            'Supplied width and height attributes: 26w x 30h (aspect-ratio: 0.8666666666666667). ' +\n-            'To fix this, update the width and height attributes.');\n+            '\\\\nIntrinsic image size: 250w x 250h (aspect-ratio: 1). ' +\n+            '\\\\nSupplied width and height attributes: 26w x 30h (aspect-ratio: 0.8666666666666667). ' +\n+            '\\\\nTo fix this, update the width and height attributes.');\n \n     expectErrorMessageInLogs(\n         logs,\n         'The NgOptimizedImage directive (activated on an \\\\u003Cimg> element ' +\n             'with the \\`rawSrc=\\\\\"/e2e/b.png\\\\\"`) has detected that ' +\n             'the aspect ratio of the image does not match the aspect ratio indicated by the width and height attributes. ' +\n-            'Intrinsic image size: 250w x 250h (aspect-ratio: 1). ' +\n-            'Supplied width and height attributes: 24w x 240h (aspect-ratio: 0.1). ' +\n-            'To fix this, update the width and height attributes.');\n+            '\\\\nIntrinsic image size: 250w x 250h (aspect-ratio: 1). ' +\n+            '\\\\nSupplied width and height attributes: 24w x 240h (aspect-ratio: 0.1). ' +\n+            '\\\\nTo fix this, update the width and height attributes.');\n \n     // Images with incorrect styling\n     expectErrorMessageInLogs(\n@@ -57,9 +57,9 @@ describe('NgOptimizedImage directive', () => {\n         'The NgOptimizedImage directive (activated on an \\\\u003Cimg> element ' +\n             'with the \\`rawSrc=\\\\\"/e2e/b.png\\\\\"`) has detected that ' +\n             'the aspect ratio of the rendered image does not match the image\\'s intrinsic aspect ratio. ' +\n-            'Intrinsic image size: 250w x 250h (aspect-ratio: 1). ' +\n-            'Rendered image size: 250w x 30h (aspect-ratio: 8.333333333333334). ' +\n-            'This issue can occur if \\\\\"width\\\\\" and \\\\\"height\\\\\" attributes are added to an image ' +\n+            '\\\\nIntrinsic image size: 250w x 250h (aspect-ratio: 1). ' +\n+            '\\\\nRendered image size: 250w x 30h (aspect-ratio: 8.333333333333334). ' +\n+            '\\\\nThis issue can occur if \\\\\"width\\\\\" and \\\\\"height\\\\\" attributes are added to an image ' +\n             'without updating the corresponding image styling. To fix this, adjust image styling. In most cases, ' +\n             'adding \\\\\"height: auto\\\\\" or \\\\\"width: auto\\\\\" to the image styling will fix this issue.');\n \n@@ -68,9 +68,9 @@ describe('NgOptimizedImage directive', () => {\n         'The NgOptimizedImage directive (activated on an \\\\u003Cimg> element ' +\n             'with the \\`rawSrc=\\\\\"/e2e/b.png\\\\\"`) has detected that ' +\n             'the aspect ratio of the rendered image does not match the image\\'s intrinsic aspect ratio. ' +\n-            'Intrinsic image size: 250w x 250h (aspect-ratio: 1). ' +\n-            'Rendered image size: 30w x 250h (aspect-ratio: 0.12). ' +\n-            'This issue can occur if \\\\\"width\\\\\" and \\\\\"height\\\\\" attributes are added to an image ' +\n+            '\\\\nIntrinsic image size: 250w x 250h (aspect-ratio: 1). ' +\n+            '\\\\nRendered image size: 30w x 250h (aspect-ratio: 0.12). ' +\n+            '\\\\nThis issue can occur if \\\\\"width\\\\\" and \\\\\"height\\\\\" attributes are added to an image ' +\n             'without updating the corresponding image styling. To fix this, adjust image styling. In most cases, ' +\n             'adding \\\\\"height: auto\\\\\" or \\\\\"width: auto\\\\\" to the image styling will fix this issue.');\n \n@@ -82,8 +82,8 @@ describe('NgOptimizedImage directive', () => {\n         'The NgOptimizedImage directive (activated on an \\\\u003Cimg> element ' +\n             'with the \\`rawSrc=\\\\\"/e2e/b.png\\\\\"`) has detected that ' +\n             'the aspect ratio of the image does not match the aspect ratio indicated by the width and height attributes. ' +\n-            'Intrinsic image size: 250w x 250h (aspect-ratio: 1). ' +\n-            'Supplied width and height attributes: 150w x 250h (aspect-ratio: 0.6). ' +\n-            'To fix this, update the width and height attributes.');\n+            '\\\\nIntrinsic image size: 250w x 250h (aspect-ratio: 1). ' +\n+            '\\\\nSupplied width and height attributes: 150w x 250h (aspect-ratio: 0.6). ' +\n+            '\\\\nTo fix this, update the width and height attributes.');\n   });\n });\n\n\n###\n\n", "completion": "fix(common): improve formatting of image warnings (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -114,7 +114,7 @@\n     \"@angular/cli\": \"~14.0.0\",\n     \"@angular/compiler-cli\": \"^14.2.0-rc\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n-    \"@types/jasmine\": \"~4.0.0\",\n+    \"@types/jasmine\": \"~4.3.0\",\n     \"@types/lunr\": \"^2.3.3\",\n     \"@types/node\": \"^12.7.9\",\n     \"@types/trusted-types\": \"^2.0.2\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/cli-ajs/package.json | file path B: aio/tools/examples/shared/boilerplate/cli-ajs/package.json\n\n@@ -34,7 +34,7 @@\n     \"@angular/compiler-cli\": \"^14.1.0\",\n     \"@types/angular\": \"^1.8.4\",\n     \"@types/angular-route\": \"^1.7.2\",\n-    \"@types/jasmine\": \"~4.0.0\",\n+    \"@types/jasmine\": \"~4.3.0\",\n     \"@types/node\": \"^16.11.35\",\n     \"jasmine-core\": \"~4.3.0\",\n     \"jasmine-marbles\": \"~0.9.2\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/cli/package.json | file path B: aio/tools/examples/shared/boilerplate/cli/package.json\n\n@@ -30,7 +30,7 @@\n     \"@angular-devkit/build-angular\": \"^14.1.0\",\n     \"@angular/cli\": \"^14.1.0\",\n     \"@angular/compiler-cli\": \"^14.1.0\",\n-    \"@types/jasmine\": \"~4.0.0\",\n+    \"@types/jasmine\": \"~4.3.0\",\n     \"@types/node\": \"^16.11.35\",\n     \"copyfiles\": \"^2.4.1\",\n     \"jasmine-core\": \"~4.3.0\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/elements/package.json | file path B: aio/tools/examples/shared/boilerplate/elements/package.json\n\n@@ -31,7 +31,7 @@\n     \"@angular-devkit/build-angular\": \"^14.1.0\",\n     \"@angular/cli\": \"^14.1.0\",\n     \"@angular/compiler-cli\": \"^14.1.0\",\n-    \"@types/jasmine\": \"~4.0.0\",\n+    \"@types/jasmine\": \"~4.3.0\",\n     \"@types/node\": \"^16.11.35\",\n     \"jasmine-core\": \"~4.3.0\",\n     \"jasmine-marbles\": \"~0.9.2\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/i18n/package.json | file path B: aio/tools/examples/shared/boilerplate/i18n/package.json\n\n@@ -33,7 +33,7 @@\n     \"@angular-devkit/build-angular\": \"^14.1.0\",\n     \"@angular/cli\": \"^14.1.0\",\n     \"@angular/compiler-cli\": \"^14.1.0\",\n-    \"@types/jasmine\": \"~4.0.0\",\n+    \"@types/jasmine\": \"~4.3.0\",\n     \"@types/node\": \"^16.11.35\",\n     \"jasmine-core\": \"~4.3.0\",\n     \"jasmine-marbles\": \"~0.9.2\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/service-worker/package.json | file path B: aio/tools/examples/shared/boilerplate/service-worker/package.json\n\n@@ -31,7 +31,7 @@\n     \"@angular-devkit/build-angular\": \"^14.1.0\",\n     \"@angular/cli\": \"^14.1.0\",\n     \"@angular/compiler-cli\": \"^14.1.0\",\n-    \"@types/jasmine\": \"~4.0.0\",\n+    \"@types/jasmine\": \"~4.3.0\",\n     \"@types/node\": \"^16.11.35\",\n     \"jasmine-core\": \"~4.3.0\",\n     \"jasmine-marbles\": \"~0.9.2\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/systemjs/package.json | file path B: aio/tools/examples/shared/boilerplate/systemjs/package.json\n\n@@ -50,7 +50,7 @@\n     \"@types/angular-mocks\": \"^1.7.1\",\n     \"@types/angular-resource\": \"^1.5.17\",\n     \"@types/angular-route\": \"^1.7.2\",\n-    \"@types/jasmine\": \"~4.0.0\",\n+    \"@types/jasmine\": \"~4.3.0\",\n     \"@types/node\": \"^16.11.35\",\n     \"concurrently\": \"^7.0.0\",\n     \"http-server\": \"^14.0.0\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/universal/package.json | file path B: aio/tools/examples/shared/boilerplate/universal/package.json\n\n@@ -39,7 +39,7 @@\n     \"@angular/compiler-cli\": \"^14.1.0\",\n     \"@nguniversal/builders\": \"^14.1.0\",\n     \"@types/express\": \"^4.17.13\",\n-    \"@types/jasmine\": \"~4.0.0\",\n+    \"@types/jasmine\": \"~4.3.0\",\n     \"@types/node\": \"^16.11.35\",\n     \"jasmine-core\": \"~4.3.0\",\n     \"jasmine-marbles\": \"~0.9.2\",\n\n---\n file path A: aio/tools/examples/shared/package.json | file path B: aio/tools/examples/shared/package.json\n\n@@ -59,7 +59,7 @@\n     \"@types/angular-resource\": \"^1.5.17\",\n     \"@types/angular-route\": \"^1.7.2\",\n     \"@types/express\": \"^4.17.13\",\n-    \"@types/jasmine\": \"~4.0.0\",\n+    \"@types/jasmine\": \"~4.3.0\",\n     \"@types/jquery\": \"3.5.14\",\n     \"@types/node\": \"^16.11.35\",\n     \"canonical-path\": \"1.0.0\",\n\n---\n file path A: aio/tools/examples/shared/yarn.lock | file path B: aio/tools/examples/shared/yarn.lock\n\n@@ -1876,10 +1876,10 @@\n   dependencies:\n     \"@types/node\" \"*\"\n \n-\"@types/jasmine@~4.0.0\":\n-  version \"4.0.3\"\n-  resolved \"https://registry.yarnpkg.com/@types/jasmine/-/jasmine-4.0.3.tgz#097ce710d70eb7f3662e96c1f75824dd22c27d5c\"\n-  integrity sha512-Opp1LvvEuZdk8fSSvchK2mZwhVrsNT0JgJE9Di6MjnaIpmEXM8TLCPPrVtNTYh8+5MPdY8j9bAHMu2SSfwpZJg==\n+\"@types/jasmine@~4.3.0\":\n+  version \"4.3.0\"\n+  resolved \"https://registry.yarnpkg.com/@types/jasmine/-/jasmine-4.3.0.tgz#1dfdfb226820911addb1b5a9031422be72c53aac\"\n+  integrity sha512-u1jWakf8CWvLfSEZyxmzkgBzOEvXH/szpT0e6G8BTkx5Eu0BhDn7sbc5dz0JBN/6Wwm9rBe+JAsk9tJRyH9ZkA==\n \n \"@types/jquery@3.5.14\":\n   version \"3.5.14\"\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -2201,10 +2201,10 @@\n   dependencies:\n     \"@types/node\" \"*\"\n \n-\"@types/jasmine@~4.0.0\":\n-  version \"4.0.3\"\n-  resolved \"https://registry.yarnpkg.com/@types/jasmine/-/jasmine-4.0.3.tgz#097ce710d70eb7f3662e96c1f75824dd22c27d5c\"\n-  integrity sha512-Opp1LvvEuZdk8fSSvchK2mZwhVrsNT0JgJE9Di6MjnaIpmEXM8TLCPPrVtNTYh8+5MPdY8j9bAHMu2SSfwpZJg==\n+\"@types/jasmine@~4.3.0\":\n+  version \"4.3.0\"\n+  resolved \"https://registry.yarnpkg.com/@types/jasmine/-/jasmine-4.3.0.tgz#1dfdfb226820911addb1b5a9031422be72c53aac\"\n+  integrity sha512-u1jWakf8CWvLfSEZyxmzkgBzOEvXH/szpT0e6G8BTkx5Eu0BhDn7sbc5dz0JBN/6Wwm9rBe+JAsk9tJRyH9ZkA==\n \n \"@types/json-schema@*\", \"@types/json-schema@^7.0.5\", \"@types/json-schema@^7.0.6\", \"@types/json-schema@^7.0.8\", \"@types/json-schema@^7.0.9\":\n   version \"7.0.11\"\n\n---\n file path A: integration/bazel_workspace_tests/bazel_ngtsc_plugin/WORKSPACE | file path B: integration/bazel_workspace_tests/bazel_ngtsc_plugin/WORKSPACE\n\n@@ -12,10 +12,10 @@ http_archive(\n # Fetch sass rules for compiling sass files\n http_archive(\n     name = \"io_bazel_rules_sass\",\n-    sha256 = \"5de9705b00dcabe36d6c10d95fa47f519b1639f034f37ad526e4e9eaac90b0d2\",\n-    strip_prefix = \"rules_sass-1.54.5\",\n+    sha256 = \"0ba1a6a4ec9c8ea122eabd8d6128b03fb37745a9f2027dbd1e1d732a8d966f23\",\n+    strip_prefix = \"rules_sass-1.54.8\",\n     urls = [\n-        \"https://github.com/bazelbuild/rules_sass/archive/1.54.5.zip\",\n+        \"https://github.com/bazelbuild/rules_sass/archive/1.54.8.zip\",\n     ],\n )\n \n\n---\n file path A: package.json | file path B: package.json\n\n@@ -85,10 +85,10 @@\n     \"@types/babel__core\": \"7.1.19\",\n     \"@types/babel__generator\": \"7.6.4\",\n     \"@types/babel__template\": \"7.4.1\",\n-    \"@types/babel__traverse\": \"7.18.0\",\n+    \"@types/babel__traverse\": \"7.18.1\",\n     \"@types/base64-js\": \"1.3.0\",\n     \"@types/bluebird\": \"^3.5.27\",\n-    \"@types/chrome\": \"^0.0.195\",\n+    \"@types/chrome\": \"^0.0.196\",\n     \"@types/convert-source-map\": \"^1.5.1\",\n     \"@types/diff\": \"^5.0.0\",\n     \"@types/events\": \"3.0.0\",\n@@ -136,7 +136,7 @@\n     \"jasmine\": \"^4.0.0\",\n     \"jasmine-ajax\": \"^4.0.0\",\n     \"jasmine-core\": \"^4.0.0\",\n-    \"jquery\": \"3.6.0\",\n+    \"jquery\": \"3.6.1\",\n     \"js-levenshtein\": \"^1.1.6\",\n     \"karma\": \"~6.4.0\",\n     \"karma-chrome-launcher\": \"^3.1.0\",\n@@ -144,7 +144,7 @@\n     \"karma-jasmine\": \"^5.0.0\",\n     \"karma-requirejs\": \"^1.1.0\",\n     \"karma-sourcemap-loader\": \"^0.3.7\",\n-    \"magic-string\": \"0.26.2\",\n+    \"magic-string\": \"0.26.3\",\n     \"materialize-css\": \"1.0.0\",\n     \"memo-decorator\": \"^2.0.1\",\n     \"ngx-flamegraph\": \"0.0.11\",\n@@ -153,7 +153,7 @@\n     \"puppeteer\": \"10.2.0\",\n     \"reflect-metadata\": \"^0.1.3\",\n     \"requirejs\": \"^2.3.6\",\n-    \"rollup\": \"~2.78.0\",\n+    \"rollup\": \"~2.79.0\",\n     \"rollup-plugin-preserve-shebang\": \"^1.0.1\",\n     \"rollup-plugin-sourcemaps\": \"^0.6.3\",\n     \"rxjs\": \"^6.6.7\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -2575,10 +2575,10 @@\n   dependencies:\n     \"@babel/types\" \"^7.3.0\"\n \n-\"@types/babel__traverse@7.18.0\":\n-  version \"7.18.0\"\n-  resolved \"https://registry.yarnpkg.com/@types/babel__traverse/-/babel__traverse-7.18.0.tgz#8134fd78cb39567465be65b9fdc16d378095f41f\"\n-  integrity sha512-v4Vwdko+pgymgS+A2UIaJru93zQd85vIGWObM5ekZNdXCKtDYqATlEYnWgfo86Q6I1Lh0oXnksDnMU1cwmlPDw==\n+\"@types/babel__traverse@7.18.1\":\n+  version \"7.18.1\"\n+  resolved \"https://registry.yarnpkg.com/@types/babel__traverse/-/babel__traverse-7.18.1.tgz#ce5e2c8c272b99b7a9fd69fa39f0b4cd85028bd9\"\n+  integrity sha512-FSdLaZh2UxaMuLp9lixWaHq/golWTRWOnRsAXzDTDSDOQLuZb1nsdCt6pJSPWSEQt2eFZ2YVk3oYhn+1kLMeMA==\n   dependencies:\n     \"@babel/types\" \"^7.3.0\"\n \n@@ -2627,10 +2627,10 @@\n     \"@types/node\" \"*\"\n     \"@types/responselike\" \"*\"\n \n-\"@types/chrome@^0.0.195\":\n-  version \"0.0.195\"\n-  resolved \"https://registry.yarnpkg.com/@types/chrome/-/chrome-0.0.195.tgz#c570f72857e11caa0a453a444828f75bca592cff\"\n-  integrity sha512-kmFh1xx7ehXoOVl6OjEBxmiYaquhxCaILjFGwPbW6xwbqzwDKCte+Mzl99aNWg3EP1B4rKVUuRm1vBsiRYks5g==\n+\"@types/chrome@^0.0.196\":\n+  version \"0.0.196\"\n+  resolved \"https://registry.yarnpkg.com/@types/chrome/-/chrome-0.0.196.tgz#9e0196a6fcdf3c0e12cfbcd086cd28feb5206990\"\n+  integrity sha512-LAjGIQYC0wyiYu6lVT03dBrHBfYTMsM8EmNfQ+UdZipGZe8OUiir6weoa9oQoBw3T3RLzBCp9m904T+rFtpPAg==\n   dependencies:\n     \"@types/filesystem\" \"*\"\n     \"@types/har-format\" \"*\"\n@@ -9603,10 +9603,10 @@ join-path@^1.1.1:\n     url-join \"0.0.1\"\n     valid-url \"^1\"\n \n-jquery@3.6.0:\n-  version \"3.6.0\"\n-  resolved \"https://registry.yarnpkg.com/jquery/-/jquery-3.6.0.tgz#c72a09f15c1bdce142f49dbf1170bdf8adac2470\"\n-  integrity sha512-JVzAR/AjBvVt2BmYhxRCSYysDsPcssdmTFnzyLEts9qNwmjmu4JTAMYubEfwVOSwpQ1I1sKKFcxhZCI2buerfw==\n+jquery@3.6.1:\n+  version \"3.6.1\"\n+  resolved \"https://registry.yarnpkg.com/jquery/-/jquery-3.6.1.tgz#fab0408f8b45fc19f956205773b62b292c147a16\"\n+  integrity sha512-opJeO4nCucVnsjiXOE+/PcCgYw9Gwpvs/a6B1LL/lQhwWwpbVEVYDZ1FokFr8PRc7ghYlrFPuyHuiiDNTQxmcw==\n \n js-levenshtein@^1.1.6:\n   version \"1.1.6\"\n@@ -10450,6 +10450,13 @@ magic-string@0.26.2:\n   dependencies:\n     sourcemap-codec \"^1.4.8\"\n \n+magic-string@0.26.3:\n+  version \"0.26.3\"\n+  resolved \"https://registry.yarnpkg.com/magic-string/-/magic-string-0.26.3.tgz#25840b875140f7b4785ab06bddc384270b7dd452\"\n+  integrity sha512-u1Po0NDyFcwdg2nzHT88wSK0+Rih0N1M+Ph1Sp08k8yvFFU3KR72wryS7e1qMPJypt99WB7fIFVCA92mQrMjrg==\n+  dependencies:\n+    sourcemap-codec \"^1.4.8\"\n+\n magic-string@^0.25.7:\n   version \"0.25.9\"\n   resolved \"https://registry.yarnpkg.com/magic-string/-/magic-string-0.25.9.tgz#de7f9faf91ef8a1c91d02c2e5314c8277dbcdd1c\"\n@@ -13280,10 +13287,10 @@ rollup@~1.11.3:\n     \"@types/node\" \"^11.13.9\"\n     acorn \"^6.1.1\"\n \n-rollup@~2.78.0:\n-  version \"2.78.1\"\n-  resolved \"https://registry.yarnpkg.com/rollup/-/rollup-2.78.1.tgz#52fe3934d9c83cb4f7c4cb5fb75d88591be8648f\"\n-  integrity sha512-VeeCgtGi4P+o9hIg+xz4qQpRl6R401LWEXBmxYKOV4zlF82lyhgh2hTZnheFUbANE8l2A41F458iwj2vEYaXJg==\n+rollup@~2.79.0:\n+  version \"2.79.0\"\n+  resolved \"https://registry.yarnpkg.com/rollup/-/rollup-2.79.0.tgz#9177992c9f09eb58c5e56cbfa641607a12b57ce2\"\n+  integrity sha512-x4KsrCgwQ7ZJPcFA/SUu6QVcYlO7uRLfLAy0DSA4NS2eG8japdbpM50ToH7z4iObodRYOJ0soneF0iaQRJ6zhA==\n   optionalDependencies:\n     fsevents \"~2.3.2\"\n \n\n\n###\n\n", "completion": "build: update all non-major dependencies (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/scorecard.yml | file path B: .github/workflows/scorecard.yml\n\n@@ -45,6 +45,6 @@ jobs:\n \n       # Upload the results to GitHub's code scanning dashboard.\n       - name: 'Upload to code-scanning'\n-        uses: github/codeql-action/upload-sarif@2ca79b6fa8d3ec278944088b4aa5f46912db5d63 # tag=v2.1.18\n+        uses: github/codeql-action/upload-sarif@b398f525a5587552e573b247ac661067fafa920b # tag=v2.1.22\n         with:\n           sarif_file: results.sarif\n\n\n###\n\n", "completion": "build: update github/codeql-action action to v2.1.22 (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -19,7 +19,7 @@\n     \"build-local\": \"yarn ~~build\",\n     \"prebuild-local-ci\": \"yarn setup-local-ci\",\n     \"build-local-ci\": \"yarn ~~build --progress=false\",\n-    \"extract-cli-command-docs\": \"node tools/transforms/cli-docs-package/extract-cli-commands.js 14d4d528c\",\n+    \"extract-cli-command-docs\": \"node tools/transforms/cli-docs-package/extract-cli-commands.js 4a6e62d46\",\n     \"lint\": \"yarn check-env && yarn docs-lint && ng lint && yarn example-lint && yarn tools-lint && yarn security-lint\",\n     \"test\": \"yarn check-env && ng test\",\n     \"test:bazel\": \"bazelisk test //aio:test\",\n\n\n###\n\n", "completion": "build(docs-infra): upgrade cli command docs sources to 4a6e62d46 (#<issue-num>)"}
{"prompt": " file path A: .github/ISSUE_TEMPLATE/1-bug-report.yaml | file path B: .github/ISSUE_TEMPLATE/1-bug-report.yaml\n\n@@ -23,6 +23,7 @@ body:\n         - router\n         - service-worker\n         - upgrade\n+        - zone.js\n         - Don't known / other\n       multiple: true\n     validations:\n\n\n###\n\n", "completion": "build: add zone.js to bug-report template for github (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/component-overview.md | file path B: aio/content/guide/component-overview.md\n\n@@ -1,4 +1,4 @@\n-# Angular Components Overview\n+# Angular components overview\n \n Components are the main building block for Angular applications.\n Each component consists of:\n@@ -38,7 +38,7 @@ To create a component using the Angular CLI:\n \n By default, this command creates the following:\n \n-*   A folder named after the component\n+*   A directory named after the component\n *   A component file, `<component-name>.component.ts`\n *   A template file, `<component-name>.component.html`\n *   A CSS file, `<component-name>.component.css`\n\n\n###\n\n", "completion": "docs: fix linting errors in component overview guide (#<issue-num>)"}
{"prompt": " file path A: aio/tools/doc-linter/styles/Angular/Google_WordListWarnings.yml | file path B: aio/tools/doc-linter/styles/Angular/Google_WordListWarnings.yml\n\n@@ -40,6 +40,7 @@ swap:\n   byelog: bye log\n   callout: call-out\n   callouts: call-outs\n+  camel case: camelCase\n   cellular data: mobile data\n   cellular network: mobile network\n   chapter: documents|pages|sections\n\n\n###\n\n", "completion": "docs: add substitution entry for camel case (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/class-binding.md | file path B: aio/content/guide/class-binding.md\n\n@@ -30,7 +30,7 @@ With the object format, Angular adds a class only if its associated value is tru\n \n <div class=\"alert is-important\">\n \n-With any object-like expression&mdash;such as `object`, `Array`, `Map`, or `Set`&mdash;the identity of the object must change for Angular to update the class list.\n+With any object-like expression&mdash;such as `object`, `Array`, `Map`, or `Set` &mdash;the identity of the object must change for Angular to update the class list.\n Updating the property without changing object identity has no effect.\n \n </div>\n@@ -52,7 +52,7 @@ To create a single style binding, use the prefix `style` followed by a dot and t\n \n For example, to set the `width` style, type the following:  `[style.width]=\"width\"`\n \n-Angular sets the property to the value of the bound expression, which is usually a string.  Optionally, you can add a unit extension like `em` or `%`, which requires a number type.\n+Angular sets the property to the value of the bound expression, which is usually a string. Optionally, you can add a unit extension like `em` or `%`, which requires a number type.\n \n 1. To write a style in dash-case, type the following:\n \n\n---\n file path A: aio/tools/doc-linter/styles/Vocab/Jargon.txt | file path B: aio/tools/doc-linter/styles/Vocab/Jargon.txt\n\n@@ -14,6 +14,7 @@ bundlers\n cacheable\n callout\n callouts\n+camelcase\n combinator\n composability\n config\n\n\n###\n\n", "completion": "docs: fix linting errors in class binding guide (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/architecture-components.md | file path B: aio/content/guide/architecture-components.md\n\n@@ -212,8 +212,8 @@ The example template uses two built-in structural directives to add application\n \n | Directives                                  | Details |\n |:---                                         |:---     |\n-| [`*ngFor`](guide/built-in-directives#ngFor) | An iterative, it tells Angular to stamp out one `<li>` per hero in the `heroes` list. |\n-| [`*ngIf`](guide/built-in-directives#ngIf)   | A conditional, it includes the `HeroDetail` component only if a selected hero exists. |\n+| [`*ngFor`](guide/built-in-directives#ngFor) | An *iterative*, which tells Angular to create one `<li>` per hero in the `heroes` list. |\n+| [`*ngIf`](guide/built-in-directives#ngIf)   | A *conditional*, which includes the `HeroDetail` component only if a selected hero exists. |\n \n #### Attribute directives\n \n\n\n###\n\n", "completion": "docs: apply suggestions from code review (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/architecture-components.md | file path B: aio/content/guide/architecture-components.md\n\n@@ -51,7 +51,7 @@ This example shows some of the most useful `@Component` configuration options:\n | Configuration options | Details |\n |:---                   |:---     |\n | `selector`            | A CSS selector that tells Angular to create and insert an instance of this component wherever it finds the corresponding tag in template HTML. For example, if an application's HTML contains `<app-hero-list></app-hero-list>`, then Angular inserts an instance of the `HeroListComponent` view between those tags. |\n-| `templateUrl`         | The module-relative address of this component's HTML template. Alternatively, you can provide the HTML template inline, as the value of the `template` property.  This template defines the component's *host view*.                                                                                                  |\n+| `templateUrl`         | The module-relative address of this component's HTML template. Alternatively, you can provide the HTML template inline, as the value of the `template` property. This template defines the component's *host view*.                                                                                                  |\n | `providers`           | An array of [providers](guide/glossary#provider) for services that the component requires. In the example, this tells Angular how to provide the `HeroService` instance that the component's constructor uses to get the list of heroes to display.                                                                   |\n \n ## Templates and views\n@@ -86,7 +86,7 @@ For example, here is a template for the Tutorial's `HeroListComponent`.\n \n <code-example header=\"src/app/hero-list.component.html\" path=\"architecture/src/app/hero-list.component.html\" ></code-example>\n \n-This template uses typical HTML elements like `<h2>` and  `<p>`, and also includes Angular template-syntax elements, `*ngFor`, `{{hero.name}}`, `(click)`, `[hero]`, and `<app-hero-detail>`.\n+This template uses typical HTML elements like `<h2>` and  `<p>`. It also includes Angular template-syntax elements, `*ngFor`, `{{hero.name}}`, `(click)`, `[hero]`, and `<app-hero-detail>`.\n The template-syntax elements tell Angular how to render the HTML to the screen, using program logic and data.\n \n *   The `*ngFor` directive tells Angular to iterate over a list\n@@ -154,7 +154,7 @@ Data binding plays an important role in communication between a template and its\n Angular pipes let you declare display-value transformations in your template HTML.\n A class with the `@Pipe` decorator defines a function that transforms input values to output values for display in a view.\n \n-Angular defines various pipes, such as the [date](api/common/DatePipe) pipe and [currency](api/common/CurrencyPipe) pipe; for a complete list, see the [Pipes API list](api?type=pipe).\n+Angular defines various pipes, such as the [date](api/common/DatePipe) pipe and [currency](api/common/CurrencyPipe) pipe. For a complete list, see the [Pipes API list](api?type=pipe).\n You can also define new pipes.\n \n To specify a value transformation in an HTML template, use the [pipe operator (`|`)](guide/pipes).\n@@ -212,8 +212,8 @@ The example template uses two built-in structural directives to add application\n \n | Directives                                  | Details |\n |:---                                         |:---     |\n-| [`*ngFor`](guide/built-in-directives#ngFor) | An iterative; it tells Angular to stamp out one `<li>` per hero in the `heroes` list. |\n-| [`*ngIf`](guide/built-in-directives#ngIf)   | A conditional; it includes the `HeroDetail` component only if a selected hero exists. |\n+| [`*ngFor`](guide/built-in-directives#ngFor) | An iterative, it tells Angular to stamp out one `<li>` per hero in the `heroes` list. |\n+| [`*ngIf`](guide/built-in-directives#ngIf)   | A conditional, it includes the `HeroDetail` component only if a selected hero exists. |\n \n #### Attribute directives\n \n\n\n###\n\n", "completion": "docs: fix linting errors in architecture components guide (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/migration-undecorated-classes.md | file path B: aio/content/guide/migration-undecorated-classes.md\n\n@@ -65,7 +65,7 @@ class BaseMenu {}\n \n &commat;Component({\n   selector: 'base-menu',\n-  template: '&lt;div&gt;&lt;/div*gt;'\n+  template: '&lt;div&gt;&lt;/div&gt;'\n })\n export class SettingsMenu extends BaseMenu {}\n \n\n\n###\n\n", "completion": "docs: formatting issue (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/angular-package-format.md | file path B: aio/content/guide/angular-package-format.md\n\n@@ -267,7 +267,7 @@ Not all libraries require such granularity.\n Most libraries with a single logical purpose should be published as a single entrypoint.\n `@angular/core` for example uses a single entrypoint for the runtime, because the Angular runtime is generally used as a single entity.\n \n-### Resolution of secondary entrypoints\n+### Resolution of secondary entry points\n \n Secondary entrypoints can be resolved via the `\"exports\"` field of the `package.json` for the package.\n \n\n\n###\n\n", "completion": "docs: update angular-package-format guide (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/angular-package-format.md | file path B: aio/content/guide/angular-package-format.md\n\n@@ -125,7 +125,7 @@ The primary `package.json` contains important package metadata, including the fo\n *   It [declares](#esm-declaration) the package to be in EcmaScript Module \\(ESM\\) format\n *   It contains an [`\"exports\"` field](#exports) which defines the available source code formats of all entrypoints\n *   It contains [keys](#legacy-resolution-keys) which define the available source code formats of the primary `@angular/core` entrypoint, for tools which do not understand `\"exports\"`.\n-    These keys are considered deprecated, and should be removed as the support for `\"exports\"` rolls out across the ecosystem.\n+    These keys are considered deprecated, and could be removed as the support for `\"exports\"` rolls out across the ecosystem.\n \n *   It declares whether the package contains [side-effects](#side-effects)\n \n\n\n###\n\n", "completion": "docs: update aio/content/guide/angular-package-format.md with suggestion (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/angular-package-format.md | file path B: aio/content/guide/angular-package-format.md\n\n@@ -257,7 +257,7 @@ Entrypoints serve several functions.\n 1.  They define the granularity at which code can be lazily loaded.\n \n     Many modern build tools are only capable of \"code splitting\" \\(aka lazy loading\\) at the ES Module level.\n-    Since the Angular Package Format uses primarily a single \"flat\" ES Module per entrypoint, this means that most build tooling should not be able to split code in a single entrypoint into multiple output chunks.\n+    The Angular Package Format uses primarily a single \"flat\" ES Module per entry point. This means that most build tooling is not able to split code with a single entry point into multiple output chunks.\n \n The general rule for APF packages is to use entrypoints for the smallest sets of logically connected code possible.\n For example, the Angular Material package publishes each logical component or set of components as a separate entrypoint - one for Button, one for Tabs, etc.\n@@ -293,7 +293,7 @@ License: MIT\n Libraries in the Angular Package Format must be published in \"partial compilation\" mode.\n This is a compilation mode for `ngc` which produces compiled Angular code that is not tied to a specific Angular runtime version, in contrast to the full compilation used for applications, where the Angular compiler and runtime versions must match exactly.\n \n-To partially compile Angular code, use the `\"compilationMode\"` flag in the `\"angularCompilerOptions\"` property of your `tsconfig.json`:\n+To partially compile Angular code, use the `compilationMode` flag in the `angularCompilerOptions` property of your `tsconfig.json`:\n \n <code-example language=\"javascript\">\n \n@@ -318,14 +318,14 @@ The Angular Package Format specifies that code be published in \"flattened\" ES mo\n This significantly reduces the build time of Angular applications as well as download and parse time of the final application bundle.\n Please check out the excellent post [\"The cost of small modules\"](https://nolanlawson.com/2016/08/15/the-cost-of-small-modules) by Nolan Lawson.\n \n-The Angular compiler has support for generating index ES module files that can then be used to generate flattened modules using tools like Rollup, resulting in a file format called Flattened ES Module or FESM.\n+The Angular compiler can generate index ES module files. Tools like Rollup can use these files to generate flattened modules in a *Flattened ES Module* (FESM) file format.\n \n FESM is a file format created by flattening all ES Modules accessible from an entrypoint into a single ES Module.\n It's formed by following all imports from a package and copying that code into a single file while preserving all public ES exports and removing all private imports.\n \n-The shortened name \"FESM\" \\(pronounced \"phe-som\"\\) can have a number after it such as \"FESM5\" or \"FESM2015\" .\n+The abbreviated name, FESM, pronounced *phe-som*, can be followed by a number such as FESM5 or FESM2015.\n The number refers to the language level of the JavaScript inside the module.\n-Accordingly a FESM5 file would be ESM+ES5 \\(import/export statements and ES5 source code\\).\n+Accordingly a FESM5 file would be ESM+ES5 and include import/export statements and ES5 source code.\n \n To generate a flattened ES Module index file, use the following configuration options in your tsconfig.json file:\n \n@@ -351,10 +351,10 @@ Once the index file \\(for example, `my-ui-lib.js`\\) is generated by ngc, bundler\n \n #### Note about the defaults in package.json\n \n-As of webpack v4 the flattening of ES modules optimization should not be necessary for webpack users, and in fact theoretically it should be possible to get better code-splitting without flattening of modules in webpack.\n-In practice however size regressions are seen when using unflattened modules as input for webpack v4.\n-This is why `\"module\"` and `\"es2020\"` package.json entries still point to FESM files.\n-This issue is being investigated and it is expected for a switch to be made to the `\"module\"` and `\"es2020\"` package.json entry points to unflattened files when the size regression issue is resolved.\n+As of webpack v4, the flattening of ES modules optimization should not be necessary for webpack users. It should be possible to get better code-splitting without flattening of modules in webpack.\n+In practice, size regressions can still be seen when using unflattened modules as input for webpack v4.\n+This is why `module` and `es2020` package.json entries still point to FESM files.\n+This issue is being investigated. It is expected to switch the `module` and `es2020` package.json entry points to unflattened files after the size regression issue is resolved.\n The APF currently includes unflattened ESM2020 code for the purpose of validating such a future change.\n \n ### \"sideEffects\" flag\n@@ -373,7 +373,7 @@ More info: [webpack docs on side-effects](https://github.com/webpack/webpack/tre\n ### ES2020 language level\n \n ES2020 Language level is now the default language level that is consumed by Angular CLI and other tooling.\n-The Angular CLI should downlevel the bundle to a language level that is supported by all targeted browsers at application build time.\n+The Angular CLI down-levels the bundle to a language level that is supported by all targeted browsers at application build time.\n \n ### d.ts bundling / type definition flattening\n \n\n\n###\n\n", "completion": "docs: apply suggestions from code review (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/forms-overview.md | file path B: aio/content/guide/forms-overview.md\n\n@@ -25,7 +25,7 @@ Each approach offers different advantages.\n \n | Forms                 | Details |\n |:---                   |:---     |\n-| Reactive forms        | Provide direct, explicit access to the underlying forms object model. Compared to template-driven forms, they are more robust: they're more scalable, reusable, and testable. If forms are a key part of your application, or you're already using reactive patterns for building your application, use reactive forms.                                                                                             |\n+| Reactive forms        | Provide direct, explicit access to the underlying form's object model. Compared to template-driven forms, they are more robust: they're more scalable, reusable, and testable. If forms are a key part of your application, or you're already using reactive patterns for building your application, use reactive forms.                                                                                             |\n | Template-driven forms | Rely on directives in the template to create and manipulate the underlying object model. They are useful for adding a simple form to an app, such as an email list signup form. They're straightforward to add to an app, but they don't scale as well as reactive forms. If you have very basic form requirements and logic that can be managed solely in the template, template-driven forms could be a good fit. |\n \n ### Key differences\n\n\n###\n\n", "completion": "docs: fix grammar (#<issue-num>)"}
{"prompt": " file path A: aio/content/marketing/docs.md | file path B: aio/content/marketing/docs.md\n\n@@ -1,6 +1,6 @@\n <h1 class=\"no-toc\">Introduction to the Angular Docs</h1>\n \n-Angular is an application design framework and development platform for creating efficient and sophisticated single-page apps.\n+Angular is an application-design framework and development platform for creating efficient and sophisticated single-page apps.\n \n These Angular docs help you learn and use the Angular framework and development platform, from your first application to optimizing complex single-page apps for enterprises.\n Tutorials and guides include downloadable examples to accelerate your projects.\n\n\n###\n\n", "completion": "docs: fixed a \"grammatical opportunity\" (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/change-detection.md | file path B: aio/content/guide/change-detection.md\n\n@@ -1,6 +1,6 @@\n # Angular change detection and runtime optimization\n \n-**Change detection** is the process through which Angular checks to see whether your application state has changed, and if any DOM needs to be updated. At a high level, Angular walks your components from top to bottom, looking for changes. Angular runs its change detection mechanism periodically so that changes to the data model are reflected in an app\u2019s view. Change detection can be triggered either manually or through an asynchronous event (for example, a user interaction or an XHR completion).\n+**Change detection** is the process through which Angular checks to see whether your application state has changed, and if any DOM needs to be updated. At a high level, Angular walks your components from top to bottom, looking for changes. Angular runs its change detection mechanism periodically so that changes to the data model are reflected in an application\u2019s view. Change detection can be triggered either manually or through an asynchronous event (for example, a user interaction or an XMLHttpRequest completion).\n \n Change detection is a highly optimized performant, but it can still cause slowdowns if the application runs it too frequently.\n \n\n\n###\n\n", "completion": "docs: fix linting errors in change detection guide (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/image-directive-setup.md | file path B: aio/content/guide/image-directive-setup.md\n\n@@ -23,7 +23,7 @@ Based on the image services commonly used with Angular applications, `NgOptimize\n | Image Service | Angular API | Documentation |\n |:--- |:--- |:--- |\n | Cloudflare Image Resizing | `provideCloudflareLoader` | [Documentation](https://developers.cloudflare.com/images/image-resizing/) |\n-| Cloudinary | `provideCloudinaryLoader` | [Documentation](https://developers.cloudflare.com/images/image-resizing/) |  |\n+| Cloudinary | `provideCloudinaryLoader` | [Documentation](https://cloudinary.com/documentation/resizing_and_cropping) |\n | ImageKit | `provideImageKitLoader` | [Documentation](https://docs.imagekit.io/) |\n | Imgix | `provideImgixLoader` | [Documentation](https://docs.imgix.com/) |\n \n@@ -93,4 +93,4 @@ providers: [\n \n A loader function for the `NgOptimizedImage` directive takes an object with the `ImageLoaderConfig` type (from `@angular/common`) as its argument and returns the absolute URL of the image asset. The `ImageLoaderConfig` object contains the `src`and `width` properties.\n \n-Note: a custom loader must support requesting images at various widths in order for `rawSrcset` to work properly.\n\\ No newline at end of file\n+Note: a custom loader must support requesting images at various widths in order for `rawSrcset` to work properly.\n\n\n###\n\n", "completion": "docs: update cloudinary url (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/image-directive-setup.md | file path B: aio/content/guide/image-directive-setup.md\n\n@@ -8,7 +8,7 @@ You can import `NgOptimizedImage` from the `@angular/common` module. The directi\n \n ## Configure an `ImageLoader`\n \n-A \"loader\" is a function that generates the [image transformation URL](https://web.dev/image-cdns/#how-image-cdns-use-urls-to-indicate-optimization-options) for a given image file. When appropriate, `NgOptimzedImage` sets the size, format, and image quality transformations for an image.\n+A \"loader\" is a function that generates the [image transformation URL](https://web.dev/image-cdns/#how-image-cdns-use-urls-to-indicate-optimization-options) for a given image file. When appropriate, `NgOptimizedImage` sets the size, format, and image quality transformations for an image.\n \n `NgOptimizedImage` provides a generic loader as well as loaders for various third-party image services; it also supports writing your own custom loader.\n \n@@ -16,7 +16,7 @@ A \"loader\" is a function that generates the [image transformation URL](https://w\n |:--- |:--- |\n | Generic loader | The URL returned by the generic loader will always match the value of `src`. In other words, this loader applies no transformations. Sites that use Angular to serve images are the primary intended use case for this loader.|\n | Loaders for third-party image services | The URL returned by the loaders for third-party image services will follow API conventions used by that particular image service. |\n-| Custom loaders | A custom loader's behavior is defined by its developer. You should use a custom loader if your image service isn't supported by the loaders that come preconfigured with `NgOptimzedImage`.|\n+| Custom loaders | A custom loader's behavior is defined by its developer. You should use a custom loader if your image service isn't supported by the loaders that come preconfigured with `NgOptimizedImage`.|\n \n Based on the image services commonly used with Angular applications, `NgOptimizedImage` provides loaders preconfigured to work with the following image services:\n \n\n---\n file path A: aio/content/navigation.json | file path B: aio/content/navigation.json\n\n@@ -822,7 +822,7 @@\n         },\n         {\n           \"url\": \"guide/image-directive-setup\",\n-          \"title\": \"Setting up NgOptimzedImage\",\n+          \"title\": \"Setting up NgOptimizedImage\",\n           \"tooltip\": \"Setup the Angular image directive\"\n         },\n         {\n\n\n###\n\n", "completion": "docs: fix typo in image directive guide (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/app-shell.md | file path B: aio/content/guide/app-shell.md\n\n@@ -9,7 +9,7 @@ Learn more in [The App Shell Model](https://developers.google.com/web/fundamenta\n \n ## Step 1: Prepare the application\n \n-Do this with the following CLI command:\n+Do this with the following Angular CLI command:\n \n <code-example format=\"shell\" language=\"shell\">\n \n@@ -19,9 +19,9 @@ ng new my-app --routing\n \n For an existing application, you have to manually add the `RouterModule` and defining a `<router-outlet>` within your application.\n \n-## Step 2: Create the app shell\n+## Step 2: Create the application shell\n \n-Use the CLI to automatically create the application shell.\n+Use the Angular CLI to automatically create the application shell.\n \n <code-example format=\"shell\" language=\"shell\">\n \n@@ -80,9 +80,9 @@ After running this command you can see that the `angular.json` configuration fil\n \n </code-example>\n \n-## Step 3: Verify the app is built with the shell content\n+## Step 3: Verify the application is built with the shell content\n \n-Use the CLI to build the `app-shell` target.\n+Use the Angular CLI to build the `app-shell` target.\n \n <code-example format=\"shell\" language=\"shell\">\n \n\n\n###\n\n", "completion": "docs: fix doc linter warnings in `app-shell.md` (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/accessibility.md | file path B: aio/content/guide/accessibility.md\n\n@@ -121,7 +121,7 @@ router.events.pipe(filter(e =&gt; e instanceof NavigationEnd)).subscribe(() =&gt\n \n </code-example>\n \n-In a real application, the element that receives focus will depend on your specific application structure and layout.\n+In a real application, the element that receives focus depends on your specific application structure and layout.\n The focused element should put users in a position to immediately move into the main content that has just been routed into view.\n You should avoid situations where focus returns to the `body` element after a route change.\n \n@@ -167,9 +167,13 @@ The following example shows how to apply the `active-page` class to active links\n \n Books\n \n+<!-- vale Angular.Google_Quotes = NO -->\n+\n *   \"A Web for Everyone: Designing Accessible User Experiences\", Sarah Horton and Whitney Quesenbery\n *   \"Inclusive Design Patterns\", Heydon Pickering\n \n+<!-- vale Angular.Google_Quotes = YES -->\n+\n <!-- links -->\n \n <!-- external links -->\n\n\n###\n\n", "completion": "docs: fix doc linter warning and error in `accessibility.md` (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/angular-compiler-options.md | file path B: aio/content/guide/angular-compiler-options.md\n\n@@ -47,7 +47,7 @@ One of `static fields` \\(the default\\) or `decorators`.\n     <div class=\"alert is-helpful\">\n \n     **NOTE**: <br />\n-    That the resulting code will not properly tree-shake.\n+    That the resulting code cannot tree-shake properly.\n \n     </div>\n \n@@ -97,11 +97,11 @@ This allows `$localize` messages in application code to use the same ID as ident\n \n ### `enableResourceInlining`\n \n-When `true`, replaces the `templateUrl` and `styleUrls` property in all `@Component` decorators with inlined contents in `template` and `styles` properties.\n+When `true`, replaces the `templateUrl` and `styleUrls` properties in all `@Component` decorators with inline content in the `template` and `styles` properties.\n \n When enabled, the `.js` output of `ngc` does not include any lazy-loaded template or style URLs.\n \n-For library projects generated with the CLI, the development configuration default is `true`.\n+For library projects generated with the Angular CLI, the development configuration default is `true`.\n \n <a id=\"enablelegacytemplate\"></a>\n \n@@ -119,12 +119,12 @@ Ignored if `flatModuleOutFile` is `false`.\n \n ### `flatModuleOutFile`\n \n-When `true`, generates a flat module index of the given file name and the corresponding flat module metadata.\n+When `true`, generates a flat module index of the given filename and the corresponding flat module metadata.\n Use to create flat modules that are packaged similarly to `@angular/core` and `@angular/common`.\n When this option is used, the `package.json` for the library should refer to the generated flat module index instead of the library index file.\n \n Produces only one `.metadata.json` file, which contains all the metadata necessary for symbols exported from the library index.\n-In the generated `.ngfactory.js` files, the flat module index is used to import symbols that include both the public API from the library index as well as shrowded internal symbols.\n+In the generated `.ngfactory.js` files, the flat module index is used to import symbols that include both the public API from the library index as well as shrouded internal symbols.\n \n By default the `.ts` file supplied in the `files` field is assumed to be the library index.\n If more than one `.ts` file is specified, `libraryIndex` is used to select the file to use.\n@@ -141,7 +141,7 @@ The `module` field of the library's `package.json` would be `\"index.js\"` and the\n When `true` \\(recommended\\), enables the [binding expression validation](guide/aot-compiler#binding-expression-validation) phase of the template compiler, which uses TypeScript to validate binding expressions.\n For more information, see [Template type checking](guide/template-typecheck).\n \n-Default is `false`, but when you use the CLI command `ng new --strict`, it is set to `true` in the generated project's configuration.\n+Default is `false`, but when you use the Angular CLI command `ng new --strict`, it is set to `true` in the generated project's configuration.\n \n <div class=\"alert is-important\">\n \n@@ -172,7 +172,7 @@ This information includes, for example, the content of annotations \\(such as a c\n You can set to `true` when using factory summaries, because the factory summaries include a copy of the information that is in the `.metadata.json` file.\n \n Set to `true` if you are using TypeScript's `--outFile` option, because the metadata files are not valid for this style of TypeScript output.\n-However, we do not recommend using `--outFile` with Angular.\n+However, the Angular community does not recommend using `--outFile` with Angular.\n Use a bundler, such as [webpack](https://webpack.js.org), instead.\n \n ### `skipTemplateCodegen`\n@@ -182,7 +182,7 @@ This turns off most of the template compiler and disables the reporting of templ\n \n Can be used to instruct the template compiler to produce `.metadata.json` files for distribution with an `npm` package while avoiding the production of `.ngfactory.js` and `.ngstyle.js` files that cannot be distributed to `npm`.\n \n-For library projects generated with the CLI, the development configuration default is `true`.\n+For library projects generated with the Angular CLI, the development configuration default is `true`.\n \n ### `strictMetadataEmit`\n \n@@ -202,14 +202,14 @@ The template compiler can then use the error nodes to report an error if these s\n If the client of a library intends to use a symbol in an annotation, the template compiler does not normally report this until the client uses the symbol.\n This option allows detection of these errors during the build phase of the library and is used, for example, in producing Angular libraries themselves.\n \n-For library projects generated with the CLI, the development configuration default is `true`.\n+For library projects generated with the Angular CLI, the development configuration default is `true`.\n \n ### `strictInjectionParameters`\n \n When `true` \\(recommended\\), reports an error for a supplied parameter whose injection type cannot be determined.\n When `false` \\(currently the default\\), constructor parameters of classes marked with `@Injectable` whose type cannot be resolved produce a warning.\n \n-When you use the CLI command `ng new --strict`, it is set to `true` in the generated project's configuration.\n+When you use the Angular CLI command `ng new --strict`, it is set to `true` in the generated project's configuration.\n \n ### `strictTemplates`\n \n@@ -218,7 +218,7 @@ When `true`, enables [strict template type checking](guide/template-typecheck#st\n Additional strictness flags allow you to enable and disable specific types of strict template type checking.\n See [troubleshooting template errors](guide/template-typecheck#troubleshooting-template-errors).\n \n-When you use the CLI command `ng new --strict`, it is set to `true` in the generated project's configuration.\n+When you use the Angular CLI command `ng new --strict`, it is set to `true` in the generated project's configuration.\n \n ### `trace`\n \n@@ -227,7 +227,7 @@ Default is `false`.\n \n <a id=\"cli-options\"></a>\n \n-## Command Line Options\n+## Command line options\n \n While most of the time you interact with the Angular Compiler indirectly using Angular CLI, when debugging certain issues, you might find it useful to invoke the Angular Compiler directly.\n You can use the `ngc` command provided by the `@angular/compiler-cli` npm package to call the compiler from the command line.\n\n---\n file path A: aio/tools/doc-linter/styles/Vocab/Names.txt | file path B: aio/tools/doc-linter/styles/Vocab/Names.txt\n\n@@ -21,6 +21,7 @@ savkin's\n sinatra\n stackblitz\n tolisten\n+tsickle\n tslib\n tslint\n vercel\n\n\n###\n\n", "completion": "docs: fix doc linter warnings in `angular-compiler-options.md` (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/service-worker-config.md | file path B: aio/content/guide/service-worker-config.md\n\n@@ -90,6 +90,12 @@ Usually this is `/index.html`.\n They can include resources loaded from the page's origin as well as third-party resources loaded from CDNs and other external URLs.\n As not all such external URLs might be known at build time, URL patterns can be matched.\n \n+<div class=\"alert is-important\">\n+\n+  For the service worker to handle resources that are loaded from different origins, make sure that [CORS][MozillaDeveloperDocsWebHttpCors] is correctly configured on each origin's server.\n+\n+</div>\n+\n This field contains an array of asset groups, each of which defines a set of asset resources and the policy by which they are cached.\n \n <code-example format=\"json\" language=\"json\">\n@@ -440,6 +446,8 @@ It is recommended that you use the default performance strategy whenever possibl\n \n [WhatwgFetchSpecConceptFilteredResponseOpaque]: https://fetch.spec.whatwg.org#concept-filtered-response-opaque\n \n+[MozillaDeveloperDocsWebHttpCors]: https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\n+\n <!-- end links -->\n \n @reviewed 2022-02-28\n\n\n###\n\n", "completion": "docs(service-worker): add note regarding assets and CORS (#<issue-num>)"}
{"prompt": " file path A: packages/service-worker/config/src/generator.ts | file path B: packages/service-worker/config/src/generator.ts\n\n@@ -144,14 +144,13 @@ function globListToMatcher(globs: string[]): (file: string) => boolean {\n }\n \n function matches(file: string, patterns: {positive: boolean, regex: RegExp}[]): boolean {\n-  const res = patterns.reduce((isMatch, pattern) => {\n+  return patterns.reduce((isMatch, pattern) => {\n     if (pattern.positive) {\n       return isMatch || pattern.regex.test(file);\n     } else {\n       return isMatch && !pattern.regex.test(file);\n     }\n   }, false);\n-  return res;\n }\n \n function urlToRegex(url: string, baseHref: string, literalQuestionMark?: boolean): string {\n\n---\n file path A: packages/service-worker/src/module.ts | file path B: packages/service-worker/src/module.ts\n\n@@ -80,7 +80,7 @@ export const SCRIPT = new InjectionToken<string>('NGSW_REGISTER_SCRIPT');\n export function ngswAppInitializer(\n     injector: Injector, script: string, options: SwRegistrationOptions,\n     platformId: string): Function {\n-  const initializer = () => {\n+  return () => {\n     if (!(isPlatformBrowser(platformId) && ('serviceWorker' in navigator) &&\n           options.enabled !== false)) {\n       return;\n@@ -132,7 +132,6 @@ export function ngswAppInitializer(\n                 navigator.serviceWorker.register(script, {scope: options.scope})\n                     .catch(err => console.error('Service worker registration failed with:', err))));\n   };\n-  return initializer;\n }\n \n function delayWithTimeout(timeout: number): Observable<unknown> {\n\n\n###\n\n", "completion": "refactor(service-worker): refactored code to remove useless code (#<issue-num>)"}
{"prompt": " file path A: docs/BAZEL.md | file path B: docs/BAZEL.md\n\n@@ -10,7 +10,7 @@ Bazel.\n ## Installation\n \n In order to ensure that everyone builds Angular in a _consistent_ way, Bazel\n-will be installed through NPM and therefore it's not necessary to install Bazel\n+will be installed through NPM. It's not necessary to install Bazel\n manually.\n \n The binaries for Bazel will be provided by the [`@bazel/bazelisk`](https://github.com/bazelbuild/bazelisk)\n@@ -157,7 +157,7 @@ Of course, non-hermeticity in an action can cause problems.\n At worst, you can fetch a broken artifact from the cache, making your build non-reproducible.\n For this reason, we are careful to implement our Bazel rules to depend only on their inputs.\n \n-Currently we only use remote caching on CircleCI and we let Angular core developers enable remote caching to speed up their builds.\n+Currently, we only use remote caching on CircleCI. We let Angular core developers enable remote caching to speed up their builds.\n \n ### Remote cache in development\n \n@@ -239,7 +239,7 @@ yarn bazel analyze-profile filename_name.profile --html --html_details --html_hi\n \n This will generate a `filename_name.profile.html` file that you can open in your browser.\n \n-On the upper right corner that is a small table of contents with links to three areas: Tasks, Legend and Statistics.\n+In the upper right corner that is a small table of contents with links to three areas: Tasks, Legend and Statistics.\n \n In the Tasks section you will find a graph of where time is spent. Legend shows what the colors in the Tasks graph mean.\n Hovering over the background will show what phase that is, while hovering over bars will show more details about that specific action.\n\n---\n file path A: docs/DEBUG.md | file path B: docs/DEBUG.md\n\n@@ -6,7 +6,7 @@ The core packages are tested both in the browser (via Karma) and on the server (\n ## Debugging in Karma\n \n It is useful to focus your debugging on one test at a time by changing that test to be\n-defined using the `fit(...)` function, rather than `it(...)`. Moreover it can be helpful\n+defined using the `fit(...)` function, rather than `it(...)`. Moreover, it can be helpful\n to place a `debugger` statement in this `fit` clause to cause the debugger to stop when\n it hits this test.\n \n@@ -16,7 +16,7 @@ document.\n ## Debugging in Node\n \n It is useful to focus your debugging on one test at a time by changing that test to be\n-defined using the `fit(...)` function, rather than `it(...)`. Moreover it can be helpful\n+defined using the `fit(...)` function, rather than `it(...)`. Moreover, it can be helpful\n to place a `debugger` statement in this `fit` clause to cause the debugger to stop when\n it hits this test.\n \n\n---\n file path A: docs/DEBUG_COMPONENTS_REPO_IVY.md | file path B: docs/DEBUG_COMPONENTS_REPO_IVY.md\n\n@@ -1,6 +1,6 @@\n # Debugging the `components-repo-unit-tests` job\n \n-Currently all changes to Ivy are validated against the test suite of the\n+Currently, all changes to Ivy are validated against the test suite of the\n `angular/components` repository. In order to debug the `components-repo-unit-tests` CI\n job, the following steps can be used:\n \n\n---\n file path A: docs/DEVELOPER.md | file path B: docs/DEVELOPER.md\n\n@@ -31,7 +31,7 @@ following products on your development machine:\n \n * [Yarn](https://yarnpkg.com) (version specified in the engines field of [`package.json`](../package.json)) which is used to install dependencies.\n \n-* Optional: [Java](https://openjdk.java.net/) version 7 or higher as required by [Closure Compiler](https://developers.google.com/closure/compiler). Most developers will not need this. Java is required for running some of the integration tests.\n+* Optional: [Java](https://openjdk.java.net/) version 7 or higher than required by [Closure Compiler](https://developers.google.com/closure/compiler). Most developers will not need this. Java is required for running some integration tests.\n \n ## Getting the Sources\n \n@@ -146,7 +146,7 @@ $ yarn lint\n ## Publishing Snapshot Builds\n \n When a build of any branch on the upstream fork angular/angular is green on CircleCI, it\n-automatically publishes build artifacts to repositories in the Angular org, eg. the `@angular/core`\n+automatically publishes build artifacts to repositories in the Angular org, for example, the `@angular/core`\n package is published to https://github.com/angular/core-builds.\n \n You may find that your un-merged change needs some validation from external participants.\n\n---\n file path A: docs/GITHUB_PROCESS.md | file path B: docs/GITHUB_PROCESS.md\n\n@@ -53,7 +53,7 @@ decision.\n \n ## What if I want to implement the feature to help the Angular team?\n \n-Often implementing the feature as an separate package is a better option. Building an external\n+Often implementing the feature as a separate package is a better option. Building an external\n package rather than including the functionality in Angular helps with:\n \n - Keeping the framework's runtime smaller and simpler\n\n\n###\n\n", "completion": "docs: fixing typos and grammatical errors in several documentation files (#<issue-num>)"}
{"prompt": " file path A: None | file path B: aio/UPDATING.md\n\n@@ -0,0 +1,42 @@\n+# Update the angular.io app\n+\n+The dependencies of the angular.io app (including Angular, Angular Material and Angular CLI) are automatically updated using [Renovate](https://renovatebot.com/).\n+\n+However, it is useful to periodically also manually update the app to more closely match (in file layout, configs, etc.) what a new Angular CLI app would look like.\n+This is typically only needed once for each new major Angular version.\n+\n+Since angular.io is an Angular CLI app, we can take advantage of `ng update` to apply migrations.\n+\n+Follow these steps to align the angular.io app with new CLI apps.\n+\n+> **Note:**\n+> The following steps assume that the related Angular dependencies have already been updated in [aio/package.json](./package.json) (for example, automatically by Renovate).\n+\n+> **Note:**\n+> All commands shown below are expected to be executed from inside the [aio/](./) directory (unless specified otherwise).\n+\n+- Determine (for example, by examining git history) what is the last versions for which this process was performed.\n+  These will be referred to as `<FROM_VERSION_*>`.\n+  If you can't determine these, use arbitrary versions, such as the previous major version.\n+\n+- Run the following commands to automatically apply any available migrations to the project:\n+  ```sh\n+  # Ensure dependencies are installed.\n+  yarn install\n+\n+  # Migrate project to new versions.\n+  yarn ng update @angular/cli --allow-dirty --migrate-only --from=<FROM_VERSION_CLI>\n+  yarn ng update @angular/core --allow-dirty --migrate-only --from=<FROM_VERSION_ANGULAR>\n+  yarn ng update @angular/material --allow-dirty --migrate-only --from=<FROM_VERSION_MATERIAL>\n+  ```\n+\n+  > **Note:**\n+  > Depending on the number of changes generated from each `ng update` command, it might make sense to create a separate commit for each update.\n+\n+- Inspect [package.json](./package.json) to determine what is the current version of Angular CLI (i.e. `@angular/cli`) used in the app.\n+  This will be referred to as `<TO_VERSION_CLI>`.\n+\n+- Use the [angular-cli-diff](https://github.com/cexbrayat/angular-cli-diff) repository to discover more changes (which are not automatically applied via `ng update` migrations) between Angular CLI apps of different versions.\n+  Visit https://github.com/cexbrayat/angular-cli-diff/compare/<FROM_VERSION_CLI>...<TO_VERSION_CLI>, inspect the changes between the two versions and apply the ones that make sense to the angular.io source code.\n+\n+- Commit all changes and [submit a pull request](../CONTRIBUTING.md#submit-pr).\n\n---\n file path A: aio/tools/examples/UPDATING.md | file path B: aio/tools/examples/UPDATING.md\n\n@@ -1,15 +1,23 @@\n # Update example dependencies\n \n-Follow these steps to update the examples to the latest versions of Angular (and related dependencies):\n+The dependencies of the example apps (including Angular, Angular Material and Angular CLI) are automatically updated using [Renovate](https://renovatebot.com/).\n \n-- In [shared/package.json](./shared/package.json), bump all the `@angular/*` and `@nguniversal/*` package versions to the version you want to update to and update their peer dependencies (such as `@angular-devkit/*`, `rxjs`, `typescript`, `zone.js`) and other dependencies (e.g. `@types/*`) to the latest compatible versions.\n+However, it is useful to periodically also manually update the apps to more closely match (in file layout, configs, etc.) what a new Angular CLI app would look like.\n+This is typically only needed once for each new major Angular version.\n \n-  > NOTE:\n-  > The [angular-cli-diff](https://github.com/cexbrayat/angular-cli-diff) repo can be a useful resource for discovering what dependency versions are used for a basic CLI app at a specific CLI version.\n+Since the examples are Angular CLI apps, we can take advantage of `ng update` to apply migrations.\n \n-- In the [shared/](./shared) directory, run `yarn` to update the dependencies in the [shared/node_modules/](./shared/node_modules) directory and the [shared/yarn.lock](./shared/yarn.lock) file.\n+Follow these steps to align the example apps with new CLI apps.\n \n-- In the [shared/](./shared) directory, run `yarn sync-deps` to update the dependency versions of the `package.json` files in each sub-folder of [shared/boilerplate/](./shared/boilerplate) to match the ones in [shared/package.json](./shared/package.json).\n+> **Note:**\n+> The following steps assume that the related Angular dependencies have already been updated in [shared/package.json](./shared/package.json) (for example, automatically by Renovate).\n+\n+- Determine (for example, by examining git history) what is the last versions for which this process was performed.\n+  These will be referred to as `<FROM_VERSION_*>`.\n+  If you can't determine these, use arbitrary versions, such as the previous major version.\n+\n+- In the [shared/](./shared) directory, run `yarn` to ensure the dependencies are installed in the [shared/node_modules/](./shared/node_modules) directory.\n+  This command will also ensure that the dependency versions of the `package.json` files in each sub-folder of [shared/boilerplate/](./shared/boilerplate) match the ones in [shared/package.json](./shared/package.json).\n \n - Follow the steps in the following section to update the rest of the boilerplate files.\n \n@@ -19,26 +27,32 @@ Follow these steps to update the examples to the latest versions of Angular (and\n The Angular CLI default setup is updated using `ng update`.\n Any necessary changes to boilerplate files will be done automatically through migration schematics.\n \n-> NOTE:\n+> **Note:**\n > Migrations affecting source code files will not happen automatically, because `ng update` does not know about all the examples in `aio/content/examples/`.\n > You have to make these changes (if any) manually.\n-> Again, the [angular-cli-diff](https://github.com/cexbrayat/angular-cli-diff) repo can be a useful resource for discovering changes between versions.\n+> The [angular-cli-diff](https://github.com/cexbrayat/angular-cli-diff) repo can be a useful resource for discovering changes between versions.\n \n-- In the [shared/boilerplate/cli/](./shared/boilerplate/cli) directory, run the following commands to migrate the project to the current versions of Angular CLI and the Angular framework (updated in previous steps):\n+- In the [shared/boilerplate/cli/](./shared/boilerplate/cli) directory, run the following commands to automatically apply any available migrations to the boilerplate project:\n   ```sh\n   # Ensure dependencies are installed.\n   yarn install\n \n   # Migrate project to new versions.\n-  yarn ng update @angular/cli --allow-dirty --migrate-only --from=<previous-cli-version>\n-  yarn ng update @angular/core --allow-dirty --migrate-only --from=<previous-core-version>\n+  yarn ng update @angular/cli --allow-dirty --migrate-only --from=<FROM_VERSION_CLI>\n+  yarn ng update @angular/core --allow-dirty --migrate-only --from=<FROM_VERSION_ANGULAR>\n   ```\n \n-  > NOTE:\n+  > **Note:**\n   > In order for `ng update` to work, there must be a `node_modules/` directory with installed dependencies inside the [shared/boilerplate/cli/](./shared/boilerplate/cli) directory.\n   > This `node_modules/` directory is only needed during the update operation and is otherwise ignored (both by git and by the [example-boilerplate.js](./example-boilerplate.js) script) by means of the [shared/boilerplate/.gitignore](./shared/boilerplate/.gitignore) file.\n \n-- The previous command made any necessary changes to boilerplate files inside the `cli/` directory, but the same changes need to be applied to the other CLI-based boilerplate directories.\n+- Inspect [shared/package.json](./shared/package.json) to determine what is the current version of Angular CLI (i.e. `@angular/cli`) used in the example apps.\n+  This will be referred to as `<TO_VERSION_CLI>`.\n+\n+- Use the [angular-cli-diff](https://github.com/cexbrayat/angular-cli-diff) repository to discover more changes (which are not automatically applied via `ng update` migrations) between Angular CLI apps of different versions.\n+  Visit https://github.com/cexbrayat/angular-cli-diff/compare/<FROM_VERSION_CLI>...<TO_VERSION_CLI>, inspect the changes between the two versions and apply the ones that make sense to the boilerplate files inside [shared/boilerplate/cli/](./shared/boilerplate/cli).\n+\n+- The previous steps made any necessary changes to boilerplate files inside the `cli/` directory, but the same changes need to be applied to the other CLI-based boilerplate directories.\n   Inspect the changes in `cli/` and manually apply the necessary ones to other CLI-based boilerplate directories.\n \n - Also ensure that any relevant changes in the [shared/boilerplate/cli/](./shared/boilerplate/cli) directory are copied to the [shared/example-scaffold/](./shared/example-scaffold) directory, which is used when creating new examples (via `yarn create-example ...`).\n@@ -55,4 +69,4 @@ Any necessary changes to boilerplate files will be done automatically through mi\n - Inspect the changes and determine whether any updates to guides are necessary.\n   For example, if a file is renamed or moved, any guides mentioning that file may need updating to refer to the new name/location.\n \n-- Commit all changes to the repository.\n+- Finally, commit all changes and [submit a pull request](../../../CONTRIBUTING.md#submit-pr).\n\n\n###\n\n", "completion": "docs(docs-infra): improve docs on updating angular.io and docs examples apps (#<issue-num>)"}
{"prompt": " file path A: aio/aio-builds-setup/docs/_TOC.md | file path B: aio/aio-builds-setup/docs/_TOC.md\n\n@@ -30,4 +30,5 @@\n \n ## Miscellaneous\n - [Debug docker container](misc--debug-docker-container.md)\n+- [Use Let's Encrypt certificates](misc--use-lets-encrypt-certs.md)\n - [Integrate with CI](misc--integrate-with-ci.md)\n\n---\n file path A: None | file path B: aio/aio-builds-setup/docs/misc--use-lets-encrypt-certs.md\n\n@@ -0,0 +1,80 @@\n+# Miscellaneous - Use Let's Encrypt TLS certificates\n+\n+\n+[Let's Encrypt](https://letsencrypt.org/) is a free, automated, and open certificate authority (CA),\n+provided by the [Internet Security Research Group (ISRG)](https://www.abetterinternet.org/). It can\n+be used for issuing the certificates needed by the preview server. See the \"Create TLS certificates\"\n+section in [this doc](vm-setup--create-host-dirs-and-files.md) for more details.\n+\n+Let's Encrypt supports issuing\n+[wildcard certificates](https://letsencrypt.org/docs/faq/#does-let-s-encrypt-issue-wildcard-certificates),\n+but they have to be renewed every 3 months using a\n+[DNS-01 challenge](https://letsencrypt.org/docs/challenge-types/#dns-01-challenge).\n+\n+Below are instructions for the creation of certificates using Let's Encrypt.\n+\n+**Note 1:**\n+  It is assumed that the commands are executed on the VM that hosts the preview server. You can run\n+  the commands on any machine and adjust accordingly the steps for transfering the generated\n+  certificate and private key to the preview server VM.\n+\n+**Note 2:**\n+  In order to complete the DNS-01 challenge and generate the certificate, one needs to have access\n+  to update the DNS records associated with the `ngbuilds.io` domain and subdomains.\n+\n+\n+## Prerequisites\n+- Install [certbot](https://certbot.eff.org/):\n+  - Old method: `sudo apt-get install certbot`\n+  - New method: Follow the instructions [here](https://certbot.eff.org/instructions).\n+\n+\n+## Create new certificate\n+- Run the following command and follow the on-screen instructions:\n+  ```sh\n+  sudo certbot certonly \\\n+    -d \"ngbuilds.io,*.ngbuilds.io\" \\\n+    -m \"devops@angular.io\" \\\n+    --agree-tos \\\n+    --manual \\\n+    --manual-public-ip-logging-ok \\\n+    --preferred-challenges=\"dns\"\n+  ```\n+\n+  **Hint:**\n+    You can use `dig -t txt _acme-challenge.ngbuilds.io` (on Linux/macOS) or something like\n+    [DNSChecker.org](https://dnschecker.org/all-dns-records-of-domain.php?query=_acme-challenge.ngbuilds.io&rtype=TXT) to verify that the DNS updates have been successfully deployed and propagated.\n+\n+- [Optional] Remove the DNS TXT records added in the previous step.\n+  (They are no longer needed, unless you want to create more certificates now.)\n+\n+\n+## Deploy new certificate\n+- Copy files to the host machine's `/etc/ssl/localcerts` directory, replacing `YYYY-MM` in the file\n+  names with the current year and month (for example, `2022-08`):\n+  ```sh\n+  # Copy certificate.\n+  sudo cp /etc/letsencrypt/live/ngbuilds.io/fullchain.pem /etc/ssl/localcerts/ngbuilds.io.crt.YYYY-MM\n+  sudo cp /etc/letsencrypt/live/ngbuilds.io/fullchain.pem /etc/ssl/localcerts/ngbuilds.io.crt\n+\n+  # Copy private key.\n+  sudo cp /etc/letsencrypt/live/ngbuilds.io/privkey.pem /etc/ssl/localcerts/ngbuilds.io.key.YYYY-MM\n+  sudo cp /etc/letsencrypt/live/ngbuilds.io/privkey.pem /etc/ssl/localcerts/ngbuilds.io.key\n+\n+  # Update permissions.\n+  sudo find /etc/ssl/localcerts -type f -exec chmod 400 {} \\;\n+  ```\n+\n+  **Note:**\n+    The `.YYYY-MM`-suffixed copies are not needed/used. They are just kept for reference and backup\n+    purposes.\n+\n+- Reload `nginx`:\n+  ```sh\n+  # Connect to the Docker container and reload reload `nginx`.\n+  sudo docker exec -it aio service nginx reload\n+  ```\n+\n+- [Optional] Verify that the certificate has been successfully deployed by visiting\n+  https://ngbuilds.io/ in a browser and inspecting the TLS certificate details. See, for example,\n+  [how to view certificate details in Chrome](https://www.howtogeek.com/292076/how-do-you-view-ssl-certificate-details-in-google-chrome/).\n\n---\n file path A: aio/aio-builds-setup/docs/vm-setup--create-host-dirs-and-files.md | file path B: aio/aio-builds-setup/docs/vm-setup--create-host-dirs-and-files.md\n\n@@ -32,6 +32,10 @@ specify the domain name see [here](vm-setup--create-docker-image.md).\n If no directory is attached, nginx will use an internal self-signed certificate. This is convenient\n during development, but is not suitable for production.\n \n+Certificates from any certificate authority can be used. As an example, see\n+[here](misc--use-lets-encrypt-certs) for instructions on using certificates from\n+[Let's Encrypt](https://letsencrypt.org/).\n+\n **Note:**\n Since nginx needs to be able to serve requests for both the main domain as well as any subdomain\n (e.g. `ngbuilds.io/` and `foo-bar.ngbuilds.io/`), the provided certificate needs to be a\n\n\n###\n\n", "completion": "docs(docs-infra): add instructions on using Let's Encrypt for preview server certificates (#<issue-num>)"}
{"prompt": " file path A: aio/aio-builds-setup/docs/vm-setup--create-host-dirs-and-files.md | file path B: aio/aio-builds-setup/docs/vm-setup--create-host-dirs-and-files.md\n\n@@ -19,8 +19,8 @@ persistent disk can be used (as described [here](vm-setup--attach-persistent-dis\n **Note:** The directories created inside that directory will be owned by user `www-data`.\n \n \n-## Create SSL certificates (Optional for dev)\n-The host VM can attach a directory containing the SSL certificate and key to be used by the nginx\n+## Create TLS certificates (Optional for dev)\n+The host VM can attach a directory containing the TLS certificate and key to be used by the nginx\n server for serving the hosted previews. More info on how to attach the directory when\n starting the container can be found [here](vm-setup--start-docker-container.md).\n \n@@ -34,8 +34,9 @@ during development, but is not suitable for production.\n \n **Note:**\n Since nginx needs to be able to serve requests for both the main domain as well as any subdomain\n-(e.g. `ngbuilds.io/` and `foo-bar.ngbuilds.io/`), the provided certificate needs to be a wildcard\n-certificate covering both the domain and subdomains.\n+(e.g. `ngbuilds.io/` and `foo-bar.ngbuilds.io/`), the provided certificate needs to be a\n+[wildcard certificate](https://en.wikipedia.org/wiki/Wildcard_certificate) covering both the domain\n+and all subdomains.\n \n \n ## Create directory for logs (Optional)\n\n---\n file path A: aio/aio-builds-setup/docs/vm-setup--start-docker-container.md | file path B: aio/aio-builds-setup/docs/vm-setup--start-docker-container.md\n\n@@ -48,14 +48,22 @@ sudo docker run \\\n \n   # The directory the contains the secrets (e.g. GitHub token, JWT secret, etc).\n   # (See [here](vm-setup--set-up-secrets.md) for more info.)\n+  #\n+  # NOTE:\n+  #   Omitting this is OK during development/debugging, when you don't care to interact with real\n+  #   external services.\n   --volume <host-secrets-dir>:/aio-secrets:ro \\\n \n   # The build artifacts and hosted previews will stored to and served from this directory.\n   # (If you are using a persistent disk - as described [here](vm-setup--attach-persistent-disk.md) -\n   #  this will be a directory inside the disk.)\n+  #\n+  # NOTE:\n+  #   Omitting this is OK during development/debugging, when you don't care to interact with real\n+  #   external services.\n   --volume <host-builds-dir>:/var/www/aio-builds \\\n \n-  # The directory the contains the SSL certificates.\n+  # The directory the contains the TLS certificates.\n   # (See [here](vm-setup--create-host-dirs-and-files.md) for more info.)\n   # If not provided, the container will use self-signed certificates.\n  [--volume <host-cert-dir>:/etc/ssl/localcerts:ro] \\\n@@ -77,10 +85,13 @@ sudo docker run \\\n \n \n ## Example\n-The following command would start a docker container based on the previously created `foobar-builds`\n-docker image, alias it as 'foobar-builds-1' and map predefined directories on the host VM to be used\n-by the container for accessing secrets and SSL certificates and keeping the build artifacts and logs;\n-and will map the source scripts from the host to the container.\n+The following command would do the following:\n+1. Start a docker container based on the previously created `foobar-builds` docker image.\n+2. Alias the docker container as `foobar-builds-1` (so it can be references in subsequent docker\n+   commands).\n+3. Map predefined directories on the host VM to be used by the container for accessing secrets and\n+   TLS certificates and keeping the build artifacts and logs.\n+4. Map the source scripts from the host to the container (for debugging purposes).\n \n ```\n sudo docker run \\\n\n\n###\n\n", "completion": "docs(docs-infra): minor improvements in preview server docs (#<issue-num>)"}
{"prompt": " file path A: aio/content/errors/NG0100.md | file path B: aio/content/errors/NG0100.md\n\n@@ -7,7 +7,7 @@\n \n Angular throws an `ExpressionChangedAfterItHasBeenCheckedError` when an expression value has been changed after change detection has completed. Angular only throws this error in development mode.\n \n-In development mode, Angular performs an additional check after each change detection run, to ensure the bindings haven't changed. This catches errors where the view is left in an inconsistent state. This can occur, for example, if a method or getter returns a different value each time it is called, or if a child component changes values on its parent. If either of these occur, this is a sign that change detection is not stabilized. Angular throws the error to ensure data is always reflected correctly in the view, which prevents erratic UI behavior or a possible infinite loop.\n+In development mode, Angular performs an additional check after each change detection run, to ensure the bindings haven't changed. This catches errors where the view is left in an inconsistent state. This can occur, for example, if a method or getter returns a different value each time it is called, or if a child component changes values on its parent. If either of these occurs, this is a sign that change detection is not stabilized. Angular throws the error to ensure data is always reflected correctly in the view, which prevents erratic UI behavior or a possible infinite loop.\n \n This error commonly occurs when you've added template expressions or have begun to implement lifecycle hooks like `ngAfterViewInit` or `ngOnChanges`. It is also common when dealing with loading status and asynchronous operations, or when a child component changes its parent bindings.\n \n\n\n###\n\n", "completion": "docs: typo (#<issue-num>)"}
{"prompt": " file path A: aio/content/images/bios/MainaWycliffe.jpg | file path B: aio/content/images/bios/MainaWycliffe.jpg\n\nBinary files a/aio/content/images/bios/MainaWycliffe.jpg and b/aio/content/images/bios/MainaWycliffe.jpg differ\n\n\n###\n\n", "completion": "docs: compress the bios image (#<issue-num>)"}
{"prompt": " file path A: aio/content/images/bios/MainaWycliffe.jpg | file path B: aio/content/images/bios/MainaWycliffe.jpg\n\nBinary files /dev/null and b/aio/content/images/bios/MainaWycliffe.jpg differ\n\n---\n file path A: aio/content/marketing/contributors.json | file path B: aio/content/marketing/contributors.json\n\n@@ -610,6 +610,16 @@\n     \"groups\": [\"Angular\"],\n     \"mentor\": \"jelbourn\"\n   },\n+  \"MainaWycliffe\": {\n+    \"name\": \"Maina Wycliffe\",\n+    \"picture\": \"MainaWycliffe.jpg\",\n+    \"twitter\": \"mwycliffe_dev\",\n+    \"website\": \"https://mainawycliffe.dev/\",\n+    \"bio\": \"Wycliffe is a Software Engineer from Kenya passionate about Teaching, Speaking, Writing, Open Source, and Mentorship. On top of that, he is passionate about Typescript and loves teaching developers how to get the most out of it.\",\n+    \"groups\": [\n+      \"GDE\"\n+    ]\n+  },\n   \"manekinekko\": {\n     \"name\": \"Wassim Chegham\",\n     \"picture\": \"wassim.jpg\",\n\n\n###\n\n", "completion": "docs: add Maina Wycliffe to GDE resources (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/service-worker-getting-started/src/app/check-for-update.service.ts | file path B: aio/content/examples/service-worker-getting-started/src/app/check-for-update.service.ts\n\n@@ -13,6 +13,13 @@ export class CheckForUpdateService {\n     const everySixHours$ = interval(6 * 60 * 60 * 1000);\n     const everySixHoursOnceAppIsStable$ = concat(appIsStable$, everySixHours$);\n \n-    everySixHoursOnceAppIsStable$.subscribe(() => updates.checkForUpdate());\n+    everySixHoursOnceAppIsStable$.subscribe(async () => {\n+      try {\n+        const updateFound = await updates.checkForUpdate();\n+        console.log(updateFound ? 'A new version is available.' : 'Already on the latest version.');\n+      } catch (err) {\n+        console.error('Failed to check for updates:', err);\n+      }\n+    });\n   }\n }\n\n---\n file path A: aio/content/examples/service-worker-getting-started/src/app/prompt-update.service.ts | file path B: aio/content/examples/service-worker-getting-started/src/app/prompt-update.service.ts\n\n@@ -1,20 +1,40 @@\n+// #docplaster\n import { Injectable } from '@angular/core';\n-import { SwUpdate, UpdateAvailableEvent } from '@angular/service-worker';\n+// #docregion sw-replicate-available\n+    import { filter, map } from 'rxjs/operators';\n+// #enddocregion sw-replicate-available\n+import { SwUpdate, VersionReadyEvent } from '@angular/service-worker';\n \n-function promptUser(event: UpdateAvailableEvent): boolean {\n+function promptUser(event: VersionReadyEvent): boolean {\n   return true;\n }\n \n-// #docregion sw-activate\n+// #docregion sw-version-ready\n @Injectable()\n export class PromptUpdateService {\n \n-  constructor(updates: SwUpdate) {\n-    updates.available.subscribe(event => {\n-      if (promptUser(event)) {\n-        updates.activateUpdate().then(() => document.location.reload());\n-      }\n-    });\n+  constructor(swUpdate: SwUpdate) {\n+    swUpdate.versionUpdates\n+        .pipe(filter((evt): evt is VersionReadyEvent => evt.type === 'VERSION_READY'))\n+        .subscribe(evt => {\n+          if (promptUser(evt)) {\n+            // Reload the page to update to the latest version.\n+            document.location.reload();\n+          }\n+        });\n+    // #enddocregion sw-version-ready\n+    // #docregion sw-replicate-available\n+    // ...\n+    const updatesAvailable = swUpdate.versionUpdates.pipe(\n+        filter((evt): evt is VersionReadyEvent => evt.type === 'VERSION_READY'),\n+        map(evt => ({\n+          type: 'UPDATE_AVAILABLE',\n+          current: evt.currentVersion,\n+          available: evt.latestVersion,\n+        })));\n+    // #enddocregion sw-replicate-available\n+    // #docregion sw-version-ready\n   }\n+\n }\n-// #enddocregion sw-activate\n+// #enddocregion sw-version-ready\n\n---\n file path A: aio/content/guide/service-worker-communications.md | file path B: aio/content/guide/service-worker-communications.md\n\n@@ -64,16 +64,20 @@ Alternatively, you might want to define a different [registration strategy](api/\n \n </div>\n \n-### Forcing update activation\n+### Updating to the latest version\n \n-If the current tab needs to be updated to the latest application version immediately, it can ask to do so with the `activateUpdate()` method:\n+You can update an existing tab to the latest version by reloading the page as soon as a new version is ready.\n+To avoid disrupting the user's progress, it is generally a good idea to prompt the user and let them confirm that it is OK to reload the page and update to the latest version:\n \n-<code-example header=\"prompt-update.service.ts\" path=\"service-worker-getting-started/src/app/prompt-update.service.ts\" region=\"sw-activate\"></code-example>\n+<code-example header=\"prompt-update.service.ts\" path=\"service-worker-getting-started/src/app/prompt-update.service.ts\" region=\"sw-version-ready\"></code-example>\n \n <div class=\"alert is-important\">\n \n-Calling `activateUpdate()` without reloading the page could break lazy-loading in a currently running app, especially if the lazy-loaded chunks use filenames with hashes, which change every version.\n-Therefore, it is recommended to reload the page once the promise returned by `activateUpdate()` is resolved.\n+Calling {@link SwUpdate#activateUpdate SwUpdate#activateUpdate()} updates a tab to the latest version without reloading the page, but this could break the application.\n+\n+Updating without reloading can create a version mismatch between the [application shell](guide/glossary#app-shell) and other page resources, such as [lazy-loaded chunks](guide/glossary#lazy-loading), whose filenames may change between versions.\n+\n+You should only use `activateUpdate()`, if you are certain it is safe for your specific use case.\n \n </div>\n \n\n---\n file path A: packages/service-worker/src/update.ts | file path B: packages/service-worker/src/update.ts\n\n@@ -40,18 +40,11 @@ export class SwUpdate {\n    *\n    * @deprecated Use {@link versionUpdates} instead.\n    *\n-   * The of behavior `available` can be rebuild by filtering for the `VersionReadyEvent`:\n-   * ```\n-   * import {filter, map} from 'rxjs/operators';\n-   * // ...\n-   * const updatesAvailable = swUpdate.versionUpdates.pipe(\n-   *   filter((evt): evt is VersionReadyEvent => evt.type === 'VERSION_READY'),\n-   *   map(evt => ({\n-   *     type: 'UPDATE_AVAILABLE',\n-   *     current: evt.currentVersion,\n-   *     available: evt.latestVersion,\n-   *   })));\n-   * ```\n+   * The behavior of `available` can be replicated by using `versionUpdates` by filtering for the\n+   * `VersionReadyEvent`:\n+   *\n+   * {@example service-worker-getting-started/src/app/prompt-update.service.ts\n+   * region='sw-replicate-available'}\n    */\n   readonly available: Observable<UpdateAvailableEvent>;\n \n@@ -124,6 +117,20 @@ export class SwUpdate {\n    * Updates the current client (i.e. browser tab) to the latest version that is ready for\n    * activation.\n    *\n+   * In most cases, you should not use this method and instead should update a client by reloading\n+   * the page.\n+   *\n+   * <div class=\"alert is-important\">\n+   *\n+   * Updating a client without reloading can easily result in a broken application due to a version\n+   * mismatch between the [application shell](guide/glossary#app-shell) and other page resources,\n+   * such as [lazy-loaded chunks](guide/glossary#lazy-loading), whose filenames may change between\n+   * versions.\n+   *\n+   * Only use this method, if you are certain it is safe for your specific use case.\n+   *\n+   * </div>\n+   *\n    * @returns a promise that\n    *  - resolves to `true` if an update was activated successfully\n    *  - resolves to `false` if no update was available (for example, the client was already on the\n\n\n###\n\n", "completion": "docs(service-worker): improve docs related to `SwUpdate` APIs (#<issue-num>)"}
{"prompt": " file path A: packages/common/http/src/client.ts | file path B: packages/common/http/src/client.ts\n\n@@ -865,7 +865,7 @@ export class HttpClient {\n \n   /**\n    * Constructs a `DELETE` request that interprets the body as a JSON object and\n-   * returns the response body as a JSON object.\n+   * returns the response body as an object parsed from JSON.\n    *\n    * @param url     The endpoint URL.\n    * @param options The HTTP options to send with the request.\n@@ -1178,13 +1178,13 @@ export class HttpClient {\n \n   /**\n    * Constructs a `GET` request that interprets the body as a JSON object and\n-   * returns the response body as a JSON object.\n+   * returns the response body as an object parsed from JSON.\n    *\n    * @param url     The endpoint URL.\n    * @param options The HTTP options to send with the request.\n    *\n    *\n-   * @return An `Observable` of the response body as a JSON object.\n+   * @return An `Observable` of the response body as an object parsed from JSON.\n    */\n   get(url: string, options?: {\n     headers?: HttpHeaders|{[header: string]: string | string[]},\n@@ -1490,12 +1490,12 @@ export class HttpClient {\n \n   /**\n    * Constructs a `HEAD` request that interprets the body as a JSON object and\n-   * returns the response body as a JSON object.\n+   * returns the response body as an object parsed from JSON.\n    *\n    * @param url     The endpoint URL.\n    * @param options The HTTP options to send with the request.\n    *\n-   * @return An `Observable` of the response, with the response body as a JSON object.\n+   * @return An `Observable` of the response, with the response body as an object parsed from JSON.\n    */\n   head(url: string, options?: {\n     headers?: HttpHeaders|{[header: string]: string | string[]},\n@@ -1852,12 +1852,12 @@ export class HttpClient {\n \n   /**\n    * Constructs an `OPTIONS` request that interprets the body as a JSON object and returns the\n-   * response body as a JSON object.\n+   * response body as an object parsed from JSON.\n    *\n    * @param url The endpoint URL.\n    * @param options HTTP options.\n    *\n-   * @return An `Observable` of the response, with the response body as a JSON object.\n+   * @return An `Observable` of the response, with the response body as an object parsed from JSON.\n    */\n   options(url: string, options?: {\n     headers?: HttpHeaders|{[header: string]: string | string[]},\n@@ -2177,13 +2177,13 @@ export class HttpClient {\n \n   /**\n    * Constructs a `PATCH` request that interprets the body as a JSON object and\n-   * returns the response body as a JSON object.\n+   * returns the response body as an object parsed from JSON.\n    *\n    * @param url The endpoint URL.\n    * @param body The resources to edit.\n    * @param options HTTP options.\n    *\n-   * @return An `Observable` of the response, with the response body as a JSON object.\n+   * @return An `Observable` of the response, with the response body as an object parsed from JSON.\n    */\n   patch(url: string, body: any|null, options?: {\n     headers?: HttpHeaders|{[header: string]: string | string[]},\n@@ -2502,13 +2502,13 @@ export class HttpClient {\n \n   /**\n    * Constructs a `POST` request that interprets the body as a\n-   * JSON object and returns the response body as a JSON object.\n+   * JSON object and returns the response body as an object parsed from JSON.\n    *\n    * @param url The endpoint URL.\n    * @param body The content to replace with.\n    * @param options HTTP options\n    *\n-   * @return An `Observable` of the response, with the response body as a JSON object.\n+   * @return An `Observable` of the response, with the response body as an object parsed from JSON.\n    */\n   post(url: string, body: any|null, options?: {\n     headers?: HttpHeaders|{[header: string]: string | string[]},\n\n\n###\n\n", "completion": "docs(http): replace http method return description (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/security.md | file path B: aio/content/guide/security.md\n\n@@ -13,7 +13,7 @@ You can run the <live-example></live-example> in Stackblitz and download the cod\n \n <header>Reporting vulnerabilities</header>\n \n-To report vulnerabilities in Angular itself, email us at [security@angular.io](mailto:security@angular.io).\n+Angular is part of Google [Open Source Software Vulnerability Reward Program](https://bughunters.google.com/about/rules/6521337925468160/google-open-source-software-vulnerability-reward-program-rules), for vulnerabilities in Angular please submit your report [here](https://bughunters.google.com/report).\n \n For more information about how Google handles security issues, see [Google's security philosophy](https://www.google.com/about/appsecurity).\n \n\n\n###\n\n", "completion": "docs: update security guide (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/image-directive.md | file path B: aio/content/guide/image-directive.md\n\n@@ -27,8 +27,8 @@ You will need to import the directive into your application. In addition, you wi\n \n To activate the `NgOptimizedImage` directive, replace your image's `src` attribute with `rawSrc`.\n \n-<code-example format=\"typescript\" language=\"typescript\">\n-<img rawSrc=\u201dcat.jpg\" width=\"400\" height=\"200\">\n+<code-example format=\"html\" language=\"html\">\n+  &lt;img rawSrc=\u201dcat.jpg\" width=\"400\" height=\"200\"&gt;\n </code-example>\n \n The built-in third-party loaders prepend a shared base URL to `src`. If you're using one of these loaders (or any other loader that does this), make sure to omit the shared base URL path from `src` to prevent unnecessary duplication.\n@@ -39,8 +39,8 @@ You must also set the `width` and `height` attributes. This is done to prevent [\n \n Always mark the [LCP image](https://web.dev/lcp/#what-elements-are-considered) on your page as `priority` to prioritize its loading.\n \n-<code-example format=\"typescript\" language=\"typescript\">\n-<img rawSrc=\"cat.jpg\" width=\"400\" height=\"200\" priority>\n+<code-example format=\"html\" language=\"html\">\n+  &lt;img rawSrc=\"cat.jpg\" width=\"400\" height=\"200\" priority&gt;\n </code-example>\n \n Marking an image as `priority` applies the following optimizations:\n@@ -55,7 +55,7 @@ Angular displays a warning during development if the LCP element is an image tha\n You can add a [`preconnect` resource hint](https://web.dev/preconnect-and-dns-prefetch/) for your image origin to ensure that the LCP image loads as quickly as possible. Always put resource hints in the `<head>` of the document.\n \n <code-example format=\"html\" language=\"html\">\n-<link rel=\"preconnect\" href=\"https://my.cdn.origin\" />\n+  &lt;link rel=\"preconnect\" href=\"https://my.cdn.origin\" &gt;\n </code-example>\n \n By default, if you use a loader for a third-party image service, the `NgOptimizedImage` directive will warn during development if it detects that there is no `preconnect` resource hint for the origin that serves the LCP image.\n@@ -79,7 +79,7 @@ You can typically fix this by adding `height: auto` or `width: auto` to your ima\n If your `<img>` tag defines a `srcset` attribute, replace it with `rawSrcset`.\n \n <code-example format=\"html\" language=\"html\">\n-<img rawSrc=\"hero.jpg\" rawSrcset=\"100w, 200w, 300w\">\n+  &lt;img rawSrc=\"hero.jpg\" rawSrcset=\"100w, 200w, 300w\"&gt;\n </code-example>\n \n If the `rawSrcset` attribute is present, `NgOptimizedImage` generates and sets the [`srcset` attribute](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/srcset) using the configured image loader. Do not include image file names in `rawSrcset` - the directive infers this information from `rawSrc`. The directive supports both width descriptors (e.g. `100w`) and density descriptors (e.g. `1x`) are supported.\n@@ -87,7 +87,7 @@ If the `rawSrcset` attribute is present, `NgOptimizedImage` generates and sets t\n You can also use `rawSrcset` with the standard image [`sizes` attribute](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/sizes).\n \n <code-example format=\"html\" language=\"html\">\n-<img rawSrc=\"hero.jpg\" rawSrcset=\"100w, 200w, 300w\" sizes=\u201d50vw\u201d>\n+  &lt;img rawSrc=\"hero.jpg\" rawSrcset=\"100w, 200w, 300w\" sizes=\u201d50vw\u201d&gt;\n </code-example>\n \n ### Disabling image lazy loading\n@@ -95,5 +95,5 @@ You can also use `rawSrcset` with the standard image [`sizes` attribute](https:/\n By default, `NgOptimizedImage` sets `loading=lazy` for all images that are not marked `priority`. You can disable this behavior for non-priority images by setting the `loading` attribute. This attribute accepts values: `eager`, `auto`, and `lazy`. [See the documentation for the standard image `loading` attribute for details](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/loading#value).\n \n <code-example format=\"html\" language=\"html\">\n-<img rawSrc=\"cat.jpg\" width=\"400\" height=\"200\" loading=\"eager\">\n+  &lt;img rawSrc=\"cat.jpg\" width=\"400\" height=\"200\" loading=\"eager\"&gt;\n </code-example>\n\n\n###\n\n", "completion": "docs(common): fix code examples in image directive guide (#<issue-num>)"}
{"prompt": " file path A: package.json | file path B: package.json\n\n@@ -180,7 +180,7 @@\n   \"// 2\": \"devDependencies are not used under Bazel. Many can be removed after test.sh is deleted.\",\n   \"devDependencies\": {\n     \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#2c68d0f9752df9bdbb185b89630ea085a2e62484\",\n-    \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#1a7be8a4a108ae0eee5c496072ce865043146d4d\",\n+    \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#da938be2693c1c05ad7ab74b5f6c0dedc2ffa5ca\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n     \"@bazel/buildifier\": \"^5.0.0\",\n     \"@bazel/ibazel\": \"^0.16.0\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -159,7 +159,6 @@\n \n \"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#2c68d0f9752df9bdbb185b89630ea085a2e62484\":\n   version \"0.0.0-5ffe2357f61a57d16f44a3209cd880c211c575b5\"\n-  uid \"2c68d0f9752df9bdbb185b89630ea085a2e62484\"\n   resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#2c68d0f9752df9bdbb185b89630ea085a2e62484\"\n   dependencies:\n     \"@angular-devkit/build-angular\" \"14.2.0-rc.0\"\n@@ -265,10 +264,9 @@\n   dependencies:\n     tslib \"^2.3.0\"\n \n-\"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#1a7be8a4a108ae0eee5c496072ce865043146d4d\":\n-  version \"0.0.0-5ffe2357f61a57d16f44a3209cd880c211c575b5\"\n-  uid \"1a7be8a4a108ae0eee5c496072ce865043146d4d\"\n-  resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#1a7be8a4a108ae0eee5c496072ce865043146d4d\"\n+\"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#da938be2693c1c05ad7ab74b5f6c0dedc2ffa5ca\":\n+  version \"0.0.0-806c568a439877f69b975aedbf5e4eb26fd7eaaf\"\n+  resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#da938be2693c1c05ad7ab74b5f6c0dedc2ffa5ca\"\n   dependencies:\n     \"@yarnpkg/lockfile\" \"^1.1.0\"\n     typescript \"~4.7.3\"\n\n\n###\n\n", "completion": "build: update ng-dev version (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/url.ts | file path B: packages/common/src/directives/ng_optimized_image/url.ts\n\n@@ -17,12 +17,6 @@ export function isAbsoluteUrl(src: string): boolean {\n   return /^https?:\\/\\//.test(src);\n }\n \n-// Invokes a callback for each element in the array. Also invokes a callback\n-// recursively for each nested array.\n-export function deepForEach<T>(input: (T|any[])[], fn: (value: T) => void): void {\n-  input.forEach(value => Array.isArray(value) ? deepForEach(value, fn) : fn(value));\n-}\n-\n // Given a URL, extract the hostname part.\n // If a URL is a relative one - the URL is returned as is.\n export function extractHostname(url: string): string {\n\n\n###\n\n", "completion": "fix(common): remove duplicate deepForEach (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -169,6 +169,9 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   private imgElement: HTMLImageElement = inject(ElementRef).nativeElement;\n   private injector = inject(Injector);\n \n+  // a LCP image observer - should be injected only in the dev mode\n+  private lcpObserver = ngDevMode ? this.injector.get(LCPImageObserver) : null;\n+\n   /**\n    * Calculate the rewritten `src` once and store it.\n    * This is needed to avoid repetitive calculations and make sure the directive cleanup in the\n@@ -277,10 +280,12 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n         // Monitor whether an image is an LCP element only in case\n         // the `priority` attribute is missing. Otherwise, an image\n         // has the necessary settings and no extra checks are required.\n-        invokeLCPImageObserverCallback(\n-            this.injector,\n-            (observer: LCPImageObserver) =>\n-                observer.registerImage(this.getRewrittenSrc(), this.rawSrc));\n+        if (this.lcpObserver !== null) {\n+          const ngZone = this.injector.get(NgZone);\n+          ngZone.runOutsideAngular(() => {\n+            this.lcpObserver!.registerImage(this.getRewrittenSrc(), this.rawSrc);\n+          });\n+        }\n       }\n     }\n     this.setHostAttributes();\n@@ -344,10 +349,8 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n \n   ngOnDestroy() {\n     if (ngDevMode) {\n-      if (!this.priority && this._renderedSrc !== null) {\n-        invokeLCPImageObserverCallback(\n-            this.injector,\n-            (observer: LCPImageObserver) => observer.unregisterImage(this._renderedSrc!));\n+      if (!this.priority && this._renderedSrc !== null && this.lcpObserver !== null) {\n+        this.lcpObserver.unregisterImage(this._renderedSrc);\n       }\n     }\n   }\n@@ -373,24 +376,6 @@ function inputToBoolean(value: unknown): boolean {\n   return value != null && `${value}` !== 'false';\n }\n \n-/**\n- * Invokes a function, passing an instance of the `LCPImageObserver` as an argument.\n- *\n- * Notes:\n- * - the `LCPImageObserver` is a tree-shakable provider, provided in 'root',\n- *   thus it's a singleton within this application\n- * - the process of `LCPImageObserver` creation and an actual operation are invoked outside of the\n- *   NgZone to make sure none of the calls inside the `LCPImageObserver` class trigger unnecessary\n- *   change detection\n- */\n-function invokeLCPImageObserverCallback(\n-    injector: Injector, operation: (observer: LCPImageObserver) => void): void {\n-  const ngZone = injector.get(NgZone);\n-  return ngZone.runOutsideAngular(() => {\n-    const observer = injector.get(LCPImageObserver);\n-    operation(observer);\n-  });\n-}\n \n /***** Assert functions *****/\n \n\n\n###\n\n", "completion": "fix(common): avoid interacting with a destroyed injector (#<issue-num>)"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -266,6 +266,8 @@ groups:\n           'aio/content/images/guide/frequent-ngmodules/**/{*,.*}',\n           'aio/content/guide/hierarchical-dependency-injection.md',\n           'aio/content/examples/hierarchical-dependency-injection/**/{*,.*}',\n+          'aio/content/guide/image-directive.md',\n+          'aio/content/guide/image-directive-setup.md',\n           'aio/content/examples/providers-viewproviders/**/{*,.*}',\n           'aio/content/examples/resolution-modifiers/**/{*,.*}',\n           'aio/content/guide/lazy-loading-ngmodules.md',\n\n---\n file path A: None | file path B: aio/content/guide/image-directive-setup.md\n\n@@ -0,0 +1,96 @@\n+# Setting up `NgOptimizedImage`\n+\n+This tutorial explains how to setup the `NgOptimizedImage`. For information on using `NgOptimizedImage`, see [Getting Started with NgOptimizedImage](/guide/image-directive).\n+\n+## Import `NgOptimizedImage`\n+\n+You can import `NgOptimizedImage` from the `@angular/common` module. The directive is defined as a [standalone directive](/guide/standalone-components), so components should import it directly.\n+\n+## Configure an `ImageLoader`\n+\n+A \"loader\" is a function that generates the [image transformation URL](https://web.dev/image-cdns/#how-image-cdns-use-urls-to-indicate-optimization-options) for a given image file. When appropriate, `NgOptimzedImage` sets the size, format, and image quality transformations for an image.\n+\n+`NgOptimizedImage` provides a generic loader as well as loaders for various third-party image services; it also supports writing your own custom loader.\n+\n+| Loader type| Behavior |\n+|:--- |:--- |\n+| Generic loader | The URL returned by the generic loader will always match the value of `src`. In other words, this loader applies no transformations. Sites that use Angular to serve images are the primary intended use case for this loader.|\n+| Loaders for third-party image services | The URL returned by the loaders for third-party image services will follow API conventions used by that particular image service. |\n+| Custom loaders | A custom loader's behavior is defined by its developer. You should use a custom loader if your image service isn't supported by the loaders that come preconfigured with `NgOptimzedImage`.|\n+\n+Based on the image services commonly used with Angular applications, `NgOptimizedImage` provides loaders preconfigured to work with the following image services:\n+\n+| Image Service | Angular API | Documentation |\n+|:--- |:--- |:--- |\n+| Cloudflare Image Resizing | `provideCloudflareLoader` | [Documentation](https://developers.cloudflare.com/images/image-resizing/) |\n+| Cloudinary | `provideCloudinaryLoader` | [Documentation](https://developers.cloudflare.com/images/image-resizing/) |  |\n+| ImageKit | `provideImageKitLoader` | [Documentation](https://docs.imagekit.io/) |\n+| Imgix | `provideImgixLoader` | [Documentation](https://docs.imgix.com/) |\n+\n+You must configure an image loader to use `NgOptimizedImage`.\n+\n+These instructions explain how to setup an image loader for use with the `NgOptimizedImage`. \n+\n+1. Import the `NgOptimizedImage` directive into the application by adding it to the `imports` section of an NgModule or a standalone Component.\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+import { NgOptimizedImage } from '@angular/common';\n+// Include NgOptimizedImage in the appropriate NgModule\n+@NgModule({\n+  imports: [\n+    // ... other imports\n+    NgOptimizedImage,\n+  ],\n+})\n+\n+class AppModule {}\n+</code-example>\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+@Component({\n+  standalone: true,\n+  imports: [\n+    // ... other imports\n+    NgOptimizedImage,\n+  ],\n+})\n+\n+class MyStandaloneComponent {}\n+</code-example>\n+\n+2. Configure a loader that you want to use.\n+\n+To use the **generic loader**: no additional code changes are necessary.\n+\n+To use an existing loader for a **third-party image service**: add the provider factory for your chosen service to the `providers` array. In the example below, the Imgix loader is used:\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+providers: [\n+  provideImgixLoader('https://my.base.url/'),\n+],\n+</code-example>\n+\n+The base URL for your image assets should be passed to the provider factory as an argument. For most sites, this base URL should match one of the following patterns:\n+\n+*   https://yoursite.yourcdn.com\n+*   https://subdomain.yoursite.com\n+*   https://subdomain.yourcdn.com/yoursite\n+\n+You can learn more about the base URL structure in the docs of a corresponding CDN provider.\n+\n+To use a **custom loader**: provide your loader function as a value for the `IMAGE_LOADER` DI token. In the example below, the custom loader function returns a URL starting with `https://example.com` that includes `src` and `width` as URL parameters.\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+providers: [\n+  {\n+    provide: IMAGE_LOADER,\n+    useValue: (config: ImageLoaderConfig) => {\n+      return `https://example.com/images?src=${config.src}&width=${config.width}`;\n+    },\n+  },\n+],\n+</code-example>\n+\n+A loader function for the `NgOptimizedImage` directive takes an object with the `ImageLoaderConfig` type (from `@angular/common`) as its argument and returns the absolute URL of the image asset. The `ImageLoaderConfig` object contains the `src`and `width` properties.\n+\n+Note: a custom loader must support requesting images at various widths in order for `rawSrcset` to work properly.\n\\ No newline at end of file\n\n---\n file path A: None | file path B: aio/content/guide/image-directive.md\n\n@@ -0,0 +1,99 @@\n+# Getting started with NgOptimizedImage\n+\n+Note: the `NgOptimizedImage` directive is currently in the [\u201cDeveloper Preview\u201d mode](https://angular.io/guide/releases#developer-preview). The Angular team will stabilize the APIs based on the feedback and will make an announcement once the APIs are fully stable.\n+\n+The `NgOptimizedImage` directive makes it easy to adopt performance best practices for loading images.\n+\n+The `NgOptimizedImage` directive ensures that the loading of the [Largest Contentful Paint](http://web.dev/lcp) image is prioritized by:\n+\n+*   Automatically setting the `fetchpriority` attribute on the `<img>` tag\n+*   Lazy loading other images by default\n+*   Asserting that there is a corresponding preconnect link tag in the document head\n+\n+In addition to optimizing the loading of the LCP image, `NgOptimizedImage` enforces a number of image best practices:\n+\n+*   Using [image URLs to apply image optimizations](https://web.dev/image-cdns/#how-image-cdns-use-urls-to-indicate-optimization-options)\n+*   Requires that `width` and `height` are set\n+*   Warns if `width` or `height` have been set incorrectly\n+*   Warns if the image will be visually distorted when rendered\n+\n+## Prerequisites\n+\n+You will need to import the directive into your application. In addition, you will need to setup an image loader. These steps are explained in the [Setting up `NgOptimizedImage`](/guide/image-directive-setup) tutorial.\n+\n+## Usage in a template\n+\n+### Overview\n+\n+To activate the `NgOptimizedImage` directive, replace your image's `src` attribute with `rawSrc`.\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+<img rawSrc=\u201dcat.jpg\" width=\"400\" height=\"200\">\n+</code-example>\n+\n+The built-in third-party loaders prepend a shared base URL to `src`. If you're using one of these loaders (or any other loader that does this), make sure to omit the shared base URL path from `src` to prevent unnecessary duplication.\n+\n+You must also set the `width` and `height` attributes. This is done to prevent [image-related layout shifts](https://web.dev/css-web-vitals/#images-and-layout-shifts).  The `width` and `height` attributes should reflect the [intrinsic size](https://developer.mozilla.org/en-US/docs/Glossary/Intrinsic_Size) of the image. During development, the `NgOptimizedImage` warns if it detects that the `width` and `height` attributes have been set incorrectly.\n+\n+### Marking images as `priority`\n+\n+Always mark the [LCP image](https://web.dev/lcp/#what-elements-are-considered) on your page as `priority` to prioritize its loading.\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+<img rawSrc=\"cat.jpg\" width=\"400\" height=\"200\" priority>\n+</code-example>\n+\n+Marking an image as `priority` applies the following optimizations:\n+\n+*   Sets `fetchpriority=high` (read more about priority hints [here](https://web.dev/priority-hints/))\n+*   Sets `loading=eager` (read more about native lazy loading [here](https://web.dev/browser-level-image-lazy-loading/))\n+\n+Angular displays a warning during development if the LCP element is an image that does not have the `priority` attribute. A page\u2019s LCP element can vary based on a number of factors - such as the dimensions of a user's screen. A page may have multiple images that should be marked `priority`. See [CSS for Web Vitals](https://web.dev/css-web-vitals/#images-and-largest-contentful-paint-lcp) for more details.\n+\n+### Adding resource hints\n+\n+You can add a [`preconnect` resource hint](https://web.dev/preconnect-and-dns-prefetch/) for your image origin to ensure that the LCP image loads as quickly as possible. Always put resource hints in the `<head>` of the document.\n+\n+<code-example format=\"html\" language=\"html\">\n+<link rel=\"preconnect\" href=\"https://my.cdn.origin\" />\n+</code-example>\n+\n+By default, if you use a loader for a third-party image service, the `NgOptimizedImage` directive will warn during development if it detects that there is no `preconnect` resource hint for the origin that serves the LCP image.\n+\n+To disable these warnings, add `{ensurePreconnect: false}` to the arguments passed to the provider factory for your chosen image service:\n+\n+<code-example format=\"typescript\" language=\"typescript\">\n+providers: [\n+  provideImgixLoader('https://my.base.url', {ensurePreconnect: false})\n+],\n+</code-example>\n+\n+### Adjusting image styling\n+\n+Depending on the image's styling, adding `width` and `height` attributes may cause the image to render differently. `NgOptimizedImage` warns you if your image styling renders the image at a distorted aspect ratio.\n+\n+You can typically fix this by adding `height: auto` or `width: auto` to your image styles. For more information, see the [web.dev article on the `<img>` tag](https://web.dev/patterns/web-vitals-patterns/images/img-tag/).\n+\n+### Handling `srcset` attributes\n+\n+If your `<img>` tag defines a `srcset` attribute, replace it with `rawSrcset`.\n+\n+<code-example format=\"html\" language=\"html\">\n+<img rawSrc=\"hero.jpg\" rawSrcset=\"100w, 200w, 300w\">\n+</code-example>\n+\n+If the `rawSrcset` attribute is present, `NgOptimizedImage` generates and sets the [`srcset` attribute](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/srcset) using the configured image loader. Do not include image file names in `rawSrcset` - the directive infers this information from `rawSrc`. The directive supports both width descriptors (e.g. `100w`) and density descriptors (e.g. `1x`) are supported.\n+\n+You can also use `rawSrcset` with the standard image [`sizes` attribute](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/sizes).\n+\n+<code-example format=\"html\" language=\"html\">\n+<img rawSrc=\"hero.jpg\" rawSrcset=\"100w, 200w, 300w\" sizes=\u201d50vw\u201d>\n+</code-example>\n+\n+### Disabling image lazy loading\n+\n+By default, `NgOptimizedImage` sets `loading=lazy` for all images that are not marked `priority`. You can disable this behavior for non-priority images by setting the `loading` attribute. This attribute accepts values: `eager`, `auto`, and `lazy`. [See the documentation for the standard image `loading` attribute for details](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/loading#value).\n+\n+<code-example format=\"html\" language=\"html\">\n+<img rawSrc=\"cat.jpg\" width=\"400\" height=\"200\" loading=\"eager\">\n+</code-example>\n\n---\n file path A: aio/content/navigation.json | file path B: aio/content/navigation.json\n\n@@ -637,6 +637,11 @@\n           \"url\": \"guide/prerendering\",\n           \"title\": \"Prerendering\",\n           \"tooltip\": \"Prerender HTML server-side with Angular Universal.\"\n+        },\n+        {\n+          \"url\": \"guide/image-directive\",\n+          \"title\": \"Image Directive\",\n+          \"tooltip\": \"Performant images with the Angular image directive.\"\n         }\n       ]\n     },\n@@ -816,7 +821,12 @@\n           \"tooltip\": \"Create a template-driven form using directives and Angular template syntax.\"\n         },\n         {\n-          \"title\": \"Angular libraries\",\n+          \"url\": \"guide/image-directive-setup\",\n+          \"title\": \"Setting up NgOptimzedImage\",\n+          \"tooltip\": \"Setup the Angular image directive\"\n+        },\n+        {\n+          \"title\": \"Angular Libraries\",\n           \"tooltip\": \"Extending Angular with shared libraries.\",\n           \"children\": [\n             {\n\n\n###\n\n", "completion": "docs: add image directive guide (#<issue-num>)"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -24,20 +24,20 @@ version: 2.1\n # **NOTE 2 **: If you change the cache key prefix, also sync the cache_key_fallback to match.\n # **NOTE 3 **: Keep the static part of the cache key as prefix to enable correct fallbacks.\n # See https://circleci.com/docs/2.0/caching/#restoring-cache for how prefixes work in CircleCI.\n-var_3: &cache_key v7-angular-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}-{{ checksum \"aio/yarn.lock\" }}\n+var_3: &cache_key v8-angular-node-16-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}-{{ checksum \"aio/yarn.lock\" }}\n # We invalidate the cache if the Bazel version changes because otherwise the `bazelisk` cache\n # folder will contain all previously used versions and ultimately cause the cache restoring to\n # be slower due to its growing size.\n-var_4: &cache_key_fallback v7-angular-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}\n+var_4: &cache_key_fallback v8-angular-node-16-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}\n \n # Windows needs its own cache key because binaries in node_modules are different.\n-var_3_win: &cache_key_win v9-angular-win-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}\n-var_4_win: &cache_key_win_fallback v9-angular-win-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}\n+var_3_win: &cache_key_win v10-angular-win-node-16-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}\n+var_4_win: &cache_key_win_fallback v10-angular-win-node-16-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}\n \n # Cache key for the `components-repo-unit-tests` job. **Note** when updating the SHA in the\n # cache keys also update the SHA for the \"COMPONENTS_REPO_COMMIT\" environment variable.\n-var_5: &components_repo_unit_tests_cache_key v1-angular-components-{{ checksum \"month.txt\" }}-7a24e95bafbdeb697f74a48e275c2442bcbefc74\n-var_6: &components_repo_unit_tests_cache_key_fallback v1-angular-components-{{ checksum \"month.txt\" }}\n+var_5: &components_repo_unit_tests_cache_key v2-angular-components-{{ checksum \"month.txt\" }}-7a24e95bafbdeb697f74a48e275c2442bcbefc74\n+var_6: &components_repo_unit_tests_cache_key_fallback v2-angular-components-{{ checksum \"month.txt\" }}\n \n # Workspace initially persisted by the `setup` job, and then enhanced by `build-npm-packages`.\n # https://circleci.com/docs/2.0/workflows/#using-workspaces-to-share-data-among-jobs\n\n\n###\n\n", "completion": "build: invalidate circleci cache to prune unused nested node modules (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -32,9 +32,9 @@ const VALID_WIDTH_DESCRIPTOR_SRCSET = /^((\\s*\\d+w\\s*(,|$)){1,})$/;\n \n /**\n  * RegExpr to determine whether a src in a srcset is using density descriptors.\n- * Should match something like: \"1x, 2x\". Also supports decimals like \"1.5x\".\n+ * Should match something like: \"1x, 2x, 50x\". Also supports decimals like \"1.5x, 1.50x\".\n  */\n-const VALID_DENSITY_DESCRIPTOR_SRCSET = /^((\\s*\\d(\\.\\d+)?x\\s*(,|$)){1,})$/;\n+const VALID_DENSITY_DESCRIPTOR_SRCSET = /^((\\s*\\d+(\\.\\d+)?x\\s*(,|$)){1,})$/;\n \n /**\n  * Srcset values with a density descriptor higher than this value will actively\n@@ -506,7 +506,7 @@ function assertUnderDensityCap(dir: NgOptimizedImage, value: string) {\n             `${RECOMMENDED_SRCSET_DENSITY_CAP}x but supports image densities up to ` +\n             `${ABSOLUTE_SRCSET_DENSITY_CAP}x. The human eye cannot distinguish between image densities ` +\n             `greater than ${RECOMMENDED_SRCSET_DENSITY_CAP}x - which makes them unnecessary for ` +\n-            `most use cases. Images that will be pinch-zoomed are typically the primary use case for` +\n+            `most use cases. Images that will be pinch-zoomed are typically the primary use case for ` +\n             `${ABSOLUTE_SRCSET_DENSITY_CAP}x images. Please remove the high density descriptor and try again.`);\n   }\n }\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -367,7 +367,36 @@ describe('Image directive', () => {\n                 `${ABSOLUTE_SRCSET_DENSITY_CAP}x. The human eye cannot distinguish between image densities ` +\n                 `greater than ${\n                     RECOMMENDED_SRCSET_DENSITY_CAP}x - which makes them unnecessary for ` +\n-                `most use cases. Images that will be pinch-zoomed are typically the primary use case for` +\n+                `most use cases. Images that will be pinch-zoomed are typically the primary use case for ` +\n+                `${ABSOLUTE_SRCSET_DENSITY_CAP}x images. Please remove the high density descriptor and try again.`);\n+      });\n+\n+\n+      it('should throw if rawSrcset exceeds the density cap with multiple digits', () => {\n+        const imageLoader = (config: ImageLoaderConfig) => {\n+          const width = config.width ? `-${config.width}` : ``;\n+          return window.location.origin + `/path/${config.src}${width}.png`;\n+        };\n+        setupTestingModule({imageLoader});\n+\n+        const template = `\n+            <img rawSrc=\"img\" rawSrcset=\"1x, 200x\" width=\"100\" height=\"50\">\n+          `;\n+        expect(() => {\n+          const fixture = createTestComponent(template);\n+          fixture.detectChanges();\n+        })\n+            .toThrowError(\n+                `NG0${\n+                    RuntimeErrorCode\n+                        .INVALID_INPUT}: The NgOptimizedImage directive (activated on an <img> element with the \\`rawSrc=\"img\"\\`) ` +\n+                `has detected that the \\`rawSrcset\\` contains an unsupported image density:` +\n+                `\\`1x, 200x\\`. NgOptimizedImage generally recommends a max image density of ` +\n+                `${RECOMMENDED_SRCSET_DENSITY_CAP}x but supports image densities up to ` +\n+                `${ABSOLUTE_SRCSET_DENSITY_CAP}x. The human eye cannot distinguish between image densities ` +\n+                `greater than ${\n+                    RECOMMENDED_SRCSET_DENSITY_CAP}x - which makes them unnecessary for ` +\n+                `most use cases. Images that will be pinch-zoomed are typically the primary use case for ` +\n                 `${ABSOLUTE_SRCSET_DENSITY_CAP}x images. Please remove the high density descriptor and try again.`);\n       });\n \n\n\n###\n\n", "completion": "fix(common): consider density descriptors with multiple digits as valid (#<issue-num>)"}
{"prompt": " file path A: aio/content/marketing/resources.json | file path B: aio/content/marketing/resources.json\n\n@@ -84,6 +84,18 @@\n             \"title\": \"Angular Rocks\",\n             \"url\": \"https://angularrocks.com\"\n           },\n+          \"angular-master-podcast\": {\n+            \"desc\": \"Listen / Code / Repeat. Everything you need to fall in love with Angular for a long time.\",\n+            \"logo\": \"https://ng-poland.pl/images/podcast/angular-master-podcast-logo.png\",\n+            \"title\": \"Angular Master Podcast\",\n+            \"url\": \"https://anchor.fm/angular-master/\"\n+          },\n+          \"javascript-master-podcast\": {\n+            \"desc\": \"Listen / Code / Repeat. Everything you need to know to become an informed JavaScript developer.\",\n+            \"logo\": \"https://ng-poland.pl/images/podcast/javascript-master-podcast-logo.png\",\n+            \"title\": \"JavaScript Master Podcast\",\n+            \"url\": \"https://anchor.fm/javascript-master/\"\n+          },\n           \"happy-angular\": {\n             \"desc\": \"A weekly German podcast for Angular on the go\",\n             \"logo\": \"\",\n\n\n###\n\n", "completion": "docs: add Angular & JavaScript Master Podcast to resources list (#<issue-num>)"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -158,10 +158,10 @@ cldr_xml_data_repository(\n # sass rules\n http_archive(\n     name = \"io_bazel_rules_sass\",\n-    sha256 = \"85b34f2e5e227aa586b6e0fd6942262e17b3cface596891eeef5a29a0b7467e3\",\n-    strip_prefix = \"rules_sass-697e5a08bdd39aee49f2c6f4eb621ef59e677e49\",\n+    sha256 = \"926cdd6133926a69e557172cb3232d5dac64ec6b8f167b7dceecd96cc4c6f19b\",\n+    strip_prefix = \"rules_sass-6802532fce57dee2a17be221d82cf441a923aeb7\",\n     urls = [\n-        \"https://github.com/bazelbuild/rules_sass/archive/697e5a08bdd39aee49f2c6f4eb621ef59e677e49.zip\",\n+        \"https://github.com/bazelbuild/rules_sass/archive/6802532fce57dee2a17be221d82cf441a923aeb7.zip\",\n     ],\n )\n \n\n\n###\n\n", "completion": "build: update io_bazel_rules_sass digest to 6802532 (#<issue-num>)"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -1096,7 +1096,7 @@ groups:\n     <<: *defaults\n     conditions:\n       - >\n-        contains_any_globs(files, [\n+        contains_any_globs(files.exclude('.pullapprove.yml'), [\n           '{*,.*}',\n           '.circleci/**/{*,.*}',\n           '.devcontainer/**/{*,.*}',\n\n\n###\n\n", "completion": "ci: do not match dev-infra group for pullapprove owner changes (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/lifecycle-hooks.md | file path B: aio/content/guide/lifecycle-hooks.md\n\n@@ -40,7 +40,7 @@ Use them to perform the following kinds of operations.\n \n | Hook method               | Purpose                                                                                                                                                                                                                                                                                                                                                | Timing |\n |:---                       |:---                                                                                                                                                                                                                                                                                                                                                    |:---    |\n-| `ngOnChanges()`           | Respond when Angular sets or resets data-bound input properties. The method receives a `SimpleChanges` object of current and previous property values. <br /> <div class=\"alert is-helpful\"> **NOTE**: <br /> This happens very frequently, so any operation you perform here impacts performance significantly. </div> See details in [Using change detection hooks](#onchanges) in this document. | Called before `ngOnInit()` \\(if the component has bound inputs\\) and whenever one or more data-bound input properties change. <br /> <div class=\"alert is-helpful\"> **NOTE**: <br /> If your component has no inputs or you use it without providing any inputs, the framework will not call `ngOnChanges()`. </div> |\n+| `ngOnChanges()`           | Respond when Angular sets or resets data-bound input properties. The method receives a `SimpleChanges` object of current and previous property values. <br /> <div class=\"alert is-helpful\"> **NOTE**: <br /> This happens frequently, so any operation you perform here impacts performance significantly. </div> See details in [Using change detection hooks](#onchanges) in this document. | Called before `ngOnInit()` \\(if the component has bound inputs\\) and whenever one or more data-bound input properties change. <br /> <div class=\"alert is-helpful\"> **NOTE**: <br /> If your component has no inputs or you use it without providing any inputs, the framework will not call `ngOnChanges()`. </div> |\n | `ngOnInit()`              | Initialize the directive or component after Angular first displays the data-bound properties and sets the directive or component's input properties. See details in [Initializing a component or directive](#oninit) in this document.                                                                                                                 | Called once, after the first `ngOnChanges()`. `ngOnInit()` is still called even when `ngOnChanges()` is not \\(which is the case when there are no template-bound inputs\\).                                                                                              |\n | `ngDoCheck()`             | Detect and act upon changes that Angular can't or won't detect on its own. See details and example in [Defining custom change detection](#docheck) in this document.                                                                                                                                                                                   | Called immediately after `ngOnChanges()` on every change detection run, and immediately after `ngOnInit()` on the first run.                                                                                                                                            |\n | `ngAfterContentInit()`    | Respond after Angular projects external content into the component's view, or into the view that a directive is in. <br /> See details and example in [Responding to changes in content](#aftercontent) in this document.                                                                                                                              | Called *once* after the first `ngDoCheck()`.                                                                                                                                                                                                                            |\n@@ -121,12 +121,16 @@ The sequence of log messages follows the prescribed hook calling order:\n |:---        |:---                   |\n | 1          | `OnChanges`           |\n | 2          | `OnInit`              |\n-| 3-5        | `DoCheck`             |\n-| 6          | `AfterContentInit`    |\n-| 7-9        | `AfterContentChecked` |\n-| 10         | `AfterViewInit`       |\n-| 11-13      | `AfterViewChecked`    |\n-| 14         | `OnDestroy`           |\n+| 3          | `DoCheck`             |\n+| 4          | `AfterContentInit`    |\n+| 5          | `AfterContentChecked` |\n+| 6          | `AfterViewInit`       |\n+| 7          | `AfterViewChecked`    |\n+| 8          | `DoCheck`             |\n+| 9          | `AfterContentChecked` |\n+| 10         | `AfterViewChecked`    |\n+| 11         | `OnDestroy`           |\n+\n \n <div class=\"alert is-helpful\">\n \n@@ -151,8 +155,8 @@ The example does not perform any initialization or clean-up.\n It just tracks the appearance and disappearance of an element in the view by recording when the directive itself is instantiated and destroyed.\n \n A spy directive like this can provide insight into a DOM object that you cannot change directly.\n-You can't touch the implementation of a built-in `<div>`, or modify a third party component.\n-You can, however watch these elements with a directive.\n+You can't access the implementation of a built-in `<div>`, or modify a third party component.\n+You do have the option to watch these elements with a directive.\n \n The directive defines `ngOnInit()` and `ngOnDestroy()` hooks\n that log messages to the parent using an injected `LoggerService`.\n@@ -253,8 +257,8 @@ The `LoggerService.tick_then()` statement postpones the log update for one turn\n \n #### Write lean hook methods to avoid performance problems\n \n-When you run the *AfterView* sample, notice how frequently Angular calls `AfterViewChecked()`-often when there are no changes of interest.\n-Be very careful about how much logic or computation you put into one of these methods.\n+When you run the *AfterView* sample, notice how frequently Angular calls `AfterViewChecked()` - often when there are no changes of interest.\n+Be careful about how much logic or computation you put into one of these methods.\n \n <div class=\"lightbox\">\n \n@@ -284,7 +288,7 @@ AngularJS developers know this technique as *transclusion*.\n The *AfterContent* sample explores the `AfterContentInit()` and `AfterContentChecked()` hooks that Angular calls *after* Angular projects external content into the component.\n \n Consider this variation on the [previous *AfterView*](#afterview) example.\n-This time, instead of including the child view within the template, it imports the content from the `AfterContentComponent`'s parent.\n+This time, instead of including the child view within the template, it imports the content from the `AfterContentComponent` hook's parent.\n The following is the parent's template.\n \n <code-example header=\"AfterContentParentComponent (template excerpt)\" path=\"lifecycle-hooks/src/app/after-content-parent.component.ts\" region=\"parent-template\"></code-example>\n@@ -354,7 +358,7 @@ The results are illuminating.\n \n </div>\n \n-While the `ngDoCheck()` hook can detect when the hero's `name` has changed, it is very expensive.\n+While the `ngDoCheck()` hook can detect when the hero's `name` has changed, it is an expensive hook.\n This hook is called with enormous frequency &mdash;after *every* change detection cycle no matter where the change occurred.\n It's called over twenty times in this example before the user can do anything.\n \n\n---\n file path A: aio/content/images/guide/lifecycle-hooks/peek-a-boo.png | file path B: aio/content/images/guide/lifecycle-hooks/peek-a-boo.png\n\nBinary files a/aio/content/images/guide/lifecycle-hooks/peek-a-boo.png and b/aio/content/images/guide/lifecycle-hooks/peek-a-boo.png differ\n\n\n###\n\n", "completion": "docs: update peek-a-boo example (#<issue-num>)"}
{"prompt": " file path A: aio/content/marketing/resources.json | file path B: aio/content/marketing/resources.json\n\n@@ -816,6 +816,11 @@\n             \"title\": \"Angular University\",\n             \"url\": \"https://angular-university.io/\"\n           },\n+          \"angular-master-dev\": {\n+            \"desc\": \"Angular Architecture: Strategic Design with Nx - Online Video Course\",\n+            \"title\": \"Angular Master\",\n+            \"url\": \"https://angularmaster.dev/\"\n+          },\n           \"-acceleb\": {\n             \"desc\": \"Customized, Instructor-Led Angular Training\",\n             \"title\": \"Accelebrate\",\n\n\n###\n\n", "completion": "docs: add Angular Master website to resources list (#<issue-num>)"}
{"prompt": " file path A: aio/tools/examples/shared/boilerplate/cli-ajs/package.json | file path B: aio/tools/examples/shared/boilerplate/cli-ajs/package.json\n\n@@ -30,7 +30,7 @@\n   },\n   \"devDependencies\": {\n     \"@angular-devkit/build-angular\": \"^14.1.0\",\n-    \"@angular/cli\": \"^14.0.0\",\n+    \"@angular/cli\": \"^14.1.0\",\n     \"@angular/compiler-cli\": \"^14.1.0\",\n     \"@types/angular\": \"^1.8.4\",\n     \"@types/angular-route\": \"^1.7.2\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/cli/package.json | file path B: aio/tools/examples/shared/boilerplate/cli/package.json\n\n@@ -28,7 +28,7 @@\n   },\n   \"devDependencies\": {\n     \"@angular-devkit/build-angular\": \"^14.1.0\",\n-    \"@angular/cli\": \"^14.0.0\",\n+    \"@angular/cli\": \"^14.1.0\",\n     \"@angular/compiler-cli\": \"^14.1.0\",\n     \"@types/jasmine\": \"~4.0.0\",\n     \"@types/node\": \"^16.11.35\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/elements/package.json | file path B: aio/tools/examples/shared/boilerplate/elements/package.json\n\n@@ -29,7 +29,7 @@\n   },\n   \"devDependencies\": {\n     \"@angular-devkit/build-angular\": \"^14.1.0\",\n-    \"@angular/cli\": \"^14.0.0\",\n+    \"@angular/cli\": \"^14.1.0\",\n     \"@angular/compiler-cli\": \"^14.1.0\",\n     \"@types/jasmine\": \"~4.0.0\",\n     \"@types/node\": \"^16.11.35\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/i18n/package.json | file path B: aio/tools/examples/shared/boilerplate/i18n/package.json\n\n@@ -31,7 +31,7 @@\n   },\n   \"devDependencies\": {\n     \"@angular-devkit/build-angular\": \"^14.1.0\",\n-    \"@angular/cli\": \"^14.0.0\",\n+    \"@angular/cli\": \"^14.1.0\",\n     \"@angular/compiler-cli\": \"^14.1.0\",\n     \"@types/jasmine\": \"~4.0.0\",\n     \"@types/node\": \"^16.11.35\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/service-worker/package.json | file path B: aio/tools/examples/shared/boilerplate/service-worker/package.json\n\n@@ -29,7 +29,7 @@\n   },\n   \"devDependencies\": {\n     \"@angular-devkit/build-angular\": \"^14.1.0\",\n-    \"@angular/cli\": \"^14.0.0\",\n+    \"@angular/cli\": \"^14.1.0\",\n     \"@angular/compiler-cli\": \"^14.1.0\",\n     \"@types/jasmine\": \"~4.0.0\",\n     \"@types/node\": \"^16.11.35\",\n\n---\n file path A: aio/tools/examples/shared/boilerplate/universal/package.json | file path B: aio/tools/examples/shared/boilerplate/universal/package.json\n\n@@ -26,7 +26,7 @@\n     \"@angular/platform-browser-dynamic\": \"^14.1.0\",\n     \"@angular/platform-server\": \"^14.1.0\",\n     \"@angular/router\": \"^14.1.0\",\n-    \"@nguniversal/express-engine\": \"~14.1.0\",\n+    \"@nguniversal/express-engine\": \"^14.1.0\",\n     \"angular-in-memory-web-api\": \"~0.14.0\",\n     \"express\": \"^4.18.1\",\n     \"rxjs\": \"~7.5.0\",\n@@ -35,9 +35,9 @@\n   },\n   \"devDependencies\": {\n     \"@angular-devkit/build-angular\": \"^14.1.0\",\n-    \"@angular/cli\": \"^14.0.0\",\n+    \"@angular/cli\": \"^14.1.0\",\n     \"@angular/compiler-cli\": \"^14.1.0\",\n-    \"@nguniversal/builders\": \"~14.1.0\",\n+    \"@nguniversal/builders\": \"^14.1.0\",\n     \"@types/express\": \"^4.17.13\",\n     \"@types/jasmine\": \"~4.0.0\",\n     \"@types/node\": \"^16.11.35\",\n\n---\n file path A: aio/tools/examples/shared/package.json | file path B: aio/tools/examples/shared/package.json\n\n@@ -34,7 +34,7 @@\n     \"@angular/router\": \"^14.1.0\",\n     \"@angular/service-worker\": \"^14.1.0\",\n     \"@angular/upgrade\": \"^14.1.0\",\n-    \"@nguniversal/express-engine\": \"~14.1.0\",\n+    \"@nguniversal/express-engine\": \"^14.1.0\",\n     \"angular\": \"^1.8.3\",\n     \"angular-in-memory-web-api\": \"~0.14.0\",\n     \"angular-route\": \"1.8.3\",\n@@ -48,9 +48,9 @@\n   },\n   \"devDependencies\": {\n     \"@angular-devkit/build-angular\": \"^14.1.0\",\n-    \"@angular/cli\": \"^14.0.0\",\n+    \"@angular/cli\": \"^14.1.0\",\n     \"@angular/compiler-cli\": \"^14.1.0\",\n-    \"@nguniversal/builders\": \"~14.1.0\",\n+    \"@nguniversal/builders\": \"^14.1.0\",\n     \"@rollup/plugin-commonjs\": \"^22.0.0\",\n     \"@rollup/plugin-node-resolve\": \"^13.2.0\",\n     \"@types/angular\": \"^1.8.4\",\n\n---\n file path A: aio/tools/examples/shared/yarn.lock | file path B: aio/tools/examples/shared/yarn.lock\n\n@@ -144,7 +144,7 @@\n   dependencies:\n     tslib \"^2.3.0\"\n \n-\"@angular/cli@^14.0.0\":\n+\"@angular/cli@^14.1.0\":\n   version \"14.1.3\"\n   resolved \"https://registry.yarnpkg.com/@angular/cli/-/cli-14.1.3.tgz#44908568acd4ae1333b17f37eaa8408d1822c9c5\"\n   integrity sha512-JAvxOXXGf4VCJUQLe3g0pDNnOnE5E7tJfhqsn77+TGrhFpYPMmZ8z747ohiFXrTqbSe0dWTwOfqwpAA41R1CeA==\n@@ -972,9 +972,9 @@\n     \"@babel/helper-plugin-utils\" \"^7.18.9\"\n \n \"@babel/plugin-transform-destructuring@^7.18.6\":\n-  version \"7.18.13\"\n-  resolved \"https://registry.yarnpkg.com/@babel/plugin-transform-destructuring/-/plugin-transform-destructuring-7.18.13.tgz#9e03bc4a94475d62b7f4114938e6c5c33372cbf5\"\n-  integrity sha512-TodpQ29XekIsex2A+YJPj5ax2plkGa8YYY6mFjCohk/IG9IY42Rtuj1FuDeemfg2ipxIFLzPeA83SIBnlhSIow==\n+  version \"7.18.9\"\n+  resolved \"https://registry.yarnpkg.com/@babel/plugin-transform-destructuring/-/plugin-transform-destructuring-7.18.9.tgz#68906549c021cb231bee1db21d3b5b095f8ee292\"\n+  integrity sha512-p5VCYNddPLkZTq4XymQIaIfZNJwT9YsjkPOhkVEqt6QIpQFZVM9IltqqYpOEkJoN1DPznmxUDyZ5CTZs/ZCuHA==\n   dependencies:\n     \"@babel/helper-plugin-utils\" \"^7.18.9\"\n \n@@ -1546,7 +1546,7 @@\n   resolved \"https://registry.yarnpkg.com/@ngtools/webpack/-/webpack-14.1.1.tgz#a44846f337dd5077649b0b6e561707925db580a0\"\n   integrity sha512-pj8sN6jBIi2otTHE/CNQyy09Pmn8tGsZyFrSiNO147yjLnrOSJTeFuXfE2pYgrmcYgj0ybnK1zstt4bAKaL7/Q==\n \n-\"@nguniversal/builders@~14.1.0\":\n+\"@nguniversal/builders@^14.1.0\":\n   version \"14.1.0\"\n   resolved \"https://registry.yarnpkg.com/@nguniversal/builders/-/builders-14.1.0.tgz#eaff401cfd2d9886fcf35d0f5f0b5518c77a5782\"\n   integrity sha512-TOOV7P7+zJ2739Ty7BazV7V9q1sF+kiJmV3c3ZqXFeNoNG6CYtX52cAPM/OkuU9JFER/JNUtNBCDihEdQquI3Q==\n@@ -1572,7 +1572,7 @@\n     jsdom \"20.0.0\"\n     tslib \"^2.3.0\"\n \n-\"@nguniversal/express-engine@~14.1.0\":\n+\"@nguniversal/express-engine@^14.1.0\":\n   version \"14.1.0\"\n   resolved \"https://registry.yarnpkg.com/@nguniversal/express-engine/-/express-engine-14.1.0.tgz#cf8d318cbbdd1eb1576f0b41244628c6918f13a5\"\n   integrity sha512-nGlCqqodXzKWP5fcatCglUvueeICmUMPsSz1mhmkINxvtRK1pQtbh2SAGI+nWa2qe3BDl472/dcZ9dSPULr/RQ==\n@@ -1653,9 +1653,9 @@\n     infer-owner \"^1.0.4\"\n \n \"@npmcli/run-script@^4.1.0\":\n-  version \"4.2.1\"\n-  resolved \"https://registry.yarnpkg.com/@npmcli/run-script/-/run-script-4.2.1.tgz#c07c5c71bc1c70a5f2a06b0d4da976641609b946\"\n-  integrity sha512-7dqywvVudPSrRCW5nTHpHgeWnbBtz8cFkOuKrecm6ih+oO9ciydhWt6OF7HlqupRRmB8Q/gECVdB9LMfToJbRg==\n+  version \"4.2.0\"\n+  resolved \"https://registry.yarnpkg.com/@npmcli/run-script/-/run-script-4.2.0.tgz#2c25758f80831ba138afe25225d456e89acedac3\"\n+  integrity sha512-e/QgLg7j2wSJp1/7JRl0GC8c7PMX+uYlA/1Tb+IDOLdSM4T7K1VQ9mm9IGU3WRtY5vEIObpqCLb3aCNCug18DA==\n   dependencies:\n     \"@npmcli/node-gyp\" \"^2.0.0\"\n     \"@npmcli/promise-spawn\" \"^3.0.0\"\n@@ -5600,9 +5600,9 @@ make-error@^1.1.1:\n   integrity sha512-s8UhlNe7vPKomQhC1qFelMokr/Sc3AgNbso3n74mVPA5LTZwkB9NlXf4XPamLxJE8h0gh73rM94xvwRT2CVInw==\n \n make-fetch-happen@^10.0.3:\n-  version \"10.2.1\"\n-  resolved \"https://registry.yarnpkg.com/make-fetch-happen/-/make-fetch-happen-10.2.1.tgz#f5e3835c5e9817b617f2770870d9492d28678164\"\n-  integrity sha512-NgOPbRiaQM10DYXvN3/hhGVI2M5MtITFryzBGxHM5p4wnFxsVCbxkrBrDsk+EZ5OB4jEOT7AjDxtdF+KVEFT7w==\n+  version \"10.2.0\"\n+  resolved \"https://registry.yarnpkg.com/make-fetch-happen/-/make-fetch-happen-10.2.0.tgz#0bde3914f2f82750b5d48c6d2294d2c74f985e5b\"\n+  integrity sha512-OnEfCLofQVJ5zgKwGk55GaqosqKjaR6khQlJY3dBAA+hM25Bc5CmX5rKUfVut+rYA3uidA7zb7AvcglU87rPRg==\n   dependencies:\n     agentkeepalive \"^4.2.1\"\n     cacache \"^16.1.0\"\n\n\n###\n\n", "completion": "build(docs-infra): update all angular packages to use `^` instead of `~` (#<issue-num>)"}
{"prompt": " file path A: renovate.json | file path B: renovate.json\n\n@@ -63,7 +63,7 @@\n \n     {\n       \"matchPackagePrefixes\": [\"@angular/\", \"angular/\", \"@angular-devkit\", \"@schematics/\"],\n-      \"matchPaths\": [\"packages/**\"],\n+      \"matchPaths\": [\"packages/**\", \"aio/tools/examples/shared/**\"],\n       \"followTag\": null\n     },\n \n\n\n###\n\n", "completion": "ci: update renovate config to not update examples (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/src/ngtsc/typecheck/api/checker.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/api/checker.ts\n\n@@ -151,6 +151,12 @@ export interface TemplateTypeChecker {\n    */\n   getPrimaryAngularDecorator(target: ts.ClassDeclaration): ts.Decorator|null;\n \n+  /**\n+   * Get the class of the NgModule that owns this Angular trait. If the result is `null`, that\n+   * probably means the provided component is standalone.\n+   */\n+  getOwningNgModule(component: ts.ClassDeclaration): ts.ClassDeclaration|null;\n+\n   /**\n    * Retrieve any potential DOM bindings for the given element.\n    *\n@@ -194,8 +200,8 @@ export interface TemplateTypeChecker {\n  */\n export enum OptimizeFor {\n   /**\n-   * Indicates that a consumer of a `TemplateTypeChecker` is only interested in results for a given\n-   * file, and wants them as fast as possible.\n+   * Indicates that a consumer of a `TemplateTypeChecker` is only interested in results for a\n+   * given file, and wants them as fast as possible.\n    *\n    * Calling `TemplateTypeChecker` methods successively for multiple files while specifying\n    * `OptimizeFor.SingleFile` can result in significant unnecessary overhead overall.\n@@ -203,8 +209,8 @@ export enum OptimizeFor {\n   SingleFile,\n \n   /**\n-   * Indicates that a consumer of a `TemplateTypeChecker` intends to query for results pertaining to\n-   * the entire user program, and so the type-checker should internally optimize for this case.\n+   * Indicates that a consumer of a `TemplateTypeChecker` intends to query for results pertaining\n+   * to the entire user program, and so the type-checker should internally optimize for this case.\n    *\n    * Initial calls to retrieve type-checking information may take longer, but repeated calls to\n    * gather information for the whole user program will be significantly faster with this mode of\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/src/checker.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/src/checker.ts\n\n@@ -615,9 +615,6 @@ export class TemplateTypeCheckerImpl implements TemplateTypeChecker {\n   }\n \n   getPrimaryAngularDecorator(target: ts.ClassDeclaration): ts.Decorator|null {\n-    // TODO(dylhunn): It seems like we need to call this to make sure that\n-    // `typeCheckAdapter.typeCheck()` is called, which in `ngtsc/typecheck/testing/index.ts:setup`\n-    // actually populates the `metadataRegistry`, which is needed for the `metadataReader` to work.\n     this.ensureAllShimsForOneFile(target.getSourceFile());\n \n     if (!isNamedClassDeclaration(target)) {\n@@ -642,6 +639,25 @@ export class TemplateTypeCheckerImpl implements TemplateTypeChecker {\n     return null;\n   }\n \n+  getOwningNgModule(component: ts.ClassDeclaration): ts.ClassDeclaration|null {\n+    if (!isNamedClassDeclaration(component)) {\n+      return null;\n+    }\n+\n+    const dirMeta = this.metaReader.getDirectiveMetadata(new Reference(component));\n+    if (dirMeta !== null && dirMeta.isStandalone) {\n+      return null;\n+    }\n+\n+    const scope = this.componentScopeReader.getScopeForComponent(component);\n+    if (scope === null || scope.kind !== ComponentScopeKind.NgModule ||\n+        !isNamedClassDeclaration(scope.ngModule)) {\n+      return null;\n+    }\n+\n+    return scope.ngModule;\n+  }\n+\n   private getScopeData(component: ts.ClassDeclaration): ScopeData|null {\n     if (this.scopeCache.has(component)) {\n       return this.scopeCache.get(component)!;\n\n---\n file path A: packages/compiler-cli/src/ngtsc/typecheck/src/template_symbol_builder.ts | file path B: packages/compiler-cli/src/ngtsc/typecheck/src/template_symbol_builder.ts\n\n@@ -10,6 +10,7 @@ import {AST, ASTWithSource, BindingPipe, Call, ParseSourceSpan, PropertyRead, Pr\n import ts from 'typescript';\n \n import {AbsoluteFsPath} from '../../file_system';\n+import {Reference} from '../../imports';\n import {ClassDeclaration} from '../../reflection';\n import {ComponentScopeKind, ComponentScopeReader} from '../../scope';\n import {isAssignment, isSymbolWithValueDeclaration} from '../../util/src/typescript';\n\n---\n file path A: packages/compiler-cli/test/ngtsc/ls_typecheck_helpers_spec.ts | file path B: packages/compiler-cli/test/ngtsc/ls_typecheck_helpers_spec.ts\n\n@@ -30,19 +30,18 @@ runInEachFileSystem(() => {\n       env.tsconfig({strictTemplates: true, _enableTemplateTypeChecker: true});\n     });\n \n-\n     describe('supports `getPrimaryAngularDecorator()` ', () => {\n       it('for components', () => {\n         env.write('test.ts', `\n-\t\timport {Component} from '@angular/core';\n-\n-\t\t@Component({\n-\t\t\tstandalone: true,\n-\t\t\tselector: 'test-cmp',\n-\t\t\ttemplate: '<div></div>',\n-\t\t})\n-\t\texport class TestCmp {}\n-\t\t`);\n+\t\t import {Component} from '@angular/core';\n+ \n+\t\t @Component({\n+\t\t\t standalone: true,\n+\t\t\t selector: 'test-cmp',\n+\t\t\t template: '<div></div>',\n+\t\t })\n+\t\t export class TestCmp {}\n+\t\t `);\n         const {program, checker} = env.driveTemplateTypeChecker();\n         const sf = program.getSourceFile(_('/test.ts'));\n         expect(sf).not.toBeNull();\n@@ -52,15 +51,15 @@ runInEachFileSystem(() => {\n \n       it('for pipes', () => {\n         env.write('test.ts', `\n-\t\timport {Pipe, PipeTransform} from '@angular/core';\n-\n-\t\t@Pipe({name: 'expPipe'})\n-\t\texport class ExpPipe implements PipeTransform {\n-\t\t\ttransform(value: number, exponent = 1): number {\n-\t\t\t\treturn Math.pow(value, exponent);\n-\t\t\t}\n-\t\t}\n-\t\t`);\n+\t\t import {Pipe, PipeTransform} from '@angular/core';\n+ \n+\t\t @Pipe({name: 'expPipe'})\n+\t\t export class ExpPipe implements PipeTransform {\n+\t\t\t transform(value: number, exponent = 1): number {\n+\t\t\t\t return Math.pow(value, exponent);\n+\t\t\t }\n+\t\t }\n+\t\t `);\n         const {program, checker} = env.driveTemplateTypeChecker();\n         const sf = program.getSourceFile(_('/test.ts'));\n         expect(sf).not.toBeNull();\n@@ -70,16 +69,16 @@ runInEachFileSystem(() => {\n \n       it('for NgModules', () => {\n         env.write('test.ts', `\n-\t\t\timport {NgModule} from '@angular/core';\n-\n-\t\t\t@NgModule({\n-\t\t\t\tdeclarations: [],\n-\t\t\t\timports: [],\n-\t\t\t\tproviders: [],\n-\t\t\t\tbootstrap: []\n-\t\t\t})\n-\t\t\texport class AppModule {}\n-\t\t  `);\n+\t\t\t import {NgModule} from '@angular/core';\n+ \n+\t\t\t @NgModule({\n+\t\t\t\t declarations: [],\n+\t\t\t\t imports: [],\n+\t\t\t\t providers: [],\n+\t\t\t\t bootstrap: []\n+\t\t\t })\n+\t\t\t export class AppModule {}\n+\t\t   `);\n         const {program, checker} = env.driveTemplateTypeChecker();\n         const sf = program.getSourceFile(_('/test.ts'));\n         expect(sf).not.toBeNull();\n@@ -87,5 +86,89 @@ runInEachFileSystem(() => {\n         expect(decorator?.getText()).toContain(`declarations: []`);\n       });\n     });\n+\n+    describe('supports `getOwningNgModule()` ', () => {\n+      it('for components', () => {\n+        env.write('test.ts', `\n+\t\t\t  import {Component, NgModule} from '@angular/core';\n+  \n+\t\t\t  @NgModule({\n+\t\t\t\t  declarations: [AppCmp],\n+\t\t\t\t  imports: [],\n+\t\t\t\t  providers: [],\n+\t\t\t\t  bootstrap: [AppCmp]\n+\t\t\t  })\n+\t\t\t  export class AppModule {}\n+\t\n+\t\t\t  @Component({\n+\t\t\t\t  selector: 'app-cmp',\n+\t\t\t\t  template: '<div></div>',\n+\t\t\t  })\n+\t\t\t  export class AppCmp {}\n+\t\t\t`);\n+        const {program, checker} = env.driveTemplateTypeChecker();\n+        const sf = program.getSourceFile(_('/test.ts'));\n+        expect(sf).not.toBeNull();\n+        const ngModuleKnownClass = getClass(sf!, 'AppModule');\n+        expect(ngModuleKnownClass).not.toBeNull();\n+        const ngModuleRetrievedClass = checker.getOwningNgModule(getClass(sf!, 'AppCmp'));\n+        expect(ngModuleRetrievedClass).toEqual(ngModuleKnownClass);\n+      });\n+\n+      it('for standalone components (which should be null)', () => {\n+        env.write('test.ts', `\n+\t\t\t  import {Component, NgModule} from '@angular/core';\n+  \n+\t\t\t  @NgModule({\n+\t\t\t\t  declarations: [AppCmp],\n+\t\t\t\t  imports: [],\n+\t\t\t\t  providers: [],\n+\t\t\t\t  bootstrap: [AppCmp]\n+\t\t\t  })\n+\t\t\t  export class AppModule {}\n+\t\n+\t\t\t  @Component({\n+\t\t\t\t  selector: 'app-cmp',\n+\t\t\t\t  template: '<div></div>',\n+\t\t\t\t  standalone: true,\n+\t\t\t  })\n+\t\t\t  export class AppCmp {}\n+\t\t\t`);\n+        const {program, checker} = env.driveTemplateTypeChecker();\n+        const sf = program.getSourceFile(_('/test.ts'));\n+        expect(sf).not.toBeNull();\n+        const ngModuleKnownClass = getClass(sf!, 'AppModule');\n+        expect(ngModuleKnownClass).not.toBeNull();\n+        const ngModuleRetrievedClass = checker.getOwningNgModule(getClass(sf!, 'AppCmp'));\n+        expect(ngModuleRetrievedClass).toBe(null);\n+      });\n+\n+      it('for pipes', () => {\n+        env.write('test.ts', `\n+\t\t\t  import {Component, NgModule, Pipe, PipeTransform} from '@angular/core';\n+  \n+\t\t\t  @NgModule({\n+\t\t\t\t  declarations: [ExpPipe],\n+\t\t\t\t  imports: [],\n+\t\t\t\t  providers: [],\n+\t\t\t  })\n+\t\t\t  export class PipeModule {}\n+\t\n+\t\t\t  @Pipe({name: 'expPipe'})\n+\t\t\t  export class ExpPipe implements PipeTransform {\n+\t\t\t\t  transform(value: number, exponent = 1): number {\n+\t\t\t\t\t  return Math.pow(value, exponent);\n+\t\t\t\t  }\n+\t\t\t  }\n+\t\t\t`);\n+        const {program, checker} = env.driveTemplateTypeChecker();\n+        const sf = program.getSourceFile(_('/test.ts'));\n+        expect(sf).not.toBeNull();\n+        const ngModuleKnownClass = getClass(sf!, 'PipeModule');\n+        expect(ngModuleKnownClass).not.toBeNull();\n+        const ngModuleRetrievedClass = checker.getOwningNgModule(getClass(sf!, 'ExpPipe'));\n+        expect(ngModuleRetrievedClass).toEqual(ngModuleKnownClass);\n+      });\n+    });\n   });\n });\n\n\n###\n\n", "completion": "refactor(compiler): Add a new helper method `getOwningNgModule`. (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/dev-infra.yml | file path B: .github/workflows/dev-infra.yml\n\n@@ -13,13 +13,13 @@ jobs:\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3.0.2\n-      - uses: angular/dev-infra/github-actions/commit-message-based-labels@d7a9d717d17a1093fdcc9f6f8d644ab0847283e3\n+      - uses: angular/dev-infra/github-actions/commit-message-based-labels@5ffe2357f61a57d16f44a3209cd880c211c575b5\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n   post_approval_changes:\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3.0.2\n-      - uses: angular/dev-infra/github-actions/post-approval-changes@d7a9d717d17a1093fdcc9f6f8d644ab0847283e3\n+      - uses: angular/dev-infra/github-actions/post-approval-changes@5ffe2357f61a57d16f44a3209cd880c211c575b5\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n---\n file path A: .github/workflows/feature-requests.yml | file path B: .github/workflows/feature-requests.yml\n\n@@ -14,6 +14,6 @@ jobs:\n     if: github.repository == 'angular/angular'\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: angular/dev-infra/github-actions/feature-request@d7a9d717d17a1093fdcc9f6f8d644ab0847283e3\n+      - uses: angular/dev-infra/github-actions/feature-request@5ffe2357f61a57d16f44a3209cd880c211c575b5\n         with:\n           angular-robot-key: ${{ secrets.ANGULAR_ROBOT_PRIVATE_KEY }}\n\n---\n file path A: .github/workflows/lock-closed.yml | file path B: .github/workflows/lock-closed.yml\n\n@@ -14,6 +14,6 @@ jobs:\n     if: github.repository == 'angular/angular'\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: angular/dev-infra/github-actions/lock-closed@d7a9d717d17a1093fdcc9f6f8d644ab0847283e3\n+      - uses: angular/dev-infra/github-actions/lock-closed@5ffe2357f61a57d16f44a3209cd880c211c575b5\n         with:\n           lock-bot-key: ${{ secrets.LOCK_BOT_PRIVATE_KEY }}\n\n---\n file path A: package.json | file path B: package.json\n\n@@ -50,12 +50,12 @@\n     \"@angular-devkit/core\": \"14.2.0-rc.0\",\n     \"@angular-devkit/schematics\": \"14.2.0-rc.0\",\n     \"@angular/animations-12\": \"npm:@angular/animations@12.2.13\",\n-    \"@angular/cdk\": \"14.2.0-next.2\",\n+    \"@angular/cdk\": \"14.2.0-rc.0\",\n     \"@angular/cli\": \"14.2.0-rc.0\",\n     \"@angular/common-12\": \"npm:@angular/common@12.2.13\",\n     \"@angular/core-12\": \"npm:@angular/core@12.2.13\",\n     \"@angular/forms-12\": \"npm:@angular/forms@12.2.13\",\n-    \"@angular/material\": \"14.2.0-next.2\",\n+    \"@angular/material\": \"14.2.0-rc.0\",\n     \"@angular/platform-browser-12\": \"npm:@angular/platform-browser@12.2.13\",\n     \"@angular/platform-browser-dynamic-12\": \"npm:@angular/platform-browser-dynamic@12.2.13\",\n     \"@angular/platform-server-12\": \"npm:@angular/platform-server@12.2.13\",\n@@ -179,8 +179,8 @@\n   },\n   \"// 2\": \"devDependencies are not used under Bazel. Many can be removed after test.sh is deleted.\",\n   \"devDependencies\": {\n-    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#73f2eec2956d938abae052910b5ef89a8868a3e1\",\n-    \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#ef7fd4402c247be1f0d58815f6de4e6bf807182e\",\n+    \"@angular/build-tooling\": \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#2c68d0f9752df9bdbb185b89630ea085a2e62484\",\n+    \"@angular/ng-dev\": \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#1a7be8a4a108ae0eee5c496072ce865043146d4d\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n     \"@bazel/buildifier\": \"^5.0.0\",\n     \"@bazel/ibazel\": \"^0.16.0\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -157,9 +157,10 @@\n     \"@angular/core\" \"^13.0.0 || ^14.0.0-0\"\n     reflect-metadata \"^0.1.13\"\n \n-\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#73f2eec2956d938abae052910b5ef89a8868a3e1\":\n-  version \"0.0.0-5d0da987d6fd7637ee65542d99138a8bda1d2542\"\n-  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#73f2eec2956d938abae052910b5ef89a8868a3e1\"\n+\"@angular/build-tooling@https://github.com/angular/dev-infra-private-build-tooling-builds.git#2c68d0f9752df9bdbb185b89630ea085a2e62484\":\n+  version \"0.0.0-5ffe2357f61a57d16f44a3209cd880c211c575b5\"\n+  uid \"2c68d0f9752df9bdbb185b89630ea085a2e62484\"\n+  resolved \"https://github.com/angular/dev-infra-private-build-tooling-builds.git#2c68d0f9752df9bdbb185b89630ea085a2e62484\"\n   dependencies:\n     \"@angular-devkit/build-angular\" \"14.2.0-rc.0\"\n     \"@angular/benchpress\" \"0.3.0\"\n@@ -171,7 +172,7 @@\n     \"@bazel/runfiles\" \"5.5.3\"\n     \"@bazel/terser\" \"5.5.3\"\n     \"@bazel/typescript\" \"5.5.3\"\n-    \"@microsoft/api-extractor\" \"7.29.2\"\n+    \"@microsoft/api-extractor\" \"7.29.3\"\n     \"@types/browser-sync\" \"^2.26.3\"\n     \"@types/node\" \"16.10.9\"\n     \"@types/selenium-webdriver\" \"^4.0.18\"\n@@ -194,10 +195,10 @@\n     uuid \"^8.3.2\"\n     yargs \"^17.0.0\"\n \n-\"@angular/cdk@14.2.0-next.2\":\n-  version \"14.2.0-next.2\"\n-  resolved \"https://registry.yarnpkg.com/@angular/cdk/-/cdk-14.2.0-next.2.tgz#30ed3305c6984dadfe5a7305bcd956b427c4a226\"\n-  integrity sha512-jmdYDJZuFFcBX5HRdfZRxJyDidFGyjnQS90/bJt7Etwf6/8czINO6gtxc/sIyV0R6UOI+rz6boB5iRuCUE1KXQ==\n+\"@angular/cdk@14.2.0-rc.0\":\n+  version \"14.2.0-rc.0\"\n+  resolved \"https://registry.yarnpkg.com/@angular/cdk/-/cdk-14.2.0-rc.0.tgz#bc70d173ff4d26d2728e9bde9e9c3fbdcad66939\"\n+  integrity sha512-E3APqCslpvmKyo+aINI5oDxk04EJcdixOCH/LFHk4SmFCIRJroa2HIl49h5y+yFJHeKY6QYXtRjLIyALQWSwAw==\n   dependencies:\n     tslib \"^2.3.0\"\n   optionalDependencies:\n@@ -257,16 +258,17 @@\n   dependencies:\n     tslib \"^2.2.0\"\n \n-\"@angular/material@14.2.0-next.2\":\n-  version \"14.2.0-next.2\"\n-  resolved \"https://registry.yarnpkg.com/@angular/material/-/material-14.2.0-next.2.tgz#1a332074f3420f8e71dee24d906f56a09a23dec6\"\n-  integrity sha512-GiqIWmqo8KjqGWBzrNLPl+dL4PQ72zw5UVHVQKTO9av0Qrinln3WKqb14Uc84BxWX4YPmkUWhC18XdYaiZ+/ug==\n+\"@angular/material@14.2.0-rc.0\":\n+  version \"14.2.0-rc.0\"\n+  resolved \"https://registry.yarnpkg.com/@angular/material/-/material-14.2.0-rc.0.tgz#3e38cfc2663ec3fcbe013a6ddfb3bd329a510d87\"\n+  integrity sha512-j6GCAmUVSyoj88rGMJq0VFY4EMBpSL61zml+YNDITQmIxmEMyxDyQQNlFAhWuNaYIccAUxlYvQdEhZoi8N/fXg==\n   dependencies:\n     tslib \"^2.3.0\"\n \n-\"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#ef7fd4402c247be1f0d58815f6de4e6bf807182e\":\n-  version \"0.0.0-5d0da987d6fd7637ee65542d99138a8bda1d2542\"\n-  resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#ef7fd4402c247be1f0d58815f6de4e6bf807182e\"\n+\"@angular/ng-dev@https://github.com/angular/dev-infra-private-ng-dev-builds.git#1a7be8a4a108ae0eee5c496072ce865043146d4d\":\n+  version \"0.0.0-5ffe2357f61a57d16f44a3209cd880c211c575b5\"\n+  uid \"1a7be8a4a108ae0eee5c496072ce865043146d4d\"\n+  resolved \"https://github.com/angular/dev-infra-private-ng-dev-builds.git#1a7be8a4a108ae0eee5c496072ce865043146d4d\"\n   dependencies:\n     \"@yarnpkg/lockfile\" \"^1.1.0\"\n     typescript \"~4.7.3\"\n@@ -1965,24 +1967,24 @@\n     \"@microsoft/tsdoc-config\" \"~0.16.1\"\n     \"@rushstack/node-core-library\" \"3.49.0\"\n \n-\"@microsoft/api-extractor-model@7.23.0\":\n-  version \"7.23.0\"\n-  resolved \"https://registry.yarnpkg.com/@microsoft/api-extractor-model/-/api-extractor-model-7.23.0.tgz#266de12607fffe72259bfdf94e35331a18fdb223\"\n-  integrity sha512-h+2aVyf8IYidPZp+N+yIc/LY/aBwRZ1Vxlsx7rU31807bba5ScJ94bj7OjsPMje0vRYALf+yjZToYT0HdP6omA==\n+\"@microsoft/api-extractor-model@7.23.1\":\n+  version \"7.23.1\"\n+  resolved \"https://registry.yarnpkg.com/@microsoft/api-extractor-model/-/api-extractor-model-7.23.1.tgz#d93704882241e7720094d41c7005b07eb593c073\"\n+  integrity sha512-axlZ33H2LfYX7goAaWpzABWZl3JtX/EUkfVBsI4SuMn3AZYBJsP5MVpMCq7jt0PCefWGwwO+Rv+lCmmJIjFhlQ==\n   dependencies:\n     \"@microsoft/tsdoc\" \"0.14.1\"\n     \"@microsoft/tsdoc-config\" \"~0.16.1\"\n-    \"@rushstack/node-core-library\" \"3.50.1\"\n+    \"@rushstack/node-core-library\" \"3.50.2\"\n \n-\"@microsoft/api-extractor@7.29.2\":\n-  version \"7.29.2\"\n-  resolved \"https://registry.yarnpkg.com/@microsoft/api-extractor/-/api-extractor-7.29.2.tgz#a7174297ac9e1acc3a08f87ccc2b8d05cfdebe02\"\n-  integrity sha512-MwT/Xi1DperfrBO+SU3f/xKdyR6bMvk59/WN6w7g1rHmDBMegan3Ya6npMo+abJAgQOtp6uExY/elHXcYE/Ofw==\n+\"@microsoft/api-extractor@7.29.3\":\n+  version \"7.29.3\"\n+  resolved \"https://registry.yarnpkg.com/@microsoft/api-extractor/-/api-extractor-7.29.3.tgz#f91ca61833c170c6c47a0fc064fa010460a11457\"\n+  integrity sha512-PHq+Oo8yiXhwi11VQ1Nz36s+aZwgFqjtkd41udWHtSpyMv2slJ74m1cHdpWbs2ovGUCfldayzdpGwnexZLd2bA==\n   dependencies:\n-    \"@microsoft/api-extractor-model\" \"7.23.0\"\n+    \"@microsoft/api-extractor-model\" \"7.23.1\"\n     \"@microsoft/tsdoc\" \"0.14.1\"\n     \"@microsoft/tsdoc-config\" \"~0.16.1\"\n-    \"@rushstack/node-core-library\" \"3.50.1\"\n+    \"@rushstack/node-core-library\" \"3.50.2\"\n     \"@rushstack/rig-package\" \"0.3.14\"\n     \"@rushstack/ts-command-line\" \"4.12.2\"\n     colors \"~1.2.1\"\n@@ -2289,10 +2291,10 @@\n     timsort \"~0.3.0\"\n     z-schema \"~5.0.2\"\n \n-\"@rushstack/node-core-library@3.50.1\":\n-  version \"3.50.1\"\n-  resolved \"https://registry.yarnpkg.com/@rushstack/node-core-library/-/node-core-library-3.50.1.tgz#d4aa4602460f29bbf0662052969b65129384da23\"\n-  integrity sha512-9d2xE7E9yQEBS6brTptdP8cslt6iL5+UnkY2lRxQQ4Q/jlXtsrWCCJCxwr56W/eJEe9YT/yHR4mMn5QY64Ps2w==\n+\"@rushstack/node-core-library@3.50.2\":\n+  version \"3.50.2\"\n+  resolved \"https://registry.yarnpkg.com/@rushstack/node-core-library/-/node-core-library-3.50.2.tgz#43df3f8422898a448114fcb9c7d4e967625da585\"\n+  integrity sha512-+zpZBcaX5s+wA0avF0Lk3sd5jbGRo5SmsEJpElJbqQd3KGFvc/hcyeNSMqV5+esJ1JuTfnE1QyRt8nvxFNTaQg==\n   dependencies:\n     \"@types/node\" \"12.20.24\"\n     colors \"~1.2.1\"\n\n\n###\n\n", "completion": "build: update cross-repo angular dependencies (#<issue-num>)"}
{"prompt": " file path A: packages/animations/browser/src/dsl/animation_ast_builder.ts | file path B: packages/animations/browser/src/dsl/animation_ast_builder.ts\n\n@@ -473,7 +473,7 @@ export class AnimationAstBuilderVisitor implements AnimationDslVisitor {\n     }\n     const timings = metadata.timings === 'full' ?\n         {duration: 0, delay: 0, easing: 'full'} :\n-        resolveTiming(metadata.timings, context.errors, true);\n+        constructTimingAst(metadata.timings, context.errors);\n \n     return {\n       type: AnimationMetadataType.Stagger,\n\n---\n file path A: packages/animations/browser/src/dsl/animation_timeline_builder.ts | file path B: packages/animations/browser/src/dsl/animation_timeline_builder.ts\n\n@@ -278,12 +278,14 @@ export class AnimationTimelineBuilderVisitor implements AstVisitor {\n     context.previousNode = ast;\n   }\n \n-  private _visitTiming(ast: TimingAst, context: AnimationTimelineContext): AnimateTimings {\n+  private _visitTiming(\n+      ast: TimingAst, context: AnimationTimelineContext,\n+      allowNegativeValues = false): AnimateTimings {\n     if ((ast as DynamicTimingAst).dynamic) {\n       const strValue = (ast as DynamicTimingAst).strValue;\n       const timingValue =\n           context.params ? interpolateParams(strValue, context.params, context.errors) : strValue;\n-      return resolveTiming(timingValue, context.errors);\n+      return resolveTiming(timingValue, context.errors, allowNegativeValues);\n     } else {\n       return {duration: ast.duration, delay: ast.delay, easing: ast.easing};\n     }\n@@ -413,7 +415,8 @@ export class AnimationTimelineBuilderVisitor implements AstVisitor {\n   visitStagger(ast: StaggerAst, context: AnimationTimelineContext) {\n     const parentContext = context.parentContext!;\n     const tl = context.currentTimeline;\n-    const timings = ast.timings;\n+    const timings = this._visitTiming(ast.timings, context, true);\n+\n     const duration = Math.abs(timings.duration);\n     const maxTime = duration * (context.currentQueryTotal - 1);\n     let delay = duration * context.currentQueryIndex;\n\n---\n file path A: packages/core/test/animation/animation_query_integration_spec.ts | file path B: packages/core/test/animation/animation_query_integration_spec.ts\n\n@@ -742,6 +742,105 @@ describe('animation query tests', function() {\n       expect(p5.delay).toEqual(6000);\n     });\n \n+    it(`should handle params used in the stagger's timing argument`, () => {\n+      @Component({\n+          selector: 'ani-cmp',\n+          template: `\n+          <div [@myAnimation]=\"exp\">\n+            <div *ngFor=\"let item of items\" class=\"item\">\n+              {{ item }}\n+            </div>\n+          </div>\n+        `,\n+          animations: [\n+            trigger('myAnimation', [\n+              transition('* => go', [\n+                query('.item', [\n+                  stagger('{{staggerDelay}}ms',[\n+                    style({opacity: 0}), animate(1000, style({opacity: .5})),\n+                    animate(500, style({opacity: 1}))\n+                  ])\n+                ])\n+              ], {params: { staggerDelay: '1111' }})\n+            ])\n+          ]\n+        })\n+        class Cmp {\n+        public exp: any;\n+        public items: any[] = [0, 1, 2, 3, 4];\n+      }\n+\n+      TestBed.configureTestingModule({declarations: [Cmp]});\n+\n+      const engine = TestBed.inject(\u0275AnimationEngine);\n+      const fixture = TestBed.createComponent(Cmp);\n+      const cmp = fixture.componentInstance;\n+\n+      cmp.exp = 'go';\n+      fixture.detectChanges();\n+      engine.flush();\n+\n+      const players = getLog();\n+      expect(players.length).toEqual(5);\n+\n+      const [p1, p2, p3, p4, p5] = players;\n+      expect(p1.delay).toEqual(0);\n+      expect(p2.delay).toEqual(1111);\n+      expect(p3.delay).toEqual(2222);\n+      expect(p4.delay).toEqual(3333);\n+      expect(p5.delay).toEqual(4444);\n+    });\n+\n+    it(`should handle params used in the stagger's timing argument producing a negative value`,\n+       () => {\n+         @Component({\n+          selector: 'ani-cmp',\n+          template: `\n+          <div [@myAnimation]=\"exp\">\n+            <div *ngFor=\"let item of items\" class=\"item\">\n+              {{ item }}\n+            </div>\n+          </div>\n+        `,\n+          animations: [\n+            trigger('myAnimation', [\n+              transition('* => go', [\n+                query('.item', [\n+                  stagger('{{staggerDelay}}ms',[\n+                    style({opacity: 0}), animate(1000, style({opacity: .5})),\n+                    animate(500, style({opacity: 1}))\n+                  ])\n+                ])\n+              ], {params: { staggerDelay: -1111 }})\n+            ])\n+          ]\n+        })\n+        class Cmp {\n+           public exp: any;\n+           public items: any[] = [0, 1, 2, 3, 4];\n+         }\n+\n+         TestBed.configureTestingModule({declarations: [Cmp]});\n+\n+         const engine = TestBed.inject(\u0275AnimationEngine);\n+         const fixture = TestBed.createComponent(Cmp);\n+         const cmp = fixture.componentInstance;\n+\n+         cmp.exp = 'go';\n+         fixture.detectChanges();\n+         engine.flush();\n+\n+         const players = getLog();\n+         expect(players.length).toEqual(5);\n+\n+         const [p1, p2, p3, p4, p5] = players;\n+         expect(p5.delay).toEqual(0);\n+         expect(p4.delay).toEqual(1111);\n+         expect(p3.delay).toEqual(2222);\n+         expect(p2.delay).toEqual(3333);\n+         expect(p1.delay).toEqual(4444);\n+       });\n+\n     it('should persist inner sub trigger styles once their animation is complete', () => {\n       @Component({\n         selector: 'ani-cmp',\n\n---\n file path A: packages/core/test/bundling/animations/bundle.golden_symbols.json | file path B: packages/core/test/bundling/animations/bundle.golden_symbols.json\n\n@@ -647,6 +647,9 @@\n   {\n     \"name\": \"connectableObservableDescriptor\"\n   },\n+  {\n+    \"name\": \"constructTimingAst\"\n+  },\n   {\n     \"name\": \"containsElement\"\n   },\n\n\n###\n\n", "completion": "fix(animations): fix stagger timing not handling params (#<issue-num>)"}
{"prompt": " file path A: aio/src/app/app.component.html | file path B: aio/src/app/app.component.html\n\n@@ -32,7 +32,7 @@\n         <img *ngSwitchCase=\"true\" src=\"assets/images/logos/angular/logo-nav@2x.png\" width=\"150\" height=\"40\" title=\"Home\" alt=\"Home\">\n         <img *ngSwitchDefault src=\"assets/images/logos/angular/shield-large.svg\" width=\"37\" height=\"40\" title=\"Home\" alt=\"Home\">\n       </a>\n-      <aio-top-menu *ngIf=\"showTopMenu\" [nodes]=\"topMenuNodes\" [currentNode]=\"currentNodes?.TopBar\"></aio-top-menu>\n+      <aio-top-menu *ngIf=\"showTopMenu\" [nodes]=\"topMenuNodes\" [currentNode]=\"currentNodes.TopBar\"></aio-top-menu>\n       <aio-search-box class=\"search-container\" #searchBox (onSearch)=\"doSearch($event)\" (onFocus)=\"doSearch($event, true)\"></aio-search-box>\n       <aio-theme-toggle #themeToggle></aio-theme-toggle>\n       <div #externalIcons class=\"toolbar-external-icons-container\">\n@@ -60,8 +60,8 @@\n <mat-sidenav-container class=\"sidenav-container\" [class.no-animations]=\"disableAnimations\" [class.has-floating-toc]=\"hasFloatingToc\">\n \n   <mat-sidenav [ngClass]=\"{'collapsed': !dockSideNav}\" #sidenav class=\"sidenav\" [mode]=\"mode\" [opened]=\"isOpened\" (openedChange)=\"updateHostClasses()\">\n-    <aio-nav-menu *ngIf=\"!showTopMenu\" [nodes]=\"topMenuNarrowNodes\" [currentNode]=\"currentNodes?.TopBarNarrow\" [isWide]=\"dockSideNav\" navLabel=\"primary\"></aio-nav-menu>\n-    <aio-nav-menu [nodes]=\"sideNavNodes\" [currentNode]=\"currentNodes?.SideNav\" [isWide]=\"dockSideNav\" navLabel=\"guides and docs\"></aio-nav-menu>\n+    <aio-nav-menu *ngIf=\"!showTopMenu\" [nodes]=\"topMenuNarrowNodes\" [currentNode]=\"currentNodes.TopBarNarrow\" [isWide]=\"dockSideNav\" navLabel=\"primary\"></aio-nav-menu>\n+    <aio-nav-menu [nodes]=\"sideNavNodes\" [currentNode]=\"currentNodes.SideNav\" [isWide]=\"dockSideNav\" navLabel=\"guides and docs\"></aio-nav-menu>\n \n     <div class=\"doc-version\">\n       <aio-nav-menu [nodes]=\"docVersions\" [isWide]=\"true\" [currentNode]=\"currentDocsVersionNode\" navLabel=\"docs versions\"></aio-nav-menu>\n\n---\n file path A: aio/src/app/app.component.ts | file path B: aio/src/app/app.component.ts\n\n@@ -90,7 +90,7 @@ export class AppComponent implements OnInit {\n \n   currentDocsVersionNode?: NavigationNode;\n \n-  versionInfo: VersionInfo;\n+  versionInfo: VersionInfo | undefined;\n \n   get isOpened() { return this.dockSideNav && this.isSideNavDoc; }\n   get mode() { return this.isOpened ? 'side' : 'over'; }\n\n---\n file path A: aio/src/app/layout/footer/footer.component.ts | file path B: aio/src/app/layout/footer/footer.component.ts\n\n@@ -8,5 +8,5 @@ import { NavigationNode, VersionInfo } from 'app/navigation/navigation.service';\n })\n export class FooterComponent {\n   @Input() nodes: NavigationNode[];\n-  @Input() versionInfo: VersionInfo;\n+  @Input() versionInfo: VersionInfo | undefined;\n }\n\n---\n file path A: aio/src/app/layout/mode-banner/mode-banner.component.ts | file path B: aio/src/app/layout/mode-banner/mode-banner.component.ts\n\n@@ -14,5 +14,5 @@ import { VersionInfo } from 'app/navigation/navigation.service';\n })\n export class ModeBannerComponent {\n   @Input() mode: string;\n-  @Input() version: VersionInfo;\n+  @Input() version: VersionInfo | undefined;\n }\n\n---\n file path A: aio/src/app/shared/select/select.component.html | file path B: aio/src/app/shared/select/select.component.html\n\n@@ -7,7 +7,7 @@\n     (keydown)=\"handleKeydown($event)\"\n     [attr.aria-expanded]=\"showOptions\"\n     [attr.aria-activedescendant]=\"currentOptionIdx > -1 && showOptions ? listBoxId + '-option-' + currentOptionIdx : null\"\n-    [attr.aria-label]=\"label +  (selected?.title ?? '')\"\n+    [attr.aria-label]=\"label + (selected?.title ?? '')\"\n     [class.disabled]=\"disabled\"\n     tabindex=\"0\"\n   >\n\n---\n file path A: aio/src/app/shared/select/select.component.spec.ts | file path B: aio/src/app/shared/select/select.component.spec.ts\n\n@@ -230,9 +230,9 @@ class HostComponent {\n   onChange = jasmine.createSpy('onChange');\n   options: Option[];\n   selected: Option;\n-  label: string;\n-  showSymbol: boolean;\n-  disabled: boolean;\n+  label = '';\n+  showSymbol = false;\n+  disabled = false;\n }\n \n function getButton(): HTMLButtonElement {\n\n---\n file path A: aio/src/app/shared/select/select.component.ts | file path B: aio/src/app/shared/select/select.component.ts\n\n@@ -12,7 +12,7 @@ export interface Option {\n export class SelectComponent implements OnInit {\n   static instancesCounter = 0;\n \n-  @Input() selected: Option;\n+  @Input() selected: Option | undefined;\n \n   @Input() options: Option[];\n \n@@ -23,7 +23,7 @@ export class SelectComponent implements OnInit {\n \n   @Input() showSymbol = false;\n \n-  @Input() label!: string;\n+  @Input() label = '';\n \n   @Input() disabled: boolean;\n \n@@ -81,7 +81,7 @@ export class SelectComponent implements OnInit {\n     const runOrOpenOptions = (fn: () => void): void => {\n       if(!this.showOptions) {\n         this.showOptions = true;\n-        const indexOfSelected =  (this.options ?? []).indexOf(this.selected);\n+        const indexOfSelected = (!this.options || !this.selected) ? -1 : this.options.indexOf(this.selected);\n         this.currentOptionIdx = indexOfSelected > 0 ? indexOfSelected : 0;\n       } else {\n         fn();\n\n\n###\n\n", "completion": "refactor(docs-infra): fix TypeScript warnings due to property types (#<issue-num>)"}
{"prompt": " file path A: aio/tools/transforms/angular-api-package/processors/mergeOverriddenImplementation.js | file path B: aio/tools/transforms/angular-api-package/processors/mergeOverriddenImplementation.js\n\n@@ -61,8 +61,10 @@\n           doc.constructorDoc = ctorDoc.members[0];\n \n           // Mark the constructor doc internal.\n-          if (!ctorDoc.internal) {\n-            log.warn(`Constructor doc ${ctorDoc.id} was not marked '@internal'; adding this annotation.`);\n+          if (!ctorDoc.internal && !ctorDoc.privateExport) {\n+            log.warn(\n+                `Constructor doc ${ctorDoc.id} was not marked as internal (either via an ` +\n+                '\\'@internal\\' annotation or a \\'\u0275\\' prefix). Marking it as internal.');\n             ctorDoc.internal = true;\n           }\n \n\n\n###\n\n", "completion": "fix(docs-infra): prevent unnecessary warning in `mergeOverridenImplementation` Dgeni processor (#<issue-num>)"}
{"prompt": " file path A: aio/tools/transforms/angular-api-package/processors/mergeOverriddenImplementation.js | file path B: aio/tools/transforms/angular-api-package/processors/mergeOverriddenImplementation.js\n\n@@ -4,9 +4,9 @@\n  * - A symbol could have multiple constructors\n  * - It is possible to disambiguate multiple different signatures from a single polymorphic constructor\n  * - The return type of the overridden constructor can differ (e.g. `Foo<T|null>` vs `Foo<T>`)\n- * \n+ *\n  * This looks like the following:\n- * \n+ *\n  * ```\n  * /**\n  * * @overriddenImplementation FooCtor\n@@ -14,21 +14,21 @@\n  * export interface Foo {\n  *   bar();\n  * }\n- * \n+ *\n  * type FooInterface = Foo;\n- * \n+ *\n  * export class FooImpl { ... }\n- * \n+ *\n  * export interface FooCtor {\n  *   new(): Foo;\n  * }\n- * \n+ *\n  * export const Foo: FooCtor =\n     (class Foo implements FooInterface { ... }\n  * ```\n- * \n+ *\n  * This processor will extend the docs for symbol `Foo` by copying all documented constructor overrides from `FooCtor`.\n- * \n+ *\n  * In order to use this processor, annotate the exported interface with `@overriddenImplementation`. Place the desired\n  * documentation on the interface and constructor signatures.\n  */\n@@ -42,7 +42,7 @@\n     ],\n     $process(docs) {\n       docs.forEach(doc => {\n-        if (doc.overriddenImplementation) {   \n+        if (doc.overriddenImplementation) {\n           // Convert the specified name into a doc.\n           const ctorDocArray = getDocFromAlias(doc.overriddenImplementation);\n             if (ctorDocArray.length === 0) {\n@@ -51,18 +51,18 @@\n             if (ctorDocArray.length >= 2) {\n               throw new Error(`@overriddenImplementation found multiple docs for ${doc.overriddenImplementation}. You may only have one documented symbol for each.`);\n             }\n-          \n+\n           const ctorDoc = ctorDocArray[0];\n \n           // Copy the constructor overrides from the constructor doc, if any are present.\n           if (!ctorDoc.members || ctorDoc.members.length === 0 || !ctorDoc.members[0].name.includes('new')) {\n-            throw new Error(`@overriddenImplementation requires that the provided constructor ${ctorDoc} have a member called \"new\", possibly with multiple overrides.`);\n+            throw new Error(`@overriddenImplementation requires that the provided constructor ${ctorDoc.id} have a member called \"new\", possibly with multiple overrides.`);\n           }\n           doc.constructorDoc = ctorDoc.members[0];\n \n           // Mark the constructor doc internal.\n           if (!ctorDoc.internal) {\n-            log.warn(`Constructor doc ${ctorDoc} was not marked '@internal'; adding this annotation.`);\n+            log.warn(`Constructor doc ${ctorDoc.id} was not marked '@internal'; adding this annotation.`);\n             ctorDoc.internal = true;\n           }\n \n\n\n###\n\n", "completion": "build(docs-infra): improve error message in `mergeOverridenImplementation` Dgeni processor (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -32,9 +32,9 @@ const VALID_WIDTH_DESCRIPTOR_SRCSET = /^((\\s*\\d+w\\s*(,|$)){1,})$/;\n \n /**\n  * RegExpr to determine whether a src in a srcset is using density descriptors.\n- * Should match something like: \"1x, 2x\".\n+ * Should match something like: \"1x, 2x\". Also supports decimals like \"1.5x\".\n  */\n-const VALID_DENSITY_DESCRIPTOR_SRCSET = /^((\\s*\\d(\\.\\d)?x\\s*(,|$)){1,})$/;\n+const VALID_DENSITY_DESCRIPTOR_SRCSET = /^((\\s*\\d(\\.\\d+)?x\\s*(,|$)){1,})$/;\n \n /**\n  * Srcset values with a density descriptor higher than this value will actively\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -966,7 +966,7 @@ describe('Image directive', () => {\n         setupTestingModule({imageLoader});\n \n         const template = `\n-           <img rawSrc=\"img.png\" rawSrcset=\"1x, 2.5x, 3x\" width=\"100\" height=\"50\">\n+           <img rawSrc=\"img.png\" rawSrcset=\"1.75x, 2.5x, 3x\" width=\"100\" height=\"50\">\n          `;\n         const fixture = createTestComponent(template);\n         fixture.detectChanges();\n@@ -976,7 +976,7 @@ describe('Image directive', () => {\n         expect(img.src).toBe(`${IMG_BASE_URL}/img.png`);\n         expect(img.srcset)\n             .toBe(\n-                `${IMG_BASE_URL}/img.png?w=100 1x, ` +\n+                `${IMG_BASE_URL}/img.png?w=175 1.75x, ` +\n                 `${IMG_BASE_URL}/img.png?w=250 2.5x, ` +\n                 `${IMG_BASE_URL}/img.png?w=300 3x`);\n       });\n\n\n###\n\n", "completion": "fix(common): support density descriptors with 2+ decimals (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts\n\n@@ -75,7 +75,7 @@ export function createImageLoader(\n     buildUrlFn: (path: string, config: ImageLoaderConfig) => string, exampleUrls?: string[]) {\n   return function provideImageLoader(\n       path: string, options: {ensurePreconnect?: boolean} = {ensurePreconnect: true}) {\n-    if (ngDevMode && !isValidPath(path)) {\n+    if (!isValidPath(path)) {\n       throwInvalidPathError(path, exampleUrls || []);\n     }\n \n@@ -84,7 +84,7 @@ export function createImageLoader(\n     path = normalizePath(path);\n \n     const loaderFn = (config: ImageLoaderConfig) => {\n-      if (ngDevMode && isAbsoluteUrl(config.src)) {\n+      if (isAbsoluteUrl(config.src)) {\n         // Image loader functions expect an image file name (e.g. `my-image.png`)\n         // or a relative path + a file name (e.g. `/a/b/c/my-image.png`) as an input,\n         // so the final absolute URL can be constructed.\n@@ -106,19 +106,22 @@ export function createImageLoader(\n }\n \n function throwInvalidPathError(path: unknown, exampleUrls: string[]): never {\n-  const exampleUrlsMsg = exampleUrls.join(' or ');\n   throw new RuntimeError(\n       RuntimeErrorCode.INVALID_LOADER_ARGUMENTS,\n-      `Image loader has detected an invalid path (\\`${path}\\`). ` +\n-          `To fix this, supply a path using one of the following formats: ${exampleUrlsMsg}`);\n+      ngDevMode &&\n+          `Image loader has detected an invalid path (\\`${path}\\`). ` +\n+              `To fix this, supply a path using one of the following formats: ${\n+                  exampleUrls.join(' or ')}`);\n }\n \n function throwUnexpectedAbsoluteUrlError(path: string, url: string): never {\n   throw new RuntimeError(\n       RuntimeErrorCode.INVALID_LOADER_ARGUMENTS,\n-      `Image loader has detected a \\`<img>\\` tag with an invalid \\`rawSrc\\` attribute: ${url}. ` +\n-          `This image loader expects \\`rawSrc\\` to be a relative URL - ` +\n-          `however the provided value is an absolute URL. ` +\n-          `To fix this, provide \\`rawSrc\\` as a path relative to the base URL ` +\n-          `configured for this loader (\\`${path}\\`).`);\n+      ngDevMode &&\n+          `Image loader has detected a \\`<img>\\` tag with an invalid \\`rawSrc\\` attribute: ${\n+              url}. ` +\n+              `This image loader expects \\`rawSrc\\` to be a relative URL - ` +\n+              `however the provided value is an absolute URL. ` +\n+              `To fix this, provide \\`rawSrc\\` as a path relative to the base URL ` +\n+              `configured for this loader (\\`${path}\\`).`);\n }\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -110,7 +110,7 @@ const OVERSIZED_IMAGE_TOLERANCE = 1000;\n  *\n  * To use the **default loader**: no additional code changes are necessary. The URL returned by the\n  * generic loader will always match the value of \"src\". In other words, this loader applies no\n- * transformations to thr resource URL and the value of the `rawSrc` attribute will be used as is.\n+ * transformations to the resource URL and the value of the `rawSrc` attribute will be used as is.\n  *\n  * To use an existing loader for a **third-party image service**: add the provider factory for your\n  * chosen service to the `providers` array. In the example below, the Imgix loader is used:\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/url.ts | file path B: packages/common/src/directives/ng_optimized_image/url.ts\n\n@@ -17,13 +17,6 @@ export function isAbsoluteUrl(src: string): boolean {\n   return /^https?:\\/\\//.test(src);\n }\n \n-// Assembles directive details string, useful for error messages.\n-export function imgDirectiveDetails(rawSrc: string, includeRawSrc = true) {\n-  const rawSrcInfo =\n-      includeRawSrc ? `(activated on an <img> element with the \\`rawSrc=\"${rawSrc}\"\\`) ` : '';\n-  return `The NgOptimizedImage directive ${rawSrcInfo}has detected that`;\n-}\n-\n // Invokes a callback for each element in the array. Also invokes a callback\n // recursively for each nested array.\n export function deepForEach<T>(input: (T|any[])[], fn: (value: T) => void): void {\n\n\n###\n\n", "completion": "refactor(common): post-review image directive cleanup (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -628,10 +628,11 @@ function assertNoImageDistortion(\n             RuntimeErrorCode.OVERSIZED_IMAGE,\n             `${imgDirectiveDetails(dir.rawSrc)} the intrinsic image is significantly ` +\n                 `larger than necessary. ` +\n-                `Rendered image size: ${renderedWidth}w x ${renderedHeight}h. ` +\n-                `Intrinsic image size: ${intrinsicWidth}w x ${intrinsicHeight}h. ` +\n-                `Recommended intrinsic image size: ${recommendedWidth}w x ${recommendedHeight}h. ` +\n-                `Note: Recommended intrinsic image size is calculated assuming a maximum DPR of ` +\n+                `\\nRendered image size: ${renderedWidth}w x ${renderedHeight}h. ` +\n+                `\\nIntrinsic image size: ${intrinsicWidth}w x ${intrinsicHeight}h. ` +\n+                `\\nRecommended intrinsic image size: ${recommendedWidth}w x ${\n+                    recommendedHeight}h. ` +\n+                `\\nNote: Recommended intrinsic image size is calculated assuming a maximum DPR of ` +\n                 `${RECOMMENDED_SRCSET_DENSITY_CAP}. To improve loading time, resize the image ` +\n                 `or consider using the \"rawSrcset\" and \"sizes\" attributes.`));\n       }\n\n\n###\n\n", "completion": "fix(common): fix formatting on oversized image error (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/router/errors.md | file path B: goldens/public-api/router/errors.md\n\n@@ -13,6 +13,8 @@ export const enum RuntimeErrorCode {\n     // (undocumented)\n     INVALID_DOUBLE_DOTS = 4005,\n     // (undocumented)\n+    INVALID_ROOT_URL_SEGMENT = 4015,\n+    // (undocumented)\n     INVALID_ROUTE_CONFIG = 4014,\n     // (undocumented)\n     MISPLACED_OUTLETS_COMMAND = 4004,\n\n---\n file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -1033,6 +1033,10 @@ export abstract class UrlSerializer {\n \n // @public\n export class UrlTree {\n+    constructor(\n+    root?: UrlSegmentGroup,\n+    queryParams?: Params,\n+    fragment?: string | null);\n     fragment: string | null;\n     // (undocumented)\n     get queryParamMap(): ParamMap;\n\n---\n file path A: packages/router/src/errors.ts | file path B: packages/router/src/errors.ts\n\n@@ -25,4 +25,5 @@ export const enum RuntimeErrorCode {\n   OUTLET_NOT_ACTIVATED = 4012,\n   OUTLET_ALREADY_ACTIVATED = 4013,\n   INVALID_ROUTE_CONFIG = 4014,\n+  INVALID_ROOT_URL_SEGMENT = 4015,\n }\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -32,7 +32,7 @@ import {ChildrenOutletContexts} from './router_outlet_context';\n import {ActivatedRoute, ActivatedRouteSnapshot, createEmptyState, RouterState, RouterStateSnapshot} from './router_state';\n import {Params} from './shared';\n import {DefaultUrlHandlingStrategy, UrlHandlingStrategy} from './url_handling_strategy';\n-import {containsTree, createEmptyUrlTree, IsActiveMatchOptions, isUrlTree, UrlSerializer, UrlTree} from './url_tree';\n+import {containsTree, IsActiveMatchOptions, isUrlTree, UrlSerializer, UrlTree} from './url_tree';\n import {flatten} from './utils/collection';\n import {standardizeConfig, validateConfig} from './utils/config';\n import {Checks, getAllRouteGuards} from './utils/preactivation';\n@@ -582,7 +582,7 @@ export class Router {\n     this.isNgZoneEnabled = ngZone instanceof NgZone && NgZone.isInAngularZone();\n \n     this.resetConfig(config);\n-    this.currentUrlTree = createEmptyUrlTree();\n+    this.currentUrlTree = new UrlTree();\n     this.rawUrlTree = this.currentUrlTree;\n     this.browserUrlTree = this.currentUrlTree;\n \n\n---\n file path A: packages/router/src/url_tree.ts | file path B: packages/router/src/url_tree.ts\n\n@@ -14,10 +14,6 @@ import {equalArraysOrString, forEach, shallowEqual} from './utils/collection';\n \n const NG_DEV_MODE = typeof ngDevMode === 'undefined' || ngDevMode;\n \n-export function createEmptyUrlTree() {\n-  return new UrlTree(new UrlSegmentGroup([], {}), {}, null);\n-}\n-\n /**\n  * A set of options which specify how to determine if a `UrlTree` is active, given the `UrlTree`\n  * for the current router state.\n@@ -196,14 +192,22 @@ export class UrlTree {\n   // TODO(issue/24571): remove '!'.\n   _queryParamMap!: ParamMap;\n \n-  /** @internal */\n   constructor(\n       /** The root segment group of the URL tree */\n-      public root: UrlSegmentGroup,\n+      public root: UrlSegmentGroup = new UrlSegmentGroup([], {}),\n       /** The query params of the URL */\n-      public queryParams: Params,\n+      public queryParams: Params = {},\n       /** The fragment of the URL */\n-      public fragment: string|null) {}\n+      public fragment: string|null = null) {\n+    if (NG_DEV_MODE) {\n+      if (root.segments.length > 0) {\n+        throw new RuntimeError(\n+            RuntimeErrorCode.INVALID_ROOT_URL_SEGMENT,\n+            'The root `UrlSegmentGroup` should not contain `segments`. ' +\n+                'Instead, these segments belong in the `children` so they can be associated with a named outlet.');\n+      }\n+    }\n+  }\n \n   get queryParamMap(): ParamMap {\n     if (!this._queryParamMap) {\n\n\n###\n\n", "completion": "feat(router): Add UrlTree constructor to public API (#<issue-num>)"}
{"prompt": " file path A: packages/language-service/src/ts_utils.ts | file path B: packages/language-service/src/ts_utils.ts\n\n@@ -94,3 +94,38 @@ export function collectMemberMethods(\n   }\n   return members;\n }\n+\n+/**\n+ * Given an existing array literal expression, update it by pushing a new expression.\n+ */\n+export function addElementToArrayLiteral(\n+    arr: ts.ArrayLiteralExpression, elem: ts.Expression): ts.ArrayLiteralExpression {\n+  return ts.factory.updateArrayLiteralExpression(arr, [...arr.elements, elem]);\n+}\n+\n+/**\n+ * Given an ObjectLiteralExpression node, extract and return the PropertyAssignment corresponding to\n+ * the given key. `null` if no such key exists.\n+ */\n+export function objectPropertyAssignmentForKey(\n+    obj: ts.ObjectLiteralExpression, key: string): ts.PropertyAssignment|null {\n+  const matchingProperty = obj.properties.filter(\n+      a => a.name !== undefined && ts.isIdentifier(a.name) && a.name.escapedText === key)[0];\n+  return matchingProperty && ts.isPropertyAssignment(matchingProperty) ? matchingProperty : null;\n+}\n+\n+/**\n+ * Given an ObjectLiteralExpression node, create or update the specified key, using the provided\n+ * callback to generate the new value (possibly based on an old value).\n+ */\n+export function updateObjectValueForKey(\n+    obj: ts.ObjectLiteralExpression, key: string,\n+    newValueFn: (oldValue?: ts.Expression) => ts.Expression): ts.ObjectLiteralExpression {\n+  const existingProp = objectPropertyAssignmentForKey(obj, key);\n+  const newProp = ts.factory.createPropertyAssignment(\n+      ts.factory.createIdentifier(key), newValueFn(existingProp?.initializer));\n+  return ts.factory.updateObjectLiteralExpression(obj, [\n+    ...obj.properties.filter(p => p !== existingProp),\n+    newProp,\n+  ]);\n+}\n\n---\n file path A: packages/language-service/test/ts_utils_spec.ts | file path B: packages/language-service/test/ts_utils_spec.ts\n\n@@ -9,10 +9,10 @@\n import {initMockFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n import ts from 'typescript';\n \n-import {collectMemberMethods, findTightestNode} from '../src/ts_utils';\n+import {addElementToArrayLiteral, collectMemberMethods, findTightestNode, objectPropertyAssignmentForKey, updateObjectValueForKey} from '../src/ts_utils';\n import {LanguageServiceTestEnv, OpenBuffer, Project} from '../testing';\n \n-describe('ts utils', () => {\n+describe('TS util', () => {\n   describe('collectMemberMethods', () => {\n     beforeEach(() => {\n       initMockFileSystem('Native');\n@@ -84,4 +84,82 @@ describe('ts utils', () => {\n           .sort();\n     }\n   });\n+\n+  describe('AST method', () => {\n+    let printer: ts.Printer;\n+    let sourceFile: ts.SourceFile;\n+\n+    function print(node: ts.Node): string {\n+      return printer.printNode(ts.EmitHint.Unspecified, node, sourceFile);\n+    }\n+\n+    beforeAll(() => {\n+      printer = ts.createPrinter();\n+      sourceFile =\n+          ts.createSourceFile('placeholder.ts', '', ts.ScriptTarget.ESNext, true, ts.ScriptKind.TS);\n+    });\n+\n+    describe('addElementToArrayLiteral', () => {\n+      it('transforms an empty array literal expression', () => {\n+        const oldArr = ts.factory.createArrayLiteralExpression([], false);\n+        const newArr = addElementToArrayLiteral(oldArr, ts.factory.createStringLiteral('a'));\n+        expect(print(newArr)).toEqual('[\"a\"]');\n+      });\n+\n+      it('transforms an existing array literal expression', () => {\n+        const oldArr =\n+            ts.factory.createArrayLiteralExpression([ts.factory.createStringLiteral('a')], false);\n+        const newArr = addElementToArrayLiteral(oldArr, ts.factory.createStringLiteral('b'));\n+        expect(print(newArr)).toEqual('[\"a\", \"b\"]');\n+      });\n+    });\n+\n+    describe('objectPropertyAssignmentForKey', () => {\n+      let oldObj: ts.ObjectLiteralExpression;\n+\n+      beforeEach(() => {\n+        oldObj = ts.factory.createObjectLiteralExpression(\n+            [ts.factory.createPropertyAssignment(\n+                ts.factory.createIdentifier('foo'), ts.factory.createStringLiteral('bar'))],\n+            false);\n+      });\n+\n+      it('returns null when no property exists', () => {\n+        const prop = objectPropertyAssignmentForKey(oldObj, 'oops');\n+        expect(prop).toBeNull();\n+      });\n+\n+      it('returns the requested property assignment', () => {\n+        const prop = objectPropertyAssignmentForKey(oldObj, 'foo');\n+        expect(print(prop!)).toEqual('foo: \"bar\"');\n+      });\n+    });\n+\n+    describe('updateObjectValueForKey', () => {\n+      let oldObj: ts.ObjectLiteralExpression;\n+\n+      const valueAppenderFn = (oldValue?: ts.Expression) => {\n+        if (!oldValue) return ts.factory.createStringLiteral('baz');\n+        if (!ts.isStringLiteral(oldValue)) return oldValue;\n+        return ts.factory.createStringLiteral(oldValue.text + 'baz');\n+      };\n+\n+      beforeEach(() => {\n+        oldObj = ts.factory.createObjectLiteralExpression(\n+            [ts.factory.createPropertyAssignment(\n+                ts.factory.createIdentifier('foo'), ts.factory.createStringLiteral('bar'))],\n+            false);\n+      });\n+\n+      it('creates a non-existant property', () => {\n+        const obj = updateObjectValueForKey(oldObj, 'newKey', valueAppenderFn);\n+        expect(print(obj)).toBe('{ foo: \"bar\", newKey: \"baz\" }');\n+      });\n+\n+      it('updates an existing property', () => {\n+        const obj = updateObjectValueForKey(oldObj, 'foo', valueAppenderFn);\n+        expect(print(obj)).toBe('{ foo: \"barbaz\" }');\n+      });\n+    });\n+  });\n });\n\n\n###\n\n", "completion": "refactor(language-service): Create helper methods for manipulating object and array ASTs. (#<issue-num>)"}
{"prompt": " file path A: aio/tools/examples/shared/boilerplate/universal/package.json | file path B: aio/tools/examples/shared/boilerplate/universal/package.json\n\n@@ -26,7 +26,7 @@\n     \"@angular/platform-browser-dynamic\": \"^14.2.0-rc\",\n     \"@angular/platform-server\": \"^14.2.0-rc\",\n     \"@angular/router\": \"^14.2.0-rc\",\n-    \"@nguniversal/express-engine\": \"~14.0.0\",\n+    \"@nguniversal/express-engine\": \"~14.1.0\",\n     \"angular-in-memory-web-api\": \"~0.14.0\",\n     \"express\": \"^4.18.1\",\n     \"rxjs\": \"~7.5.0\",\n@@ -37,7 +37,7 @@\n     \"@angular-devkit/build-angular\": \"^14.2.0-rc\",\n     \"@angular/cli\": \"~14.0.0\",\n     \"@angular/compiler-cli\": \"^14.2.0-rc\",\n-    \"@nguniversal/builders\": \"~14.0.0\",\n+    \"@nguniversal/builders\": \"~14.1.0\",\n     \"@types/express\": \"^4.17.13\",\n     \"@types/jasmine\": \"~4.0.0\",\n     \"@types/node\": \"^16.11.35\",\n\n---\n file path A: aio/tools/examples/shared/package.json | file path B: aio/tools/examples/shared/package.json\n\n@@ -34,7 +34,7 @@\n     \"@angular/router\": \"^14.2.0-rc\",\n     \"@angular/service-worker\": \"^14.2.0-rc\",\n     \"@angular/upgrade\": \"^14.2.0-rc\",\n-    \"@nguniversal/express-engine\": \"~14.0.0\",\n+    \"@nguniversal/express-engine\": \"~14.1.0\",\n     \"angular\": \"^1.8.3\",\n     \"angular-in-memory-web-api\": \"~0.14.0\",\n     \"angular-route\": \"1.8.3\",\n@@ -50,7 +50,7 @@\n     \"@angular-devkit/build-angular\": \"^14.2.0-rc\",\n     \"@angular/cli\": \"~14.0.0\",\n     \"@angular/compiler-cli\": \"^14.2.0-rc\",\n-    \"@nguniversal/builders\": \"~14.0.0\",\n+    \"@nguniversal/builders\": \"~14.1.0\",\n     \"@rollup/plugin-commonjs\": \"^22.0.0\",\n     \"@rollup/plugin-node-resolve\": \"^13.2.0\",\n     \"@types/angular\": \"^1.8.4\",\n\n---\n file path A: aio/tools/examples/shared/yarn.lock | file path B: aio/tools/examples/shared/yarn.lock\n\n@@ -15,7 +15,7 @@\n     \"@jridgewell/gen-mapping\" \"^0.1.0\"\n     \"@jridgewell/trace-mapping\" \"^0.3.9\"\n \n-\"@angular-devkit/architect@0.1400.5\", \"@angular-devkit/architect@^0.1400.0-next\":\n+\"@angular-devkit/architect@0.1400.5\":\n   version \"0.1400.5\"\n   resolved \"https://registry.yarnpkg.com/@angular-devkit/architect/-/architect-0.1400.5.tgz#423f7c81b6bac39a9d0ba3c31868de781afe08d0\"\n   integrity sha512-A5sRLPK3qGJAehYtX4ayUDwxQZ02yvsrxcpf3sv492IxbF7ymdMhcxIp+0UG6wIsLvpQkpW9ekJUdKmFB6GVAw==\n@@ -31,6 +31,14 @@\n     \"@angular-devkit/core\" \"14.2.0-rc.0\"\n     rxjs \"6.6.7\"\n \n+\"@angular-devkit/architect@^0.1401.0\":\n+  version \"0.1401.3\"\n+  resolved \"https://registry.yarnpkg.com/@angular-devkit/architect/-/architect-0.1401.3.tgz#ce1eb086c25051021a12fdf5a6c8351ca8f29443\"\n+  integrity sha512-DQvKfl8Q9c02jpGqZX1nOL4mAnRBU6BSqPlhi1q17ZrB8sQpYtDBb8Epn2DDq48l7SQVFnRg6Zgje9L1LObURg==\n+  dependencies:\n+    \"@angular-devkit/core\" \"14.1.3\"\n+    rxjs \"6.6.7\"\n+\n \"@angular-devkit/build-angular@^14.2.0-rc\":\n   version \"14.2.0-rc.0\"\n   resolved \"https://registry.yarnpkg.com/@angular-devkit/build-angular/-/build-angular-14.2.0-rc.0.tgz#f7efbc8fb3d516a0c27fa10bfdb26a9260bb274e\"\n@@ -109,7 +117,7 @@\n     \"@angular-devkit/architect\" \"0.1402.0-rc.0\"\n     rxjs \"6.6.7\"\n \n-\"@angular-devkit/core@14.0.5\", \"@angular-devkit/core@^14.0.0-next\":\n+\"@angular-devkit/core@14.0.5\":\n   version \"14.0.5\"\n   resolved \"https://registry.yarnpkg.com/@angular-devkit/core/-/core-14.0.5.tgz#19f5940b53aeb0ce56479c44670d3bc3b2df92b1\"\n   integrity sha512-/CUGi6QLwh79FvsOY7M+1LQL3asZsbQW/WBd5f1iu5y7TLNqCwo+wOb0ZXLDNPw45vYBxFajtt3ob3U7qx3jNg==\n@@ -120,6 +128,17 @@\n     rxjs \"6.6.7\"\n     source-map \"0.7.3\"\n \n+\"@angular-devkit/core@14.1.3\", \"@angular-devkit/core@^14.1.0\":\n+  version \"14.1.3\"\n+  resolved \"https://registry.yarnpkg.com/@angular-devkit/core/-/core-14.1.3.tgz#5dc9a7917bed82a02efc20a4847f5eb6a55b699b\"\n+  integrity sha512-YBxhRl7hKgirjcKeurfejVrIgmw31GcfKKCyQiIudoLCYjonnSMdDEx2y8BNMANvxe5YmuZsIYJtgVlqp3mMDg==\n+  dependencies:\n+    ajv \"8.11.0\"\n+    ajv-formats \"2.1.1\"\n+    jsonc-parser \"3.1.0\"\n+    rxjs \"6.6.7\"\n+    source-map \"0.7.4\"\n+\n \"@angular-devkit/core@14.2.0-rc.0\":\n   version \"14.2.0-rc.0\"\n   resolved \"https://registry.yarnpkg.com/@angular-devkit/core/-/core-14.2.0-rc.0.tgz#6e55a48e59ffc70c0bd67810b0aae37772f2c9a8\"\n@@ -1588,14 +1607,14 @@\n   resolved \"https://registry.yarnpkg.com/@ngtools/webpack/-/webpack-14.2.0-rc.0.tgz#96237f523b2f9d072810f9bfd38d3f74d7662ae6\"\n   integrity sha512-gA0O15Bcvdp5PB3iWew5wYYut1zTxAuCx22z1tn1+/gQbS9mntzKyKhxwOGfYsoK2j6S7TwlBfeMSqjY0HIYiw==\n \n-\"@nguniversal/builders@~14.0.0\":\n-  version \"14.0.3\"\n-  resolved \"https://registry.yarnpkg.com/@nguniversal/builders/-/builders-14.0.3.tgz#7df2cff48c8c16d440565fe8522a94d75f81d9a4\"\n-  integrity sha512-LPpFTGR2eX6HoPtiB9sJJmO03xZDZAdB0JLVMy63XYbCKp3sqX4A0huQj16qIkhkf/D/Q9CdJsYMWM6L7VmYnQ==\n+\"@nguniversal/builders@~14.1.0\":\n+  version \"14.1.0\"\n+  resolved \"https://registry.yarnpkg.com/@nguniversal/builders/-/builders-14.1.0.tgz#eaff401cfd2d9886fcf35d0f5f0b5518c77a5782\"\n+  integrity sha512-TOOV7P7+zJ2739Ty7BazV7V9q1sF+kiJmV3c3ZqXFeNoNG6CYtX52cAPM/OkuU9JFER/JNUtNBCDihEdQquI3Q==\n   dependencies:\n-    \"@angular-devkit/architect\" \"^0.1400.0-next\"\n-    \"@angular-devkit/core\" \"^14.0.0-next\"\n-    \"@nguniversal/common\" \"14.0.3\"\n+    \"@angular-devkit/architect\" \"^0.1401.0\"\n+    \"@angular-devkit/core\" \"^14.1.0\"\n+    \"@nguniversal/common\" \"14.1.0\"\n     browser-sync \"^2.26.7\"\n     express \"^4.17.1\"\n     guess-parser \"^0.4.12\"\n@@ -1605,21 +1624,21 @@\n     rxjs \"^6.5.5\"\n     tree-kill \"^1.2.2\"\n \n-\"@nguniversal/common@14.0.3\":\n-  version \"14.0.3\"\n-  resolved \"https://registry.yarnpkg.com/@nguniversal/common/-/common-14.0.3.tgz#f1c24883dcc0703f68c6a71157bd0438ed37829f\"\n-  integrity sha512-WwC1pseVxTl0RT2UHpTwpvGnm0Ep0OF7Q1/lMvp6g1t4Jt9CgR/Sqd5sCl+riqwK817+kx3DM3vdvKvMvEK+hA==\n+\"@nguniversal/common@14.1.0\":\n+  version \"14.1.0\"\n+  resolved \"https://registry.yarnpkg.com/@nguniversal/common/-/common-14.1.0.tgz#77029fc0495695cae986b9e569763aa214acbb49\"\n+  integrity sha512-h2GhKrrSIGHDhzhOcYy+MFiFIzl8MbRLs1FBLW3/YdbPpr2Cf5qDPMHIw/d8+FqDT5eHIoYGds35qGruoG4+GA==\n   dependencies:\n     critters \"0.0.16\"\n-    jsdom \"19.0.0\"\n+    jsdom \"20.0.0\"\n     tslib \"^2.3.0\"\n \n-\"@nguniversal/express-engine@~14.0.0\":\n-  version \"14.0.3\"\n-  resolved \"https://registry.yarnpkg.com/@nguniversal/express-engine/-/express-engine-14.0.3.tgz#b2fae522d9633b1c059eb24fb806996967be6ebf\"\n-  integrity sha512-tlWaNvd+KHNj4Ofb36VoGpXkYHmcM3qU+VX2imYnjKR6N5y2ERQLOYQVzJDJBX2bz6k9DopceXXbZk/dTnsFrA==\n+\"@nguniversal/express-engine@~14.1.0\":\n+  version \"14.1.0\"\n+  resolved \"https://registry.yarnpkg.com/@nguniversal/express-engine/-/express-engine-14.1.0.tgz#cf8d318cbbdd1eb1576f0b41244628c6918f13a5\"\n+  integrity sha512-nGlCqqodXzKWP5fcatCglUvueeICmUMPsSz1mhmkINxvtRK1pQtbh2SAGI+nWa2qe3BDl472/dcZ9dSPULr/RQ==\n   dependencies:\n-    \"@nguniversal/common\" \"14.0.3\"\n+    \"@nguniversal/common\" \"14.1.0\"\n     tslib \"^2.3.0\"\n \n \"@nodelib/fs.scandir@2.1.5\":\n@@ -3443,7 +3462,7 @@ data-urls@^2.0.0:\n     whatwg-mimetype \"^2.3.0\"\n     whatwg-url \"^8.0.0\"\n \n-data-urls@^3.0.1:\n+data-urls@^3.0.2:\n   version \"3.0.2\"\n   resolved \"https://registry.yarnpkg.com/data-urls/-/data-urls-3.0.2.tgz#9cf24a477ae22bcef5cd5f6f0bfbc1d2d3be9143\"\n   integrity sha512-Jy/tj3ldjZJo63sVAvg6LHt2mHvl4V6AgRAmNDtLdm7faqtsx+aJG42rsyCo9JCoRVKwPFzKlIPx3DIibwSIaQ==\n@@ -3828,6 +3847,11 @@ entities@^2.0.0:\n   resolved \"https://registry.yarnpkg.com/entities/-/entities-2.2.0.tgz#098dc90ebb83d8dffa089d55256b351d34c4da55\"\n   integrity sha512-p92if5Nz619I0w+akJrLZH0MX0Pb5DX39XOwQTtXSdQQOaYH03S1uIQp4mhOZtAXrxq4ViO67YTiLBo2638o9A==\n \n+entities@^4.3.0:\n+  version \"4.3.1\"\n+  resolved \"https://registry.yarnpkg.com/entities/-/entities-4.3.1.tgz#c34062a94c865c322f9d67b4384e4169bcede6a4\"\n+  integrity sha512-o4q/dYJlmyjP2zfnaWDUC6A3BQFmVTX+tZPezK7k0GLSU9QYCauscf5Y+qcEPzKL+EixVouYDgLQK5H9GrLpkg==\n+\n env-paths@^2.2.0:\n   version \"2.2.1\"\n   resolved \"https://registry.yarnpkg.com/env-paths/-/env-paths-2.2.1.tgz#420399d416ce1fbe9bc0a07c62fa68d67fd0f8f2\"\n@@ -4791,7 +4815,7 @@ https-proxy-agent@5.0.0:\n     agent-base \"6\"\n     debug \"4\"\n \n-https-proxy-agent@5.0.1, https-proxy-agent@^5.0.0:\n+https-proxy-agent@5.0.1, https-proxy-agent@^5.0.0, https-proxy-agent@^5.0.1:\n   version \"5.0.1\"\n   resolved \"https://registry.yarnpkg.com/https-proxy-agent/-/https-proxy-agent-5.0.1.tgz#c59ef224a04fe8b754f3db0063a25ea30d0005d6\"\n   integrity sha512-dFcAjpTQFgoLMzC2VwU+C/CbS7uRL0lWmxDITmqm7C+7F0Odmj6s9l6alZc6AELXhrnggM2CeWSXHGOdX2YtwA==\n@@ -5273,28 +5297,28 @@ jsbn@~0.1.0:\n   resolved \"https://registry.yarnpkg.com/jsbn/-/jsbn-0.1.1.tgz#a5e654c2e5a2deb5f201d96cefbca80c0ef2f513\"\n   integrity sha512-UVU9dibq2JcFWxQPA6KCqj5O42VOmAY3zQUfEKxU0KpTGXwNoCjkX1e13eHNvw/xPynt6pU0rZ1htjWTNTSXsg==\n \n-jsdom@19.0.0:\n-  version \"19.0.0\"\n-  resolved \"https://registry.yarnpkg.com/jsdom/-/jsdom-19.0.0.tgz#93e67c149fe26816d38a849ea30ac93677e16b6a\"\n-  integrity sha512-RYAyjCbxy/vri/CfnjUWJQQtZ3LKlLnDqj+9XLNnJPgEGeirZs3hllKR20re8LUZ6o1b1X4Jat+Qd26zmP41+A==\n+jsdom@20.0.0:\n+  version \"20.0.0\"\n+  resolved \"https://registry.yarnpkg.com/jsdom/-/jsdom-20.0.0.tgz#882825ac9cc5e5bbee704ba16143e1fa78361ebf\"\n+  integrity sha512-x4a6CKCgx00uCmP+QakBDFXwjAJ69IkkIWHmtmjd3wvXPcdOS44hfX2vqkOQrVrq8l9DhNNADZRXaCEWvgXtVA==\n   dependencies:\n-    abab \"^2.0.5\"\n-    acorn \"^8.5.0\"\n+    abab \"^2.0.6\"\n+    acorn \"^8.7.1\"\n     acorn-globals \"^6.0.0\"\n     cssom \"^0.5.0\"\n     cssstyle \"^2.3.0\"\n-    data-urls \"^3.0.1\"\n+    data-urls \"^3.0.2\"\n     decimal.js \"^10.3.1\"\n     domexception \"^4.0.0\"\n     escodegen \"^2.0.0\"\n     form-data \"^4.0.0\"\n     html-encoding-sniffer \"^3.0.0\"\n     http-proxy-agent \"^5.0.0\"\n-    https-proxy-agent \"^5.0.0\"\n+    https-proxy-agent \"^5.0.1\"\n     is-potential-custom-element-name \"^1.0.1\"\n     nwsapi \"^2.2.0\"\n-    parse5 \"6.0.1\"\n-    saxes \"^5.0.1\"\n+    parse5 \"^7.0.0\"\n+    saxes \"^6.0.0\"\n     symbol-tree \"^3.2.4\"\n     tough-cookie \"^4.0.0\"\n     w3c-hr-time \"^1.0.2\"\n@@ -5302,8 +5326,8 @@ jsdom@19.0.0:\n     webidl-conversions \"^7.0.0\"\n     whatwg-encoding \"^2.0.0\"\n     whatwg-mimetype \"^3.0.0\"\n-    whatwg-url \"^10.0.0\"\n-    ws \"^8.2.3\"\n+    whatwg-url \"^11.0.0\"\n+    ws \"^8.8.0\"\n     xml-name-validator \"^4.0.0\"\n \n jsdom@^16.4.0:\n@@ -6430,6 +6454,13 @@ parse5@6.0.1, parse5@^6.0.1:\n   resolved \"https://registry.yarnpkg.com/parse5/-/parse5-6.0.1.tgz#e1a1c085c569b3dc08321184f19a39cc27f7c30b\"\n   integrity sha512-Ofn/CTFzRGTTxwpNEs9PP93gXShHcTq255nzRYSKe8AkVpZY7e1fpmTfOyoIvjP5HG7Z2ZM7VS9PPhQGW2pOpw==\n \n+parse5@^7.0.0:\n+  version \"7.0.0\"\n+  resolved \"https://registry.yarnpkg.com/parse5/-/parse5-7.0.0.tgz#51f74a5257f5fcc536389e8c2d0b3802e1bfa91a\"\n+  integrity sha512-y/t8IXSPWTuRZqXc0ajH/UwDj4mnqLEbSttNbThcFhGrZuOyoyvNBO85PBp2jQa55wY9d07PBNjsK8ZP3K5U6g==\n+  dependencies:\n+    entities \"^4.3.0\"\n+\n parseurl@~1.3.2, parseurl@~1.3.3:\n   version \"1.3.3\"\n   resolved \"https://registry.yarnpkg.com/parseurl/-/parseurl-1.3.3.tgz#9da19e7bee8d12dff0513ed5b76957793bc2e8d4\"\n@@ -7411,6 +7442,13 @@ saxes@^5.0.1:\n   dependencies:\n     xmlchars \"^2.2.0\"\n \n+saxes@^6.0.0:\n+  version \"6.0.0\"\n+  resolved \"https://registry.yarnpkg.com/saxes/-/saxes-6.0.0.tgz#fe5b4a4768df4f14a201b1ba6a65c1f3d9988cc5\"\n+  integrity sha512-xAg7SOnEhrm5zI3puOOKyy1OMcMlIJZYNJY7xLBwSze0UjhPLnWfj2GF2EpT0jmzaJKIWKHLsaSSajf35bcYnA==\n+  dependencies:\n+    xmlchars \"^2.2.0\"\n+\n schema-utils@^2.6.5:\n   version \"2.7.1\"\n   resolved \"https://registry.yarnpkg.com/schema-utils/-/schema-utils-2.7.1.tgz#1ca4f32d1b24c590c203b8e7a50bf0ea4cd394d7\"\n@@ -8695,14 +8733,6 @@ whatwg-mimetype@^3.0.0:\n   resolved \"https://registry.yarnpkg.com/whatwg-mimetype/-/whatwg-mimetype-3.0.0.tgz#5fa1a7623867ff1af6ca3dc72ad6b8a4208beba7\"\n   integrity sha512-nt+N2dzIutVRxARx1nghPKGv1xHikU7HKdfafKkLNLindmPU/ch3U31NOCGGA/dmPcmb1VlofO0vnKAcsm0o/Q==\n \n-whatwg-url@^10.0.0:\n-  version \"10.0.0\"\n-  resolved \"https://registry.yarnpkg.com/whatwg-url/-/whatwg-url-10.0.0.tgz#37264f720b575b4a311bd4094ed8c760caaa05da\"\n-  integrity sha512-CLxxCmdUby142H5FZzn4D8ikO1cmypvXVQktsgosNy4a4BHrDHeciBBGZhb0bNoR5/MltoCatso+vFjjGx8t0w==\n-  dependencies:\n-    tr46 \"^3.0.0\"\n-    webidl-conversions \"^7.0.0\"\n-\n whatwg-url@^11.0.0:\n   version \"11.0.0\"\n   resolved \"https://registry.yarnpkg.com/whatwg-url/-/whatwg-url-11.0.0.tgz#0a849eebb5faf2119b901bb76fd795c2848d4018\"\n@@ -8794,11 +8824,16 @@ ws@^7.4.6:\n   resolved \"https://registry.yarnpkg.com/ws/-/ws-7.5.8.tgz#ac2729881ab9e7cbaf8787fe3469a48c5c7f636a\"\n   integrity sha512-ri1Id1WinAX5Jqn9HejiGb8crfRio0Qgu8+MtL36rlTA6RLsMdWt1Az/19A2Qij6uSHUMphEFaTKa4WG+UNHNw==\n \n-ws@^8.2.3, ws@^8.4.2:\n+ws@^8.4.2:\n   version \"8.8.0\"\n   resolved \"https://registry.yarnpkg.com/ws/-/ws-8.8.0.tgz#8e71c75e2f6348dbf8d78005107297056cb77769\"\n   integrity sha512-JDAgSYQ1ksuwqfChJusw1LSJ8BizJ2e/vVu5Lxjq3YvNJNlROv1ui4i+c/kUUrPheBvQl4c5UbERhTwKa6QBJQ==\n \n+ws@^8.8.0:\n+  version \"8.8.1\"\n+  resolved \"https://registry.yarnpkg.com/ws/-/ws-8.8.1.tgz#5dbad0feb7ade8ecc99b830c1d77c913d4955ff0\"\n+  integrity sha512-bGy2JzvzkPowEJV++hF07hAD6niYSr0JzBNo/J29WsB57A2r7Wlc1UFcTR9IzrPvuNVO4B8LGqF8qcpsVOhJCA==\n+\n ws@~8.2.3:\n   version \"8.2.3\"\n   resolved \"https://registry.yarnpkg.com/ws/-/ws-8.2.3.tgz#63a56456db1b04367d0b721a0b80cae6d8becbba\"\n\n---\n file path A: integration/bazel_workspace_tests/bazel_ngtsc_plugin/WORKSPACE | file path B: integration/bazel_workspace_tests/bazel_ngtsc_plugin/WORKSPACE\n\n@@ -12,10 +12,10 @@ http_archive(\n # Fetch sass rules for compiling sass files\n http_archive(\n     name = \"io_bazel_rules_sass\",\n-    sha256 = \"69ceb23a6af8eaf319317c17fdbfc7790d0958d024c80523cf06da4a14004a3e\",\n-    strip_prefix = \"rules_sass-1.54.3\",\n+    sha256 = \"5de9705b00dcabe36d6c10d95fa47f519b1639f034f37ad526e4e9eaac90b0d2\",\n+    strip_prefix = \"rules_sass-1.54.5\",\n     urls = [\n-        \"https://github.com/bazelbuild/rules_sass/archive/1.54.3.zip\",\n+        \"https://github.com/bazelbuild/rules_sass/archive/1.54.5.zip\",\n     ],\n )\n \n\n---\n file path A: package.json | file path B: package.json\n\n@@ -88,7 +88,7 @@\n     \"@types/babel__traverse\": \"7.18.0\",\n     \"@types/base64-js\": \"1.3.0\",\n     \"@types/bluebird\": \"^3.5.27\",\n-    \"@types/chrome\": \"^0.0.193\",\n+    \"@types/chrome\": \"^0.0.195\",\n     \"@types/convert-source-map\": \"^1.5.1\",\n     \"@types/diff\": \"^5.0.0\",\n     \"@types/events\": \"3.0.0\",\n@@ -153,7 +153,7 @@\n     \"puppeteer\": \"10.2.0\",\n     \"reflect-metadata\": \"^0.1.3\",\n     \"requirejs\": \"^2.3.6\",\n-    \"rollup\": \"~2.77.0\",\n+    \"rollup\": \"~2.78.0\",\n     \"rollup-plugin-preserve-shebang\": \"^1.0.1\",\n     \"rollup-plugin-sourcemaps\": \"^0.6.3\",\n     \"rxjs\": \"^6.6.7\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -2525,10 +2525,10 @@\n     \"@types/node\" \"*\"\n     \"@types/responselike\" \"*\"\n \n-\"@types/chrome@^0.0.193\":\n-  version \"0.0.193\"\n-  resolved \"https://registry.yarnpkg.com/@types/chrome/-/chrome-0.0.193.tgz#cd0dc5033f27a243d228aebe566c3ec19ef17e36\"\n-  integrity sha512-R8C84oqvk8A8C8G1viBd8qLpDr86Y/jwD+KLgzUekbIT9RGds6a9GnlQyg8P7ltnGogTMHkiEQK0ZlcrvTeo3Q==\n+\"@types/chrome@^0.0.195\":\n+  version \"0.0.195\"\n+  resolved \"https://registry.yarnpkg.com/@types/chrome/-/chrome-0.0.195.tgz#c570f72857e11caa0a453a444828f75bca592cff\"\n+  integrity sha512-kmFh1xx7ehXoOVl6OjEBxmiYaquhxCaILjFGwPbW6xwbqzwDKCte+Mzl99aNWg3EP1B4rKVUuRm1vBsiRYks5g==\n   dependencies:\n     \"@types/filesystem\" \"*\"\n     \"@types/har-format\" \"*\"\n@@ -13178,10 +13178,10 @@ rollup@~1.11.3:\n     \"@types/node\" \"^11.13.9\"\n     acorn \"^6.1.1\"\n \n-rollup@~2.77.0:\n-  version \"2.77.2\"\n-  resolved \"https://registry.yarnpkg.com/rollup/-/rollup-2.77.2.tgz#6b6075c55f9cc2040a5912e6e062151e42e2c4e3\"\n-  integrity sha512-m/4YzYgLcpMQbxX3NmAqDvwLATZzxt8bIegO78FZLl+lAgKJBd1DRAOeEiZcKOIOPjxE6ewHWHNgGEalFXuz1g==\n+rollup@~2.78.0:\n+  version \"2.78.1\"\n+  resolved \"https://registry.yarnpkg.com/rollup/-/rollup-2.78.1.tgz#52fe3934d9c83cb4f7c4cb5fb75d88591be8648f\"\n+  integrity sha512-VeeCgtGi4P+o9hIg+xz4qQpRl6R401LWEXBmxYKOV4zlF82lyhgh2hTZnheFUbANE8l2A41F458iwj2vEYaXJg==\n   optionalDependencies:\n     fsevents \"~2.3.2\"\n \n\n\n###\n\n", "completion": "build: update all non-major dependencies (#<issue-num>)"}
{"prompt": " file path A: aio/content/images/bios/bob-watson.jpg | file path B: aio/content/images/bios/bob-watson.jpg\n\nBinary files /dev/null and b/aio/content/images/bios/bob-watson.jpg differ\n\n---\n file path A: aio/content/marketing/contributors.json | file path B: aio/content/marketing/contributors.json\n\n@@ -169,6 +169,15 @@\n     \"bio\": \"Brian is a software engineer and GDE in Angular with a passion for learning, writing, speaking, teaching and mentoring. Brian has been building web applications for over 20 years and has long been a fanboy of JavaScript. When not in front of his Macbook Pro Brian is in the Rocky Mountains skiing or hiking.\",\n     \"groups\": [\"GDE\"]\n   },\n+  \"bobwatson\": {\n+    \"name\": \"Bob Watson\",\n+    \"lead\": \"mgechev\",\n+    \"picture\": \"bob-watson.jpg\",\n+    \"twitter\": \"bobwatsonphd\",\n+    \"website\": \"https://docsbydesign.com\",\n+    \"bio\": \"Bob is the documentation lead for angular.io. When he's not obsessing over the i-dotting and t-crossing of documentation, he enjoys seeing the world from up in the air and below the sea.\",\n+    \"groups\": [\"Angular\"]\n+  },\n   \"brocco\": {\n     \"name\": \"Mike Brocchi\",\n     \"picture\": \"mike-brocchi.jpg\",\n@@ -916,12 +925,6 @@\n     \"bio\": \"Andrew is a software engineer using Angular and .NET. He spends most of his spare time staying up-to-date, helping other people, and experimenting with web tech.\",\n     \"groups\": [\"GDE\"]\n   },\n-  \"tmdavisgoogle\": {\n-    \"name\": \"Tiffany Davis\",\n-    \"bio\": \"Tiffany is an editor working on Angular documentation.\",\n-    \"groups\": [\"Angular\"],\n-    \"lead\": \"mgechev\"\n-  },\n   \"toddmotto\": {\n     \"name\": \"Todd Motto\",\n     \"picture\": \"toddmotto.jpg\",\n\n\n###\n\n", "completion": "docs: Add Bob Watson as a member of the Angular team (#<issue-num>)"}
{"prompt": " file path A: aio/src/styles/2-modules/contributor/_contributor.scss | file path B: aio/src/styles/2-modules/contributor/_contributor.scss\n\n@@ -48,6 +48,7 @@ aio-contributor {\n       width: calc(100% - 4px);\n       height: calc(100% - 4px);\n       clip-path: $angular-shape-polygon;\n+      object-fit: cover;\n     }\n \n     .contributor-social-links {\n\n\n###\n\n", "completion": "fix(docs-infra): avoid distorting contributor images (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/sanitization/url_sanitizer.ts | file path B: packages/core/src/sanitization/url_sanitizer.ts\n\n@@ -33,18 +33,11 @@\n  *\n  * This regular expression was taken from the Closure sanitization library.\n  */\n-const SAFE_URL_PATTERN = /^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;\n-\n-/* A pattern that matches safe srcset values */\n-const SAFE_SRCSET_PATTERN = /^(?:(?:https?|file):|[^&:/?#]*(?:[/?#]|$))/gi;\n-\n-/** A pattern that matches safe data URLs. Only matches image, video and audio types. */\n-const DATA_URL_PATTERN =\n-    /^data:(?:image\\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\\/(?:mpeg|mp4|ogg|webm)|audio\\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\\/]+=*$/i;\n+const SAFE_URL_PATTERN = /^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;\n \n export function _sanitizeUrl(url: string): string {\n   url = String(url);\n-  if (url.match(SAFE_URL_PATTERN) || url.match(DATA_URL_PATTERN)) return url;\n+  if (url.match(SAFE_URL_PATTERN)) return url;\n \n   if (typeof ngDevMode === 'undefined' || ngDevMode) {\n     console.warn(`WARNING: sanitizing unsafe URL value ${url} (see https://g.co/ng/security#xss)`);\n\n---\n file path A: packages/core/test/bundling/router/bundle.golden_symbols.json | file path B: packages/core/test/bundling/router/bundle.golden_symbols.json\n\n@@ -110,9 +110,6 @@\n   {\n     \"name\": \"Console\"\n   },\n-  {\n-    \"name\": \"DATA_URL_PATTERN\"\n-  },\n   {\n     \"name\": \"DEFAULT_SERIALIZER\"\n   },\n\n---\n file path A: packages/core/test/sanitization/url_sanitizer_spec.ts | file path B: packages/core/test/sanitization/url_sanitizer_spec.ts\n\n@@ -66,11 +66,6 @@ import {_sanitizeUrl, sanitizeSrcset} from '../../src/sanitization/url_sanitizer\n         '&#x6A&#x61&#x76&#x61&#x73&#x63&#x72&#x69&#x70&#x74&#x3A;',\n         'jav&#x09;ascript:alert();',\n         'jav\\u0000ascript:alert();',\n-        'data:;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/',\n-        'data:,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/',\n-        'data:iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/',\n-        'data:text/javascript;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/',\n-        'data:application/x-msdownload;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/',\n       ];\n       for (const url of invalidUrls) {\n         it(`valid ${url}`, () => expect(_sanitizeUrl(url)).toMatch(/^unsafe:/));\n\n\n###\n\n", "completion": "refactor(core): remove obsolete `data:` url validation (#<issue-num>)"}
{"prompt": " file path A: packages/compiler/src/shadow_css.ts | file path B: packages/compiler/src/shadow_css.ts\n\n@@ -304,7 +304,7 @@ export class ShadowCss {\n       // `:host-context(.one):host-context(.two)`.\n       // Execute `_cssColonHostContextRe` over and over until we have extracted all the\n       // `:host-context` selectors from this selector.\n-      let match: RegExpMatchArray|null;\n+      let match: RegExpExecArray|null;\n       while (match = _cssColonHostContextRe.exec(selectorText)) {\n         // `match` = [':host-context(<selectors>)<rest>', <selectors>, <rest>]\n \n\n\n###\n\n", "completion": "refactor(compiler): /a/.exec() returns RegExpExecArray (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -3,27 +3,7 @@\n ### common\n | Commit | Type | Description |\n | -- | -- | -- |\n-| [b380fdd59e](https://github.com/angular/angular/commit/b380fdd59e368e89908ea915f150cdc9f5a87a7f) | feat | add a density cap for image srcsets ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [7ce497e5bc](https://github.com/angular/angular/commit/7ce497e5bc6502bed8099d2592888f3164cdcf1f) | feat | add built-in Imgix loader ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [bff870db61](https://github.com/angular/angular/commit/bff870db6146850248597889550f676d81a85c90) | feat | add cloudflare loader ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [86e77a5d55](https://github.com/angular/angular/commit/86e77a5d559eddb285e74cc34c0db73de5645022) | feat | add Image directive skeleton ([#45627](https://github.com/angular/angular/pull/45627)) ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [0566205a02](https://github.com/angular/angular/commit/0566205a02c5dc87a01a0aa40cb5cdf147c81f11) | feat | Add image lazy loading and fetchpriority ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [4e952ba216](https://github.com/angular/angular/commit/4e952ba216297eb60fb3bae797b73f5b72c7660b) | feat | add loaders for cloudinary & imagekit ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [e854a8cdde](https://github.com/angular/angular/commit/e854a8cdde0f2fd00e67c0a841c8f6f0abcea18b) | feat | add loading attr to NgOptimizedImage ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [8d3701cb4c](https://github.com/angular/angular/commit/8d3701cb4c167fb8b2153359a71e4f222d3d5657) | feat | add warnings re: image distortion ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [d5f7da2120](https://github.com/angular/angular/commit/d5f7da21207f7808dffb3932fa61d22614e6bd57) | feat | define public API surface for NgOptimizedImage directive ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [d3c3426aa4](https://github.com/angular/angular/commit/d3c3426aa41bd4092da3a9dd6951cab63f217db4) | feat | detect LCP images in `NgOptimizedImage` and assert if `priority` is set ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [451b85ca17](https://github.com/angular/angular/commit/451b85ca176e0aeae6358016e2695ea133d9ec56) | feat | explain why width/height is required ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [586274fe65](https://github.com/angular/angular/commit/586274fe65c5184b633e0e5ac12ca91979f138b2) | feat | provide an ability to exclude origins from preconnect checks in NgOptimizedImage ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [57f3386e5b](https://github.com/angular/angular/commit/57f3386e5b5a3d6edc9e6d8c60b442b16e5c4a20) | feat | support custom srcset attributes in NgOptimizedImage ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [7baf9a46cd](https://github.com/angular/angular/commit/7baf9a46cde2eb2d923c6b2d5e6afb51de9e3f2b) | feat | verify that priority images have preconnect links ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [f81765b333](https://github.com/angular/angular/commit/f81765b333881bd156383d81be62c06ff00380c1) | feat | warn if rendered size is much smaller than intrinsic ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [801daf82d1](https://github.com/angular/angular/commit/801daf82d119a39f21d26812b28c8551c58d841b) | fix | detect `data:` and `blob:` inputs in `NgOptimizedImage` directive ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [1ca2ce19ab](https://github.com/angular/angular/commit/1ca2ce19ab871c76bee3ad67ee9c610284ca9281) | fix | remove default for image width ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [1cf43deb18](https://github.com/angular/angular/commit/1cf43deb1899440c0bd468f8bf31390d4f23d678) | fix | sanitize `rawSrc` and `rawSrcset` values in NgOptimizedImage directive ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [d71dfe931f](https://github.com/angular/angular/commit/d71dfe931f71bff71e4e7af96aebd59f31cd4079) | fix | set bound width and height onto host element ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [ae4405f0bf](https://github.com/angular/angular/commit/ae4405f0bf1c94fe86d9e9a62360834e80cef8e7) | fix | throw if srcset is used with rawSrc ([#47082](https://github.com/angular/angular/pull/47082)) |\n-| [0c8eb8bc82](https://github.com/angular/angular/commit/0c8eb8bc82c26596092d4774fcdac255aecdec90) | perf | monitor LCP only for images without `priority` attribute ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [d5f7da2120](https://github.com/angular/angular/commit/d5f7da21207f7808dffb3932fa61d22614e6bd57) | feat | introduce the NgOptimizedImage directive ([#47082](https://github.com/angular/angular/pull/47082)) |\n ### compiler\n | Commit | Type | Description |\n | -- | -- | -- |\n@@ -3290,4 +3270,4 @@ This release contains the same set the of changes as 11.2.0-next.1.\n ### Code Refactoring\n \n * **compiler:** remove support for TypeScript 3.9 ([#39313](https://github.com/angular/angular/issues/39313)) ([736e064](https://github.com/angular/angular/commit/736e0644b02bc4606a7ae0c974d1b06e993708f6))\n-* **router:** adjust type of parameter in `navigateByUrl` and `createUrlTree` to be more accurate ([#38227](https://github.com/angular/angular/issues/38227)) ([e4f4d18](https://github.com/angular/angular/commit/e4f4d18)), closes [#18798](https://github.com/angular/angular/issues/18798)\n\\ No newline at end of file\n+* **router:** adjust type of parameter in `navigateByUrl` and `createUrlTree` to be more accurate ([#38227](https://github.com/angular/angular/issues/38227)) ([e4f4d18](https://github.com/angular/angular/commit/e4f4d18)), closes [#18798](https://github.com/angular/angular/issues/18798)\n\n\n###\n\n", "completion": "docs: update CHANGELOG after the 14.2.0-rc.0 release (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/service-worker/index.md | file path B: goldens/public-api/service-worker/index.md\n\n@@ -8,6 +8,17 @@ import * as i0 from '@angular/core';\n import { ModuleWithProviders } from '@angular/core';\n import { Observable } from 'rxjs';\n \n+// @public\n+export interface NoNewVersionDetectedEvent {\n+    // (undocumented)\n+    type: 'NO_NEW_VERSION_DETECTED';\n+    // (undocumented)\n+    version: {\n+        hash: string;\n+        appData?: Object;\n+    };\n+}\n+\n // @public (undocumented)\n export class ServiceWorkerModule {\n     static register(script: string, opts?: SwRegistrationOptions): ModuleWithProviders<ServiceWorkerModule>;\n\n\n###\n\n", "completion": "fix(service-worker): update golden `index.md` (#<issue-num>)"}
{"prompt": " file path A: packages/service-worker/src/index.ts | file path B: packages/service-worker/src/index.ts\n\n@@ -14,7 +14,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-export {UnrecoverableStateEvent, UpdateActivatedEvent, UpdateAvailableEvent, VersionDetectedEvent, VersionEvent, VersionInstallationFailedEvent, VersionReadyEvent, NoNewVersionDetectedEvent} from './low_level';\n+export {NoNewVersionDetectedEvent, UnrecoverableStateEvent, UpdateActivatedEvent, UpdateAvailableEvent, VersionDetectedEvent, VersionEvent, VersionInstallationFailedEvent, VersionReadyEvent} from './low_level';\n export {ServiceWorkerModule, SwRegistrationOptions} from './module';\n export {SwPush} from './push';\n export {SwUpdate} from './update';\n\n\n###\n\n", "completion": "refactor(service-worker): formatting of index.ts (#<issue-num>)"}
{"prompt": " file path A: packages/service-worker/src/index.ts | file path B: packages/service-worker/src/index.ts\n\n@@ -14,7 +14,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-export {UnrecoverableStateEvent, UpdateActivatedEvent, UpdateAvailableEvent, VersionDetectedEvent, VersionEvent, VersionInstallationFailedEvent, VersionReadyEvent,} from './low_level';\n+export {UnrecoverableStateEvent, UpdateActivatedEvent, UpdateAvailableEvent, VersionDetectedEvent, VersionEvent, VersionInstallationFailedEvent, VersionReadyEvent, NoNewVersionDetectedEvent} from './low_level';\n export {ServiceWorkerModule, SwRegistrationOptions} from './module';\n export {SwPush} from './push';\n export {SwUpdate} from './update';\n\n\n###\n\n", "completion": "fix(service-worker): export NoNewVersionDetectedEvent (#<issue-num>)"}
{"prompt": " file path A: packages/circular-deps-test.conf.js | file path B: packages/circular-deps-test.conf.js\n\n@@ -9,12 +9,13 @@\n const path = require('path');\n \n module.exports = {\n-  baseDir: '../',\n-  goldenFile: '../goldens/circular-deps/packages.json',\n-  glob: `./**/*.ts`,\n+  baseDir : '../',\n+  goldenFile : '../goldens/circular-deps/packages.json',\n+  glob : `./**/*.ts`,\n   // Command that will be displayed if the golden needs to be updated.\n-  approveCommand: 'yarn ts-circular-deps:approve',\n-  resolveModule: resolveModule\n+  approveCommand : 'yarn ts-circular-deps:approve',\n+  resolveModule : resolveModule,\n+  ignoreTypeOnlyChecks : true,\n };\n \n /**\n\n\n###\n\n", "completion": "build: ignore type only imports/exports for circular dependency checks (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,51 @@\n+<a name=\"14.2.0-rc.0\"></a>\n+# 14.2.0-rc.0 (2022-08-17)\n+### common\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [b380fdd59e](https://github.com/angular/angular/commit/b380fdd59e368e89908ea915f150cdc9f5a87a7f) | feat | add a density cap for image srcsets ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [7ce497e5bc](https://github.com/angular/angular/commit/7ce497e5bc6502bed8099d2592888f3164cdcf1f) | feat | add built-in Imgix loader ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [bff870db61](https://github.com/angular/angular/commit/bff870db6146850248597889550f676d81a85c90) | feat | add cloudflare loader ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [86e77a5d55](https://github.com/angular/angular/commit/86e77a5d559eddb285e74cc34c0db73de5645022) | feat | add Image directive skeleton ([#45627](https://github.com/angular/angular/pull/45627)) ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [0566205a02](https://github.com/angular/angular/commit/0566205a02c5dc87a01a0aa40cb5cdf147c81f11) | feat | Add image lazy loading and fetchpriority ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [4e952ba216](https://github.com/angular/angular/commit/4e952ba216297eb60fb3bae797b73f5b72c7660b) | feat | add loaders for cloudinary & imagekit ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [e854a8cdde](https://github.com/angular/angular/commit/e854a8cdde0f2fd00e67c0a841c8f6f0abcea18b) | feat | add loading attr to NgOptimizedImage ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [8d3701cb4c](https://github.com/angular/angular/commit/8d3701cb4c167fb8b2153359a71e4f222d3d5657) | feat | add warnings re: image distortion ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [d5f7da2120](https://github.com/angular/angular/commit/d5f7da21207f7808dffb3932fa61d22614e6bd57) | feat | define public API surface for NgOptimizedImage directive ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [d3c3426aa4](https://github.com/angular/angular/commit/d3c3426aa41bd4092da3a9dd6951cab63f217db4) | feat | detect LCP images in `NgOptimizedImage` and assert if `priority` is set ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [451b85ca17](https://github.com/angular/angular/commit/451b85ca176e0aeae6358016e2695ea133d9ec56) | feat | explain why width/height is required ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [586274fe65](https://github.com/angular/angular/commit/586274fe65c5184b633e0e5ac12ca91979f138b2) | feat | provide an ability to exclude origins from preconnect checks in NgOptimizedImage ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [57f3386e5b](https://github.com/angular/angular/commit/57f3386e5b5a3d6edc9e6d8c60b442b16e5c4a20) | feat | support custom srcset attributes in NgOptimizedImage ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [7baf9a46cd](https://github.com/angular/angular/commit/7baf9a46cde2eb2d923c6b2d5e6afb51de9e3f2b) | feat | verify that priority images have preconnect links ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [f81765b333](https://github.com/angular/angular/commit/f81765b333881bd156383d81be62c06ff00380c1) | feat | warn if rendered size is much smaller than intrinsic ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [801daf82d1](https://github.com/angular/angular/commit/801daf82d119a39f21d26812b28c8551c58d841b) | fix | detect `data:` and `blob:` inputs in `NgOptimizedImage` directive ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [1ca2ce19ab](https://github.com/angular/angular/commit/1ca2ce19ab871c76bee3ad67ee9c610284ca9281) | fix | remove default for image width ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [1cf43deb18](https://github.com/angular/angular/commit/1cf43deb1899440c0bd468f8bf31390d4f23d678) | fix | sanitize `rawSrc` and `rawSrcset` values in NgOptimizedImage directive ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [d71dfe931f](https://github.com/angular/angular/commit/d71dfe931f71bff71e4e7af96aebd59f31cd4079) | fix | set bound width and height onto host element ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [ae4405f0bf](https://github.com/angular/angular/commit/ae4405f0bf1c94fe86d9e9a62360834e80cef8e7) | fix | throw if srcset is used with rawSrc ([#47082](https://github.com/angular/angular/pull/47082)) |\n+| [0c8eb8bc82](https://github.com/angular/angular/commit/0c8eb8bc82c26596092d4774fcdac255aecdec90) | perf | monitor LCP only for images without `priority` attribute ([#47082](https://github.com/angular/angular/pull/47082)) |\n+### compiler\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [dc52cef26b](https://github.com/angular/angular/commit/dc52cef26b5b1be3acd8ee219ca7a6d33b10228a) | fix | infinite loop in parser assignment expression with invalid left-hand expression ([#47151](https://github.com/angular/angular/pull/47151)) |\n+### core\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [31429eaccc](https://github.com/angular/angular/commit/31429eaccc973672efb4ed98a628cf9842e24b02) | feat | support TypeScript 4.8 ([#47038](https://github.com/angular/angular/pull/47038)) |\n+### forms\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [b302797de4](https://github.com/angular/angular/commit/b302797de47409b988ad77e87f766a5f18374ded) | fix | Correctly infer `FormBuilder` types involving `[value, validators]` shorthand in more cases. ([#47034](https://github.com/angular/angular/pull/47034)) |\n+### router\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [75df404467](https://github.com/angular/angular/commit/75df4044675c61d2b646437cfe64fe828a39b3a0) | feat | Create APIs for using Router without RouterModule ([#47010](https://github.com/angular/angular/pull/47010)) |\n+| [422323cee0](https://github.com/angular/angular/commit/422323cee00192239d1ab279e6a7c3a808098169) | feat | improve typings for RouterLink boolean inputs ([#47101](https://github.com/angular/angular/pull/47101)) |\n+## Special Thanks\n+AlirezaEbrahimkhani, Alma Eyre, Andrew Kushnir, Andrew Scott, Bob Watson, Dylan Hunn, Emmanuel Roux, George Kalpakas, Kalbarczyk, Kara Erickson, Katie Hempenius, Kristiyan Kostadinov, Leosvel P\u00e9rez Espinosa, Paul Gschwendtner, Pawel Kozlowski, Roman Matusevich and Sonu Kapoor\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"14.1.3\"></a>\n # 14.1.3 (2022-08-17)\n ### compiler\n\n\n###\n\n", "completion": "docs: release notes for the v14.2.0-rc.0 release"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,14 @@\n+<a name=\"14.1.3\"></a>\n+# 14.1.3 (2022-08-17)\n+### compiler\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [0583227708](https://github.com/angular/angular/commit/05832277089f9df9cde424d62033661620826592) | fix | infinite loop in parser assignment expression with invalid left-hand expression ([#47151](https://github.com/angular/angular/pull/47151)) |\n+## Special Thanks\n+AlirezaEbrahimkhani, Alma Eyre, Andrew Scott, Bob Watson, George Kalpakas, Kalbarczyk, Kristiyan Kostadinov, Leosvel P\u00e9rez Espinosa, Roman Matusevich and Sonu Kapoor\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"14.1.2\"></a>\n # 14.1.2 (2022-08-10)\n ### core\n\n\n###\n\n", "completion": "docs: release notes for the v14.1.3 release"}
{"prompt": " file path A: packages/forms/src/form_builder.ts | file path B: packages/forms/src/form_builder.ts\n\n@@ -23,6 +23,21 @@ function isAbstractControlOptions(options: AbstractControlOptions|{[key: string]\n        (options as AbstractControlOptions).updateOn !== undefined);\n }\n \n+/**\n+ * The union of all validator types that can be accepted by a ControlConfig.\n+ */\n+type ValidatorConfig = ValidatorFn|AsyncValidatorFn|ValidatorFn[]|AsyncValidatorFn[];\n+\n+/**\n+ * The compiler may not always be able to prove that the elements of the control config are a tuple\n+ * (i.e. occur in a fixed order). This slightly looser type is used for inference, to catch cases\n+ * where the compiler cannot prove order and position.\n+ *\n+ * For example, consider the simple case `fb.group({foo: ['bar', Validators.required]})`. The\n+ * compiler will infer this as an array, not as a tuple.\n+ */\n+type PermissiveControlConfig<T> = Array<T|FormControlState<T>|ValidatorConfig>;\n+\n /**\n  * ControlConfig<T> is a tuple containing a value of type T, plus optional validators and async\n  * validators.\n@@ -31,7 +46,6 @@ function isAbstractControlOptions(options: AbstractControlOptions|{[key: string]\n  */\n export type ControlConfig<T> = [T|FormControlState<T>, (ValidatorFn|(ValidatorFn[]))?, (AsyncValidatorFn|AsyncValidatorFn[])?];\n \n-\n // Disable clang-format to produce clearer formatting for this multiline type.\n // clang-format off\n \n@@ -68,12 +82,7 @@ export type \u0275Element<T, N extends null> =\n   // FormControlState object container, which produces a nullable control.\n   [T] extends [FormControlState<infer U>] ? FormControl<U|N> :\n   // A ControlConfig tuple, which produces a nullable control.\n-  [T] extends [ControlConfig<infer U>] ? FormControl<U|N> :\n-  // ControlConfig can be too much for the compiler to infer in the wrapped case. This is\n-  // not surprising, since it's practically death-by-polymorphism (e.g. the optional validators\n-  // members that might be arrays). Watch for ControlConfigs that might fall through.\n-  [T] extends [Array<infer U|ValidatorFn|ValidatorFn[]|AsyncValidatorFn|AsyncValidatorFn[]>] ? FormControl<U|N> :\n-  // Fallthough case: T is not a container type; use it directly as a value.\n+  [T] extends [PermissiveControlConfig<infer U>] ? FormControl<Exclude<U, ValidatorConfig>|N> :\n   FormControl<T|N>;\n \n // clang-format on\n\n---\n file path A: packages/forms/test/typed_integration_spec.ts | file path B: packages/forms/test/typed_integration_spec.ts\n\n@@ -1019,6 +1019,16 @@ describe('Typed Class', () => {\n           t1 = null as unknown as RawValueType;\n         }\n       });\n+\n+      it('with array values', () => {\n+        const c = fb.control([1, 2, 3]);\n+        {\n+          type RawValueType = number[]|null;\n+          let t: RawValueType = c.getRawValue();\n+          let t1 = c.getRawValue();\n+          t1 = null as unknown as RawValueType;\n+        }\n+      });\n     });\n \n     describe('should build FormGroups', () => {\n@@ -1060,6 +1070,16 @@ describe('Typed Class', () => {\n         }\n       });\n \n+      it('from objects with FormControlStates nested inside ControlConfigs', () => {\n+        const c = fb.group({foo: [{value: 'bar', disabled: true}, Validators.required]});\n+        {\n+          type ControlsType = {foo: FormControl<string|null>};\n+          let t: ControlsType = c.controls;\n+          let t1 = c.controls;\n+          t1 = null as unknown as ControlsType;\n+        }\n+      });\n+\n       it('from objects with ControlConfigs and validators', () => {\n         const c = fb.group({foo: ['bar', Validators.required]});\n         {\n@@ -1068,6 +1088,23 @@ describe('Typed Class', () => {\n           let t1 = c.controls;\n           t1 = null as unknown as ControlsType;\n         }\n+\n+        const c2 = fb.group({foo: [[1, 2, 3], Validators.required]});\n+        {\n+          type ControlsType = {foo: FormControl<number[]|null>};\n+          let t: ControlsType = c2.controls;\n+          let t1 = c2.controls;\n+          t1 = null as unknown as ControlsType;\n+        }\n+        expect(c2.controls.foo.value).toEqual([1, 2, 3]);\n+\n+        const c3 = fb.group({foo: [null, Validators.required]});\n+        {\n+          type ControlsType = {foo: FormControl<null>};\n+          let t: ControlsType = c3.controls;\n+          let t1 = c3.controls;\n+          t1 = null as unknown as ControlsType;\n+        }\n       });\n \n       it('from objects with ControlConfigs and validator lists', () => {\n@@ -1482,6 +1519,15 @@ describe('Typed Class', () => {\n         }\n         c.reset();\n         expect(c.value).toEqual({foo: 'bar'});\n+\n+        const c2 = fb.group({foo: [[1, 2, 3], Validators.required]});\n+        {\n+          type ControlsType = {foo: FormControl<number[]>};\n+          let t: ControlsType = c2.controls;\n+          let t1 = c2.controls;\n+          t1 = null as unknown as ControlsType;\n+        }\n+        expect(c2.controls.foo.value).toEqual([1, 2, 3]);\n       });\n \n       it('from objects with ControlConfigs and validator lists', () => {\n\n\n###\n\n", "completion": "fix(forms): Correctly infer `FormBuilder` types involving `[value, validators]` shorthand in more cases. (#<issue-num>)"}
{"prompt": " file path A: packages/compiler/src/expression_parser/parser.ts | file path B: packages/compiler/src/expression_parser/parser.ts\n\n@@ -586,10 +586,18 @@ export class _ParseAST {\n         while (this.consumeOptionalCharacter(chars.$SEMICOLON)) {\n         }  // read all semicolons\n       } else if (this.index < this.tokens.length) {\n+        const errorIndex = this.index;\n         this.error(`Unexpected token '${this.next}'`);\n+        // The `error` call above will skip ahead to the next recovery point in an attempt to\n+        // recover part of the expression, but that might be the token we started from which will\n+        // lead to an infinite loop. If that's the case, break the loop assuming that we can't\n+        // parse further.\n+        if (this.index === errorIndex) {\n+          break;\n+        }\n       }\n     }\n-    if (exprs.length == 0) {\n+    if (exprs.length === 0) {\n       // We have no expressions so create an empty expression that spans the entire input length\n       const artificialStart = this.offset;\n       const artificialEnd = this.offset + this.input.length;\n\n---\n file path A: packages/compiler/test/expression_parser/parser_spec.ts | file path B: packages/compiler/test/expression_parser/parser_spec.ts\n\n@@ -321,6 +321,15 @@ describe('parser', () => {\n           expect(ast.errors.length).toBe(1);\n           expect(ast.errors[0].message).toContain('Unexpected token \\'=\\'');\n         });\n+\n+        it('should recover on parenthesized empty rvalues', () => {\n+          const ast = parseAction('(a[1] = b) = c = d');\n+          expect(unparse(ast)).toEqual('a[1] = b');\n+          validate(ast);\n+\n+          expect(ast.errors.length).toBe(1);\n+          expect(ast.errors[0].message).toContain('Unexpected token \\'=\\'');\n+        });\n       });\n     });\n \n\n\n###\n\n", "completion": "fix(compiler): infinite loop in parser assignment expression with invalid left-hand expression (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/lcp_image_observer.ts | file path B: packages/common/src/directives/ng_optimized_image/lcp_image_observer.ts\n\n@@ -57,7 +57,9 @@ export class LCPImageObserver implements OnDestroy {\n       // a page, by virtue of being the only thing on the page so far, is often a LCP candidate\n       // and gets reported by PerformanceObserver, but isn't necessarily the LCP element.\n       const lcpElement = entries[entries.length - 1];\n-      // Cast to `any` due to missing `element` on observed type of entry.\n+\n+      // Cast to `any` due to missing `element` on the `LargestContentfulPaint` type of entry.\n+      // See https://developer.mozilla.org/en-US/docs/Web/API/LargestContentfulPaint\n       const imgSrc = (lcpElement as any).element?.src ?? '';\n \n       // Exclude `data:` and `blob:` URLs, since they are not supported by the directive.\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -277,7 +277,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n         // Monitor whether an image is an LCP element only in case\n         // the `priority` attribute is missing. Otherwise, an image\n         // has the necessary settings and no extra checks are required.\n-        withLCPImageObserver(\n+        invokeLCPImageObserverCallback(\n             this.injector,\n             (observer: LCPImageObserver) =>\n                 observer.registerImage(this.getRewrittenSrc(), this.rawSrc));\n@@ -345,7 +345,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   ngOnDestroy() {\n     if (ngDevMode) {\n       if (!this.priority && this._renderedSrc !== null) {\n-        withLCPImageObserver(\n+        invokeLCPImageObserverCallback(\n             this.injector,\n             (observer: LCPImageObserver) => observer.unregisterImage(this._renderedSrc!));\n       }\n@@ -383,7 +383,7 @@ function inputToBoolean(value: unknown): boolean {\n  *   NgZone to make sure none of the calls inside the `LCPImageObserver` class trigger unnecessary\n  *   change detection\n  */\n-function withLCPImageObserver(\n+function invokeLCPImageObserverCallback(\n     injector: Injector, operation: (observer: LCPImageObserver) => void): void {\n   const ngZone = injector.get(NgZone);\n   return ngZone.runOutsideAngular(() => {\n\n---\n file path A: packages/core/test/bundling/image-directive/BUILD.bazel | file path B: packages/core/test/bundling/image-directive/BUILD.bazel\n\n@@ -68,7 +68,7 @@ ts_devserver(\n ts_library(\n     name = \"img_dir_e2e_tests_lib\",\n     testonly = True,\n-    srcs = [\"e2e/util.ts\"] + glob([\n+    srcs = [\"e2e/browser-logs-util.ts\"] + glob([\n         \"e2e/**/*.e2e-spec.ts\",\n     ]),\n     tsconfig = \":e2e/tsconfig-e2e.json\",\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/basic/basic.e2e-spec.ts | file path B: packages/core/test/bundling/image-directive/e2e/basic/basic.e2e-spec.ts\n\n@@ -9,7 +9,7 @@\n import {browser, by, element} from 'protractor';\n import {logging} from 'selenium-webdriver';\n \n-import {collectBrowserLogs} from '../util';\n+import {collectBrowserLogs} from '../browser-logs-util';\n \n describe('NgOptimizedImage directive', () => {\n   it('should render an image with an updated `src`', async () => {\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/util.ts | file path B: packages/core/test/bundling/image-directive/e2e/browser-logs-util.ts\n\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/image-distortion/image-distortion.e2e-spec.ts | file path B: packages/core/test/bundling/image-directive/e2e/image-distortion/image-distortion.e2e-spec.ts\n\n@@ -10,7 +10,7 @@\n import {browser, by, element, ExpectedConditions} from 'protractor';\n import {logging} from 'selenium-webdriver';\n \n-import {collectBrowserLogs} from '../util';\n+import {collectBrowserLogs} from '../browser-logs-util';\n \n describe('NgOptimizedImage directive', () => {\n   it('should not warn if there is no image distortion', async () => {\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/lcp-check/lcp-check.e2e-spec.ts | file path B: packages/core/test/bundling/image-directive/e2e/lcp-check/lcp-check.e2e-spec.ts\n\n@@ -10,7 +10,7 @@\n import {browser, by, element} from 'protractor';\n import {logging} from 'selenium-webdriver';\n \n-import {collectBrowserLogs} from '../util';\n+import {collectBrowserLogs} from '../browser-logs-util';\n \n describe('NgOptimizedImage directive', () => {\n   it('should log a warning when a `priority` is missing on an LCP image', async () => {\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/oversized-image/oversized-image.e2e-spec.ts | file path B: packages/core/test/bundling/image-directive/e2e/oversized-image/oversized-image.e2e-spec.ts\n\n@@ -10,7 +10,7 @@\n import {browser, by, element, ExpectedConditions} from 'protractor';\n import {logging} from 'selenium-webdriver';\n \n-import {collectBrowserLogs} from '../util';\n+import {collectBrowserLogs} from '../browser-logs-util';\n \n describe('NgOptimizedImage directive', () => {\n   it('should not warn if there is no oversized image', async () => {\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/preconnect-check/preconnect-check.e2e-spec.ts | file path B: packages/core/test/bundling/image-directive/e2e/preconnect-check/preconnect-check.e2e-spec.ts\n\n@@ -10,7 +10,7 @@\n import {browser, by, element, ElementHelper} from 'protractor';\n import {logging} from 'selenium-webdriver';\n \n-import {collectBrowserLogs} from '../util';\n+import {collectBrowserLogs} from '../browser-logs-util';\n \n // Verifies that both images used in a component were rendered.\n async function verifyImagesPresent(element: ElementHelper) {\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/start-server.js | file path B: packages/core/test/bundling/image-directive/e2e/start-server.js\n\n@@ -9,6 +9,10 @@\n const protractorUtils = require('@bazel/protractor/protractor-utils');\n const protractor = require('protractor');\n \n+/**\n+ * Helper function to start up a server for testing using Protractor utils.\n+ * Used as a part of the `protractor_web_test_suite` rule configuration.\n+ */\n module.exports = async function(config) {\n   const {port} = await protractorUtils.runServer(config.workspace, config.server, '-port', []);\n   const serverUrl = `http://localhost:${port}`;\n\n\n###\n\n", "completion": "refactor(common): minor NgOptimizedImage directive updates (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/errors.md | file path B: goldens/public-api/common/errors.md\n\n@@ -19,6 +19,8 @@ export const enum RuntimeErrorCode {\n     // (undocumented)\n     NG_FOR_MISSING_DIFFER = -2200,\n     // (undocumented)\n+    OVERSIZED_IMAGE = 2960,\n+    // (undocumented)\n     PARENT_NG_SWITCH_NOT_FOUND = 2000,\n     // (undocumented)\n     PRIORITY_IMG_MISSING_PRECONNECT_TAG = 2956,\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -54,6 +54,13 @@ export const RECOMMENDED_SRCSET_DENSITY_CAP = 2;\n  */\n const ASPECT_RATIO_TOLERANCE = .1;\n \n+/**\n+ * Used to determine whether the image has been requested at an overly\n+ * large size compared to the actual rendered image size (after taking\n+ * into account a typical device pixel ratio). In pixels.\n+ */\n+const OVERSIZED_IMAGE_TOLERANCE = 1000;\n+\n /**\n  * Directive that improves image loading performance by enforcing best practices.\n  *\n@@ -587,6 +594,7 @@ function assertNoImageDistortion(\n         Math.abs(suppliedAspectRatio - intrinsicAspectRatio) > ASPECT_RATIO_TOLERANCE;\n     const stylingDistortion = nonZeroRenderedDimensions &&\n         Math.abs(intrinsicAspectRatio - renderedAspectRatio) > ASPECT_RATIO_TOLERANCE;\n+\n     if (inaccurateDimensions) {\n       console.warn(formatRuntimeError(\n           RuntimeErrorCode.INVALID_INPUT,\n@@ -596,20 +604,36 @@ function assertNoImageDistortion(\n               `(aspect-ratio: ${intrinsicAspectRatio}). Supplied width and height attributes: ` +\n               `${suppliedWidth}w x ${suppliedHeight}h (aspect-ratio: ${suppliedAspectRatio}). ` +\n               `To fix this, update the width and height attributes.`));\n-    } else {\n-      if (stylingDistortion) {\n+    } else if (stylingDistortion) {\n+      console.warn(formatRuntimeError(\n+          RuntimeErrorCode.INVALID_INPUT,\n+          `${imgDirectiveDetails(dir.rawSrc)} the aspect ratio of the rendered image ` +\n+              `does not match the image's intrinsic aspect ratio. ` +\n+              `Intrinsic image size: ${intrinsicWidth}w x ${intrinsicHeight}h ` +\n+              `(aspect-ratio: ${intrinsicAspectRatio}). Rendered image size: ` +\n+              `${renderedWidth}w x ${renderedHeight}h (aspect-ratio: ` +\n+              `${renderedAspectRatio}). This issue can occur if \"width\" and \"height\" ` +\n+              `attributes are added to an image without updating the corresponding ` +\n+              `image styling. To fix this, adjust image styling. In most cases, ` +\n+              `adding \"height: auto\" or \"width: auto\" to the image styling will fix ` +\n+              `this issue.`));\n+    } else if (!dir.rawSrcset && nonZeroRenderedDimensions) {\n+      // If `rawSrcset` hasn't been set, sanity check the intrinsic size.\n+      const recommendedWidth = RECOMMENDED_SRCSET_DENSITY_CAP * renderedWidth;\n+      const recommendedHeight = RECOMMENDED_SRCSET_DENSITY_CAP * renderedHeight;\n+      const oversizedWidth = (intrinsicWidth - recommendedWidth) >= OVERSIZED_IMAGE_TOLERANCE;\n+      const oversizedHeight = (intrinsicHeight - recommendedHeight) >= OVERSIZED_IMAGE_TOLERANCE;\n+      if (oversizedWidth || oversizedHeight) {\n         console.warn(formatRuntimeError(\n-            RuntimeErrorCode.INVALID_INPUT,\n-            `${imgDirectiveDetails(dir.rawSrc)} the aspect ratio of the rendered image ` +\n-                `does not match the image's intrinsic aspect ratio. ` +\n-                `Intrinsic image size: ${intrinsicWidth}w x ${intrinsicHeight}h ` +\n-                `(aspect-ratio: ${intrinsicAspectRatio}). Rendered image size: ` +\n-                `${renderedWidth}w x ${renderedHeight}h (aspect-ratio: ` +\n-                `${renderedAspectRatio}). This issue can occur if \"width\" and \"height\" ` +\n-                `attributes are added to an image without updating the corresponding ` +\n-                `image styling. To fix this, adjust image styling. In most cases, ` +\n-                `adding \"height: auto\" or \"width: auto\" to the image styling will fix ` +\n-                `this issue.`));\n+            RuntimeErrorCode.OVERSIZED_IMAGE,\n+            `${imgDirectiveDetails(dir.rawSrc)} the intrinsic image is significantly ` +\n+                `larger than necessary. ` +\n+                `Rendered image size: ${renderedWidth}w x ${renderedHeight}h. ` +\n+                `Intrinsic image size: ${intrinsicWidth}w x ${intrinsicHeight}h. ` +\n+                `Recommended intrinsic image size: ${recommendedWidth}w x ${recommendedHeight}h. ` +\n+                `Note: Recommended intrinsic image size is calculated assuming a maximum DPR of ` +\n+                `${RECOMMENDED_SRCSET_DENSITY_CAP}. To improve loading time, resize the image ` +\n+                `or consider using the \"rawSrcset\" and \"sizes\" attributes.`));\n       }\n     }\n   });\n\n---\n file path A: packages/common/src/errors.ts | file path B: packages/common/src/errors.ts\n\n@@ -31,4 +31,5 @@ export const enum RuntimeErrorCode {\n   INVALID_PRECONNECT_CHECK_BLOCKLIST = 2957,\n   UNEXPECTED_DEV_MODE_CHECK_IN_PROD_MODE = 2958,\n   INVALID_LOADER_ARGUMENTS = 2959,\n+  OVERSIZED_IMAGE = 2960,\n }\n\n---\n file path A: packages/core/test/bundling/image-directive/BUILD.bazel | file path B: packages/core/test/bundling/image-directive/BUILD.bazel\n\n@@ -8,6 +8,7 @@ ng_module(\n         \"e2e/basic/basic.ts\",\n         \"e2e/image-distortion/image-distortion.ts\",\n         \"e2e/lcp-check/lcp-check.ts\",\n+        \"e2e/oversized-image/oversized-image.ts\",\n         \"e2e/preconnect-check/preconnect-check.ts\",\n         \"index.ts\",\n         \"playground.ts\",\n@@ -59,6 +60,7 @@ ts_devserver(\n         \"e2e/a.png\",\n         \"e2e/b.png\",\n         \"e2e/logo-500w.jpg\",\n+        \"e2e/logo-1500w.jpg\",\n     ],\n     deps = [\":image-directive\"],\n )\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/image-distortion/image-distortion.ts | file path B: packages/core/test/bundling/image-directive/e2e/image-distortion/image-distortion.ts\n\n@@ -18,7 +18,7 @@ import {Component} from '@angular/core';\n      <!-- This image is here for the sake of making sure the \"LCP image is priority\" assertion is passed -->\n      <img rawSrc=\"/e2e/logo-500w.jpg\" width=\"500\" height=\"500\" priority>\n      <br>\n-     <!-- width and height attributes exacly match the intrinsic size of image -->\n+     <!-- width and height attributes exactly match the intrinsic size of image -->\n      <img rawSrc=\"/e2e/a.png\" width=\"25\" height=\"25\">\n      <br>\n      <!-- supplied aspect ratio exactly matches intrinsic aspect ratio-->\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/logo-1500w.jpg | file path B: packages/core/test/bundling/image-directive/e2e/logo-1500w.jpg\n\nBinary files /dev/null and b/packages/core/test/bundling/image-directive/e2e/logo-1500w.jpg differ\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/logo-500w.jpg | file path B: packages/core/test/bundling/image-directive/e2e/logo-500w.jpg\n\nBinary files a/packages/core/test/bundling/image-directive/e2e/logo-500w.jpg and b/packages/core/test/bundling/image-directive/e2e/logo-500w.jpg differ\n\n---\n file path A: None | file path B: packages/core/test/bundling/image-directive/e2e/oversized-image/oversized-image.e2e-spec.ts\n\n@@ -0,0 +1,31 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+/* tslint:disable:no-console  */\n+import {browser, by, element, ExpectedConditions} from 'protractor';\n+import {logging} from 'selenium-webdriver';\n+\n+import {collectBrowserLogs} from '../util';\n+\n+describe('NgOptimizedImage directive', () => {\n+  it('should not warn if there is no oversized image', async () => {\n+    await browser.get('/e2e/oversized-image-passing');\n+    const logs = await collectBrowserLogs(logging.Level.WARNING);\n+    expect(logs.length).toEqual(0);\n+  });\n+\n+  it('should warn if rendered image size is much smaller than intrinsic size', async () => {\n+    await browser.get('/e2e/oversized-image-failing');\n+    const logs = await collectBrowserLogs(logging.Level.WARNING);\n+\n+    expect(logs.length).toEqual(1);\n+\n+    const expectedMessageRegex = /the intrinsic image is significantly larger than necessary\\./;\n+    expect(expectedMessageRegex.test(logs[0].message)).toBeTruthy();\n+  });\n+});\n\n---\n file path A: None | file path B: packages/core/test/bundling/image-directive/e2e/oversized-image/oversized-image.ts\n\n@@ -0,0 +1,44 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {NgOptimizedImage} from '@angular/common';\n+import {Component} from '@angular/core';\n+\n+@Component({\n+  selector: 'oversized-image-passing',\n+  standalone: true,\n+  imports: [NgOptimizedImage],\n+  template: `\n+      <!-- Image is rendered within threshold range-->\n+      <div style=\"width: 500px; height: 500px\">\n+        <img rawSrc=\"/e2e/logo-500w.jpg\" width=\"200\" height=\"200\" priority>\n+      </div>\n+      <!-- Image is rendered too small but rawSrcset set-->\n+      <div style=\"width: 300px; height: 300px\">\n+        <img rawSrc=\"/e2e/logo-1500w.jpg\" width=\"100\" height=\"100\" priority\n+            rawSrcset=\"100w, 200w\">\n+      </div>\n+     `,\n+})\n+export class OversizedImageComponentPassing {\n+}\n+\n+\n+@Component({\n+  selector: 'oversized-image-failing',\n+  standalone: true,\n+  imports: [NgOptimizedImage],\n+  template: `\n+      <!-- Image is rendered too small  -->\n+      <div style=\"width: 300px; height: 300px\">\n+         <img rawSrc=\"/e2e/logo-1500w.jpg\" width=\"100\" height=\"100\" priority>\n+       </div>\n+      `,\n+})\n+export class OversizedImageComponentFailing {\n+}\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/preconnect-check/preconnect-check.e2e-spec.ts | file path B: packages/core/test/bundling/image-directive/e2e/preconnect-check/preconnect-check.e2e-spec.ts\n\n@@ -38,13 +38,14 @@ describe('NgOptimizedImage directive', () => {\n     expect(logs[0].message).toMatch(/NG02956.*?a\\.png/);\n   });\n \n-  it('should not produce any warnings in the console when a preconect tag is present', async () => {\n-    await browser.get('/e2e/preconnect-check?preconnect');\n+  it('should not produce any warnings in the console when a preconnect tag is present',\n+     async () => {\n+       await browser.get('/e2e/preconnect-check?preconnect');\n \n-    await verifyImagesPresent(element);\n+       await verifyImagesPresent(element);\n \n-    // Make sure there are no browser logs.\n-    const logs = await collectBrowserLogs(logging.Level.WARNING);\n-    expect(logs.length).toEqual(0);\n-  });\n+       // Make sure there are no browser logs.\n+       const logs = await collectBrowserLogs(logging.Level.WARNING);\n+       expect(logs.length).toEqual(0);\n+     });\n });\n\n---\n file path A: packages/core/test/bundling/image-directive/index.ts | file path B: packages/core/test/bundling/image-directive/index.ts\n\n@@ -13,6 +13,7 @@ import {RouterModule} from '@angular/router';\n import {BasicComponent} from './e2e/basic/basic';\n import {ImageDistortionFailingComponent, ImageDistortionPassingComponent} from './e2e/image-distortion/image-distortion';\n import {LcpCheckComponent} from './e2e/lcp-check/lcp-check';\n+import {OversizedImageComponentFailing, OversizedImageComponentPassing} from './e2e/oversized-image/oversized-image';\n import {PreconnectCheckComponent} from './e2e/preconnect-check/preconnect-check';\n import {PlaygroundComponent} from './playground';\n \n@@ -35,6 +36,8 @@ const ROUTES = [\n   {path: 'e2e/preconnect-check', component: PreconnectCheckComponent},\n   {path: 'e2e/image-distortion-passing', component: ImageDistortionPassingComponent},\n   {path: 'e2e/image-distortion-failing', component: ImageDistortionFailingComponent},\n+  {path: 'e2e/oversized-image-passing', component: OversizedImageComponentPassing},\n+  {path: 'e2e/oversized-image-failing', component: OversizedImageComponentFailing},\n ];\n \n bootstrapApplication(RootComponent, {\n\n---\n file path A: packages/core/test/bundling/image-directive/playground.ts | file path B: packages/core/test/bundling/image-directive/playground.ts\n\n@@ -34,12 +34,12 @@ import {Component} from '@angular/core';\n   `],\n   template: `\n     <h1> \n-      <img rawSrc=\"a.png\" width=\"50\" height=\"50\" priority>\n+      <img rawSrc=\"a.png\" width=\"50\" height=\"50\" priority rawSrcset=\"1x, 2x\">\n       <span>Angular image app</span>\n     </h1>\n     <main>\n       <div class=\"spacer\"></div>\n-      <img rawSrc=\"hermes.jpeg\" rawSrcset=\"100w, 200w, 1000w\" width=\"4030\" height=\"3020\">\n+      <img rawSrc=\"hermes2.jpeg\" rawSrcset=\"100w, 200w, 1000w, 2000w\" width=\"1791\" height=\"1008\">\n     </main>\n   `,\n   standalone: true,\n\n\n###\n\n", "completion": "feat(common): warn if rendered size is much smaller than intrinsic (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/index.md | file path B: goldens/public-api/common/index.md\n\n@@ -536,7 +536,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n     set height(value: string | number | undefined);\n     // (undocumented)\n     get height(): number | undefined;\n-    loading?: string;\n+    loading?: 'lazy' | 'eager' | 'auto';\n     // (undocumented)\n     ngOnChanges(changes: SimpleChanges): void;\n     // (undocumented)\n\n---\n file path A: packages/common/src/common.ts | file path B: packages/common/src/common.ts\n\n@@ -27,4 +27,4 @@ export {PLATFORM_BROWSER_ID as \u0275PLATFORM_BROWSER_ID, PLATFORM_SERVER_ID as \u0275PL\n export {VERSION} from './version';\n export {ViewportScroller, NullViewportScroller as \u0275NullViewportScroller} from './viewport_scroller';\n export {XhrFactory} from './xhr';\n-export * from './directives/ng_optimized_image';\n+export {IMAGE_LOADER, ImageLoader, ImageLoaderConfig, NgOptimizedImage, PRECONNECT_CHECK_BLOCKLIST, provideCloudflareLoader, provideCloudinaryLoader, provideImageKitLoader, provideImgixLoader} from './directives/ng_optimized_image';\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts\n\n@@ -9,10 +9,10 @@\n import {createImageLoader, ImageLoaderConfig} from './image_loader';\n \n /**\n- * Function that generates an ImageLoader for Cloudflare Image Resizing\n- * and turns it into an Angular provider. Note: Cloudflare has multiple image\n- * products - this provider is specifically for Cloudflare Image Resizing;\n- * it will not work with Cloudflare Images or Cloudflare Polish.\n+ * Function that generates an ImageLoader for [Cloudflare Image\n+ * Resizing](https://developers.cloudflare.com/images/image-resizing/) and turns it into an Angular\n+ * provider. Note: Cloudflare has multiple image products - this provider is specifically for\n+ * Cloudflare Image Resizing; it will not work with Cloudflare Images or Cloudflare Polish.\n  *\n  * @param path Your domain name, e.g. https://mysite.com\n  * @param options An object with extra configuration:\n@@ -33,5 +33,7 @@ function createCloudflareUrl(path: string, config: ImageLoaderConfig) {\n   if (config.width) {\n     params += `,width=${config.width}`;\n   }\n+  // Cloudflare image URLs format:\n+  // https://developers.cloudflare.com/images/image-resizing/url-format/\n   return `${path}/cdn-cgi/image/${params}/${config.src}`;\n }\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts\n\n@@ -35,6 +35,8 @@ export const provideCloudinaryLoader = createImageLoader(\n         undefined);\n \n function createCloudinaryUrl(path: string, config: ImageLoaderConfig) {\n+  // Cloudinary image URLformat:\n+  // https://cloudinary.com/documentation/image_transformations#transformation_url_structure\n   // Example of a Cloudinary image URL:\n   // https://res.cloudinary.com/mysite/image/upload/c_scale,f_auto,q_auto,w_600/marketing/tile-topics-m.png\n   let params = `f_auto,q_auto`;  // sets image format and quality to \"auto\"\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts\n\n@@ -15,6 +15,8 @@ import {isAbsoluteUrl, isValidPath, normalizePath, normalizeSrc} from '../url';\n /**\n  * Config options recognized by the image loader function.\n  *\n+ * @see `ImageLoader`\n+ * @see `NgOptimizedImage`\n  * @publicApi\n  * @developerPreview\n  */\n@@ -30,7 +32,8 @@ export interface ImageLoaderConfig {\n }\n \n /**\n- * Represents an image loader function.\n+ * Represents an image loader function. Image loader functions are used by the\n+ * NgOptimizedImage directive to produce full image URL based on the image name and its width.\n  *\n  * @publicApi\n  * @developerPreview\n@@ -40,13 +43,17 @@ export type ImageLoader = (config: ImageLoaderConfig) => string;\n /**\n  * Noop image loader that does no transformation to the original src and just returns it as is.\n  * This loader is used as a default one if more specific logic is not provided in an app config.\n+ *\n+ * @see `ImageLoader`\n+ * @see `NgOptimizedImage`\n  */\n const noopImageLoader = (config: ImageLoaderConfig) => config.src;\n \n /**\n- * Injection token that configures the function that produces image URLs based on the specified\n- * input.\n+ * Injection token that configures the image loader function.\n  *\n+ * @see `ImageLoader`\n+ * @see `NgOptimizedImage`\n  * @publicApi\n  * @developerPreview\n  */\n@@ -55,6 +62,15 @@ export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n   factory: () => noopImageLoader,\n });\n \n+/**\n+ * Internal helper function that makes it easier to introduce custom image loaders for the\n+ * `NgOptimizedImage` directive. It is enough to specify a URL builder function to obtain full DI\n+ * configuration for a given loader: a DI token corresponding to the actual loader function, plus DI\n+ * tokens managing preconnect check functionality.\n+ * @param buildUrlFn a function returning a full URL based on loader's configuration\n+ * @param exampleUrls example of full URLs for a given loader (used in error messages)\n+ * @returns a set of DI providers corresponding to the configured image loader\n+ */\n export function createImageLoader(\n     buildUrlFn: (path: string, config: ImageLoaderConfig) => string, exampleUrls?: string[]) {\n   return function provideImageLoader(\n@@ -62,6 +78,9 @@ export function createImageLoader(\n     if (ngDevMode && !isValidPath(path)) {\n       throwInvalidPathError(path, exampleUrls || []);\n     }\n+\n+    // The trailing / is stripped (if provided) to make URL construction (concatenation) easier in\n+    // the individual loader functions.\n     path = normalizePath(path);\n \n     const loaderFn = (config: ImageLoaderConfig) => {\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -222,7 +222,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n    * Setting images as loading='eager' or loading='auto' marks them\n    * as non-priority images. Avoid changing this input for priority images.\n    */\n-  @Input() loading?: string;\n+  @Input() loading?: 'lazy'|'eager'|'auto';\n \n   /**\n    * Indicates whether this image should have a high priority.\n@@ -276,6 +276,10 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n                 observer.registerImage(this.getRewrittenSrc(), this.rawSrc));\n       }\n     }\n+    this.setHostAttributes();\n+  }\n+\n+  private setHostAttributes() {\n     // Must set width/height explicitly in case they are bound (in which case they will\n     // only be reflected and not found by the browser)\n     this.setHostAttribute('width', this.width!.toString());\n@@ -299,7 +303,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   }\n \n   private getLoadingBehavior(): string {\n-    if (!this.priority && this.loading !== undefined && isNonEmptyString(this.loading)) {\n+    if (!this.priority && this.loading !== undefined) {\n       return this.loading;\n     }\n     return this.priority ? 'eager' : 'lazy';\n@@ -362,12 +366,6 @@ function inputToBoolean(value: unknown): boolean {\n   return value != null && `${value}` !== 'false';\n }\n \n-function isNonEmptyString(value: unknown): boolean {\n-  const isString = typeof value === 'string';\n-  const isEmptyString = isString && value.trim() === '';\n-  return isString && !isEmptyString;\n-}\n-\n /**\n  * Invokes a function, passing an instance of the `LCPImageObserver` as an argument.\n  *\n@@ -429,9 +427,9 @@ function assertNotBase64Image(dir: NgOptimizedImage) {\n     throw new RuntimeError(\n         RuntimeErrorCode.INVALID_INPUT,\n         `${imgDirectiveDetails(dir.rawSrc, false)} \\`rawSrc\\` is a Base64-encoded string ` +\n-            `(${rawSrc}). Base64-encoded strings are not supported by the NgOptimizedImage directive. ` +\n+            `(${rawSrc}). NgOptimizedImage does not support Base64-encoded strings. ` +\n             `To fix this, disable the NgOptimizedImage directive for this element ` +\n-            `by removing \\`rawSrc\\` and using a regular \\`src\\` attribute instead.`);\n+            `by removing \\`rawSrc\\` and using a standard \\`src\\` attribute instead.`);\n   }\n }\n \n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -129,9 +129,9 @@ describe('Image directive', () => {\n           .toThrowError(\n               'NG02952: The NgOptimizedImage directive has detected that `rawSrc` ' +\n               'is a Base64-encoded string (data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDov...). ' +\n-              'Base64-encoded strings are not supported by the NgOptimizedImage directive. ' +\n-              'To fix this, disable the NgOptimizedImage directive for this element by ' +\n-              'removing `rawSrc` and using a regular `src` attribute instead.');\n+              'NgOptimizedImage does not support Base64-encoded strings. ' +\n+              'To fix this, disable the NgOptimizedImage directive for this element ' +\n+              'by removing `rawSrc` and using a standard `src` attribute instead.');\n     });\n \n     it('should throw if `rawSrc` contains a `blob:` URL', (done) => {\n\n\n###\n\n", "completion": "refactor(common): address review feedback for NgOptimizedImage (#<issue-num>)"}
{"prompt": " file path A: None | file path B: packages/common/src/directives/ng_optimized_image/error_helper.ts\n\n@@ -0,0 +1,14 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+// Assembles directive details string, useful for error messages.\n+export function imgDirectiveDetails(rawSrc: string, includeRawSrc = true) {\n+  const rawSrcInfo =\n+      includeRawSrc ? `(activated on an <img> element with the \\`rawSrc=\"${rawSrc}\"\\`) ` : '';\n+  return `The NgOptimizedImage directive ${rawSrcInfo}has detected that`;\n+}\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts\n\n@@ -10,7 +10,7 @@ import {InjectionToken, Provider, \u0275RuntimeError as RuntimeError} from '@angular\n \n import {RuntimeErrorCode} from '../../../errors';\n import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n-import {isAbsoluteURL, isValidPath, normalizePath, normalizeSrc} from '../util';\n+import {isAbsoluteUrl, isValidPath, normalizePath, normalizeSrc} from '../url';\n \n /**\n  * Config options recognized by the image loader function.\n@@ -61,7 +61,7 @@ export function createImageLoader(\n     path = normalizePath(path);\n \n     const loaderFn = (config: ImageLoaderConfig) => {\n-      if (ngDevMode && isAbsoluteURL(config.src)) {\n+      if (ngDevMode && isAbsoluteUrl(config.src)) {\n         throwUnexpectedAbsoluteUrlError(path, config.src);\n       }\n \n\n---\n file path A: packages/common/src/directives/ng_optimized_image/lcp_image_observer.ts | file path B: packages/common/src/directives/ng_optimized_image/lcp_image_observer.ts\n\n@@ -12,7 +12,8 @@ import {DOCUMENT} from '../../dom_tokens';\n import {RuntimeErrorCode} from '../../errors';\n \n import {assertDevMode} from './asserts';\n-import {getUrl, imgDirectiveDetails} from './util';\n+import {imgDirectiveDetails} from './error_helper';\n+import {getUrl} from './url';\n \n /**\n  * Contains the logic to detect whether an image with the `NgOptimizedImage` directive\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -10,10 +10,10 @@ import {Directive, ElementRef, Inject, Injector, Input, NgModule, NgZone, OnChan\n \n import {RuntimeErrorCode} from '../../errors';\n \n+import {imgDirectiveDetails} from './error_helper';\n import {IMAGE_LOADER, ImageLoader} from './image_loaders/image_loader';\n import {LCPImageObserver} from './lcp_image_observer';\n import {PreconnectLinkChecker} from './preconnect_link_checker';\n-import {imgDirectiveDetails} from './util';\n \n /**\n  * When a Base64-encoded image is passed as an input to the `NgOptimizedImage` directive,\n@@ -256,7 +256,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n       assertNoImageDistortion(this, this.imgElement, this.renderer);\n       if (this.priority) {\n         const checker = this.injector.get(PreconnectLinkChecker);\n-        checker.check(this.getRewrittenSrc(), this.rawSrc);\n+        checker.assertPreconnect(this.getRewrittenSrc(), this.rawSrc);\n       } else {\n         // Monitor whether an image is an LCP element only in case\n         // the `priority` attribute is missing. Otherwise, an image\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/preconnect_link_checker.ts | file path B: packages/common/src/directives/ng_optimized_image/preconnect_link_checker.ts\n\n@@ -12,14 +12,15 @@ import {DOCUMENT} from '../../dom_tokens';\n import {RuntimeErrorCode} from '../../errors';\n \n import {assertDevMode} from './asserts';\n-import {deepForEach, extractHostname, getUrl, imgDirectiveDetails} from './util';\n+import {imgDirectiveDetails} from './error_helper';\n+import {extractHostname, getUrl} from './url';\n \n // Set of origins that are always excluded from the preconnect checks.\n const INTERNAL_PRECONNECT_CHECK_BLOCKLIST = new Set(['localhost', '127.0.0.1', '0.0.0.0']);\n \n /**\n  * Multi-provider injection token to configure which origins should be excluded\n- * from the preconnect checks. If can either be a single string or an array of strings\n+ * from the preconnect checks. It can either be a single string or an array of strings\n  * to represent a group of origins, for example:\n  *\n  * ```typescript\n@@ -68,11 +69,11 @@ export class PreconnectLinkChecker {\n       this.window = win;\n     }\n     if (blocklist) {\n-      this.pupulateBlocklist(blocklist);\n+      this.populateBlocklist(blocklist);\n     }\n   }\n \n-  private pupulateBlocklist(origins: Array<string|string[]>) {\n+  private populateBlocklist(origins: Array<string|string[]>) {\n     if (Array.isArray(origins)) {\n       deepForEach(origins, origin => {\n         this.blocklist.add(extractHostname(origin));\n@@ -85,7 +86,14 @@ export class PreconnectLinkChecker {\n     }\n   }\n \n-  check(rewrittenSrc: string, rawSrc: string) {\n+  /**\n+   * Checks that a preconnect resource hint exists in the head fo rthe\n+   * given src.\n+   *\n+   * @param rewrittenSrc src formatted with loader\n+   * @param rawSrc rawSrc value\n+   */\n+  assertPreconnect(rewrittenSrc: string, rawSrc: string): void {\n     if (!this.window) return;\n \n     const imgUrl = getUrl(rewrittenSrc, this.window);\n@@ -94,7 +102,7 @@ export class PreconnectLinkChecker {\n     // Register this origin as seen, so we don't check it again later.\n     this.alreadySeen.add(imgUrl.origin);\n \n-    if (this.preconnectLinks === null) {\n+    if (!this.preconnectLinks) {\n       // Note: we query for preconnect links only *once* and cache the results\n       // for the entire lifespan of an application, since it's unlikely that the\n       // list would change frequently. This allows to make sure there are no\n@@ -114,14 +122,15 @@ export class PreconnectLinkChecker {\n   }\n \n   private queryPreconnectLinks(): Set<string> {\n-    const preconnectURLs = new Set<string>();\n+    const preconnectUrls = new Set<string>();\n     const selector = 'link[rel=preconnect]';\n-    const links = (this.doc.head?.querySelectorAll(selector) ?? []) as unknown as HTMLLinkElement[];\n-    links.forEach(link => {\n+    const links =\n+        Array.from(document.querySelectorAll('link[rel=preconnect]')) as HTMLLinkElement[];\n+    for (let link of links) {\n       const url = getUrl(link.href, this.window!);\n-      preconnectURLs.add(url.origin);\n-    });\n-    return preconnectURLs;\n+      preconnectUrls.add(url.origin);\n+    }\n+    return preconnectUrls;\n   }\n \n   ngOnDestroy() {\n@@ -129,3 +138,11 @@ export class PreconnectLinkChecker {\n     this.alreadySeen.clear();\n   }\n }\n+\n+// Invokes a callback for each element in the array. Also invokes a callback\n+// recursively for each nested array.\n+function deepForEach<T>(input: (T|any[])[], fn: (value: T) => void): void {\n+  for (let value of input) {\n+    Array.isArray(value) ? deepForEach(value, fn) : fn(value);\n+  }\n+}\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/util.ts | file path B: packages/common/src/directives/ng_optimized_image/url.ts\n\n@@ -9,11 +9,11 @@\n // Converts a string that represents a URL into a URL class instance.\n export function getUrl(src: string, win: Window): URL {\n   // Don't use a base URL is the URL is absolute.\n-  return isAbsoluteURL(src) ? new URL(src) : new URL(src, win.location.href);\n+  return isAbsoluteUrl(src) ? new URL(src) : new URL(src, win.location.href);\n }\n \n // Checks whether a URL is absolute (i.e. starts with `http://` or `https://`).\n-export function isAbsoluteURL(src: string): boolean {\n+export function isAbsoluteUrl(src: string): boolean {\n   return /^https?:\\/\\//.test(src);\n }\n \n@@ -33,11 +33,7 @@ export function deepForEach<T>(input: (T|any[])[], fn: (value: T) => void): void\n // Given a URL, extract the hostname part.\n // If a URL is a relative one - the URL is returned as is.\n export function extractHostname(url: string): string {\n-  if (isAbsoluteURL(url)) {\n-    const instance = new URL(url);\n-    return instance.hostname;\n-  }\n-  return url;\n+  return isAbsoluteUrl(url) ? (new URL(url)).hostname : url;\n }\n \n export function isValidPath(path: unknown): boolean {\n@@ -47,6 +43,7 @@ export function isValidPath(path: unknown): boolean {\n     return false;\n   }\n \n+  // Calling new URL() will throw if the path string is malformed\n   try {\n     const url = new URL(path);\n     return true;\n\n---\n file path A: packages/common/test/image_loaders/image_loader_spec.ts | file path B: packages/common/test/image_loaders/image_loader_spec.ts\n\n@@ -11,7 +11,7 @@ import {provideCloudflareLoader} from '@angular/common/src/directives/ng_optimiz\n import {provideCloudinaryLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader';\n import {provideImageKitLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader';\n import {provideImgixLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/imgix_loader';\n-import {isValidPath} from '@angular/common/src/directives/ng_optimized_image/util';\n+import {isValidPath} from '@angular/common/src/directives/ng_optimized_image/url';\n import {createEnvironmentInjector, EnvironmentInjector, ValueProvider} from '@angular/core';\n import {TestBed} from '@angular/core/testing';\n \n\n\n###\n\n", "completion": "refactor(common): clean up util.ts and preconnect_link_checker files (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -267,6 +267,11 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n                 observer.registerImage(this.getRewrittenSrc(), this.rawSrc));\n       }\n     }\n+    // Must set width/height explicitly in case they are bound (in which case they will\n+    // only be reflected and not found by the browser)\n+    this.setHostAttribute('width', this.width!.toString());\n+    this.setHostAttribute('height', this.height!.toString());\n+\n     this.setHostAttribute('loading', this.getLoadingBehavior());\n     this.setHostAttribute('fetchpriority', this.getFetchPriority());\n     // The `src` and `srcset` attributes should be set last since other attributes\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -68,6 +68,19 @@ describe('Image directive', () => {\n     expect(_fetchpriorityAttrId).toBeLessThan(_srcAttrId);  // was set after `src`\n   });\n \n+  it('should always reflect the width/height attributes if bound', () => {\n+    setupTestingModule();\n+\n+    const template = '<img rawSrc=\"path/img.png\" [width]=\"width\" [height]=\"height\">';\n+    const fixture = createTestComponent(template);\n+    fixture.detectChanges();\n+\n+    const nativeElement = fixture.nativeElement as HTMLElement;\n+    const img = nativeElement.querySelector('img')!;\n+    expect(img.getAttribute('width')).toBe('100');\n+    expect(img.getAttribute('height')).toBe('50');\n+  });\n+\n   describe('setup error handling', () => {\n     it('should throw if both `src` and `rawSrc` are present', () => {\n       setupTestingModule();\n\n\n###\n\n", "completion": "fix(common): set bound width and height onto host element (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -587,7 +587,7 @@ function assertNonEmptyWidthAndHeight(dir: NgOptimizedImage) {\n     throw new RuntimeError(\n         RuntimeErrorCode.REQUIRED_INPUT_MISSING,\n         `${imgDirectiveDetails(dir.rawSrc)} these required attributes ` +\n-            `are missing:\\`${missingAttributes.join(',')}\\`. ` +\n+            `are missing: ${missingAttributes.map(attr => `\"${attr}\"`).join(', ')}. ` +\n             `Including \"width\" and \"height\" attributes will prevent image-related layout shifts. ` +\n             `To fix this, include \"width\" and \"height\" attributes on the image tag.`);\n   }\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -148,6 +148,22 @@ describe('Image directive', () => {\n       });\n     });\n \n+    it('should throw if `width` and `height` are not set', () => {\n+      setupTestingModule();\n+\n+      const template = '<img rawSrc=\"img.png\">';\n+      expect(() => {\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              'NG02954: The NgOptimizedImage directive (activated on an <img> ' +\n+              'element with the `rawSrc=\"img.png\"`) has detected that these ' +\n+              'required attributes are missing: \"width\", \"height\". Including \"width\" and ' +\n+              '\"height\" attributes will prevent image-related layout shifts. ' +\n+              'To fix this, include \"width\" and \"height\" attributes on the image tag.');\n+    });\n+\n     it('should throw if `width` is not set', () => {\n       setupTestingModule();\n \n@@ -159,7 +175,7 @@ describe('Image directive', () => {\n           .toThrowError(\n               'NG02954: The NgOptimizedImage directive (activated on an <img> ' +\n               'element with the `rawSrc=\"img.png\"`) has detected that these ' +\n-              'required attributes are missing:`width`. Including \"width\" and ' +\n+              'required attributes are missing: \"width\". Including \"width\" and ' +\n               '\"height\" attributes will prevent image-related layout shifts. ' +\n               'To fix this, include \"width\" and \"height\" attributes on the image tag.');\n     });\n@@ -205,7 +221,7 @@ describe('Image directive', () => {\n           .toThrowError(\n               'NG02954: The NgOptimizedImage directive (activated on an <img> ' +\n               'element with the `rawSrc=\"img.png\"`) has detected that these required ' +\n-              'attributes are missing:`height`. Including \"width\" and \"height\" ' +\n+              'attributes are missing: \"height\". Including \"width\" and \"height\" ' +\n               'attributes will prevent image-related layout shifts. ' +\n               'To fix this, include \"width\" and \"height\" attributes on the image tag.');\n     });\n\n\n###\n\n", "completion": "refactor(common): use quotes instead of backticks in missing width/height error message (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -55,12 +55,96 @@ export const RECOMMENDED_SRCSET_DENSITY_CAP = 2;\n const ASPECT_RATIO_TOLERANCE = .1;\n \n /**\n- * ** EXPERIMENTAL **\n+ * The directive that helps to improve image loading performance by following best practices.\n  *\n- * TODO: add Image directive description.\n+ * The `NgOptimizedImage` ensures that the loading of the LCP image is prioritized by:\n+ * - Automatically setting the `fetchpriority` attribute on the `<img>` tag\n+ * - Lazy loading non-priority images by default\n+ * - Asserting that there is a corresponding preconnect link tag in the document head\n+ *\n+ * In addition, the directive:\n+ * - Generates appropriate asset URLs (if a corresponding loader function is provided)\n+ * - Requires that `width` and `height` are set\n+ * - Warns if `width` or `height` have been set incorrectly\n+ * - Warns if the image will be visually distorted when rendered\n  *\n  * @usageNotes\n- * TODO: add Image directive usage notes.\n+ * The `NgOptimizedImage` directive is marked as [standalone](guide/standalone-components) and can\n+ * be imported directly.\n+ *\n+ * Follow the steps below to enable and use the directive:\n+ * 1. Import it into the necessary NgModule or a standalone Component.\n+ * 2. Configure a loader that you want to use.\n+ * 3. Update the necessary `<img>` tags in templates and replace `src` attributes with `rawSrc`.\n+ *\n+ * Step 1: import the `NgOptimizedImage` directive.\n+ *\n+ * ```typescript\n+ * import { NgOptimizedImage } from '@angular/common';\n+ *\n+ * // Include it into the necessary NgModule\n+ * @NgModule({\n+ *   imports: [NgOptimizedImage],\n+ * })\n+ * class AppModule {}\n+ *\n+ * // ... or a standalone Component\n+ * @Component({\n+ *   standalone: true\n+ *   imports: [NgOptimizedImage],\n+ * })\n+ * class MyStandaloneComponent {}\n+ * ```\n+ *\n+ * Step 2: configure a loader.\n+ *\n+ * To use the **default loader**: no additional code changes are necessary. The URL returned by the\n+ * generic loader will always match the value of \"src\". In other words, this loader applies no\n+ * transformations to thr resource URL and the value of the `rawSrc` attribute will be used as is.\n+ *\n+ * To use an existing loader for a **third-party image service**: add the provider factory for your\n+ * chosen service to the `providers` array. In the example below, the Imgix loader is used:\n+ *\n+ * ```typescript\n+ * import {provideImgixLoader} from '@angular/common';\n+ *\n+ * // Call the function and add the result to the `providers` array:\n+ * providers: [\n+ *   provideImgixLoader(\"https://my.base.url/\"),\n+ * ],\n+ * ```\n+ *\n+ * The `NgOptimizedImage` directive provides the following functions:\n+ * - `provideCloudflareLoader`\n+ * - `provideCloudinaryLoader`\n+ * - `provideImageKitLoader`\n+ * - `provideImgixLoader`\n+ *\n+ * If you use a different image provider, you can create a custom loader function as described\n+ * below.\n+ *\n+ * To use a **custom loader**: provide your loader function as a value for the `IMAGE_LOADER` DI\n+ * token.\n+ *\n+ * ```typescript\n+ * import {IMAGE_LOADER, ImageLoaderConfig} from '@angular/common';\n+ *\n+ * // Configure the loader using the `IMAGE_LOADER` token.\n+ * providers: [\n+ *   {\n+ *      provide: IMAGE_LOADER,\n+ *      useValue: (config: ImageLoaderConfig) => {\n+ *        return `https://example.com/${config.src}-${config.width}.jpg}`;\n+ *      }\n+ *   },\n+ * ],\n+ * ```\n+ *\n+ * Step 3: update `<img>` tags in templates to use `rawSrc` instead of `rawSrc`.\n+ *\n+ * ```\n+ * <img rawSrc=\"logo.png\" width=\"200\" height=\"100\">\n+ * ```\n  *\n  * @publicApi\n  * @developerPreview\n\n---\n file path A: packages/common/src/private_export.ts | file path B: packages/common/src/private_export.ts\n\n@@ -6,6 +6,5 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-export {IMAGE_LOADER as \u0275IMAGE_LOADER, ImageLoader as \u0275ImageLoader, ImageLoaderConfig as \u0275ImageLoaderConfig, NgOptimizedImage as \u0275NgOptimizedImage, PRECONNECT_CHECK_BLOCKLIST as \u0275PRECONNECT_CHECK_BLOCKLIST, provideImgixLoader as \u0275provideImgixLoader} from './directives/ng_optimized_image/index';\n export {DomAdapter as \u0275DomAdapter, getDOM as \u0275getDOM, setRootDomAdapter as \u0275setRootDomAdapter} from './dom_adapter';\n export {BrowserPlatformLocation as \u0275BrowserPlatformLocation} from './location/platform_location';\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/basic/basic.ts | file path B: packages/core/test/bundling/image-directive/e2e/basic/basic.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n+import {IMAGE_LOADER, NgOptimizedImage} from '@angular/common';\n import {Component} from '@angular/core';\n \n @Component({\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/image-distortion/image-distortion.ts | file path B: packages/core/test/bundling/image-directive/e2e/image-distortion/image-distortion.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n+import {NgOptimizedImage} from '@angular/common';\n import {Component} from '@angular/core';\n \n @Component({\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/lcp-check/lcp-check.ts | file path B: packages/core/test/bundling/image-directive/e2e/lcp-check/lcp-check.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n+import {NgOptimizedImage} from '@angular/common';\n import {Component} from '@angular/core';\n \n @Component({\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/preconnect-check/preconnect-check.ts | file path B: packages/core/test/bundling/image-directive/e2e/preconnect-check/preconnect-check.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {DOCUMENT, \u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n+import {DOCUMENT, IMAGE_LOADER, NgOptimizedImage} from '@angular/common';\n import {Component, Inject} from '@angular/core';\n \n @Component({\n\n---\n file path A: packages/core/test/bundling/image-directive/playground.ts | file path B: packages/core/test/bundling/image-directive/playground.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275NgOptimizedImage as NgOptimizedImage, \u0275provideImgixLoader as provideImgixLoader} from '@angular/common';\n+import {NgOptimizedImage, provideImgixLoader} from '@angular/common';\n import {Component} from '@angular/core';\n \n @Component({\n\n\n###\n\n", "completion": "docs: add description and usage notes to the NgOptimizedImage directive (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/index.md | file path B: goldens/public-api/common/index.md\n\n@@ -17,7 +17,9 @@ import { NgModuleFactory } from '@angular/core';\n import { Observable } from 'rxjs';\n import { OnChanges } from '@angular/core';\n import { OnDestroy } from '@angular/core';\n+import { OnInit } from '@angular/core';\n import { PipeTransform } from '@angular/core';\n+import { Provider } from '@angular/core';\n import { Renderer2 } from '@angular/core';\n import { SimpleChanges } from '@angular/core';\n import { Subscribable } from 'rxjs';\n@@ -256,6 +258,20 @@ export class I18nSelectPipe implements PipeTransform {\n     static \u0275pipe: i0.\u0275\u0275PipeDeclaration<I18nSelectPipe, \"i18nSelect\", true>;\n }\n \n+// @public\n+export const IMAGE_LOADER: InjectionToken<ImageLoader>;\n+\n+// @public\n+export type ImageLoader = (config: ImageLoaderConfig) => string;\n+\n+// @public\n+export interface ImageLoaderConfig {\n+    // (undocumented)\n+    src: string;\n+    // (undocumented)\n+    width?: number;\n+}\n+\n // @public\n export function isPlatformBrowser(platformId: Object): boolean;\n \n@@ -517,6 +533,35 @@ export abstract class NgLocalization {\n     static \u0275prov: i0.\u0275\u0275InjectableDeclaration<NgLocalization>;\n }\n \n+// @public\n+export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n+    constructor(imageLoader: ImageLoader, renderer: Renderer2, imgElement: ElementRef, injector: Injector);\n+    set height(value: string | number | undefined);\n+    // (undocumented)\n+    get height(): number | undefined;\n+    loading?: string;\n+    // (undocumented)\n+    ngOnChanges(changes: SimpleChanges): void;\n+    // (undocumented)\n+    ngOnDestroy(): void;\n+    // (undocumented)\n+    ngOnInit(): void;\n+    set priority(value: string | boolean | undefined);\n+    // (undocumented)\n+    get priority(): boolean;\n+    rawSrc: string;\n+    rawSrcset: string;\n+    // (undocumented)\n+    srcset?: string;\n+    set width(value: string | number | undefined);\n+    // (undocumented)\n+    get width(): number | undefined;\n+    // (undocumented)\n+    static \u0275dir: i0.\u0275\u0275DirectiveDeclaration<NgOptimizedImage, \"img[rawSrc]\", never, { \"rawSrc\": \"rawSrc\"; \"rawSrcset\": \"rawSrcset\"; \"width\": \"width\"; \"height\": \"height\"; \"loading\": \"loading\"; \"priority\": \"priority\"; \"src\": \"src\"; \"srcset\": \"srcset\"; }, {}, never, never, true>;\n+    // (undocumented)\n+    static \u0275fac: i0.\u0275\u0275FactoryDeclaration<NgOptimizedImage, never>;\n+}\n+\n // @public\n export class NgPlural {\n     constructor(_localization: NgLocalization);\n@@ -743,6 +788,29 @@ interface PopStateEvent_2 {\n }\n export { PopStateEvent_2 as PopStateEvent }\n \n+// @public\n+export const PRECONNECT_CHECK_BLOCKLIST: InjectionToken<(string | string[])[]>;\n+\n+// @public\n+export const provideCloudflareLoader: (path: string, options?: {\n+    ensurePreconnect?: boolean | undefined;\n+}) => Provider[];\n+\n+// @public\n+export const provideCloudinaryLoader: (path: string, options?: {\n+    ensurePreconnect?: boolean | undefined;\n+}) => Provider[];\n+\n+// @public\n+export const provideImageKitLoader: (path: string, options?: {\n+    ensurePreconnect?: boolean | undefined;\n+}) => Provider[];\n+\n+// @public\n+export const provideImgixLoader: (path: string, options?: {\n+    ensurePreconnect?: boolean | undefined;\n+}) => Provider[];\n+\n // @public\n export function registerLocaleData(data: any, localeId?: string | any, extraData?: any): void;\n \n\n---\n file path A: packages/common/src/common.ts | file path B: packages/common/src/common.ts\n\n@@ -27,3 +27,4 @@ export {PLATFORM_BROWSER_ID as \u0275PLATFORM_BROWSER_ID, PLATFORM_SERVER_ID as \u0275PL\n export {VERSION} from './version';\n export {ViewportScroller, NullViewportScroller as \u0275NullViewportScroller} from './viewport_scroller';\n export {XhrFactory} from './xhr';\n+export * from './directives/ng_optimized_image';\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts\n\n@@ -17,6 +17,9 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  * @param path Your domain name\n  * e.g. https://mysite.com\n  * @returns Provider that provides an ImageLoader function\n+ *\n+ * @publicApi\n+ * @developerPreview\n  */\n export const provideCloudflareLoader = createImageLoader(\n     createCloudflareURL,\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts\n\n@@ -22,6 +22,9 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  *                       should verify that there is a corresponding `<link rel=\"preconnect\">`\n  *                       present in the document's `<head>`.\n  * @returns Set of providers to configure the Cloudinary loader.\n+ *\n+ * @publicApi\n+ * @developerPreview\n  */\n export const provideCloudinaryLoader = createImageLoader(\n     createCloudinaryURL,\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts\n\n@@ -14,6 +14,9 @@ import {isAbsoluteURL, isValidPath, normalizePath, normalizeSrc} from '../util';\n \n /**\n  * Config options recognized by the image loader function.\n+ *\n+ * @publicApi\n+ * @developerPreview\n  */\n export interface ImageLoaderConfig {\n   // Name of the image to be added to the image request URL\n@@ -24,6 +27,9 @@ export interface ImageLoaderConfig {\n \n /**\n  * Represents an image loader function.\n+ *\n+ * @publicApi\n+ * @developerPreview\n  */\n export type ImageLoader = (config: ImageLoaderConfig) => string;\n \n@@ -36,6 +42,9 @@ const noopImageLoader = (config: ImageLoaderConfig) => config.src;\n /**\n  * Special token that allows to configure a function that will be used to produce an image URL based\n  * on the specified input.\n+ *\n+ * @publicApi\n+ * @developerPreview\n  */\n export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n   providedIn: 'root',\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts\n\n@@ -21,6 +21,9 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  *                       should verify that there is a corresponding `<link rel=\"preconnect\">`\n  *                       present in the document's `<head>`.\n  * @returns Set of providers to configure the ImageKit loader.\n+ *\n+ * @publicApi\n+ * @developerPreview\n  */\n export const provideImageKitLoader = createImageLoader(\n     createImagekitURL,\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts\n\n@@ -19,6 +19,9 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  *                       should verify that there is a corresponding `<link rel=\"preconnect\">`\n  *                       present in the document's `<head>`.\n  * @returns Set of providers to configure the Imgix loader.\n+ *\n+ * @publicApi\n+ * @developerPreview\n  */\n export const provideImgixLoader =\n     createImageLoader(createImgixURL, ngDevMode ? ['https://somepath.imgix.net/'] : undefined);\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/index.ts | file path B: packages/common/src/directives/ng_optimized_image/index.ts\n\n@@ -5,7 +5,12 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n+\n+// These exports represent the set of symbols exposed as a public API.\n+export {provideCloudflareLoader} from './image_loaders/cloudflare_loader';\n+export {provideCloudinaryLoader} from './image_loaders/cloudinary_loader';\n export {IMAGE_LOADER, ImageLoader, ImageLoaderConfig} from './image_loaders/image_loader';\n+export {provideImageKitLoader} from './image_loaders/imagekit_loader';\n export {provideImgixLoader} from './image_loaders/imgix_loader';\n export {NgOptimizedImage} from './ng_optimized_image';\n export {PRECONNECT_CHECK_BLOCKLIST} from './preconnect_link_checker';\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -61,6 +61,9 @@ const ASPECT_RATIO_TOLERANCE = .1;\n  *\n  * @usageNotes\n  * TODO: add Image directive usage notes.\n+ *\n+ * @publicApi\n+ * @developerPreview\n  */\n @Directive({\n   standalone: true,\n@@ -95,8 +98,10 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n    * descriptors to generate the final `srcset` property of the image.\n    *\n    * Example:\n+   * ```\n    * <img rawSrc=\"hello.jpg\" rawSrcset=\"100w, 200w\" />  =>\n    * <img src=\"path/hello.jpg\" srcset=\"path/hello.jpg?w=100 100w, path/hello.jpg?w=200 200w\" />\n+   * ```\n    */\n   @Input() rawSrcset!: string;\n \n@@ -144,7 +149,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   }\n \n   /**\n-   * Get a value of the `src` and `srcset` if they're set on a host <img> element.\n+   * Get a value of the `src` and `srcset` if they're set on a host `<img>` element.\n    * These inputs are needed to verify that there are no conflicting sources provided\n    * at the same time (e.g. `src` and `rawSrc` together or `srcset` and `rawSrcset`,\n    * thus causing an ambiguity on which src to use) and that images\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/preconnect_link_checker.ts | file path B: packages/common/src/directives/ng_optimized_image/preconnect_link_checker.ts\n\n@@ -32,6 +32,9 @@ const INTERNAL_PRECONNECT_CHECK_BLOCKLIST = new Set(['localhost', '127.0.0.1', '\n  *  {provide: PRECONNECT_CHECK_BLOCKLIST, multi: true,\n  *   useValue: ['https://your-domain-1.com', 'https://your-domain-2.com']}\n  * ```\n+ *\n+ * @publicApi\n+ * @developerPreview\n  */\n export const PRECONNECT_CHECK_BLOCKLIST =\n     new InjectionToken<Array<string|string[]>>('PRECONNECT_CHECK_BLOCKLIST');\n\n\n###\n\n", "completion": "feat(common): define public API surface for NgOptimizedImage directive (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/index.ts | file path B: packages/common/src/directives/ng_optimized_image/index.ts\n\n@@ -7,5 +7,5 @@\n  */\n export {IMAGE_LOADER, ImageLoader, ImageLoaderConfig} from './image_loaders/image_loader';\n export {provideImgixLoader} from './image_loaders/imgix_loader';\n-export {NgOptimizedImage, NgOptimizedImageModule} from './ng_optimized_image';\n+export {NgOptimizedImage} from './ng_optimized_image';\n export {PRECONNECT_CHECK_BLOCKLIST} from './preconnect_link_checker';\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -63,6 +63,7 @@ const ASPECT_RATIO_TOLERANCE = .1;\n  * TODO: add Image directive usage notes.\n  */\n @Directive({\n+  standalone: true,\n   selector: 'img[rawSrc]',\n })\n export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n@@ -242,22 +243,6 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   }\n }\n \n-\n-/**\n- * NgModule that declares and exports the `NgOptimizedImage` directive.\n- * This NgModule is a compatibility layer for apps that use pre-v14\n- * versions of Angular (before the `standalone` flag became available).\n- *\n- * The `NgOptimizedImage` will become a standalone directive in v14 and\n- * this NgModule will be removed.\n- */\n-@NgModule({\n-  declarations: [NgOptimizedImage],\n-  exports: [NgOptimizedImage],\n-})\n-export class NgOptimizedImageModule {\n-}\n-\n /***** Helpers *****/\n \n // Convert input value to integer.\n\n---\n file path A: packages/common/src/private_export.ts | file path B: packages/common/src/private_export.ts\n\n@@ -6,6 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-export {IMAGE_LOADER as \u0275IMAGE_LOADER, ImageLoader as \u0275ImageLoader, ImageLoaderConfig as \u0275ImageLoaderConfig, NgOptimizedImage as \u0275NgOptimizedImage, NgOptimizedImageModule as \u0275NgOptimizedImageModule, PRECONNECT_CHECK_BLOCKLIST as \u0275PRECONNECT_CHECK_BLOCKLIST, provideImgixLoader as \u0275provideImgixLoader} from './directives/ng_optimized_image/index';\n+export {IMAGE_LOADER as \u0275IMAGE_LOADER, ImageLoader as \u0275ImageLoader, ImageLoaderConfig as \u0275ImageLoaderConfig, NgOptimizedImage as \u0275NgOptimizedImage, PRECONNECT_CHECK_BLOCKLIST as \u0275PRECONNECT_CHECK_BLOCKLIST, provideImgixLoader as \u0275provideImgixLoader} from './directives/ng_optimized_image/index';\n export {DomAdapter as \u0275DomAdapter, getDOM as \u0275getDOM, setRootDomAdapter as \u0275setRootDomAdapter} from './dom_adapter';\n export {BrowserPlatformLocation as \u0275BrowserPlatformLocation} from './location/platform_location';\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -14,7 +14,7 @@ import {expect} from '@angular/platform-browser/testing/src/matchers';\n import {withHead} from '@angular/private/testing';\n \n import {IMAGE_LOADER, ImageLoader, ImageLoaderConfig} from '../../src/directives/ng_optimized_image/image_loaders/image_loader';\n-import {ABSOLUTE_SRCSET_DENSITY_CAP, assertValidRawSrcset, NgOptimizedImage, NgOptimizedImageModule, RECOMMENDED_SRCSET_DENSITY_CAP} from '../../src/directives/ng_optimized_image/ng_optimized_image';\n+import {ABSOLUTE_SRCSET_DENSITY_CAP, assertValidRawSrcset, NgOptimizedImage, RECOMMENDED_SRCSET_DENSITY_CAP} from '../../src/directives/ng_optimized_image/ng_optimized_image';\n import {PRECONNECT_CHECK_BLOCKLIST} from '../../src/directives/ng_optimized_image/preconnect_link_checker';\n \n describe('Image directive', () => {\n@@ -995,7 +995,7 @@ function setupTestingModule(config?: {imageLoader?: ImageLoader, extraProviders?\n     declarations: [TestComponent],\n     // Note: the `NgOptimizedImage` directive is experimental and is not a part of the\n     // `CommonModule` yet, so it's imported separately.\n-    imports: [CommonModule, NgOptimizedImageModule],\n+    imports: [CommonModule, NgOptimizedImage],\n     providers,\n   });\n }\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/basic/basic.ts | file path B: packages/core/test/bundling/image-directive/e2e/basic/basic.ts\n\n@@ -6,13 +6,13 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgOptimizedImageModule as NgOptimizedImageModule} from '@angular/common';\n+import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n import {Component} from '@angular/core';\n \n @Component({\n   selector: 'basic',\n   standalone: true,\n-  imports: [NgOptimizedImageModule],\n+  imports: [NgOptimizedImage],\n   template: `<img rawSrc=\"/e2e/a.png\" width=\"150\" height=\"150\" priority>`,\n   providers: [{\n     provide: IMAGE_LOADER,\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/image-distortion/image-distortion.ts | file path B: packages/core/test/bundling/image-directive/e2e/image-distortion/image-distortion.ts\n\n@@ -6,13 +6,13 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275NgOptimizedImageModule as NgOptimizedImageModule} from '@angular/common';\n+import {\u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n import {Component} from '@angular/core';\n \n @Component({\n   selector: 'image-distortion-passing',\n   standalone: true,\n-  imports: [NgOptimizedImageModule],\n+  imports: [NgOptimizedImage],\n   template: `\n      <!-- All the images in this template should not throw -->\n      <!-- This image is here for the sake of making sure the \"LCP image is priority\" assertion is passed -->\n@@ -51,7 +51,7 @@ export class ImageDistortionPassingComponent {\n @Component({\n   selector: 'image-distortion-failing',\n   standalone: true,\n-  imports: [NgOptimizedImageModule],\n+  imports: [NgOptimizedImage],\n   template: `\n      <!-- With the exception of the priority image, all the images in this template should throw -->\n      <!-- This image is here for the sake of making sure the \"LCP image is priority\" assertion is passed -->\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/lcp-check/lcp-check.ts | file path B: packages/core/test/bundling/image-directive/e2e/lcp-check/lcp-check.ts\n\n@@ -6,13 +6,13 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275NgOptimizedImageModule as NgOptimizedImageModule} from '@angular/common';\n+import {\u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n import {Component} from '@angular/core';\n \n @Component({\n   selector: 'lcp-check',\n   standalone: true,\n-  imports: [NgOptimizedImageModule],\n+  imports: [NgOptimizedImage],\n   template: `\n     <!--\n       'b.png' should *not* be treated as an LCP element,\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/preconnect-check/preconnect-check.ts | file path B: packages/core/test/bundling/image-directive/e2e/preconnect-check/preconnect-check.ts\n\n@@ -6,13 +6,13 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {DOCUMENT, \u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgOptimizedImageModule as NgOptimizedImageModule} from '@angular/common';\n+import {DOCUMENT, \u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n import {Component, Inject} from '@angular/core';\n \n @Component({\n   selector: 'preconnect-check',\n   standalone: true,\n-  imports: [NgOptimizedImageModule],\n+  imports: [NgOptimizedImage],\n   template: `\n     <img rawSrc=\"/e2e/a.png\" width=\"50\" height=\"50\" priority>\n     <img rawSrc=\"/e2e/b.png\" width=\"50\" height=\"50\" priority>\n\n---\n file path A: packages/core/test/bundling/image-directive/playground.ts | file path B: packages/core/test/bundling/image-directive/playground.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275NgOptimizedImageModule as NgOptimizedImageModule, \u0275provideImgixLoader as provideImgixLoader} from '@angular/common';\n+import {\u0275NgOptimizedImage as NgOptimizedImage, \u0275provideImgixLoader as provideImgixLoader} from '@angular/common';\n import {Component} from '@angular/core';\n \n @Component({\n@@ -43,7 +43,7 @@ import {Component} from '@angular/core';\n     </main>\n   `,\n   standalone: true,\n-  imports: [NgOptimizedImageModule],\n+  imports: [NgOptimizedImage],\n   providers: [provideImgixLoader('https://aurora-project.imgix.net')],\n })\n export class PlaygroundComponent {\n\n\n###\n\n", "completion": "refactor(common): make NgOptimizedImage directive standalone (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -161,8 +161,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n       assertNoConflictingSrcset(this);\n       assertNotBase64Image(this);\n       assertNotBlobURL(this);\n-      assertRequiredNumberInput(this, this.width, 'width');\n-      assertRequiredNumberInput(this, this.height, 'height');\n+      assertNonEmptyWidthAndHeight(this);\n       assertValidLoadingInput(this);\n       assertNoImageDistortion(this, this.imgElement, this.renderer);\n       if (this.priority) {\n@@ -507,13 +506,17 @@ function assertNoImageDistortion(\n }\n \n // Verifies that a specified input is set.\n-function assertRequiredNumberInput(dir: NgOptimizedImage, inputValue: unknown, inputName: string) {\n-  if (typeof inputValue === 'undefined') {\n+function assertNonEmptyWidthAndHeight(dir: NgOptimizedImage) {\n+  let missingAttributes = [];\n+  if (dir.width === undefined) missingAttributes.push('width');\n+  if (dir.height === undefined) missingAttributes.push('height');\n+  if (missingAttributes.length > 0) {\n     throw new RuntimeError(\n         RuntimeErrorCode.REQUIRED_INPUT_MISSING,\n-        `${imgDirectiveDetails(dir.rawSrc)} has detected that the required \\`${inputName}\\` ` +\n-            `attribute is missing. Please specify the \\`${inputName}\\` attribute ` +\n-            `on the mentioned element.`);\n+        `${imgDirectiveDetails(dir.rawSrc)} has detected that these required attributes` +\n+            ` are missing:\\`${missingAttributes.join(',')}\\`. Including \"width\" and \"height\" ` +\n+            `attributes will prevent image-related layout shifts. Please include \"width\" and ` +\n+            `\"height\" attributes on the image tag.`);\n   }\n }\n \n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -162,9 +162,9 @@ describe('Image directive', () => {\n               `NG0${\n                   RuntimeErrorCode\n                       .REQUIRED_INPUT_MISSING}: The NgOptimizedImage directive (activated on an <img> ` +\n-              'element with the `rawSrc=\"img.png\"`) has detected that the required ' +\n-              '`width` attribute is missing. Please specify the `width` attribute ' +\n-              'on the mentioned element.');\n+              'element with the `rawSrc=\"img.png\"`) has detected that these required attributes are missing:' +\n+              '`width`. Including \"width\" and \"height\" attributes will prevent image-related layout shifts. ' +\n+              'Please include \"width\" and \"height\" attributes on the image tag.');\n     });\n \n     it('should throw if `width` is 0', () => {\n@@ -211,9 +211,9 @@ describe('Image directive', () => {\n               `NG0${\n                   RuntimeErrorCode\n                       .REQUIRED_INPUT_MISSING}: The NgOptimizedImage directive (activated on an <img> ` +\n-              'element with the `rawSrc=\"img.png\"`) has detected that the required ' +\n-              '`height` attribute is missing. Please specify the `height` attribute ' +\n-              'on the mentioned element.');\n+              'element with the `rawSrc=\"img.png\"`) has detected that these required attributes are missing:' +\n+              '`height`. Including \"width\" and \"height\" attributes will prevent image-related layout shifts. ' +\n+              'Please include \"width\" and \"height\" attributes on the image tag.');\n     });\n \n     it('should throw if `height` is 0', () => {\n\n\n###\n\n", "completion": "feat(common): explain why width/height is required (#<issue-num>)"}
{"prompt": " file path A: packages/common/test/image_loaders/image_loader_spec.ts | file path B: packages/common/test/image_loaders/image_loader_spec.ts\n\n@@ -12,12 +12,14 @@ import {provideCloudinaryLoader} from '@angular/common/src/directives/ng_optimiz\n import {provideImageKitLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader';\n import {provideImgixLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/imgix_loader';\n import {isValidPath} from '@angular/common/src/directives/ng_optimized_image/util';\n-import {createEnvironmentInjector, ValueProvider} from '@angular/core';\n+import {createEnvironmentInjector, EnvironmentInjector, ValueProvider} from '@angular/core';\n+import {TestBed} from '@angular/core/testing';\n \n describe('Built-in image directive loaders', () => {\n   describe('Imgix loader', () => {\n     function createImgixLoader(path: string): ImageLoader {\n-      const injector = createEnvironmentInjector([provideImgixLoader(path)]);\n+      const injector = createEnvironmentInjector(\n+          [provideImgixLoader(path)], TestBed.inject(EnvironmentInjector));\n       return injector.get(IMAGE_LOADER);\n     }\n \n@@ -65,7 +67,8 @@ describe('Built-in image directive loaders', () => {\n \n   describe('Cloudinary loader', () => {\n     function createCloudinaryLoader(path: string): ImageLoader {\n-      const injector = createEnvironmentInjector([provideCloudinaryLoader(path)]);\n+      const injector = createEnvironmentInjector(\n+          [provideCloudinaryLoader(path)], TestBed.inject(EnvironmentInjector));\n       return injector.get(IMAGE_LOADER);\n     }\n \n@@ -117,7 +120,8 @@ describe('Built-in image directive loaders', () => {\n \n   describe('ImageKit loader', () => {\n     function createImageKitLoader(path: string): ImageLoader {\n-      const injector = createEnvironmentInjector([provideImageKitLoader(path)]);\n+      const injector = createEnvironmentInjector(\n+          [provideImageKitLoader(path)], TestBed.inject(EnvironmentInjector));\n       return injector.get(IMAGE_LOADER);\n     }\n \n@@ -167,7 +171,8 @@ describe('Built-in image directive loaders', () => {\n \n   describe('Cloudflare loader', () => {\n     function createCloudflareLoader(path: string): ImageLoader {\n-      const injector = createEnvironmentInjector([provideCloudflareLoader(path)]);\n+      const injector = createEnvironmentInjector(\n+          [provideCloudflareLoader(path)], TestBed.inject(EnvironmentInjector));\n       return injector.get(IMAGE_LOADER);\n     }\n     it('should construct an image loader with the given path', () => {\n\n\n###\n\n", "completion": "test(common): add parent injector to the `createEnvironmentInjector` calls in tests (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -36,6 +36,19 @@ const VALID_WIDTH_DESCRIPTOR_SRCSET = /^((\\s*\\d+w\\s*(,|$)){1,})$/;\n  */\n const VALID_DENSITY_DESCRIPTOR_SRCSET = /^((\\s*\\d(\\.\\d)?x\\s*(,|$)){1,})$/;\n \n+/**\n+ * Srcset values with a density descriptor higher than this value will actively\n+ * throw an error. Such densities are not permitted as they cause image sizes\n+ * to be unreasonably large and slow down LCP.\n+ */\n+export const ABSOLUTE_SRCSET_DENSITY_CAP = 3;\n+\n+/**\n+ * Used only in error message text to communicate best practices, as we will\n+ * only throw based on the slightly more conservative ABSOLUTE_SRCSET_DENSITY_CAP.\n+ */\n+export const RECOMMENDED_SRCSET_DENSITY_CAP = 2;\n+\n /**\n  * Used to determine whether two aspect ratios are similar in value.\n  */\n@@ -359,15 +372,37 @@ function assertNonEmptyInput(name: string, value: unknown) {\n export function assertValidRawSrcset(value: unknown) {\n   if (value == null) return;\n   assertNonEmptyInput('rawSrcset', value);\n-  const isValidSrcset = VALID_WIDTH_DESCRIPTOR_SRCSET.test(value as string) ||\n-      VALID_DENSITY_DESCRIPTOR_SRCSET.test(value as string);\n+  const stringVal = value as string;\n+  const isValidWidthDescriptor = VALID_WIDTH_DESCRIPTOR_SRCSET.test(stringVal);\n+  const isValidDensityDescriptor = VALID_DENSITY_DESCRIPTOR_SRCSET.test(stringVal);\n \n+  if (isValidDensityDescriptor) {\n+    assertUnderDensityCap(stringVal);\n+  }\n+\n+  const isValidSrcset = isValidWidthDescriptor || isValidDensityDescriptor;\n   if (!isValidSrcset) {\n     throw new RuntimeError(\n         RuntimeErrorCode.INVALID_INPUT,\n         `The NgOptimizedImage directive has detected that the \\`rawSrcset\\` has an invalid value: ` +\n             `expecting width descriptors (e.g. \"100w, 200w\") or density descriptors (e.g. \"1x, 2x\"), ` +\n-            `but got: \\`${value}\\``);\n+            `but got: \\`${stringVal}\\``);\n+  }\n+}\n+\n+function assertUnderDensityCap(value: string) {\n+  const underDensityCap =\n+      value.split(',').every(num => num === '' || parseFloat(num) <= ABSOLUTE_SRCSET_DENSITY_CAP);\n+  if (!underDensityCap) {\n+    throw new RuntimeError(\n+        RuntimeErrorCode.INVALID_INPUT,\n+        `The NgOptimizedImage directive has detected that the \\`rawSrcset\\` contains an unsupported image density:` +\n+            `\\`${value}\\`. NgOptimizedImage generally recommends a max image density of ` +\n+            `${RECOMMENDED_SRCSET_DENSITY_CAP}x but supports image densities up to ` +\n+            `${ABSOLUTE_SRCSET_DENSITY_CAP}x. The human eye cannot distinguish between image densities ` +\n+            `greater than ${RECOMMENDED_SRCSET_DENSITY_CAP}x - which makes them unnecessary for ` +\n+            `most use cases. Images that will be pinch-zoomed are typically the primary use case for` +\n+            `${ABSOLUTE_SRCSET_DENSITY_CAP}x images. Please remove the high density descriptor and try again.`);\n   }\n }\n \n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -14,7 +14,7 @@ import {expect} from '@angular/platform-browser/testing/src/matchers';\n import {withHead} from '@angular/private/testing';\n \n import {IMAGE_LOADER, ImageLoader, ImageLoaderConfig} from '../../src/directives/ng_optimized_image/image_loaders/image_loader';\n-import {assertValidRawSrcset, NgOptimizedImageModule} from '../../src/directives/ng_optimized_image/ng_optimized_image';\n+import {ABSOLUTE_SRCSET_DENSITY_CAP, assertValidRawSrcset, NgOptimizedImageModule, RECOMMENDED_SRCSET_DENSITY_CAP} from '../../src/directives/ng_optimized_image/ng_optimized_image';\n import {PRECONNECT_CHECK_BLOCKLIST} from '../../src/directives/ng_optimized_image/preconnect_link_checker';\n \n describe('Image directive', () => {\n@@ -322,6 +322,33 @@ describe('Image directive', () => {\n                 `but got: \\`100q, 200q\\``);\n       });\n \n+      it('should throw if rawSrcset exceeds the density cap', () => {\n+        const imageLoader = (config: ImageLoaderConfig) => {\n+          const width = config.width ? `-${config.width}` : ``;\n+          return window.location.origin + `/path/${config.src}${width}.png`;\n+        };\n+        setupTestingModule({imageLoader});\n+\n+        const template = `\n+            <img rawSrc=\"img\" rawSrcset=\"1x, 2x, 3x, 4x, 5x\" width=\"100\" height=\"50\">\n+          `;\n+        expect(() => {\n+          const fixture = createTestComponent(template);\n+          fixture.detectChanges();\n+        })\n+            .toThrowError(\n+                `NG0${\n+                    RuntimeErrorCode\n+                        .INVALID_INPUT}: The NgOptimizedImage directive has detected that the \\`rawSrcset\\` contains an unsupported image density:` +\n+                `\\`1x, 2x, 3x, 4x, 5x\\`. NgOptimizedImage generally recommends a max image density of ` +\n+                `${RECOMMENDED_SRCSET_DENSITY_CAP}x but supports image densities up to ` +\n+                `${ABSOLUTE_SRCSET_DENSITY_CAP}x. The human eye cannot distinguish between image densities ` +\n+                `greater than ${\n+                    RECOMMENDED_SRCSET_DENSITY_CAP}x - which makes them unnecessary for ` +\n+                `most use cases. Images that will be pinch-zoomed are typically the primary use case for` +\n+                `${ABSOLUTE_SRCSET_DENSITY_CAP}x images. Please remove the high density descriptor and try again.`);\n+      });\n+\n       it('should throw if width srcset is missing a comma', () => {\n         expect(() => {\n           assertValidRawSrcset('100w 200w');\n\n\n###\n\n", "completion": "feat(common): add a density cap for image srcsets (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts\n\n@@ -19,15 +19,13 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  * @returns Provider that provides an ImageLoader function\n  */\n export const provideCloudflareLoader = createImageLoader(\n-    cloudflareLoaderFactory,\n+    createCloudflareURL,\n     ngDevMode ? ['https://<ZONE>/cdn-cgi/image/<OPTIONS>/<SOURCE-IMAGE>'] : undefined);\n \n-function cloudflareLoaderFactory(path: string) {\n-  return (config: ImageLoaderConfig) => {\n-    let params = `format=auto`;\n-    if (config.width) {\n-      params += `,width=${config.width}`;\n-    }\n-    return `${path}/cdn-cgi/image/${params}/${config.src}`;\n-  };\n+function createCloudflareURL(path: string, config: ImageLoaderConfig) {\n+  let params = `format=auto`;\n+  if (config.width) {\n+    params += `,width=${config.width}`;\n+  }\n+  return `${path}/cdn-cgi/image/${params}/${config.src}`;\n }\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts\n\n@@ -24,7 +24,7 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  * @returns Set of providers to configure the Cloudinary loader.\n  */\n export const provideCloudinaryLoader = createImageLoader(\n-    cloudinaryLoaderFactory,\n+    createCloudinaryURL,\n     ngDevMode ?\n         [\n           'https://res.cloudinary.com/mysite', 'https://mysite.cloudinary.com',\n@@ -32,14 +32,12 @@ export const provideCloudinaryLoader = createImageLoader(\n         ] :\n         undefined);\n \n-function cloudinaryLoaderFactory(path: string) {\n-  return (config: ImageLoaderConfig) => {\n-    // Example of a Cloudinary image URL:\n-    // https://res.cloudinary.com/mysite/image/upload/c_scale,f_auto,q_auto,w_600/marketing/tile-topics-m.png\n-    let params = `f_auto,q_auto`;  // sets image format and quality to \"auto\"\n-    if (config.width) {\n-      params += `,w_${config.width}`;\n-    }\n-    return `${path}/image/upload/${params}/${config.src}`;\n-  };\n+function createCloudinaryURL(path: string, config: ImageLoaderConfig) {\n+  // Example of a Cloudinary image URL:\n+  // https://res.cloudinary.com/mysite/image/upload/c_scale,f_auto,q_auto,w_600/marketing/tile-topics-m.png\n+  let params = `f_auto,q_auto`;  // sets image format and quality to \"auto\"\n+  if (config.width) {\n+    params += `,w_${config.width}`;\n+  }\n+  return `${path}/image/upload/${params}/${config.src}`;\n }\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts\n\n@@ -42,23 +42,21 @@ export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n   factory: () => noopImageLoader,\n });\n \n-export function createImageLoader(urlFn: (path: string) => ImageLoader, exampleUrls?: string[]) {\n+export function createImageLoader(\n+    buildUrlFn: (path: string, config: ImageLoaderConfig) => string, exampleUrls?: string[]) {\n   return function provideImageLoader(\n       path: string, options: {ensurePreconnect?: boolean} = {ensurePreconnect: true}) {\n     if (ngDevMode && !isValidPath(path)) {\n       throwInvalidPathError(path, exampleUrls || []);\n     }\n     path = normalizePath(path);\n-    const createURLFn = urlFn(path);\n \n     const loaderFn = (config: ImageLoaderConfig) => {\n       if (ngDevMode && isAbsoluteURL(config.src)) {\n         throwUnexpectedAbsoluteUrlError(path, config.src);\n       }\n \n-      config.src = normalizeSrc(config.src);\n-\n-      return createURLFn(config);\n+      return buildUrlFn(path, {...config, src: normalizeSrc(config.src)});\n     };\n     const providers: Provider[] = [{provide: IMAGE_LOADER, useValue: loaderFn}];\n \n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts\n\n@@ -23,17 +23,15 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  * @returns Set of providers to configure the ImageKit loader.\n  */\n export const provideImageKitLoader = createImageLoader(\n-    imagekitLoaderFactory,\n+    createImagekitURL,\n     ngDevMode ? ['https://ik.imagekit.io/mysite', 'https://subdomain.mysite.com'] : undefined);\n \n-export function imagekitLoaderFactory(path: string) {\n-  return (config: ImageLoaderConfig) => {\n-    // Example of an ImageKit image URL:\n-    // https://ik.imagekit.io/demo/tr:w-300,h-300/medium_cafe_B1iTdD0C.jpg\n-    let params = `tr:q-auto`;  // applies the \"auto quality\" transformation\n-    if (config.width) {\n-      params += `,w-${config.width}`;\n-    }\n-    return `${path}/${params}/${config.src}`;\n-  };\n+export function createImagekitURL(path: string, config: ImageLoaderConfig) {\n+  // Example of an ImageKit image URL:\n+  // https://ik.imagekit.io/demo/tr:w-300,h-300/medium_cafe_B1iTdD0C.jpg\n+  let params = `tr:q-auto`;  // applies the \"auto quality\" transformation\n+  if (config.width) {\n+    params += `,w-${config.width}`;\n+  }\n+  return `${path}/${params}/${config.src}`;\n }\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts\n\n@@ -21,16 +21,14 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  * @returns Set of providers to configure the Imgix loader.\n  */\n export const provideImgixLoader =\n-    createImageLoader(imgixLoaderFactory, ngDevMode ? ['https://somepath.imgix.net/'] : undefined);\n+    createImageLoader(createImgixURL, ngDevMode ? ['https://somepath.imgix.net/'] : undefined);\n \n-function imgixLoaderFactory(path: string) {\n-  return (config: ImageLoaderConfig) => {\n-    const url = new URL(`${path}/${config.src}`);\n-    // This setting ensures the smallest allowable format is set.\n-    url.searchParams.set('auto', 'format');\n-    if (config.width) {\n-      url.searchParams.set('w', config.width.toString());\n-    }\n-    return url.href;\n-  };\n+function createImgixURL(path: string, config: ImageLoaderConfig) {\n+  const url = new URL(`${path}/${config.src}`);\n+  // This setting ensures the smallest allowable format is set.\n+  url.searchParams.set('auto', 'format');\n+  if (config.width) {\n+    url.searchParams.set('w', config.width.toString());\n+  }\n+  return url.href;\n }\n\n\n###\n\n", "completion": "refactor(common): simplify URL construction in image loaders (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts\n\n@@ -6,8 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {normalizeSrc} from '../util';\n-\n import {createImageLoader, ImageLoaderConfig} from './image_loader';\n \n /**\n@@ -30,7 +28,6 @@ function cloudflareLoaderFactory(path: string) {\n     if (config.width) {\n       params += `,width=${config.width}`;\n     }\n-    const url = `${path}/cdn-cgi/image/${params}/${normalizeSrc(config.src)}`;\n-    return url;\n+    return `${path}/cdn-cgi/image/${params}/${config.src}`;\n   };\n }\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts\n\n@@ -6,8 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {normalizeSrc} from '../util';\n-\n import {createImageLoader, ImageLoaderConfig} from './image_loader';\n \n /**\n@@ -42,7 +40,6 @@ function cloudinaryLoaderFactory(path: string) {\n     if (config.width) {\n       params += `,w_${config.width}`;\n     }\n-    const url = `${path}/image/upload/${params}/${normalizeSrc(config.src)}`;\n-    return url;\n+    return `${path}/image/upload/${params}/${config.src}`;\n   };\n }\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts\n\n@@ -10,7 +10,7 @@ import {InjectionToken, Provider, \u0275RuntimeError as RuntimeError} from '@angular\n \n import {RuntimeErrorCode} from '../../../errors';\n import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n-import {isAbsoluteURL, isValidPath, normalizePath} from '../util';\n+import {isAbsoluteURL, isValidPath, normalizePath, normalizeSrc} from '../util';\n \n /**\n  * Config options recognized by the image loader function.\n@@ -49,13 +49,16 @@ export function createImageLoader(urlFn: (path: string) => ImageLoader, exampleU\n       throwInvalidPathError(path, exampleUrls || []);\n     }\n     path = normalizePath(path);\n+    const createURLFn = urlFn(path);\n \n     const loaderFn = (config: ImageLoaderConfig) => {\n       if (ngDevMode && isAbsoluteURL(config.src)) {\n         throwUnexpectedAbsoluteUrlError(path, config.src);\n       }\n-      const loader = urlFn(path);\n-      return loader(config);\n+\n+      config.src = normalizeSrc(config.src);\n+\n+      return createURLFn(config);\n     };\n     const providers: Provider[] = [{provide: IMAGE_LOADER, useValue: loaderFn}];\n \n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts\n\n@@ -6,8 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {normalizeSrc} from '../util';\n-\n import {createImageLoader, ImageLoaderConfig} from './image_loader';\n \n /**\n@@ -36,7 +34,6 @@ export function imagekitLoaderFactory(path: string) {\n     if (config.width) {\n       params += `,w-${config.width}`;\n     }\n-    const url = `${path}/${params}/${normalizeSrc(config.src)}`;\n-    return url;\n+    return `${path}/${params}/${config.src}`;\n   };\n }\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts\n\n@@ -6,8 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {normalizeSrc} from '../util';\n-\n import {createImageLoader, ImageLoaderConfig} from './image_loader';\n \n /**\n@@ -27,7 +25,7 @@ export const provideImgixLoader =\n \n function imgixLoaderFactory(path: string) {\n   return (config: ImageLoaderConfig) => {\n-    const url = new URL(`${path}/${normalizeSrc(config.src)}`);\n+    const url = new URL(`${path}/${config.src}`);\n     // This setting ensures the smallest allowable format is set.\n     url.searchParams.set('auto', 'format');\n     if (config.width) {\n\n\n###\n\n", "completion": "refactor(common): remove code duplication in image loaders (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/errors.md | file path B: goldens/public-api/common/errors.md\n\n@@ -9,6 +9,8 @@ export const enum RuntimeErrorCode {\n     // (undocumented)\n     INVALID_INPUT = 2952,\n     // (undocumented)\n+    INVALID_LOADER_ARGUMENTS = 2959,\n+    // (undocumented)\n     INVALID_PIPE_ARGUMENT = 2100,\n     // (undocumented)\n     INVALID_PRECONNECT_CHECK_BLOCKLIST = 2957,\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts\n\n@@ -10,7 +10,7 @@ import {InjectionToken, Provider, \u0275RuntimeError as RuntimeError} from '@angular\n \n import {RuntimeErrorCode} from '../../../errors';\n import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n-import {isValidPath, normalizePath} from '../util';\n+import {isAbsoluteURL, isValidPath, normalizePath} from '../util';\n \n /**\n  * Config options recognized by the image loader function.\n@@ -50,7 +50,14 @@ export function createImageLoader(urlFn: (path: string) => ImageLoader, exampleU\n     }\n     path = normalizePath(path);\n \n-    const providers: Provider[] = [{provide: IMAGE_LOADER, useValue: urlFn(path)}];\n+    const loaderFn = (config: ImageLoaderConfig) => {\n+      if (ngDevMode && isAbsoluteURL(config.src)) {\n+        throwUnexpectedAbsoluteUrlError(path, config.src);\n+      }\n+      const loader = urlFn(path);\n+      return loader(config);\n+    };\n+    const providers: Provider[] = [{provide: IMAGE_LOADER, useValue: loaderFn}];\n \n     if (ngDevMode && options.ensurePreconnect === false) {\n       providers.push({provide: PRECONNECT_CHECK_BLOCKLIST, useValue: [path], multi: true});\n@@ -63,8 +70,18 @@ export function createImageLoader(urlFn: (path: string) => ImageLoader, exampleU\n function throwInvalidPathError(path: unknown, exampleUrls: string[]): never {\n   const exampleUrlsMsg = exampleUrls.join(' or ');\n   throw new RuntimeError(\n-      RuntimeErrorCode.INVALID_INPUT,\n+      RuntimeErrorCode.INVALID_LOADER_ARGUMENTS,\n       `Image loader has detected an invalid path. ` +\n           `Expecting a path matching one of the following formats: ${exampleUrlsMsg}` +\n           ` - but got: \\`${path}\\``);\n }\n+\n+function throwUnexpectedAbsoluteUrlError(path: string, url: string): never {\n+  throw new RuntimeError(\n+      RuntimeErrorCode.INVALID_LOADER_ARGUMENTS,\n+      `Image loader has detected an absolute URL used for one of the \\`rawSrc\\` ` +\n+          `attributes on an \\`<img>\\` tag: ${url}. The absolute URLs are not ` +\n+          `supported by this image loader. Please update the \\`rawSrc\\` attribute ` +\n+          `of that \\`<img>\\` tag to use a path relative to the base URL configured ` +\n+          `for this loader (\\`${path}\\`).`);\n+}\n\n---\n file path A: packages/common/src/errors.ts | file path B: packages/common/src/errors.ts\n\n@@ -30,4 +30,5 @@ export const enum RuntimeErrorCode {\n   PRIORITY_IMG_MISSING_PRECONNECT_TAG = 2956,\n   INVALID_PRECONNECT_CHECK_BLOCKLIST = 2957,\n   UNEXPECTED_DEV_MODE_CHECK_IN_PROD_MODE = 2958,\n+  INVALID_LOADER_ARGUMENTS = 2959,\n }\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -755,6 +755,22 @@ describe('Image directive', () => {\n          expect(imgs[1].src.trim()).toBe(`${IMG_BASE_URL}/img-2.png`);\n        });\n \n+    it('should pass absolute URLs defined in the `rawSrc` to custom image loaders provided via the `IMAGE_LOADER` token',\n+       () => {\n+         const imageLoader = (config: ImageLoaderConfig) => `${config.src}?rewritten=true`;\n+         setupTestingModule({imageLoader});\n+\n+         const template = `\n+            <img rawSrc=\"${IMG_BASE_URL}/img.png\" width=\"150\" height=\"50\">\n+          `;\n+         const fixture = createTestComponent(template);\n+         fixture.detectChanges();\n+\n+         const nativeElement = fixture.nativeElement as HTMLElement;\n+         const imgs = nativeElement.querySelectorAll('img')!;\n+         expect(imgs[0].src.trim()).toBe(`${IMG_BASE_URL}/img.png?rewritten=true`);\n+       });\n+\n     it('should set `src` to an image URL that does not include a default width parameter', () => {\n       const imageLoader = (config: ImageLoaderConfig) => {\n         const widthStr = config.width ? `?w=${config.width}` : ``;\n\n---\n file path A: packages/common/test/image_loaders/image_loader_spec.ts | file path B: packages/common/test/image_loaders/image_loader_spec.ts\n\n@@ -48,6 +48,19 @@ describe('Built-in image directive loaders', () => {\n       const config = {src: 'img.png', width: 100};\n       expect(loader(config)).toBe(`${path}/img.png?auto=format&w=100`);\n     });\n+\n+    it('should throw if an absolute URL is provided as a loader input', () => {\n+      const path = 'https://somesite.imgix.net';\n+      const src = 'https://angular.io/img.png';\n+      const loader = createImgixLoader(path);\n+      expect(() => loader({src}))\n+          .toThrowError(\n+              `NG02959: Image loader has detected an absolute URL used for one ` +\n+              `of the \\`rawSrc\\` attributes on an \\`<img>\\` tag: ${src}. ` +\n+              `The absolute URLs are not supported by this image loader. Please update ` +\n+              `the \\`rawSrc\\` attribute of that \\`<img>\\` tag to use a path relative to the ` +\n+              `base URL configured for this loader (\\`${path}\\`).`);\n+    });\n   });\n \n   describe('Cloudinary loader', () => {\n@@ -66,10 +79,23 @@ describe('Built-in image directive loaders', () => {\n     });\n \n     describe('input validation', () => {\n+      it('should throw if an absolute URL is provided as a loader input', () => {\n+        const path = 'https://res.cloudinary.com/mysite';\n+        const src = 'https://angular.io/img.png';\n+        const loader = createCloudinaryLoader(path);\n+        expect(() => loader({src}))\n+            .toThrowError(\n+                `NG02959: Image loader has detected an absolute URL used for one ` +\n+                `of the \\`rawSrc\\` attributes on an \\`<img>\\` tag: ${src}. ` +\n+                `The absolute URLs are not supported by this image loader. Please update ` +\n+                `the \\`rawSrc\\` attribute of that \\`<img>\\` tag to use a path relative to the ` +\n+                `base URL configured for this loader (\\`${path}\\`).`);\n+      });\n+\n       it('should throw if the path is invalid', () => {\n         expect(() => provideCloudinaryLoader('my-cloudinary-account'))\n             .toThrowError(\n-                `NG02952: Image loader has detected an invalid path. ` +\n+                `NG02959: Image loader has detected an invalid path. ` +\n                 `Expecting a path matching one of the following formats: ` +\n                 `https://res.cloudinary.com/mysite or https://mysite.cloudinary.com ` +\n                 `or https://subdomain.mysite.com - but got: \\`my-cloudinary-account\\``);\n@@ -103,10 +129,23 @@ describe('Built-in image directive loaders', () => {\n     });\n \n     describe('input validation', () => {\n+      it('should throw if an absolute URL is provided as a loader input', () => {\n+        const path = 'https://ik.imageengine.io/imagetest';\n+        const src = 'https://angular.io/img.png';\n+        const loader = createImageKitLoader(path);\n+        expect(() => loader({src}))\n+            .toThrowError(\n+                `NG02959: Image loader has detected an absolute URL used for one ` +\n+                `of the \\`rawSrc\\` attributes on an \\`<img>\\` tag: ${src}. ` +\n+                `The absolute URLs are not supported by this image loader. Please update ` +\n+                `the \\`rawSrc\\` attribute of that \\`<img>\\` tag to use a path relative to the ` +\n+                `base URL configured for this loader (\\`${path}\\`).`);\n+      });\n+\n       it('should throw if the path is invalid', () => {\n         expect(() => provideImageKitLoader('my-imagekit-account'))\n             .toThrowError(\n-                `NG02952: Image loader has detected an invalid path. ` +\n+                `NG02959: Image loader has detected an invalid path. ` +\n                 `Expecting a path matching one of the following formats: ` +\n                 `https://ik.imagekit.io/mysite or https://subdomain.mysite.com - ` +\n                 `but got: \\`my-imagekit-account\\``);\n@@ -141,6 +180,19 @@ describe('Built-in image directive loaders', () => {\n       const config = {src: 'img.png', width: 100};\n       expect(loader(config)).toBe('https://mysite.com/cdn-cgi/image/format=auto,width=100/img.png');\n     });\n+\n+    it('should throw if an absolute URL is provided as a loader input', () => {\n+      const path = 'https://mysite.com';\n+      const src = 'https://angular.io/img.png';\n+      const loader = createCloudflareLoader(path);\n+      expect(() => loader({src}))\n+          .toThrowError(\n+              `NG02959: Image loader has detected an absolute URL used for one ` +\n+              `of the \\`rawSrc\\` attributes on an \\`<img>\\` tag: ${src}. ` +\n+              `The absolute URLs are not supported by this image loader. Please update ` +\n+              `the \\`rawSrc\\` attribute of that \\`<img>\\` tag to use a path relative to the ` +\n+              `base URL configured for this loader (\\`${path}\\`).`);\n+    });\n   });\n \n   describe('ensurePreconnect option', () => {\n\n\n###\n\n", "completion": "refactor(common): throw an error if an absolute URL is passed to Image Loaders (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts\n\n@@ -6,9 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275RuntimeError as RuntimeError} from '@angular/core';\n-\n-import {RuntimeErrorCode} from '../../../errors';\n import {normalizeSrc} from '../util';\n \n import {createImageLoader, ImageLoaderConfig} from './image_loader';\n@@ -23,8 +20,9 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  * e.g. https://mysite.com\n  * @returns Provider that provides an ImageLoader function\n  */\n-export const provideCloudflareLoader =\n-    createImageLoader(cloudflareLoaderFactory, throwInvalidPathError);\n+export const provideCloudflareLoader = createImageLoader(\n+    cloudflareLoaderFactory,\n+    ngDevMode ? ['https://<ZONE>/cdn-cgi/image/<OPTIONS>/<SOURCE-IMAGE>'] : undefined);\n \n function cloudflareLoaderFactory(path: string) {\n   return (config: ImageLoaderConfig) => {\n@@ -36,11 +34,3 @@ function cloudflareLoaderFactory(path: string) {\n     return url;\n   };\n }\n-\n-function throwInvalidPathError(path: unknown): never {\n-  throw new RuntimeError(\n-      RuntimeErrorCode.INVALID_INPUT,\n-      `CloudflareLoader has detected an invalid path: ` +\n-          `expecting a path like https://<ZONE>/cdn-cgi/image/<OPTIONS>/<SOURCE-IMAGE>` +\n-          `but got: \\`${path}\\``);\n-}\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts\n\n@@ -6,9 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275RuntimeError as RuntimeError} from '@angular/core';\n-\n-import {RuntimeErrorCode} from '../../../errors';\n import {normalizeSrc} from '../util';\n \n import {createImageLoader, ImageLoaderConfig} from './image_loader';\n@@ -28,8 +25,14 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  *                       present in the document's `<head>`.\n  * @returns Set of providers to configure the Cloudinary loader.\n  */\n-export const provideCloudinaryLoader =\n-    createImageLoader(cloudinaryLoaderFactory, throwInvalidPathError);\n+export const provideCloudinaryLoader = createImageLoader(\n+    cloudinaryLoaderFactory,\n+    ngDevMode ?\n+        [\n+          'https://res.cloudinary.com/mysite', 'https://mysite.cloudinary.com',\n+          'https://subdomain.mysite.com'\n+        ] :\n+        undefined);\n \n function cloudinaryLoaderFactory(path: string) {\n   return (config: ImageLoaderConfig) => {\n@@ -43,11 +46,3 @@ function cloudinaryLoaderFactory(path: string) {\n     return url;\n   };\n }\n-\n-function throwInvalidPathError(path: unknown): never {\n-  throw new RuntimeError(\n-      RuntimeErrorCode.INVALID_INPUT,\n-      `CloudinaryLoader has detected an invalid path: ` +\n-          `expecting a path matching one of the following formats: https://res.cloudinary.com/mysite, https://mysite.cloudinary.com, or https://subdomain.mysite.com - ` +\n-          `but got: \\`${path}\\``);\n-}\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts\n\n@@ -6,10 +6,11 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {InjectionToken, Provider} from '@angular/core';\n+import {InjectionToken, Provider, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n+import {RuntimeErrorCode} from '../../../errors';\n import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n-import {isValidPath, normalizePath, normalizeSrc} from '../util';\n+import {isValidPath, normalizePath} from '../util';\n \n /**\n  * Config options recognized by the image loader function.\n@@ -41,14 +42,11 @@ export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n   factory: () => noopImageLoader,\n });\n \n-export function createImageLoader(\n-    urlFn: (path: string) => ImageLoader,\n-    invalidPathFn: (path: unknown) => void,\n-) {\n+export function createImageLoader(urlFn: (path: string) => ImageLoader, exampleUrls?: string[]) {\n   return function provideImageLoader(\n       path: string, options: {ensurePreconnect?: boolean} = {ensurePreconnect: true}) {\n     if (ngDevMode && !isValidPath(path)) {\n-      invalidPathFn(path);\n+      throwInvalidPathError(path, exampleUrls || []);\n     }\n     path = normalizePath(path);\n \n@@ -61,3 +59,12 @@ export function createImageLoader(\n     return providers;\n   };\n }\n+\n+function throwInvalidPathError(path: unknown, exampleUrls: string[]): never {\n+  const exampleUrlsMsg = exampleUrls.join(' or ');\n+  throw new RuntimeError(\n+      RuntimeErrorCode.INVALID_INPUT,\n+      `Image loader has detected an invalid path. ` +\n+          `Expecting a path matching one of the following formats: ${exampleUrlsMsg}` +\n+          ` - but got: \\`${path}\\``);\n+}\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts\n\n@@ -6,9 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275RuntimeError as RuntimeError} from '@angular/core';\n-\n-import {RuntimeErrorCode} from '../../../errors';\n import {normalizeSrc} from '../util';\n \n import {createImageLoader, ImageLoaderConfig} from './image_loader';\n@@ -27,8 +24,9 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  *                       present in the document's `<head>`.\n  * @returns Set of providers to configure the ImageKit loader.\n  */\n-export const provideImageKitLoader =\n-    createImageLoader(imagekitLoaderFactory, throwInvalidPathError);\n+export const provideImageKitLoader = createImageLoader(\n+    imagekitLoaderFactory,\n+    ngDevMode ? ['https://ik.imagekit.io/mysite', 'https://subdomain.mysite.com'] : undefined);\n \n export function imagekitLoaderFactory(path: string) {\n   return (config: ImageLoaderConfig) => {\n@@ -42,11 +40,3 @@ export function imagekitLoaderFactory(path: string) {\n     return url;\n   };\n }\n-\n-function throwInvalidPathError(path: unknown): never {\n-  throw new RuntimeError(\n-      RuntimeErrorCode.INVALID_INPUT,\n-      `ImageKitLoader has detected an invalid path: ` +\n-          `expecting a path matching one of the following formats: https://ik.imagekit.io/mysite or https://subdomain.mysite.com - ` +\n-          `but got: \\`${path}\\``);\n-}\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts\n\n@@ -6,9 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275RuntimeError as RuntimeError} from '@angular/core';\n-\n-import {RuntimeErrorCode} from '../../../errors';\n import {normalizeSrc} from '../util';\n \n import {createImageLoader, ImageLoaderConfig} from './image_loader';\n@@ -25,7 +22,8 @@ import {createImageLoader, ImageLoaderConfig} from './image_loader';\n  *                       present in the document's `<head>`.\n  * @returns Set of providers to configure the Imgix loader.\n  */\n-export const provideImgixLoader = createImageLoader(imgixLoaderFactory, throwInvalidPathError);\n+export const provideImgixLoader =\n+    createImageLoader(imgixLoaderFactory, ngDevMode ? ['https://somepath.imgix.net/'] : undefined);\n \n function imgixLoaderFactory(path: string) {\n   return (config: ImageLoaderConfig) => {\n@@ -38,11 +36,3 @@ function imgixLoaderFactory(path: string) {\n     return url.href;\n   };\n }\n-\n-function throwInvalidPathError(path: unknown): never {\n-  throw new RuntimeError(\n-      RuntimeErrorCode.INVALID_INPUT,\n-      `ImgixLoader has detected an invalid path: ` +\n-          `expecting a path like https://somepath.imgix.net/` +\n-          `but got: \\`${path}\\``);\n-}\n\n---\n file path A: packages/common/test/image_loaders/image_loader_spec.ts | file path B: packages/common/test/image_loaders/image_loader_spec.ts\n\n@@ -69,9 +69,9 @@ describe('Built-in image directive loaders', () => {\n       it('should throw if the path is invalid', () => {\n         expect(() => provideCloudinaryLoader('my-cloudinary-account'))\n             .toThrowError(\n-                `NG02952: CloudinaryLoader has detected an invalid path: ` +\n-                `expecting a path matching one of the following formats: ` +\n-                `https://res.cloudinary.com/mysite, https://mysite.cloudinary.com, ` +\n+                `NG02952: Image loader has detected an invalid path. ` +\n+                `Expecting a path matching one of the following formats: ` +\n+                `https://res.cloudinary.com/mysite or https://mysite.cloudinary.com ` +\n                 `or https://subdomain.mysite.com - but got: \\`my-cloudinary-account\\``);\n       });\n \n@@ -106,8 +106,8 @@ describe('Built-in image directive loaders', () => {\n       it('should throw if the path is invalid', () => {\n         expect(() => provideImageKitLoader('my-imagekit-account'))\n             .toThrowError(\n-                `NG02952: ImageKitLoader has detected an invalid path: ` +\n-                `expecting a path matching one of the following formats: ` +\n+                `NG02952: Image loader has detected an invalid path. ` +\n+                `Expecting a path matching one of the following formats: ` +\n                 `https://ik.imagekit.io/mysite or https://subdomain.mysite.com - ` +\n                 `but got: \\`my-imagekit-account\\``);\n       });\n\n\n###\n\n", "completion": "refactor(common): unify url error reporting in image loaders (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts\n\n@@ -30,7 +30,7 @@ function cloudflareLoaderFactory(path: string) {\n   return (config: ImageLoaderConfig) => {\n     let params = `format=auto`;\n     if (config.width) {\n-      params += `,width=${config.width.toString()}`;\n+      params += `,width=${config.width}`;\n     }\n     const url = `${path}/cdn-cgi/image/${params}/${normalizeSrc(config.src)}`;\n     return url;\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts\n\n@@ -36,7 +36,7 @@ export function imagekitLoaderFactory(path: string) {\n     // https://ik.imagekit.io/demo/tr:w-300,h-300/medium_cafe_B1iTdD0C.jpg\n     let params = `tr:q-auto`;  // applies the \"auto quality\" transformation\n     if (config.width) {\n-      params += `,w-${config.width?.toString()}`;\n+      params += `,w-${config.width}`;\n     }\n     const url = `${path}/${params}/${normalizeSrc(config.src)}`;\n     return url;\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts\n\n@@ -32,7 +32,9 @@ function imgixLoaderFactory(path: string) {\n     const url = new URL(`${path}/${normalizeSrc(config.src)}`);\n     // This setting ensures the smallest allowable format is set.\n     url.searchParams.set('auto', 'format');\n-    config.width && url.searchParams.set('w', config.width.toString());\n+    if (config.width) {\n+      url.searchParams.set('w', config.width.toString());\n+    }\n     return url.href;\n   };\n }\n\n\n###\n\n", "completion": "refactor(common): remove unnecessary toString conversions (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Directive, ElementRef, Inject, Injector, Input, NgModule, NgZone, OnChanges, OnDestroy, OnInit, Renderer2, SimpleChanges, \u0275_sanitizeUrl as sanitizeUrl, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {Directive, ElementRef, Inject, Injector, Input, NgModule, NgZone, OnChanges, OnDestroy, OnInit, Renderer2, SimpleChanges, \u0275_sanitizeUrl as sanitizeUrl, \u0275formatRuntimeError as formatRuntimeError, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../../errors';\n \n@@ -451,7 +451,7 @@ function assertNoImageDistortion(\n     const stylingDistortion = nonZeroRenderedDimensions &&\n         Math.abs(intrinsicAspectRatio - renderedAspectRatio) > ASPECT_RATIO_TOLERANCE;\n     if (inaccurateDimensions) {\n-      console.warn(\n+      console.warn(formatRuntimeError(\n           RuntimeErrorCode.INVALID_INPUT,\n           `${imgDirectiveDetails(dir.rawSrc)} has detected that the aspect ratio of the ` +\n               `image does not match the aspect ratio indicated by the width and height attributes. ` +\n@@ -459,10 +459,10 @@ function assertNoImageDistortion(\n                   intrinsicAspectRatio}). ` +\n               `Supplied width and height attributes: ${suppliedWidth}w x ${\n                   suppliedHeight}h (aspect-ratio: ${suppliedAspectRatio}). ` +\n-              `To fix this, update the width and height attributes.`);\n+              `To fix this, update the width and height attributes.`));\n     } else {\n       if (stylingDistortion) {\n-        console.warn(\n+        console.warn(formatRuntimeError(\n             RuntimeErrorCode.INVALID_INPUT,\n             `${imgDirectiveDetails(dir.rawSrc)} has detected that the aspect ratio of the ` +\n                 `rendered image does not match the image's intrinsic aspect ratio. ` +\n@@ -472,7 +472,7 @@ function assertNoImageDistortion(\n                     renderedAspectRatio}). ` +\n                 `This issue can occur if \"width\" and \"height\" attributes are added to an image ` +\n                 `without updating the corresponding image styling. In most cases, ` +\n-                `adding \"height: auto\" or \"width: auto\" to the image styling will fix this issue.`);\n+                `adding \"height: auto\" or \"width: auto\" to the image styling will fix this issue.`));\n       }\n     }\n   });\n\n\n###\n\n", "completion": "refactor(common): add missing format error call in NgOptimizedImage (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts\n\n@@ -54,7 +54,7 @@ export function createImageLoader(\n \n     const providers: Provider[] = [{provide: IMAGE_LOADER, useValue: urlFn(path)}];\n \n-    if (ngDevMode && Boolean(options.ensurePreconnect) === true) {\n+    if (ngDevMode && options.ensurePreconnect === false) {\n       providers.push({provide: PRECONNECT_CHECK_BLOCKLIST, useValue: [path], multi: true});\n     }\n \n\n---\n file path A: packages/common/test/image_loaders/image_loader_spec.ts | file path B: packages/common/test/image_loaders/image_loader_spec.ts\n\n@@ -48,38 +48,6 @@ describe('Built-in image directive loaders', () => {\n       const config = {src: 'img.png', width: 100};\n       expect(loader(config)).toBe(`${path}/img.png?auto=format&w=100`);\n     });\n-\n-    describe('options', () => {\n-      it('should configure PRECONNECT_CHECK_BLOCKLIST token by default', () => {\n-        const path = 'https://somesite.imgix.net';\n-        const providers = provideImgixLoader(path);\n-        expect(providers.length).toBe(2);\n-\n-        const valueProvider = providers[1] as ValueProvider;\n-        expect(valueProvider.multi).toBeTrue();\n-        expect(valueProvider.useValue).toEqual([path]);\n-        expect(valueProvider.provide).toBe(PRECONNECT_CHECK_BLOCKLIST);\n-      });\n-\n-      it('should configure PRECONNECT_CHECK_BLOCKLIST when the ensurePreconnect was specified',\n-         () => {\n-           const path = 'https://somesite.imgix.net';\n-           const providers = provideImgixLoader(path, {ensurePreconnect: true});\n-           expect(providers.length).toBe(2);\n-\n-           const valueProvider = providers[1] as ValueProvider;\n-           expect(valueProvider.multi).toBeTrue();\n-           expect(valueProvider.useValue).toEqual([path]);\n-           expect(valueProvider.provide).toBe(PRECONNECT_CHECK_BLOCKLIST);\n-         });\n-\n-      it('should NOT configure PRECONNECT_CHECK_BLOCKLIST disabled with the ensurePreconnect option',\n-         () => {\n-           const providers =\n-               provideImgixLoader('https://somesite.imgix.net', {ensurePreconnect: false});\n-           expect(providers.length).toBe(1);\n-         });\n-    });\n   });\n \n   describe('Cloudinary loader', () => {\n@@ -119,38 +87,6 @@ describe('Built-in image directive loaders', () => {\n         expect(loader({src: '/img.png'})).toBe(`${path}/image/upload/f_auto,q_auto/img.png`);\n       });\n     });\n-\n-    describe('options', () => {\n-      it('should configure PRECONNECT_CHECK_BLOCKLIST token by default', () => {\n-        const path = 'https://res.cloudinary.com/mysite';\n-        const providers = provideCloudinaryLoader(path);\n-        expect(providers.length).toBe(2);\n-\n-        const valueProvider = providers[1] as ValueProvider;\n-        expect(valueProvider.multi).toBeTrue();\n-        expect(valueProvider.useValue).toEqual([path]);\n-        expect(valueProvider.provide).toBe(PRECONNECT_CHECK_BLOCKLIST);\n-      });\n-\n-      it('should configure PRECONNECT_CHECK_BLOCKLIST when the ensurePreconnect was specified',\n-         () => {\n-           const path = 'https://res.cloudinary.com/mysite';\n-           const providers = provideCloudinaryLoader(path, {ensurePreconnect: true});\n-           expect(providers.length).toBe(2);\n-\n-           const valueProvider = providers[1] as ValueProvider;\n-           expect(valueProvider.multi).toBeTrue();\n-           expect(valueProvider.useValue).toEqual([path]);\n-           expect(valueProvider.provide).toBe(PRECONNECT_CHECK_BLOCKLIST);\n-         });\n-\n-      it('should NOT configure PRECONNECT_CHECK_BLOCKLIST disabled with the ensurePreconnect option',\n-         () => {\n-           const providers = provideCloudinaryLoader(\n-               'https://res.cloudinary.com/mysite', {ensurePreconnect: false});\n-           expect(providers.length).toBe(1);\n-         });\n-    });\n   });\n \n   describe('ImageKit loader', () => {\n@@ -188,38 +124,6 @@ describe('Built-in image directive loaders', () => {\n         expect(loader({src: '/img.png'})).toBe(`${path}/tr:q-auto/img.png`);\n       });\n     });\n-\n-    describe('options', () => {\n-      it('should configure PRECONNECT_CHECK_BLOCKLIST token by default', () => {\n-        const path = 'https://ik.imageengine.io/imagetest';\n-        const providers = provideImageKitLoader(path);\n-        expect(providers.length).toBe(2);\n-\n-        const valueProvider = providers[1] as ValueProvider;\n-        expect(valueProvider.multi).toBeTrue();\n-        expect(valueProvider.useValue).toEqual([path]);\n-        expect(valueProvider.provide).toBe(PRECONNECT_CHECK_BLOCKLIST);\n-      });\n-\n-      it('should configure PRECONNECT_CHECK_BLOCKLIST when the ensurePreconnect was specified',\n-         () => {\n-           const path = 'https://ik.imageengine.io/imagetest';\n-           const providers = provideImageKitLoader(path, {ensurePreconnect: true});\n-           expect(providers.length).toBe(2);\n-\n-           const valueProvider = providers[1] as ValueProvider;\n-           expect(valueProvider.multi).toBeTrue();\n-           expect(valueProvider.useValue).toEqual([path]);\n-           expect(valueProvider.provide).toBe(PRECONNECT_CHECK_BLOCKLIST);\n-         });\n-\n-      it('should NOT configure PRECONNECT_CHECK_BLOCKLIST disabled with the ensurePreconnect option',\n-         () => {\n-           const providers = provideImageKitLoader(\n-               'https://ik.imageengine.io/imagetest', {ensurePreconnect: false});\n-           expect(providers.length).toBe(1);\n-         });\n-    });\n   });\n \n   describe('Cloudflare loader', () => {\n@@ -239,6 +143,44 @@ describe('Built-in image directive loaders', () => {\n     });\n   });\n \n+  describe('ensurePreconnect option', () => {\n+    const path = 'https://some.host/base';\n+\n+    [provideImgixLoader,\n+     provideCloudinaryLoader,\n+     provideImageKitLoader,\n+     provideCloudflareLoader,\n+    ].forEach(provideImageLoader => {\n+      it(`${provideImageLoader.name} should _not_ block-list path by default`, () => {\n+        const providers = provideImageLoader(path);\n+\n+        expect(providers.length).toBe(1);\n+        const valueProvider = providers[0] as ValueProvider;\n+        expect(valueProvider.provide).not.toBe(PRECONNECT_CHECK_BLOCKLIST);\n+      });\n+\n+      it(`${provideImageLoader.name} should _not_ block-list path when ensurePreconnect is true`,\n+         () => {\n+           const providers = provideImageLoader(path, {ensurePreconnect: true});\n+\n+           expect(providers.length).toBe(1);\n+           const valueProvider = providers[0] as ValueProvider;\n+           expect(valueProvider.provide).not.toBe(PRECONNECT_CHECK_BLOCKLIST);\n+         });\n+\n+      it('`${provideImageLoader.name} should block-list path when ensurePreconnect is false',\n+         () => {\n+           const providers = provideImageLoader(path, {ensurePreconnect: false});\n+           expect(providers.length).toBe(2);\n+\n+           const valueProvider = providers[1] as ValueProvider;\n+           expect(valueProvider.multi).toBeTrue();\n+           expect(valueProvider.useValue).toEqual([path]);\n+           expect(valueProvider.provide).toBe(PRECONNECT_CHECK_BLOCKLIST);\n+         });\n+    });\n+  });\n+\n   describe('loader utils', () => {\n     it('should identify valid paths', () => {\n       expect(isValidPath('https://cdn.imageprovider.com/image-test')).toBe(true);\n\n\n###\n\n", "completion": "refactor(common): properly configure PRECONNECT_CHECK_BLOCKLIST (#<issue-num>)"}
{"prompt": " file path A: packages/common/test/image_loaders/image_loader_spec.ts | file path B: packages/common/test/image_loaders/image_loader_spec.ts\n\n@@ -222,32 +222,6 @@ describe('Built-in image directive loaders', () => {\n     });\n   });\n \n-  describe('loader utils', () => {\n-    describe('path validation', () => {\n-      it('should identify valid paths', () => {\n-        expect(isValidPath('https://cdn.imageprovider.com/image-test')).toBe(true);\n-        expect(isValidPath('https://cdn.imageprovider.com')).toBe(true);\n-        expect(isValidPath('https://imageprovider.com')).toBe(true);\n-      });\n-\n-      it('should reject empty paths', () => {\n-        expect(isValidPath('')).toBe(false);\n-      });\n-\n-      it('should reject path if it is not a URL', () => {\n-        expect(isValidPath('myaccount')).toBe(false);\n-      });\n-\n-      it('should reject path if it does not include a protocol', () => {\n-        expect(isValidPath('myaccount.imageprovider.com')).toBe(false);\n-      });\n-\n-      it('should reject path if is malformed', () => {\n-        expect(isValidPath('somepa\\th.imageprovider.com? few')).toBe(false);\n-      });\n-    });\n-  });\n-\n   describe('Cloudflare loader', () => {\n     function createCloudflareLoader(path: string): ImageLoader {\n       const injector = createEnvironmentInjector([provideCloudflareLoader(path)]);\n@@ -264,4 +238,28 @@ describe('Built-in image directive loaders', () => {\n       expect(loader(config)).toBe('https://mysite.com/cdn-cgi/image/format=auto,width=100/img.png');\n     });\n   });\n+\n+  describe('loader utils', () => {\n+    it('should identify valid paths', () => {\n+      expect(isValidPath('https://cdn.imageprovider.com/image-test')).toBe(true);\n+      expect(isValidPath('https://cdn.imageprovider.com')).toBe(true);\n+      expect(isValidPath('https://imageprovider.com')).toBe(true);\n+    });\n+\n+    it('should reject empty paths', () => {\n+      expect(isValidPath('')).toBe(false);\n+    });\n+\n+    it('should reject path if it is not a URL', () => {\n+      expect(isValidPath('myaccount')).toBe(false);\n+    });\n+\n+    it('should reject path if it does not include a protocol', () => {\n+      expect(isValidPath('myaccount.imageprovider.com')).toBe(false);\n+    });\n+\n+    it('should reject path if is malformed', () => {\n+      expect(isValidPath('somepa\\th.imageprovider.com? few')).toBe(false);\n+    });\n+  });\n });\n\n\n###\n\n", "completion": "test(common): remove unneeded describe block (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts\n\n@@ -6,13 +6,12 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Provider, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {\u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../../../errors';\n-import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n-import {isValidPath, normalizePath, normalizeSrc} from '../util';\n+import {normalizeSrc} from '../util';\n \n-import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n+import {createImageLoader, ImageLoaderConfig} from './image_loader';\n \n /**\n  * Function that generates a built-in ImageLoader for Cloudflare Image Resizing\n@@ -24,31 +23,18 @@ import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n  * e.g. https://mysite.com\n  * @returns Provider that provides an ImageLoader function\n  */\n-export function provideCloudflareLoader(path: string, options: {ensurePreconnect?: boolean} = {\n-  ensurePreconnect: true\n-}) {\n-  if (ngDevMode && !isValidPath(path)) {\n-    throwInvalidPathError(path);\n-  }\n-  path = normalizePath(path);\n-\n-  const providers: Provider[] = [{\n-    provide: IMAGE_LOADER,\n-    useValue: (config: ImageLoaderConfig) => {\n-      let params = `format=auto`;\n-      if (config.width) {\n-        params += `,width=${config.width.toString()}`;\n-      }\n-      const url = `${path}/cdn-cgi/image/${params}/${normalizeSrc(config.src)}`;\n-      return url;\n+export const provideCloudflareLoader =\n+    createImageLoader(cloudflareLoaderFactory, throwInvalidPathError);\n+\n+function cloudflareLoaderFactory(path: string) {\n+  return (config: ImageLoaderConfig) => {\n+    let params = `format=auto`;\n+    if (config.width) {\n+      params += `,width=${config.width.toString()}`;\n     }\n-  }];\n-\n-  if (ngDevMode && Boolean(options.ensurePreconnect) === true) {\n-    providers.push({provide: PRECONNECT_CHECK_BLOCKLIST, useValue: [path], multi: true});\n-  }\n-\n-  return providers;\n+    const url = `${path}/cdn-cgi/image/${params}/${normalizeSrc(config.src)}`;\n+    return url;\n+  };\n }\n \n function throwInvalidPathError(path: unknown): never {\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts\n\n@@ -6,13 +6,12 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Provider, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {\u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../../../errors';\n-import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n-import {isValidPath, normalizePath, normalizeSrc} from '../util';\n+import {normalizeSrc} from '../util';\n \n-import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n+import {createImageLoader, ImageLoaderConfig} from './image_loader';\n \n /**\n  * Function that generates a built-in ImageLoader for Cloudinary\n@@ -29,37 +28,20 @@ import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n  *                       present in the document's `<head>`.\n  * @returns Set of providers to configure the Cloudinary loader.\n  */\n-export function provideCloudinaryLoader(path: string, options: {ensurePreconnect?: boolean} = {\n-  ensurePreconnect: true\n-}): Provider[] {\n-  if (ngDevMode && !isValidPath(path)) {\n-    throwInvalidPathError(path);\n-  }\n-  path = normalizePath(path);\n-\n-  const providers: Provider[] = [{\n-    provide: IMAGE_LOADER,\n-    useValue: (config: ImageLoaderConfig) => {\n-      // Example of a Cloudinary image URL:\n-      // https://res.cloudinary.com/mysite/image/upload/c_scale,f_auto,q_auto,w_600/marketing/tile-topics-m.png\n-      let params = `f_auto,q_auto`;  // sets image format and quality to \"auto\"\n-      if (config.width) {\n-        params += `,w_${config.width}`;\n-      }\n-      const url = `${path}/image/upload/${params}/${normalizeSrc(config.src)}`;\n-      return url;\n+export const provideCloudinaryLoader =\n+    createImageLoader(cloudinaryLoaderFactory, throwInvalidPathError);\n+\n+function cloudinaryLoaderFactory(path: string) {\n+  return (config: ImageLoaderConfig) => {\n+    // Example of a Cloudinary image URL:\n+    // https://res.cloudinary.com/mysite/image/upload/c_scale,f_auto,q_auto,w_600/marketing/tile-topics-m.png\n+    let params = `f_auto,q_auto`;  // sets image format and quality to \"auto\"\n+    if (config.width) {\n+      params += `,w_${config.width}`;\n     }\n-  }];\n-\n-  if (ngDevMode && Boolean(options.ensurePreconnect) === true) {\n-    providers.push({\n-      provide: PRECONNECT_CHECK_BLOCKLIST,\n-      useValue: [path],\n-      multi: true,\n-    });\n-  }\n-\n-  return providers;\n+    const url = `${path}/image/upload/${params}/${normalizeSrc(config.src)}`;\n+    return url;\n+  };\n }\n \n function throwInvalidPathError(path: unknown): never {\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts\n\n@@ -6,7 +6,10 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {InjectionToken} from '@angular/core';\n+import {InjectionToken, Provider} from '@angular/core';\n+\n+import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n+import {isValidPath, normalizePath, normalizeSrc} from '../util';\n \n /**\n  * Config options recognized by the image loader function.\n@@ -37,3 +40,24 @@ export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n   providedIn: 'root',\n   factory: () => noopImageLoader,\n });\n+\n+export function createImageLoader(\n+    urlFn: (path: string) => ImageLoader,\n+    invalidPathFn: (path: unknown) => void,\n+) {\n+  return function provideImageLoader(\n+      path: string, options: {ensurePreconnect?: boolean} = {ensurePreconnect: true}) {\n+    if (ngDevMode && !isValidPath(path)) {\n+      invalidPathFn(path);\n+    }\n+    path = normalizePath(path);\n+\n+    const providers: Provider[] = [{provide: IMAGE_LOADER, useValue: urlFn(path)}];\n+\n+    if (ngDevMode && Boolean(options.ensurePreconnect) === true) {\n+      providers.push({provide: PRECONNECT_CHECK_BLOCKLIST, useValue: [path], multi: true});\n+    }\n+\n+    return providers;\n+  };\n+}\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts\n\n@@ -6,13 +6,12 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Provider, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {\u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../../../errors';\n-import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n-import {isValidPath, normalizePath, normalizeSrc} from '../util';\n+import {normalizeSrc} from '../util';\n \n-import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n+import {createImageLoader, ImageLoaderConfig} from './image_loader';\n \n /**\n  * Function that generates a built-in ImageLoader for ImageKit\n@@ -28,37 +27,20 @@ import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n  *                       present in the document's `<head>`.\n  * @returns Set of providers to configure the ImageKit loader.\n  */\n-export function provideImageKitLoader(path: string, options: {ensurePreconnect?: boolean} = {\n-  ensurePreconnect: true\n-}): Provider[] {\n-  if (ngDevMode && !isValidPath(path)) {\n-    throwInvalidPathError(path);\n-  }\n-  path = normalizePath(path);\n-\n-  const providers: Provider[] = [{\n-    provide: IMAGE_LOADER,\n-    useValue: (config: ImageLoaderConfig) => {\n-      // Example of an ImageKit image URL:\n-      // https://ik.imagekit.io/demo/tr:w-300,h-300/medium_cafe_B1iTdD0C.jpg\n-      let params = `tr:q-auto`;  // applies the \"auto quality\" transformation\n-      if (config.width) {\n-        params += `,w-${config.width?.toString()}`;\n-      }\n-      const url = `${path}/${params}/${normalizeSrc(config.src)}`;\n-      return url;\n+export const provideImageKitLoader =\n+    createImageLoader(imagekitLoaderFactory, throwInvalidPathError);\n+\n+export function imagekitLoaderFactory(path: string) {\n+  return (config: ImageLoaderConfig) => {\n+    // Example of an ImageKit image URL:\n+    // https://ik.imagekit.io/demo/tr:w-300,h-300/medium_cafe_B1iTdD0C.jpg\n+    let params = `tr:q-auto`;  // applies the \"auto quality\" transformation\n+    if (config.width) {\n+      params += `,w-${config.width?.toString()}`;\n     }\n-  }];\n-\n-  if (ngDevMode && Boolean(options.ensurePreconnect) === true) {\n-    providers.push({\n-      provide: PRECONNECT_CHECK_BLOCKLIST,\n-      useValue: [path],\n-      multi: true,\n-    });\n-  }\n-\n-  return providers;\n+    const url = `${path}/${params}/${normalizeSrc(config.src)}`;\n+    return url;\n+  };\n }\n \n function throwInvalidPathError(path: unknown): never {\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts\n\n@@ -6,13 +6,12 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Provider, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {\u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../../../errors';\n-import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n-import {isValidPath, normalizePath, normalizeSrc} from '../util';\n+import {normalizeSrc} from '../util';\n \n-import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n+import {createImageLoader, ImageLoaderConfig} from './image_loader';\n \n /**\n  * Function that generates a built-in ImageLoader for Imgix and turns it\n@@ -26,34 +25,16 @@ import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n  *                       present in the document's `<head>`.\n  * @returns Set of providers to configure the Imgix loader.\n  */\n-export function provideImgixLoader(path: string, options: {ensurePreconnect?: boolean} = {\n-  ensurePreconnect: true\n-}): Provider[] {\n-  if (ngDevMode && !isValidPath(path)) {\n-    throwInvalidPathError(path);\n-  }\n-  path = normalizePath(path);\n-\n-  const providers: Provider[] = [{\n-    provide: IMAGE_LOADER,\n-    useValue: (config: ImageLoaderConfig) => {\n-      const url = new URL(`${path}/${normalizeSrc(config.src)}`);\n-      // This setting ensures the smallest allowable format is set.\n-      url.searchParams.set('auto', 'format');\n-      config.width && url.searchParams.set('w', config.width.toString());\n-      return url.href;\n-    }\n-  }];\n-\n-  if (ngDevMode && Boolean(options.ensurePreconnect) === true) {\n-    providers.push({\n-      provide: PRECONNECT_CHECK_BLOCKLIST,\n-      useValue: [path],\n-      multi: true,\n-    });\n-  }\n-\n-  return providers;\n+export const provideImgixLoader = createImageLoader(imgixLoaderFactory, throwInvalidPathError);\n+\n+function imgixLoaderFactory(path: string) {\n+  return (config: ImageLoaderConfig) => {\n+    const url = new URL(`${path}/${normalizeSrc(config.src)}`);\n+    // This setting ensures the smallest allowable format is set.\n+    url.searchParams.set('auto', 'format');\n+    config.width && url.searchParams.set('w', config.width.toString());\n+    return url.href;\n+  };\n }\n \n function throwInvalidPathError(path: unknown): never {\n\n\n###\n\n", "completion": "refactor(common): remove code duplication in loaders (#<issue-num>)"}
{"prompt": " file path A: None | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts\n\n@@ -0,0 +1,60 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Provider, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+\n+import {RuntimeErrorCode} from '../../../errors';\n+import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n+import {isValidPath, normalizePath, normalizeSrc} from '../util';\n+\n+import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n+\n+/**\n+ * Function that generates a built-in ImageLoader for Cloudflare Image Resizing\n+ * and turns it into an Angular provider. Note: Cloudflare has multiple image\n+ * products - this provider is specifically for Cloudflare Image Resizing;\n+ * it will not work with Cloudflare Images or Cloudflare Polish.\n+ *\n+ * @param path Your domain name\n+ * e.g. https://mysite.com\n+ * @returns Provider that provides an ImageLoader function\n+ */\n+export function provideCloudflareLoader(path: string, options: {ensurePreconnect?: boolean} = {\n+  ensurePreconnect: true\n+}) {\n+  if (ngDevMode && !isValidPath(path)) {\n+    throwInvalidPathError(path);\n+  }\n+  path = normalizePath(path);\n+\n+  const providers: Provider[] = [{\n+    provide: IMAGE_LOADER,\n+    useValue: (config: ImageLoaderConfig) => {\n+      let params = `format=auto`;\n+      if (config.width) {\n+        params += `,width=${config.width.toString()}`;\n+      }\n+      const url = `${path}/cdn-cgi/image/${params}/${normalizeSrc(config.src)}`;\n+      return url;\n+    }\n+  }];\n+\n+  if (ngDevMode && Boolean(options.ensurePreconnect) === true) {\n+    providers.push({provide: PRECONNECT_CHECK_BLOCKLIST, useValue: [path], multi: true});\n+  }\n+\n+  return providers;\n+}\n+\n+function throwInvalidPathError(path: unknown): never {\n+  throw new RuntimeError(\n+      RuntimeErrorCode.INVALID_INPUT,\n+      `CloudflareLoader has detected an invalid path: ` +\n+          `expecting a path like https://<ZONE>/cdn-cgi/image/<OPTIONS>/<SOURCE-IMAGE>` +\n+          `but got: \\`${path}\\``);\n+}\n\n---\n file path A: packages/common/test/image_loaders/image_loader_spec.ts | file path B: packages/common/test/image_loaders/image_loader_spec.ts\n\n@@ -7,6 +7,7 @@\n  */\n \n import {IMAGE_LOADER, ImageLoader, PRECONNECT_CHECK_BLOCKLIST} from '@angular/common/src/directives/ng_optimized_image';\n+import {provideCloudflareLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader';\n import {provideCloudinaryLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader';\n import {provideImageKitLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader';\n import {provideImgixLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/imgix_loader';\n@@ -246,4 +247,21 @@ describe('Built-in image directive loaders', () => {\n       });\n     });\n   });\n+\n+  describe('Cloudflare loader', () => {\n+    function createCloudflareLoader(path: string): ImageLoader {\n+      const injector = createEnvironmentInjector([provideCloudflareLoader(path)]);\n+      return injector.get(IMAGE_LOADER);\n+    }\n+    it('should construct an image loader with the given path', () => {\n+      const loader = createCloudflareLoader('https://mysite.com');\n+      let config = {src: 'img.png'};\n+      expect(loader(config)).toBe('https://mysite.com/cdn-cgi/image/format=auto/img.png');\n+    });\n+    it('should construct an image loader with the given path', () => {\n+      const loader = createCloudflareLoader('https://mysite.com');\n+      const config = {src: 'img.png', width: 100};\n+      expect(loader(config)).toBe('https://mysite.com/cdn-cgi/image/format=auto,width=100/img.png');\n+    });\n+  });\n });\n\n\n###\n\n", "completion": "feat(common): add cloudflare loader (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts\n\n@@ -10,9 +10,9 @@ import {Provider, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../../../errors';\n import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n+import {isValidPath, normalizePath, normalizeSrc} from '../util';\n \n import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n-import {isValidPath, normalizePath, normalizeSrc} from './loader_utils';\n \n /**\n  * Function that generates a built-in ImageLoader for Cloudinary\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts\n\n@@ -10,9 +10,9 @@ import {Provider, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../../../errors';\n import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n+import {isValidPath, normalizePath, normalizeSrc} from '../util';\n \n import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n-import {isValidPath, normalizePath, normalizeSrc} from './loader_utils';\n \n /**\n  * Function that generates a built-in ImageLoader for ImageKit\n@@ -44,7 +44,7 @@ export function provideImageKitLoader(path: string, options: {ensurePreconnect?:\n       let params = `tr:q-auto`;  // applies the \"auto quality\" transformation\n       if (config.width) {\n         params += `,w-${config.width?.toString()}`;\n-      };\n+      }\n       const url = `${path}/${params}/${normalizeSrc(config.src)}`;\n       return url;\n     }\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts\n\n@@ -10,9 +10,9 @@ import {Provider, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../../../errors';\n import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n+import {isValidPath, normalizePath, normalizeSrc} from '../util';\n \n import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n-import {isValidPath, normalizePath, normalizeSrc} from './loader_utils';\n \n /**\n  * Function that generates a built-in ImageLoader for Imgix and turns it\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/loader_utils.ts | file path B: None\n\n@@ -1,22 +0,0 @@\n-export function isValidPath(path: unknown) {\n-  const isString = typeof path === 'string';\n-\n-  if (!isString || path.trim() === '') {\n-    return false;\n-  }\n-\n-  try {\n-    const url = new URL(path);\n-    return true;\n-  } catch {\n-    return false;\n-  }\n-}\n-\n-export function normalizePath(path: string) {\n-  return path.endsWith('/') ? path.slice(0, -1) : path;\n-}\n-\n-export function normalizeSrc(src: string) {\n-  return src.startsWith('/') ? src.slice(1) : src;\n-}\n\\ No newline at end of file\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/util.ts | file path B: packages/common/src/directives/ng_optimized_image/util.ts\n\n@@ -38,3 +38,26 @@ export function extractHostname(url: string): string {\n   }\n   return url;\n }\n+\n+export function isValidPath(path: unknown): boolean {\n+  const isString = typeof path === 'string';\n+\n+  if (!isString || path.trim() === '') {\n+    return false;\n+  }\n+\n+  try {\n+    const url = new URL(path);\n+    return true;\n+  } catch {\n+    return false;\n+  }\n+}\n+\n+export function normalizePath(path: string): string {\n+  return path.endsWith('/') ? path.slice(0, -1) : path;\n+}\n+\n+export function normalizeSrc(src: string): string {\n+  return src.startsWith('/') ? src.slice(1) : src;\n+}\n\n---\n file path A: packages/common/test/image_loaders/image_loader_spec.ts | file path B: packages/common/test/image_loaders/image_loader_spec.ts\n\n@@ -10,7 +10,7 @@ import {IMAGE_LOADER, ImageLoader, PRECONNECT_CHECK_BLOCKLIST} from '@angular/co\n import {provideCloudinaryLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader';\n import {provideImageKitLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader';\n import {provideImgixLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/imgix_loader';\n-import {isValidPath} from '@angular/common/src/directives/ng_optimized_image/image_loaders/loader_utils';\n+import {isValidPath} from '@angular/common/src/directives/ng_optimized_image/util';\n import {createEnvironmentInjector, ValueProvider} from '@angular/core';\n \n describe('Built-in image directive loaders', () => {\n\n\n###\n\n", "completion": "refactor(common): move loader util functions to a common location (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts\n\n@@ -9,6 +9,7 @@\n import {Provider, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../../../errors';\n+import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n \n import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n import {isValidPath, normalizePath, normalizeSrc} from './loader_utils';\n@@ -22,15 +23,21 @@ import {isValidPath, normalizePath, normalizeSrc} from './loader_utils';\n  * https://res.cloudinary.com/mysite\n  * https://mysite.cloudinary.com\n  * https://subdomain.mysite.com\n- * @returns Provider that provides an ImageLoader function\n+ * @param options An object that allows to provide extra configuration:\n+ * - `ensurePreconnect`: boolean flag indicating whether the NgOptimizedImage directive\n+ *                       should verify that there is a corresponding `<link rel=\"preconnect\">`\n+ *                       present in the document's `<head>`.\n+ * @returns Set of providers to configure the Cloudinary loader.\n  */\n-export function provideCloudinaryLoader(path: string): Provider {\n+export function provideCloudinaryLoader(path: string, options: {ensurePreconnect?: boolean} = {\n+  ensurePreconnect: true\n+}): Provider[] {\n   if (ngDevMode && !isValidPath(path)) {\n     throwInvalidPathError(path);\n   }\n   path = normalizePath(path);\n \n-  return {\n+  const providers: Provider[] = [{\n     provide: IMAGE_LOADER,\n     useValue: (config: ImageLoaderConfig) => {\n       // Example of a Cloudinary image URL:\n@@ -42,7 +49,17 @@ export function provideCloudinaryLoader(path: string): Provider {\n       const url = `${path}/image/upload/${params}/${normalizeSrc(config.src)}`;\n       return url;\n     }\n-  };\n+  }];\n+\n+  if (ngDevMode && Boolean(options.ensurePreconnect) === true) {\n+    providers.push({\n+      provide: PRECONNECT_CHECK_BLOCKLIST,\n+      useValue: [path],\n+      multi: true,\n+    });\n+  }\n+\n+  return providers;\n }\n \n function throwInvalidPathError(path: unknown): never {\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts\n\n@@ -9,6 +9,7 @@\n import {Provider, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../../../errors';\n+import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n \n import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n import {isValidPath, normalizePath, normalizeSrc} from './loader_utils';\n@@ -21,15 +22,21 @@ import {isValidPath, normalizePath, normalizeSrc} from './loader_utils';\n  * This URL should match one of the following formats:\n  * https://ik.imagekit.io/myaccount\n  * https://subdomain.mysite.com\n- * @returns Provider that provides an ImageLoader function\n+ * @param options An object that allows to provide extra configuration:\n+ * - `ensurePreconnect`: boolean flag indicating whether the NgOptimizedImage directive\n+ *                       should verify that there is a corresponding `<link rel=\"preconnect\">`\n+ *                       present in the document's `<head>`.\n+ * @returns Set of providers to configure the ImageKit loader.\n  */\n-export function provideImageKitLoader(path: string): Provider {\n+export function provideImageKitLoader(path: string, options: {ensurePreconnect?: boolean} = {\n+  ensurePreconnect: true\n+}): Provider[] {\n   if (ngDevMode && !isValidPath(path)) {\n     throwInvalidPathError(path);\n   }\n   path = normalizePath(path);\n \n-  return {\n+  const providers: Provider[] = [{\n     provide: IMAGE_LOADER,\n     useValue: (config: ImageLoaderConfig) => {\n       // Example of an ImageKit image URL:\n@@ -41,7 +48,17 @@ export function provideImageKitLoader(path: string): Provider {\n       const url = `${path}/${params}/${normalizeSrc(config.src)}`;\n       return url;\n     }\n-  };\n+  }];\n+\n+  if (ngDevMode && Boolean(options.ensurePreconnect) === true) {\n+    providers.push({\n+      provide: PRECONNECT_CHECK_BLOCKLIST,\n+      useValue: [path],\n+      multi: true,\n+    });\n+  }\n+\n+  return providers;\n }\n \n function throwInvalidPathError(path: unknown): never {\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts\n\n@@ -20,11 +20,15 @@ import {isValidPath, normalizePath, normalizeSrc} from './loader_utils';\n  *\n  * @param path path to the desired Imgix origin,\n  * e.g. https://somepath.imgix.net or https://images.mysite.com\n- * @returns Provider that provides an ImageLoader function\n+ * @param options An object that allows to provide extra configuration:\n+ * - `ensurePreconnect`: boolean flag indicating whether the NgOptimizedImage directive\n+ *                       should verify that there is a corresponding `<link rel=\"preconnect\">`\n+ *                       present in the document's `<head>`.\n+ * @returns Set of providers to configure the Imgix loader.\n  */\n export function provideImgixLoader(path: string, options: {ensurePreconnect?: boolean} = {\n   ensurePreconnect: true\n-}) {\n+}): Provider[] {\n   if (ngDevMode && !isValidPath(path)) {\n     throwInvalidPathError(path);\n   }\n@@ -42,7 +46,11 @@ export function provideImgixLoader(path: string, options: {ensurePreconnect?: bo\n   }];\n \n   if (ngDevMode && Boolean(options.ensurePreconnect) === true) {\n-    providers.push({provide: PRECONNECT_CHECK_BLOCKLIST, useValue: [path], multi: true});\n+    providers.push({\n+      provide: PRECONNECT_CHECK_BLOCKLIST,\n+      useValue: [path],\n+      multi: true,\n+    });\n   }\n \n   return providers;\n\n---\n file path A: packages/common/test/image_loaders/image_loader_spec.ts | file path B: packages/common/test/image_loaders/image_loader_spec.ts\n\n@@ -88,7 +88,7 @@ describe('Built-in image directive loaders', () => {\n     }\n \n     it('should construct an image loader with the given path', () => {\n-      const path = 'https://somesite.imgix.net/mysite';\n+      const path = 'https://res.cloudinary.com/mysite';\n       const loader = createCloudinaryLoader(path);\n       expect(loader({src: 'img.png'})).toBe(`${path}/image/upload/f_auto,q_auto/img.png`);\n       expect(loader({\n@@ -107,17 +107,49 @@ describe('Built-in image directive loaders', () => {\n       });\n \n       it('should handle a trailing forward slash on the path', () => {\n-        const path = 'https://somesite.imgix.net/mysite';\n+        const path = 'https://res.cloudinary.com/mysite';\n         const loader = createCloudinaryLoader(`${path}/`);\n         expect(loader({src: 'img.png'})).toBe(`${path}/image/upload/f_auto,q_auto/img.png`);\n       });\n \n       it('should handle a leading forward slash on the image src', () => {\n-        const path = 'https://somesite.imgix.net/mysite';\n+        const path = 'https://res.cloudinary.com/mysite';\n         const loader = createCloudinaryLoader(path);\n         expect(loader({src: '/img.png'})).toBe(`${path}/image/upload/f_auto,q_auto/img.png`);\n       });\n     });\n+\n+    describe('options', () => {\n+      it('should configure PRECONNECT_CHECK_BLOCKLIST token by default', () => {\n+        const path = 'https://res.cloudinary.com/mysite';\n+        const providers = provideCloudinaryLoader(path);\n+        expect(providers.length).toBe(2);\n+\n+        const valueProvider = providers[1] as ValueProvider;\n+        expect(valueProvider.multi).toBeTrue();\n+        expect(valueProvider.useValue).toEqual([path]);\n+        expect(valueProvider.provide).toBe(PRECONNECT_CHECK_BLOCKLIST);\n+      });\n+\n+      it('should configure PRECONNECT_CHECK_BLOCKLIST when the ensurePreconnect was specified',\n+         () => {\n+           const path = 'https://res.cloudinary.com/mysite';\n+           const providers = provideCloudinaryLoader(path, {ensurePreconnect: true});\n+           expect(providers.length).toBe(2);\n+\n+           const valueProvider = providers[1] as ValueProvider;\n+           expect(valueProvider.multi).toBeTrue();\n+           expect(valueProvider.useValue).toEqual([path]);\n+           expect(valueProvider.provide).toBe(PRECONNECT_CHECK_BLOCKLIST);\n+         });\n+\n+      it('should NOT configure PRECONNECT_CHECK_BLOCKLIST disabled with the ensurePreconnect option',\n+         () => {\n+           const providers = provideCloudinaryLoader(\n+               'https://res.cloudinary.com/mysite', {ensurePreconnect: false});\n+           expect(providers.length).toBe(1);\n+         });\n+    });\n   });\n \n   describe('ImageKit loader', () => {\n@@ -155,6 +187,38 @@ describe('Built-in image directive loaders', () => {\n         expect(loader({src: '/img.png'})).toBe(`${path}/tr:q-auto/img.png`);\n       });\n     });\n+\n+    describe('options', () => {\n+      it('should configure PRECONNECT_CHECK_BLOCKLIST token by default', () => {\n+        const path = 'https://ik.imageengine.io/imagetest';\n+        const providers = provideImageKitLoader(path);\n+        expect(providers.length).toBe(2);\n+\n+        const valueProvider = providers[1] as ValueProvider;\n+        expect(valueProvider.multi).toBeTrue();\n+        expect(valueProvider.useValue).toEqual([path]);\n+        expect(valueProvider.provide).toBe(PRECONNECT_CHECK_BLOCKLIST);\n+      });\n+\n+      it('should configure PRECONNECT_CHECK_BLOCKLIST when the ensurePreconnect was specified',\n+         () => {\n+           const path = 'https://ik.imageengine.io/imagetest';\n+           const providers = provideImageKitLoader(path, {ensurePreconnect: true});\n+           expect(providers.length).toBe(2);\n+\n+           const valueProvider = providers[1] as ValueProvider;\n+           expect(valueProvider.multi).toBeTrue();\n+           expect(valueProvider.useValue).toEqual([path]);\n+           expect(valueProvider.provide).toBe(PRECONNECT_CHECK_BLOCKLIST);\n+         });\n+\n+      it('should NOT configure PRECONNECT_CHECK_BLOCKLIST disabled with the ensurePreconnect option',\n+         () => {\n+           const providers = provideImageKitLoader(\n+               'https://ik.imageengine.io/imagetest', {ensurePreconnect: false});\n+           expect(providers.length).toBe(1);\n+         });\n+    });\n   });\n \n   describe('loader utils', () => {\n\n\n###\n\n", "completion": "refactor(common): allow Cloudinary and ImageKit loaders to specify the ensurePreconnect option (#<issue-num>)"}
{"prompt": " file path A: None | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts\n\n@@ -0,0 +1,54 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Provider, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+\n+import {RuntimeErrorCode} from '../../../errors';\n+\n+import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n+import {isValidPath, normalizePath, normalizeSrc} from './loader_utils';\n+\n+/**\n+ * Function that generates a built-in ImageLoader for Cloudinary\n+ * and turns it into an Angular provider.\n+ *\n+ * @param path Base URL of your Cloudinary images\n+ * This URL should match one of the following formats:\n+ * https://res.cloudinary.com/mysite\n+ * https://mysite.cloudinary.com\n+ * https://subdomain.mysite.com\n+ * @returns Provider that provides an ImageLoader function\n+ */\n+export function provideCloudinaryLoader(path: string): Provider {\n+  if (ngDevMode && !isValidPath(path)) {\n+    throwInvalidPathError(path);\n+  }\n+  path = normalizePath(path);\n+\n+  return {\n+    provide: IMAGE_LOADER,\n+    useValue: (config: ImageLoaderConfig) => {\n+      // Example of a Cloudinary image URL:\n+      // https://res.cloudinary.com/mysite/image/upload/c_scale,f_auto,q_auto,w_600/marketing/tile-topics-m.png\n+      let params = `f_auto,q_auto`;  // sets image format and quality to \"auto\"\n+      if (config.width) {\n+        params += `,w_${config.width}`;\n+      }\n+      const url = `${path}/image/upload/${params}/${normalizeSrc(config.src)}`;\n+      return url;\n+    }\n+  };\n+}\n+\n+function throwInvalidPathError(path: unknown): never {\n+  throw new RuntimeError(\n+      RuntimeErrorCode.INVALID_INPUT,\n+      `CloudinaryLoader has detected an invalid path: ` +\n+          `expecting a path matching one of the following formats: https://res.cloudinary.com/mysite, https://mysite.cloudinary.com, or https://subdomain.mysite.com - ` +\n+          `but got: \\`${path}\\``);\n+}\n\n---\n file path A: None | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts\n\n@@ -0,0 +1,53 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Provider, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+\n+import {RuntimeErrorCode} from '../../../errors';\n+\n+import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n+import {isValidPath, normalizePath, normalizeSrc} from './loader_utils';\n+\n+/**\n+ * Function that generates a built-in ImageLoader for ImageKit\n+ * and turns it into an Angular provider.\n+ *\n+ * @param path Base URL of your ImageKit images\n+ * This URL should match one of the following formats:\n+ * https://ik.imagekit.io/myaccount\n+ * https://subdomain.mysite.com\n+ * @returns Provider that provides an ImageLoader function\n+ */\n+export function provideImageKitLoader(path: string): Provider {\n+  if (ngDevMode && !isValidPath(path)) {\n+    throwInvalidPathError(path);\n+  }\n+  path = normalizePath(path);\n+\n+  return {\n+    provide: IMAGE_LOADER,\n+    useValue: (config: ImageLoaderConfig) => {\n+      // Example of an ImageKit image URL:\n+      // https://ik.imagekit.io/demo/tr:w-300,h-300/medium_cafe_B1iTdD0C.jpg\n+      let params = `tr:q-auto`;  // applies the \"auto quality\" transformation\n+      if (config.width) {\n+        params += `,w-${config.width?.toString()}`;\n+      };\n+      const url = `${path}/${params}/${normalizeSrc(config.src)}`;\n+      return url;\n+    }\n+  };\n+}\n+\n+function throwInvalidPathError(path: unknown): never {\n+  throw new RuntimeError(\n+      RuntimeErrorCode.INVALID_INPUT,\n+      `ImageKitLoader has detected an invalid path: ` +\n+          `expecting a path matching one of the following formats: https://ik.imagekit.io/mysite or https://subdomain.mysite.com - ` +\n+          `but got: \\`${path}\\``);\n+}\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts\n\n@@ -12,6 +12,7 @@ import {RuntimeErrorCode} from '../../../errors';\n import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n \n import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n+import {isValidPath, normalizePath, normalizeSrc} from './loader_utils';\n \n /**\n  * Function that generates a built-in ImageLoader for Imgix and turns it\n@@ -24,7 +25,9 @@ import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n export function provideImgixLoader(path: string, options: {ensurePreconnect?: boolean} = {\n   ensurePreconnect: true\n }) {\n-  ngDevMode && assertValidPath(path);\n+  if (ngDevMode && !isValidPath(path)) {\n+    throwInvalidPathError(path);\n+  }\n   path = normalizePath(path);\n \n   const providers: Provider[] = [{\n@@ -45,20 +48,6 @@ export function provideImgixLoader(path: string, options: {ensurePreconnect?: bo\n   return providers;\n }\n \n-function assertValidPath(path: unknown) {\n-  const isString = typeof path === 'string';\n-\n-  if (!isString || path.trim() === '') {\n-    throwInvalidPathError(path);\n-  }\n-\n-  try {\n-    const url = new URL(path);\n-  } catch {\n-    throwInvalidPathError(path);\n-  }\n-}\n-\n function throwInvalidPathError(path: unknown): never {\n   throw new RuntimeError(\n       RuntimeErrorCode.INVALID_INPUT,\n@@ -66,11 +55,3 @@ function throwInvalidPathError(path: unknown): never {\n           `expecting a path like https://somepath.imgix.net/` +\n           `but got: \\`${path}\\``);\n }\n-\n-function normalizePath(path: string) {\n-  return path[path.length - 1] === '/' ? path.slice(0, -1) : path;\n-}\n-\n-function normalizeSrc(src: string) {\n-  return src[0] === '/' ? src.slice(1) : src;\n-}\n\n---\n file path A: None | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/loader_utils.ts\n\n@@ -0,0 +1,22 @@\n+export function isValidPath(path: unknown) {\n+  const isString = typeof path === 'string';\n+\n+  if (!isString || path.trim() === '') {\n+    return false;\n+  }\n+\n+  try {\n+    const url = new URL(path);\n+    return true;\n+  } catch {\n+    return false;\n+  }\n+}\n+\n+export function normalizePath(path: string) {\n+  return path.endsWith('/') ? path.slice(0, -1) : path;\n+}\n+\n+export function normalizeSrc(src: string) {\n+  return src.startsWith('/') ? src.slice(1) : src;\n+}\n\\ No newline at end of file\n\n---\n file path A: packages/common/test/image_loaders/image_loader_spec.ts | file path B: packages/common/test/image_loaders/image_loader_spec.ts\n\n@@ -7,8 +7,10 @@\n  */\n \n import {IMAGE_LOADER, ImageLoader, PRECONNECT_CHECK_BLOCKLIST} from '@angular/common/src/directives/ng_optimized_image';\n+import {provideCloudinaryLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader';\n+import {provideImageKitLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader';\n import {provideImgixLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/imgix_loader';\n-import {RuntimeErrorCode} from '@angular/common/src/errors';\n+import {isValidPath} from '@angular/common/src/directives/ng_optimized_image/image_loaders/loader_utils';\n import {createEnvironmentInjector, ValueProvider} from '@angular/core';\n \n describe('Built-in image directive loaders', () => {\n@@ -18,78 +20,55 @@ describe('Built-in image directive loaders', () => {\n       return injector.get(IMAGE_LOADER);\n     }\n \n-    function invalidPathError(path: string): string {\n-      return `NG0${RuntimeErrorCode.INVALID_INPUT}: ImgixLoader has detected ` +\n-          `an invalid path: expecting a path like https://somepath.imgix.net/` +\n-          `but got: \\`${path}\\``;\n-    }\n-\n-    describe('invalid paths', () => {\n-      it('should throw when a path is empty', () => {\n-        const path = '';\n-        expect(() => provideImgixLoader(path)).toThrowError(invalidPathError(path));\n-      });\n-\n-      it('should throw when a path is not a URL', () => {\n-        const path = 'wellhellothere';\n-        expect(() => provideImgixLoader(path)).toThrowError(invalidPathError(path));\n-      });\n-\n-      it('should throw when a path is missing a scheme', () => {\n-        const path = 'somepath.imgix.net';\n-        expect(() => provideImgixLoader(path)).toThrowError(invalidPathError(path));\n-      });\n-\n-      it('should throw when a path is malformed', () => {\n-        const path = 'somepa\\th.imgix.net? few';\n-        expect(() => provideImgixLoader(path)).toThrowError(invalidPathError(path));\n-      });\n-    });\n-\n     it('should construct an image loader with the given path', () => {\n-      const loader = createImgixLoader('https://somesite.imgix.net');\n+      const path = 'https://somesite.imgix.net';\n+      const loader = createImgixLoader(path);\n       const config = {src: 'img.png'};\n-      expect(loader(config)).toBe('https://somesite.imgix.net/img.png?auto=format');\n+      expect(loader(config)).toBe(`${path}/img.png?auto=format`);\n     });\n \n     it('should handle a trailing forward slash on the path', () => {\n-      const loader = createImgixLoader('https://somesite.imgix.net/');\n+      const path = 'https://somesite.imgix.net';\n+      const loader = createImgixLoader(`${path}/`);\n       const config = {src: 'img.png'};\n-      expect(loader(config)).toBe('https://somesite.imgix.net/img.png?auto=format');\n+      expect(loader(config)).toBe(`${path}/img.png?auto=format`);\n     });\n \n-    it('should handle a leading forward slash on the src', () => {\n-      const loader = createImgixLoader('https://somesite.imgix.net');\n+    it('should handle a leading forward slash on the image src', () => {\n+      const path = 'https://somesite.imgix.net';\n+      const loader = createImgixLoader(path);\n       const config = {src: '/img.png'};\n-      expect(loader(config)).toBe('https://somesite.imgix.net/img.png?auto=format');\n+      expect(loader(config)).toBe(`${path}/img.png?auto=format`);\n     });\n \n     it('should construct an image loader with the given path', () => {\n-      const loader = createImgixLoader('https://somesite.imgix.net');\n+      const path = 'https://somesite.imgix.net';\n+      const loader = createImgixLoader(path);\n       const config = {src: 'img.png', width: 100};\n-      expect(loader(config)).toBe('https://somesite.imgix.net/img.png?auto=format&w=100');\n+      expect(loader(config)).toBe(`${path}/img.png?auto=format&w=100`);\n     });\n \n     describe('options', () => {\n       it('should configure PRECONNECT_CHECK_BLOCKLIST token by default', () => {\n-        const providers = provideImgixLoader('https://somesite.imgix.net');\n+        const path = 'https://somesite.imgix.net';\n+        const providers = provideImgixLoader(path);\n         expect(providers.length).toBe(2);\n \n         const valueProvider = providers[1] as ValueProvider;\n         expect(valueProvider.multi).toBeTrue();\n-        expect(valueProvider.useValue).toEqual(['https://somesite.imgix.net']);\n+        expect(valueProvider.useValue).toEqual([path]);\n         expect(valueProvider.provide).toBe(PRECONNECT_CHECK_BLOCKLIST);\n       });\n \n       it('should configure PRECONNECT_CHECK_BLOCKLIST when the ensurePreconnect was specified',\n          () => {\n-           const providers =\n-               provideImgixLoader('https://somesite.imgix.net', {ensurePreconnect: true});\n+           const path = 'https://somesite.imgix.net';\n+           const providers = provideImgixLoader(path, {ensurePreconnect: true});\n            expect(providers.length).toBe(2);\n \n            const valueProvider = providers[1] as ValueProvider;\n            expect(valueProvider.multi).toBeTrue();\n-           expect(valueProvider.useValue).toEqual(['https://somesite.imgix.net']);\n+           expect(valueProvider.useValue).toEqual([path]);\n            expect(valueProvider.provide).toBe(PRECONNECT_CHECK_BLOCKLIST);\n          });\n \n@@ -101,4 +80,106 @@ describe('Built-in image directive loaders', () => {\n          });\n     });\n   });\n+\n+  describe('Cloudinary loader', () => {\n+    function createCloudinaryLoader(path: string): ImageLoader {\n+      const injector = createEnvironmentInjector([provideCloudinaryLoader(path)]);\n+      return injector.get(IMAGE_LOADER);\n+    }\n+\n+    it('should construct an image loader with the given path', () => {\n+      const path = 'https://somesite.imgix.net/mysite';\n+      const loader = createCloudinaryLoader(path);\n+      expect(loader({src: 'img.png'})).toBe(`${path}/image/upload/f_auto,q_auto/img.png`);\n+      expect(loader({\n+        src: 'marketing/img-2.png'\n+      })).toBe(`${path}/image/upload/f_auto,q_auto/marketing/img-2.png`);\n+    });\n+\n+    describe('input validation', () => {\n+      it('should throw if the path is invalid', () => {\n+        expect(() => provideCloudinaryLoader('my-cloudinary-account'))\n+            .toThrowError(\n+                `NG02952: CloudinaryLoader has detected an invalid path: ` +\n+                `expecting a path matching one of the following formats: ` +\n+                `https://res.cloudinary.com/mysite, https://mysite.cloudinary.com, ` +\n+                `or https://subdomain.mysite.com - but got: \\`my-cloudinary-account\\``);\n+      });\n+\n+      it('should handle a trailing forward slash on the path', () => {\n+        const path = 'https://somesite.imgix.net/mysite';\n+        const loader = createCloudinaryLoader(`${path}/`);\n+        expect(loader({src: 'img.png'})).toBe(`${path}/image/upload/f_auto,q_auto/img.png`);\n+      });\n+\n+      it('should handle a leading forward slash on the image src', () => {\n+        const path = 'https://somesite.imgix.net/mysite';\n+        const loader = createCloudinaryLoader(path);\n+        expect(loader({src: '/img.png'})).toBe(`${path}/image/upload/f_auto,q_auto/img.png`);\n+      });\n+    });\n+  });\n+\n+  describe('ImageKit loader', () => {\n+    function createImageKitLoader(path: string): ImageLoader {\n+      const injector = createEnvironmentInjector([provideImageKitLoader(path)]);\n+      return injector.get(IMAGE_LOADER);\n+    }\n+\n+    it('should construct an image loader with the given path', () => {\n+      const path = 'https://ik.imageengine.io/imagetest';\n+      const loader = createImageKitLoader(path);\n+      expect(loader({src: 'img.png'})).toBe(`${path}/tr:q-auto/img.png`);\n+      expect(loader({src: 'marketing/img-2.png'})).toBe(`${path}/tr:q-auto/marketing/img-2.png`);\n+    });\n+\n+    describe('input validation', () => {\n+      it('should throw if the path is invalid', () => {\n+        expect(() => provideImageKitLoader('my-imagekit-account'))\n+            .toThrowError(\n+                `NG02952: ImageKitLoader has detected an invalid path: ` +\n+                `expecting a path matching one of the following formats: ` +\n+                `https://ik.imagekit.io/mysite or https://subdomain.mysite.com - ` +\n+                `but got: \\`my-imagekit-account\\``);\n+      });\n+\n+      it('should handle a trailing forward slash on the path', () => {\n+        const path = 'https://ik.imageengine.io/imagetest';\n+        const loader = createImageKitLoader(`${path}/`);\n+        expect(loader({src: 'img.png'})).toBe(`${path}/tr:q-auto/img.png`);\n+      });\n+\n+      it('should handle a leading forward slash on the image src', () => {\n+        const path = 'https://ik.imageengine.io/imagetest';\n+        const loader = createImageKitLoader(path);\n+        expect(loader({src: '/img.png'})).toBe(`${path}/tr:q-auto/img.png`);\n+      });\n+    });\n+  });\n+\n+  describe('loader utils', () => {\n+    describe('path validation', () => {\n+      it('should identify valid paths', () => {\n+        expect(isValidPath('https://cdn.imageprovider.com/image-test')).toBe(true);\n+        expect(isValidPath('https://cdn.imageprovider.com')).toBe(true);\n+        expect(isValidPath('https://imageprovider.com')).toBe(true);\n+      });\n+\n+      it('should reject empty paths', () => {\n+        expect(isValidPath('')).toBe(false);\n+      });\n+\n+      it('should reject path if it is not a URL', () => {\n+        expect(isValidPath('myaccount')).toBe(false);\n+      });\n+\n+      it('should reject path if it does not include a protocol', () => {\n+        expect(isValidPath('myaccount.imageprovider.com')).toBe(false);\n+      });\n+\n+      it('should reject path if is malformed', () => {\n+        expect(isValidPath('somepa\\th.imageprovider.com? few')).toBe(false);\n+      });\n+    });\n+  });\n });\n\n\n###\n\n", "completion": "feat(common): add loaders for cloudinary & imagekit (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Directive, ElementRef, Inject, Injectable, Injector, Input, NgModule, NgZone, OnChanges, OnDestroy, OnInit, Renderer2, SimpleChanges, \u0275formatRuntimeError as formatRuntimeError, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {Directive, ElementRef, Inject, Injector, Input, NgModule, NgZone, OnChanges, OnDestroy, OnInit, Renderer2, SimpleChanges, \u0275_sanitizeUrl as sanitizeUrl, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../../errors';\n \n@@ -161,9 +161,15 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n     }\n     this.setHostAttribute('loading', this.getLoadingBehavior());\n     this.setHostAttribute('fetchpriority', this.getFetchPriority());\n+\n+    // Use the `sanitizeUrl` function directly (vs using `DomSanitizer`),\n+    // to make the code more tree-shakable (avoid referencing the entire class).\n+    // The same function is used when regular `src` is used on an `<img>` element.\n+    const src = sanitizeUrl(this.getRewrittenSrc());\n+\n     // The `src` and `srcset` attributes should be set last since other attributes\n     // could affect the image's loading behavior.\n-    this.setHostAttribute('src', this.getRewrittenSrc());\n+    this.setHostAttribute('src', src);\n     if (this.rawSrcset) {\n       this.setHostAttribute('srcset', this.getRewrittenSrcset());\n     }\n@@ -204,7 +210,8 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n     const finalSrcs = this.rawSrcset.split(',').filter(src => src !== '').map(srcStr => {\n       srcStr = srcStr.trim();\n       const width = widthSrcSet ? parseFloat(srcStr) : parseFloat(srcStr) * this.width!;\n-      return `${this.imageLoader({src: this.rawSrc, width})} ${srcStr}`;\n+      const imgSrc = sanitizeUrl(this.imageLoader({src: this.rawSrc, width}));\n+      return `${imgSrc} ${srcStr}`;\n     });\n     return finalSrcs.join(', ');\n   }\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -472,6 +472,56 @@ describe('Image directive', () => {\n     });\n   });\n \n+  describe('sanitization', () => {\n+    // Loader function that just returns provided `src`.\n+    const noopLoader = (config: ImageLoaderConfig) => config.src;\n+\n+    it('should apply sanitization to the `rawSrc` with a static value', () => {\n+      setupTestingModule({imageLoader: noopLoader});\n+\n+      const template =\n+          '<img rawSrc=\"javascript:alert(`Unsafe code execution`)\" width=\"50\" height=\"50\">';\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+\n+      const img = fixture.nativeElement.querySelector('img')!;\n+      // The `src` looks like this: 'unsafe:javascript:alert(`Unsafe code execution`)'\n+      expect(img.src.startsWith('unsafe:')).toBe(true);\n+    });\n+\n+    it('should apply sanitization to the `rawSrc` when used as a binding', () => {\n+      setupTestingModule({imageLoader: noopLoader});\n+\n+      const template =\n+          '<img [rawSrc]=\"\\'javascript:alert(`Unsafe code execution`)\\'\" width=\"50\" height=\"50\">';\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+\n+      const img = fixture.nativeElement.querySelector('img')!;\n+      // The `src` looks like this: 'unsafe:javascript:alert(`Unsafe code execution`)'\n+      expect(img.src.startsWith('unsafe:')).toBe(true);\n+    });\n+\n+    it('should apply sanitization to the `rawSrcset` value', () => {\n+      setupTestingModule({imageLoader: noopLoader});\n+\n+      const template =\n+          `<img rawSrc=\"javascript:alert(\\`Unsafe code execution\\`)\" rawSrcset=\"100w, 200w\" width=\"100\" height=\"50\">`;\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+\n+      // The `src` looks like this: 'unsafe:javascript:alert(`Unsafe code execution`)'\n+      expect(img.src.startsWith('unsafe:')).toBe(true);\n+      expect(img.srcset)\n+          .toBe(\n+              'unsafe:javascript:alert(`Unsafe code execution`) 100w, ' +\n+              'unsafe:javascript:alert(`Unsafe code execution`) 200w');\n+    });\n+  });\n+\n   describe('fetch priority', () => {\n     it('should be \"high\" for priority images', () => {\n       setupTestingModule();\n\n\n###\n\n", "completion": "fix(common): sanitize `rawSrc` and `rawSrcset` values in NgOptimizedImage directive (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts\n\n@@ -9,6 +9,7 @@\n import {Provider, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../../../errors';\n+import {PRECONNECT_CHECK_BLOCKLIST} from '../preconnect_link_checker';\n \n import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n \n@@ -20,11 +21,13 @@ import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n  * e.g. https://somepath.imgix.net or https://images.mysite.com\n  * @returns Provider that provides an ImageLoader function\n  */\n-export function provideImgixLoader(path: string): Provider {\n+export function provideImgixLoader(path: string, options: {ensurePreconnect?: boolean} = {\n+  ensurePreconnect: true\n+}) {\n   ngDevMode && assertValidPath(path);\n   path = normalizePath(path);\n \n-  return {\n+  const providers: Provider[] = [{\n     provide: IMAGE_LOADER,\n     useValue: (config: ImageLoaderConfig) => {\n       const url = new URL(`${path}/${normalizeSrc(config.src)}`);\n@@ -33,7 +36,13 @@ export function provideImgixLoader(path: string): Provider {\n       config.width && url.searchParams.set('w', config.width.toString());\n       return url.href;\n     }\n-  };\n+  }];\n+\n+  if (ngDevMode && Boolean(options.ensurePreconnect) === true) {\n+    providers.push({provide: PRECONNECT_CHECK_BLOCKLIST, useValue: [path], multi: true});\n+  }\n+\n+  return providers;\n }\n \n function assertValidPath(path: unknown) {\n\n---\n file path A: packages/common/test/image_loaders/image_loader_spec.ts | file path B: packages/common/test/image_loaders/image_loader_spec.ts\n\n@@ -7,11 +7,11 @@\n  */\n \n import {CommonModule} from '@angular/common';\n-import {IMAGE_LOADER} from '@angular/common/src/directives/ng_optimized_image/image_loaders/image_loader';\n import {provideImgixLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/imgix_loader';\n import {NgOptimizedImageModule} from '@angular/common/src/directives/ng_optimized_image/ng_optimized_image';\n+import {PRECONNECT_CHECK_BLOCKLIST} from '@angular/common/src/directives/ng_optimized_image/preconnect_link_checker';\n import {RuntimeErrorCode} from '@angular/common/src/errors';\n-import {Component} from '@angular/core';\n+import {Component, ValueProvider} from '@angular/core';\n import {ComponentFixture, TestBed} from '@angular/core/testing';\n import {expect} from '@angular/platform-browser/testing/src/matchers';\n \n@@ -59,6 +59,37 @@ describe('Built-in image directive loaders', () => {\n       });\n     });\n \n+    describe('options', () => {\n+      it('should configure PRECONNECT_CHECK_BLOCKLIST token by default', () => {\n+        const providers = provideImgixLoader('https://somesite.imgix.net');\n+        expect(providers.length).toBe(2);\n+\n+        const valueProvider = providers[1] as ValueProvider;\n+        expect(valueProvider.multi).toBeTrue();\n+        expect(valueProvider.useValue).toEqual(['https://somesite.imgix.net']);\n+        expect(valueProvider.provide).toBe(PRECONNECT_CHECK_BLOCKLIST);\n+      });\n+\n+      it('should configure PRECONNECT_CHECK_BLOCKLIST when the ensurePreconnect was specified',\n+         () => {\n+           const providers =\n+               provideImgixLoader('https://somesite.imgix.net', {ensurePreconnect: true});\n+           expect(providers.length).toBe(2);\n+\n+           const valueProvider = providers[1] as ValueProvider;\n+           expect(valueProvider.multi).toBeTrue();\n+           expect(valueProvider.useValue).toEqual(['https://somesite.imgix.net']);\n+           expect(valueProvider.provide).toBe(PRECONNECT_CHECK_BLOCKLIST);\n+         });\n+\n+      it('should NOT configure PRECONNECT_CHECK_BLOCKLIST disabled with the ensurePreconnect option',\n+         () => {\n+           const providers =\n+               provideImgixLoader('https://somesite.imgix.net', {ensurePreconnect: false});\n+           expect(providers.length).toBe(1);\n+         });\n+    });\n+\n     it('should construct an image loader with the given path', () => {\n       setupTestingModule([provideImgixLoader('https://somesite.imgix.net')]);\n \n\n\n###\n\n", "completion": "refactor(common): allow loaders to specify the ensurePreconnect option (#<issue-num>)"}
{"prompt": " file path A: None | file path B: packages/common/src/directives/ng_optimized_image/lcp_image_observer.ts\n\n@@ -0,0 +1,94 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Inject, Injectable, OnDestroy, \u0275formatRuntimeError as formatRuntimeError} from '@angular/core';\n+\n+import {DOCUMENT} from '../../dom_tokens';\n+import {RuntimeErrorCode} from '../../errors';\n+\n+import {assertDevMode} from './asserts';\n+import {getUrl, imgDirectiveDetails} from './util';\n+\n+/**\n+ * Contains the logic to detect whether an image with the `NgOptimizedImage` directive\n+ * is treated as an LCP element. If so, verifies that the image is marked as a priority,\n+ * using the `priority` attribute.\n+ *\n+ * Note: this is a dev-mode only class, which should not appear in prod bundles,\n+ * thus there is no `ngDevMode` use in the code.\n+ *\n+ * Based on https://web.dev/lcp/#measure-lcp-in-javascript.\n+ */\n+@Injectable({providedIn: 'root'})\n+export class LCPImageObserver implements OnDestroy {\n+  // Map of full image URLs -> original `rawSrc` values.\n+  private images = new Map<string, string>();\n+  // Keep track of images for which `console.warn` was produced.\n+  private alreadyWarned = new Set<string>();\n+\n+  private window: Window|null = null;\n+  private observer: PerformanceObserver|null = null;\n+\n+  constructor(@Inject(DOCUMENT) doc: Document) {\n+    assertDevMode('LCP checker');\n+    const win = doc.defaultView;\n+    if (typeof win !== 'undefined' && typeof PerformanceObserver !== 'undefined') {\n+      this.window = win;\n+      this.observer = this.initPerformanceObserver();\n+    }\n+  }\n+\n+  // Inits PerformanceObserver and subscribes to LCP events.\n+  // Based on https://web.dev/lcp/#measure-lcp-in-javascript\n+  private initPerformanceObserver(): PerformanceObserver {\n+    const observer = new PerformanceObserver((entryList) => {\n+      const entries = entryList.getEntries();\n+      if (entries.length === 0) return;\n+      // Note: we use the latest entry produced by the `PerformanceObserver` as the best\n+      // signal on which element is actually an LCP one. As an example, the first image to load on\n+      // a page, by virtue of being the only thing on the page so far, is often a LCP candidate\n+      // and gets reported by PerformanceObserver, but isn't necessarily the LCP element.\n+      const lcpElement = entries[entries.length - 1];\n+      // Cast to `any` due to missing `element` on observed type of entry.\n+      const imgSrc = (lcpElement as any).element?.src ?? '';\n+\n+      // Exclude `data:` and `blob:` URLs, since they are not supported by the directive.\n+      if (imgSrc.startsWith('data:') || imgSrc.startsWith('blob:')) return;\n+\n+      const imgRawSrc = this.images.get(imgSrc);\n+      if (imgRawSrc && !this.alreadyWarned.has(imgSrc)) {\n+        this.alreadyWarned.add(imgSrc);\n+        const directiveDetails = imgDirectiveDetails(imgRawSrc);\n+        console.warn(formatRuntimeError(\n+            RuntimeErrorCode.LCP_IMG_MISSING_PRIORITY,\n+            `${directiveDetails}: the image was detected as the Largest Contentful Paint (LCP) ` +\n+                `element, so its loading should be prioritized for optimal performance. Please ` +\n+                `add the \"priority\" attribute if this image is above the fold.`));\n+      }\n+    });\n+    observer.observe({type: 'largest-contentful-paint', buffered: true});\n+    return observer;\n+  }\n+\n+  registerImage(rewrittenSrc: string, rawSrc: string) {\n+    if (!this.observer) return;\n+    this.images.set(getUrl(rewrittenSrc, this.window!).href, rawSrc);\n+  }\n+\n+  unregisterImage(rewrittenSrc: string) {\n+    if (!this.observer) return;\n+    this.images.delete(getUrl(rewrittenSrc, this.window!).href);\n+  }\n+\n+  ngOnDestroy() {\n+    if (!this.observer) return;\n+    this.observer.disconnect();\n+    this.images.clear();\n+    this.alreadyWarned.clear();\n+  }\n+}\n\n---\n file path A: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -8,13 +8,12 @@\n \n import {Directive, ElementRef, Inject, Injectable, Injector, Input, NgModule, NgZone, OnChanges, OnDestroy, OnInit, Renderer2, SimpleChanges, \u0275formatRuntimeError as formatRuntimeError, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n-import {DOCUMENT} from '../../dom_tokens';\n import {RuntimeErrorCode} from '../../errors';\n \n-import {assertDevMode} from './asserts';\n import {IMAGE_LOADER, ImageLoader} from './image_loaders/image_loader';\n+import {LCPImageObserver} from './lcp_image_observer';\n import {PreconnectLinkChecker} from './preconnect_link_checker';\n-import {getUrl, imgDirectiveDetails} from './util';\n+import {imgDirectiveDetails} from './util';\n \n /**\n  * When a Base64-encoded image is passed as an input to the `NgOptimizedImage` directive,\n@@ -37,85 +36,6 @@ const VALID_WIDTH_DESCRIPTOR_SRCSET = /^((\\s*\\d+w\\s*(,|$)){1,})$/;\n  */\n const VALID_DENSITY_DESCRIPTOR_SRCSET = /^((\\s*\\d(\\.\\d)?x\\s*(,|$)){1,})$/;\n \n-/**\n- * Contains the logic to detect whether an image with the `NgOptimizedImage` directive\n- * is treated as an LCP element. If so, verifies that the image is marked as a priority,\n- * using the `priority` attribute.\n- *\n- * Note: this is a dev-mode only class, which should not appear in prod bundles,\n- * thus there is no `ngDevMode` use in the code.\n- *\n- * Based on https://web.dev/lcp/#measure-lcp-in-javascript.\n- */\n-@Injectable({providedIn: 'root'})\n-export class LCPImageObserver implements OnDestroy {\n-  // Map of full image URLs -> original `rawSrc` values.\n-  private images = new Map<string, string>();\n-  // Keep track of images for which `console.warn` was produced.\n-  private alreadyWarned = new Set<string>();\n-\n-  private window: Window|null = null;\n-  private observer: PerformanceObserver|null = null;\n-\n-  constructor(@Inject(DOCUMENT) doc: Document) {\n-    assertDevMode('LCP checker');\n-    const win = doc.defaultView;\n-    if (typeof win !== 'undefined' && typeof PerformanceObserver !== 'undefined') {\n-      this.window = win;\n-      this.observer = this.initPerformanceObserver();\n-    }\n-  }\n-\n-  // Inits PerformanceObserver and subscribes to LCP events.\n-  // Based on https://web.dev/lcp/#measure-lcp-in-javascript\n-  private initPerformanceObserver(): PerformanceObserver {\n-    const observer = new PerformanceObserver((entryList) => {\n-      const entries = entryList.getEntries();\n-      if (entries.length === 0) return;\n-      // Note: we use the latest entry produced by the `PerformanceObserver` as the best\n-      // signal on which element is actually an LCP one. As an example, the first image to load on\n-      // a page, by virtue of being the only thing on the page so far, is often a LCP candidate\n-      // and gets reported by PerformanceObserver, but isn't necessarily the LCP element.\n-      const lcpElement = entries[entries.length - 1];\n-      // Cast to `any` due to missing `element` on observed type of entry.\n-      const imgSrc = (lcpElement as any).element?.src ?? '';\n-\n-      // Exclude `data:` and `blob:` URLs, since they are not supported by the directive.\n-      if (imgSrc.startsWith('data:') || imgSrc.startsWith('blob:')) return;\n-\n-      const imgRawSrc = this.images.get(imgSrc);\n-      if (imgRawSrc && !this.alreadyWarned.has(imgSrc)) {\n-        this.alreadyWarned.add(imgSrc);\n-        const directiveDetails = imgDirectiveDetails(imgRawSrc);\n-        console.warn(formatRuntimeError(\n-            RuntimeErrorCode.LCP_IMG_MISSING_PRIORITY,\n-            `${directiveDetails}: the image was detected as the Largest Contentful Paint (LCP) ` +\n-                `element, so its loading should be prioritized for optimal performance. Please ` +\n-                `add the \"priority\" attribute if this image is above the fold.`));\n-      }\n-    });\n-    observer.observe({type: 'largest-contentful-paint', buffered: true});\n-    return observer;\n-  }\n-\n-  registerImage(rewrittenSrc: string, rawSrc: string) {\n-    if (!this.observer) return;\n-    this.images.set(getUrl(rewrittenSrc, this.window!).href, rawSrc);\n-  }\n-\n-  unregisterImage(rewrittenSrc: string) {\n-    if (!this.observer) return;\n-    this.images.delete(getUrl(rewrittenSrc, this.window!).href);\n-  }\n-\n-  ngOnDestroy() {\n-    if (!this.observer) return;\n-    this.observer.disconnect();\n-    this.images.clear();\n-    this.alreadyWarned.clear();\n-  }\n-}\n-\n /**\n  * ** EXPERIMENTAL **\n  *\n\n\n###\n\n", "completion": "refactor(common): move LCP image observer to a separate file (#<issue-num>) (#<issue-num>)"}
{"prompt": " file path A: None | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts\n\n@@ -0,0 +1,39 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {InjectionToken} from '@angular/core';\n+\n+/**\n+ * Config options recognized by the image loader function.\n+ */\n+export interface ImageLoaderConfig {\n+  // Name of the image to be added to the image request URL\n+  src: string;\n+  // Width of the requested image (to be used when generating srcset)\n+  width?: number;\n+}\n+\n+/**\n+ * Represents an image loader function.\n+ */\n+export type ImageLoader = (config: ImageLoaderConfig) => string;\n+\n+/**\n+ * Noop image loader that does no transformation to the original src and just returns it as is.\n+ * This loader is used as a default one if more specific logic is not provided in an app config.\n+ */\n+const noopImageLoader = (config: ImageLoaderConfig) => config.src;\n+\n+/**\n+ * Special token that allows to configure a function that will be used to produce an image URL based\n+ * on the specified input.\n+ */\n+export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n+  providedIn: 'root',\n+  factory: () => noopImageLoader,\n+});\n\n---\n file path A: None | file path B: packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts\n\n@@ -0,0 +1,67 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Provider, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+\n+import {RuntimeErrorCode} from '../../../errors';\n+\n+import {IMAGE_LOADER, ImageLoaderConfig} from './image_loader';\n+\n+/**\n+ * Function that generates a built-in ImageLoader for Imgix and turns it\n+ * into an Angular provider.\n+ *\n+ * @param path path to the desired Imgix origin,\n+ * e.g. https://somepath.imgix.net or https://images.mysite.com\n+ * @returns Provider that provides an ImageLoader function\n+ */\n+export function provideImgixLoader(path: string): Provider {\n+  ngDevMode && assertValidPath(path);\n+  path = normalizePath(path);\n+\n+  return {\n+    provide: IMAGE_LOADER,\n+    useValue: (config: ImageLoaderConfig) => {\n+      const url = new URL(`${path}/${normalizeSrc(config.src)}`);\n+      // This setting ensures the smallest allowable format is set.\n+      url.searchParams.set('auto', 'format');\n+      config.width && url.searchParams.set('w', config.width.toString());\n+      return url.href;\n+    }\n+  };\n+}\n+\n+function assertValidPath(path: unknown) {\n+  const isString = typeof path === 'string';\n+\n+  if (!isString || path.trim() === '') {\n+    throwInvalidPathError(path);\n+  }\n+\n+  try {\n+    const url = new URL(path);\n+  } catch {\n+    throwInvalidPathError(path);\n+  }\n+}\n+\n+function throwInvalidPathError(path: unknown): never {\n+  throw new RuntimeError(\n+      RuntimeErrorCode.INVALID_INPUT,\n+      `ImgixLoader has detected an invalid path: ` +\n+          `expecting a path like https://somepath.imgix.net/` +\n+          `but got: \\`${path}\\``);\n+}\n+\n+function normalizePath(path: string) {\n+  return path[path.length - 1] === '/' ? path.slice(0, -1) : path;\n+}\n+\n+function normalizeSrc(src: string) {\n+  return src[0] === '/' ? src.slice(1) : src;\n+}\n\n---\n file path A: None | file path B: packages/common/src/directives/ng_optimized_image/index.ts\n\n@@ -0,0 +1,10 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+export {IMAGE_LOADER, ImageLoader, ImageLoaderConfig} from './image_loaders/image_loader';\n+export {provideImgixLoader} from './image_loaders/imgix_loader';\n+export {NgOptimizedImage, NgOptimizedImageModule} from './ng_optimized_image';\n\n---\n file path A: packages/common/src/directives/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts\n\n@@ -6,31 +6,12 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Directive, ElementRef, Inject, Injectable, InjectionToken, Injector, Input, NgModule, NgZone, OnChanges, OnDestroy, OnInit, Renderer2, SimpleChanges, \u0275formatRuntimeError as formatRuntimeError, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {Directive, ElementRef, Inject, Injectable, Injector, Input, NgModule, NgZone, OnChanges, OnDestroy, OnInit, Renderer2, SimpleChanges, \u0275formatRuntimeError as formatRuntimeError, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n-import {DOCUMENT} from '../dom_tokens';\n-import {RuntimeErrorCode} from '../errors';\n+import {DOCUMENT} from '../../dom_tokens';\n+import {RuntimeErrorCode} from '../../errors';\n \n-/**\n- * Config options recognized by the image loader function.\n- */\n-export interface ImageLoaderConfig {\n-  // Name of the image to be added to the image request URL\n-  src: string;\n-  // Width of the requested image (to be used when generating srcset)\n-  width?: number;\n-}\n-\n-/**\n- * Represents an image loader function.\n- */\n-export type ImageLoader = (config: ImageLoaderConfig) => string;\n-\n-/**\n- * Noop image loader that does no transformation to the original src and just returns it as is.\n- * This loader is used as a default one if more specific logic is not provided in an app config.\n- */\n-const noopImageLoader = (config: ImageLoaderConfig) => config.src;\n+import {IMAGE_LOADER, ImageLoader} from './image_loaders/image_loader';\n \n /**\n  * When a Base64-encoded image is passed as an input to the `NgOptimizedImage` directive,\n@@ -53,15 +34,6 @@ const VALID_WIDTH_DESCRIPTOR_SRCSET = /^((\\s*\\d+w\\s*(,|$)){1,})$/;\n  */\n const VALID_DENSITY_DESCRIPTOR_SRCSET = /^((\\s*\\d(\\.\\d)?x\\s*(,|$)){1,})$/;\n \n-/**\n- * Special token that allows to configure a function that will be used to produce an image URL based\n- * on the specified input.\n- */\n-export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n-  providedIn: 'root',\n-  factory: () => noopImageLoader,\n-});\n-\n /**\n  * Contains the logic to detect whether an image with the `NgOptimizedImage` directive\n  * is treated as an LCP element. If so, verifies that the image is marked as a priority,\n\n---\n file path A: packages/common/src/private_export.ts | file path B: packages/common/src/private_export.ts\n\n@@ -6,6 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-export {IMAGE_LOADER as \u0275IMAGE_LOADER, ImageLoaderConfig as \u0275ImageLoaderConfig, NgOptimizedImage as \u0275NgOptimizedImage, NgOptimizedImageModule as \u0275NgOptimizedImageModule} from './directives/ng_optimized_image';\n+export {IMAGE_LOADER as \u0275IMAGE_LOADER, ImageLoader as \u0275ImageLoader, ImageLoaderConfig as \u0275ImageLoaderConfig, NgOptimizedImage as \u0275NgOptimizedImage, NgOptimizedImageModule as \u0275NgOptimizedImageModule, provideImgixLoader as \u0275provideImgixLoader} from './directives/ng_optimized_image';\n export {DomAdapter as \u0275DomAdapter, getDOM as \u0275getDOM, setRootDomAdapter as \u0275setRootDomAdapter} from './dom_adapter';\n export {BrowserPlatformLocation as \u0275BrowserPlatformLocation} from './location/platform_location';\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -7,7 +7,8 @@\n  */\n \n import {CommonModule, DOCUMENT} from '@angular/common';\n-import {assertValidRawSrcset, IMAGE_LOADER, ImageLoader, ImageLoaderConfig, NgOptimizedImageModule} from '@angular/common/src/directives/ng_optimized_image';\n+import {IMAGE_LOADER, ImageLoader, ImageLoaderConfig} from '@angular/common/src/directives/ng_optimized_image/image_loaders/image_loader';\n+import {assertValidRawSrcset, NgOptimizedImageModule} from '@angular/common/src/directives/ng_optimized_image/ng_optimized_image';\n import {RuntimeErrorCode} from '@angular/common/src/errors';\n import {Component} from '@angular/core';\n import {ComponentFixture, TestBed} from '@angular/core/testing';\n\n---\n file path A: None | file path B: packages/common/test/image_loaders/image_loader_spec.ts\n\n@@ -0,0 +1,148 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {CommonModule} from '@angular/common';\n+import {IMAGE_LOADER} from '@angular/common/src/directives/ng_optimized_image/image_loaders/image_loader';\n+import {provideImgixLoader} from '@angular/common/src/directives/ng_optimized_image/image_loaders/imgix_loader';\n+import {NgOptimizedImageModule} from '@angular/common/src/directives/ng_optimized_image/ng_optimized_image';\n+import {RuntimeErrorCode} from '@angular/common/src/errors';\n+import {Component} from '@angular/core';\n+import {ComponentFixture, TestBed} from '@angular/core/testing';\n+import {expect} from '@angular/platform-browser/testing/src/matchers';\n+\n+describe('Built-in image directive loaders', () => {\n+  describe('Imgix loader', () => {\n+    describe('invalid paths', () => {\n+      it('should throw if path is empty', () => {\n+        expect(() => {\n+          setupTestingModule([provideImgixLoader('')]);\n+        })\n+            .toThrowError(\n+                `NG0${RuntimeErrorCode.INVALID_INPUT}: ImgixLoader has detected an invalid path: ` +\n+                `expecting a path like https://somepath.imgix.net/` +\n+                `but got: \\`\\``);\n+      });\n+\n+      it('should throw if not a path', () => {\n+        expect(() => {\n+          setupTestingModule([provideImgixLoader('wellhellothere')]);\n+        })\n+            .toThrowError(\n+                `NG0${RuntimeErrorCode.INVALID_INPUT}: ImgixLoader has detected an invalid path: ` +\n+                `expecting a path like https://somepath.imgix.net/` +\n+                `but got: \\`wellhellothere\\``);\n+      });\n+\n+      it('should throw if path is missing a scheme', () => {\n+        expect(() => {\n+          setupTestingModule([provideImgixLoader('somepath.imgix.net')]);\n+        })\n+            .toThrowError(\n+                `NG0${RuntimeErrorCode.INVALID_INPUT}: ImgixLoader has detected an invalid path: ` +\n+                `expecting a path like https://somepath.imgix.net/` +\n+                `but got: \\`somepath.imgix.net\\``);\n+      });\n+\n+      it('should throw if path is malformed', () => {\n+        expect(() => {\n+          setupTestingModule([provideImgixLoader('somepa\\th.imgix.net? few')]);\n+        })\n+            .toThrowError(\n+                `NG0${RuntimeErrorCode.INVALID_INPUT}: ImgixLoader has detected an invalid path: ` +\n+                `expecting a path like https://somepath.imgix.net/` +\n+                `but got: \\`somepa\\th.imgix.net? few\\``);\n+      });\n+    });\n+\n+    it('should construct an image loader with the given path', () => {\n+      setupTestingModule([provideImgixLoader('https://somesite.imgix.net')]);\n+\n+      const template = `\n+      <img rawSrc=\"img.png\" width=\"150\" height=\"50\">\n+      <img rawSrc=\"img-2.png\" width=\"150\" height=\"50\">\n+    `;\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const imgs = nativeElement.querySelectorAll('img')!;\n+      expect(imgs[0].src).toBe('https://somesite.imgix.net/img.png?auto=format');\n+      expect(imgs[1].src).toBe('https://somesite.imgix.net/img-2.png?auto=format');\n+    });\n+\n+    it('should handle a trailing forward slash on the path', () => {\n+      setupTestingModule([provideImgixLoader('https://somesite.imgix.net/')]);\n+\n+      const template = `\n+      <img rawSrc=\"img.png\" width=\"150\" height=\"50\">\n+    `;\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.src).toBe('https://somesite.imgix.net/img.png?auto=format');\n+    });\n+\n+    it('should handle a leading forward slash on the src', () => {\n+      setupTestingModule([provideImgixLoader('https://somesite.imgix.net/')]);\n+\n+      const template = `\n+      <img rawSrc=\"/img.png\" width=\"150\" height=\"50\">\n+    `;\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.src).toBe('https://somesite.imgix.net/img.png?auto=format');\n+    });\n+\n+    it('should be compatible with rawSrcset', () => {\n+      setupTestingModule([provideImgixLoader('https://somesite.imgix.net')]);\n+\n+      const template = `\n+      <img rawSrc=\"img.png\" rawSrcset=\"100w, 200w\" width=\"100\" height=\"50\">\n+    `;\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.src).toBe('https://somesite.imgix.net/img.png?auto=format');\n+      expect(img.srcset)\n+          .toBe(\n+              'https://somesite.imgix.net/img.png?auto=format&w=100 100w, https://somesite.imgix.net/img.png?auto=format&w=200 200w');\n+    });\n+  });\n+});\n+\n+\n+// Helpers\n+\n+@Component({\n+  selector: 'test-cmp',\n+  template: '',\n+})\n+class TestComponent {\n+}\n+\n+function setupTestingModule(providers: any[]) {\n+  TestBed.configureTestingModule({\n+    declarations: [TestComponent],\n+    // Note: the `NgOptimizedImage` directive is experimental and is not a part of the\n+    // `CommonModule` yet, so it's imported separately.\n+    imports: [CommonModule, NgOptimizedImageModule],\n+    providers,\n+  });\n+}\n+\n+function createTestComponent(template: string): ComponentFixture<TestComponent> {\n+  return TestBed.overrideComponent(TestComponent, {set: {template: template}})\n+      .createComponent(TestComponent);\n+}\n\n---\n file path A: packages/core/test/bundling/image-directive/playground.ts | file path B: packages/core/test/bundling/image-directive/playground.ts\n\n@@ -6,14 +6,9 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275ImageLoaderConfig as ImageLoaderConfig, \u0275NgOptimizedImageModule as NgOptimizedImageModule} from '@angular/common';\n+import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275ImageLoaderConfig as ImageLoaderConfig, \u0275NgOptimizedImageModule as NgOptimizedImageModule, \u0275provideImgixLoader as provideImgixLoader} from '@angular/common';\n import {Component} from '@angular/core';\n \n-const CUSTOM_IMGIX_LOADER = (config: ImageLoaderConfig) => {\n-  const widthStr = config.width ? `?w=${config.width}` : ``;\n-  return `https://aurora-project.imgix.net/${config.src}${widthStr}`;\n-};\n-\n @Component({\n   selector: 'basic',\n   styles: [`\n@@ -49,7 +44,7 @@ const CUSTOM_IMGIX_LOADER = (config: ImageLoaderConfig) => {\n   `,\n   standalone: true,\n   imports: [NgOptimizedImageModule],\n-  providers: [{provide: IMAGE_LOADER, useValue: CUSTOM_IMGIX_LOADER}],\n+  providers: [provideImgixLoader('https://aurora-project.imgix.net')],\n })\n export class PlaygroundComponent {\n }\n\n\n###\n\n", "completion": "feat(common): add built-in Imgix loader (#<issue-num>)"}
{"prompt": " file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -435,7 +435,7 @@ describe('Image directive', () => {\n         fixture.detectChanges();\n       })\n           .toThrowError(\n-              'NG02951: The NgOptimizedImage directive has detected that the `loading` ' +\n+              'NG02952: The NgOptimizedImage directive has detected that the `loading` ' +\n               'attribute was used on an image that was marked \"priority\". ' +\n               'Images marked \"priority\" are always eagerly loaded and this behavior ' +\n               'cannot be overwritten by using the \"loading\" attribute.');\n@@ -462,7 +462,7 @@ describe('Image directive', () => {\n         fixture.detectChanges();\n       })\n           .toThrowError(\n-              'NG02951: The NgOptimizedImage directive has detected that the `loading` ' +\n+              'NG02952: The NgOptimizedImage directive has detected that the `loading` ' +\n               'attribute has an invalid value: expecting \"lazy\", \"eager\", or \"auto\"' +\n               ' but got: `fast`.');\n     });\n\n\n###\n\n", "completion": "test: update error codes used in the `NgOptimizedImage` tests (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image.ts\n\n@@ -210,6 +210,14 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n     return this._height;\n   }\n \n+  /**\n+   * The desired loading behavior (lazy, eager, or auto).\n+   * The primary use case for this input is opting-out non-priority images\n+   * from lazy loading by marking them loading='eager' or loading='auto'.\n+   * This input should not be used with priority images.\n+   */\n+  @Input() loading?: string;\n+\n   /**\n    * Indicates whether this image should have a high priority.\n    */\n@@ -242,6 +250,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n       assertNotBlobURL(this);\n       assertRequiredNumberInput(this, this.width, 'width');\n       assertRequiredNumberInput(this, this.height, 'height');\n+      assertValidLoadingInput(this);\n       if (!this.priority) {\n         // Monitor whether an image is an LCP element only in case\n         // the `priority` attribute is missing. Otherwise, an image\n@@ -270,6 +279,9 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   }\n \n   private getLoadingBehavior(): string {\n+    if (!this.priority && this.loading !== undefined && isNonEmptyString(this.loading)) {\n+      return this.loading;\n+    }\n     return this.priority ? 'eager' : 'lazy';\n   }\n \n@@ -337,6 +349,12 @@ function inputToBoolean(value: unknown): boolean {\n   return value != null && `${value}` !== 'false';\n }\n \n+function isNonEmptyString(value: unknown): boolean {\n+  const isString = typeof value === 'string';\n+  const isEmptyString = isString && value.trim() === '';\n+  return isString && !isEmptyString;\n+}\n+\n /**\n  * Invokes a function, passing an instance of the `LCPImageObserver` as an argument.\n  *\n@@ -500,3 +518,24 @@ function assertRequiredNumberInput(dir: NgOptimizedImage, inputValue: unknown, i\n             `on the mentioned element.`);\n   }\n }\n+\n+// Verifies that the `loading` attribute is set to a valid input &\n+// is not used on priority images.\n+function assertValidLoadingInput(dir: NgOptimizedImage) {\n+  if (dir.loading && dir.priority) {\n+    throw new RuntimeError(\n+        RuntimeErrorCode.INVALID_INPUT,\n+        `The NgOptimizedImage directive has detected that the \\`loading\\` attribute ` +\n+            `was used on an image that was marked \"priority\". Images marked \"priority\" ` +\n+            `are always eagerly loaded and this behavior cannot be overwritten by using ` +\n+            `the \"loading\" attribute.`);\n+  }\n+  const validInputs = ['auto', 'eager', 'lazy'];\n+  if (typeof dir.loading === 'string' && !validInputs.includes(dir.loading)) {\n+    throw new RuntimeError(\n+        RuntimeErrorCode.INVALID_INPUT,\n+        `The NgOptimizedImage directive has detected that the \\`loading\\` attribute ` +\n+            `has an invalid value: expecting \"lazy\", \"eager\", or \"auto\" but got: ` +\n+            `\\`${dir.loading}\\`.`);\n+  }\n+}\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -412,6 +412,62 @@ describe('Image directive', () => {\n     });\n   });\n \n+  describe('loading attribute', () => {\n+    it('should override the default loading behavior for non-priority images', () => {\n+      setupTestingModule();\n+\n+      const template = '<img rawSrc=\"path/img.png\" width=\"150\" height=\"50\" loading=\"eager\">';\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.getAttribute('loading')).toBe('eager');\n+    });\n+\n+    it('should throw if used with priority images', () => {\n+      setupTestingModule();\n+\n+      const template =\n+          '<img rawSrc=\"path/img.png\" width=\"150\" height=\"50\" loading=\"eager\" priority>';\n+      expect(() => {\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              'NG02951: The NgOptimizedImage directive has detected that the `loading` ' +\n+              'attribute was used on an image that was marked \"priority\". ' +\n+              'Images marked \"priority\" are always eagerly loaded and this behavior ' +\n+              'cannot be overwritten by using the \"loading\" attribute.');\n+    });\n+\n+    it('should support setting loading priority to \"auto\"', () => {\n+      setupTestingModule();\n+\n+      const template = '<img rawSrc=\"path/img.png\" width=\"150\" height=\"50\" loading=\"auto\">';\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.getAttribute('loading')).toBe('auto');\n+    });\n+\n+    it('should throw for invalid loading inputs', () => {\n+      setupTestingModule();\n+\n+      const template = '<img rawSrc=\"path/img.png\" width=\"150\" height=\"150\" loading=\"fast\">';\n+      expect(() => {\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              'NG02951: The NgOptimizedImage directive has detected that the `loading` ' +\n+              'attribute has an invalid value: expecting \"lazy\", \"eager\", or \"auto\"' +\n+              ' but got: `fast`.');\n+    });\n+  });\n+\n   describe('fetch priority', () => {\n     it('should be \"high\" for priority images', () => {\n       setupTestingModule();\n\n\n###\n\n", "completion": "feat(common): add loading attr to NgOptimizedImage (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image.ts\n\n@@ -199,17 +199,20 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   }\n \n   /**\n-   * Get a value of the `src` if it's set on a host <img> element.\n-   * This input is needed to verify that there are no `src` and `rawSrc` provided\n-   * at the same time (thus causing an ambiguity on which src to use).\n+   * Get a value of the `src` and `srcset` if they're set on a host <img> element.\n+   * These inputs are needed to verify that there are no conflicting sources provided\n+   * at the same time (thus causing an ambiguity on which src to use) and that images\n+   * don't start to load until a lazy loading strategy is set.\n    * @internal\n    */\n   @Input() src?: string;\n+  @Input() srcset?: string;\n \n   ngOnInit() {\n     if (ngDevMode) {\n       assertValidRawSrc(this.rawSrc);\n       assertNoConflictingSrc(this);\n+      assertNoConflictingSrcset(this);\n       assertNotBase64Image(this);\n       assertNotBlobURL(this);\n       assertRequiredNumberInput(this, this.width, 'width');\n@@ -314,9 +317,9 @@ function withLCPImageObserver(\n   });\n }\n \n-function imgDirectiveDetails(dir: NgOptimizedImage) {\n+function imgDirectiveDetails(rawSrc: string) {\n   return `The NgOptimizedImage directive (activated on an <img> element ` +\n-      `with the \\`rawSrc=\"${dir.rawSrc}\"\\`)`;\n+      `with the \\`rawSrc=\"${rawSrc}\"\\`)`;\n }\n \n /***** Assert functions *****/\n@@ -326,13 +329,25 @@ function assertNoConflictingSrc(dir: NgOptimizedImage) {\n   if (dir.src) {\n     throw new RuntimeError(\n         RuntimeErrorCode.UNEXPECTED_SRC_ATTR,\n-        `${imgDirectiveDetails(dir)} has detected that the \\`src\\` is also set (to ` +\n+        `${imgDirectiveDetails(dir.rawSrc)} has detected that the \\`src\\` is also set (to ` +\n             `\\`${dir.src}\\`). Please remove the \\`src\\` attribute from this image. ` +\n             `The NgOptimizedImage directive will use the \\`rawSrc\\` to compute ` +\n             `the final image URL and set the \\`src\\` itself.`);\n   }\n }\n \n+// Verifies that there is no `srcset` set on a host element.\n+function assertNoConflictingSrcset(dir: NgOptimizedImage) {\n+  if (dir.srcset) {\n+    throw new RuntimeError(\n+        RuntimeErrorCode.UNEXPECTED_SRCSET_ATTR,\n+        `${imgDirectiveDetails(dir.rawSrc)} has detected that the \\`srcset\\` has been set. ` +\n+            `Please replace the \\`srcset\\` attribute from this image with \\`rawSrcset\\`. ` +\n+            `The NgOptimizedImage directive uses \\`rawSrcset\\` to set the \\`srcset\\` attribute` +\n+            `at a time that does not disrupt lazy loading.`);\n+  }\n+}\n+\n // Verifies that the `rawSrc` is not a Base64-encoded image.\n function assertNotBase64Image(dir: NgOptimizedImage) {\n   let rawSrc = dir.rawSrc.trim();\n@@ -382,7 +397,8 @@ function assertValidRawSrc(value: unknown) {\n function postInitInputChangeError(dir: NgOptimizedImage, inputName: string): {} {\n   return new RuntimeError(\n       RuntimeErrorCode.UNEXPECTED_INPUT_CHANGE,\n-      `${imgDirectiveDetails(dir)} has detected that the \\`${inputName}\\` is updated after the ` +\n+      `${imgDirectiveDetails(dir.rawSrc)} has detected that the \\`${\n+          inputName}\\` is updated after the ` +\n           `initialization. The NgOptimizedImage directive will not react to this input change.`);\n }\n \n@@ -422,7 +438,7 @@ function assertRequiredNumberInput(dir: NgOptimizedImage, inputValue: unknown, i\n   if (typeof inputValue === 'undefined') {\n     throw new RuntimeError(\n         RuntimeErrorCode.REQUIRED_INPUT_MISSING,\n-        `${imgDirectiveDetails(dir)} has detected that the required \\`${inputName}\\` ` +\n+        `${imgDirectiveDetails(dir.rawSrc)} has detected that the required \\`${inputName}\\` ` +\n             `attribute is missing. Please specify the \\`${inputName}\\` attribute ` +\n             `on the mentioned element.`);\n   }\n\n---\n file path A: packages/common/src/errors.ts | file path B: packages/common/src/errors.ts\n\n@@ -22,8 +22,9 @@ export const enum RuntimeErrorCode {\n \n   // Image directive errors\n   UNEXPECTED_SRC_ATTR = 2950,\n-  INVALID_INPUT = 2951,\n-  UNEXPECTED_INPUT_CHANGE = 2952,\n-  REQUIRED_INPUT_MISSING = 2953,\n-  LCP_IMG_MISSING_PRIORITY = 2954,\n+  UNEXPECTED_SRCSET_ATTR = 2951,\n+  INVALID_INPUT = 2952,\n+  UNEXPECTED_INPUT_CHANGE = 2953,\n+  REQUIRED_INPUT_MISSING = 2954,\n+  LCP_IMG_MISSING_PRIORITY = 2955,\n }\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -8,6 +8,7 @@\n \n import {CommonModule, DOCUMENT} from '@angular/common';\n import {IMAGE_LOADER, ImageLoader, ImageLoaderConfig, NgOptimizedImageModule} from '@angular/common/src/directives/ng_optimized_image';\n+import {RuntimeErrorCode} from '@angular/common/src/errors';\n import {Component} from '@angular/core';\n import {ComponentFixture, TestBed} from '@angular/core/testing';\n import {expect} from '@angular/platform-browser/testing/src/matchers';\n@@ -73,12 +74,33 @@ describe('Image directive', () => {\n         fixture.detectChanges();\n       })\n           .toThrowError(\n-              'NG02950: The NgOptimizedImage directive (activated on an <img> element with the ' +\n+              `NG0${\n+                  RuntimeErrorCode\n+                      .UNEXPECTED_SRC_ATTR}: The NgOptimizedImage directive (activated on an <img> element with the ` +\n               '`rawSrc=\"path/img.png\"`) has detected that the `src` is also set (to `path/img2.png`). ' +\n               'Please remove the `src` attribute from this image. The NgOptimizedImage directive will use ' +\n               'the `rawSrc` to compute the final image URL and set the `src` itself.');\n     });\n \n+    it('should throw if both `rawSrc` and `srcset` is present', () => {\n+      setupTestingModule();\n+\n+      const template =\n+          '<img rawSrc=\"img-100.png\" srcset=\"img-100.png 100w, img-200.png 200w\" width=\"100\" height=\"50\">';\n+      expect(() => {\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              `NG0${\n+                  RuntimeErrorCode\n+                      .UNEXPECTED_SRCSET_ATTR}: The NgOptimizedImage directive (activated on an <img> element with the ` +\n+              '`rawSrc=\"img-100.png\"`) has detected that the `srcset` has been set. ' +\n+              'Please replace the `srcset` attribute from this image with `rawSrcset`. ' +\n+              'The NgOptimizedImage directive uses `rawSrcset` to set the `srcset` attribute' +\n+              'at a time that does not disrupt lazy loading.');\n+    });\n+\n     it('should throw if `rawSrc` contains a Base64-encoded image (that starts with `data:`)', () => {\n       setupTestingModule();\n \n@@ -88,7 +110,9 @@ describe('Image directive', () => {\n         fixture.detectChanges();\n       })\n           .toThrowError(\n-              'NG02951: The NgOptimizedImage directive has detected that the `rawSrc` was set ' +\n+              `NG0${\n+                  RuntimeErrorCode\n+                      .INVALID_INPUT}: The NgOptimizedImage directive has detected that the \\`rawSrc\\` was set ` +\n               'to a Base64-encoded string (' + ANGULAR_LOGO_BASE64.substring(0, 50) + '...). ' +\n               'Base64-encoded strings are not supported by the NgOptimizedImage directive. ' +\n               'Use a regular `src` attribute (instead of `rawSrc`) to disable the NgOptimizedImage ' +\n@@ -112,7 +136,7 @@ describe('Image directive', () => {\n         // Note: use RegExp to partially match the error message, since the blob URL\n         // is created dynamically, so it might be different for each invocation.\n         const errorMessageRegExp =\n-            /NG02951: The NgOptimizedImage directive has detected that the `rawSrc` was set to a blob URL \\(blob:/;\n+            /NG02952: The NgOptimizedImage directive has detected that the `rawSrc` was set to a blob URL \\(blob:/;\n         expect(() => {\n           const template = '<img rawSrc=\"' + blobURL + '\" width=\"50\" height=\"50\">';\n           const fixture = createTestComponent(template);\n@@ -131,7 +155,9 @@ describe('Image directive', () => {\n         fixture.detectChanges();\n       })\n           .toThrowError(\n-              'NG02953: The NgOptimizedImage directive (activated on an <img> ' +\n+              `NG0${\n+                  RuntimeErrorCode\n+                      .REQUIRED_INPUT_MISSING}: The NgOptimizedImage directive (activated on an <img> ` +\n               'element with the `rawSrc=\"img.png\"`) has detected that the required ' +\n               '`width` attribute is missing. Please specify the `width` attribute ' +\n               'on the mentioned element.');\n@@ -146,7 +172,9 @@ describe('Image directive', () => {\n         fixture.detectChanges();\n       })\n           .toThrowError(\n-              'NG02951: The NgOptimizedImage directive has detected that the `width` ' +\n+              `NG0${\n+                  RuntimeErrorCode\n+                      .INVALID_INPUT}: The NgOptimizedImage directive has detected that the \\`width\\` ` +\n               'has an invalid value: expecting a number that represents the width ' +\n               'in pixels, but got: `10px`.');\n     });\n@@ -160,7 +188,9 @@ describe('Image directive', () => {\n         fixture.detectChanges();\n       })\n           .toThrowError(\n-              'NG02953: The NgOptimizedImage directive (activated on an <img> ' +\n+              `NG0${\n+                  RuntimeErrorCode\n+                      .REQUIRED_INPUT_MISSING}: The NgOptimizedImage directive (activated on an <img> ` +\n               'element with the `rawSrc=\"img.png\"`) has detected that the required ' +\n               '`height` attribute is missing. Please specify the `height` attribute ' +\n               'on the mentioned element.');\n@@ -175,7 +205,9 @@ describe('Image directive', () => {\n         fixture.detectChanges();\n       })\n           .toThrowError(\n-              'NG02951: The NgOptimizedImage directive has detected that the `height` ' +\n+              `NG0${\n+                  RuntimeErrorCode\n+                      .INVALID_INPUT}: The NgOptimizedImage directive has detected that the \\`height\\` ` +\n               'has an invalid value: expecting a number that represents the height ' +\n               'in pixels, but got: `10%`.');\n     });\n@@ -189,7 +221,9 @@ describe('Image directive', () => {\n         fixture.detectChanges();\n       })\n           .toThrowError(\n-              'NG02951: The NgOptimizedImage directive has detected that the `rawSrc` ' +\n+              `NG0${\n+                  RuntimeErrorCode\n+                      .INVALID_INPUT}: The NgOptimizedImage directive has detected that the \\`rawSrc\\` ` +\n               'has an invalid value: expecting a non-empty string, but got: `` (empty string).');\n     });\n \n@@ -202,7 +236,9 @@ describe('Image directive', () => {\n         fixture.detectChanges();\n       })\n           .toThrowError(\n-              'NG02951: The NgOptimizedImage directive has detected that the `rawSrc` ' +\n+              `NG0${\n+                  RuntimeErrorCode\n+                      .INVALID_INPUT}: The NgOptimizedImage directive has detected that the \\`rawSrc\\` ` +\n               'has an invalid value: expecting a non-empty string, but got: `  ` (empty string).');\n     });\n \n@@ -213,28 +249,29 @@ describe('Image directive', () => {\n       ['priority', true]\n     ];\n     inputs.forEach(([inputName, value]) => {\n-      it(`should throw if inputs got changed after directive init (the \\`${inputName}\\` input)`,\n-         () => {\n-           setupTestingModule();\n-\n-           const template =\n-               '<img [rawSrc]=\"rawSrc\" [width]=\"width\" [height]=\"height\" [priority]=\"priority\">';\n-           expect(() => {\n-             // Initial render\n-             const fixture = createTestComponent(template);\n-             fixture.detectChanges();\n-\n-             // Update input (expect to throw)\n-             (fixture.componentInstance as unknown as\n-              {[key: string]: unknown})[inputName as string] = value;\n-             fixture.detectChanges();\n-           })\n-               .toThrowError(\n-                   `NG02952: The NgOptimizedImage directive (activated on an <img> element ` +\n-                   `with the \\`rawSrc=\"img.png\"\\`) has detected that the \\`${inputName}\\` is ` +\n-                   `updated after the initialization. The NgOptimizedImage directive will not ` +\n-                   `react to this input change.`);\n-         });\n+      it(`should throw if inputs got changed after directive init (the \\`${inputName}\\` input)`, () => {\n+        setupTestingModule();\n+\n+        const template =\n+            '<img [rawSrc]=\"rawSrc\" [width]=\"width\" [height]=\"height\" [priority]=\"priority\">';\n+        expect(() => {\n+          // Initial render\n+          const fixture = createTestComponent(template);\n+          fixture.detectChanges();\n+\n+          // Update input (expect to throw)\n+          (fixture.componentInstance as unknown as {[key: string]: unknown})[inputName as string] =\n+              value;\n+          fixture.detectChanges();\n+        })\n+            .toThrowError(\n+                `NG0${\n+                    RuntimeErrorCode\n+                        .UNEXPECTED_INPUT_CHANGE}: The NgOptimizedImage directive (activated on an <img> element ` +\n+                `with the \\`rawSrc=\"img.png\"\\`) has detected that the \\`${inputName}\\` is ` +\n+                `updated after the initialization. The NgOptimizedImage directive will not ` +\n+                `react to this input change.`);\n+      });\n     });\n   });\n \n\n---\n file path A: packages/core/test/bundling/image-directive/index.ts | file path B: packages/core/test/bundling/image-directive/index.ts\n\n@@ -19,7 +19,6 @@ import {PlaygroundComponent} from './playground';\n   standalone: true,\n   imports: [RouterModule],\n   template: '<router-outlet></router-outlet>',\n-\n })\n export class RootComponent {\n }\n\n\n###\n\n", "completion": "fix(common): throw if srcset is used with rawSrc (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Directive, ElementRef, Inject, Injectable, InjectionToken, Injector, Input, NgZone, OnChanges, OnDestroy, OnInit, Renderer2, SimpleChanges, \u0275formatRuntimeError as formatRuntimeError, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {Directive, ElementRef, Inject, Injectable, InjectionToken, Injector, Input, NgModule, NgZone, OnChanges, OnDestroy, OnInit, Renderer2, SimpleChanges, \u0275formatRuntimeError as formatRuntimeError, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {DOCUMENT} from '../dom_tokens';\n import {RuntimeErrorCode} from '../errors';\n@@ -144,7 +144,6 @@ class LCPImageObserver implements OnDestroy {\n  * TODO: add Image directive usage notes.\n  */\n @Directive({\n-  standalone: true,\n   selector: 'img[rawSrc]',\n })\n export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n@@ -268,6 +267,22 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   }\n }\n \n+\n+/**\n+ * NgModule that declares and exports the `NgOptimizedImage` directive.\n+ * This NgModule is a compatibility layer for apps that use pre-v14\n+ * versions of Angular (before the `standalone` flag became available).\n+ *\n+ * The `NgOptimizedImage` will become a standalone directive in v14 and\n+ * this NgModule will be removed.\n+ */\n+@NgModule({\n+  declarations: [NgOptimizedImage],\n+  exports: [NgOptimizedImage],\n+})\n+export class NgOptimizedImageModule {\n+}\n+\n /***** Helpers *****/\n \n // Convert input value to integer.\n\n---\n file path A: packages/common/src/private_export.ts | file path B: packages/common/src/private_export.ts\n\n@@ -6,6 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-export {IMAGE_LOADER as \u0275IMAGE_LOADER, ImageLoaderConfig as \u0275ImageLoaderConfig, NgOptimizedImage as \u0275NgOptimizedImage} from './directives/ng_optimized_image';\n+export {IMAGE_LOADER as \u0275IMAGE_LOADER, ImageLoaderConfig as \u0275ImageLoaderConfig, NgOptimizedImage as \u0275NgOptimizedImage, NgOptimizedImageModule as \u0275NgOptimizedImageModule} from './directives/ng_optimized_image';\n export {DomAdapter as \u0275DomAdapter, getDOM as \u0275getDOM, setRootDomAdapter as \u0275setRootDomAdapter} from './dom_adapter';\n export {BrowserPlatformLocation as \u0275BrowserPlatformLocation} from './location/platform_location';\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {CommonModule, DOCUMENT} from '@angular/common';\n-import {IMAGE_LOADER, ImageLoader, ImageLoaderConfig, NgOptimizedImage} from '@angular/common/src/directives/ng_optimized_image';\n+import {IMAGE_LOADER, ImageLoader, ImageLoaderConfig, NgOptimizedImageModule} from '@angular/common/src/directives/ng_optimized_image';\n import {Component} from '@angular/core';\n import {ComponentFixture, TestBed} from '@angular/core/testing';\n import {expect} from '@angular/platform-browser/testing/src/matchers';\n@@ -363,7 +363,7 @@ function setupTestingModule(config?: {imageLoader: ImageLoader}) {\n     declarations: [TestComponent],\n     // Note: the `NgOptimizedImage` directive is experimental and is not a part of the\n     // `CommonModule` yet, so it's imported separately.\n-    imports: [CommonModule, NgOptimizedImage],\n+    imports: [CommonModule, NgOptimizedImageModule],\n     providers,\n   });\n }\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/basic/basic.ts | file path B: packages/core/test/bundling/image-directive/e2e/basic/basic.ts\n\n@@ -6,13 +6,13 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n+import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgOptimizedImageModule as NgOptimizedImageModule} from '@angular/common';\n import {Component} from '@angular/core';\n \n @Component({\n   selector: 'basic',\n   standalone: true,\n-  imports: [NgOptimizedImage],\n+  imports: [NgOptimizedImageModule],\n   template: `<img rawSrc=\"/e2e/a.png\" width=\"150\" height=\"150\" priority>`,\n   providers: [{provide: IMAGE_LOADER, useValue: () => '/e2e/b.png'}],\n })\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/lcp-check/lcp-check.ts | file path B: packages/core/test/bundling/image-directive/e2e/lcp-check/lcp-check.ts\n\n@@ -6,13 +6,13 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n+import {\u0275NgOptimizedImageModule as NgOptimizedImageModule} from '@angular/common';\n import {Component} from '@angular/core';\n \n @Component({\n   selector: 'lcp-check',\n   standalone: true,\n-  imports: [NgOptimizedImage],\n+  imports: [NgOptimizedImageModule],\n   template: `\n     <!--\n       'b.png' should *not* be treated as an LCP element,\n\n---\n file path A: packages/core/test/bundling/image-directive/playground.ts | file path B: packages/core/test/bundling/image-directive/playground.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275ImageLoaderConfig as ImageLoaderConfig, \u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n+import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275ImageLoaderConfig as ImageLoaderConfig, \u0275NgOptimizedImageModule as NgOptimizedImageModule} from '@angular/common';\n import {Component} from '@angular/core';\n \n const CUSTOM_IMGIX_LOADER = (config: ImageLoaderConfig) => {\n@@ -48,7 +48,7 @@ const CUSTOM_IMGIX_LOADER = (config: ImageLoaderConfig) => {\n     </main>\n   `,\n   standalone: true,\n-  imports: [NgOptimizedImage],\n+  imports: [NgOptimizedImageModule],\n   providers: [{provide: IMAGE_LOADER, useValue: CUSTOM_IMGIX_LOADER}],\n })\n export class PlaygroundComponent {\n\n\n###\n\n", "completion": "refactor(common): create an NgModule for the `NgOptimizedImage` directive (#<issue-num>)"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -71,6 +71,7 @@ var_11: &only_release_branches\n     branches:\n       only:\n         - main\n+        - image-directive\n         - /\\d+\\.\\d+\\.x/\n \n # CircleCI orbs\n\n\n###\n\n", "completion": "ci: temporarily publish snapshots for `image-directive` branch (#<issue-num>)"}
{"prompt": " file path A: packages/core/test/bundling/image-directive/BUILD.bazel | file path B: packages/core/test/bundling/image-directive/BUILD.bazel\n\n@@ -1,14 +1,14 @@\n load(\"//tools:defaults.bzl\", \"app_bundle\", \"ng_module\", \"protractor_web_test_suite\", \"ts_devserver\", \"ts_library\")\n-load(\"@npm//http-server:index.bzl\", \"http_server\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n ng_module(\n     name = \"image-directive\",\n     srcs = [\n-        \"basic/basic.ts\",\n+        \"e2e/basic/basic.ts\",\n+        \"e2e/lcp-check/lcp-check.ts\",\n         \"index.ts\",\n-        \"lcp-check/lcp-check.ts\",\n+        \"playground.ts\",\n     ],\n     deps = [\n         \"//packages/common\",\n@@ -54,26 +54,19 @@ ts_devserver(\n     static_files = [\n         \"index.html\",\n         \":tslib\",\n+        \"e2e/a.png\",\n+        \"e2e/b.png\",\n     ],\n     deps = [\":image-directive\"],\n )\n \n-http_server(\n-    name = \"prodserver\",\n-    data = [\n-        \"index.html\",\n-        \":bundle.debug.min.js\",\n-        \":bundle.min.js\",\n-    ],\n-)\n-\n ts_library(\n     name = \"img_dir_e2e_tests_lib\",\n     testonly = True,\n-    srcs = [\"e2e-util/util.ts\"] + glob([\n-        \"**/*.e2e-spec.ts\",\n+    srcs = [\"e2e/util.ts\"] + glob([\n+        \"e2e/**/*.e2e-spec.ts\",\n     ]),\n-    tsconfig = \":e2e-util/tsconfig-e2e.json\",\n+    tsconfig = \":e2e/tsconfig-e2e.json\",\n     deps = [\n         \"//packages/private/testing\",\n         \"@npm//@types/selenium-webdriver\",\n@@ -83,7 +76,7 @@ ts_library(\n \n protractor_web_test_suite(\n     name = \"protractor_tests\",\n-    on_prepare = \":e2e-util/start-server.js\",\n+    on_prepare = \":e2e/start-server.js\",\n     server = \":devserver\",\n     deps = [\n         \":img_dir_e2e_tests_lib\",\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/a.png | file path B: packages/core/test/bundling/image-directive/e2e/a.png\n\nBinary files /dev/null and b/packages/core/test/bundling/image-directive/e2e/a.png differ\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e/b.png | file path B: packages/core/test/bundling/image-directive/e2e/b.png\n\nBinary files /dev/null and b/packages/core/test/bundling/image-directive/e2e/b.png differ\n\n---\n file path A: packages/core/test/bundling/image-directive/basic/basic.e2e-spec.ts | file path B: packages/core/test/bundling/image-directive/e2e/basic/basic.e2e-spec.ts\n\n@@ -8,15 +8,15 @@\n \n import {browser, by, element} from 'protractor';\n \n-import {verifyNoBrowserErrors} from '../e2e-util/util';\n+import {verifyNoBrowserErrors} from '../util';\n \n describe('NgOptimizedImage directive', () => {\n   afterEach(verifyNoBrowserErrors);\n \n   it('should render an image with an updated `src`', async () => {\n-    await browser.get('/');\n+    await browser.get('/e2e/basic');\n     const imgs = element.all(by.css('img'));\n     const src = await imgs.get(0).getAttribute('src');\n-    expect(/a\\.png/.test(src)).toBe(true);\n+    expect(/b\\.png/.test(src)).toBe(true);\n   });\n });\n\n---\n file path A: None | file path B: packages/core/test/bundling/image-directive/e2e/basic/basic.ts\n\n@@ -0,0 +1,20 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n+import {Component} from '@angular/core';\n+\n+@Component({\n+  selector: 'basic',\n+  standalone: true,\n+  imports: [NgOptimizedImage],\n+  template: `<img rawSrc=\"/e2e/a.png\" width=\"150\" height=\"150\" priority>`,\n+  providers: [{provide: IMAGE_LOADER, useValue: () => '/e2e/b.png'}],\n+})\n+export class BasicComponent {\n+}\n\n---\n file path A: packages/core/test/bundling/image-directive/lcp-check/lcp-check.e2e-spec.ts | file path B: packages/core/test/bundling/image-directive/e2e/lcp-check/lcp-check.e2e-spec.ts\n\n@@ -10,11 +10,11 @@\n import {browser, by, element} from 'protractor';\n import {logging} from 'selenium-webdriver';\n \n-import {collectBrowserLogs} from '../e2e-util/util';\n+import {collectBrowserLogs} from '../util';\n \n describe('NgOptimizedImage directive', () => {\n   it('should log a warning when a `priority` is missing on an LCP image', async () => {\n-    await browser.get('/lcp-check');\n+    await browser.get('/e2e/lcp-check');\n \n     // Verify that both images were rendered.\n     const imgs = element.all(by.css('img'));\n\n---\n file path A: packages/core/test/bundling/image-directive/lcp-check/lcp-check.ts | file path B: packages/core/test/bundling/image-directive/e2e/lcp-check/lcp-check.ts\n\n@@ -18,12 +18,12 @@ import {Component} from '@angular/core';\n       'b.png' should *not* be treated as an LCP element,\n       since there is a bigger one right below it\n     -->\n-    <img rawSrc=\"./b.png\" width=\"5\" height=\"5\">\n+    <img rawSrc=\"/e2e/b.png\" width=\"5\" height=\"5\">\n \n     <br>\n \n     <!-- 'a.png' should be treated as an LCP element -->\n-    <img rawSrc=\"./a.png\" width=\"1500\" height=\"2500\">\n+    <img rawSrc=\"/e2e/a.png\" width=\"1500\" height=\"2500\">\n \n     <br>\n \n@@ -31,7 +31,7 @@ import {Component} from '@angular/core';\n       'b.png' should *not* be treated as an LCP element here\n       as well, since it's below the fold\n     -->\n-    <img rawSrc=\"./b.png\" width=\"10\" height=\"10\">\n+    <img rawSrc=\"/e2e/b.png\" width=\"10\" height=\"10\">\n   `,\n })\n export class LcpCheckComponent {\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e-util/start-server.js | file path B: packages/core/test/bundling/image-directive/e2e/start-server.js\n\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e-util/tsconfig-e2e.json | file path B: packages/core/test/bundling/image-directive/e2e/tsconfig-e2e.json\n\n\n---\n file path A: packages/core/test/bundling/image-directive/e2e-util/util.ts | file path B: packages/core/test/bundling/image-directive/e2e/util.ts\n\n\n---\n file path A: packages/core/test/bundling/image-directive/index.ts | file path B: packages/core/test/bundling/image-directive/index.ts\n\n@@ -10,8 +10,9 @@ import {Component, importProvidersFrom} from '@angular/core';\n import {bootstrapApplication, provideProtractorTestingSupport} from '@angular/platform-browser';\n import {RouterModule} from '@angular/router';\n \n-import {BasicComponent} from './basic/basic';\n-import {LcpCheckComponent} from './lcp-check/lcp-check';\n+import {BasicComponent} from './e2e/basic/basic';\n+import {LcpCheckComponent} from './e2e/lcp-check/lcp-check';\n+import {PlaygroundComponent} from './playground';\n \n @Component({\n   selector: 'app-root',\n@@ -24,8 +25,12 @@ export class RootComponent {\n }\n \n const ROUTES = [\n-  {path: '', component: BasicComponent},  //\n-  {path: 'lcp-check', component: LcpCheckComponent}\n+  // Paths that contain components for test/demo purposes:\n+  {path: '', component: PlaygroundComponent},\n+\n+  // Paths below are used for e2e testing:\n+  {path: 'e2e/basic', component: BasicComponent},\n+  {path: 'e2e/lcp-check', component: LcpCheckComponent}\n ];\n \n bootstrapApplication(RootComponent, {\n\n---\n file path A: packages/core/test/bundling/image-directive/basic/basic.ts | file path B: packages/core/test/bundling/image-directive/playground.ts\n\n@@ -14,7 +14,6 @@ const CUSTOM_IMGIX_LOADER = (config: ImageLoaderConfig) => {\n   return `https://aurora-project.imgix.net/${config.src}${widthStr}`;\n };\n \n-\n @Component({\n   selector: 'basic',\n   styles: [`\n@@ -52,5 +51,5 @@ const CUSTOM_IMGIX_LOADER = (config: ImageLoaderConfig) => {\n   imports: [NgOptimizedImage],\n   providers: [{provide: IMAGE_LOADER, useValue: CUSTOM_IMGIX_LOADER}],\n })\n-export class BasicComponent {\n+export class PlaygroundComponent {\n }\n\n\n###\n\n", "completion": "test(common): reorg e2e folders for the `NgOptimizedImage` directive tests (#<issue-num>)"}
{"prompt": " file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -294,18 +294,19 @@ describe('Image directive', () => {\n     it('should set `src` to match `rawSrc` if image loader is not provided', () => {\n       setupTestingModule();\n \n-      const template = '<img rawSrc=\"path/img.png\" width=\"100\" height=\"50\">';\n+      const template = '<img rawSrc=\"https://somesite.imgix.net/img.png\" width=\"100\" height=\"50\">';\n       const fixture = createTestComponent(template);\n       fixture.detectChanges();\n \n       const nativeElement = fixture.nativeElement as HTMLElement;\n       const img = nativeElement.querySelector('img')!;\n-      expect(img.src.trim()).toBe('/path/img.png');\n+      expect(img.src.trim()).toBe('https://somesite.imgix.net/img.png');\n     });\n \n     it('should set `src` using the image loader provided via the `IMAGE_LOADER` token to compose src URL',\n        () => {\n-         const imageLoader = (config: ImageLoaderConfig) => `path/${config.src}`;\n+         const imageLoader = (config: ImageLoaderConfig) =>\n+             `https://somesite.imgix.net/${config.src}`;\n          setupTestingModule({imageLoader});\n \n          const template = `\n@@ -317,14 +318,14 @@ describe('Image directive', () => {\n \n          const nativeElement = fixture.nativeElement as HTMLElement;\n          const imgs = nativeElement.querySelectorAll('img')!;\n-         expect(imgs[0].src.trim()).toBe('/path/img.png');\n-         expect(imgs[1].src.trim()).toBe('/path/img-2.png');\n+         expect(imgs[0].src.trim()).toBe('https://somesite.imgix.net/img.png');\n+         expect(imgs[1].src.trim()).toBe('https://somesite.imgix.net/img-2.png');\n        });\n \n-    it('should set`src` to an image URL that does not include a default width parameter', () => {\n+    it('should set `src` to an image URL that does not include a default width parameter', () => {\n       const imageLoader = (config: ImageLoaderConfig) => {\n         const widthStr = config.width ? `?w=${config.width}` : ``;\n-        return `path/${config.src}${widthStr}`;\n+        return `https://somesite.imgix.net/${config.src}${widthStr}`;\n       };\n       setupTestingModule({imageLoader});\n \n@@ -334,7 +335,7 @@ describe('Image directive', () => {\n \n       const nativeElement = fixture.nativeElement as HTMLElement;\n       const img = nativeElement.querySelector('img')!;\n-      expect(img.src.trim()).toBe('/path/img.png');\n+      expect(img.src.trim()).toBe('https://somesite.imgix.net/img.png');\n     });\n   });\n });\n\n\n###\n\n", "completion": "test(common): fix relative URL issue in web tests (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image.ts\n\n@@ -15,8 +15,9 @@ import {RuntimeErrorCode} from '../errors';\n  * Config options recognized by the image loader function.\n  */\n export interface ImageLoaderConfig {\n+  // Name of the image to be added to the image request URL\n   src: string;\n-  quality?: number;\n+  // Width of the requested image (to be used when generating srcset)\n   width?: number;\n }\n \n@@ -246,13 +247,10 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   }\n \n   private getRewrittenSrc(): string {\n-    const imgConfig = {\n-      src: this.rawSrc,\n-      // TODO: if we're going to support responsive serving, we don't want to request the width\n-      // based solely on the intrinsic width (e.g. if it's on mobile and the viewport is smaller).\n-      // The width would require pre-processing before passing to the image loader function.\n-      width: this.width,\n-    };\n+    // ImageLoaderConfig supports setting a width property. However, we're not setting width here\n+    // because if the developer uses rendered width instead of intrinsic width in the HTML width\n+    // attribute, the image requested may be too small for 2x+ screens.\n+    const imgConfig = {src: this.rawSrc};\n     return this.imageLoader(imgConfig);\n   }\n \n\n---\n file path A: packages/common/src/private_export.ts | file path B: packages/common/src/private_export.ts\n\n@@ -6,6 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-export {IMAGE_LOADER as \u0275IMAGE_LOADER, NgOptimizedImage as \u0275NgOptimizedImage} from './directives/ng_optimized_image';\n+export {IMAGE_LOADER as \u0275IMAGE_LOADER, ImageLoaderConfig as \u0275ImageLoaderConfig, NgOptimizedImage as \u0275NgOptimizedImage} from './directives/ng_optimized_image';\n export {DomAdapter as \u0275DomAdapter, getDOM as \u0275getDOM, setRootDomAdapter as \u0275setRootDomAdapter} from './dom_adapter';\n export {BrowserPlatformLocation as \u0275BrowserPlatformLocation} from './location/platform_location';\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -13,18 +13,6 @@ import {ComponentFixture, TestBed} from '@angular/core/testing';\n import {expect} from '@angular/platform-browser/testing/src/matchers';\n \n describe('Image directive', () => {\n-  it('should set `src` to `rawSrc` value if image loader is not provided', () => {\n-    setupTestingModule();\n-\n-    const template = '<img rawSrc=\"path/img.png\" width=\"100\" height=\"50\">';\n-    const fixture = createTestComponent(template);\n-    fixture.detectChanges();\n-\n-    const nativeElement = fixture.nativeElement as HTMLElement;\n-    const img = nativeElement.querySelector('img')!;\n-    expect(img.src.endsWith('/path/img.png')).toBeTrue();\n-  });\n-\n   it('should set `loading` and `fetchpriority` attributes before `src`', () => {\n     // Only run this test in a browser since the Node-based DOM mocks don't\n     // allow to override `HTMLImageElement.prototype.setAttribute` easily.\n@@ -75,20 +63,6 @@ describe('Image directive', () => {\n     expect(_fetchpriorityAttrId).toBeLessThan(_srcAttrId);  // was set after `src`\n   });\n \n-\n-  it('should use an image loader provided via `IMAGE_LOADER` token', () => {\n-    const imageLoader = (config: ImageLoaderConfig) => `${config.src}?w=${config.width}`;\n-    setupTestingModule({imageLoader});\n-\n-    const template = '<img rawSrc=\"path/img.png\" width=\"150\" height=\"50\">';\n-    const fixture = createTestComponent(template);\n-    fixture.detectChanges();\n-\n-    const nativeElement = fixture.nativeElement as HTMLElement;\n-    const img = nativeElement.querySelector('img')!;\n-    expect(img.src.endsWith('/path/img.png?w=150')).toBeTrue();\n-  });\n-\n   describe('setup error handling', () => {\n     it('should throw if both `src` and `rawSrc` are present', () => {\n       setupTestingModule();\n@@ -315,6 +289,54 @@ describe('Image directive', () => {\n       expect(img.getAttribute('fetchpriority')).toBe('auto');\n     });\n   });\n+\n+  describe('loaders', () => {\n+    it('should set `src` to match `rawSrc` if image loader is not provided', () => {\n+      setupTestingModule();\n+\n+      const template = '<img rawSrc=\"path/img.png\" width=\"100\" height=\"50\">';\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.src.trim()).toBe('/path/img.png');\n+    });\n+\n+    it('should set `src` using the image loader provided via the `IMAGE_LOADER` token to compose src URL',\n+       () => {\n+         const imageLoader = (config: ImageLoaderConfig) => `path/${config.src}`;\n+         setupTestingModule({imageLoader});\n+\n+         const template = `\n+        <img rawSrc=\"img.png\" width=\"150\" height=\"50\">\n+        <img rawSrc=\"img-2.png\" width=\"150\" height=\"50\">\n+      `;\n+         const fixture = createTestComponent(template);\n+         fixture.detectChanges();\n+\n+         const nativeElement = fixture.nativeElement as HTMLElement;\n+         const imgs = nativeElement.querySelectorAll('img')!;\n+         expect(imgs[0].src.trim()).toBe('/path/img.png');\n+         expect(imgs[1].src.trim()).toBe('/path/img-2.png');\n+       });\n+\n+    it('should set`src` to an image URL that does not include a default width parameter', () => {\n+      const imageLoader = (config: ImageLoaderConfig) => {\n+        const widthStr = config.width ? `?w=${config.width}` : ``;\n+        return `path/${config.src}${widthStr}`;\n+      };\n+      setupTestingModule({imageLoader});\n+\n+      const template = '<img rawSrc=\"img.png\" width=\"150\" height=\"50\">';\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.src.trim()).toBe('/path/img.png');\n+    });\n+  });\n });\n \n // Helpers\n\n---\n file path A: packages/core/test/bundling/image-directive/BUILD.bazel | file path B: packages/core/test/bundling/image-directive/BUILD.bazel\n\n@@ -54,8 +54,6 @@ ts_devserver(\n     static_files = [\n         \"index.html\",\n         \":tslib\",\n-        \"a.png\",\n-        \"b.png\",\n     ],\n     deps = [\":image-directive\"],\n )\n\n---\n file path A: packages/core/test/bundling/image-directive/a.png | file path B: packages/core/test/bundling/image-directive/a.png\n\nBinary files a/packages/core/test/bundling/image-directive/a.png and /dev/null differ\n\n---\n file path A: packages/core/test/bundling/image-directive/b.png | file path B: packages/core/test/bundling/image-directive/b.png\n\nBinary files a/packages/core/test/bundling/image-directive/b.png and /dev/null differ\n\n---\n file path A: packages/core/test/bundling/image-directive/basic/basic.e2e-spec.ts | file path B: packages/core/test/bundling/image-directive/basic/basic.e2e-spec.ts\n\n@@ -17,6 +17,6 @@ describe('NgOptimizedImage directive', () => {\n     await browser.get('/');\n     const imgs = element.all(by.css('img'));\n     const src = await imgs.get(0).getAttribute('src');\n-    expect(src.endsWith('b.png')).toBe(true);\n+    expect(/a\\.png/.test(src)).toBe(true);\n   });\n });\n\n---\n file path A: packages/core/test/bundling/image-directive/basic/basic.ts | file path B: packages/core/test/bundling/image-directive/basic/basic.ts\n\n@@ -6,15 +6,51 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n+import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275ImageLoaderConfig as ImageLoaderConfig, \u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n import {Component} from '@angular/core';\n \n+const CUSTOM_IMGIX_LOADER = (config: ImageLoaderConfig) => {\n+  const widthStr = config.width ? `?w=${config.width}` : ``;\n+  return `https://aurora-project.imgix.net/${config.src}${widthStr}`;\n+};\n+\n+\n @Component({\n   selector: 'basic',\n+  styles: [`\n+    h1 {\n+      display: flex;\n+      align-items: center;\n+    }\n+\n+    main {\n+      border: 1px solid blue;\n+      margin: 16px;\n+      padding: 16px;\n+    }\n+\n+    .spacer {\n+      height: 3000px;\n+    }\n+\n+    main img {\n+      width: 100%;\n+      height: auto;\n+    }\n+  `],\n+  template: `\n+    <h1> \n+      <img rawSrc=\"a.png\" width=\"50\" height=\"50\" priority>\n+      <span>Angular image app</span>\n+    </h1>\n+    <main>\n+      <div class=\"spacer\"></div>\n+      <img rawSrc=\"hermes.jpeg\" width=\"4030\" height=\"3020\">\n+    </main>\n+  `,\n   standalone: true,\n   imports: [NgOptimizedImage],\n-  template: `<img rawSrc=\"./a.png\" width=\"150\" height=\"150\" priority>`,\n-  providers: [{provide: IMAGE_LOADER, useValue: () => 'b.png'}],\n+  providers: [{provide: IMAGE_LOADER, useValue: CUSTOM_IMGIX_LOADER}],\n })\n export class BasicComponent {\n }\n\n---\n file path A: packages/core/test/bundling/image-directive/index.ts | file path B: packages/core/test/bundling/image-directive/index.ts\n\n@@ -18,6 +18,7 @@ import {LcpCheckComponent} from './lcp-check/lcp-check';\n   standalone: true,\n   imports: [RouterModule],\n   template: '<router-outlet></router-outlet>',\n+\n })\n export class RootComponent {\n }\n\n\n###\n\n", "completion": "fix(common): remove default for image width (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image.ts\n\n@@ -63,8 +63,10 @@ export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n   providedIn: 'root',\n })\n class LCPImageObserver implements OnDestroy {\n-  // Map of full image URLs -> image metadata (`raw-src` and `priority`).\n-  private images = new Map<string, {rawSrc: string, priority: boolean}>();\n+  // Map of full image URLs -> original `rawSrc` values.\n+  private images = new Map<string, string>();\n+  // Keep track of images for which `console.warn` was produced.\n+  private alreadyWarned = new Set<string>();\n \n   private window: Window|null = null;\n   private observer: PerformanceObserver|null = null;\n@@ -87,33 +89,36 @@ class LCPImageObserver implements OnDestroy {\n   private initPerformanceObserver(): PerformanceObserver {\n     const observer = new PerformanceObserver((entryList) => {\n       const entries = entryList.getEntries();\n-      if (entries.length > 0) {\n-        // Note: we use the latest entry produced by the `PerformanceObserver` as the best\n-        // signal on which element is actually an LCP one. As an example, the first image to load on\n-        // a page, by virtue of being the only thing on the page so far, is often a LCP candidate\n-        // and gets reported by PerformanceObserver, but isn't necessarily the LCP element.\n-        const lcpElement = entries[entries.length - 1];\n-        // Cast to `any` due to missing `element` on observed type of entry.\n-        const imgSrc = (lcpElement as any).element?.src ?? '';\n-        const img = this.images.get(imgSrc);\n-        // Exclude `data:` and `blob:` URLs, since they are not supported by the directive.\n-        if (img && !img.priority && !imgSrc.startsWith('data:') && !imgSrc.startsWith('blob:')) {\n-          const directiveDetails = imgDirectiveDetails({rawSrc: img.rawSrc} as any);\n-          console.warn(formatRuntimeError(\n-              RuntimeErrorCode.LCP_IMG_MISSING_PRIORITY,\n-              `${directiveDetails}: the image was detected as the Largest Contentful Paint (LCP) ` +\n-                  `element, so its loading should be prioritized for optimal performance. Please ` +\n-                  `add the \"priority\" attribute if this image is above the fold.`));\n-        }\n+      if (entries.length === 0) return;\n+      // Note: we use the latest entry produced by the `PerformanceObserver` as the best\n+      // signal on which element is actually an LCP one. As an example, the first image to load on\n+      // a page, by virtue of being the only thing on the page so far, is often a LCP candidate\n+      // and gets reported by PerformanceObserver, but isn't necessarily the LCP element.\n+      const lcpElement = entries[entries.length - 1];\n+      // Cast to `any` due to missing `element` on observed type of entry.\n+      const imgSrc = (lcpElement as any).element?.src ?? '';\n+\n+      // Exclude `data:` and `blob:` URLs, since they are not supported by the directive.\n+      if (imgSrc.startsWith('data:') || imgSrc.startsWith('blob:')) return;\n+\n+      const imgRawSrc = this.images.get(imgSrc);\n+      if (imgRawSrc && !this.alreadyWarned.has(imgSrc)) {\n+        this.alreadyWarned.add(imgSrc);\n+        const directiveDetails = imgDirectiveDetails({rawSrc: imgRawSrc} as any);\n+        console.warn(formatRuntimeError(\n+            RuntimeErrorCode.LCP_IMG_MISSING_PRIORITY,\n+            `${directiveDetails}: the image was detected as the Largest Contentful Paint (LCP) ` +\n+                `element, so its loading should be prioritized for optimal performance. Please ` +\n+                `add the \"priority\" attribute if this image is above the fold.`));\n       }\n     });\n     observer.observe({type: 'largest-contentful-paint', buffered: true});\n     return observer;\n   }\n \n-  registerImage(rewrittenSrc: string, rawSrc: string, priority: boolean) {\n+  registerImage(rewrittenSrc: string, rawSrc: string) {\n     if (!this.observer) return;\n-    this.images.set(this.getFullUrl(rewrittenSrc), {rawSrc, priority});\n+    this.images.set(this.getFullUrl(rewrittenSrc), rawSrc);\n   }\n \n   unregisterImage(rewrittenSrc: string) {\n@@ -125,6 +130,7 @@ class LCPImageObserver implements OnDestroy {\n     if (!this.observer) return;\n     this.observer.disconnect();\n     this.images.clear();\n+    this.alreadyWarned.clear();\n   }\n }\n \n@@ -208,10 +214,15 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n       assertNotBlobURL(this);\n       assertRequiredNumberInput(this, this.width, 'width');\n       assertRequiredNumberInput(this, this.height, 'height');\n-      withLCPImageObserver(\n-          this.injector,\n-          (observer: LCPImageObserver) =>\n-              observer.registerImage(this.getRewrittenSrc(), this.rawSrc, this.priority));\n+      if (!this.priority) {\n+        // Monitor whether an image is an LCP element only in case\n+        // the `priority` attribute is missing. Otherwise, an image\n+        // has the necessary settings and no extra checks are required.\n+        withLCPImageObserver(\n+            this.injector,\n+            (observer: LCPImageObserver) =>\n+                observer.registerImage(this.getRewrittenSrc(), this.rawSrc));\n+      }\n     }\n     this.setHostAttribute('loading', this.getLoadingBehavior());\n     this.setHostAttribute('fetchpriority', this.getFetchPriority());\n@@ -246,7 +257,7 @@ export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   }\n \n   ngOnDestroy() {\n-    if (ngDevMode) {\n+    if (ngDevMode && !this.priority) {\n       // An image is only registered in dev mode, try to unregister only in dev mode as well.\n       withLCPImageObserver(\n           this.injector,\n\n\n###\n\n", "completion": "perf(common): monitor LCP only for images without `priority` attribute (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/errors.md | file path B: goldens/public-api/common/errors.md\n\n@@ -11,6 +11,8 @@ export const enum RuntimeErrorCode {\n     // (undocumented)\n     INVALID_PIPE_ARGUMENT = 2100,\n     // (undocumented)\n+    LCP_IMG_MISSING_PRIORITY = 2954,\n+    // (undocumented)\n     NG_FOR_MISSING_DIFFER = -2200,\n     // (undocumented)\n     PARENT_NG_SWITCH_NOT_FOUND = 2000,\n\n---\n file path A: packages/common/src/directives/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image.ts\n\n@@ -86,9 +86,15 @@ class LCPImageObserver implements OnDestroy {\n   // Based on https://web.dev/lcp/#measure-lcp-in-javascript\n   private initPerformanceObserver(): PerformanceObserver {\n     const observer = new PerformanceObserver((entryList) => {\n-      for (const entry of entryList.getEntries()) {\n+      const entries = entryList.getEntries();\n+      if (entries.length > 0) {\n+        // Note: we use the latest entry produced by the `PerformanceObserver` as the best\n+        // signal on which element is actually an LCP one. As an example, the first image to load on\n+        // a page, by virtue of being the only thing on the page so far, is often a LCP candidate\n+        // and gets reported by PerformanceObserver, but isn't necessarily the LCP element.\n+        const lcpElement = entries[entries.length - 1];\n         // Cast to `any` due to missing `element` on observed type of entry.\n-        const imgSrc = (entry as any).element?.src ?? '';\n+        const imgSrc = (lcpElement as any).element?.src ?? '';\n         const img = this.images.get(imgSrc);\n         // Exclude `data:` and `blob:` URLs, since they are not supported by the directive.\n         if (img && !img.priority && !imgSrc.startsWith('data:') && !imgSrc.startsWith('blob:')) {\n\n---\n file path A: packages/core/test/bundling/image-directive/BUILD.bazel | file path B: packages/core/test/bundling/image-directive/BUILD.bazel\n\n@@ -8,6 +8,7 @@ ng_module(\n     srcs = [\n         \"basic/basic.ts\",\n         \"index.ts\",\n+        \"lcp-check/lcp-check.ts\",\n     ],\n     deps = [\n         \"//packages/common\",\n@@ -71,18 +72,20 @@ http_server(\n ts_library(\n     name = \"img_dir_e2e_tests_lib\",\n     testonly = True,\n-    srcs = glob([\"**/*.e2e-spec.ts\"]),\n-    tsconfig = \":tsconfig-e2e.json\",\n+    srcs = [\"e2e-util/util.ts\"] + glob([\n+        \"**/*.e2e-spec.ts\",\n+    ]),\n+    tsconfig = \":e2e-util/tsconfig-e2e.json\",\n     deps = [\n-        \"//packages/examples/test-utils\",\n         \"//packages/private/testing\",\n+        \"@npm//@types/selenium-webdriver\",\n         \"@npm//protractor\",\n     ],\n )\n \n protractor_web_test_suite(\n     name = \"protractor_tests\",\n-    on_prepare = \":start-server.js\",\n+    on_prepare = \":e2e-util/start-server.js\",\n     server = \":devserver\",\n     deps = [\n         \":img_dir_e2e_tests_lib\",\n\n---\n file path A: None | file path B: packages/core/test/bundling/image-directive/README.md\n\n@@ -0,0 +1,13 @@\n+* NgOptimizedImage directive testing\n+\n+This folder contains a simple application that can be used as a playground for the `NgOptimizedImage` directive testing. You can run the following command to start the dev server:\n+\n+```\n+yarn ibazel run packages/core/test/bundling/image-directive:devserver\n+```\n+\n+There is also a set of e2e tests (powered by Protractor), which can be invoked by running:\n+\n+```\n+yarn bazel test packages/core/test/bundling/image-directive:protractor_tests\n+```\n\n---\n file path A: packages/core/test/bundling/image-directive/basic/basic.e2e-spec.ts | file path B: packages/core/test/bundling/image-directive/basic/basic.e2e-spec.ts\n\n@@ -8,7 +8,7 @@\n \n import {browser, by, element} from 'protractor';\n \n-import {verifyNoBrowserErrors} from '../../../../../examples/test-utils';\n+import {verifyNoBrowserErrors} from '../e2e-util/util';\n \n describe('NgOptimizedImage directive', () => {\n   afterEach(verifyNoBrowserErrors);\n\n---\n file path A: packages/core/test/bundling/image-directive/basic/basic.ts | file path B: packages/core/test/bundling/image-directive/basic/basic.ts\n\n@@ -10,10 +10,10 @@ import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgOptimizedImage as NgOptimizedImage}\n import {Component} from '@angular/core';\n \n @Component({\n-  selector: 'app-root',\n+  selector: 'basic',\n   standalone: true,\n   imports: [NgOptimizedImage],\n-  template: `<img rawSrc=\"./a.png\" width=\"150\" height=\"150\">`,\n+  template: `<img rawSrc=\"./a.png\" width=\"150\" height=\"150\" priority>`,\n   providers: [{provide: IMAGE_LOADER, useValue: () => 'b.png'}],\n })\n export class BasicComponent {\n\n---\n file path A: packages/core/test/bundling/image-directive/start-server.js | file path B: packages/core/test/bundling/image-directive/e2e-util/start-server.js\n\n\n---\n file path A: packages/core/test/bundling/image-directive/tsconfig-e2e.json | file path B: packages/core/test/bundling/image-directive/e2e-util/tsconfig-e2e.json\n\n\n---\n file path A: None | file path B: packages/core/test/bundling/image-directive/e2e-util/util.ts\n\n@@ -0,0 +1,45 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+/* tslint:disable:no-console  */\n+import {browser} from 'protractor';\n+import {logging} from 'selenium-webdriver';\n+\n+export async function collectBrowserLogs(minLoggingLevel: logging.Level): Promise<logging.Entry[]> {\n+  const browserLog = await browser.manage().logs().get('browser');\n+  const collectedLogs: logging.Entry[] = [];\n+\n+  browserLog.forEach(logEntry => {\n+    const msg = logEntry.message;\n+\n+    // Since we currently use the `ts_devserver` from the Bazel TypeScript rules, which does\n+    // fallback to the \"index.html\" file for HTML5 pushState routing but does always serve the\n+    // expected fallback with a 404 status code, the browser will print a message about the 404,\n+    // while the page loaded properly. Ideally the \"ts_devserver\" would allow us to opt-in for\n+    // just returning a 200 status code, but the devserver is intended to be kept manually, so\n+    // we manually filter this error before ensuring there are no console errors.\n+    // TODO: This is a current limitation of using the \"ts_devserver\" with Angular routing.\n+    // Tracked with: TOOL-629\n+    if (msg.includes(\n+            `Failed to load resource: the server responded with a status of 404 (Not Found)`)) {\n+      return;\n+    }\n+\n+    console.log('>> ' + msg, logEntry);\n+\n+    if (logEntry.level.value >= minLoggingLevel.value) {\n+      collectedLogs.push(logEntry);\n+    }\n+  });\n+  return collectedLogs;\n+}\n+\n+export async function verifyNoBrowserErrors() {\n+  const logs = await collectBrowserLogs(logging.Level.INFO);\n+  expect(logs).toEqual([]);\n+}\n\n---\n file path A: packages/core/test/bundling/image-directive/index.ts | file path B: packages/core/test/bundling/image-directive/index.ts\n\n@@ -7,10 +7,11 @@\n  */\n \n import {Component, importProvidersFrom} from '@angular/core';\n-import {bootstrapApplication} from '@angular/platform-browser';\n+import {bootstrapApplication, provideProtractorTestingSupport} from '@angular/platform-browser';\n import {RouterModule} from '@angular/router';\n \n import {BasicComponent} from './basic/basic';\n+import {LcpCheckComponent} from './lcp-check/lcp-check';\n \n @Component({\n   selector: 'app-root',\n@@ -22,9 +23,13 @@ export class RootComponent {\n }\n \n const ROUTES = [\n-  {path: '', component: BasicComponent}  //\n+  {path: '', component: BasicComponent},  //\n+  {path: 'lcp-check', component: LcpCheckComponent}\n ];\n \n bootstrapApplication(RootComponent, {\n-  providers: [importProvidersFrom(RouterModule.forRoot(ROUTES))],\n+  providers: [\n+    provideProtractorTestingSupport(),  //\n+    importProvidersFrom(RouterModule.forRoot(ROUTES))\n+  ],\n });\n\n---\n file path A: None | file path B: packages/core/test/bundling/image-directive/lcp-check/lcp-check.e2e-spec.ts\n\n@@ -0,0 +1,36 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+/* tslint:disable:no-console  */\n+import {browser, by, element} from 'protractor';\n+import {logging} from 'selenium-webdriver';\n+\n+import {collectBrowserLogs} from '../e2e-util/util';\n+\n+describe('NgOptimizedImage directive', () => {\n+  it('should log a warning when a `priority` is missing on an LCP image', async () => {\n+    await browser.get('/lcp-check');\n+\n+    // Verify that both images were rendered.\n+    const imgs = element.all(by.css('img'));\n+    let srcB = await imgs.get(0).getAttribute('src');\n+    expect(srcB.endsWith('b.png')).toBe(true);\n+    const srcA = await imgs.get(1).getAttribute('src');\n+    expect(srcA.endsWith('a.png')).toBe(true);\n+    // The `b.png` image is used twice in a template.\n+    srcB = await imgs.get(2).getAttribute('src');\n+    expect(srcB.endsWith('b.png')).toBe(true);\n+\n+    // Make sure that only one warning is in the console for image `a.png`,\n+    // since the `b.png` should be below the fold and not treated as an LCP element.\n+    const logs = await collectBrowserLogs(logging.Level.WARNING);\n+    expect(logs.length).toEqual(1);\n+    // Verify that the error code and the image src are present in the error message.\n+    expect(logs[0].message).toMatch(/NG02954.*?a\\.png/);\n+  });\n+});\n\n---\n file path A: None | file path B: packages/core/test/bundling/image-directive/lcp-check/lcp-check.ts\n\n@@ -0,0 +1,38 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {\u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n+import {Component} from '@angular/core';\n+\n+@Component({\n+  selector: 'lcp-check',\n+  standalone: true,\n+  imports: [NgOptimizedImage],\n+  template: `\n+    <!--\n+      'b.png' should *not* be treated as an LCP element,\n+      since there is a bigger one right below it\n+    -->\n+    <img rawSrc=\"./b.png\" width=\"5\" height=\"5\">\n+\n+    <br>\n+\n+    <!-- 'a.png' should be treated as an LCP element -->\n+    <img rawSrc=\"./a.png\" width=\"1500\" height=\"2500\">\n+\n+    <br>\n+\n+    <!--\n+      'b.png' should *not* be treated as an LCP element here\n+      as well, since it's below the fold\n+    -->\n+    <img rawSrc=\"./b.png\" width=\"10\" height=\"10\">\n+  `,\n+})\n+export class LcpCheckComponent {\n+}\n\n\n###\n\n", "completion": "test(common): add e2e tests for LCP check logic of the `NgOptimizedImage` directive (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image.ts\n\n@@ -6,8 +6,9 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Directive, ElementRef, Inject, InjectionToken, Input, NgModule, OnChanges, OnInit, Renderer2, SimpleChanges, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {Directive, ElementRef, Inject, Injectable, InjectionToken, Injector, Input, NgZone, OnChanges, OnDestroy, OnInit, Renderer2, SimpleChanges, \u0275formatRuntimeError as formatRuntimeError, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n+import {DOCUMENT} from '../dom_tokens';\n import {RuntimeErrorCode} from '../errors';\n \n /**\n@@ -48,14 +49,84 @@ export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n   factory: () => noopImageLoader,\n });\n \n+/**\n+ * Contains the logic to detect whether an image with the `NgOptimizedImage` directive\n+ * is treated as an LCP element. If so, verifies that the image is marked as a priority,\n+ * using the `priority` attribute.\n+ *\n+ * Note: this is a dev-mode only class, which should not appear in prod bundles,\n+ * thus there is no `ngDevMode` use in the code.\n+ *\n+ * Based on https://web.dev/lcp/#measure-lcp-in-javascript.\n+ */\n+@Injectable({\n+  providedIn: 'root',\n+})\n+class LCPImageObserver implements OnDestroy {\n+  // Map of full image URLs -> image metadata (`raw-src` and `priority`).\n+  private images = new Map<string, {rawSrc: string, priority: boolean}>();\n+\n+  private window: Window|null = null;\n+  private observer: PerformanceObserver|null = null;\n+\n+  constructor(@Inject(DOCUMENT) doc: Document) {\n+    const win = doc.defaultView;\n+    if (typeof win !== 'undefined' && typeof PerformanceObserver !== 'undefined') {\n+      this.window = win;\n+      this.observer = this.initPerformanceObserver();\n+    }\n+  }\n+\n+  // Converts relative image URL to a full URL.\n+  private getFullUrl(src: string) {\n+    return new URL(src, this.window!.location.href).href;\n+  }\n+\n+  // Inits PerformanceObserver and subscribes to LCP events.\n+  // Based on https://web.dev/lcp/#measure-lcp-in-javascript\n+  private initPerformanceObserver(): PerformanceObserver {\n+    const observer = new PerformanceObserver((entryList) => {\n+      for (const entry of entryList.getEntries()) {\n+        // Cast to `any` due to missing `element` on observed type of entry.\n+        const imgSrc = (entry as any).element?.src ?? '';\n+        const img = this.images.get(imgSrc);\n+        // Exclude `data:` and `blob:` URLs, since they are not supported by the directive.\n+        if (img && !img.priority && !imgSrc.startsWith('data:') && !imgSrc.startsWith('blob:')) {\n+          const directiveDetails = imgDirectiveDetails({rawSrc: img.rawSrc} as any);\n+          console.warn(formatRuntimeError(\n+              RuntimeErrorCode.LCP_IMG_MISSING_PRIORITY,\n+              `${directiveDetails}: the image was detected as the Largest Contentful Paint (LCP) ` +\n+                  `element, so its loading should be prioritized for optimal performance. Please ` +\n+                  `add the \"priority\" attribute if this image is above the fold.`));\n+        }\n+      }\n+    });\n+    observer.observe({type: 'largest-contentful-paint', buffered: true});\n+    return observer;\n+  }\n+\n+  registerImage(rewrittenSrc: string, rawSrc: string, priority: boolean) {\n+    if (!this.observer) return;\n+    this.images.set(this.getFullUrl(rewrittenSrc), {rawSrc, priority});\n+  }\n+\n+  unregisterImage(rewrittenSrc: string) {\n+    if (!this.observer) return;\n+    this.images.delete(this.getFullUrl(rewrittenSrc));\n+  }\n+\n+  ngOnDestroy() {\n+    if (!this.observer) return;\n+    this.observer.disconnect();\n+    this.images.clear();\n+  }\n+}\n+\n /**\n  * ** EXPERIMENTAL **\n  *\n  * TODO: add Image directive description.\n  *\n- * IMPORTANT: this directive should become standalone (i.e. not attached to any NgModule) once\n- * the `standalone` flag is implemented and available as a public API.\n- *\n  * @usageNotes\n  * TODO: add Image directive usage notes.\n  */\n@@ -63,15 +134,15 @@ export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n   standalone: true,\n   selector: 'img[rawSrc]',\n })\n-export class NgOptimizedImage implements OnInit, OnChanges {\n+export class NgOptimizedImage implements OnInit, OnChanges, OnDestroy {\n   constructor(\n       @Inject(IMAGE_LOADER) private imageLoader: ImageLoader, private renderer: Renderer2,\n-      private imgElement: ElementRef) {}\n+      private imgElement: ElementRef, private injector: Injector) {}\n \n   // Private fields to keep normalized input values.\n   private _width?: number;\n   private _height?: number;\n-  private _priority?: boolean;\n+  private _priority = false;\n \n   /**\n    * Name of the source image.\n@@ -111,7 +182,7 @@ export class NgOptimizedImage implements OnInit, OnChanges {\n   set priority(value: string|boolean|undefined) {\n     this._priority = inputToBoolean(value);\n   }\n-  get priority(): boolean|undefined {\n+  get priority(): boolean {\n     return this._priority;\n   }\n \n@@ -131,6 +202,10 @@ export class NgOptimizedImage implements OnInit, OnChanges {\n       assertNotBlobURL(this);\n       assertRequiredNumberInput(this, this.width, 'width');\n       assertRequiredNumberInput(this, this.height, 'height');\n+      withLCPImageObserver(\n+          this.injector,\n+          (observer: LCPImageObserver) =>\n+              observer.registerImage(this.getRewrittenSrc(), this.rawSrc, this.priority));\n     }\n     this.setHostAttribute('loading', this.getLoadingBehavior());\n     this.setHostAttribute('fetchpriority', this.getFetchPriority());\n@@ -164,6 +239,15 @@ export class NgOptimizedImage implements OnInit, OnChanges {\n     return this.imageLoader(imgConfig);\n   }\n \n+  ngOnDestroy() {\n+    if (ngDevMode) {\n+      // An image is only registered in dev mode, try to unregister only in dev mode as well.\n+      withLCPImageObserver(\n+          this.injector,\n+          (observer: LCPImageObserver) => observer.unregisterImage(this.getRewrittenSrc()));\n+    }\n+  }\n+\n   private setHostAttribute(name: string, value: string): void {\n     this.renderer.setAttribute(this.imgElement.nativeElement, name, value);\n   }\n@@ -176,10 +260,30 @@ function inputToInteger(value: string|number|undefined): number|undefined {\n   return typeof value === 'string' ? parseInt(value, 10) : value;\n }\n \n+// Convert input value to boolean.\n function inputToBoolean(value: unknown): boolean {\n   return value != null && `${value}` !== 'false';\n }\n \n+/**\n+ * Invokes a function, passing an instance of the `LCPImageObserver` as an argument.\n+ *\n+ * Notes:\n+ * - the `LCPImageObserver` is a tree-shakable provider, provided in 'root',\n+ *   thus it's a singleton within this application\n+ * - the process of `LCPImageObserver` creation and an actual operation are invoked outside of the\n+ *   NgZone to make sure none of the calls inside the `LCPImageObserver` class trigger unnecessary\n+ *   change detection\n+ */\n+function withLCPImageObserver(\n+    injector: Injector, operation: (observer: LCPImageObserver) => void): void {\n+  const ngZone = injector.get(NgZone);\n+  return ngZone.runOutsideAngular(() => {\n+    const observer = injector.get(LCPImageObserver);\n+    operation(observer);\n+  });\n+}\n+\n function imgDirectiveDetails(dir: NgOptimizedImage) {\n   return `The NgOptimizedImage directive (activated on an <img> element ` +\n       `with the \\`rawSrc=\"${dir.rawSrc}\"\\`)`;\n\n---\n file path A: packages/common/src/errors.ts | file path B: packages/common/src/errors.ts\n\n@@ -25,4 +25,5 @@ export const enum RuntimeErrorCode {\n   INVALID_INPUT = 2951,\n   UNEXPECTED_INPUT_CHANGE = 2952,\n   REQUIRED_INPUT_MISSING = 2953,\n+  LCP_IMG_MISSING_PRIORITY = 2954,\n }\n\n---\n file path A: packages/core/src/core_private_export.ts | file path B: packages/core/src/core_private_export.ts\n\n@@ -15,7 +15,7 @@ export {getDebugNodeR2 as \u0275getDebugNodeR2} from './debug/debug_node';\n export {setCurrentInjector as \u0275setCurrentInjector} from './di/injector_compatibility';\n export {getInjectableDef as \u0275getInjectableDef, \u0275\u0275InjectableDeclaration, \u0275\u0275InjectorDef} from './di/interface/defs';\n export {INJECTOR_SCOPE as \u0275INJECTOR_SCOPE} from './di/scope';\n-export {RuntimeError as \u0275RuntimeError} from './errors';\n+export {formatRuntimeError as \u0275formatRuntimeError, RuntimeError as \u0275RuntimeError} from './errors';\n export {CurrencyIndex as \u0275CurrencyIndex, ExtraLocaleDataIndex as \u0275ExtraLocaleDataIndex, findLocaleData as \u0275findLocaleData, getLocaleCurrencyCode as \u0275getLocaleCurrencyCode, getLocalePluralCase as \u0275getLocalePluralCase, LocaleDataIndex as \u0275LocaleDataIndex, registerLocaleData as \u0275registerLocaleData, unregisterAllLocaleData as \u0275unregisterLocaleData} from './i18n/locale_data_api';\n export {DEFAULT_LOCALE_ID as \u0275DEFAULT_LOCALE_ID} from './i18n/localization';\n export {ComponentFactory as \u0275ComponentFactory} from './linker/component_factory';\n\n\n###\n\n", "completion": "feat(common): detect LCP images in `NgOptimizedImage` and assert if `priority` is set (#<issue-num>)"}
{"prompt": " file path A: packages/core/test/bundling/image-directive/BUILD.bazel | file path B: packages/core/test/bundling/image-directive/BUILD.bazel\n\n@@ -1,4 +1,4 @@\n-load(\"//tools:defaults.bzl\", \"app_bundle\", \"ng_module\", \"ts_devserver\")\n+load(\"//tools:defaults.bzl\", \"app_bundle\", \"ng_module\", \"protractor_web_test_suite\", \"ts_devserver\", \"ts_library\")\n load(\"@npm//http-server:index.bzl\", \"http_server\")\n \n package(default_visibility = [\"//visibility:public\"])\n@@ -6,12 +6,14 @@ package(default_visibility = [\"//visibility:public\"])\n ng_module(\n     name = \"image-directive\",\n     srcs = [\n+        \"basic/basic.ts\",\n         \"index.ts\",\n     ],\n     deps = [\n         \"//packages/common\",\n         \"//packages/core\",\n         \"//packages/platform-browser\",\n+        \"//packages/router\",\n     ],\n )\n \n@@ -23,6 +25,7 @@ app_bundle(\n         \"//packages/common\",\n         \"//packages/core\",\n         \"//packages/platform-browser\",\n+        \"//packages/router\",\n         \"@npm//rxjs\",\n     ],\n )\n@@ -40,7 +43,9 @@ genrule(\n \n ts_devserver(\n     name = \"devserver\",\n+    bootstrap = [\"//packages/zone.js/bundles:zone.umd.js\"],\n     entry_module = \"@angular/core/test/bundling/image-directive\",\n+    port = 4200,\n     scripts = [\n         \"//tools/rxjs:rxjs_umd_modules\",\n     ],\n@@ -62,3 +67,25 @@ http_server(\n         \":bundle.min.js\",\n     ],\n )\n+\n+ts_library(\n+    name = \"img_dir_e2e_tests_lib\",\n+    testonly = True,\n+    srcs = glob([\"**/*.e2e-spec.ts\"]),\n+    tsconfig = \":tsconfig-e2e.json\",\n+    deps = [\n+        \"//packages/examples/test-utils\",\n+        \"//packages/private/testing\",\n+        \"@npm//protractor\",\n+    ],\n+)\n+\n+protractor_web_test_suite(\n+    name = \"protractor_tests\",\n+    on_prepare = \":start-server.js\",\n+    server = \":devserver\",\n+    deps = [\n+        \":img_dir_e2e_tests_lib\",\n+        \"@npm//selenium-webdriver\",\n+    ],\n+)\n\n---\n file path A: None | file path B: packages/core/test/bundling/image-directive/basic/basic.e2e-spec.ts\n\n@@ -0,0 +1,22 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {browser, by, element} from 'protractor';\n+\n+import {verifyNoBrowserErrors} from '../../../../../examples/test-utils';\n+\n+describe('NgOptimizedImage directive', () => {\n+  afterEach(verifyNoBrowserErrors);\n+\n+  it('should render an image with an updated `src`', async () => {\n+    await browser.get('/');\n+    const imgs = element.all(by.css('img'));\n+    const src = await imgs.get(0).getAttribute('src');\n+    expect(src.endsWith('b.png')).toBe(true);\n+  });\n+});\n\n---\n file path A: None | file path B: packages/core/test/bundling/image-directive/basic/basic.ts\n\n@@ -0,0 +1,20 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n+import {Component} from '@angular/core';\n+\n+@Component({\n+  selector: 'app-root',\n+  standalone: true,\n+  imports: [NgOptimizedImage],\n+  template: `<img rawSrc=\"./a.png\" width=\"150\" height=\"150\">`,\n+  providers: [{provide: IMAGE_LOADER, useValue: () => 'b.png'}],\n+})\n+export class BasicComponent {\n+}\n\n---\n file path A: packages/core/test/bundling/image-directive/index.html | file path B: packages/core/test/bundling/image-directive/index.html\n\n@@ -3,6 +3,7 @@\n <html>\n   <head>\n     <title>Image Directive Example</title>\n+    <base href=\"/\">\n   </head>\n   <body>\n     <!-- The Angular application will be bootstrapped into this element. -->\n\n---\n file path A: packages/core/test/bundling/image-directive/index.ts | file path B: packages/core/test/bundling/image-directive/index.ts\n\n@@ -5,28 +5,26 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n-import {Component, NgModule} from '@angular/core';\n-import {BrowserModule, platformBrowser} from '@angular/platform-browser';\n+\n+import {Component, importProvidersFrom} from '@angular/core';\n+import {bootstrapApplication} from '@angular/platform-browser';\n+import {RouterModule} from '@angular/router';\n+\n+import {BasicComponent} from './basic/basic';\n \n @Component({\n   selector: 'app-root',\n-  template: `\n-    <img rawSrc=\"./a.png\" width=\"150\" height=\"150\">\n-  `,\n+  standalone: true,\n+  imports: [RouterModule],\n+  template: '<router-outlet></router-outlet>',\n })\n-class RootComponent {\n-  constructor() {}\n+export class RootComponent {\n }\n \n-@NgModule({\n-  declarations: [RootComponent],\n-  imports: [BrowserModule, NgOptimizedImage],\n-  bootstrap: [RootComponent],\n-  providers: [{provide: IMAGE_LOADER, useValue: () => 'b.png'}],\n-})\n-class ImageDirectiveExampleModule {\n-}\n+const ROUTES = [\n+  {path: '', component: BasicComponent}  //\n+];\n \n-(window as any).waitForApp =\n-    platformBrowser().bootstrapModule(ImageDirectiveExampleModule, {ngZone: 'noop'});\n+bootstrapApplication(RootComponent, {\n+  providers: [importProvidersFrom(RouterModule.forRoot(ROUTES))],\n+});\n\n---\n file path A: None | file path B: packages/core/test/bundling/image-directive/start-server.js\n\n@@ -0,0 +1,17 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+const protractorUtils = require('@bazel/protractor/protractor-utils');\n+const protractor = require('protractor');\n+\n+module.exports = async function(config) {\n+  const {port} = await protractorUtils.runServer(config.workspace, config.server, '-port', []);\n+  const serverUrl = `http://localhost:${port}`;\n+\n+  protractor.browser.baseUrl = serverUrl;\n+};\n\n---\n file path A: None | file path B: packages/core/test/bundling/image-directive/tsconfig-e2e.json\n\n@@ -0,0 +1,6 @@\n+{\n+  \"compilerOptions\": {\n+    \"lib\": [\"es2015\"],\n+    \"types\": [\"node\", \"jasminewd2\"]\n+  }\n+}\n\n\n###\n\n", "completion": "test(common): configure e2e testing infrastructure for `NgOptimizedImage` test app (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image.ts\n\n@@ -132,28 +132,28 @@ export class NgOptimizedImage implements OnInit, OnChanges {\n       assertRequiredNumberInput(this, this.width, 'width');\n       assertRequiredNumberInput(this, this.height, 'height');\n     }\n+    this.setHostAttribute('loading', this.getLoadingBehavior());\n+    this.setHostAttribute('fetchpriority', this.getFetchPriority());\n+    // The `src` attribute should be set last since other attributes\n+    // could affect the image's loading behavior.\n+    this.setHostAttribute('src', this.getRewrittenSrc());\n   }\n \n   ngOnChanges(changes: SimpleChanges) {\n     if (ngDevMode) {\n       assertNoPostInitInputChange(this, changes, ['rawSrc', 'width', 'height', 'priority']);\n     }\n-    this.setHostAttribute('loading', this.getLoadingBehavior());\n-    this.setHostAttribute('fetchpriority', this.getFetchPriority());\n-    // The `src` attribute should be set last since other attributes\n-    // could affect the image's loading behavior.\n-    this.setHostAttribute('src', this.getRewrittenSrc());\n   }\n \n-  getLoadingBehavior(): string {\n+  private getLoadingBehavior(): string {\n     return this.priority ? 'eager' : 'lazy';\n   }\n \n-  getFetchPriority(): string {\n+  private getFetchPriority(): string {\n     return this.priority ? 'high' : 'auto';\n   }\n \n-  getRewrittenSrc(): string {\n+  private getRewrittenSrc(): string {\n     const imgConfig = {\n       src: this.rawSrc,\n       // TODO: if we're going to support responsive serving, we don't want to request the width\n\n\n###\n\n", "completion": "refactor(common): move `NgOptimizedImage` logic that sets `src` to a different hook (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/errors.md | file path B: goldens/public-api/common/errors.md\n\n@@ -15,6 +15,8 @@ export const enum RuntimeErrorCode {\n     // (undocumented)\n     PARENT_NG_SWITCH_NOT_FOUND = 2000,\n     // (undocumented)\n+    REQUIRED_INPUT_MISSING = 2953,\n+    // (undocumented)\n     UNEXPECTED_INPUT_CHANGE = 2952,\n     // (undocumented)\n     UNEXPECTED_SRC_ATTR = 2950\n\n---\n file path A: packages/common/src/directives/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image.ts\n\n@@ -82,10 +82,10 @@ export class NgOptimizedImage implements OnInit, OnChanges {\n \n   /**\n    * The intrinsic width of the image in px.\n-   * This input is required unless the 'fill-parent' is provided.\n    */\n   @Input()\n   set width(value: string|number|undefined) {\n+    ngDevMode && assertValidNumberInput(value, 'width');\n     this._width = inputToInteger(value);\n   }\n   get width(): number|undefined {\n@@ -94,10 +94,10 @@ export class NgOptimizedImage implements OnInit, OnChanges {\n \n   /**\n    * The intrinsic height of the image in px.\n-   * This input is required unless the 'fill-parent' is provided.\n    */\n   @Input()\n   set height(value: string|number|undefined) {\n+    ngDevMode && assertValidNumberInput(value, 'height');\n     this._height = inputToInteger(value);\n   }\n   get height(): number|undefined {\n@@ -129,6 +129,8 @@ export class NgOptimizedImage implements OnInit, OnChanges {\n       assertNoConflictingSrc(this);\n       assertNotBase64Image(this);\n       assertNotBlobURL(this);\n+      assertRequiredNumberInput(this, this.width, 'width');\n+      assertRequiredNumberInput(this, this.height, 'height');\n     }\n   }\n \n@@ -190,9 +192,10 @@ function assertNoConflictingSrc(dir: NgOptimizedImage) {\n   if (dir.src) {\n     throw new RuntimeError(\n         RuntimeErrorCode.UNEXPECTED_SRC_ATTR,\n-        `${imgDirectiveDetails(dir)} detected that the \\`src\\` is also set (to \\`${dir.src}\\`). ` +\n-            `Please remove the \\`src\\` attribute from this image. The NgOptimizedImage directive will use ` +\n-            `the \\`rawSrc\\` to compute the final image URL and set the \\`src\\` itself.`);\n+        `${imgDirectiveDetails(dir)} has detected that the \\`src\\` is also set (to ` +\n+            `\\`${dir.src}\\`). Please remove the \\`src\\` attribute from this image. ` +\n+            `The NgOptimizedImage directive will use the \\`rawSrc\\` to compute ` +\n+            `the final image URL and set the \\`src\\` itself.`);\n   }\n }\n \n@@ -205,7 +208,7 @@ function assertNotBase64Image(dir: NgOptimizedImage) {\n     }\n     throw new RuntimeError(\n         RuntimeErrorCode.INVALID_INPUT,\n-        `The NgOptimizedImage directive detected that the \\`rawSrc\\` was set ` +\n+        `The NgOptimizedImage directive has detected that the \\`rawSrc\\` was set ` +\n             `to a Base64-encoded string (${rawSrc}). Base64-encoded strings are ` +\n             `not supported by the NgOptimizedImage directive. Use a regular \\`src\\` ` +\n             `attribute (instead of \\`rawSrc\\`) to disable the NgOptimizedImage ` +\n@@ -219,7 +222,7 @@ function assertNotBlobURL(dir: NgOptimizedImage) {\n   if (rawSrc.startsWith('blob:')) {\n     throw new RuntimeError(\n         RuntimeErrorCode.INVALID_INPUT,\n-        `The NgOptimizedImage directive detected that the \\`rawSrc\\` was set ` +\n+        `The NgOptimizedImage directive has detected that the \\`rawSrc\\` was set ` +\n             `to a blob URL (${rawSrc}). Blob URLs are not supported by the ` +\n             `NgOptimizedImage directive. Use a regular \\`src\\` attribute ` +\n             `(instead of \\`rawSrc\\`) to disable the NgOptimizedImage directive ` +\n@@ -235,7 +238,7 @@ function assertValidRawSrc(value: unknown) {\n     const extraMessage = isEmptyString ? ' (empty string)' : '';\n     throw new RuntimeError(\n         RuntimeErrorCode.INVALID_INPUT,\n-        `The NgOptimizedImage directive detected that the \\`rawSrc\\` has invalid value: ` +\n+        `The NgOptimizedImage directive has detected that the \\`rawSrc\\` has an invalid value: ` +\n             `expecting a non-empty string, but got: \\`${value}\\`${extraMessage}.`);\n   }\n }\n@@ -245,7 +248,7 @@ function assertValidRawSrc(value: unknown) {\n function postInitInputChangeError(dir: NgOptimizedImage, inputName: string): {} {\n   return new RuntimeError(\n       RuntimeErrorCode.UNEXPECTED_INPUT_CHANGE,\n-      `${imgDirectiveDetails(dir)} detected that the \\`${inputName}\\` is updated after the ` +\n+      `${imgDirectiveDetails(dir)} has detected that the \\`${inputName}\\` is updated after the ` +\n           `initialization. The NgOptimizedImage directive will not react to this input change.`);\n }\n \n@@ -266,3 +269,27 @@ function assertNoPostInitInputChange(\n     }\n   });\n }\n+\n+// Verifies that a specified input has a correct type (number).\n+function assertValidNumberInput(inputValue: unknown, inputName: string) {\n+  const isValid = typeof inputValue === 'number' ||\n+      (typeof inputValue === 'string' && /^\\d+$/.test(inputValue.trim()));\n+  if (!isValid) {\n+    throw new RuntimeError(\n+        RuntimeErrorCode.INVALID_INPUT,\n+        `The NgOptimizedImage directive has detected that the \\`${inputName}\\` has an invalid ` +\n+            `value: expecting a number that represents the ${inputName} in pixels, but got: ` +\n+            `\\`${inputValue}\\`.`);\n+  }\n+}\n+\n+// Verifies that a specified input is set.\n+function assertRequiredNumberInput(dir: NgOptimizedImage, inputValue: unknown, inputName: string) {\n+  if (typeof inputValue === 'undefined') {\n+    throw new RuntimeError(\n+        RuntimeErrorCode.REQUIRED_INPUT_MISSING,\n+        `${imgDirectiveDetails(dir)} has detected that the required \\`${inputName}\\` ` +\n+            `attribute is missing. Please specify the \\`${inputName}\\` attribute ` +\n+            `on the mentioned element.`);\n+  }\n+}\n\n---\n file path A: packages/common/src/errors.ts | file path B: packages/common/src/errors.ts\n\n@@ -24,4 +24,5 @@ export const enum RuntimeErrorCode {\n   UNEXPECTED_SRC_ATTR = 2950,\n   INVALID_INPUT = 2951,\n   UNEXPECTED_INPUT_CHANGE = 2952,\n+  REQUIRED_INPUT_MISSING = 2953,\n }\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -100,7 +100,7 @@ describe('Image directive', () => {\n       })\n           .toThrowError(\n               'NG02950: The NgOptimizedImage directive (activated on an <img> element with the ' +\n-              '`rawSrc=\"path/img.png\"`) detected that the `src` is also set (to `path/img2.png`). ' +\n+              '`rawSrc=\"path/img.png\"`) has detected that the `src` is also set (to `path/img2.png`). ' +\n               'Please remove the `src` attribute from this image. The NgOptimizedImage directive will use ' +\n               'the `rawSrc` to compute the final image URL and set the `src` itself.');\n     });\n@@ -114,7 +114,7 @@ describe('Image directive', () => {\n         fixture.detectChanges();\n       })\n           .toThrowError(\n-              'NG02951: The NgOptimizedImage directive detected that the `rawSrc` was set ' +\n+              'NG02951: The NgOptimizedImage directive has detected that the `rawSrc` was set ' +\n               'to a Base64-encoded string (' + ANGULAR_LOGO_BASE64.substring(0, 50) + '...). ' +\n               'Base64-encoded strings are not supported by the NgOptimizedImage directive. ' +\n               'Use a regular `src` attribute (instead of `rawSrc`) to disable the NgOptimizedImage ' +\n@@ -138,73 +138,129 @@ describe('Image directive', () => {\n         // Note: use RegExp to partially match the error message, since the blob URL\n         // is created dynamically, so it might be different for each invocation.\n         const errorMessageRegExp =\n-            /NG02951: The NgOptimizedImage directive detected that the `rawSrc` was set to a blob URL \\(blob:/;\n+            /NG02951: The NgOptimizedImage directive has detected that the `rawSrc` was set to a blob URL \\(blob:/;\n         expect(() => {\n           const template = '<img rawSrc=\"' + blobURL + '\" width=\"50\" height=\"50\">';\n           const fixture = createTestComponent(template);\n           fixture.detectChanges();\n         }).toThrowError(errorMessageRegExp);\n-\n         done();\n       });\n+    });\n \n-      it('should throw if `rawSrc` value is not provided', () => {\n-        setupTestingModule();\n+    it('should throw if `width` is not set', () => {\n+      setupTestingModule();\n \n-        const template = '<img rawSrc>';\n-        expect(() => {\n-          const fixture = createTestComponent(template);\n-          fixture.detectChanges();\n-        })\n-            .toThrowError(\n-                'NG02951: The NgOptimizedImage directive detected that the `rawSrc` ' +\n-                'has invalid value: expecting a non-empty string, but got: `` (empty string).');\n-      });\n+      const template = '<img rawSrc=\"img.png\" height=\"10\">';\n+      expect(() => {\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              'NG02953: The NgOptimizedImage directive (activated on an <img> ' +\n+              'element with the `rawSrc=\"img.png\"`) has detected that the required ' +\n+              '`width` attribute is missing. Please specify the `width` attribute ' +\n+              'on the mentioned element.');\n+    });\n \n-      it('should throw if `rawSrc` value is set to an empty string', () => {\n-        setupTestingModule();\n+    it('should throw if `width` has an invalid value', () => {\n+      setupTestingModule();\n \n-        const template = '<img rawSrc=\"  \">';\n-        expect(() => {\n-          const fixture = createTestComponent(template);\n-          fixture.detectChanges();\n-        })\n-            .toThrowError(\n-                'NG02951: The NgOptimizedImage directive detected that the `rawSrc` ' +\n-                'has invalid value: expecting a non-empty string, but got: `  ` (empty string).');\n-      });\n+      const template = '<img rawSrc=\"img.png\" width=\"10px\" height=\"10\">';\n+      expect(() => {\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              'NG02951: The NgOptimizedImage directive has detected that the `width` ' +\n+              'has an invalid value: expecting a number that represents the width ' +\n+              'in pixels, but got: `10px`.');\n+    });\n \n-      const inputs = [\n-        ['rawSrc', 'new-img.png'],  //\n-        ['width', 10],              //\n-        ['height', 20],             //\n-        ['priority', true]\n-      ];\n-      inputs.forEach(([inputName, value]) => {\n-        it(`should throw if inputs got changed after directive init (the \\`${inputName}\\` input)`,\n-           () => {\n-             setupTestingModule();\n-\n-             const template =\n-                 '<img [rawSrc]=\"rawSrc\" [width]=\"width\" [height]=\"height\" [priority]=\"priority\">';\n-             expect(() => {\n-               // Initial render\n-               const fixture = createTestComponent(template);\n-               fixture.detectChanges();\n-\n-               // Update input (expect to throw)\n-               (fixture.componentInstance as unknown as\n-                {[key: string]: unknown})[inputName as string] = value;\n-               fixture.detectChanges();\n-             })\n-                 .toThrowError(\n-                     `NG02952: The NgOptimizedImage directive (activated on an <img> element ` +\n-                     `with the \\`rawSrc=\"img.png\"\\`) detected that the \\`${\n-                         inputName}\\` is updated ` +\n-                     `after the initialization. The NgOptimizedImage directive will not react ` +\n-                     `to this input change.`);\n-           });\n-      });\n+    it('should throw if `height` is not set', () => {\n+      setupTestingModule();\n+\n+      const template = '<img rawSrc=\"img.png\" width=\"10\">';\n+      expect(() => {\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              'NG02953: The NgOptimizedImage directive (activated on an <img> ' +\n+              'element with the `rawSrc=\"img.png\"`) has detected that the required ' +\n+              '`height` attribute is missing. Please specify the `height` attribute ' +\n+              'on the mentioned element.');\n+    });\n+\n+    it('should throw if `height` has an invalid value', () => {\n+      setupTestingModule();\n+\n+      const template = '<img rawSrc=\"img.png\" width=\"10\" height=\"10%\">';\n+      expect(() => {\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              'NG02951: The NgOptimizedImage directive has detected that the `height` ' +\n+              'has an invalid value: expecting a number that represents the height ' +\n+              'in pixels, but got: `10%`.');\n+    });\n+\n+    it('should throw if `rawSrc` value is not provided', () => {\n+      setupTestingModule();\n+\n+      const template = '<img rawSrc>';\n+      expect(() => {\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              'NG02951: The NgOptimizedImage directive has detected that the `rawSrc` ' +\n+              'has an invalid value: expecting a non-empty string, but got: `` (empty string).');\n+    });\n+\n+    it('should throw if `rawSrc` value is set to an empty string', () => {\n+      setupTestingModule();\n+\n+      const template = '<img rawSrc=\"  \">';\n+      expect(() => {\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              'NG02951: The NgOptimizedImage directive has detected that the `rawSrc` ' +\n+              'has an invalid value: expecting a non-empty string, but got: `  ` (empty string).');\n+    });\n+\n+    const inputs = [\n+      ['rawSrc', 'new-img.png'],  //\n+      ['width', 10],              //\n+      ['height', 20],             //\n+      ['priority', true]\n+    ];\n+    inputs.forEach(([inputName, value]) => {\n+      it(`should throw if inputs got changed after directive init (the \\`${inputName}\\` input)`,\n+         () => {\n+           setupTestingModule();\n+\n+           const template =\n+               '<img [rawSrc]=\"rawSrc\" [width]=\"width\" [height]=\"height\" [priority]=\"priority\">';\n+           expect(() => {\n+             // Initial render\n+             const fixture = createTestComponent(template);\n+             fixture.detectChanges();\n+\n+             // Update input (expect to throw)\n+             (fixture.componentInstance as unknown as\n+              {[key: string]: unknown})[inputName as string] = value;\n+             fixture.detectChanges();\n+           })\n+               .toThrowError(\n+                   `NG02952: The NgOptimizedImage directive (activated on an <img> element ` +\n+                   `with the \\`rawSrc=\"img.png\"\\`) has detected that the \\`${inputName}\\` is ` +\n+                   `updated after the initialization. The NgOptimizedImage directive will not ` +\n+                   `react to this input change.`);\n+         });\n     });\n   });\n \n@@ -220,6 +276,7 @@ describe('Image directive', () => {\n       const img = nativeElement.querySelector('img')!;\n       expect(img.getAttribute('loading')).toBe('eager');\n     });\n+\n     it('should lazily load non-priority images', () => {\n       setupTestingModule();\n \n@@ -245,6 +302,7 @@ describe('Image directive', () => {\n       const img = nativeElement.querySelector('img')!;\n       expect(img.getAttribute('fetchpriority')).toBe('high');\n     });\n+\n     it('should be \"auto\" for non-priority images', () => {\n       setupTestingModule();\n \n\n\n###\n\n", "completion": "refactor(common): throw an error if `width` or `height` inputs are missing or invalid (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/errors.md | file path B: goldens/public-api/common/errors.md\n\n@@ -15,6 +15,8 @@ export const enum RuntimeErrorCode {\n     // (undocumented)\n     PARENT_NG_SWITCH_NOT_FOUND = 2000,\n     // (undocumented)\n+    UNEXPECTED_INPUT_CHANGE = 2952,\n+    // (undocumented)\n     UNEXPECTED_SRC_ATTR = 2950\n }\n \n\n---\n file path A: packages/common/src/directives/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Directive, ElementRef, Inject, InjectionToken, Input, NgModule, OnInit, Renderer2, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {Directive, ElementRef, Inject, InjectionToken, Input, NgModule, OnChanges, OnInit, Renderer2, SimpleChanges, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../errors';\n \n@@ -63,7 +63,7 @@ export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n   standalone: true,\n   selector: 'img[rawSrc]',\n })\n-export class NgOptimizedImage implements OnInit {\n+export class NgOptimizedImage implements OnInit, OnChanges {\n   constructor(\n       @Inject(IMAGE_LOADER) private imageLoader: ImageLoader, private renderer: Renderer2,\n       private imgElement: ElementRef) {}\n@@ -104,6 +104,9 @@ export class NgOptimizedImage implements OnInit {\n     return this._height;\n   }\n \n+  /**\n+   * Indicates whether this image should have a high priority.\n+   */\n   @Input()\n   set priority(value: string|boolean|undefined) {\n     this._priority = inputToBoolean(value);\n@@ -116,15 +119,23 @@ export class NgOptimizedImage implements OnInit {\n    * Get a value of the `src` if it's set on a host <img> element.\n    * This input is needed to verify that there are no `src` and `rawSrc` provided\n    * at the same time (thus causing an ambiguity on which src to use).\n+   * @internal\n    */\n   @Input() src?: string;\n \n   ngOnInit() {\n     if (ngDevMode) {\n-      assertExistingSrc(this);\n+      assertValidRawSrc(this.rawSrc);\n+      assertNoConflictingSrc(this);\n       assertNotBase64Image(this);\n       assertNotBlobURL(this);\n     }\n+  }\n+\n+  ngOnChanges(changes: SimpleChanges) {\n+    if (ngDevMode) {\n+      assertNoPostInitInputChange(this, changes, ['rawSrc', 'width', 'height', 'priority']);\n+    }\n     this.setHostAttribute('loading', this.getLoadingBehavior());\n     this.setHostAttribute('fetchpriority', this.getFetchPriority());\n     // The `src` attribute should be set last since other attributes\n@@ -175,7 +186,7 @@ function imgDirectiveDetails(dir: NgOptimizedImage) {\n /***** Assert functions *****/\n \n // Verifies that there is no `src` set on a host element.\n-function assertExistingSrc(dir: NgOptimizedImage) {\n+function assertNoConflictingSrc(dir: NgOptimizedImage) {\n   if (dir.src) {\n     throw new RuntimeError(\n         RuntimeErrorCode.UNEXPECTED_SRC_ATTR,\n@@ -215,3 +226,43 @@ function assertNotBlobURL(dir: NgOptimizedImage) {\n             `for this element.`);\n   }\n }\n+\n+// Verifies that the `rawSrc` is set to a non-empty string.\n+function assertValidRawSrc(value: unknown) {\n+  const isString = typeof value === 'string';\n+  const isEmptyString = isString && value.trim() === '';\n+  if (!isString || isEmptyString) {\n+    const extraMessage = isEmptyString ? ' (empty string)' : '';\n+    throw new RuntimeError(\n+        RuntimeErrorCode.INVALID_INPUT,\n+        `The NgOptimizedImage directive detected that the \\`rawSrc\\` has invalid value: ` +\n+            `expecting a non-empty string, but got: \\`${value}\\`${extraMessage}.`);\n+  }\n+}\n+\n+// Creates a `RuntimeError` instance to represent a situation when an input is set after\n+// the directive has initialized.\n+function postInitInputChangeError(dir: NgOptimizedImage, inputName: string): {} {\n+  return new RuntimeError(\n+      RuntimeErrorCode.UNEXPECTED_INPUT_CHANGE,\n+      `${imgDirectiveDetails(dir)} detected that the \\`${inputName}\\` is updated after the ` +\n+          `initialization. The NgOptimizedImage directive will not react to this input change.`);\n+}\n+\n+// Verify that none of the listed inputs has changed.\n+function assertNoPostInitInputChange(\n+    dir: NgOptimizedImage, changes: SimpleChanges, inputs: string[]) {\n+  inputs.forEach(input => {\n+    const isUpdated = changes.hasOwnProperty(input);\n+    if (isUpdated && !changes[input].isFirstChange()) {\n+      if (input === 'rawSrc') {\n+        // When the `rawSrc` input changes, we detect that only in the\n+        // `ngOnChanges` hook, thus the `rawSrc` is already set. We use\n+        // `rawSrc` in the error message, so we use a previous value, but\n+        // not the updated one in it.\n+        dir = {rawSrc: changes[input].previousValue} as NgOptimizedImage;\n+      }\n+      throw postInitInputChangeError(dir, input);\n+    }\n+  });\n+}\n\n---\n file path A: packages/common/src/errors.ts | file path B: packages/common/src/errors.ts\n\n@@ -23,4 +23,5 @@ export const enum RuntimeErrorCode {\n   // Image directive errors\n   UNEXPECTED_SRC_ATTR = 2950,\n   INVALID_INPUT = 2951,\n+  UNEXPECTED_INPUT_CHANGE = 2952,\n }\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -147,6 +147,64 @@ describe('Image directive', () => {\n \n         done();\n       });\n+\n+      it('should throw if `rawSrc` value is not provided', () => {\n+        setupTestingModule();\n+\n+        const template = '<img rawSrc>';\n+        expect(() => {\n+          const fixture = createTestComponent(template);\n+          fixture.detectChanges();\n+        })\n+            .toThrowError(\n+                'NG02951: The NgOptimizedImage directive detected that the `rawSrc` ' +\n+                'has invalid value: expecting a non-empty string, but got: `` (empty string).');\n+      });\n+\n+      it('should throw if `rawSrc` value is set to an empty string', () => {\n+        setupTestingModule();\n+\n+        const template = '<img rawSrc=\"  \">';\n+        expect(() => {\n+          const fixture = createTestComponent(template);\n+          fixture.detectChanges();\n+        })\n+            .toThrowError(\n+                'NG02951: The NgOptimizedImage directive detected that the `rawSrc` ' +\n+                'has invalid value: expecting a non-empty string, but got: `  ` (empty string).');\n+      });\n+\n+      const inputs = [\n+        ['rawSrc', 'new-img.png'],  //\n+        ['width', 10],              //\n+        ['height', 20],             //\n+        ['priority', true]\n+      ];\n+      inputs.forEach(([inputName, value]) => {\n+        it(`should throw if inputs got changed after directive init (the \\`${inputName}\\` input)`,\n+           () => {\n+             setupTestingModule();\n+\n+             const template =\n+                 '<img [rawSrc]=\"rawSrc\" [width]=\"width\" [height]=\"height\" [priority]=\"priority\">';\n+             expect(() => {\n+               // Initial render\n+               const fixture = createTestComponent(template);\n+               fixture.detectChanges();\n+\n+               // Update input (expect to throw)\n+               (fixture.componentInstance as unknown as\n+                {[key: string]: unknown})[inputName as string] = value;\n+               fixture.detectChanges();\n+             })\n+                 .toThrowError(\n+                     `NG02952: The NgOptimizedImage directive (activated on an <img> element ` +\n+                     `with the \\`rawSrc=\"img.png\"\\`) detected that the \\`${\n+                         inputName}\\` is updated ` +\n+                     `after the initialization. The NgOptimizedImage directive will not react ` +\n+                     `to this input change.`);\n+           });\n+      });\n     });\n   });\n \n@@ -211,6 +269,10 @@ const ANGULAR_LOGO_BASE64 =\n   template: '',\n })\n class TestComponent {\n+  width = 100;\n+  height = 50;\n+  rawSrc = 'img.png';\n+  priority = false;\n }\n \n function setupTestingModule(config?: {imageLoader: ImageLoader}) {\n\n\n###\n\n", "completion": "refactor(common): throw an error if `NgOptimizeImage` inputs change (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image.ts\n\n@@ -59,7 +59,10 @@ export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n  * @usageNotes\n  * TODO: add Image directive usage notes.\n  */\n-@Directive({selector: 'img[rawSrc]'})\n+@Directive({\n+  standalone: true,\n+  selector: 'img[rawSrc]',\n+})\n export class NgOptimizedImage implements OnInit {\n   constructor(\n       @Inject(IMAGE_LOADER) private imageLoader: ImageLoader, private renderer: Renderer2,\n@@ -153,17 +156,6 @@ export class NgOptimizedImage implements OnInit {\n   }\n }\n \n-/**\n- * Temporary NgModule that exports the NgOptimizedImage directive.\n- * The module should not be needed once the `standalone` flag is supported as a public API.\n- */\n-@NgModule({\n-  declarations: [NgOptimizedImage],\n-  exports: [NgOptimizedImage],\n-})\n-export class NgOptimizedImageModule {\n-}\n-\n /***** Helpers *****/\n \n // Convert input value to integer.\n\n---\n file path A: packages/common/src/private_export.ts | file path B: packages/common/src/private_export.ts\n\n@@ -6,6 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-export {IMAGE_LOADER as \u0275IMAGE_LOADER, NgOptimizedImage as \u0275NgOptimizedImage, NgOptimizedImageModule as \u0275NgOptimizedImageModule} from './directives/ng_optimized_image';\n+export {IMAGE_LOADER as \u0275IMAGE_LOADER, NgOptimizedImage as \u0275NgOptimizedImage} from './directives/ng_optimized_image';\n export {DomAdapter as \u0275DomAdapter, getDOM as \u0275getDOM, setRootDomAdapter as \u0275setRootDomAdapter} from './dom_adapter';\n export {BrowserPlatformLocation as \u0275BrowserPlatformLocation} from './location/platform_location';\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -217,10 +217,10 @@ function setupTestingModule(config?: {imageLoader: ImageLoader}) {\n   const providers =\n       config?.imageLoader ? [{provide: IMAGE_LOADER, useValue: config?.imageLoader}] : [];\n   TestBed.configureTestingModule({\n-    // Note: the `NgOptimizedImage` is a part of declarations for now,\n-    // since it's experimental and not yet added to the `CommonModule`.\n-    declarations: [TestComponent, NgOptimizedImage],\n-    imports: [CommonModule],\n+    declarations: [TestComponent],\n+    // Note: the `NgOptimizedImage` directive is experimental and is not a part of the\n+    // `CommonModule` yet, so it's imported separately.\n+    imports: [CommonModule, NgOptimizedImage],\n     providers,\n   });\n }\n\n---\n file path A: packages/core/test/bundling/image-directive/index.ts | file path B: packages/core/test/bundling/image-directive/index.ts\n\n@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgOptimizedImageModule as NgOptimizedImageModule} from '@angular/common';\n+import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgOptimizedImage as NgOptimizedImage} from '@angular/common';\n import {Component, NgModule} from '@angular/core';\n import {BrowserModule, platformBrowser} from '@angular/platform-browser';\n \n@@ -21,7 +21,7 @@ class RootComponent {\n \n @NgModule({\n   declarations: [RootComponent],\n-  imports: [BrowserModule, NgOptimizedImageModule],\n+  imports: [BrowserModule, NgOptimizedImage],\n   bootstrap: [RootComponent],\n   providers: [{provide: IMAGE_LOADER, useValue: () => 'b.png'}],\n })\n\n\n###\n\n", "completion": "refactor(common): mark experimental `NgOptimizedImage` directive as standalone (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image.ts\n\n@@ -30,6 +30,15 @@ export type ImageLoader = (config: ImageLoaderConfig) => string;\n  */\n const noopImageLoader = (config: ImageLoaderConfig) => config.src;\n \n+/**\n+ * When a Base64-encoded image is passed as an input to the `NgOptimizedImage` directive,\n+ * an error is thrown. The image content (as a string) might be very long, thus making\n+ * it hard to read an error message if the entire string is included. This const defines\n+ * the number of characters that should be included into the error message. The rest\n+ * of the content is truncated.\n+ */\n+const BASE64_IMG_MAX_LENGTH_IN_ERROR = 50;\n+\n /**\n  * Special token that allows to configure a function that will be used to produce an image URL based\n  * on the specified input.\n@@ -110,6 +119,8 @@ export class NgOptimizedImage implements OnInit {\n   ngOnInit() {\n     if (ngDevMode) {\n       assertExistingSrc(this);\n+      assertNotBase64Image(this);\n+      assertNotBlobURL(this);\n     }\n     this.setHostAttribute('loading', this.getLoadingBehavior());\n     this.setHostAttribute('fetchpriority', this.getFetchPriority());\n@@ -181,3 +192,34 @@ function assertExistingSrc(dir: NgOptimizedImage) {\n             `the \\`rawSrc\\` to compute the final image URL and set the \\`src\\` itself.`);\n   }\n }\n+\n+// Verifies that the `rawSrc` is not a Base64-encoded image.\n+function assertNotBase64Image(dir: NgOptimizedImage) {\n+  let rawSrc = dir.rawSrc.trim();\n+  if (rawSrc.startsWith('data:')) {\n+    if (rawSrc.length > BASE64_IMG_MAX_LENGTH_IN_ERROR) {\n+      rawSrc = rawSrc.substring(0, BASE64_IMG_MAX_LENGTH_IN_ERROR) + '...';\n+    }\n+    throw new RuntimeError(\n+        RuntimeErrorCode.INVALID_INPUT,\n+        `The NgOptimizedImage directive detected that the \\`rawSrc\\` was set ` +\n+            `to a Base64-encoded string (${rawSrc}). Base64-encoded strings are ` +\n+            `not supported by the NgOptimizedImage directive. Use a regular \\`src\\` ` +\n+            `attribute (instead of \\`rawSrc\\`) to disable the NgOptimizedImage ` +\n+            `directive for this element.`);\n+  }\n+}\n+\n+// Verifies that the `rawSrc` is not a Blob URL.\n+function assertNotBlobURL(dir: NgOptimizedImage) {\n+  const rawSrc = dir.rawSrc.trim();\n+  if (rawSrc.startsWith('blob:')) {\n+    throw new RuntimeError(\n+        RuntimeErrorCode.INVALID_INPUT,\n+        `The NgOptimizedImage directive detected that the \\`rawSrc\\` was set ` +\n+            `to a blob URL (${rawSrc}). Blob URLs are not supported by the ` +\n+            `NgOptimizedImage directive. Use a regular \\`src\\` attribute ` +\n+            `(instead of \\`rawSrc\\`) to disable the NgOptimizedImage directive ` +\n+            `for this element.`);\n+  }\n+}\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -104,6 +104,50 @@ describe('Image directive', () => {\n               'Please remove the `src` attribute from this image. The NgOptimizedImage directive will use ' +\n               'the `rawSrc` to compute the final image URL and set the `src` itself.');\n     });\n+\n+    it('should throw if `rawSrc` contains a Base64-encoded image (that starts with `data:`)', () => {\n+      setupTestingModule();\n+\n+      expect(() => {\n+        const template = '<img rawSrc=\"' + ANGULAR_LOGO_BASE64 + '\" width=\"50\" height=\"50\">';\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              'NG02951: The NgOptimizedImage directive detected that the `rawSrc` was set ' +\n+              'to a Base64-encoded string (' + ANGULAR_LOGO_BASE64.substring(0, 50) + '...). ' +\n+              'Base64-encoded strings are not supported by the NgOptimizedImage directive. ' +\n+              'Use a regular `src` attribute (instead of `rawSrc`) to disable the NgOptimizedImage ' +\n+              'directive for this element.');\n+    });\n+\n+    it('should throw if `rawSrc` contains a `blob:` URL', (done) => {\n+      // Domino does not support canvas elements properly,\n+      // so run this test only in a browser.\n+      if (!isBrowser) {\n+        done();\n+        return;\n+      }\n+\n+      const canvas = document.createElement('canvas');\n+      canvas.toBlob(function(blob) {\n+        const blobURL = URL.createObjectURL(blob!);\n+\n+        setupTestingModule();\n+\n+        // Note: use RegExp to partially match the error message, since the blob URL\n+        // is created dynamically, so it might be different for each invocation.\n+        const errorMessageRegExp =\n+            /NG02951: The NgOptimizedImage directive detected that the `rawSrc` was set to a blob URL \\(blob:/;\n+        expect(() => {\n+          const template = '<img rawSrc=\"' + blobURL + '\" width=\"50\" height=\"50\">';\n+          const fixture = createTestComponent(template);\n+          fixture.detectChanges();\n+        }).toThrowError(errorMessageRegExp);\n+\n+        done();\n+      });\n+    });\n   });\n \n   describe('lazy loading', () => {\n@@ -159,6 +203,9 @@ describe('Image directive', () => {\n \n // Helpers\n \n+const ANGULAR_LOGO_BASE64 =\n+    'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTAgMjUwIj4KICAgIDxwYXRoIGZpbGw9IiNERDAwMzEiIGQ9Ik0xMjUgMzBMMzEuOSA2My4ybDE0LjIgMTIzLjFMMTI1IDIzMGw3OC45LTQzLjcgMTQuMi0xMjMuMXoiIC8+CiAgICA8cGF0aCBmaWxsPSIjQzMwMDJGIiBkPSJNMTI1IDMwdjIyLjItLjFWMjMwbDc4LjktNDMuNyAxNC4yLTEyMy4xTDEyNSAzMHoiIC8+CiAgICA8cGF0aCAgZmlsbD0iI0ZGRkZGRiIgZD0iTTEyNSA1Mi4xTDY2LjggMTgyLjZoMjEuN2wxMS43LTI5LjJoNDkuNGwxMS43IDI5LjJIMTgzTDEyNSA1Mi4xem0xNyA4My4zaC0zNGwxNy00MC45IDE3IDQwLjl6IiAvPgogIDwvc3ZnPg==';\n+\n @Component({\n   selector: 'test-cmp',\n   template: '',\n\n\n###\n\n", "completion": "fix(common): detect `data:` and `blob:` inputs in `NgOptimizedImage` directive (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Directive, Inject, InjectionToken, Input, NgModule, OnInit, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {Directive, ElementRef, Inject, InjectionToken, Input, NgModule, OnInit, Renderer2, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../errors';\n \n@@ -50,18 +50,16 @@ export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n  * @usageNotes\n  * TODO: add Image directive usage notes.\n  */\n-@Directive({\n-  selector: 'img[rawSrc]',\n-  host: {\n-    '[src]': 'getRewrittenSrc()',\n-  },\n-})\n+@Directive({selector: 'img[rawSrc]'})\n export class NgOptimizedImage implements OnInit {\n-  constructor(@Inject(IMAGE_LOADER) private imageLoader: ImageLoader) {}\n+  constructor(\n+      @Inject(IMAGE_LOADER) private imageLoader: ImageLoader, private renderer: Renderer2,\n+      private imgElement: ElementRef) {}\n \n   // Private fields to keep normalized input values.\n   private _width?: number;\n   private _height?: number;\n+  private _priority?: boolean;\n \n   /**\n    * Name of the source image.\n@@ -94,6 +92,14 @@ export class NgOptimizedImage implements OnInit {\n     return this._height;\n   }\n \n+  @Input()\n+  set priority(value: string|boolean|undefined) {\n+    this._priority = inputToBoolean(value);\n+  }\n+  get priority(): boolean|undefined {\n+    return this._priority;\n+  }\n+\n   /**\n    * Get a value of the `src` if it's set on a host <img> element.\n    * This input is needed to verify that there are no `src` and `rawSrc` provided\n@@ -105,6 +111,19 @@ export class NgOptimizedImage implements OnInit {\n     if (ngDevMode) {\n       assertExistingSrc(this);\n     }\n+    this.setHostAttribute('loading', this.getLoadingBehavior());\n+    this.setHostAttribute('fetchpriority', this.getFetchPriority());\n+    // The `src` attribute should be set last since other attributes\n+    // could affect the image's loading behavior.\n+    this.setHostAttribute('src', this.getRewrittenSrc());\n+  }\n+\n+  getLoadingBehavior(): string {\n+    return this.priority ? 'eager' : 'lazy';\n+  }\n+\n+  getFetchPriority(): string {\n+    return this.priority ? 'high' : 'auto';\n   }\n \n   getRewrittenSrc(): string {\n@@ -117,6 +136,10 @@ export class NgOptimizedImage implements OnInit {\n     };\n     return this.imageLoader(imgConfig);\n   }\n+\n+  private setHostAttribute(name: string, value: string): void {\n+    this.renderer.setAttribute(this.imgElement.nativeElement, name, value);\n+  }\n }\n \n /**\n@@ -137,6 +160,10 @@ function inputToInteger(value: string|number|undefined): number|undefined {\n   return typeof value === 'string' ? parseInt(value, 10) : value;\n }\n \n+function inputToBoolean(value: unknown): boolean {\n+  return value != null && `${value}` !== 'false';\n+}\n+\n function imgDirectiveDetails(dir: NgOptimizedImage) {\n   return `The NgOptimizedImage directive (activated on an <img> element ` +\n       `with the \\`rawSrc=\"${dir.rawSrc}\"\\`)`;\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {CommonModule} from '@angular/common';\n+import {CommonModule, DOCUMENT} from '@angular/common';\n import {IMAGE_LOADER, ImageLoader, ImageLoaderConfig, NgOptimizedImage} from '@angular/common/src/directives/ng_optimized_image';\n import {Component} from '@angular/core';\n import {ComponentFixture, TestBed} from '@angular/core/testing';\n@@ -25,6 +25,57 @@ describe('Image directive', () => {\n     expect(img.src.endsWith('/path/img.png')).toBeTrue();\n   });\n \n+  it('should set `loading` and `fetchpriority` attributes before `src`', () => {\n+    // Only run this test in a browser since the Node-based DOM mocks don't\n+    // allow to override `HTMLImageElement.prototype.setAttribute` easily.\n+    if (!isBrowser) return;\n+\n+    setupTestingModule();\n+\n+    const template = '<img rawSrc=\"path/img.png\" width=\"150\" height=\"50\" priority>';\n+    TestBed.overrideComponent(TestComponent, {set: {template: template}});\n+\n+    const _document = TestBed.inject(DOCUMENT);\n+    const _window = _document.defaultView!;\n+    const setAttributeSpy =\n+        spyOn(_window.HTMLImageElement.prototype, 'setAttribute').and.callThrough();\n+\n+    const fixture = TestBed.createComponent(TestComponent);\n+    fixture.detectChanges();\n+\n+    const nativeElement = fixture.nativeElement as HTMLElement;\n+\n+    const img = nativeElement.querySelector('img')!;\n+    expect(img.getAttribute('loading')).toBe('eager');\n+\n+    let _imgInstance = null;\n+    let _loadingAttrId = -1;\n+    let _fetchpriorityAttrId = -1;\n+    let _srcAttrId = -1;\n+    const count = setAttributeSpy.calls.count();\n+    for (let i = 0; i < count; i++) {\n+      if (!_imgInstance) {\n+        _imgInstance = setAttributeSpy.calls.thisFor(i);\n+      } else if (_imgInstance !== setAttributeSpy.calls.thisFor(i)) {\n+        // Verify that the <img> instance is the same during the test.\n+        fail('Unexpected instance of a second <img> instance present in a test.');\n+      }\n+\n+      // Note: spy.calls.argsFor(i) returns args as an array: ['src', 'eager']\n+      const attrName = setAttributeSpy.calls.argsFor(i)[0];\n+      if (attrName == 'loading') _loadingAttrId = i;\n+      if (attrName == 'fetchpriority') _fetchpriorityAttrId = i;\n+      if (attrName == 'src') _srcAttrId = i;\n+    }\n+    // Verify that both `loading` and `fetchpriority` are set *before* `src`:\n+    expect(_loadingAttrId).toBeGreaterThan(-1);       // was actually set\n+    expect(_loadingAttrId).toBeLessThan(_srcAttrId);  // was set after `src`\n+\n+    expect(_fetchpriorityAttrId).toBeGreaterThan(-1);       // was actually set\n+    expect(_fetchpriorityAttrId).toBeLessThan(_srcAttrId);  // was set after `src`\n+  });\n+\n+\n   it('should use an image loader provided via `IMAGE_LOADER` token', () => {\n     const imageLoader = (config: ImageLoaderConfig) => `${config.src}?w=${config.width}`;\n     setupTestingModule({imageLoader});\n@@ -54,6 +105,56 @@ describe('Image directive', () => {\n               'the `rawSrc` to compute the final image URL and set the `src` itself.');\n     });\n   });\n+\n+  describe('lazy loading', () => {\n+    it('should eagerly load priority images', () => {\n+      setupTestingModule();\n+\n+      const template = '<img rawSrc=\"path/img.png\" width=\"150\" height=\"50\" priority>';\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.getAttribute('loading')).toBe('eager');\n+    });\n+    it('should lazily load non-priority images', () => {\n+      setupTestingModule();\n+\n+      const template = '<img rawSrc=\"path/img.png\" width=\"150\" height=\"50\">';\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.getAttribute('loading')).toBe('lazy');\n+    });\n+  });\n+\n+  describe('fetch priority', () => {\n+    it('should be \"high\" for priority images', () => {\n+      setupTestingModule();\n+\n+      const template = '<img rawSrc=\"path/img.png\" width=\"150\" height=\"50\" priority>';\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.getAttribute('fetchpriority')).toBe('high');\n+    });\n+    it('should be \"auto\" for non-priority images', () => {\n+      setupTestingModule();\n+\n+      const template = '<img rawSrc=\"path/img.png\" width=\"150\" height=\"50\">';\n+      const fixture = createTestComponent(template);\n+      fixture.detectChanges();\n+\n+      const nativeElement = fixture.nativeElement as HTMLElement;\n+      const img = nativeElement.querySelector('img')!;\n+      expect(img.getAttribute('fetchpriority')).toBe('auto');\n+    });\n+  });\n });\n \n // Helpers\n\n\n###\n\n", "completion": "feat(common): Add image lazy loading and fetchpriority (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image.ts\n\n@@ -51,7 +51,7 @@ export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n  * TODO: add Image directive usage notes.\n  */\n @Directive({\n-  selector: 'img[raw-src]',\n+  selector: 'img[rawSrc]',\n   host: {\n     '[src]': 'getRewrittenSrc()',\n   },\n@@ -68,7 +68,7 @@ export class NgOptimizedImage implements OnInit {\n    * Image name will be processed by the image loader and the final URL will be applied as the `src`\n    * property of the image.\n    */\n-  @Input('raw-src') rawSrc!: string;\n+  @Input() rawSrc!: string;\n \n   /**\n    * The intrinsic width of the image in px.\n@@ -96,7 +96,7 @@ export class NgOptimizedImage implements OnInit {\n \n   /**\n    * Get a value of the `src` if it's set on a host <img> element.\n-   * This input is needed to verify that there are no `src` and `raw-src` provided\n+   * This input is needed to verify that there are no `src` and `rawSrc` provided\n    * at the same time (thus causing an ambiguity on which src to use).\n    */\n   @Input() src?: string;\n@@ -139,7 +139,7 @@ function inputToInteger(value: string|number|undefined): number|undefined {\n \n function imgDirectiveDetails(dir: NgOptimizedImage) {\n   return `The NgOptimizedImage directive (activated on an <img> element ` +\n-      `with the \\`raw-src=\"${dir.rawSrc}\"\\`)`;\n+      `with the \\`rawSrc=\"${dir.rawSrc}\"\\`)`;\n }\n \n /***** Assert functions *****/\n@@ -151,6 +151,6 @@ function assertExistingSrc(dir: NgOptimizedImage) {\n         RuntimeErrorCode.UNEXPECTED_SRC_ATTR,\n         `${imgDirectiveDetails(dir)} detected that the \\`src\\` is also set (to \\`${dir.src}\\`). ` +\n             `Please remove the \\`src\\` attribute from this image. The NgOptimizedImage directive will use ` +\n-            `the \\`raw-src\\` to compute the final image URL and set the \\`src\\` itself.`);\n+            `the \\`rawSrc\\` to compute the final image URL and set the \\`src\\` itself.`);\n   }\n }\n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -13,10 +13,10 @@ import {ComponentFixture, TestBed} from '@angular/core/testing';\n import {expect} from '@angular/platform-browser/testing/src/matchers';\n \n describe('Image directive', () => {\n-  it('should set `src` to `raw-src` value if image loader is not provided', () => {\n+  it('should set `src` to `rawSrc` value if image loader is not provided', () => {\n     setupTestingModule();\n \n-    const template = '<img raw-src=\"path/img.png\" width=\"100\" height=\"50\">';\n+    const template = '<img rawSrc=\"path/img.png\" width=\"100\" height=\"50\">';\n     const fixture = createTestComponent(template);\n     fixture.detectChanges();\n \n@@ -29,7 +29,7 @@ describe('Image directive', () => {\n     const imageLoader = (config: ImageLoaderConfig) => `${config.src}?w=${config.width}`;\n     setupTestingModule({imageLoader});\n \n-    const template = '<img raw-src=\"path/img.png\" width=\"150\" height=\"50\">';\n+    const template = '<img rawSrc=\"path/img.png\" width=\"150\" height=\"50\">';\n     const fixture = createTestComponent(template);\n     fixture.detectChanges();\n \n@@ -39,19 +39,19 @@ describe('Image directive', () => {\n   });\n \n   describe('setup error handling', () => {\n-    it('should throw if both `src` and `raw-src` are present', () => {\n+    it('should throw if both `src` and `rawSrc` are present', () => {\n       setupTestingModule();\n \n-      const template = '<img raw-src=\"path/img.png\" src=\"path/img2.png\" width=\"100\" height=\"50\">';\n+      const template = '<img rawSrc=\"path/img.png\" src=\"path/img2.png\" width=\"100\" height=\"50\">';\n       expect(() => {\n         const fixture = createTestComponent(template);\n         fixture.detectChanges();\n       })\n           .toThrowError(\n               'NG02950: The NgOptimizedImage directive (activated on an <img> element with the ' +\n-              '`raw-src=\"path/img.png\"`) detected that the `src` is also set (to `path/img2.png`). ' +\n+              '`rawSrc=\"path/img.png\"`) detected that the `src` is also set (to `path/img2.png`). ' +\n               'Please remove the `src` attribute from this image. The NgOptimizedImage directive will use ' +\n-              'the `raw-src` to compute the final image URL and set the `src` itself.');\n+              'the `rawSrc` to compute the final image URL and set the `src` itself.');\n     });\n   });\n });\n\n---\n file path A: packages/core/test/bundling/image-directive/index.ts | file path B: packages/core/test/bundling/image-directive/index.ts\n\n@@ -12,7 +12,7 @@ import {BrowserModule, platformBrowser} from '@angular/platform-browser';\n @Component({\n   selector: 'app-root',\n   template: `\n-    <img raw-src=\"./a.png\" width=\"150\" height=\"150\">\n+    <img rawSrc=\"./a.png\" width=\"150\" height=\"150\">\n   `,\n })\n class RootComponent {\n\n\n###\n\n", "completion": "refactor(common): rename `NgOptimizedImage` directive selector (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_optimized_image.ts | file path B: packages/common/src/directives/ng_optimized_image.ts\n\n@@ -94,12 +94,6 @@ export class NgOptimizedImage implements OnInit {\n     return this._height;\n   }\n \n-  /**\n-   * Function that takes the name of the image, its width, and a quality %,\n-   * then turns it into a valid image CDN URL.\n-   */\n-  @Input() loader?: (config: ImageLoaderConfig) => string;\n-\n   /**\n    * Get a value of the `src` if it's set on a host <img> element.\n    * This input is needed to verify that there are no `src` and `raw-src` provided\n@@ -114,9 +108,6 @@ export class NgOptimizedImage implements OnInit {\n   }\n \n   getRewrittenSrc(): string {\n-    // If a loader is provided as an input - use it, otherwise fall back\n-    // to the loader configured globally using the `IMAGE_LOADER` token.\n-    const imgLoader = this.loader ?? this.imageLoader;\n     const imgConfig = {\n       src: this.rawSrc,\n       // TODO: if we're going to support responsive serving, we don't want to request the width\n@@ -124,7 +115,7 @@ export class NgOptimizedImage implements OnInit {\n       // The width would require pre-processing before passing to the image loader function.\n       width: this.width,\n     };\n-    return imgLoader(imgConfig);\n+    return this.imageLoader(imgConfig);\n   }\n }\n \n\n---\n file path A: packages/common/test/directives/ng_optimized_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -38,22 +38,6 @@ describe('Image directive', () => {\n     expect(img.src.endsWith('/path/img.png?w=150')).toBeTrue();\n   });\n \n-  it('should use an image loader from inputs over the one provided via `IMAGE_LOADER` token',\n-     () => {\n-       const imageLoader = (config: ImageLoaderConfig) =>\n-           `${config.src}?w=${config.width}&source=IMAGE_LOADER`;\n-       setupTestingModule({imageLoader});\n-\n-       const template =\n-           '<img raw-src=\"path/img.png\" [loader]=\"cmpImageLoader\" width=\"150\" height=\"50\">';\n-       const fixture = createTestComponent(template);\n-       fixture.detectChanges();\n-\n-       const nativeElement = fixture.nativeElement as HTMLElement;\n-       const img = nativeElement.querySelector('img')!;\n-       expect(img.src.endsWith('/path/img.png?w=150&source=component')).toBeTrue();\n-     });\n-\n   describe('setup error handling', () => {\n     it('should throw if both `src` and `raw-src` are present', () => {\n       setupTestingModule();\n@@ -79,9 +63,6 @@ describe('Image directive', () => {\n   template: '',\n })\n class TestComponent {\n-  cmpImageLoader = (config: ImageLoaderConfig) => {\n-    return `${config.src}?w=${config.width}&source=component`;\n-  }\n }\n \n function setupTestingModule(config?: {imageLoader: ImageLoader}) {\n\n\n###\n\n", "completion": "refactor(common): drop the `loader` input in favor of `IMAGE_LOADER` token (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/directives/ng_image.ts | file path B: packages/common/src/directives/ng_optimized_image.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Directive, Inject, InjectionToken, Input, NgModule, SimpleChanges, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {Directive, Inject, InjectionToken, Input, NgModule, OnInit, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../errors';\n \n@@ -56,7 +56,7 @@ export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n     '[src]': 'getRewrittenSrc()',\n   },\n })\n-export class NgImage {\n+export class NgOptimizedImage implements OnInit {\n   constructor(@Inject(IMAGE_LOADER) private imageLoader: ImageLoader) {}\n \n   // Private fields to keep normalized input values.\n@@ -113,10 +113,6 @@ export class NgImage {\n     }\n   }\n \n-  ngOnChanges(changes: SimpleChanges) {\n-    // TODO: react to input changes.\n-  }\n-\n   getRewrittenSrc(): string {\n     // If a loader is provided as an input - use it, otherwise fall back\n     // to the loader configured globally using the `IMAGE_LOADER` token.\n@@ -133,14 +129,14 @@ export class NgImage {\n }\n \n /**\n- * Temporary NgModule that exports the NgImage directive.\n+ * Temporary NgModule that exports the NgOptimizedImage directive.\n  * The module should not be needed once the `standalone` flag is supported as a public API.\n  */\n @NgModule({\n-  declarations: [NgImage],\n-  exports: [NgImage],\n+  declarations: [NgOptimizedImage],\n+  exports: [NgOptimizedImage],\n })\n-export class NgImageModule {\n+export class NgOptimizedImageModule {\n }\n \n /***** Helpers *****/\n@@ -150,20 +146,20 @@ function inputToInteger(value: string|number|undefined): number|undefined {\n   return typeof value === 'string' ? parseInt(value, 10) : value;\n }\n \n-function imgDirectiveDetails(dir: NgImage) {\n-  return `The NgImage directive (activated on an <img> element ` +\n+function imgDirectiveDetails(dir: NgOptimizedImage) {\n+  return `The NgOptimizedImage directive (activated on an <img> element ` +\n       `with the \\`raw-src=\"${dir.rawSrc}\"\\`)`;\n }\n \n /***** Assert functions *****/\n \n // Verifies that there is no `src` set on a host element.\n-function assertExistingSrc(dir: NgImage) {\n+function assertExistingSrc(dir: NgOptimizedImage) {\n   if (dir.src) {\n     throw new RuntimeError(\n         RuntimeErrorCode.UNEXPECTED_SRC_ATTR,\n         `${imgDirectiveDetails(dir)} detected that the \\`src\\` is also set (to \\`${dir.src}\\`). ` +\n-            `Please remove the \\`src\\` attribute from this image. The NgImage directive will use ` +\n+            `Please remove the \\`src\\` attribute from this image. The NgOptimizedImage directive will use ` +\n             `the \\`raw-src\\` to compute the final image URL and set the \\`src\\` itself.`);\n   }\n }\n\n---\n file path A: packages/common/src/private_export.ts | file path B: packages/common/src/private_export.ts\n\n@@ -6,6 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-export {IMAGE_LOADER as \u0275IMAGE_LOADER, NgImage as \u0275NgImage, NgImageModule as \u0275NgImageModule} from './directives/ng_image';\n+export {IMAGE_LOADER as \u0275IMAGE_LOADER, NgOptimizedImage as \u0275NgOptimizedImage, NgOptimizedImageModule as \u0275NgOptimizedImageModule} from './directives/ng_optimized_image';\n export {DomAdapter as \u0275DomAdapter, getDOM as \u0275getDOM, setRootDomAdapter as \u0275setRootDomAdapter} from './dom_adapter';\n export {BrowserPlatformLocation as \u0275BrowserPlatformLocation} from './location/platform_location';\n\n---\n file path A: packages/common/test/directives/ng_image_spec.ts | file path B: packages/common/test/directives/ng_optimized_image_spec.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {CommonModule} from '@angular/common';\n-import {IMAGE_LOADER, ImageLoader, ImageLoaderConfig, NgImage} from '@angular/common/src/directives/ng_image';\n+import {IMAGE_LOADER, ImageLoader, ImageLoaderConfig, NgOptimizedImage} from '@angular/common/src/directives/ng_optimized_image';\n import {Component} from '@angular/core';\n import {ComponentFixture, TestBed} from '@angular/core/testing';\n import {expect} from '@angular/platform-browser/testing/src/matchers';\n@@ -64,9 +64,9 @@ describe('Image directive', () => {\n         fixture.detectChanges();\n       })\n           .toThrowError(\n-              'NG02950: The NgImage directive (activated on an <img> element with the ' +\n+              'NG02950: The NgOptimizedImage directive (activated on an <img> element with the ' +\n               '`raw-src=\"path/img.png\"`) detected that the `src` is also set (to `path/img2.png`). ' +\n-              'Please remove the `src` attribute from this image. The NgImage directive will use ' +\n+              'Please remove the `src` attribute from this image. The NgOptimizedImage directive will use ' +\n               'the `raw-src` to compute the final image URL and set the `src` itself.');\n     });\n   });\n@@ -88,9 +88,9 @@ function setupTestingModule(config?: {imageLoader: ImageLoader}) {\n   const providers =\n       config?.imageLoader ? [{provide: IMAGE_LOADER, useValue: config?.imageLoader}] : [];\n   TestBed.configureTestingModule({\n-    // Note: the `NgImage` is a part of declarations for now,\n+    // Note: the `NgOptimizedImage` is a part of declarations for now,\n     // since it's experimental and not yet added to the `CommonModule`.\n-    declarations: [TestComponent, NgImage],\n+    declarations: [TestComponent, NgOptimizedImage],\n     imports: [CommonModule],\n     providers,\n   });\n\n---\n file path A: packages/core/test/bundling/image-directive/index.ts | file path B: packages/core/test/bundling/image-directive/index.ts\n\n@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgImageModule as NgImageModule} from '@angular/common';\n+import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgOptimizedImageModule as NgOptimizedImageModule} from '@angular/common';\n import {Component, NgModule} from '@angular/core';\n import {BrowserModule, platformBrowser} from '@angular/platform-browser';\n \n@@ -21,7 +21,7 @@ class RootComponent {\n \n @NgModule({\n   declarations: [RootComponent],\n-  imports: [BrowserModule, NgImageModule],\n+  imports: [BrowserModule, NgOptimizedImageModule],\n   bootstrap: [RootComponent],\n   providers: [{provide: IMAGE_LOADER, useValue: () => 'b.png'}],\n })\n\n\n###\n\n", "completion": "refactor(common): change name of directive from NgImage => NgOptimizedImage (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/common.ts | file path B: packages/common/src/common.ts\n\n@@ -27,4 +27,3 @@ export {PLATFORM_BROWSER_ID as \u0275PLATFORM_BROWSER_ID, PLATFORM_SERVER_ID as \u0275PL\n export {VERSION} from './version';\n export {ViewportScroller, NullViewportScroller as \u0275NullViewportScroller} from './viewport_scroller';\n export {XhrFactory} from './xhr';\n-export {NgImageModule as \u0275NgImageModule, NgImage as \u0275NgImage, IMAGE_LOADER as \u0275IMAGE_LOADER} from './directives/ng_image';\n\n---\n file path A: packages/common/src/directives/ng_image.ts | file path B: packages/common/src/directives/ng_image.ts\n\n@@ -133,7 +133,7 @@ export class NgImage {\n }\n \n /**\n- * Temporary NgModule that exports the `NgImage` directive.\n+ * Temporary NgModule that exports the NgImage directive.\n  * The module should not be needed once the `standalone` flag is supported as a public API.\n  */\n @NgModule({\n\n---\n file path A: packages/common/src/private_export.ts | file path B: packages/common/src/private_export.ts\n\n@@ -6,5 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+export {IMAGE_LOADER as \u0275IMAGE_LOADER, NgImage as \u0275NgImage, NgImageModule as \u0275NgImageModule} from './directives/ng_image';\n export {DomAdapter as \u0275DomAdapter, getDOM as \u0275getDOM, setRootDomAdapter as \u0275setRootDomAdapter} from './dom_adapter';\n export {BrowserPlatformLocation as \u0275BrowserPlatformLocation} from './location/platform_location';\n\n---\n file path A: None | file path B: packages/core/test/bundling/image-directive/BUILD.bazel\n\n@@ -0,0 +1,64 @@\n+load(\"//tools:defaults.bzl\", \"app_bundle\", \"ng_module\", \"ts_devserver\")\n+load(\"@npm//http-server:index.bzl\", \"http_server\")\n+\n+package(default_visibility = [\"//visibility:public\"])\n+\n+ng_module(\n+    name = \"image-directive\",\n+    srcs = [\n+        \"index.ts\",\n+    ],\n+    deps = [\n+        \"//packages/common\",\n+        \"//packages/core\",\n+        \"//packages/platform-browser\",\n+    ],\n+)\n+\n+app_bundle(\n+    name = \"bundle\",\n+    entry_point = \":index.ts\",\n+    deps = [\n+        \":image-directive\",\n+        \"//packages/common\",\n+        \"//packages/core\",\n+        \"//packages/platform-browser\",\n+        \"@npm//rxjs\",\n+    ],\n+)\n+\n+genrule(\n+    name = \"tslib\",\n+    srcs = [\n+        \"@npm//:node_modules/tslib/tslib.js\",\n+    ],\n+    outs = [\n+        \"tslib.js\",\n+    ],\n+    cmd = \"cp $< $@\",\n+)\n+\n+ts_devserver(\n+    name = \"devserver\",\n+    entry_module = \"@angular/core/test/bundling/image-directive\",\n+    scripts = [\n+        \"//tools/rxjs:rxjs_umd_modules\",\n+    ],\n+    serving_path = \"/bundle.min.js\",\n+    static_files = [\n+        \"index.html\",\n+        \":tslib\",\n+        \"a.png\",\n+        \"b.png\",\n+    ],\n+    deps = [\":image-directive\"],\n+)\n+\n+http_server(\n+    name = \"prodserver\",\n+    data = [\n+        \"index.html\",\n+        \":bundle.debug.min.js\",\n+        \":bundle.min.js\",\n+    ],\n+)\n\n---\n file path A: packages/core/test/bundling/image-directive/a.png | file path B: packages/core/test/bundling/image-directive/a.png\n\nBinary files /dev/null and b/packages/core/test/bundling/image-directive/a.png differ\n\n---\n file path A: packages/core/test/bundling/image-directive/b.png | file path B: packages/core/test/bundling/image-directive/b.png\n\nBinary files /dev/null and b/packages/core/test/bundling/image-directive/b.png differ\n\n---\n file path A: None | file path B: packages/core/test/bundling/image-directive/index.html\n\n@@ -0,0 +1,32 @@\n+<!doctype html>\n+\n+<html>\n+  <head>\n+    <title>Image Directive Example</title>\n+  </head>\n+  <body>\n+    <!-- The Angular application will be bootstrapped into this element. -->\n+\n+    <app-root></app-root>\n+\n+    <!--\n+      Script tag which bootstraps the application. Use `?debug` in URL to select\n+      the debug version of the script.\n+\n+      There are two scripts sources: `bundle.min.js` and `bundle.debug.min.js` You can\n+      switch between which bundle the browser loads to experiment with the application.\n+\n+      - `bundle.min.js`: Is what the site would serve to their users. It has gone\n+        through rollup, build-optimizer, and uglify with tree shaking.\n+      - `bundle.debug.min.js`: Is what the developer would like to see when debugging\n+        the application. It has also gone through full pipeline of esbuild, babel optimization,\n+        plugins from the devkit and terser, however mangling is disabled and the minified\n+        file is formatted using prettier (to ease debugging).\n+    -->\n+    <script>\n+        document.write('<script src=\"' +\n+          (document.location.search.endsWith('debug') ? '/bundle.debug.min.js' : '/bundle.min.js') +\n+          '\"></' + 'script>');\n+    </script>\n+  </body>\n+</html>\n\n---\n file path A: None | file path B: packages/core/test/bundling/image-directive/index.ts\n\n@@ -0,0 +1,32 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {\u0275IMAGE_LOADER as IMAGE_LOADER, \u0275NgImageModule as NgImageModule} from '@angular/common';\n+import {Component, NgModule} from '@angular/core';\n+import {BrowserModule, platformBrowser} from '@angular/platform-browser';\n+\n+@Component({\n+  selector: 'app-root',\n+  template: `\n+    <img raw-src=\"./a.png\" width=\"150\" height=\"150\">\n+  `,\n+})\n+class RootComponent {\n+  constructor() {}\n+}\n+\n+@NgModule({\n+  declarations: [RootComponent],\n+  imports: [BrowserModule, NgImageModule],\n+  bootstrap: [RootComponent],\n+  providers: [{provide: IMAGE_LOADER, useValue: () => 'b.png'}],\n+})\n+class ImageDirectiveExampleModule {\n+}\n+\n+(window as any).waitForApp =\n+    platformBrowser().bootstrapModule(ImageDirectiveExampleModule, {ngZone: 'noop'});\n\n\n###\n\n", "completion": "test(common): add a test app for the `NgImage` directive (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/common.ts | file path B: packages/common/src/common.ts\n\n@@ -27,3 +27,4 @@ export {PLATFORM_BROWSER_ID as \u0275PLATFORM_BROWSER_ID, PLATFORM_SERVER_ID as \u0275PL\n export {VERSION} from './version';\n export {ViewportScroller, NullViewportScroller as \u0275NullViewportScroller} from './viewport_scroller';\n export {XhrFactory} from './xhr';\n+export {NgImageModule as \u0275NgImageModule, NgImage as \u0275NgImage, IMAGE_LOADER as \u0275IMAGE_LOADER} from './directives/ng_image';\n\n---\n file path A: packages/common/src/directives/ng_image.ts | file path B: packages/common/src/directives/ng_image.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Directive, Inject, InjectionToken, Input, SimpleChanges, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {Directive, Inject, InjectionToken, Input, NgModule, SimpleChanges, \u0275RuntimeError as RuntimeError} from '@angular/core';\n \n import {RuntimeErrorCode} from '../errors';\n \n@@ -132,6 +132,17 @@ export class NgImage {\n   }\n }\n \n+/**\n+ * Temporary NgModule that exports the `NgImage` directive.\n+ * The module should not be needed once the `standalone` flag is supported as a public API.\n+ */\n+@NgModule({\n+  declarations: [NgImage],\n+  exports: [NgImage],\n+})\n+export class NgImageModule {\n+}\n+\n /***** Helpers *****/\n \n // Convert input value to integer.\n\n\n###\n\n", "completion": "refactor(common): expose `NgImage` directive via a private API (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/errors.md | file path B: goldens/public-api/common/errors.md\n\n@@ -6,12 +6,16 @@\n \n // @public\n export const enum RuntimeErrorCode {\n+    // (undocumented)\n+    INVALID_INPUT = 2951,\n     // (undocumented)\n     INVALID_PIPE_ARGUMENT = 2100,\n     // (undocumented)\n     NG_FOR_MISSING_DIFFER = -2200,\n     // (undocumented)\n-    PARENT_NG_SWITCH_NOT_FOUND = 2000\n+    PARENT_NG_SWITCH_NOT_FOUND = 2000,\n+    // (undocumented)\n+    UNEXPECTED_SRC_ATTR = 2950\n }\n \n // (No @packageDocumentation comment for this package)\n\n---\n file path A: None | file path B: packages/common/src/directives/ng_image.ts\n\n@@ -0,0 +1,158 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Directive, Inject, InjectionToken, Input, SimpleChanges, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+\n+import {RuntimeErrorCode} from '../errors';\n+\n+/**\n+ * Config options recognized by the image loader function.\n+ */\n+export interface ImageLoaderConfig {\n+  src: string;\n+  quality?: number;\n+  width?: number;\n+}\n+\n+/**\n+ * Represents an image loader function.\n+ */\n+export type ImageLoader = (config: ImageLoaderConfig) => string;\n+\n+/**\n+ * Noop image loader that does no transformation to the original src and just returns it as is.\n+ * This loader is used as a default one if more specific logic is not provided in an app config.\n+ */\n+const noopImageLoader = (config: ImageLoaderConfig) => config.src;\n+\n+/**\n+ * Special token that allows to configure a function that will be used to produce an image URL based\n+ * on the specified input.\n+ */\n+export const IMAGE_LOADER = new InjectionToken<ImageLoader>('ImageLoader', {\n+  providedIn: 'root',\n+  factory: () => noopImageLoader,\n+});\n+\n+/**\n+ * ** EXPERIMENTAL **\n+ *\n+ * TODO: add Image directive description.\n+ *\n+ * IMPORTANT: this directive should become standalone (i.e. not attached to any NgModule) once\n+ * the `standalone` flag is implemented and available as a public API.\n+ *\n+ * @usageNotes\n+ * TODO: add Image directive usage notes.\n+ */\n+@Directive({\n+  selector: 'img[raw-src]',\n+  host: {\n+    '[src]': 'getRewrittenSrc()',\n+  },\n+})\n+export class NgImage {\n+  constructor(@Inject(IMAGE_LOADER) private imageLoader: ImageLoader) {}\n+\n+  // Private fields to keep normalized input values.\n+  private _width?: number;\n+  private _height?: number;\n+\n+  /**\n+   * Name of the source image.\n+   * Image name will be processed by the image loader and the final URL will be applied as the `src`\n+   * property of the image.\n+   */\n+  @Input('raw-src') rawSrc!: string;\n+\n+  /**\n+   * The intrinsic width of the image in px.\n+   * This input is required unless the 'fill-parent' is provided.\n+   */\n+  @Input()\n+  set width(value: string|number|undefined) {\n+    this._width = inputToInteger(value);\n+  }\n+  get width(): number|undefined {\n+    return this._width;\n+  }\n+\n+  /**\n+   * The intrinsic height of the image in px.\n+   * This input is required unless the 'fill-parent' is provided.\n+   */\n+  @Input()\n+  set height(value: string|number|undefined) {\n+    this._height = inputToInteger(value);\n+  }\n+  get height(): number|undefined {\n+    return this._height;\n+  }\n+\n+  /**\n+   * Function that takes the name of the image, its width, and a quality %,\n+   * then turns it into a valid image CDN URL.\n+   */\n+  @Input() loader?: (config: ImageLoaderConfig) => string;\n+\n+  /**\n+   * Get a value of the `src` if it's set on a host <img> element.\n+   * This input is needed to verify that there are no `src` and `raw-src` provided\n+   * at the same time (thus causing an ambiguity on which src to use).\n+   */\n+  @Input() src?: string;\n+\n+  ngOnInit() {\n+    if (ngDevMode) {\n+      assertExistingSrc(this);\n+    }\n+  }\n+\n+  ngOnChanges(changes: SimpleChanges) {\n+    // TODO: react to input changes.\n+  }\n+\n+  getRewrittenSrc(): string {\n+    // If a loader is provided as an input - use it, otherwise fall back\n+    // to the loader configured globally using the `IMAGE_LOADER` token.\n+    const imgLoader = this.loader ?? this.imageLoader;\n+    const imgConfig = {\n+      src: this.rawSrc,\n+      // TODO: if we're going to support responsive serving, we don't want to request the width\n+      // based solely on the intrinsic width (e.g. if it's on mobile and the viewport is smaller).\n+      // The width would require pre-processing before passing to the image loader function.\n+      width: this.width,\n+    };\n+    return imgLoader(imgConfig);\n+  }\n+}\n+\n+/***** Helpers *****/\n+\n+// Convert input value to integer.\n+function inputToInteger(value: string|number|undefined): number|undefined {\n+  return typeof value === 'string' ? parseInt(value, 10) : value;\n+}\n+\n+function imgDirectiveDetails(dir: NgImage) {\n+  return `The NgImage directive (activated on an <img> element ` +\n+      `with the \\`raw-src=\"${dir.rawSrc}\"\\`)`;\n+}\n+\n+/***** Assert functions *****/\n+\n+// Verifies that there is no `src` set on a host element.\n+function assertExistingSrc(dir: NgImage) {\n+  if (dir.src) {\n+    throw new RuntimeError(\n+        RuntimeErrorCode.UNEXPECTED_SRC_ATTR,\n+        `${imgDirectiveDetails(dir)} detected that the \\`src\\` is also set (to \\`${dir.src}\\`). ` +\n+            `Please remove the \\`src\\` attribute from this image. The NgImage directive will use ` +\n+            `the \\`raw-src\\` to compute the final image URL and set the \\`src\\` itself.`);\n+  }\n+}\n\n---\n file path A: packages/common/src/errors.ts | file path B: packages/common/src/errors.ts\n\n@@ -13,8 +13,14 @@\n export const enum RuntimeErrorCode {\n   // NgSwitch errors\n   PARENT_NG_SWITCH_NOT_FOUND = 2000,\n+\n   // Pipe errors\n   INVALID_PIPE_ARGUMENT = 2100,\n+\n   // NgForOf errors\n   NG_FOR_MISSING_DIFFER = -2200,\n+\n+  // Image directive errors\n+  UNEXPECTED_SRC_ATTR = 2950,\n+  INVALID_INPUT = 2951,\n }\n\n---\n file path A: None | file path B: packages/common/test/directives/ng_image_spec.ts\n\n@@ -0,0 +1,102 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {CommonModule} from '@angular/common';\n+import {IMAGE_LOADER, ImageLoader, ImageLoaderConfig, NgImage} from '@angular/common/src/directives/ng_image';\n+import {Component} from '@angular/core';\n+import {ComponentFixture, TestBed} from '@angular/core/testing';\n+import {expect} from '@angular/platform-browser/testing/src/matchers';\n+\n+describe('Image directive', () => {\n+  it('should set `src` to `raw-src` value if image loader is not provided', () => {\n+    setupTestingModule();\n+\n+    const template = '<img raw-src=\"path/img.png\" width=\"100\" height=\"50\">';\n+    const fixture = createTestComponent(template);\n+    fixture.detectChanges();\n+\n+    const nativeElement = fixture.nativeElement as HTMLElement;\n+    const img = nativeElement.querySelector('img')!;\n+    expect(img.src.endsWith('/path/img.png')).toBeTrue();\n+  });\n+\n+  it('should use an image loader provided via `IMAGE_LOADER` token', () => {\n+    const imageLoader = (config: ImageLoaderConfig) => `${config.src}?w=${config.width}`;\n+    setupTestingModule({imageLoader});\n+\n+    const template = '<img raw-src=\"path/img.png\" width=\"150\" height=\"50\">';\n+    const fixture = createTestComponent(template);\n+    fixture.detectChanges();\n+\n+    const nativeElement = fixture.nativeElement as HTMLElement;\n+    const img = nativeElement.querySelector('img')!;\n+    expect(img.src.endsWith('/path/img.png?w=150')).toBeTrue();\n+  });\n+\n+  it('should use an image loader from inputs over the one provided via `IMAGE_LOADER` token',\n+     () => {\n+       const imageLoader = (config: ImageLoaderConfig) =>\n+           `${config.src}?w=${config.width}&source=IMAGE_LOADER`;\n+       setupTestingModule({imageLoader});\n+\n+       const template =\n+           '<img raw-src=\"path/img.png\" [loader]=\"cmpImageLoader\" width=\"150\" height=\"50\">';\n+       const fixture = createTestComponent(template);\n+       fixture.detectChanges();\n+\n+       const nativeElement = fixture.nativeElement as HTMLElement;\n+       const img = nativeElement.querySelector('img')!;\n+       expect(img.src.endsWith('/path/img.png?w=150&source=component')).toBeTrue();\n+     });\n+\n+  describe('setup error handling', () => {\n+    it('should throw if both `src` and `raw-src` are present', () => {\n+      setupTestingModule();\n+\n+      const template = '<img raw-src=\"path/img.png\" src=\"path/img2.png\" width=\"100\" height=\"50\">';\n+      expect(() => {\n+        const fixture = createTestComponent(template);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              'NG02950: The NgImage directive (activated on an <img> element with the ' +\n+              '`raw-src=\"path/img.png\"`) detected that the `src` is also set (to `path/img2.png`). ' +\n+              'Please remove the `src` attribute from this image. The NgImage directive will use ' +\n+              'the `raw-src` to compute the final image URL and set the `src` itself.');\n+    });\n+  });\n+});\n+\n+// Helpers\n+\n+@Component({\n+  selector: 'test-cmp',\n+  template: '',\n+})\n+class TestComponent {\n+  cmpImageLoader = (config: ImageLoaderConfig) => {\n+    return `${config.src}?w=${config.width}&source=component`;\n+  }\n+}\n+\n+function setupTestingModule(config?: {imageLoader: ImageLoader}) {\n+  const providers =\n+      config?.imageLoader ? [{provide: IMAGE_LOADER, useValue: config?.imageLoader}] : [];\n+  TestBed.configureTestingModule({\n+    // Note: the `NgImage` is a part of declarations for now,\n+    // since it's experimental and not yet added to the `CommonModule`.\n+    declarations: [TestComponent, NgImage],\n+    imports: [CommonModule],\n+    providers,\n+  });\n+}\n+\n+function createTestComponent(template: string): ComponentFixture<TestComponent> {\n+  return TestBed.overrideComponent(TestComponent, {set: {template: template}})\n+      .createComponent(TestComponent);\n+}\n\n\n###\n\n", "completion": "feat(common): add Image directive skeleton (#<issue-num>) (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -19,7 +19,7 @@\n     \"build-local\": \"yarn ~~build\",\n     \"prebuild-local-ci\": \"yarn setup-local-ci\",\n     \"build-local-ci\": \"yarn ~~build --progress=false\",\n-    \"extract-cli-command-docs\": \"node tools/transforms/cli-docs-package/extract-cli-commands.js a764b37fa\",\n+    \"extract-cli-command-docs\": \"node tools/transforms/cli-docs-package/extract-cli-commands.js 14d4d528c\",\n     \"lint\": \"yarn check-env && yarn docs-lint && ng lint && yarn example-lint && yarn tools-lint && yarn security-lint\",\n     \"test\": \"yarn check-env && ng test\",\n     \"test:bazel\": \"bazelisk test //aio:test\",\n\n\n###\n\n", "completion": "build(docs-infra): upgrade cli command docs sources to 14d4d528c (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/router-tutorial/src/app/app.component.css | file path B: aio/content/examples/router-tutorial/src/app/app.component.css\n\n@@ -17,16 +17,7 @@\n .activebutton {\n     box-shadow: inset 0 1px 0 0 #dcecfb;\n     background: #bddbfa linear-gradient(to bottom, #bddbfa 5%, #80b5ea 100%);\n-    border-radius: 6px;\n     border: 1px solid #84bbf3;\n-    display: inline-block;\n-    cursor: pointer;\n     color: #ffffff;\n-    font-family: Arial, sans-serif;\n-    font-size: 15px;\n-    font-weight: bold;\n-    padding: 6px 24px;\n-    text-decoration: none;\n     text-shadow: 0 1px 0 #528ecc;\n-    outline: 0;\n }\n\n\n###\n\n", "completion": "docs: remove duplicated styles (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/routing-with-urlmatcher/src/app/app.module.ts | file path B: aio/content/examples/routing-with-urlmatcher/src/app/app.module.ts\n\n@@ -14,9 +14,9 @@ import { ProfileComponent } from './profile/profile.component';\n     BrowserModule,\n     FormsModule,\n     RouterModule.forRoot([\n-      {\n // #enddocregion imports-array\n // #docregion matcher\n+      {\n         matcher: (url) => {\n           if (url.length === 1 && url[0].path.match(/^@[\\w]+$/gm)) {\n             return {\n\n\n###\n\n", "completion": "docs: fix code samples formatting in tutorial (#<issue-num>)"}
{"prompt": " file path A: None | file path B: packages/router/src/patchable_relative_link_resolution.ts\n\n@@ -0,0 +1,13 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+/**\n+ * Exists to aid internal migration off of the deprecated relativeLinkResolution option.\n+ */\n+export function assignRelativeLinkResolution(\n+    router: {relativeLinkResolution: 'legacy'|'corrected'}): void {}\n\n---\n file path A: packages/router/src/router.ts | file path B: packages/router/src/router.ts\n\n@@ -24,6 +24,7 @@ import {recognize} from './operators/recognize';\n import {resolveData} from './operators/resolve_data';\n import {switchTap} from './operators/switch_tap';\n import {DefaultTitleStrategy, TitleStrategy} from './page_title_strategy';\n+import {assignRelativeLinkResolution} from './patchable_relative_link_resolution';\n import {DefaultRouteReuseStrategy, RouteReuseStrategy} from './route_reuse_strategy';\n import {ErrorHandler, ExtraOptions, ROUTER_CONFIGURATION} from './router_config';\n import {RouterConfigLoader, ROUTES} from './router_config_loader';\n@@ -349,6 +350,8 @@ export function setupRouter() {\n \n   assignExtraOptionsToRouter(opts, router);\n \n+  assignRelativeLinkResolution(router);\n+\n   return router;\n }\n \n\n\n###\n\n", "completion": "refactor(router): Provide easily patchable file for assigning relativeLinkResolution (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -677,20 +677,26 @@ export class RouterLink implements OnChanges {\n     ngOnChanges(changes: SimpleChanges): void;\n     // (undocumented)\n     onClick(): boolean;\n-    preserveFragment: boolean;\n+    set preserveFragment(preserveFragment: boolean | string | null | undefined);\n+    // (undocumented)\n+    get preserveFragment(): boolean;\n     queryParams?: Params | null;\n     queryParamsHandling?: QueryParamsHandling | null;\n     relativeTo?: ActivatedRoute | null;\n-    replaceUrl: boolean;\n+    set replaceUrl(replaceUrl: boolean | string | null | undefined);\n+    // (undocumented)\n+    get replaceUrl(): boolean;\n     set routerLink(commands: any[] | string | null | undefined);\n-    skipLocationChange: boolean;\n+    set skipLocationChange(skipLocationChange: boolean | string | null | undefined);\n+    // (undocumented)\n+    get skipLocationChange(): boolean;\n     state?: {\n         [k: string]: any;\n     };\n     // (undocumented)\n     get urlTree(): UrlTree | null;\n     // (undocumented)\n-    static \u0275dir: i0.\u0275\u0275DirectiveDeclaration<RouterLink, \":not(a):not(area)[routerLink]\", never, { \"queryParams\": \"queryParams\"; \"fragment\": \"fragment\"; \"queryParamsHandling\": \"queryParamsHandling\"; \"preserveFragment\": \"preserveFragment\"; \"skipLocationChange\": \"skipLocationChange\"; \"replaceUrl\": \"replaceUrl\"; \"state\": \"state\"; \"relativeTo\": \"relativeTo\"; \"routerLink\": \"routerLink\"; }, {}, never, never, true>;\n+    static \u0275dir: i0.\u0275\u0275DirectiveDeclaration<RouterLink, \":not(a):not(area)[routerLink]\", never, { \"queryParams\": \"queryParams\"; \"fragment\": \"fragment\"; \"queryParamsHandling\": \"queryParamsHandling\"; \"state\": \"state\"; \"relativeTo\": \"relativeTo\"; \"preserveFragment\": \"preserveFragment\"; \"skipLocationChange\": \"skipLocationChange\"; \"replaceUrl\": \"replaceUrl\"; \"routerLink\": \"routerLink\"; }, {}, never, never, true>;\n     // (undocumented)\n     static \u0275fac: i0.\u0275\u0275FactoryDeclaration<RouterLink, [null, null, { attribute: \"tabindex\"; }, null, null]>;\n }\n@@ -735,13 +741,19 @@ export class RouterLinkWithHref implements OnChanges, OnDestroy {\n     ngOnDestroy(): any;\n     // (undocumented)\n     onClick(button: number, ctrlKey: boolean, shiftKey: boolean, altKey: boolean, metaKey: boolean): boolean;\n-    preserveFragment: boolean;\n+    set preserveFragment(preserveFragment: boolean | string | null | undefined);\n+    // (undocumented)\n+    get preserveFragment(): boolean;\n     queryParams?: Params | null;\n     queryParamsHandling?: QueryParamsHandling | null;\n     relativeTo?: ActivatedRoute | null;\n-    replaceUrl: boolean;\n+    set replaceUrl(replaceUrl: boolean | string | null | undefined);\n+    // (undocumented)\n+    get replaceUrl(): boolean;\n     set routerLink(commands: any[] | string | null | undefined);\n-    skipLocationChange: boolean;\n+    set skipLocationChange(skipLocationChange: boolean | string | null | undefined);\n+    // (undocumented)\n+    get skipLocationChange(): boolean;\n     state?: {\n         [k: string]: any;\n     };\n@@ -750,7 +762,7 @@ export class RouterLinkWithHref implements OnChanges, OnDestroy {\n     // (undocumented)\n     get urlTree(): UrlTree | null;\n     // (undocumented)\n-    static \u0275dir: i0.\u0275\u0275DirectiveDeclaration<RouterLinkWithHref, \"a[routerLink],area[routerLink]\", never, { \"target\": \"target\"; \"queryParams\": \"queryParams\"; \"fragment\": \"fragment\"; \"queryParamsHandling\": \"queryParamsHandling\"; \"preserveFragment\": \"preserveFragment\"; \"skipLocationChange\": \"skipLocationChange\"; \"replaceUrl\": \"replaceUrl\"; \"state\": \"state\"; \"relativeTo\": \"relativeTo\"; \"routerLink\": \"routerLink\"; }, {}, never, never, true>;\n+    static \u0275dir: i0.\u0275\u0275DirectiveDeclaration<RouterLinkWithHref, \"a[routerLink],area[routerLink]\", never, { \"target\": \"target\"; \"queryParams\": \"queryParams\"; \"fragment\": \"fragment\"; \"queryParamsHandling\": \"queryParamsHandling\"; \"state\": \"state\"; \"relativeTo\": \"relativeTo\"; \"preserveFragment\": \"preserveFragment\"; \"skipLocationChange\": \"skipLocationChange\"; \"replaceUrl\": \"replaceUrl\"; \"routerLink\": \"routerLink\"; }, {}, never, never, true>;\n     // (undocumented)\n     static \u0275fac: i0.\u0275\u0275FactoryDeclaration<RouterLinkWithHref, never>;\n }\n\n---\n file path A: packages/router/src/directives/router_link.ts | file path B: packages/router/src/directives/router_link.ts\n\n@@ -120,6 +120,10 @@ import {UrlTree} from '../url_tree';\n   standalone: true,\n })\n export class RouterLink implements OnChanges {\n+  private _preserveFragment = false;\n+  private _skipLocationChange = false;\n+  private _replaceUrl = false;\n+\n   /**\n    * Passed to {@link Router#createUrlTree Router#createUrlTree} as part of the\n    * `UrlCreationOptions`.\n@@ -141,30 +145,6 @@ export class RouterLink implements OnChanges {\n    * @see {@link Router#createUrlTree Router#createUrlTree}\n    */\n   @Input() queryParamsHandling?: QueryParamsHandling|null;\n-  /**\n-   * Passed to {@link Router#createUrlTree Router#createUrlTree} as part of the\n-   * `UrlCreationOptions`.\n-   * @see {@link UrlCreationOptions#preserveFragment UrlCreationOptions#preserveFragment}\n-   * @see {@link Router#createUrlTree Router#createUrlTree}\n-   */\n-  // TODO(issue/24571): remove '!'.\n-  @Input() preserveFragment!: boolean;\n-  /**\n-   * Passed to {@link Router#navigateByUrl Router#navigateByUrl} as part of the\n-   * `NavigationBehaviorOptions`.\n-   * @see {@link NavigationBehaviorOptions#skipLocationChange NavigationBehaviorOptions#skipLocationChange}\n-   * @see {@link Router#navigateByUrl Router#navigateByUrl}\n-   */\n-  // TODO(issue/24571): remove '!'.\n-  @Input() skipLocationChange!: boolean;\n-  /**\n-   * Passed to {@link Router#navigateByUrl Router#navigateByUrl} as part of the\n-   * `NavigationBehaviorOptions`.\n-   * @see {@link NavigationBehaviorOptions#replaceUrl NavigationBehaviorOptions#replaceUrl}\n-   * @see {@link Router#navigateByUrl Router#navigateByUrl}\n-   */\n-  // TODO(issue/24571): remove '!'.\n-  @Input() replaceUrl!: boolean;\n   /**\n    * Passed to {@link Router#navigateByUrl Router#navigateByUrl} as part of the\n    * `NavigationBehaviorOptions`.\n@@ -195,6 +175,51 @@ export class RouterLink implements OnChanges {\n     this.setTabIndexIfNotOnNativeEl('0');\n   }\n \n+  /**\n+   * Passed to {@link Router#createUrlTree Router#createUrlTree} as part of the\n+   * `UrlCreationOptions`.\n+   * @see {@link UrlCreationOptions#preserveFragment UrlCreationOptions#preserveFragment}\n+   * @see {@link Router#createUrlTree Router#createUrlTree}\n+   */\n+  @Input()\n+  set preserveFragment(preserveFragment: boolean|string|null|undefined) {\n+    this._preserveFragment = coerceToBoolean(preserveFragment);\n+  }\n+\n+  get preserveFragment(): boolean {\n+    return this._preserveFragment;\n+  }\n+\n+  /**\n+   * Passed to {@link Router#navigateByUrl Router#navigateByUrl} as part of the\n+   * `NavigationBehaviorOptions`.\n+   * @see {@link NavigationBehaviorOptions#skipLocationChange NavigationBehaviorOptions#skipLocationChange}\n+   * @see {@link Router#navigateByUrl Router#navigateByUrl}\n+   */\n+  @Input()\n+  set skipLocationChange(skipLocationChange: boolean|string|null|undefined) {\n+    this._skipLocationChange = coerceToBoolean(skipLocationChange);\n+  }\n+\n+  get skipLocationChange(): boolean {\n+    return this._skipLocationChange;\n+  }\n+\n+  /**\n+   * Passed to {@link Router#navigateByUrl Router#navigateByUrl} as part of the\n+   * `NavigationBehaviorOptions`.\n+   * @see {@link NavigationBehaviorOptions#replaceUrl NavigationBehaviorOptions#replaceUrl}\n+   * @see {@link Router#navigateByUrl Router#navigateByUrl}\n+   */\n+  @Input()\n+  set replaceUrl(replaceUrl: boolean|string|null|undefined) {\n+    this._replaceUrl = coerceToBoolean(replaceUrl);\n+  }\n+\n+  get replaceUrl(): boolean {\n+    return this._replaceUrl;\n+  }\n+\n   /**\n    * Modifies the tab index if there was not a tabindex attribute on the element during\n    * instantiation.\n@@ -245,8 +270,8 @@ export class RouterLink implements OnChanges {\n     }\n \n     const extras = {\n-      skipLocationChange: coerceToBoolean(this.skipLocationChange),\n-      replaceUrl: coerceToBoolean(this.replaceUrl),\n+      skipLocationChange: this.skipLocationChange,\n+      replaceUrl: this.replaceUrl,\n       state: this.state,\n     };\n     this.router.navigateByUrl(this.urlTree, extras);\n@@ -264,7 +289,7 @@ export class RouterLink implements OnChanges {\n       queryParams: this.queryParams,\n       fragment: this.fragment,\n       queryParamsHandling: this.queryParamsHandling,\n-      preserveFragment: coerceToBoolean(this.preserveFragment),\n+      preserveFragment: this.preserveFragment,\n     });\n   }\n }\n@@ -282,6 +307,10 @@ export class RouterLink implements OnChanges {\n  */\n @Directive({selector: 'a[routerLink],area[routerLink]', standalone: true})\n export class RouterLinkWithHref implements OnChanges, OnDestroy {\n+  private _preserveFragment = false;\n+  private _skipLocationChange = false;\n+  private _replaceUrl = false;\n+\n   // TODO(issue/24571): remove '!'.\n   @HostBinding('attr.target') @Input() target!: string;\n   /**\n@@ -305,30 +334,6 @@ export class RouterLinkWithHref implements OnChanges, OnDestroy {\n    * @see {@link Router#createUrlTree Router#createUrlTree}\n    */\n   @Input() queryParamsHandling?: QueryParamsHandling|null;\n-  /**\n-   * Passed to {@link Router#createUrlTree Router#createUrlTree} as part of the\n-   * `UrlCreationOptions`.\n-   * @see {@link UrlCreationOptions#preserveFragment UrlCreationOptions#preserveFragment}\n-   * @see {@link Router#createUrlTree Router#createUrlTree}\n-   */\n-  // TODO(issue/24571): remove '!'.\n-  @Input() preserveFragment!: boolean;\n-  /**\n-   * Passed to {@link Router#navigateByUrl Router#navigateByUrl} as part of the\n-   * `NavigationBehaviorOptions`.\n-   * @see {@link NavigationBehaviorOptions#skipLocationChange NavigationBehaviorOptions#skipLocationChange}\n-   * @see {@link Router#navigateByUrl Router#navigateByUrl}\n-   */\n-  // TODO(issue/24571): remove '!'.\n-  @Input() skipLocationChange!: boolean;\n-  /**\n-   * Passed to {@link Router#navigateByUrl Router#navigateByUrl} as part of the\n-   * `NavigationBehaviorOptions`.\n-   * @see {@link NavigationBehaviorOptions#replaceUrl NavigationBehaviorOptions#replaceUrl}\n-   * @see {@link Router#navigateByUrl Router#navigateByUrl}\n-   */\n-  // TODO(issue/24571): remove '!'.\n-  @Input() replaceUrl!: boolean;\n   /**\n    * Passed to {@link Router#navigateByUrl Router#navigateByUrl} as part of the\n    * `NavigationBehaviorOptions`.\n@@ -368,6 +373,51 @@ export class RouterLinkWithHref implements OnChanges, OnDestroy {\n     });\n   }\n \n+  /**\n+   * Passed to {@link Router#createUrlTree Router#createUrlTree} as part of the\n+   * `UrlCreationOptions`.\n+   * @see {@link UrlCreationOptions#preserveFragment UrlCreationOptions#preserveFragment}\n+   * @see {@link Router#createUrlTree Router#createUrlTree}\n+   */\n+  @Input()\n+  set preserveFragment(preserveFragment: boolean|string|null|undefined) {\n+    this._preserveFragment = coerceToBoolean(preserveFragment);\n+  }\n+\n+  get preserveFragment(): boolean {\n+    return this._preserveFragment;\n+  }\n+\n+  /**\n+   * Passed to {@link Router#navigateByUrl Router#navigateByUrl} as part of the\n+   * `NavigationBehaviorOptions`.\n+   * @see {@link NavigationBehaviorOptions#skipLocationChange NavigationBehaviorOptions#skipLocationChange}\n+   * @see {@link Router#navigateByUrl Router#navigateByUrl}\n+   */\n+  @Input()\n+  set skipLocationChange(skipLocationChange: boolean|string|null|undefined) {\n+    this._skipLocationChange = coerceToBoolean(skipLocationChange);\n+  }\n+\n+  get skipLocationChange(): boolean {\n+    return this._skipLocationChange;\n+  }\n+\n+  /**\n+   * Passed to {@link Router#navigateByUrl Router#navigateByUrl} as part of the\n+   * `NavigationBehaviorOptions`.\n+   * @see {@link NavigationBehaviorOptions#replaceUrl NavigationBehaviorOptions#replaceUrl}\n+   * @see {@link Router#navigateByUrl Router#navigateByUrl}\n+   */\n+  @Input()\n+  set replaceUrl(replaceUrl: boolean|string|null|undefined) {\n+    this._replaceUrl = coerceToBoolean(replaceUrl);\n+  }\n+\n+  get replaceUrl(): boolean {\n+    return this._replaceUrl;\n+  }\n+\n   /**\n    * Commands to pass to {@link Router#createUrlTree Router#createUrlTree}.\n    *   - **array**: commands to pass to {@link Router#createUrlTree Router#createUrlTree}.\n@@ -409,8 +459,8 @@ export class RouterLinkWithHref implements OnChanges, OnDestroy {\n     }\n \n     const extras = {\n-      skipLocationChange: coerceToBoolean(this.skipLocationChange),\n-      replaceUrl: coerceToBoolean(this.replaceUrl),\n+      skipLocationChange: this.skipLocationChange,\n+      replaceUrl: this.replaceUrl,\n       state: this.state\n     };\n     this.router.navigateByUrl(this.urlTree, extras);\n@@ -434,7 +484,7 @@ export class RouterLinkWithHref implements OnChanges, OnDestroy {\n       queryParams: this.queryParams,\n       fragment: this.fragment,\n       queryParamsHandling: this.queryParamsHandling,\n-      preserveFragment: coerceToBoolean(this.preserveFragment),\n+      preserveFragment: this.preserveFragment,\n     });\n   }\n }\n\n---\n file path A: packages/router/test/router_link_spec.ts | file path B: packages/router/test/router_link_spec.ts\n\n@@ -9,7 +9,7 @@\n import {Component} from '@angular/core';\n import {ComponentFixture, TestBed} from '@angular/core/testing';\n import {By} from '@angular/platform-browser';\n-import {Router} from '@angular/router';\n+import {Router, RouterLink, RouterLinkWithHref} from '@angular/router';\n import {RouterTestingModule} from '@angular/router/testing';\n \n describe('RouterLink', () => {\n@@ -69,6 +69,28 @@ describe('RouterLink', () => {\n       link.click();\n       expect(router.navigateByUrl).not.toHaveBeenCalled();\n     });\n+\n+    it('should coerce boolean input values', () => {\n+      const dir = fixture.debugElement.query(By.directive(RouterLink)).injector.get(RouterLink);\n+\n+      for (const truthy of [true, '', 'true', 'anything']) {\n+        dir.preserveFragment = truthy;\n+        dir.skipLocationChange = truthy;\n+        dir.replaceUrl = truthy;\n+        expect(dir.preserveFragment).toBeTrue();\n+        expect(dir.skipLocationChange).toBeTrue();\n+        expect(dir.replaceUrl).toBeTrue();\n+      }\n+\n+      for (const falsy of [false, null, undefined, 'false']) {\n+        dir.preserveFragment = falsy;\n+        dir.skipLocationChange = falsy;\n+        dir.replaceUrl = falsy;\n+        expect(dir.preserveFragment).toBeFalse();\n+        expect(dir.skipLocationChange).toBeFalse();\n+        expect(dir.replaceUrl).toBeFalse();\n+      }\n+    });\n   });\n \n   describe('RouterLinkWithHref', () => {\n@@ -100,5 +122,28 @@ describe('RouterLink', () => {\n       fixture.detectChanges();\n       expect(link.outerHTML).not.toContain('href');\n     });\n+\n+    it('should coerce boolean input values', () => {\n+      const dir = fixture.debugElement.query(By.directive(RouterLinkWithHref))\n+                      .injector.get(RouterLinkWithHref);\n+\n+      for (const truthy of [true, '', 'true', 'anything']) {\n+        dir.preserveFragment = truthy;\n+        dir.skipLocationChange = truthy;\n+        dir.replaceUrl = truthy;\n+        expect(dir.preserveFragment).toBeTrue();\n+        expect(dir.skipLocationChange).toBeTrue();\n+        expect(dir.replaceUrl).toBeTrue();\n+      }\n+\n+      for (const falsy of [false, null, undefined, 'false']) {\n+        dir.preserveFragment = falsy;\n+        dir.skipLocationChange = falsy;\n+        dir.replaceUrl = falsy;\n+        expect(dir.preserveFragment).toBeFalse();\n+        expect(dir.skipLocationChange).toBeFalse();\n+        expect(dir.replaceUrl).toBeFalse();\n+      }\n+    });\n   });\n });\n\n\n###\n\n", "completion": "feat(router): improve typings for RouterLink boolean inputs (#<issue-num>)"}
{"prompt": " file path A: packages/router/src/router_module.ts | file path B: packages/router/src/router_module.ts\n\n@@ -181,7 +181,8 @@ export function provideForRootGuard(router: Router): any {\n   if (NG_DEV_MODE && router) {\n     throw new RuntimeError(\n         RuntimeErrorCode.FOR_ROOT_CALLED_TWICE,\n-        `RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.`);\n+        `The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector.` +\n+            ` Lazy loaded modules should use RouterModule.forChild() instead.`);\n   }\n   return 'guarded';\n }\n\n---\n file path A: packages/router/test/integration.spec.ts | file path B: packages/router/test/integration.spec.ts\n\n@@ -5806,7 +5806,7 @@ describe('Integration', () => {\n          let recordedError: any = null;\n          router.navigateByUrl('/lazy/loaded')!.catch(err => recordedError = err);\n          advance(fixture);\n-         expect(recordedError.message).toContain(`RouterModule.forRoot() called twice.`);\n+         expect(recordedError.message).toContain(`NG04007`);\n        })));\n \n     it('should combine routes from multiple modules into a single configuration',\n\n\n###\n\n", "completion": "refactor(router): Update error message when Router is provided twice (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/http.md | file path B: aio/content/guide/http.md\n\n@@ -120,7 +120,7 @@ This is true for *all* `HttpClient` *methods*.\n \n <div class=\"alert is-helpful\">\n \n-The [`AsyncPipe`](api/common/AsyncPipe) subscribes and unsubscribes for you automatically.\n+You should always unsubscribe from an observable when a component is destroyed.\n \n </div>\n \n\n\n###\n\n", "completion": "docs: clarify use of unsubscribe with HttpClient (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/linker/template_ref.ts | file path B: packages/core/src/linker/template_ref.ts\n\n@@ -52,8 +52,7 @@ export abstract class TemplateRef<C> {\n   abstract readonly elementRef: ElementRef;\n \n   /**\n-   * Instantiates an embedded view based on this template,\n-   * and attaches it to the view container.\n+   * Instantiates an unattached embedded view based on this template.\n    * @param context The data-binding context of the embedded view, as declared\n    * in the `<ng-template>` usage.\n    * @param injector Injector to be used within the embedded view.\n\n\n###\n\n", "completion": "docs: fix embedded view description issue (#<issue-num>)"}
{"prompt": " file path A: aio/content/marketing/events.json | file path B: aio/content/marketing/events.json\n\n@@ -1,4 +1,30 @@\n [\n+   {\n+    \"name\": \"NG Poland\",\n+    \"location\": \"Warsaw, Poland\",\n+    \"linkUrl\": \"https://ng-poland.pl/\",\n+    \"date\": {\n+      \"start\": \"2022-10-25\",\n+      \"end\": \"2022-10-25\"\n+    },\n+    \"workshopsDate\": {\n+      \"start\": \"2022-10-24\",\n+      \"end\": \"2022-10-24\"\n+    }\n+  },\n+  {\n+    \"name\": \"JS Poland\",\n+    \"location\": \"Warsaw, Poland\",\n+    \"linkUrl\": \"https://js-poland.pl/\",\n+    \"date\": {\n+      \"start\": \"2022-10-26\",\n+      \"end\": \"2022-10-26\"\n+    },\n+    \"workshopsDate\": {\n+      \"start\": \"2022-10-24\",\n+      \"end\": \"2022-10-24\"\n+    }\n+  },\n   {\n     \"name\": \"NG-DE\",\n     \"location\": \"Berlin, Germany\",\n\n\n###\n\n", "completion": "docs: add NG Poland 2022 and JS Poland 2022 to events (#<issue-num>)"}
{"prompt": " file path A: aio/content/tutorial/toh-pt6.md | file path B: aio/content/tutorial/toh-pt6.md\n\n@@ -300,16 +300,6 @@ The component's `delete()` method immediately removes the *hero-to-delete* from\n \n There's really nothing for the component to do with the `Observable` returned by `heroService.deleteHero()` **but it must subscribe anyway**.\n \n-<div class=\"alert is-important\">\n-\n-If you neglect to `subscribe()`, the service can't send the delete request to the server.\n-As a rule, an `Observable` *does nothing* until something subscribes.\n-\n-Confirm this for yourself by temporarily removing the `subscribe()`, clicking **Dashboard**, then clicking **Heroes**.\n-This shows the full list of heroes again.\n-\n-</div>\n-\n Next, add a `deleteHero()` method to `HeroService` like this.\n \n <code-example header=\"src/app/hero.service.ts (delete)\" path=\"toh-pt6/src/app/hero.service.ts\" region=\"deleteHero\"></code-example>\n@@ -323,6 +313,16 @@ Notice the following key points:\n \n Refresh the browser and try the new delete capability.\n \n+<div class=\"alert is-important\">\n+\n+If you neglect to `subscribe()`, the service can't send the delete request to the server.\n+As a rule, an `Observable` *does nothing* until something subscribes.\n+\n+Confirm this for yourself by temporarily removing the `subscribe()`, clicking **Dashboard**, then clicking **Heroes**.\n+This shows the full list of heroes again.\n+\n+</div>\n+\n ## Search by name\n \n In this last exercise, you learn to chain `Observable` operators together so you can reduce the number of similar HTTP requests to consume network bandwidth economically.\n\n\n###\n\n", "completion": "docs: Moving a div down in tutorial toh-pt6.md (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/dependency-injection.md | file path B: aio/content/guide/dependency-injection.md\n\n@@ -57,7 +57,7 @@ class HeroService {}\n \n When you provide the service at the root level, Angular creates a single, shared instance of the `HeroService` and injects it into any class that asks for it. Registering the provider in the `@Injectable` metadata also allows Angular to optimize an app by removing the service from the compiled application if it isn't used, a process known as tree-shaking.\n \n-## Providing dependency\n+## Injecting a dependency\n \n The most common way to inject a dependency is to declare it in a class constructor. When Angular creates a new instance of a component, directive, or pipe class, it determines which services or other dependencies that class needs by looking at the constructor parameter types. For example, if the `HeroListComponent` needs the `HeroService`, the constructor can look like this:\n \n\n\n###\n\n", "completion": "docs: rename duplicate header (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/hierarchical-dependency-injection.md | file path B: aio/content/guide/hierarchical-dependency-injection.md\n\n@@ -21,7 +21,6 @@ This topic uses the following pictographs.\n \n </div>\n \n-The applications you build with Angular can become quite large, and one way to manage this complexity is to split up the application into many small well encapsulated modules, that are by themselves split up into a well-defined tree of components.\n The applications you build with Angular can become quite large, and one way to manage this complexity is to split up the application into many small well-encapsulated modules, that are by themselves split up into a well-defined tree of components.\n \n There can be sections of your page that works in a completely independent way than the rest of the application, with its own local copies of the services and other dependencies that it needs. Some of the services that these sections of the application use might be shared with other parts of the application, or with parent components that are further up in the component tree, while other dependencies are meant to be private.\n\n\n###\n\n", "completion": "docs: remove duplicated sentence (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,18 @@\n+<a name=\"14.1.2\"></a>\n+# 14.1.2 (2022-08-10)\n+### core\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [5ff715c549](https://github.com/angular/angular/commit/5ff715c5497fcbcbb33eb93770470fff5a816cd5) | fix | check if transplanted views are attached to change detector ([#46974](https://github.com/angular/angular/pull/46974)) |\n+### router\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [439d77e852](https://github.com/angular/angular/commit/439d77e852c2e08d384c420a2c3a962a804c60f1) | fix | Fix route recognition behavior with some versions of rxjs ([#47098](https://github.com/angular/angular/pull/47098)) ([#47112](https://github.com/angular/angular/pull/47112)) |\n+## Special Thanks\n+4javier, Andrew Kushnir, Andrew Scott, AntonioCardenas, Bob Watson, Bruno Barbosa, Eduardo Speroni, Edward, George Kalpakas, Jan Melcher, Kristiyan Kostadinov, Mladen Jakovljevi\u0107, Paul Gschwendtner, Pawel Kozlowski, Roman Matusevich, Vovch, ashide2729, ileil and onrails\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"14.2.0-next.1\"></a>\n # 14.2.0-next.1 (2022-08-10)\n ### common\n\n\n###\n\n", "completion": "docs: release notes for the v14.1.2 release"}
{"prompt": " file path A: .pullapprove.yml | file path B: .pullapprove.yml\n\n@@ -62,9 +62,9 @@\n \n version: 3\n \n-#availability:\n-#  users_unavailable:\n-#    - username\n+availability:\n+  users_unavailable:\n+    - atscott # August 15 - September 20 (at least)\n \n # Meta field that goes unused by PullApprove to allow for defining aliases to be\n # used throughout the config.\n\n\n###\n\n", "completion": "build: add atscott to unavailable users (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/providers.md | file path B: aio/content/guide/providers.md\n\n@@ -63,11 +63,11 @@ This means that any services listed in their provider arrays aren't available be\n When the Angular router lazy-loads a module, it creates a new injector.\n This injector is a child of the root application injector.\n Imagine a tree of injectors; there is a single root injector and then a child injector for each lazy loaded module.\n-The router adds all of the providers from the root injector to the child injector.\n-When the router creates a component within the lazy-loaded context, Angular prefers service instances created from these providers to the service instances of the application root injector.\n+This child injector gets populated with all the module-specific providers, if any. \n+Look up resolution for every provider follows the [rules of dependency injection hierarchy](guide/hierarchical-dependency-injection#resolution-rules). \n \n-Any component created within a lazy loaded module's context, such as by router navigation, gets the local instance of the service, not the instance in the root application injector.\n-Components in external modules continue to receive the instance created for the application root.\n+Any component created within a lazy loaded module's context, such as by router navigation, gets its own local instance of child provided services, not the instance in the root application injector.\n+Components in external modules continue to receive the instances created for the application root injector.\n \n Though you can provide services by lazy loading modules, not all services can be lazy loaded.\n For instance, some modules only work in the root module, such as the Router.\n\n\n###\n\n", "completion": "docs: clarify providers' injection in lazy loaded modules (#<issue-num>)"}
{"prompt": " file path A: packages/core/test/bundling/router/bundle.golden_symbols.json | file path B: packages/core/test/bundling/router/bundle.golden_symbols.json\n\n@@ -1436,6 +1436,9 @@\n   {\n     \"name\": \"isDirectiveHost\"\n   },\n+  {\n+    \"name\": \"isEmptyError\"\n+  },\n   {\n     \"name\": \"isFunction\"\n   },\n\n---\n file path A: packages/router/src/apply_redirects.ts | file path B: packages/router/src/apply_redirects.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {EnvironmentInjector, \u0275RuntimeError as RuntimeError} from '@angular/core';\n-import {EmptyError, from, Observable, of, throwError} from 'rxjs';\n+import {from, Observable, of, throwError} from 'rxjs';\n import {catchError, concatMap, first, last, map, mergeMap, scan, switchMap, tap} from 'rxjs/operators';\n \n import {RuntimeErrorCode} from './errors';\n@@ -21,6 +21,7 @@ import {createRoot, squashSegmentGroup, UrlSegment, UrlSegmentGroup, UrlSerializ\n import {forEach} from './utils/collection';\n import {getOrCreateRouteInjectorIfNeeded, getOutlet, sortByMatchingOutlets} from './utils/config';\n import {isImmediateMatch, match, matchWithChecks, noLeftoversInUrl, split} from './utils/config_matching';\n+import {isEmptyError} from './utils/type_guards';\n \n const NG_DEV_MODE = typeof ngDevMode === 'undefined' || ngDevMode;\n \n@@ -201,7 +202,7 @@ class ApplyRedirects {\n           }));\n         }),\n         first((s): s is UrlSegmentGroup => !!s), catchError((e: any, _: any) => {\n-          if (e instanceof EmptyError || e.name === 'EmptyError') {\n+          if (isEmptyError(e)) {\n             if (noLeftoversInUrl(segmentGroup, segments, outlet)) {\n               return of(new UrlSegmentGroup([], {}));\n             }\n\n---\n file path A: packages/router/src/operators/resolve_data.ts | file path B: packages/router/src/operators/resolve_data.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {EnvironmentInjector, ProviderToken} from '@angular/core';\n-import {EMPTY, EmptyError, from, MonoTypeOperatorFunction, Observable, of, throwError} from 'rxjs';\n+import {EMPTY, from, MonoTypeOperatorFunction, Observable, of, throwError} from 'rxjs';\n import {catchError, concatMap, first, map, mapTo, mergeMap, takeLast, tap} from 'rxjs/operators';\n \n import {ResolveData, Route} from '../models';\n@@ -17,6 +17,7 @@ import {RouteTitleKey} from '../shared';\n import {wrapIntoObservable} from '../utils/collection';\n import {getClosestRouteInjector} from '../utils/config';\n import {getTokenOrFunctionIdentity} from '../utils/preactivation';\n+import {isEmptyError} from '../utils/type_guards';\n \n export function resolveData(\n     paramsInheritanceStrategy: 'emptyOnly'|'always',\n@@ -74,7 +75,7 @@ function resolveNode(\n                            }))),\n       takeLast(1),\n       mapTo(data),\n-      catchError((e: unknown) => e instanceof EmptyError ? EMPTY : throwError(e)),\n+      catchError((e: unknown) => isEmptyError(e as Error) ? EMPTY : throwError(e)),\n   );\n }\n \n\n---\n file path A: packages/router/src/recognize.ts | file path B: packages/router/src/recognize.ts\n\n@@ -6,9 +6,9 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {createEnvironmentInjector, EnvironmentInjector, Type, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {EnvironmentInjector, Type, \u0275RuntimeError as RuntimeError} from '@angular/core';\n import {EmptyError, from, Observable, Observer, of} from 'rxjs';\n-import {catchError, concatMap, defaultIfEmpty, first, last as rxjsLast, map, scan, startWith, switchMap, takeLast, takeWhile} from 'rxjs/operators';\n+import {catchError, concatMap, defaultIfEmpty, first, last as rxjsLast, map, scan, switchMap, takeWhile} from 'rxjs/operators';\n \n import {RuntimeErrorCode} from './errors';\n import {Data, ResolveData, Route, Routes} from './models';\n@@ -16,9 +16,10 @@ import {ActivatedRouteSnapshot, inheritedParamsDataResolve, ParamsInheritanceStr\n import {PRIMARY_OUTLET} from './shared';\n import {UrlSegment, UrlSegmentGroup, UrlSerializer, UrlTree} from './url_tree';\n import {last} from './utils/collection';\n-import {getOrCreateRouteInjectorIfNeeded, getOutlet, sortByMatchingOutlets} from './utils/config';\n+import {getOutlet, sortByMatchingOutlets} from './utils/config';\n import {isImmediateMatch, matchWithChecks, noLeftoversInUrl, split} from './utils/config_matching';\n import {TreeNode} from './utils/tree';\n+import {isEmptyError} from './utils/type_guards';\n \n const NG_DEV_MODE = typeof ngDevMode === 'undefined' || !!ngDevMode;\n \n@@ -156,7 +157,7 @@ export class Recognizer {\n               r._injector ?? injector, r, segmentGroup, segments, outlet);\n         }),\n         first((x): x is TreeNode<ActivatedRouteSnapshot>[] => !!x), catchError(e => {\n-          if (e instanceof EmptyError) {\n+          if (isEmptyError(e)) {\n             if (noLeftoversInUrl(segmentGroup, segments, outlet)) {\n               return of([]);\n             }\n\n---\n file path A: packages/router/src/utils/type_guards.ts | file path B: packages/router/src/utils/type_guards.ts\n\n@@ -6,6 +6,8 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {EmptyError} from 'rxjs';\n+\n import {CanActivate, CanActivateChild, CanDeactivate, CanLoad, CanMatch} from '../models';\n import {NAVIGATION_CANCELING_ERROR, NavigationCancelingError, RedirectingNavigationCancelingError} from '../navigation_canceling_error';\n import {isUrlTree} from '../url_tree';\n@@ -59,3 +61,7 @@ export function isRedirectingNavigationCancelingError(\n export function isNavigationCancelingError(error: unknown): error is NavigationCancelingError {\n   return error && (error as any)[NAVIGATION_CANCELING_ERROR];\n }\n+\n+export function isEmptyError(e: Error): e is EmptyError {\n+  return e instanceof EmptyError || e?.name === 'EmptyError';\n+}\n\n\n###\n\n", "completion": "fix(router): Fix route recognition behavior with some versions of rxjs (#<issue-num>)"}
{"prompt": " file path A: packages/zone.js/lib/zone-spec/async-stack-tagging.ts | file path B: packages/zone.js/lib/zone-spec/async-stack-tagging.ts\n\n@@ -11,7 +11,7 @@ interface Console {\n }\n \n interface ConsoleTask {\n-  run<T>(f: () => T): void;\n+  run<T>(f: () => T): T;\n }\n \n interface Task {\n\n\n###\n\n", "completion": "fix(zone.js): Fix ConsoleTask interface typo (#<issue-num>)"}
{"prompt": " file path A: .github/workflows/scorecard.yml | file path B: .github/workflows/scorecard.yml\n\n@@ -45,6 +45,6 @@ jobs:\n \n       # Upload the results to GitHub's code scanning dashboard.\n       - name: 'Upload to code-scanning'\n-        uses: github/codeql-action/upload-sarif@3e7e3b32d0fb8283594bb0a76cc60a00918b0969 # tag=v2.1.16\n+        uses: github/codeql-action/upload-sarif@2ca79b6fa8d3ec278944088b4aa5f46912db5d63 # tag=v2.1.18\n         with:\n           sarif_file: results.sarif\n\n\n###\n\n", "completion": "build: update github/codeql-action action to v2.1.18 (#<issue-num>)"}
{"prompt": " file path A: aio/content/images/bios/antonio-cardenas.jpg | file path B: aio/content/images/bios/antonio-cardenas.jpg\n\nBinary files /dev/null and b/aio/content/images/bios/antonio-cardenas.jpg differ\n\n---\n file path A: aio/content/marketing/contributors.json | file path B: aio/content/marketing/contributors.json\n\n@@ -101,6 +101,14 @@\n     \"bio\": \"SDE III @cisco | GDE for Angular | Microsoft MVP | Author | Speaker | Passionate Programmer\",\n     \"groups\": [\"GDE\"]\n   },\n+  \"antoniocardenas\": {\n+    \"name\": \"Antonio Cardenas\",\n+    \"picture\": \"antonio-cardenas.jpg\",\n+    \"twitter\": \"yeoudev\",\n+    \"website\": \"https://yeou.dev\",\n+    \"bio\": \"Antonio is a senior Angular developer from Honduras, focus on immersive experiences and Web Performance, He is a public Speaker, Mentor and Facilitator for entrepreneurship programs as Techstars Startup Weekend, Content Creator and tech writer Cofounder of non profit organization @Macaotech, Love to share knowledge Typescript Coffe and Cats \ud83d\udc31.\",\n+    \"groups\": [\"GDE\"]\n+  },\n   \"armenvardanyan95\": {\n     \"name\": \"Armen Vardanyan\",\n     \"picture\": \"armen-vardanyan.jpg\",\n\n\n###\n\n", "completion": "docs: add antoniocardenas to GDE resources (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/index.md | file path B: goldens/public-api/common/index.md\n\n@@ -549,7 +549,7 @@ export class NgStyle implements DoCheck {\n     // (undocumented)\n     set ngStyle(values: {\n         [klass: string]: any;\n-    } | null);\n+    } | null | undefined);\n     // (undocumented)\n     static \u0275dir: i0.\u0275\u0275DirectiveDeclaration<NgStyle, \"[ngStyle]\", never, { \"ngStyle\": \"ngStyle\"; }, {}, never, never, true>;\n     // (undocumented)\n\n---\n file path A: packages/common/src/directives/ng_style.ts | file path B: packages/common/src/directives/ng_style.ts\n\n@@ -49,14 +49,14 @@ import {Directive, DoCheck, ElementRef, Input, KeyValueChanges, KeyValueDiffer,\n   standalone: true,\n })\n export class NgStyle implements DoCheck {\n-  private _ngStyle: {[key: string]: string}|null = null;\n+  private _ngStyle: {[key: string]: string}|null|undefined = null;\n   private _differ: KeyValueDiffer<string, string|number>|null = null;\n \n   constructor(\n       private _ngEl: ElementRef, private _differs: KeyValueDiffers, private _renderer: Renderer2) {}\n \n   @Input('ngStyle')\n-  set ngStyle(values: {[klass: string]: any}|null) {\n+  set ngStyle(values: {[klass: string]: any}|null|undefined) {\n     this._ngStyle = values;\n     if (!this._differ && values) {\n       this._differ = this._differs.find(values).create();\n\n---\n file path A: packages/common/test/directives/ng_style_spec.ts | file path B: packages/common/test/directives/ng_style_spec.ts\n\n@@ -55,6 +55,32 @@ import {ComponentFixture, TestBed, waitForAsync} from '@angular/core/testing';\n          expectNativeEl(fixture).toHaveCssStyle({'max-width': '30%'});\n        }));\n \n+    it('should remove styles with a null expression', waitForAsync(() => {\n+         const template = `<div [ngStyle]=\"expr\"></div>`;\n+         fixture = createTestComponent(template);\n+\n+         getComponent().expr = {'max-width': '40px'};\n+         fixture.detectChanges();\n+         expectNativeEl(fixture).toHaveCssStyle({'max-width': '40px'});\n+\n+         getComponent().expr = null;\n+         fixture.detectChanges();\n+         expectNativeEl(fixture).not.toHaveCssStyle('max-width');\n+       }));\n+\n+    it('should remove styles with an undefined expression', waitForAsync(() => {\n+         const template = `<div [ngStyle]=\"expr\"></div>`;\n+         fixture = createTestComponent(template);\n+\n+         getComponent().expr = {'max-width': '40px'};\n+         fixture.detectChanges();\n+         expectNativeEl(fixture).toHaveCssStyle({'max-width': '40px'});\n+\n+         getComponent().expr = undefined;\n+         fixture.detectChanges();\n+         expectNativeEl(fixture).not.toHaveCssStyle('max-width');\n+       }));\n+\n     it('should add and remove styles specified using style.unit notation', waitForAsync(() => {\n          const template = `<div [ngStyle]=\"{'max-width.px': expr}\"></div>`;\n \n\n\n###\n\n", "completion": "fix(common): allow null/undefined to be passed to ngStyle input (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/change-detection-zone-pollution.md | file path B: aio/content/guide/change-detection-zone-pollution.md\n\n@@ -46,7 +46,7 @@ import * as Plotly from 'plotly.js-dist-min';\n class AppComponent implements OnInit {\n   constructor(private ngZone: NgZone) {}\n   ngOnInit() {\n-    this.zone.runOutsideAngular(() => {\n+    this.ngZone.runOutsideAngular(() => {\n       Plotly.newPlot('chart', data);\n     });\n   }\n\n\n###\n\n", "completion": "docs: change \"zone\" to \"ngZone\" in an example (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -119,8 +119,8 @@\n     \"@types/node\": \"^12.7.9\",\n     \"@types/trusted-types\": \"^2.0.2\",\n     \"@types/xregexp\": \"^4.3.0\",\n-    \"@typescript-eslint/eslint-plugin\": \"5.32.0\",\n-    \"@typescript-eslint/parser\": \"5.32.0\",\n+    \"@typescript-eslint/eslint-plugin\": \"5.33.0\",\n+    \"@typescript-eslint/parser\": \"5.33.0\",\n     \"@yarnpkg/lockfile\": \"^1.1.0\",\n     \"archiver\": \"^5.3.0\",\n     \"assert\": \"^2.0.0\",\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -2175,14 +2175,14 @@\n   dependencies:\n     \"@types/node\" \"*\"\n \n-\"@typescript-eslint/eslint-plugin@5.32.0\":\n-  version \"5.32.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/eslint-plugin/-/eslint-plugin-5.32.0.tgz#e27e38cffa4a61226327c874a7be965e9a861624\"\n-  integrity sha512-CHLuz5Uz7bHP2WgVlvoZGhf0BvFakBJKAD/43Ty0emn4wXWv5k01ND0C0fHcl/Im8Td2y/7h44E9pca9qAu2ew==\n-  dependencies:\n-    \"@typescript-eslint/scope-manager\" \"5.32.0\"\n-    \"@typescript-eslint/type-utils\" \"5.32.0\"\n-    \"@typescript-eslint/utils\" \"5.32.0\"\n+\"@typescript-eslint/eslint-plugin@5.33.0\":\n+  version \"5.33.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/eslint-plugin/-/eslint-plugin-5.33.0.tgz#059798888720ec52ffa96c5f868e31a8f70fa3ec\"\n+  integrity sha512-jHvZNSW2WZ31OPJ3enhLrEKvAZNyAFWZ6rx9tUwaessTc4sx9KmgMNhVcqVAl1ETnT5rU5fpXTLmY9YvC1DCNg==\n+  dependencies:\n+    \"@typescript-eslint/scope-manager\" \"5.33.0\"\n+    \"@typescript-eslint/type-utils\" \"5.33.0\"\n+    \"@typescript-eslint/utils\" \"5.33.0\"\n     debug \"^4.3.4\"\n     functional-red-black-tree \"^1.0.1\"\n     ignore \"^5.2.0\"\n@@ -2190,14 +2190,14 @@\n     semver \"^7.3.7\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/parser@5.32.0\":\n-  version \"5.32.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/parser/-/parser-5.32.0.tgz#1de243443bc6186fb153b9e395b842e46877ca5d\"\n-  integrity sha512-IxRtsehdGV9GFQ35IGm5oKKR2OGcazUoiNBxhRV160iF9FoyuXxjY+rIqs1gfnd+4eL98OjeGnMpE7RF/NBb3A==\n+\"@typescript-eslint/parser@5.33.0\":\n+  version \"5.33.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/parser/-/parser-5.33.0.tgz#26ec3235b74f0667414613727cb98f9b69dc5383\"\n+  integrity sha512-cgM5cJrWmrDV2KpvlcSkelTBASAs1mgqq+IUGKJvFxWrapHpaRy5EXPQz9YaKF3nZ8KY18ILTiVpUtbIac86/w==\n   dependencies:\n-    \"@typescript-eslint/scope-manager\" \"5.32.0\"\n-    \"@typescript-eslint/types\" \"5.32.0\"\n-    \"@typescript-eslint/typescript-estree\" \"5.32.0\"\n+    \"@typescript-eslint/scope-manager\" \"5.33.0\"\n+    \"@typescript-eslint/types\" \"5.33.0\"\n+    \"@typescript-eslint/typescript-estree\" \"5.33.0\"\n     debug \"^4.3.4\"\n \n \"@typescript-eslint/scope-manager@5.29.0\":\n@@ -2208,20 +2208,20 @@\n     \"@typescript-eslint/types\" \"5.29.0\"\n     \"@typescript-eslint/visitor-keys\" \"5.29.0\"\n \n-\"@typescript-eslint/scope-manager@5.32.0\":\n-  version \"5.32.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/scope-manager/-/scope-manager-5.32.0.tgz#763386e963a8def470580cc36cf9228864190b95\"\n-  integrity sha512-KyAE+tUON0D7tNz92p1uetRqVJiiAkeluvwvZOqBmW9z2XApmk5WSMV9FrzOroAcVxJZB3GfUwVKr98Dr/OjOg==\n+\"@typescript-eslint/scope-manager@5.33.0\":\n+  version \"5.33.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/scope-manager/-/scope-manager-5.33.0.tgz#509d7fa540a2c58f66bdcfcf278a3fa79002e18d\"\n+  integrity sha512-/Jta8yMNpXYpRDl8EwF/M8It2A9sFJTubDo0ATZefGXmOqlaBffEw0ZbkbQ7TNDK6q55NPHFshGBPAZvZkE8Pw==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.32.0\"\n-    \"@typescript-eslint/visitor-keys\" \"5.32.0\"\n+    \"@typescript-eslint/types\" \"5.33.0\"\n+    \"@typescript-eslint/visitor-keys\" \"5.33.0\"\n \n-\"@typescript-eslint/type-utils@5.32.0\":\n-  version \"5.32.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/type-utils/-/type-utils-5.32.0.tgz#45a14506fe3fb908600b4cef2f70778f7b5cdc79\"\n-  integrity sha512-0gSsIhFDduBz3QcHJIp3qRCvVYbqzHg8D6bHFsDMrm0rURYDj+skBK2zmYebdCp+4nrd9VWd13egvhYFJj/wZg==\n+\"@typescript-eslint/type-utils@5.33.0\":\n+  version \"5.33.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/type-utils/-/type-utils-5.33.0.tgz#92ad1fba973c078d23767ce2d8d5a601baaa9338\"\n+  integrity sha512-2zB8uEn7hEH2pBeyk3NpzX1p3lF9dKrEbnXq1F7YkpZ6hlyqb2yZujqgRGqXgRBTHWIUG3NGx/WeZk224UKlIA==\n   dependencies:\n-    \"@typescript-eslint/utils\" \"5.32.0\"\n+    \"@typescript-eslint/utils\" \"5.33.0\"\n     debug \"^4.3.4\"\n     tsutils \"^3.21.0\"\n \n@@ -2230,10 +2230,10 @@\n   resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.29.0.tgz#7861d3d288c031703b2d97bc113696b4d8c19aab\"\n   integrity sha512-X99VbqvAXOMdVyfFmksMy3u8p8yoRGITgU1joBJPzeYa0rhdf5ok9S56/itRoUSh99fiDoMtarSIJXo7H/SnOg==\n \n-\"@typescript-eslint/types@5.32.0\":\n-  version \"5.32.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.32.0.tgz#484273021eeeae87ddb288f39586ef5efeb6dcd8\"\n-  integrity sha512-EBUKs68DOcT/EjGfzywp+f8wG9Zw6gj6BjWu7KV/IYllqKJFPlZlLSYw/PTvVyiRw50t6wVbgv4p9uE2h6sZrQ==\n+\"@typescript-eslint/types@5.33.0\":\n+  version \"5.33.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.33.0.tgz#d41c584831805554b063791338b0220b613a275b\"\n+  integrity sha512-nIMt96JngB4MYFYXpZ/3ZNU4GWPNdBbcB5w2rDOCpXOVUkhtNlG2mmm8uXhubhidRZdwMaMBap7Uk8SZMU/ppw==\n \n \"@typescript-eslint/typescript-estree@5.29.0\":\n   version \"5.29.0\"\n@@ -2248,13 +2248,13 @@\n     semver \"^7.3.7\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/typescript-estree@5.32.0\":\n-  version \"5.32.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/typescript-estree/-/typescript-estree-5.32.0.tgz#282943f34babf07a4afa7b0ff347a8e7b6030d12\"\n-  integrity sha512-ZVAUkvPk3ITGtCLU5J4atCw9RTxK+SRc6hXqLtllC2sGSeMFWN+YwbiJR9CFrSFJ3w4SJfcWtDwNb/DmUIHdhg==\n+\"@typescript-eslint/typescript-estree@5.33.0\":\n+  version \"5.33.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/typescript-estree/-/typescript-estree-5.33.0.tgz#02d9c9ade6f4897c09e3508c27de53ad6bfa54cf\"\n+  integrity sha512-tqq3MRLlggkJKJUrzM6wltk8NckKyyorCSGMq4eVkyL5sDYzJJcMgZATqmF8fLdsWrW7OjjIZ1m9v81vKcaqwQ==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.32.0\"\n-    \"@typescript-eslint/visitor-keys\" \"5.32.0\"\n+    \"@typescript-eslint/types\" \"5.33.0\"\n+    \"@typescript-eslint/visitor-keys\" \"5.33.0\"\n     debug \"^4.3.4\"\n     globby \"^11.1.0\"\n     is-glob \"^4.0.3\"\n@@ -2273,15 +2273,15 @@\n     eslint-scope \"^5.1.1\"\n     eslint-utils \"^3.0.0\"\n \n-\"@typescript-eslint/utils@5.32.0\":\n-  version \"5.32.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/utils/-/utils-5.32.0.tgz#eccb6b672b94516f1afc6508d05173c45924840c\"\n-  integrity sha512-W7lYIAI5Zlc5K082dGR27Fczjb3Q57ECcXefKU/f0ajM5ToM0P+N9NmJWip8GmGu/g6QISNT+K6KYB+iSHjXCQ==\n+\"@typescript-eslint/utils@5.33.0\":\n+  version \"5.33.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/utils/-/utils-5.33.0.tgz#46797461ce3146e21c095d79518cc0f8ec574038\"\n+  integrity sha512-JxOAnXt9oZjXLIiXb5ZIcZXiwVHCkqZgof0O8KPgz7C7y0HS42gi75PdPlqh1Tf109M0fyUw45Ao6JLo7S5AHw==\n   dependencies:\n     \"@types/json-schema\" \"^7.0.9\"\n-    \"@typescript-eslint/scope-manager\" \"5.32.0\"\n-    \"@typescript-eslint/types\" \"5.32.0\"\n-    \"@typescript-eslint/typescript-estree\" \"5.32.0\"\n+    \"@typescript-eslint/scope-manager\" \"5.33.0\"\n+    \"@typescript-eslint/types\" \"5.33.0\"\n+    \"@typescript-eslint/typescript-estree\" \"5.33.0\"\n     eslint-scope \"^5.1.1\"\n     eslint-utils \"^3.0.0\"\n \n@@ -2293,12 +2293,12 @@\n     \"@typescript-eslint/types\" \"5.29.0\"\n     eslint-visitor-keys \"^3.3.0\"\n \n-\"@typescript-eslint/visitor-keys@5.32.0\":\n-  version \"5.32.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/visitor-keys/-/visitor-keys-5.32.0.tgz#b9715d0b11fdb5dd10fd0c42ff13987470525394\"\n-  integrity sha512-S54xOHZgfThiZ38/ZGTgB2rqx51CMJ5MCfVT2IplK4Q7hgzGfe0nLzLCcenDnc/cSjP568hdeKfeDcBgqNHD/g==\n+\"@typescript-eslint/visitor-keys@5.33.0\":\n+  version \"5.33.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/visitor-keys/-/visitor-keys-5.33.0.tgz#fbcbb074e460c11046e067bc3384b5d66b555484\"\n+  integrity sha512-/XsqCzD4t+Y9p5wd9HZiptuGKBlaZO5showwqODii5C0nZawxWLF+Q6k5wYHBrQv96h6GYKyqqMHCSTqta8Kiw==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.32.0\"\n+    \"@typescript-eslint/types\" \"5.33.0\"\n     eslint-visitor-keys \"^3.3.0\"\n \n \"@webassemblyjs/ast@1.11.1\":\n\n\n###\n\n", "completion": "build: update eslint dependencies to v5.33.0 (#<issue-num>)"}
{"prompt": " file path A: aio/content/marketing/resources.json | file path B: aio/content/marketing/resources.json\n\n@@ -128,7 +128,7 @@\n             \"desc\": \"NativeScript is how you build cross-platform, native iOS and Android apps with Angular and TypeScript. Get 100% access to native APIs via JavaScript and reuse of packages from NPM, CocoaPods and Gradle. Open source and backed by Telerik.\u200b\u200b\u200b\",\n             \"logo\": \"\",\n             \"title\": \"NativeScript\",\n-            \"url\": \"https://docs.nativescript.org/angular/start/introduction\"\n+            \"url\": \"https://docs.nativescript.org/tutorial/angular.html\"\n           },\n           \"angular-miniprogram\": {\n             \"desc\": \"MiniProgram Platform for Angular.\",\n\n\n###\n\n", "completion": "docs: updated reference link to NativeScript/Angular documentation (#<issue-num>)"}
{"prompt": " file path A: packages/forms/src/directives/reactive_errors.ts | file path B: packages/forms/src/directives/reactive_errors.ts\n\n@@ -77,10 +77,15 @@ export const disabledAttrWarning = `\n   you. We recommend using this approach to avoid 'changed after checked' errors.\n \n   Example:\n+  // Specify the \\`disabled\\` property at control creation time:\n   form = new FormGroup({\n     first: new FormControl({value: 'Nancy', disabled: true}, Validators.required),\n     last: new FormControl('Drew', Validators.required)\n   });\n+\n+  // Controls can also be enabled/disabled after creation:\n+  form.get('first')?.enable();\n+  form.get('last')?.disable();\n `;\n \n export const asyncValidatorsDroppedWithOptsWarning = `\n\n\n###\n\n", "completion": "refactor: improve disabled attribute warning (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/render3/instructions/shared.ts | file path B: packages/core/src/render3/instructions/shared.ts\n\n@@ -1664,12 +1664,16 @@ function refreshContainsDirtyView(lView: LView) {\n        lContainer = getNextLContainer(lContainer)) {\n     for (let i = CONTAINER_HEADER_OFFSET; i < lContainer.length; i++) {\n       const embeddedLView = lContainer[i];\n-      if (embeddedLView[FLAGS] & LViewFlags.RefreshTransplantedView) {\n-        const embeddedTView = embeddedLView[TVIEW];\n-        ngDevMode && assertDefined(embeddedTView, 'TView must be allocated');\n-        refreshView(embeddedTView, embeddedLView, embeddedTView.template, embeddedLView[CONTEXT]!);\n-      } else if (embeddedLView[TRANSPLANTED_VIEWS_TO_REFRESH] > 0) {\n-        refreshContainsDirtyView(embeddedLView);\n+      if (viewAttachedToChangeDetector(embeddedLView)) {\n+        if (embeddedLView[FLAGS] & LViewFlags.RefreshTransplantedView) {\n+          const embeddedTView = embeddedLView[TVIEW];\n+          ngDevMode && assertDefined(embeddedTView, 'TView must be allocated');\n+          refreshView(\n+              embeddedTView, embeddedLView, embeddedTView.template, embeddedLView[CONTEXT]!);\n+\n+        } else if (embeddedLView[TRANSPLANTED_VIEWS_TO_REFRESH] > 0) {\n+          refreshContainsDirtyView(embeddedLView);\n+        }\n       }\n     }\n   }\n\n---\n file path A: packages/core/test/acceptance/change_detection_transplanted_view_spec.ts | file path B: packages/core/test/acceptance/change_detection_transplanted_view_spec.ts\n\n@@ -627,6 +627,124 @@ describe('change detection for transplanted views', () => {\n     viewRef.detectChanges();\n     expect(component.checks).toEqual(1);\n   });\n+\n+  describe('when detached', () => {\n+    @Component({\n+      selector: 'on-push-component',\n+      template: `\n+          <ng-container #vc></ng-container>\n+        `,\n+      changeDetection: ChangeDetectionStrategy.OnPush\n+    })\n+    class OnPushComponent {\n+      @ViewChild('vc', {read: ViewContainerRef}) viewContainer!: ViewContainerRef;\n+      @Input() template!: TemplateRef<{}>;\n+\n+      createTemplate() {\n+        return this.viewContainer.createEmbeddedView(this.template);\n+      }\n+    }\n+\n+    @Component({\n+      selector: 'check-always-component',\n+      template: `\n+          <ng-container #vc></ng-container>\n+        `,\n+    })\n+    class CheckAlwaysComponent {\n+      @ViewChild('vc', {read: ViewContainerRef}) viewContainer!: ViewContainerRef;\n+      @Input() template!: TemplateRef<{}>;\n+\n+      createTemplate() {\n+        return this.viewContainer.createEmbeddedView(this.template);\n+      }\n+    }\n+    let fixture: ComponentFixture<App>;\n+    let appComponent: App;\n+    let onPushComponent: OnPushComponent;\n+    let checkAlwaysComponent: CheckAlwaysComponent;\n+\n+    @Component({\n+      template: `\n+      <ng-template #transplantedTemplate>{{ incrementChecks() }}</ng-template>\n+      <on-push-component [template]=\"transplantedTemplate\"></on-push-component>\n+      <check-always-component [template]=\"transplantedTemplate\"></check-always-component>\n+        `\n+    })\n+    class App {\n+      @ViewChild(OnPushComponent) onPushComponent!: OnPushComponent;\n+      @ViewChild(CheckAlwaysComponent) checkAlwaysComponent!: CheckAlwaysComponent;\n+      transplantedViewRefreshCount = 0;\n+      incrementChecks() {\n+        this.transplantedViewRefreshCount++;\n+      }\n+    }\n+    beforeEach(() => {\n+      TestBed.configureTestingModule({declarations: [App, OnPushComponent, CheckAlwaysComponent]});\n+      fixture = TestBed.createComponent(App);\n+      fixture.detectChanges();\n+      appComponent = fixture.componentInstance;\n+      onPushComponent = appComponent.onPushComponent;\n+      checkAlwaysComponent = appComponent.checkAlwaysComponent;\n+    });\n+    describe('inside OnPush components', () => {\n+      it('should detect changes when attached', () => {\n+        onPushComponent.createTemplate();\n+        fixture.detectChanges(false);\n+        expect(appComponent.transplantedViewRefreshCount).toEqual(1);\n+      });\n+\n+      it('should not detect changes', () => {\n+        const viewRef = onPushComponent.createTemplate();\n+        viewRef.detach();\n+        fixture.detectChanges(false);\n+        expect(appComponent.transplantedViewRefreshCount).toEqual(0);\n+        viewRef.reattach();\n+        fixture.detectChanges(false);\n+        expect(appComponent.transplantedViewRefreshCount).toEqual(1);\n+      });\n+\n+      it('should not detect changes on mixed detached/attached refs', () => {\n+        onPushComponent.createTemplate();\n+        const viewRef = onPushComponent.createTemplate();\n+        viewRef.detach();\n+        fixture.detectChanges(false);\n+        expect(appComponent.transplantedViewRefreshCount).toEqual(1);\n+        viewRef.reattach();\n+        fixture.detectChanges(false);\n+        expect(appComponent.transplantedViewRefreshCount).toEqual(3);\n+      });\n+    });\n+\n+    describe('inside CheckAlways component', () => {\n+      it('should detect changes when attached', () => {\n+        checkAlwaysComponent.createTemplate();\n+        fixture.detectChanges(false);\n+        expect(appComponent.transplantedViewRefreshCount).toEqual(1);\n+      });\n+\n+      it('should not detect changes', () => {\n+        const viewRef = checkAlwaysComponent.createTemplate();\n+        viewRef.detach();\n+        fixture.detectChanges(false);\n+        expect(appComponent.transplantedViewRefreshCount).toEqual(0);\n+        viewRef.reattach();\n+        fixture.detectChanges(false);\n+        expect(appComponent.transplantedViewRefreshCount).toEqual(1);\n+      });\n+\n+      it('should not detect changes on mixed detached/attached refs', () => {\n+        checkAlwaysComponent.createTemplate();\n+        const viewRef = checkAlwaysComponent.createTemplate();\n+        viewRef.detach();\n+        fixture.detectChanges(false);\n+        expect(appComponent.transplantedViewRefreshCount).toEqual(1);\n+        viewRef.reattach();\n+        fixture.detectChanges(false);\n+        expect(appComponent.transplantedViewRefreshCount).toEqual(3);\n+      });\n+    });\n+  });\n });\n \n function trim(text: string|null): string {\n\n\n###\n\n", "completion": "fix(core): check if transplanted views are attached to change detector (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/dependency-injection.md | file path B: aio/content/guide/dependency-injection.md\n\n@@ -25,7 +25,7 @@ The next step is to make it available in the DI by providing it.  A dependency c\n \n <code-example language=\"typescript\">\n @Component({\n-  selector: 'hero-list,\n+  selector: 'hero-list',\n   template: '...',\n   providers: [HeroService]\n })\n\n\n###\n\n", "completion": "docs: fix dependecy injection documentation page typos (#<issue-num>)"}
{"prompt": " file path A: aio/content/examples/toh-pt5/src/app/app.component.css | file path B: aio/content/examples/toh-pt5/src/app/app.component.css\n\n@@ -16,6 +16,6 @@ nav a:hover {\n   color: white;\n   background-color: #42545C;\n }\n-nav a.active {\n+nav a:active {\n   background-color: black;\n }\n\n\n###\n\n", "completion": "fix(docs-infra): fix nav css on tutorial tour of heroes (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/render3/definition.ts | file path B: packages/core/src/render3/definition.ts\n\n@@ -9,7 +9,7 @@\n import {ChangeDetectionStrategy} from '../change_detection/constants';\n import {NG_PROV_DEF} from '../di/interface/defs';\n import {Mutable, Type} from '../interface/type';\n-import {NgModuleDef, NgModuleType} from '../metadata/ng_module_def';\n+import {NgModuleDef} from '../metadata/ng_module_def';\n import {SchemaMetadata} from '../metadata/schema';\n import {ViewEncapsulation} from '../metadata/view';\n import {noSideEffects} from '../util/closure';\n@@ -375,8 +375,6 @@ function nonNull<T>(value: T|null): value is T {\n   return value !== null;\n }\n \n-export const autoRegisterModuleById: {[id: string]: NgModuleType} = {};\n-\n /**\n  * @codeGenApi\n  */\n@@ -416,9 +414,6 @@ export function \u0275\u0275defineNgModule<T>(def: {\n       schemas: def.schemas || null,\n       id: def.id || null,\n     };\n-    if (def.id != null) {\n-      autoRegisterModuleById[def.id!] = def.type as unknown as NgModuleType;\n-    }\n     return res;\n   });\n }\n\n---\n file path A: packages/core/test/bundling/animations/bundle.golden_symbols.json | file path B: packages/core/test/bundling/animations/bundle.golden_symbols.json\n\n@@ -584,9 +584,6 @@\n   {\n     \"name\": \"attachPatchData\"\n   },\n-  {\n-    \"name\": \"autoRegisterModuleById\"\n-  },\n   {\n     \"name\": \"balanceProperties\"\n   },\n\n---\n file path A: packages/core/test/bundling/cyclic_import/bundle.golden_symbols.json | file path B: packages/core/test/bundling/cyclic_import/bundle.golden_symbols.json\n\n@@ -416,9 +416,6 @@\n   {\n     \"name\": \"attachPatchData\"\n   },\n-  {\n-    \"name\": \"autoRegisterModuleById\"\n-  },\n   {\n     \"name\": \"baseElement\"\n   },\n\n---\n file path A: packages/core/test/bundling/forms_reactive/bundle.golden_symbols.json | file path B: packages/core/test/bundling/forms_reactive/bundle.golden_symbols.json\n\n@@ -596,9 +596,6 @@\n   {\n     \"name\": \"attachPatchData\"\n   },\n-  {\n-    \"name\": \"autoRegisterModuleById\"\n-  },\n   {\n     \"name\": \"baseElement\"\n   },\n\n---\n file path A: packages/core/test/bundling/forms_template_driven/bundle.golden_symbols.json | file path B: packages/core/test/bundling/forms_template_driven/bundle.golden_symbols.json\n\n@@ -578,9 +578,6 @@\n   {\n     \"name\": \"attachPatchData\"\n   },\n-  {\n-    \"name\": \"autoRegisterModuleById\"\n-  },\n   {\n     \"name\": \"baseElement\"\n   },\n\n---\n file path A: packages/core/test/bundling/hello_world/bundle.golden_symbols.json | file path B: packages/core/test/bundling/hello_world/bundle.golden_symbols.json\n\n@@ -293,9 +293,6 @@\n   {\n     \"name\": \"attachPatchData\"\n   },\n-  {\n-    \"name\": \"autoRegisterModuleById\"\n-  },\n   {\n     \"name\": \"baseElement\"\n   },\n\n---\n file path A: packages/core/test/bundling/router/bundle.golden_symbols.json | file path B: packages/core/test/bundling/router/bundle.golden_symbols.json\n\n@@ -836,9 +836,6 @@\n   {\n     \"name\": \"attachPatchData\"\n   },\n-  {\n-    \"name\": \"autoRegisterModuleById\"\n-  },\n   {\n     \"name\": \"baseElement\"\n   },\n\n---\n file path A: packages/core/test/bundling/todo/bundle.golden_symbols.json | file path B: packages/core/test/bundling/todo/bundle.golden_symbols.json\n\n@@ -506,9 +506,6 @@\n   {\n     \"name\": \"attachPatchData\"\n   },\n-  {\n-    \"name\": \"autoRegisterModuleById\"\n-  },\n   {\n     \"name\": \"baseElement\"\n   },\n\n\n###\n\n", "completion": "refactor(core): remove unused module tracking (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/hierarchical-dependency-injection.md | file path B: aio/content/guide/hierarchical-dependency-injection.md\n\n@@ -20,6 +20,7 @@ This topic uses the following pictographs.\n | <code>&#x1F994;</code> | hedgehog \\(`\ud83e\udd94`\\)       |\n \n </div>\n+\n The applications you build with Angular can become quite large, and one way to manage this complexity is to split up the application into many small well encapsulated modules, that are by themselves split up into a well-defined tree of components.\n The applications you build with Angular can become quite large, and one way to manage this complexity is to split up the application into many small well-encapsulated modules, that are by themselves split up into a well-defined tree of components.\n \n\n\n###\n\n", "completion": "docs: fix text formatting for paragraph in Hierarchical injectors (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/architecture-components.md | file path B: aio/content/guide/architecture-components.md\n\n@@ -17,7 +17,7 @@ In the following example, the `HeroListComponent` class includes:\n * A `selectedHero` property that holds the last hero selected by the user.\n * A `selectHero()` method sets a `selectedHero` property when the user clicks to choose a hero from that list.\n \n-The component initializes the `heroes` property by using the `HeroService` service, which is a TypeScript [parameter property](https://www.typescriptlang.org/docs/handbook/classes.html#parameter-properties) on the constructor. Angular's dependency injection system provides the `HeroService` service to the component.\n+The component initializes the `heroes` property by using the `HeroService` service, which is a TypeScript [parameter property](https://www.typescriptlang.org/docs/handbook/2/classes.html#parameter-properties) on the constructor. Angular's dependency injection system provides the `HeroService` service to the component.\n \n <code-example header=\"src/app/hero-list.component.ts (class)\" path=\"architecture/src/app/hero-list.component.ts\" region=\"class\"></code-example>\n \n\n\n###\n\n", "completion": "docs: update link to the TypeScript handbook (#<issue-num>)"}
{"prompt": " file path A: .circleci/config.yml | file path B: .circleci/config.yml\n\n@@ -24,15 +24,15 @@ version: 2.1\n # **NOTE 2 **: If you change the cache key prefix, also sync the cache_key_fallback to match.\n # **NOTE 3 **: Keep the static part of the cache key as prefix to enable correct fallbacks.\n # See https://circleci.com/docs/2.0/caching/#restoring-cache for how prefixes work in CircleCI.\n-var_3: &cache_key v6-angular-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}-{{ checksum \"aio/yarn.lock\" }}\n+var_3: &cache_key v7-angular-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}-{{ checksum \"aio/yarn.lock\" }}\n # We invalidate the cache if the Bazel version changes because otherwise the `bazelisk` cache\n # folder will contain all previously used versions and ultimately cause the cache restoring to\n # be slower due to its growing size.\n-var_4: &cache_key_fallback v6-angular-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}\n+var_4: &cache_key_fallback v7-angular-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}\n \n # Windows needs its own cache key because binaries in node_modules are different.\n-var_3_win: &cache_key_win v8-angular-win-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}\n-var_4_win: &cache_key_win_fallback v8-angular-win-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}\n+var_3_win: &cache_key_win v9-angular-win-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}\n+var_4_win: &cache_key_win_fallback v9-angular-win-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}\n \n # Cache key for the `components-repo-unit-tests` job. **Note** when updating the SHA in the\n # cache keys also update the SHA for the \"COMPONENTS_REPO_COMMIT\" environment variable.\n\n\n###\n\n", "completion": "ci: invalidate circleci caches to prune nested `node_modules` (#<issue-num>)"}
{"prompt": " file path A: packages/core/src/core_render3_private_export.ts | file path B: packages/core/src/core_render3_private_export.ts\n\n@@ -218,12 +218,6 @@ export {\n export {\n   setDocument as \u0275setDocument\n } from './render3/interfaces/document';\n-export {\n-  Player as \u0275Player,\n-  PlayerFactory as \u0275PlayerFactory,\n-  PlayerHandler as \u0275PlayerHandler,\n-  PlayState as \u0275PlayState,\n-} from './render3/interfaces/player';\n export {\n   compileComponent as \u0275compileComponent,\n   compileDirective as \u0275compileDirective,\n\n---\n file path A: packages/core/src/render3/component_ref.ts | file path B: packages/core/src/render3/component_ref.ts\n\n@@ -32,7 +32,6 @@ import {reportUnknownPropertyError} from './instructions/element_validation';\n import {addToViewTree, createLView, createTView, getOrCreateTComponentView, getOrCreateTNode, initTNodeFlags, instantiateRootComponent, invokeHostBindingsInCreationMode, locateHostElement, markAsComponentHost, markDirtyIfOnPush, registerHostBindingOpCodes, renderView, setInputsForProperty} from './instructions/shared';\n import {ComponentDef, RenderFlags} from './interfaces/definition';\n import {PropertyAliasValue, TContainerNode, TElementContainerNode, TElementNode, TNode, TNodeType} from './interfaces/node';\n-import {PlayerHandler} from './interfaces/player';\n import {Renderer, RendererFactory} from './interfaces/renderer';\n import {RElement, RNode} from './interfaces/renderer_dom';\n import {CONTEXT, HEADER_OFFSET, LView, LViewFlags, RootContext, TVIEW, TViewType} from './interfaces/view';\n@@ -43,7 +42,6 @@ import {enterView, getCurrentTNode, getLView, leaveView, setSelectedIndex} from\n import {computeStaticStyling} from './styling/static_styling';\n import {setUpAttributes} from './util/attrs_utils';\n import {stringifyForError} from './util/stringify_utils';\n-import {getRootContext} from './util/view_traversal_utils';\n import {getTNode} from './util/view_utils';\n import {RootViewRef, ViewRef} from './view_ref';\n \n\n---\n file path A: packages/core/src/render3/interfaces/player.ts | file path B: None\n\n@@ -1,133 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-/**\n- * A shared interface which contains an animation player\n- */\n-export interface Player {\n-  parent?: Player|null;\n-  state: PlayState;\n-  play(): void;\n-  pause(): void;\n-  finish(): void;\n-  destroy(): void;\n-  addEventListener(state: PlayState|string, cb: (data?: any) => any): void;\n-}\n-\n-export const enum BindingType {\n-  Unset = 0,\n-  Class = 1,\n-  Style = 2,\n-}\n-\n-export interface BindingStore {\n-  setValue(prop: string, value: any): void;\n-}\n-\n-/**\n- * Defines the shape which produces the Player.\n- *\n- * Used to produce a player that will be placed on an element that contains\n- * styling bindings that make use of the player. This function is designed\n- * to be used with `PlayerFactory`.\n- */\n-export interface PlayerFactoryBuildFn {\n-  (element: HTMLElement, type: BindingType, values: {[key: string]: any}, isFirstRender: boolean,\n-   currentPlayer: Player|null): Player|null;\n-}\n-\n-/**\n- * Used as a reference to build a player from a styling template binding\n- * (`[style]` and `[class]`).\n- *\n- * The `fn` function will be called once any styling-related changes are\n- * evaluated on an element and is expected to return a player that will\n- * be then run on the element.\n- *\n- * `[style]`, `[style.prop]`, `[class]` and `[class.name]` template bindings\n- * all accept a `PlayerFactory` as input and this player factories.\n- */\n-export interface PlayerFactory {\n-  '__brand__': 'Brand for PlayerFactory that nothing will match';\n-}\n-\n-export interface PlayerBuilder extends BindingStore {\n-  buildPlayer(currentPlayer: Player|null, isFirstRender: boolean): Player|undefined|null;\n-}\n-\n-/**\n- * The state of a given player\n- *\n- * Do not change the increasing nature of the numbers since the player\n- * code may compare state by checking if a number is higher or lower than\n- * a certain numeric value.\n- */\n-export const enum PlayState {\n-  Pending = 0,\n-  Running = 1,\n-  Paused = 2,\n-  Finished = 100,\n-  Destroyed = 200\n-}\n-\n-/**\n- * The context that stores all the active players and queued player factories present on an element.\n- */\n-export interface PlayerContext extends Array<null|number|Player|PlayerBuilder> {\n-  [PlayerIndex.NonBuilderPlayersStart]: number;\n-  [PlayerIndex.ClassMapPlayerBuilderPosition]: PlayerBuilder|null;\n-  [PlayerIndex.ClassMapPlayerPosition]: Player|null;\n-  [PlayerIndex.StyleMapPlayerBuilderPosition]: PlayerBuilder|null;\n-  [PlayerIndex.StyleMapPlayerPosition]: Player|null;\n-}\n-\n-/**\n- * Designed to be used as an injection service to capture all animation players.\n- *\n- * When present all animation players will be passed into the flush method below.\n- * This feature is designed to service application-wide animation testing, live\n- * debugging as well as custom animation choreographing tools.\n- */\n-export interface PlayerHandler {\n-  /**\n-   * Designed to kick off the player at the end of change detection\n-   */\n-  flushPlayers(): void;\n-\n-  /**\n-   * @param player The player that has been scheduled to run within the application.\n-   * @param context The context as to where the player was bound to\n-   */\n-  queuePlayer(player: Player, context: ComponentInstance|DirectiveInstance|HTMLElement): void;\n-}\n-\n-export const enum PlayerIndex {\n-  // The position where the index that reveals where players start in the PlayerContext\n-  NonBuilderPlayersStart = 0,\n-  // The position where the player builder lives (which handles {key:value} map expression) for\n-  // classes\n-  ClassMapPlayerBuilderPosition = 1,\n-  // The position where the last player assigned to the class player builder is stored\n-  ClassMapPlayerPosition = 2,\n-  // The position where the player builder lives (which handles {key:value} map expression) for\n-  // styles\n-  StyleMapPlayerBuilderPosition = 3,\n-  // The position where the last player assigned to the style player builder is stored\n-  StyleMapPlayerPosition = 4,\n-  // The position where any player builders start in the PlayerContext\n-  PlayerBuildersStartPosition = 1,\n-  // The position where non map-based player builders start in the PlayerContext\n-  SinglePlayerBuildersStartPosition = 5,\n-  // For each player builder there is a player in the player context (therefore size = 2)\n-  PlayerAndPlayerBuildersTupleSize = 2,\n-  // The player exists next to the player builder in the list\n-  PlayerOffsetPosition = 1,\n-}\n-\n-export declare type ComponentInstance = {};\n-export declare type DirectiveInstance = {};\n\n\n###\n\n", "completion": "refactor(core): drop unused animation-related types (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/dependency-injection.md | file path B: aio/content/guide/dependency-injection.md\n\n@@ -6,7 +6,7 @@ Two main roles exist in the DI system: dependency consumer and dependency provid\n \n Angular facilitates the interaction between dependency consumers and dependency providers using an abstraction called [Injector](guide/glossary#injector). When a dependency is requested, the injector checks its registry to see if there is an instance already available there. If not, a new instance is created and stored in the registry. Angular creates an application-wide injector (also known as \"root\" injector) during the application bootstrap process, as well as any other injectors as needed. In most cases you don't need to manually create injectors, but you should know that there is a layer that connects providers and consumers.\n \n-This topic covers basic scenarios of how a class can act as a dependency. Angular also allows you to use functions, objects, primitive types such as string or Boolean, or any other types as dependencies. For more information, see [Dependency providers](guide/dependency-injection-providers].\n+This topic covers basic scenarios of how a class can act as a dependency. Angular also allows you to use functions, objects, primitive types such as string or Boolean, or any other types as dependencies. For more information, see [Dependency providers](guide/dependency-injection-providers).\n \n ## Providing dependency\n \n@@ -81,4 +81,4 @@ When all requested services have been resolved and returned, Angular can call th\n * [Creating and injecting services](guide/creating-injectable-service)\n * [Dependency Injection in Action](guide/dependency-injection-in-action)\n \n-@reviewed 2022-08-02\n\\ No newline at end of file\n+@reviewed 2022-08-02\n\n\n###\n\n", "completion": "docs: fix link in dependency injection guide (#<issue-num>)"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -158,10 +158,10 @@ cldr_xml_data_repository(\n # sass rules\n http_archive(\n     name = \"io_bazel_rules_sass\",\n-    sha256 = \"fcd963afb0744685ee798f991942ff02196ae71ccbeedd8efaac17040dd99989\",\n-    strip_prefix = \"rules_sass-70ffe0181974c3195cdacb4ecbd8fed8e31b72fb\",\n+    sha256 = \"85b34f2e5e227aa586b6e0fd6942262e17b3cface596891eeef5a29a0b7467e3\",\n+    strip_prefix = \"rules_sass-697e5a08bdd39aee49f2c6f4eb621ef59e677e49\",\n     urls = [\n-        \"https://github.com/bazelbuild/rules_sass/archive/70ffe0181974c3195cdacb4ecbd8fed8e31b72fb.zip\",\n+        \"https://github.com/bazelbuild/rules_sass/archive/697e5a08bdd39aee49f2c6f4eb621ef59e677e49.zip\",\n     ],\n )\n \n\n\n###\n\n", "completion": "build: update io_bazel_rules_sass digest to 697e5a0 (#<issue-num>)"}
{"prompt": " file path A: aio/ngsw-config.json | file path B: aio/ngsw-config.json\n\n@@ -118,6 +118,7 @@\n     \"!/guide/cli-quickstart/{0,1}\",\n     \"!/guide/displaying-data/{0,1}\",\n     \"!/guide/i18n/{0,1}\",\n+    \"!/guide/ivy/{0,1}\",\n     \"!/guide/learning-angular*\",\n     \"!/guide/metadata/{0,1}\",\n     \"!/guide/ngmodule/{0,1}\",\n\n\n###\n\n", "completion": "build: update `ngsw-config.json` after redirect changes (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -100,7 +100,7 @@\n     \"@angular/router\": \"^14.1.0-next\",\n     \"@angular/service-worker\": \"^14.1.0-next\",\n     \"rxjs\": \"~7.5.0\",\n-    \"safevalues\": \"^0.1.8\",\n+    \"safevalues\": \"^0.3.1\",\n     \"tslib\": \"^2.3.0\",\n     \"zone.js\": \"~0.11.4\"\n   },\n\n---\n file path A: aio/src/app/app.module.ts | file path B: aio/src/app/app.module.ts\n\n@@ -13,7 +13,7 @@ import { MatSidenavModule } from '@angular/material/sidenav';\n import { MatToolbarModule } from '@angular/material/toolbar';\n \n import { svg } from 'app/shared/security';\n-import { scriptUrl, unwrapScriptUrlForSink } from 'safevalues';\n+import { trustedResourceUrl, unwrapResourceUrl } from 'safevalues';\n \n import { AppComponent } from 'app/app.component';\n import { CustomIconRegistry, SVG_ICONS } from 'app/shared/custom-icon-registry';\n@@ -156,7 +156,7 @@ export const svgIconProviders = [\n     SharedModule,\n     ServiceWorkerModule.register(\n         // Make sure service worker is loaded with a TrustedScriptURL\n-        unwrapScriptUrlForSink(scriptUrl`/ngsw-worker.js`),\n+        unwrapResourceUrl(trustedResourceUrl`/ngsw-worker.js`) as string,\n         {enabled: environment.production}),\n   ],\n   declarations: [\n\n---\n file path A: aio/src/app/custom-elements/code/code.component.ts | file path B: aio/src/app/custom-elements/code/code.component.ts\n\n@@ -5,8 +5,8 @@ import { PrettyPrinter } from './pretty-printer.service';\n import { MatSnackBar } from '@angular/material/snack-bar';\n import { Observable, of } from 'rxjs';\n import { tap } from 'rxjs/operators';\n-import { unwrapHtmlForSink } from 'safevalues';\n-import { htmlFromStringKnownToSatisfyTypeContract } from 'safevalues/unsafe/reviewed';\n+import { unwrapHtml } from 'safevalues';\n+import { htmlSafeByReview } from 'safevalues/restricted/reviewed';\n import { fromOuterHTML } from 'app/shared/security';\n \n /**\n@@ -149,7 +149,7 @@ export class CodeComponent implements OnChanges {\n   private setCodeHtml(formattedCode: TrustedHTML) {\n     // **Security:** Code example content is provided by docs authors and as such its considered to\n     // be safe for innerHTML purposes.\n-    this.codeContainer.nativeElement.innerHTML = unwrapHtmlForSink(formattedCode);\n+    this.codeContainer.nativeElement.innerHTML = unwrapHtml(formattedCode);\n   }\n \n   /** Gets the textContent of the displayed code element. */\n@@ -198,7 +198,7 @@ function leftAlign(text: TrustedHTML): TrustedHTML {\n     }\n   });\n \n-  return htmlFromStringKnownToSatisfyTypeContract(\n+  return htmlSafeByReview(\n       lines.map(line => line.slice(indent)).join('\\n').trim(),\n       'safe manipulation of existing trusted HTML');\n }\n\n---\n file path A: aio/src/app/custom-elements/code/pretty-printer.service.ts | file path B: aio/src/app/custom-elements/code/pretty-printer.service.ts\n\n@@ -1,5 +1,5 @@\n import { Injectable } from '@angular/core';\n-import { htmlFromStringKnownToSatisfyTypeContract } from 'safevalues/unsafe/reviewed';\n+import { htmlSafeByReview } from 'safevalues/restricted/reviewed';\n \n import { from, Observable } from 'rxjs';\n import { first, map, share } from 'rxjs/operators';\n@@ -51,7 +51,7 @@ export class PrettyPrinter {\n     return this.prettyPrintOne.pipe(\n       map(ppo => {\n         try {\n-          return htmlFromStringKnownToSatisfyTypeContract(\n+          return htmlSafeByReview(\n               ppo(code, language, linenums), 'prettify.js modifies already trusted HTML inline');\n         } catch (err) {\n           const msg = `Could not format code that begins '${code.toString().slice(0, 50)}...'.`;\n\n---\n file path A: aio/src/app/documents/document.service.ts | file path B: aio/src/app/documents/document.service.ts\n\n@@ -4,7 +4,7 @@ import { HttpClient, HttpErrorResponse } from '@angular/common/http';\n import { AsyncSubject, Observable, of } from 'rxjs';\n import { catchError, map, switchMap, tap } from 'rxjs/operators';\n import { htmlEscape } from 'safevalues';\n-import { htmlFromStringKnownToSatisfyTypeContract } from 'safevalues/unsafe/reviewed';\n+import { htmlSafeByReview } from 'safevalues/restricted/reviewed';\n \n import { DocumentContents, UnsafeDocumentContents } from './document-contents';\n export { DocumentContents } from './document-contents';\n@@ -17,7 +17,7 @@ export const FETCHING_ERROR_ID = 'fetching-error';\n \n export const CONTENT_URL_PREFIX = 'generated/';\n export const DOC_CONTENT_URL_PREFIX = CONTENT_URL_PREFIX + 'docs/';\n-const FETCHING_ERROR_CONTENTS = (path: string) => htmlFromStringKnownToSatisfyTypeContract(`\n+const FETCHING_ERROR_CONTENTS = (path: string) => htmlSafeByReview(`\n   <div class=\"nf-container l-flex-wrap flex-center\">\n     <div class=\"nf-icon material-icons\">error_outline</div>\n     <div class=\"nf-response l-flex-wrap center\">\n@@ -74,7 +74,7 @@ export class DocumentService {\n                   null :\n                   // SECURITY: HTML is authored by the documentation team and is fetched directly\n                   // from the server\n-                  htmlFromStringKnownToSatisfyTypeContract(data.contents, '^')\n+                  htmlSafeByReview(data.contents, '^')\n             })),\n             catchError((error: HttpErrorResponse) =>\n               error.status === 404 ? this.getFileNotFoundDoc(id) : this.getErrorDoc(id, error)\n\n---\n file path A: aio/src/app/layout/doc-viewer/doc-viewer.component.spec.ts | file path B: aio/src/app/layout/doc-viewer/doc-viewer.component.spec.ts\n\n@@ -3,7 +3,7 @@ import { Meta, Title } from '@angular/platform-browser';\n \n import { Observable, asapScheduler, of, lastValueFrom } from 'rxjs';\n import { EMPTY_HTML, htmlEscape } from 'safevalues';\n-import { htmlFromStringKnownToSatisfyTypeContract } from 'safevalues/unsafe/reviewed';\n+import { htmlSafeByReview } from 'safevalues/restricted/reviewed';\n \n import { FILE_NOT_FOUND_ID, FETCHING_ERROR_ID } from 'app/documents/document.service';\n import { CustomElementsModule } from 'app/custom-elements/custom-elements.module';\n@@ -319,7 +319,7 @@ describe('DocViewerComponent', () => {\n       beforeEach(() => swapViewsSpy.and.callThrough());\n \n       it('should display the document contents', async () => {\n-        const contents = htmlFromStringKnownToSatisfyTypeContract('<h1>Hello,</h1> <div>world!</div>', 'constant HTML');\n+        const contents = htmlSafeByReview('<h1>Hello,</h1> <div>world!</div>', 'constant HTML');\n         await doRender(contents);\n \n         expect(docViewerEl.innerHTML).toContain(contents.toString());\n\n---\n file path A: aio/src/app/layout/doc-viewer/doc-viewer.component.ts | file path B: aio/src/app/layout/doc-viewer/doc-viewer.component.ts\n\n@@ -7,7 +7,7 @@ import {fromInnerHTML} from 'app/shared/security';\n import {TocService} from 'app/shared/toc.service';\n import {asapScheduler, Observable, of, timer} from 'rxjs';\n import {catchError, observeOn, switchMap, takeUntil, tap} from 'rxjs/operators';\n-import {EMPTY_HTML, unwrapHtmlForSink} from 'safevalues';\n+import {EMPTY_HTML, unwrapHtml} from 'safevalues';\n \n \n // Constants\n@@ -65,9 +65,9 @@ export class DocViewerComponent implements OnDestroy {\n       private elementsLoader: ElementsLoader) {\n     this.hostElement = elementRef.nativeElement;\n \n-    // Security: the initialDocViewerContent comes from the prerendered DOM and is considered to be\n-    // secure\n-    this.hostElement.innerHTML = unwrapHtmlForSink(initialDocViewerContent);\n+    // Security: the initialDocViewerContent comes from the prerendered DOM and is\n+    // considered to be secure\n+    this.hostElement.innerHTML = unwrapHtml(initialDocViewerContent) as string;\n \n     if (this.hostElement.firstElementChild) {\n       this.currViewContainer = this.hostElement.firstElementChild as HTMLElement;\n@@ -141,7 +141,7 @@ export class DocViewerComponent implements OnDestroy {\n           } else {\n             // Security: `doc.contents` is always authored by the documentation team\n             //           and is considered to be safe.\n-            this.nextViewContainer.innerHTML = unwrapHtmlForSink(doc.contents);\n+            this.nextViewContainer.innerHTML = unwrapHtml(doc.contents) as string;\n           }\n         }),\n         tap(() => addTitleAndToc = this.prepareTitleAndToc(this.nextViewContainer, doc.id)),\n\n---\n file path A: aio/src/app/shared/analytics.service.ts | file path B: aio/src/app/shared/analytics.service.ts\n\n@@ -1,6 +1,6 @@\n import { Inject, Injectable } from '@angular/core';\n \n-import { scriptUrl, unwrapScriptUrlForSink } from 'safevalues';\n+import { trustedResourceUrl, unwrapResourceUrl } from 'safevalues';\n \n import { formatErrorEventForAnalytics } from './analytics-format-error';\n import { WindowToken } from '../shared/window';\n@@ -82,7 +82,7 @@ export class AnalyticsService {\n   private _installGlobalSiteTag() {\n     const window = this.window;\n     const url: TrustedScriptURL =\n-      scriptUrl`https://www.googletagmanager.com/gtag/js?id=${environment.googleAnalyticsId}`;\n+      trustedResourceUrl`https://www.googletagmanager.com/gtag/js?id=${environment.googleAnalyticsId}`;\n \n     // Note: This cannot be an arrow function as `gtag.js` expects an actual `Arguments`\n     // instance with e.g. `callee` to be set. Do not attempt to change this and keep this\n@@ -103,7 +103,7 @@ export class AnalyticsService {\n \n     const el = window.document.createElement('script');\n     el.async = true;\n-    el.src = unwrapScriptUrlForSink(url);\n+    el.src = unwrapResourceUrl(url) as string;\n     window.document.head.appendChild(el);\n   }\n \n\n---\n file path A: aio/src/app/shared/custom-icon-registry.spec.ts | file path B: aio/src/app/shared/custom-icon-registry.spec.ts\n\n@@ -2,7 +2,7 @@ import { HttpClient } from '@angular/common/http';\n import { ErrorHandler } from '@angular/core';\n import { MatIconRegistry } from '@angular/material/icon';\n import { DomSanitizer } from '@angular/platform-browser';\n-import { unwrapHtmlForSink } from 'safevalues';\n+import { unwrapHtml } from 'safevalues';\n import { concatHtmls } from 'safevalues/builders/html_builders';\n import { CustomIconRegistry, SvgIconInfo } from './custom-icon-registry';\n import { svg } from './security';\n@@ -69,6 +69,6 @@ describe('CustomIconRegistry', () => {\n \n function createSvg(svgSrc: TrustedHTML): SVGElement {\n   const div = document.createElement('div');\n-  div.innerHTML = unwrapHtmlForSink(svgSrc);\n+  div.innerHTML = unwrapHtml(svgSrc) as string;\n   return div.querySelector('svg') as SVGElement;\n }\n\n---\n file path A: aio/src/app/shared/custom-icon-registry.ts | file path B: aio/src/app/shared/custom-icon-registry.ts\n\n@@ -4,7 +4,7 @@ import { of } from 'rxjs';\n import { MatIconRegistry } from '@angular/material/icon';\n import { HttpClient } from '@angular/common/http';\n import { DomSanitizer } from '@angular/platform-browser';\n-import { unwrapHtmlForSink } from 'safevalues';\n+import { unwrapHtml } from 'safevalues';\n \n /**\n  * Use SVG_ICONS (and SvgIconInfo) as \"multi\" providers to provide the SVG source\n@@ -76,7 +76,7 @@ export class CustomIconRegistry extends MatIconRegistry {\n     const div = document.createElement('DIV');\n \n     // SECURITY: the source for the SVG icons is provided in code by trusted developers\n-    div.innerHTML = unwrapHtmlForSink(svgIcon.svgSource);\n+    div.innerHTML = unwrapHtml(svgIcon.svgSource) as string;\n \n     const svgElement = div.querySelector('svg') as SVGElement;\n     nsIconMap[svgIcon.name] = svgElement;\n\n---\n file path A: aio/src/app/shared/security.ts | file path B: aio/src/app/shared/security.ts\n\n@@ -1,17 +1,17 @@\n-import { htmlFromStringKnownToSatisfyTypeContract } from 'safevalues/unsafe/reviewed';\n+import { htmlSafeByReview } from 'safevalues/restricted/reviewed';\n \n export function fromInnerHTML(el: Element): TrustedHTML {\n   // SECURITY: Existing innerHTML content is already trusted.\n-  return htmlFromStringKnownToSatisfyTypeContract(el.innerHTML, '^');\n+  return htmlSafeByReview(el.innerHTML, '^');\n }\n \n export function fromOuterHTML(el: Element): TrustedHTML {\n   // SECURITY: Existing outerHTML content is already trusted.\n-  return htmlFromStringKnownToSatisfyTypeContract(el.outerHTML, '^');\n+  return htmlSafeByReview(el.outerHTML, '^');\n }\n \n export function svg(constantSvg: TemplateStringsArray): TrustedHTML {\n   // SECURITY: Template literal argument with no interpolation is constant, and\n   // hence trusted.\n-  return htmlFromStringKnownToSatisfyTypeContract(constantSvg[0], '^');\n+  return htmlSafeByReview(constantSvg[0], '^');\n }\n\n---\n file path A: aio/src/app/shared/toc.service.ts | file path B: aio/src/app/shared/toc.service.ts\n\n@@ -3,7 +3,7 @@ import { Inject, Injectable } from '@angular/core';\n import { DomSanitizer, SafeHtml } from '@angular/platform-browser';\n import { ReplaySubject } from 'rxjs';\n import { ScrollSpyInfo, ScrollSpyService } from 'app/shared/scroll-spy.service';\n-import { unwrapHtmlForSink } from 'safevalues';\n+import { unwrapHtml } from 'safevalues';\n import { fromInnerHTML } from './security';\n \n \n@@ -64,7 +64,7 @@ export class TocService {\n   //   - Mark the HTML as trusted to be used with `[innerHTML]`.\n   private extractHeadingSafeHtml(heading: HTMLHeadingElement) {\n     const div: HTMLDivElement = this.document.createElement('div');\n-    div.innerHTML = unwrapHtmlForSink(fromInnerHTML(heading));\n+    div.innerHTML = unwrapHtml(fromInnerHTML(heading)) as string;\n \n     // Remove any `.github-links` or `.header-link` elements (along with their content).\n     div.querySelectorAll('.github-links, .header-link').forEach(link => link.remove());\n\n---\n file path A: aio/src/testing/pretty-printer.service.ts | file path B: aio/src/testing/pretty-printer.service.ts\n\n@@ -4,15 +4,15 @@\n // scope.\n \n import { of } from 'rxjs';\n-import { unwrapHtmlForSink } from 'safevalues';\n-import { htmlFromStringKnownToSatisfyTypeContract } from 'safevalues/unsafe/reviewed';\n+import { unwrapHtml } from 'safevalues';\n+import { htmlSafeByReview } from 'safevalues/restricted/reviewed';\n \n export class MockPrettyPrinter {\n   formatCode(code: TrustedHTML, language?: string, linenums?: number | boolean) {\n     const linenumsStr = (linenums === undefined) ? '' : `, linenums: ${linenums}`;\n-    return of(htmlFromStringKnownToSatisfyTypeContract(\n+    return of(htmlSafeByReview(\n         `Formatted code (language: ${language || 'auto'}${linenumsStr}): ${\n-            unwrapHtmlForSink(code)}`,\n+          unwrapHtml(code)}`,\n         'safe transformation of existing TrustedHTML'));\n   }\n }\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -10630,10 +10630,10 @@ safeps@7.0.1:\n   resolved \"https://registry.yarnpkg.com/safer-buffer/-/safer-buffer-2.1.2.tgz#44fa161b0187b9549dd84bb91802f9bd8385cd6a\"\n   integrity sha512-YZo3K82SD7Riyi0E1EQPojLz7kpepnSQI9IyPbHHg1XXXevb5dJI7tpyN2ADxGcQbHG7vcyRHk0cbwqcQriUtg==\n \n-safevalues@^0.1.8:\n-  version \"0.1.8\"\n-  resolved \"https://registry.yarnpkg.com/safevalues/-/safevalues-0.1.8.tgz#a8ab0c060ed40409fdc3df3e9f749964bcba1a8a\"\n-  integrity sha512-pasLBJ7X5L98TWlcaNgycheJAPWCvTH18QP+UjlJLPBNzRhwgtPKaK4bIAxr3cX4l+zXg77WoBLH5pYuEwOEqQ==\n+safevalues@^0.3.1:\n+  version \"0.3.1\"\n+  resolved \"https://registry.yarnpkg.com/safevalues/-/safevalues-0.3.1.tgz#610a910290930ac5f25ba77055cb8a819b0a15a9\"\n+  integrity sha512-sp++LhKx0CiDw9QGrYSavXCxQRIoZUBsupt2NbucztV5cLpO3zzAwww+LZS8L3dgGU0f5/zw3hymq3ltrVebNA==\n \n sass-loader@13.0.2:\n   version \"13.0.2\"\n\n\n###\n\n", "completion": "refactor(docs-infra): update `safevalues` and account for API changes (#<issue-num>)"}
{"prompt": " file path A: packages/zone.js/lib/zone-spec/async-stack-tagging.ts | file path B: packages/zone.js/lib/zone-spec/async-stack-tagging.ts\n\n@@ -7,58 +7,44 @@\n  */\n \n interface Console {\n-  scheduleAsyncTask(name: string, recurring?: boolean): number;\n-  startAsyncTask(task: number): void;\n-  finishAsyncTask(task: number): void;\n-  cancelAsyncTask(task: number): void;\n+  createTask(name: string): ConsoleTask;\n+}\n+\n+interface ConsoleTask {\n+  run<T>(f: () => T): void;\n }\n \n interface Task {\n-  asyncId?: number;\n+  consoleTask?: ConsoleTask;\n }\n \n class AsyncStackTaggingZoneSpec implements ZoneSpec {\n-  scheduleAsyncTask: Console['scheduleAsyncTask'];\n-  startAsyncTask: Console['startAsyncTask'];\n-  finishAsyncTask: Console['finishAsyncTask'];\n-  cancelAsyncTask: Console['finishAsyncTask'];\n+  createTask: Console['createTask'];\n \n   constructor(namePrefix: string, consoleAsyncStackTaggingImpl: Console = console) {\n     this.name = 'asyncStackTagging for ' + namePrefix;\n-    this.scheduleAsyncTask = consoleAsyncStackTaggingImpl?.scheduleAsyncTask ?? (() => {});\n-    this.startAsyncTask = consoleAsyncStackTaggingImpl?.startAsyncTask ?? (() => {});\n-    this.finishAsyncTask = consoleAsyncStackTaggingImpl?.finishAsyncTask ?? (() => {});\n-    this.cancelAsyncTask = consoleAsyncStackTaggingImpl?.cancelAsyncTask ?? (() => {});\n+    this.createTask = consoleAsyncStackTaggingImpl?.createTask ?? (() => {});\n   }\n \n   // ZoneSpec implementation below.\n \n   name: string;\n \n-  onScheduleTask(delegate: ZoneDelegate, current: Zone, target: Zone, task: Task): Task {\n-    task.asyncId = this.scheduleAsyncTask(\n-        task.source || task.type, task.data?.isPeriodic || task.type === 'eventTask');\n+  onScheduleTask(delegate: ZoneDelegate, _current: Zone, target: Zone, task: Task): Task {\n+    task.consoleTask = this.createTask(`Zone - ${task.source || task.type}`);\n     return delegate.scheduleTask(target, task);\n   }\n \n   onInvokeTask(\n-      delegate: ZoneDelegate, currentZone: Zone, targetZone: Zone, task: Task, applyThis: any,\n+      delegate: ZoneDelegate, _currentZone: Zone, targetZone: Zone, task: Task, applyThis: any,\n       applyArgs?: any[]) {\n-    task.asyncId && this.startAsyncTask(task.asyncId);\n-    try {\n-      return delegate.invokeTask(targetZone, task, applyThis, applyArgs);\n-    } finally {\n-      task.asyncId && this.finishAsyncTask(task.asyncId);\n-      if (task.type !== 'eventTask' && !task.data?.isPeriodic) {\n-        task.asyncId = undefined;\n-      }\n+    let ret;\n+    if (task.consoleTask) {\n+      ret = task.consoleTask.run(() => delegate.invokeTask(targetZone, task, applyThis, applyArgs));\n+    } else {\n+      ret = delegate.invokeTask(targetZone, task, applyThis, applyArgs);\n     }\n-  }\n-\n-  onCancelTask(delegate: ZoneDelegate, currentZone: Zone, targetZone: Zone, task: Task) {\n-    task.asyncId && this.cancelAsyncTask(task.asyncId);\n-    task.asyncId = undefined;\n-    return delegate.cancelTask(targetZone, task);\n+    return ret;\n   }\n }\n \n\n---\n file path A: packages/zone.js/test/zone-spec/async-tagging-console.spec.ts | file path B: packages/zone.js/test/zone-spec/async-tagging-console.spec.ts\n\n@@ -12,51 +12,55 @@ describe('AsyncTaggingConsoleTest', () => {\n   const AsyncStackTaggingZoneSpec = (Zone as any)['AsyncStackTaggingZoneSpec'];\n \n   describe('should call console async stack tagging API', () => {\n-    let idx = 1;\n-    const scheduleAsyncTaskSpy = jasmine.createSpy('scheduleAsyncTask').and.callFake(() => {\n-      return idx++;\n-    });\n     const startAsyncTaskSpy = jasmine.createSpy('startAsyncTask');\n     const finishAsyncTaskSpy = jasmine.createSpy('finishAsyncTask');\n-    const cancelAsyncTaskSpy = jasmine.createSpy('cancelAsyncTask');\n+    const scheduleAsyncTaskSpy = jasmine.createSpy('scheduleAsyncTask').and.callFake(() => {\n+      return {\n+        run: (f: () => unknown) => {\n+          startAsyncTaskSpy();\n+          const retval = f();\n+          finishAsyncTaskSpy();\n+          return retval;\n+        },\n+      };\n+    });\n+\n     let asyncStackTaggingZone: Zone;\n \n     beforeEach(() => {\n       scheduleAsyncTaskSpy.calls.reset();\n       startAsyncTaskSpy.calls.reset();\n       finishAsyncTaskSpy.calls.reset();\n-      cancelAsyncTaskSpy.calls.reset();\n       asyncStackTaggingZone = Zone.current.fork(new AsyncStackTaggingZoneSpec('test', {\n-        scheduleAsyncTask: scheduleAsyncTaskSpy,\n-        startAsyncTask: startAsyncTaskSpy,\n-        finishAsyncTask: finishAsyncTaskSpy,\n-        cancelAsyncTask: cancelAsyncTaskSpy,\n+        createTask: scheduleAsyncTaskSpy,\n       }));\n     });\n+\n     it('setTimeout', (done: DoneFn) => {\n       asyncStackTaggingZone.run(() => {\n         setTimeout(() => {});\n       });\n       setTimeout(() => {\n-        expect(scheduleAsyncTaskSpy).toHaveBeenCalledWith('setTimeout', false);\n+        expect(scheduleAsyncTaskSpy).toHaveBeenCalledWith('Zone - setTimeout');\n         expect(startAsyncTaskSpy.calls.count()).toBe(1);\n         expect(finishAsyncTaskSpy.calls.count()).toBe(1);\n         done();\n       });\n     });\n+\n     it('clearTimeout', (done: DoneFn) => {\n       asyncStackTaggingZone.run(() => {\n         const id = setTimeout(() => {});\n         clearTimeout(id);\n       });\n       setTimeout(() => {\n-        expect(scheduleAsyncTaskSpy).toHaveBeenCalledWith('setTimeout', false);\n+        expect(scheduleAsyncTaskSpy).toHaveBeenCalledWith('Zone - setTimeout');\n         expect(startAsyncTaskSpy).not.toHaveBeenCalled();\n         expect(finishAsyncTaskSpy).not.toHaveBeenCalled();\n-        expect(cancelAsyncTaskSpy.calls.count()).toBe(1);\n         done();\n       });\n     });\n+\n     it('setInterval', (done: DoneFn) => {\n       asyncStackTaggingZone.run(() => {\n         let count = 0;\n@@ -68,19 +72,19 @@ describe('AsyncTaggingConsoleTest', () => {\n         }, 10);\n       });\n       setTimeout(() => {\n-        expect(scheduleAsyncTaskSpy).toHaveBeenCalledWith('setInterval', true);\n+        expect(scheduleAsyncTaskSpy).toHaveBeenCalledWith('Zone - setInterval');\n         expect(startAsyncTaskSpy.calls.count()).toBe(2);\n-        expect(finishAsyncTaskSpy.calls.count()).toBe(1);\n-        expect(cancelAsyncTaskSpy.calls.count()).toBe(1);\n+        expect(finishAsyncTaskSpy.calls.count()).toBe(2);\n         done();\n       }, 50);\n     });\n+\n     it('Promise', (done: DoneFn) => {\n       asyncStackTaggingZone.run(() => {\n         Promise.resolve(1).then(() => {});\n       });\n       setTimeout(() => {\n-        expect(scheduleAsyncTaskSpy).toHaveBeenCalledWith('Promise.then', false);\n+        expect(scheduleAsyncTaskSpy).toHaveBeenCalledWith('Zone - Promise.then');\n         expect(startAsyncTaskSpy.calls.count()).toBe(1);\n         expect(finishAsyncTaskSpy.calls.count()).toBe(1);\n         done();\n@@ -94,12 +98,10 @@ describe('AsyncTaggingConsoleTest', () => {\n              Zone.root.run(() => {\n                setTimeout(() => {\n                  expect(scheduleAsyncTaskSpy.calls.all()[0].args).toEqual([\n-                   'XMLHttpRequest.addEventListener:load',\n-                   true,\n+                   'Zone - XMLHttpRequest.addEventListener:load',\n                  ]);\n                  expect(scheduleAsyncTaskSpy.calls.all()[1].args).toEqual([\n-                   'XMLHttpRequest.send',\n-                   false,\n+                   'Zone - XMLHttpRequest.send',\n                  ]);\n                  expect(startAsyncTaskSpy.calls.count()).toBe(2);\n                  expect(finishAsyncTaskSpy.calls.count()).toBe(2);\n@@ -124,10 +126,9 @@ describe('AsyncTaggingConsoleTest', () => {\n            button.dispatchEvent(clickEvent);\n            button.removeEventListener('click', handler);\n            expect(scheduleAsyncTaskSpy)\n-               .toHaveBeenCalledWith('HTMLButtonElement.addEventListener:click', true);\n+               .toHaveBeenCalledWith('Zone - HTMLButtonElement.addEventListener:click');\n            expect(startAsyncTaskSpy.calls.count()).toBe(2);\n            expect(finishAsyncTaskSpy.calls.count()).toBe(2);\n-           expect(cancelAsyncTaskSpy.calls.count()).toBe(1);\n          });\n        }));\n   });\n\n\n###\n\n", "completion": "feat(zone.js): Update to the simpler Async Stack Tagging v2 API (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/platform-server/index.md | file path B: goldens/public-api/platform-server/index.md\n\n@@ -51,7 +51,7 @@ export class PlatformState {\n // @public\n export function renderApplication<T>(rootComponent: Type<T>, options: {\n     appId: string;\n-    document?: string;\n+    document?: string | Document;\n     url?: string;\n     providers?: Array<Provider | ImportedNgModuleProviders>;\n     platformProviders?: Provider[];\n@@ -59,7 +59,7 @@ export function renderApplication<T>(rootComponent: Type<T>, options: {\n \n // @public\n export function renderModule<T>(module: Type<T>, options: {\n-    document?: string;\n+    document?: string | Document;\n     url?: string;\n     extraProviders?: StaticProvider[];\n }): Promise<string>;\n\n---\n file path A: packages/platform-server/src/server.ts | file path B: packages/platform-server/src/server.ts\n\n@@ -81,9 +81,14 @@ export class ServerModule {\n }\n \n function _document(injector: Injector) {\n-  let config: PlatformConfig|null = injector.get(INITIAL_CONFIG, null);\n-  const document = config && config.document ? parseDocument(config.document, config.url) :\n-                                               getDOM().createHtmlDocument();\n+  const config: PlatformConfig|null = injector.get(INITIAL_CONFIG, null);\n+  let document: Document;\n+  if (config && config.document) {\n+    document = typeof config.document === 'string' ? parseDocument(config.document, config.url) :\n+                                                     config.document;\n+  } else {\n+    document = getDOM().createHtmlDocument();\n+  }\n   // Tell ivy about the global document\n   \u0275setDocument(document);\n   return document;\n\n---\n file path A: packages/platform-server/src/utils.ts | file path B: packages/platform-server/src/utils.ts\n\n@@ -16,7 +16,7 @@ import {BEFORE_APP_SERIALIZED, INITIAL_CONFIG} from './tokens';\n import {TRANSFER_STATE_SERIALIZATION_PROVIDERS} from './transfer_state';\n \n interface PlatformOptions {\n-  document?: string;\n+  document?: string|Document;\n   url?: string;\n   platformProviders?: Provider[];\n }\n@@ -95,14 +95,16 @@ the server-rendered app can be properly bootstrapped into a client app.`);\n /**\n  * Renders a Module to string.\n  *\n- * `document` is the full document HTML of the page to render, as a string.\n+ * `document` is the document of the page to render, either as an HTML string or\n+ *  as a reference to the `document` instance.\n  * `url` is the URL for the current render request.\n  * `extraProviders` are the platform level providers for the current render request.\n  *\n  * @publicApi\n  */\n export function renderModule<T>(\n-    module: Type<T>, options: {document?: string, url?: string, extraProviders?: StaticProvider[]}):\n+    module: Type<T>,\n+    options: {document?: string|Document, url?: string, extraProviders?: StaticProvider[]}):\n     Promise<string> {\n   const {document, url, extraProviders: platformProviders} = options;\n   const platform = _getPlatform(platformDynamicServer, {document, url, platformProviders});\n@@ -130,7 +132,8 @@ export function renderModule<T>(\n  *  - `appId` - a string identifier of this application. The appId is used to prefix all\n  *              server-generated stylings and state keys of the application in TransferState\n  *              use-cases.\n- *  - `document` - the full document HTML of the page to render, as a string.\n+ *  - `document` - the document of the page to render, either as an HTML string or\n+ *                 as a reference to the `document` instance.\n  *  - `url` - the URL for the current render request.\n  *  - `providers` - set of application level providers for the current render request.\n  *  - `platformProviders` - the platform level providers for the current render request.\n@@ -141,7 +144,7 @@ export function renderModule<T>(\n  */\n export function renderApplication<T>(rootComponent: Type<T>, options: {\n   appId: string,\n-  document?: string,\n+  document?: string|Document,\n   url?: string,\n   providers?: Array<Provider|ImportedNgModuleProviders>,\n   platformProviders?: Provider[],\n\n---\n file path A: packages/platform-server/test/integration_spec.ts | file path B: packages/platform-server/test/integration_spec.ts\n\n@@ -11,7 +11,7 @@ import {DOCUMENT, isPlatformServer, PlatformLocation, \u0275getDOM as getDOM} from '\n import {HTTP_INTERCEPTORS, HttpClient, HttpClientModule, HttpEvent, HttpHandler, HttpInterceptor, HttpRequest} from '@angular/common/http';\n import {HttpClientTestingModule, HttpTestingController} from '@angular/common/http/testing';\n import {ApplicationRef, CompilerFactory, Component, destroyPlatform, getPlatform, HostBinding, HostListener, importProvidersFrom, Inject, Injectable, Input, NgModule, NgZone, OnInit, PLATFORM_ID, PlatformRef, Type, ViewEncapsulation} from '@angular/core';\n-import {inject, waitForAsync} from '@angular/core/testing';\n+import {inject, TestBed, waitForAsync} from '@angular/core/testing';\n import {BrowserModule, makeStateKey, Title, TransferState} from '@angular/platform-browser';\n import {BEFORE_APP_SERIALIZED, INITIAL_CONFIG, platformDynamicServer, PlatformState, renderModule, renderModuleFactory, ServerModule, ServerTransferStateModule} from '@angular/platform-server';\n import {Observable} from 'rxjs';\n@@ -750,6 +750,38 @@ describe('platform-server integration', () => {\n            });\n          }));\n \n+      it(`using ${isStandalone ? 'renderApplication' : 'renderModule'} ` +\n+             `should allow passing a document reference`,\n+         waitForAsync(() => {\n+           const document = TestBed.inject(DOCUMENT);\n+\n+           // Append root element based on the app selector.\n+           const rootEl = document.createElement('app');\n+           document.body.appendChild(rootEl);\n+\n+           // Append a special marker to verify that we use a correct instance\n+           // of the document for rendering.\n+           const markerEl = document.createComment('test marker');\n+           document.body.appendChild(markerEl);\n+\n+           const options = {document};\n+           const bootstrap = isStandalone ?\n+               renderApplication(MyAsyncServerAppStandalone, {document, appId: 'simple-cmp'}) :\n+               renderModule(AsyncServerModule, options);\n+           bootstrap\n+               .then(output => {\n+                 expect(output).toBe(\n+                     '<html><head><title>fakeTitle</title></head>' +\n+                     '<body><app ng-version=\"0.0.0-PLACEHOLDER\">Works!<h1 textcontent=\"fine\">fine</h1></app>' +\n+                     '<!--test marker--></body></html>');\n+                 called = true;\n+               })\n+               .finally(() => {\n+                 rootEl.remove();\n+                 markerEl.remove();\n+               });\n+         }));\n+\n       it('works with SVG elements', waitForAsync(() => {\n            const options = {document: doc};\n            const bootstrap = isStandalone ?\n\n\n###\n\n", "completion": "feat(platform-server): support document reference in render functions (#<issue-num>)"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -158,10 +158,10 @@ cldr_xml_data_repository(\n # sass rules\n http_archive(\n     name = \"io_bazel_rules_sass\",\n-    sha256 = \"3e0e115f380227f7f186bcfce29b125e4a02536b6c309f80912ee0d6b79a6e71\",\n-    strip_prefix = \"rules_sass-030f696dcf32508b264c469f26d031f7996dea4c\",\n+    sha256 = \"fcd963afb0744685ee798f991942ff02196ae71ccbeedd8efaac17040dd99989\",\n+    strip_prefix = \"rules_sass-70ffe0181974c3195cdacb4ecbd8fed8e31b72fb\",\n     urls = [\n-        \"https://github.com/bazelbuild/rules_sass/archive/030f696dcf32508b264c469f26d031f7996dea4c.zip\",\n+        \"https://github.com/bazelbuild/rules_sass/archive/70ffe0181974c3195cdacb4ecbd8fed8e31b72fb.zip\",\n     ],\n )\n \n\n\n###\n\n", "completion": "build: update io_bazel_rules_sass digest to 70ffe01 (#<issue-num>)"}
{"prompt": " file path A: docs/DEVELOPER.md | file path B: docs/DEVELOPER.md\n\n@@ -22,7 +22,9 @@ Before you can build and test Angular, you must install and configure the\n following products on your development machine:\n \n * [Git](https://git-scm.com/) and/or the [**GitHub app**](https://desktop.github.com/) (for Mac and Windows);\n-  [GitHub's Guide to Installing Git](https://help.github.com/articles/set-up-git) is a good source of information.\n+  [GitHub's Guide to Installing Git](https://help.github.com/articles/set-up-git) is a good source of information.\\\n+  **Windows Users**: Git Bash or an equivalent shell is required\\\n+  *Windows Powershell and cmd shells are not supported [#46780](https://github.com/angular/angular/issues/46780) so some commands might fail*\n \n * [Node.js](https://nodejs.org), (version specified in the engines field of [`package.json`](../package.json)) which is used to run a development web server,\n   run tests, and generate distributable files.\n\n\n###\n\n", "completion": "docs: add yarn build fail workaround on windows (#<issue-num>)"}
{"prompt": " file path A: renovate.json | file path B: renovate.json\n\n@@ -91,7 +91,7 @@\n     {\n       \"matchPaths\": [\"aio/tools/examples/shared/*\"],\n       \"postUpgradeTasks\": {\n-        \"commands\": [\"yarn run sync-deps\"],\n+        \"commands\": [\"yarn --cwd=aio/tools/examples/shared run sync-deps\"],\n         \"fileFilters\": [\"aio/tools/examples/shared/boilerplate/**\"]\n       }\n     },\n\n\n###\n\n", "completion": "ci: fix Renovate post-upgrade task command (#<issue-num>)"}
{"prompt": " file path A: packages/compiler-cli/test/ngtsc/ngtsc_spec.ts | file path B: packages/compiler-cli/test/ngtsc/ngtsc_spec.ts\n\n@@ -6135,7 +6135,7 @@ function allTests(os: string) {\n         /**\n          * @fileoverview added by tsickle\n          * Generated from: test.ts\n-         * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n+         * @suppress {checkTypes,const,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode}\n          */\n       `;\n           expect(trim(jsContents).startsWith(trim(fileoverview))).toBeTruthy();\n@@ -6153,7 +6153,7 @@ function allTests(os: string) {\n         /**\n          * @fileoverview added by tsickle\n          * Generated from: test.ts\n-         * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n+         * @suppress {checkTypes,const,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode}\n          */\n       `;\n           expect(trim(jsContents).startsWith(trim(fileoverview))).toBeTruthy();\n@@ -6179,7 +6179,7 @@ function allTests(os: string) {\n         /**\n          * @fileoverview added by tsickle\n          * Generated from: test.ngfactory.ts\n-         * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n+         * @suppress {checkTypes,const,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode}\n          */\n       `;\n           expect(trim(jsContents).startsWith(trim(fileoverview))).toBeTruthy();\n@@ -6212,7 +6212,7 @@ function allTests(os: string) {\n          * Generated from: test.ts\n          * @modName {some_comp}\n          *\n-         * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n+         * @suppress {checkTypes,const,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode}\n          */\n       `;\n           expect(trim(jsContents).startsWith(trim(fileoverview))).toBeTruthy();\n@@ -6242,7 +6242,7 @@ function allTests(os: string) {\n          * Generated from: test.ts\n          * @modName {some_comp}\n          *\n-         * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n+         * @suppress {checkTypes,const,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode}\n          */\n       `;\n              expect(trim(jsContents).startsWith(trim(fileoverview))).toBeTruthy();\n\n\n###\n\n", "completion": "test: update ngtsc closure fileoverview tests to reflect suppression updates (#<issue-num>)"}
{"prompt": " file path A: tools/postinstall-patches.js | file path B: tools/postinstall-patches.js\n\n@@ -139,6 +139,10 @@ for (const [fileName, patches] of ngDevPatches.entries()) {\n   }\n }\n \n+// TODO: Remove when https://github.com/bazelbuild/rules_nodejs/pull/3517 is available.\n+sed('-i', 'private rootDirsRelative;', 'rootDirsRelative(fileName: string): string;',\n+    'node_modules/@bazel/concatjs/internal/tsc_wrapped/compiler_host.d.ts');\n+\n log('\\n# patch: delete d.ts files referring to rxjs-compat');\n // more info in https://github.com/angular/angular/pull/33786\n rm('-rf', [\n\n\n###\n\n", "completion": "build: temporarily patch `@bazel/concatjs` to unblock `tsickle` update (#<issue-num>)"}
{"prompt": " file path A: package.json | file path B: package.json\n\n@@ -169,7 +169,7 @@\n     \"tmp\": \"0.2.1\",\n     \"todomvc-app-css\": \"^2.3.0\",\n     \"todomvc-common\": \"^1.0.5\",\n-    \"tsickle\": \"0.38.1\",\n+    \"tsickle\": \"0.46.3\",\n     \"tslib\": \"^2.3.0\",\n     \"tslint\": \"6.1.3\",\n     \"typescript\": \"~4.7.2\",\n\n---\n file path A: packages/bazel/package.json | file path B: packages/bazel/package.json\n\n@@ -24,7 +24,7 @@\n   \"dependencies\": {\n     \"@microsoft/api-extractor\": \"^7.24.2\",\n     \"shelljs\": \"^0.8.5\",\n-    \"tsickle\": \"^0.38.0\",\n+    \"tsickle\": \"^0.46.3\",\n     \"tslib\": \"^2.3.0\"\n   },\n   \"peerDependencies\": {\n\n---\n file path A: packages/compiler-cli/src/main.ts | file path B: packages/compiler-cli/src/main.ts\n\n@@ -104,7 +104,8 @@ function createEmitCallback(\n       TsickleHost,\n       'shouldSkipTsickleProcessing'|'pathToModuleName'|'shouldIgnoreWarningsForPath'|\n       'fileNameToModuleId'|'googmodule'|'untyped'|'convertIndexImportShorthand'|\n-      'transformDecorators'|'transformTypesToClosure'> = {\n+      'transformDecorators'|'transformTypesToClosure'|'generateExtraSuppressions'|\n+      'rootDirsRelative'> = {\n     shouldSkipTsickleProcessing: (fileName) => /\\.d\\.ts$/.test(fileName) ||\n         // View Engine's generated files were never intended to be processed with tsickle.\n         (!options.enableIvy && GENERATED_FILES.test(fileName)),\n@@ -118,6 +119,11 @@ function createEmitCallback(\n     // conflicts, we disable decorator transformations for tsickle.\n     transformDecorators: false,\n     transformTypesToClosure: true,\n+    generateExtraSuppressions: true,\n+    // Only used by the http://go/tsjs-migration-independent-javascript-imports migration in\n+    // tsickle. This migration is not relevant externally and is only enabled when users\n+    // would explicitly invoke `goog.tsMigrationExportsShim` (which is internal-only).\n+    rootDirsRelative: (fileName) => fileName,\n   };\n \n   return ({\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -2717,7 +2717,7 @@\n   resolved \"https://registry.yarnpkg.com/@types/minimatch/-/minimatch-3.0.5.tgz#1001cc5e6a3704b83c236027e77f2f58ea010f40\"\n   integrity sha512-Klz949h02Gz2uZCMGwDUSDS1YBlTdDDgbWHi+81l29tQALUtvz4rAYi5uoVhE5Lagoq6DeqAUlbrHvW/mXDgdQ==\n \n-\"@types/minimist@^1.2.0\":\n+\"@types/minimist@^1.2.0\", \"@types/minimist@^1.2.1\":\n   version \"1.2.2\"\n   resolved \"https://registry.yarnpkg.com/@types/minimist/-/minimist-1.2.2.tgz#ee771e2ba4b3dc5b372935d549fd9617bf345b8c\"\n   integrity sha512-jhuKLIRrhvCPLqwPcx6INqmKeiA5EWrsCOPhrlFSrbrmU4ZMPjj5Ul/oLCMDO98XRUIwVm78xICz4EPCektzeQ==\n@@ -14633,10 +14633,12 @@ tsec@0.2.5:\n     glob \"^7.1.1\"\n     minimatch \"^3.0.3\"\n \n-tsickle@0.38.1:\n-  version \"0.38.1\"\n-  resolved \"https://registry.yarnpkg.com/tsickle/-/tsickle-0.38.1.tgz#30762db759d40c435943093b6972c7f2efb384ef\"\n-  integrity sha512-4xZfvC6+etRu6ivKCNqMOd1FqcY/m6JY3Y+yr5+Xw+i751ciwrWINi6x/3l1ekcODH9GZhlf0ny2LpzWxnjWYA==\n+tsickle@0.46.3:\n+  version \"0.46.3\"\n+  resolved \"https://registry.yarnpkg.com/tsickle/-/tsickle-0.46.3.tgz#b74918a77e3ca1310a2ce4d019f5d6294360b56d\"\n+  integrity sha512-9PDXxOrtn2AdpvDin6FLGveXVGg8ec3ga8fh8mPR5lz9KtitW6riVgxgagicdfF1rgiBxDeH+5hVowPXhmZbYQ==\n+  dependencies:\n+    \"@types/minimist\" \"^1.2.1\"\n \n tslib@1.9.0:\n   version \"1.9.0\"\n\n\n###\n\n", "completion": "feat(compiler-cli): support more recent version of `tsickle` (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/event-binding.md | file path B: aio/content/guide/event-binding.md\n\n@@ -61,6 +61,26 @@ Angular also supports passive event listeners. For example, use the following st\n \n After those steps, if you add event listeners for the `scroll` event, the listeners will be `passive`.\n \n+## Binding to keyboard events\n+\n+You can bind to keyboard events using Angular's binding syntax. You can specify the key or code that you would like to bind to keyboard events. They `key` and `code` fields are a native part of the browser keyboard event object. By default, event binding assumes you want to use the `key` field on the keyboard event. You can also use the `code` field.\n+\n+Combinations of keys can be separated by a `.` (period). For example, `keydown.enter` will allow you to bind events to the `enter` key. You can also use modifier keys, such as `shift`, `alt`, `control`, and the `command` keys from Mac. The following example shows how to bind a keyboard event to `keydown.shift.t`.\n+\n+   ```typescript\n+   <input (keydown.shift.t)=\"onKeydown($event)\" />\n+   ```\n+\n+Depending on the operating system, some key combinations might create special characters instead of the key combination that you expect. MacOS, for example, creates special characters when you use the option and shift keys together. If you bind to `keydown.shift.alt.t`, on MacOS, that combination produces a `\u02c7` character instead of a `t`, which doesn't match the binding and won't trigger your event handler. To bind to `keydown.shift.alt.t` on MacOS, use the `code` keyboard event field to get the correct behavior, such as `keydown.code.shiftleft.altleft.keyt` shown in this example.\n+   \n+   ```typescript\n+   <input (keydown.code.shiftleft.altleft.keyt)=\"onKeydown($event)\" />\n+   ```\n+\n+The `code` field is more specific than the `key` field. The `key` field always reports `shift`, whereas the `code` field will specify `leftshift` or `rightshift`. When using the `code` field, you might need to add separate bindings to catch all the behaviors you want. Using the `code` field avoids the need to handle OS specific behaviors such as the `shift + option` behavior on MacOS.\n+\n+For more information, visit the full reference for [key](https://developer.mozilla.org/en-US/docs/Web/API/UI_Events/Keyboard_event_key_values) and [code](https://developer.mozilla.org/en-US/docs/Web/API/UI_Events/Keyboard_event_code_values) to help build out your event strings.\n+\n ## What's next\n \n * For more information on how event binding works, see [How event binding works](guide/event-binding-concepts).\n\n\n###\n\n", "completion": "docs(core): Add docs for keyboard event binding (#<issue-num>)"}
{"prompt": " file path A: aio/tools/doc-linter/README.md | file path B: aio/tools/doc-linter/README.md\n\n@@ -21,7 +21,7 @@ While Vale helps, it doesn't replace the reviewers that you're currently using t\n 1.  [Install Vale][AioToolsDocLinterReadmeInstallValeInYourVsCodeIde] in your Visual Studio Code IDE.\n     To install and use Vale in a different IDE, see [Installation][ValeDocsValeCliInstallation].\n 2.  Fix the problems that Vale identifies in your IDE.\n- \n+\n Log any problem you encounter with the documentation linter as a [new docs issue][GithubAngularAngularIssuesNewAssigneesLabelsTemplate3DocsBugYaml] in the repo.\n Be sure to specify that this is a linter issue in your description.\n \n@@ -117,7 +117,7 @@ When necessary, you can apply these exceptions to your content.\n     A *style exception* allows you to exclude text from an individual style test.\n \n     To apply a style exception, surround the text that you do not want the linter to test with these HTML\n-    `comment` elements. Between these comments, the linter ignores the style test in the comment, but \n+    `comment` elements. Between these comments, the linter ignores the style test in the comment, but\n     still tests for all other styles that are in use.\n \n     ```markdown\n@@ -161,11 +161,11 @@ For more information, or to install Vale in another IDE or on another operating\n \n Before you proceed, make sure that:\n \n-1.  You have cloned the [`angular/angular` repo][GithubAngularAngular] on your system. You can work in a fork of the `angular/angular` repo, \n+1.  You have cloned the [`angular/angular` repo][GithubAngularAngular] on your system. You can work in a fork of the `angular/angular` repo,\n     but it's easier if your Vale installation uses an up-to-date clone of the `angular/angular` repo.\n 2.  You have a development or writing environment for `angular.io` in the `angular/angular` repo and you can build the `angular.io` docs.\n     For information about how to create the authoring environment for `angular.io`, see [Angular documentation project][GithubAngularAngularTreeMainAioAngularDocumentationProjectHttpsangulario].\n-3.  You have the required package manager installed on your system. If not, install it before continuing. \n+3.  You have the required package manager installed on your system. If not, install it before continuing.\n     * [homebrew][BrewMain] on your macOS system.\n     * [chocolatey][Chocolatey] on your Windows system.\n \n@@ -246,18 +246,37 @@ To install Vale in a different IDE, see [Installation][ValeDocsValeCliInstallati\n     *   On Windows, in the **File** menu, choose **Preferences**, and then choose **Settings**.\n 4.  In the **User** settings, navigate to  **Extensions > Vale**.\n 5.  Update the Vale extension settings as shown.\n-    *   **Vale > Core : Use CLI**, checked.\n-    *   **Vale > Server : Lint Context**, `0`.\n-    *   **Vale > Server : Provide Fixes**, unchecked.\n-    *   **Vale > Server : Server URL**, leave empty.\n-    *   **Vale > Vale CLI : Config**, enter the full path to `vale.ini` from the preceding procedure and append the `vale.ini` filename.\n-    *   **Vale > Vale CLI : Min Alert Level**, choose `inherited` or `suggestion`.\n-    *   **Vale > Vale CLI  : Path**, enter the full path of the `vale` application that `which vale` or `where vale.exe` returned in a preceding step.\n+    *   **Vale : Config**, enter the full path to `vale.ini` from the preceding procedure and append the `vale.ini` filename.\n+    *   **Vale : Min Alert Level**, choose `inherited` or `suggestion`.\n+    *   **Vale : Path**, enter the full path of the `vale` application that `which vale` or `where vale.exe` returned in a preceding step.\n 6.  Restart Visual Studio Code to apply the new settings.\n \n <!-- vale Angular.Angular_CliReference = YES -->\n <!-- vale Angular.WriteGood_Illusions = YES -->\n \n+### Known issues with the Visual Studio Code extension\n+\n+If you're having problems with the `0.15.0` version of the Vale extension to Visual Studio Code, try:\n+\n+1. Uninstalling version `0.15.0` of the Vale extension.\n+2. Installing version `0.14.2` of the Vale extension.\n+\n+If you're using version `0.14.2`, the Vale extension settings to use are:\n+\n+<!-- vale Angular.WriteGood_Illusions = NO -->\n+<!-- vale Angular.Angular_CliReference = NO -->\n+\n+*   **Vale > Core : Use CLI**, checked.\n+*   **Vale > Server : Lint Context**, `0`.\n+*   **Vale > Server : Provide Fixes**, unchecked.\n+*   **Vale > Server : Server URL**, leave empty.\n+*   **Vale > Vale CLI : Config**, enter the full path to `vale.ini` from the preceding procedure and append the `vale.ini` filename.\n+*   **Vale > Vale CLI : Min Alert Level**, choose `inherited` or `suggestion`.\n+*   **Vale > Vale CLI  : Path**, enter the full path of the `vale` application that `which vale` or `where vale.exe` returned in a preceding step.\n+\n+<!-- vale Angular.Angular_CliReference = YES -->\n+<!-- vale Angular.WriteGood_Illusions = YES -->\n+\n ## Update the Vale command-line tool\n \n * To update Vale on macOS to the latest version, in your command-line tool, run `brew upgrade vale`.\n@@ -300,5 +319,4 @@ If you're using another branch or fork of the `angular/angular` repo, be sure to\n \n <!-- end links -->\n \n-<!-- @reviewed 2022-07-15 -->\n-\n+<!-- @reviewed 2022-07-15 -->\n\\ No newline at end of file\n\n\n###\n\n", "completion": "docs: update Vale installation instructions (#<issue-num>)"}
{"prompt": " file path A: aio/tools/transforms/angular-api-package/processors/processNgModuleDocs.js | file path B: aio/tools/transforms/angular-api-package/processors/processNgModuleDocs.js\n\n@@ -38,7 +38,7 @@ module.exports = function processNgModuleDocs(getDocFromAlias, createDocMessage,\n      * `NgModule` doc.\n      */\n     processNgModuleExportDoc(exportDoc, errors) {\n-      const options = exportDoc[`${exportDoc.docType}Options`];\n+      const options = exportDoc[`${exportDoc.docType}Options`] || {};\n \n       // Directives without a selector are considered abstract and do not need to be part of\n       // any `@NgModule`.\n@@ -47,9 +47,15 @@ module.exports = function processNgModuleDocs(getDocFromAlias, createDocMessage,\n       }\n \n       if (!exportDoc.ngModules || exportDoc.ngModules.length === 0) {\n-        errors.push(createDocMessage(\n-          `\"${exportDoc.id}\" has no @ngModule tag. Docs of type \"${exportDoc.docType}\" must have this tag.`,\n-          exportDoc));\n+        // Trigger an error for non-standalone components/pipes/directives only.\n+        // Standalone types may not be a part of an NgModule, in which case\n+        // we just exit this function without throwing an error.\n+        if (!options.standalone) {\n+          errors.push(createDocMessage(\n+              `\"${exportDoc.id}\" has no @ngModule tag. Docs of type \"${\n+                  exportDoc.docType}\" must have this tag.`,\n+              exportDoc));\n+        }\n         return;\n       }\n \n@@ -73,8 +79,8 @@ module.exports = function processNgModuleDocs(getDocFromAlias, createDocMessage,\n       if (Array.isArray(injectableDoc.ngModules)) {\n         for (const ngModule of injectableDoc.ngModules) {\n           if (isWrappedInQuotes(ngModule)) {\n-            // `ngModule` is wrapped in quotes, so it will be one of `'any'`, `'root'` or `'platform'`\n-            // and is not associated with a specific NgModule. So just use the string.\n+            // `ngModule` is wrapped in quotes, so it will be one of `'any'`, `'root'` or\n+            // `'platform'` and is not associated with a specific NgModule. So just use the string.\n             ngModules.push(ngModule.slice(1, -1));\n             continue;\n           }\n@@ -103,7 +109,9 @@ module.exports = function processNgModuleDocs(getDocFromAlias, createDocMessage,\n         const providedInProp = properties?.find(prop => prop.name.text === 'providedIn');\n         const providedInNode = providedInProp?.initializer;\n         if (providedInNode) {\n-          const providedIn = providedInNode.getSourceFile().text.slice(providedInNode.pos, providedInNode.end).trim();\n+          const providedIn = providedInNode.getSourceFile()\n+                                 .text.slice(providedInNode.pos, providedInNode.end)\n+                                 .trim();\n           this.processProvidedIn(providedIn, injectableDoc, ngModules, errors);\n         }\n       }\n@@ -181,7 +189,6 @@ module.exports = function processNgModuleDocs(getDocFromAlias, createDocMessage,\n       if (providers.length > 0) {\n         ngModuleDoc.providers = providers;\n       }\n-\n     }\n   };\n \n@@ -190,14 +197,15 @@ module.exports = function processNgModuleDocs(getDocFromAlias, createDocMessage,\n \n     if (ngModuleDocs.length === 0) {\n       errors.push(\n-        createDocMessage(`The referenced \"${ngModuleId}\" does not match a public NgModule`, doc));\n+          createDocMessage(`The referenced \"${ngModuleId}\" does not match a public NgModule`, doc));\n       return null;\n     }\n \n     if (ngModuleDocs.length > 1) {\n       errors.push(createDocMessage(\n-        `The referenced \"${ngModuleId}\" is ambiguous. Matches: ${ngModuleDocs.map(d => d.id).join(', ')}`,\n-        doc));\n+          `The referenced \"${ngModuleId}\" is ambiguous. Matches: ${\n+              ngModuleDocs.map(d => d.id).join(', ')}`,\n+          doc));\n       return null;\n     }\n \n\n---\n file path A: aio/tools/transforms/angular-api-package/processors/processNgModuleDocs.spec.js | file path B: aio/tools/transforms/angular-api-package/processors/processNgModuleDocs.spec.js\n\n@@ -228,6 +228,18 @@ describe('processNgModuleDocs processor', () => {\n       '\"Pipe1\" has no @ngModule tag. Docs of type \"pipe\" must have this tag. - doc \"Pipe1\" (pipe) ');\n   });\n \n+  it('should not error if a standalone pipe/directive does not have an `@ngModule` tag', () => {\n+    expect(() => {\n+      processor.$process([{\n+        docType: 'directive', id: 'Directive1',\n+        directiveOptions: { selector: 'dir1', standalone: true }\n+      }]);\n+    }).not.toThrow();\n+    expect(() => {\n+      processor.$process([{ docType: 'pipe', id: 'Pipe1', pipeOptions: { standalone: true } }]);\n+    }).not.toThrow();\n+  });\n+\n   it('should error if a pipe/directive has an @ngModule tag that does not match an NgModule doc', () => {\n     const log = injector.get('log');\n     expect(() => {\n@@ -292,4 +304,5 @@ function createSymbolWithProvider(providedIn) {\n   const exportMap = new Map();\n   exportMap.set('\u0275prov', { valueDeclaration });\n   return { exports: exportMap };\n-}\n\\ No newline at end of file\n+}\n+\n\n\n###\n\n", "completion": "fix(docs-infra): do  not require `@ngModule` tag on standalone types (#<issue-num>)"}
{"prompt": " file path A: CHANGELOG.md | file path B: CHANGELOG.md\n\n@@ -1,3 +1,19 @@\n+<a name=\"14.1.1\"></a>\n+# 14.1.1 (2022-08-03)\n+### core\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [3606917732](https://github.com/angular/angular/commit/3606917732e5ad887426c1cbccf6e375eff905d6) | fix | improve the missing control flow directive message ([#46903](https://github.com/angular/angular/pull/46903)) |\n+### router\n+| Commit | Type | Description |\n+| -- | -- | -- |\n+| [79825d3f10](https://github.com/angular/angular/commit/79825d3f1078c9b91eeb5e4699718ccde6c458b5) | fix | Do not call preload method when not necessary ([#47007](https://github.com/angular/angular/pull/47007)) |\n+| [05f3f7445a](https://github.com/angular/angular/commit/05f3f7445a0bbe3c7ffed3aec308ca8888e77d99) | fix | Use correct return type for provideRoutes function ([#46941](https://github.com/angular/angular/pull/46941)) |\n+## Special Thanks\n+Alan Agius, Andrew Kushnir, Andrew Quinn, Andrew Scott, Aristeidis Bampakos, Asaf M, Bob Watson, C\u00e9dric Exbrayat, Durairaj Subramaniam, George Kalpakas, Ivaylo Kirov, J Rob Gant, Kristiyan Kostadinov, Marek H\u00e1m, Paul Gschwendtner, Roman Matusevich and Simona Cotin\n+\n+<!-- CHANGELOG SPLIT MARKER -->\n+\n <a name=\"14.1.0\"></a>\n # 14.1.0 (2022-07-20)\n ## Deprecations\n\n\n###\n\n", "completion": "docs: release notes for the v14.1.1 release"}
{"prompt": " file path A: aio/content/errors/NG0203.md | file path B: aio/content/errors/NG0203.md\n\n@@ -1,9 +1,10 @@\n @name `inject()` must be called from an injection context\n @category runtime\n-@shortDescription `inject()` must be called from an injection context (a constructor, a factory function or a field initializer)\n+@shortDescription `inject()` must be called from an injection context such as a constructor, a factory function, a field initializer, or a function used with `EnvironmentInjector#runInContext`.\n \n @description\n-You see this error when you try to use the `inject()` function outside of the allowed injection context. The injection context is available during the class creation and initialization. \n+You see this error when you try to use the `inject()` function outside of the allowed injection context. The injection context is available during the class creation and initialization. It is also available to functions\n+used with `EnvironmentInjector#runInContext`.\n \n In practice the `inject()` calls are allowed in a constructor, a constructor parameter and a field initializer:\n \n@@ -34,7 +35,7 @@ providers: [\n ]\n ```\n \n-Calls to the `inject()` function outside of the class creation context will result in error. Most notably, calls to `inject()` are disallowed after a class instance was created, in methods (including lifecycle hooks):\n+Calls to the `inject()` function outside of the class creation or `runInContext` will result in error. Most notably, calls to `inject()` are disallowed after a class instance was created, in methods (including lifecycle hooks):\n \n ```typescript\n @Component({ ... })\n\n---\n file path A: packages/core/src/di/injector_compatibility.ts | file path B: packages/core/src/di/injector_compatibility.ts\n\n@@ -57,7 +57,7 @@ export function injectInjectorOnly<T>(token: ProviderToken<T>, flags = InjectFla\n     throw new RuntimeError(\n         RuntimeErrorCode.MISSING_INJECTION_CONTEXT,\n         ngDevMode &&\n-            `inject() must be called from an injection context (a constructor, a factory function or a field initializer)`);\n+            `inject() must be called from an injection context such as a constructor, a factory function, a field initializer, or a function used with \\`EnvironmentInjector#runInContext\\`.`);\n   } else if (_currentInjector === null) {\n     return injectRootLimpMode(token, undefined, flags);\n   } else {\n\n\n###\n\n", "completion": "docs(core): Update inject error documentation (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -119,8 +119,8 @@\n     \"@types/node\": \"^12.7.9\",\n     \"@types/trusted-types\": \"^2.0.2\",\n     \"@types/xregexp\": \"^4.3.0\",\n-    \"@typescript-eslint/eslint-plugin\": \"5.31.0\",\n-    \"@typescript-eslint/parser\": \"5.31.0\",\n+    \"@typescript-eslint/eslint-plugin\": \"5.32.0\",\n+    \"@typescript-eslint/parser\": \"5.32.0\",\n     \"@yarnpkg/lockfile\": \"^1.1.0\",\n     \"archiver\": \"^5.3.0\",\n     \"assert\": \"^2.0.0\",\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -2175,14 +2175,14 @@\n   dependencies:\n     \"@types/node\" \"*\"\n \n-\"@typescript-eslint/eslint-plugin@5.31.0\":\n-  version \"5.31.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/eslint-plugin/-/eslint-plugin-5.31.0.tgz#cae1967b1e569e6171bbc6bec2afa4e0c8efccfe\"\n-  integrity sha512-VKW4JPHzG5yhYQrQ1AzXgVgX8ZAJEvCz0QI6mLRX4tf7rnFfh5D8SKm0Pq6w5PyNfAWJk6sv313+nEt3ohWMBQ==\n-  dependencies:\n-    \"@typescript-eslint/scope-manager\" \"5.31.0\"\n-    \"@typescript-eslint/type-utils\" \"5.31.0\"\n-    \"@typescript-eslint/utils\" \"5.31.0\"\n+\"@typescript-eslint/eslint-plugin@5.32.0\":\n+  version \"5.32.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/eslint-plugin/-/eslint-plugin-5.32.0.tgz#e27e38cffa4a61226327c874a7be965e9a861624\"\n+  integrity sha512-CHLuz5Uz7bHP2WgVlvoZGhf0BvFakBJKAD/43Ty0emn4wXWv5k01ND0C0fHcl/Im8Td2y/7h44E9pca9qAu2ew==\n+  dependencies:\n+    \"@typescript-eslint/scope-manager\" \"5.32.0\"\n+    \"@typescript-eslint/type-utils\" \"5.32.0\"\n+    \"@typescript-eslint/utils\" \"5.32.0\"\n     debug \"^4.3.4\"\n     functional-red-black-tree \"^1.0.1\"\n     ignore \"^5.2.0\"\n@@ -2190,14 +2190,14 @@\n     semver \"^7.3.7\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/parser@5.31.0\":\n-  version \"5.31.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/parser/-/parser-5.31.0.tgz#7f42d7dcc68a0a6d80a0f3d9a65063aee7bb8d2c\"\n-  integrity sha512-UStjQiZ9OFTFReTrN+iGrC6O/ko9LVDhreEK5S3edmXgR396JGq7CoX2TWIptqt/ESzU2iRKXAHfSF2WJFcWHw==\n+\"@typescript-eslint/parser@5.32.0\":\n+  version \"5.32.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/parser/-/parser-5.32.0.tgz#1de243443bc6186fb153b9e395b842e46877ca5d\"\n+  integrity sha512-IxRtsehdGV9GFQ35IGm5oKKR2OGcazUoiNBxhRV160iF9FoyuXxjY+rIqs1gfnd+4eL98OjeGnMpE7RF/NBb3A==\n   dependencies:\n-    \"@typescript-eslint/scope-manager\" \"5.31.0\"\n-    \"@typescript-eslint/types\" \"5.31.0\"\n-    \"@typescript-eslint/typescript-estree\" \"5.31.0\"\n+    \"@typescript-eslint/scope-manager\" \"5.32.0\"\n+    \"@typescript-eslint/types\" \"5.32.0\"\n+    \"@typescript-eslint/typescript-estree\" \"5.32.0\"\n     debug \"^4.3.4\"\n \n \"@typescript-eslint/scope-manager@5.29.0\":\n@@ -2208,20 +2208,20 @@\n     \"@typescript-eslint/types\" \"5.29.0\"\n     \"@typescript-eslint/visitor-keys\" \"5.29.0\"\n \n-\"@typescript-eslint/scope-manager@5.31.0\":\n-  version \"5.31.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/scope-manager/-/scope-manager-5.31.0.tgz#f47a794ba84d9b818ab7f8f44fff55a61016c606\"\n-  integrity sha512-8jfEzBYDBG88rcXFxajdVavGxb5/XKXyvWgvD8Qix3EEJLCFIdVloJw+r9ww0wbyNLOTYyBsR+4ALNGdlalLLg==\n+\"@typescript-eslint/scope-manager@5.32.0\":\n+  version \"5.32.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/scope-manager/-/scope-manager-5.32.0.tgz#763386e963a8def470580cc36cf9228864190b95\"\n+  integrity sha512-KyAE+tUON0D7tNz92p1uetRqVJiiAkeluvwvZOqBmW9z2XApmk5WSMV9FrzOroAcVxJZB3GfUwVKr98Dr/OjOg==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.31.0\"\n-    \"@typescript-eslint/visitor-keys\" \"5.31.0\"\n+    \"@typescript-eslint/types\" \"5.32.0\"\n+    \"@typescript-eslint/visitor-keys\" \"5.32.0\"\n \n-\"@typescript-eslint/type-utils@5.31.0\":\n-  version \"5.31.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/type-utils/-/type-utils-5.31.0.tgz#70a0b7201360b5adbddb0c36080495aa08f6f3d9\"\n-  integrity sha512-7ZYqFbvEvYXFn9ax02GsPcEOmuWNg+14HIf4q+oUuLnMbpJ6eHAivCg7tZMVwzrIuzX3QCeAOqKoyMZCv5xe+w==\n+\"@typescript-eslint/type-utils@5.32.0\":\n+  version \"5.32.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/type-utils/-/type-utils-5.32.0.tgz#45a14506fe3fb908600b4cef2f70778f7b5cdc79\"\n+  integrity sha512-0gSsIhFDduBz3QcHJIp3qRCvVYbqzHg8D6bHFsDMrm0rURYDj+skBK2zmYebdCp+4nrd9VWd13egvhYFJj/wZg==\n   dependencies:\n-    \"@typescript-eslint/utils\" \"5.31.0\"\n+    \"@typescript-eslint/utils\" \"5.32.0\"\n     debug \"^4.3.4\"\n     tsutils \"^3.21.0\"\n \n@@ -2230,10 +2230,10 @@\n   resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.29.0.tgz#7861d3d288c031703b2d97bc113696b4d8c19aab\"\n   integrity sha512-X99VbqvAXOMdVyfFmksMy3u8p8yoRGITgU1joBJPzeYa0rhdf5ok9S56/itRoUSh99fiDoMtarSIJXo7H/SnOg==\n \n-\"@typescript-eslint/types@5.31.0\":\n-  version \"5.31.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.31.0.tgz#7aa389122b64b18e473c1672fb3b8310e5f07a9a\"\n-  integrity sha512-/f/rMaEseux+I4wmR6mfpM2wvtNZb1p9hAV77hWfuKc3pmaANp5dLAZSiE3/8oXTYTt3uV9KW5yZKJsMievp6g==\n+\"@typescript-eslint/types@5.32.0\":\n+  version \"5.32.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.32.0.tgz#484273021eeeae87ddb288f39586ef5efeb6dcd8\"\n+  integrity sha512-EBUKs68DOcT/EjGfzywp+f8wG9Zw6gj6BjWu7KV/IYllqKJFPlZlLSYw/PTvVyiRw50t6wVbgv4p9uE2h6sZrQ==\n \n \"@typescript-eslint/typescript-estree@5.29.0\":\n   version \"5.29.0\"\n@@ -2248,13 +2248,13 @@\n     semver \"^7.3.7\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/typescript-estree@5.31.0\":\n-  version \"5.31.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/typescript-estree/-/typescript-estree-5.31.0.tgz#eb92970c9d6e3946690d50c346fb9b1d745ee882\"\n-  integrity sha512-3S625TMcARX71wBc2qubHaoUwMEn+l9TCsaIzYI/ET31Xm2c9YQ+zhGgpydjorwQO9pLfR/6peTzS/0G3J/hDw==\n+\"@typescript-eslint/typescript-estree@5.32.0\":\n+  version \"5.32.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/typescript-estree/-/typescript-estree-5.32.0.tgz#282943f34babf07a4afa7b0ff347a8e7b6030d12\"\n+  integrity sha512-ZVAUkvPk3ITGtCLU5J4atCw9RTxK+SRc6hXqLtllC2sGSeMFWN+YwbiJR9CFrSFJ3w4SJfcWtDwNb/DmUIHdhg==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.31.0\"\n-    \"@typescript-eslint/visitor-keys\" \"5.31.0\"\n+    \"@typescript-eslint/types\" \"5.32.0\"\n+    \"@typescript-eslint/visitor-keys\" \"5.32.0\"\n     debug \"^4.3.4\"\n     globby \"^11.1.0\"\n     is-glob \"^4.0.3\"\n@@ -2273,15 +2273,15 @@\n     eslint-scope \"^5.1.1\"\n     eslint-utils \"^3.0.0\"\n \n-\"@typescript-eslint/utils@5.31.0\":\n-  version \"5.31.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/utils/-/utils-5.31.0.tgz#e146fa00dca948bfe547d665b2138a2dc1b79acd\"\n-  integrity sha512-kcVPdQS6VIpVTQ7QnGNKMFtdJdvnStkqS5LeALr4rcwx11G6OWb2HB17NMPnlRHvaZP38hL9iK8DdE9Fne7NYg==\n+\"@typescript-eslint/utils@5.32.0\":\n+  version \"5.32.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/utils/-/utils-5.32.0.tgz#eccb6b672b94516f1afc6508d05173c45924840c\"\n+  integrity sha512-W7lYIAI5Zlc5K082dGR27Fczjb3Q57ECcXefKU/f0ajM5ToM0P+N9NmJWip8GmGu/g6QISNT+K6KYB+iSHjXCQ==\n   dependencies:\n     \"@types/json-schema\" \"^7.0.9\"\n-    \"@typescript-eslint/scope-manager\" \"5.31.0\"\n-    \"@typescript-eslint/types\" \"5.31.0\"\n-    \"@typescript-eslint/typescript-estree\" \"5.31.0\"\n+    \"@typescript-eslint/scope-manager\" \"5.32.0\"\n+    \"@typescript-eslint/types\" \"5.32.0\"\n+    \"@typescript-eslint/typescript-estree\" \"5.32.0\"\n     eslint-scope \"^5.1.1\"\n     eslint-utils \"^3.0.0\"\n \n@@ -2293,12 +2293,12 @@\n     \"@typescript-eslint/types\" \"5.29.0\"\n     eslint-visitor-keys \"^3.3.0\"\n \n-\"@typescript-eslint/visitor-keys@5.31.0\":\n-  version \"5.31.0\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/visitor-keys/-/visitor-keys-5.31.0.tgz#b0eca264df01ce85dceb76aebff3784629258f54\"\n-  integrity sha512-ZK0jVxSjS4gnPirpVjXHz7mgdOsZUHzNYSfTw2yPa3agfbt9YfqaBiBZFSSxeBWnpWkzCxTfUpnzA3Vily/CSg==\n+\"@typescript-eslint/visitor-keys@5.32.0\":\n+  version \"5.32.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/visitor-keys/-/visitor-keys-5.32.0.tgz#b9715d0b11fdb5dd10fd0c42ff13987470525394\"\n+  integrity sha512-S54xOHZgfThiZ38/ZGTgB2rqx51CMJ5MCfVT2IplK4Q7hgzGfe0nLzLCcenDnc/cSjP568hdeKfeDcBgqNHD/g==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.31.0\"\n+    \"@typescript-eslint/types\" \"5.32.0\"\n     eslint-visitor-keys \"^3.3.0\"\n \n \"@webassemblyjs/ast@1.11.1\":\n\n\n###\n\n", "completion": "build: update eslint dependencies to v5.32.0 (#<issue-num>)"}
{"prompt": " file path A: aio/tools/examples/shared/package.json | file path B: aio/tools/examples/shared/package.json\n\n@@ -7,7 +7,7 @@\n     \"http-server\": \"http-server\",\n     \"protractor\": \"protractor\",\n     \"webdriver:update\": \"node ../../../../scripts/webdriver-manager-update.js\",\n-    \"postinstall\": \"yarn webdriver:update\",\n+    \"postinstall\": \"yarn sync-deps && yarn webdriver:update\",\n     \"sync-deps\": \"node sync-boilerplate-dependencies\"\n   },\n   \"//engines-comment\": \"Keep this in sync with /package.json and /aio/package.json\",\n\n---\n file path A: aio/tools/examples/shared/sync-boilerplate-dependencies.js | file path B: aio/tools/examples/shared/sync-boilerplate-dependencies.js\n\n@@ -9,6 +9,16 @@\n  * Updates the dependency versions of the top-level `package.json` files in each sub-folder of\n  * `./boilerplate/` to match the ones in `./package.json`.\n  */\n+\n+// !!! WARNING !!!\n+//\n+// This script is run as a [post-upgrade Renovate task][1]. Therefore, it needs to be able to run\n+// even when dependencies are not installed (i.e. only rely on Node.js built-in modules).\n+// See [here][2] for more info on why dependencies may not have been installed.\n+//\n+// [1]: https://docs.renovatebot.com/configuration-options/#postupgradetasks\n+// [2]: https://docs.renovatebot.com/self-hosted-configuration/#skipinstalls\n+\n const fs = require('fs');\n const path = require('path');\n \n\n---\n file path A: renovate.json | file path B: renovate.json\n\n@@ -88,6 +88,14 @@\n       \"groupSlug\": \"scorecard-action\"\n     },\n \n+    {\n+      \"matchPaths\": [\"aio/tools/examples/shared/*\"],\n+      \"postUpgradeTasks\": {\n+        \"commands\": [\"yarn run sync-deps\"],\n+        \"fileFilters\": [\"aio/tools/examples/shared/boilerplate/**\"]\n+      }\n+    },\n+\n     {\"matchCurrentVersion\": \"0.0.0-PLACEHOLDER\", \"enabled\": false},\n \n     {\"matchPaths\": [\"integration/**\"], \"enabled\": false},\n\n\n###\n\n", "completion": "build(docs-infra): ensure all boilerplate dependencies are in sync (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/router-tutorial-toh.md | file path B: aio/content/guide/router-tutorial-toh.md\n\n@@ -2382,12 +2382,12 @@ Currently, the `AdminModule` does not preload because `CanLoad` is blocking it.\n \n <a id=\"preload-canload\"></a>\n \n-#### `CanLoad` blocks preload\n+#### `CanLoad` blocks preload of children\n \n The `PreloadAllModules` strategy does not load feature areas protected by a [CanLoad](#can-load-guard) guard.\n \n You added a `CanLoad` guard to the route in the `AdminModule` a few steps back to block loading of that module until the user is authorized.\n-That `CanLoad` guard takes precedence over the preload strategy.\n+That `CanLoad` guard takes precedence over the preload strategy for loading children routes.\n \n If you want to preload a module as well as guard against unauthorized access, remove the `canLoad()` guard method and rely on the [canActivate()](#can-activate-guard) guard alone.\n \n\n---\n file path A: packages/router/src/router_preloader.ts | file path B: packages/router/src/router_preloader.ts\n\n@@ -110,7 +110,15 @@ export class RouterPreloader implements OnDestroy {\n       const injectorForCurrentRoute = route._injector ?? injector;\n       const injectorForChildren = route._loadedInjector ?? injectorForCurrentRoute;\n \n-      if ((route.loadChildren && !route._loadedRoutes) ||\n+      // Note that `canLoad` is only checked as a condition that prevents `loadChildren` and not\n+      // `loadComponent`. `canLoad` guards only block loading of child routes by design. This\n+      // happens as a consequence of needing to descend into children for route matching immediately\n+      // while component loading is deferred until route activation. Because `canLoad` guards can\n+      // have side effects, we cannot execute them here so we instead skip preloading altogether\n+      // when present. Lastly, it remains to be decided whether `canLoad` should behave this way\n+      // at all. Code splitting and lazy loading is separate from client-side authorization checks\n+      // and should not be used as a security measure to prevent loading of code.\n+      if ((route.loadChildren && !route._loadedRoutes && route.canLoad === undefined) ||\n           (route.loadComponent && !route._loadedComponent)) {\n         res.push(this.preloadConfig(injectorForCurrentRoute, route));\n       } else if (route.children || route._loadedRoutes) {\n\n---\n file path A: packages/router/test/router_preloader.spec.ts | file path B: packages/router/test/router_preloader.spec.ts\n\n@@ -39,7 +39,7 @@ describe('RouterPreloader', () => {\n     });\n   });\n \n-  describe('should not load configurations with canLoad guard', () => {\n+  describe('configurations with canLoad guard', () => {\n     @NgModule({\n       declarations: [LazyLoadedCmp],\n       imports: [RouterModule.forChild([{path: 'LoadedModule1', component: LazyLoadedCmp}])]\n@@ -56,7 +56,7 @@ describe('RouterPreloader', () => {\n     });\n \n \n-    it('should work',\n+    it('should not load children',\n        fakeAsync(inject([RouterPreloader, Router], (preloader: RouterPreloader, router: Router) => {\n          preloader.preload().subscribe(() => {});\n \n@@ -65,6 +65,17 @@ describe('RouterPreloader', () => {\n          const c = router.config;\n          expect((c[0] as any)._loadedConfig).not.toBeDefined();\n        })));\n+\n+    it('should not call the preloading method because children will not be loaded anyways',\n+       fakeAsync(() => {\n+         const preloader = TestBed.inject(RouterPreloader);\n+         const preloadingStrategy = TestBed.inject(PreloadingStrategy);\n+         spyOn(preloadingStrategy, 'preload').and.callThrough();\n+         preloader.preload().subscribe(() => {});\n+\n+         tick();\n+         expect(preloadingStrategy.preload).not.toHaveBeenCalled();\n+       }));\n   });\n \n   describe('should preload configurations', () => {\n\n\n###\n\n", "completion": "fix(router): Do not call preload method when not necessary (#<issue-num>)"}
{"prompt": " file path A: packages/common/src/location/location_strategy.ts | file path B: packages/common/src/location/location_strategy.ts\n\n@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Inject, Injectable, InjectionToken, OnDestroy, Optional, \u0275\u0275inject} from '@angular/core';\n+import {Inject, inject, Injectable, InjectionToken, OnDestroy, Optional} from '@angular/core';\n \n import {DOCUMENT} from '../dom_tokens';\n \n@@ -30,7 +30,7 @@ import {joinWithSlash, normalizeQueryParams} from './util';\n  *\n  * @publicApi\n  */\n-@Injectable({providedIn: 'root', useFactory: provideLocationStrategy})\n+@Injectable({providedIn: 'root', useFactory: () => inject(PathLocationStrategy)})\n export abstract class LocationStrategy {\n   abstract path(includeHash?: boolean): string;\n   abstract prepareExternalUrl(internal: string): string;\n@@ -46,14 +46,6 @@ export abstract class LocationStrategy {\n   abstract getBaseHref(): string;\n }\n \n-export function provideLocationStrategy() {\n-  // See #23917\n-  const location = \u0275\u0275inject(DOCUMENT).location;\n-  return new PathLocationStrategy(\n-      \u0275\u0275inject(PlatformLocation as any), location && location.origin || '');\n-}\n-\n-\n /**\n  * A predefined [DI token](guide/glossary#di-token) for the base href\n  * to be used with the `PathLocationStrategy`.\n@@ -86,8 +78,8 @@ export const APP_BASE_HREF = new InjectionToken<string>('appBaseHref');\n  * [path](https://en.wikipedia.org/wiki/Uniform_Resource_Locator#Syntax) of the\n  * browser's URL.\n  *\n- * If you're using `PathLocationStrategy`, you must provide a {@link APP_BASE_HREF}\n- * or add a `<base href>` element to the document.\n+ * If you're using `PathLocationStrategy`, you may provide a {@link APP_BASE_HREF}\n+ * or add a `<base href>` element to the document to override the default.\n  *\n  * For instance, if you provide an `APP_BASE_HREF` of `'/my/app/'` and call\n  * `location.go('/foo')`, the browser's URL will become\n@@ -110,7 +102,7 @@ export const APP_BASE_HREF = new InjectionToken<string>('appBaseHref');\n  *\n  * @publicApi\n  */\n-@Injectable()\n+@Injectable({providedIn: 'root'})\n export class PathLocationStrategy extends LocationStrategy implements OnDestroy {\n   private _baseHref: string;\n   private _removeListenerFns: (() => void)[] = [];\n@@ -120,16 +112,8 @@ export class PathLocationStrategy extends LocationStrategy implements OnDestroy\n       @Optional() @Inject(APP_BASE_HREF) href?: string) {\n     super();\n \n-    if (href == null) {\n-      href = this._platformLocation.getBaseHrefFromDOM();\n-    }\n-\n-    if (href == null) {\n-      throw new Error(\n-          `No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.`);\n-    }\n-\n-    this._baseHref = href;\n+    this._baseHref = href ?? this._platformLocation.getBaseHrefFromDOM() ??\n+        inject(DOCUMENT).location?.origin ?? '';\n   }\n \n   /** @nodoc */\n\n\n###\n\n", "completion": "refactor(common): Align PathLocationStrategy constructor with default factory (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/pipes-overview.md | file path B: aio/content/guide/pipes-overview.md\n\n@@ -9,7 +9,7 @@ For example, you would use a pipe to show a date as **April 15, 1988** rather th\n \n <div class=\"alert is-helpful\">\n \n-For the sample application used in this topic, see the <live-example></live-example>.\n+For the sample application used in this topic, see the <live-example name=\"pipes\"></live-example>.\n \n </div>\n \n\n\n###\n\n", "completion": "docs: fix link to live example (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/router.md | file path B: aio/content/guide/router.md\n\n@@ -463,7 +463,7 @@ The link parameters array affords the flexibility to represent any routing depth\n \n When the router navigates to a new component view, it updates the browser's location and history with a URL for that view.\n \n-Modern HTML5 browsers support [history.pushState](https://developer.mozilla.org/docs/Web/API/History_API/Working_with_the_History_API#adding_and_modifying_history_entries title=\"HTML5 browser history push-state\"), a technique that changes a browser's location and history without triggering a server page request.\n+Modern HTML5 browsers support [history.pushState](https://developer.mozilla.org/docs/Web/API/History_API/Working_with_the_History_API#adding_and_modifying_history_entries \"HTML5 browser history push-state\"), a technique that changes a browser's location and history without triggering a server page request.\n The router can compose a \"natural\" URL that is indistinguishable from one that would otherwise require a page load.\n \n Here's the Crisis Center URL in this \"HTML5 pushState\" style:\n\n\n###\n\n", "completion": "docs: fix link in routing (#<issue-num>)"}
{"prompt": " file path A: package.json | file path B: package.json\n\n@@ -68,14 +68,14 @@\n     \"@babel/template\": \"7.18.6\",\n     \"@babel/traverse\": \"7.18.9\",\n     \"@babel/types\": \"7.18.9\",\n-    \"@bazel/concatjs\": \"5.5.2\",\n-    \"@bazel/esbuild\": \"5.5.2\",\n-    \"@bazel/jasmine\": \"5.5.2\",\n-    \"@bazel/protractor\": \"5.5.2\",\n-    \"@bazel/rollup\": \"5.5.2\",\n-    \"@bazel/runfiles\": \"5.5.2\",\n-    \"@bazel/terser\": \"5.5.2\",\n-    \"@bazel/worker\": \"5.5.2\",\n+    \"@bazel/concatjs\": \"5.5.3\",\n+    \"@bazel/esbuild\": \"5.5.3\",\n+    \"@bazel/jasmine\": \"5.5.3\",\n+    \"@bazel/protractor\": \"5.5.3\",\n+    \"@bazel/rollup\": \"5.5.3\",\n+    \"@bazel/runfiles\": \"5.5.3\",\n+    \"@bazel/terser\": \"5.5.3\",\n+    \"@bazel/worker\": \"5.5.3\",\n     \"@microsoft/api-extractor\": \"^7.24.2\",\n     \"@rollup/plugin-babel\": \"^5.3.0\",\n     \"@rollup/plugin-commonjs\": \"^22.0.0\",\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -1592,20 +1592,34 @@\n     source-map-support \"0.5.9\"\n     tsutils \"3.21.0\"\n \n+\"@bazel/concatjs@5.5.3\":\n+  version \"5.5.3\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/concatjs/-/concatjs-5.5.3.tgz#5d5704db97d0014f700dbbd77ef4a4b3666ce865\"\n+  integrity sha512-YR8agkKikd/1pzFM9re5AFeFY6o8QA/C22RzVAYnZaKd7YMf19L7NchKKYwPTiDTy6lLhPqWMliYijR8RZ9ECA==\n+  dependencies:\n+    protobufjs \"6.8.8\"\n+    source-map-support \"0.5.9\"\n+    tsutils \"3.21.0\"\n+\n \"@bazel/esbuild@5.5.2\":\n   version \"5.5.2\"\n   resolved \"https://registry.yarnpkg.com/@bazel/esbuild/-/esbuild-5.5.2.tgz#598b75ffcb28972c5b0eb04c26db486fc001156b\"\n   integrity sha512-vSDnBOjydzwutg8rC97ftPDQmdhig8ya/IhsvsaoZdV0WbfNmqECCxri/7RH9e4PU7cb6YzBL/MCBNmwwTHLVg==\n \n+\"@bazel/esbuild@5.5.3\":\n+  version \"5.5.3\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/esbuild/-/esbuild-5.5.3.tgz#2172ecad5f5729d5d71c34a836b28cd081f84e6d\"\n+  integrity sha512-A+mVZfJsnTYc4dvrmGy/Sxu4pt2jvJFRFONP+ngve4qont3K1xK3LF3C6uOEFk4lMNoykUptr7/bvhGRr/j9Vw==\n+\n \"@bazel/ibazel@^0.16.0\":\n   version \"0.16.2\"\n   resolved \"https://registry.yarnpkg.com/@bazel/ibazel/-/ibazel-0.16.2.tgz#05dd7f06659759fda30f87b15534f1e42f1201bb\"\n   integrity sha512-KgqAWMH0emL6f3xH6nqyTryoBMqlJ627LBIe9PT1PRRQPz2FtHib3FIHJPukp1slzF3hJYZvdiVwgPnHbaSOOA==\n \n-\"@bazel/jasmine@5.5.2\":\n-  version \"5.5.2\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/jasmine/-/jasmine-5.5.2.tgz#559a1c4962f0a5165e446effb055fd332840eef0\"\n-  integrity sha512-aUCH6omW0lNxeWaX+lVuJy5sDcfRFAGs84hhBCZpARzwMbYxbwCGBxwo/nh48BojsCG+TwdlGlwTrF4gdpqgEQ==\n+\"@bazel/jasmine@5.5.3\":\n+  version \"5.5.3\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/jasmine/-/jasmine-5.5.3.tgz#90aa34218287ce1cc79e08274f4aa63460a4a1b2\"\n+  integrity sha512-dEgppnYPPot9c5EudnsaMKQHi8Su7rpKO5ENXWOqRxwuGCm1TvkyDvJghUbxpq9TpFqn7L39mJ+LB7IPYNF9TQ==\n   dependencies:\n     c8 \"~7.5.0\"\n     jasmine-reporters \"~2.5.0\"\n@@ -1615,23 +1629,38 @@\n   resolved \"https://registry.yarnpkg.com/@bazel/protractor/-/protractor-5.5.2.tgz#268779e51788d62026f0701afd830ec2308c9fc2\"\n   integrity sha512-RZI1y0mCNO6ffLRTZRQ7q+h/2knuJBZN/de1yQDCkhUlS/8qYM6sO3EAh5pTKZTkF80BaVwFJsr2aFxfE71Vtg==\n \n-\"@bazel/rollup@5.5.2\":\n-  version \"5.5.2\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/rollup/-/rollup-5.5.2.tgz#a34e81d090fbe3e8f5ac076dc83002fabe1319bf\"\n-  integrity sha512-O68tZjrkbxzYopAjWFz6r1aGnmg6CWeJpJ/A5wBRFV0zhiThSfwFZ/h8uG++c6tBYUDjgnWNg1qAsFqxQnXK5Q==\n+\"@bazel/protractor@5.5.3\":\n+  version \"5.5.3\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/protractor/-/protractor-5.5.3.tgz#1c30b4b063b7c65809907ef8d08c0fa455449f9b\"\n+  integrity sha512-VvZ/WOVoZxuuMm+4ZQwDgY+Hl8ptcyteje9hORsrukhHOuTjYdxPfejtTRBdYi26dMggxx8mqaM4UzFD/XR/yA==\n+\n+\"@bazel/rollup@5.5.3\":\n+  version \"5.5.3\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/rollup/-/rollup-5.5.3.tgz#f4e5a3101b7acd6fe5a448c1456c91a3b6c2a840\"\n+  integrity sha512-1P4DDNLBWLrKwNhS+1bp3Odrg8bhFGxDiq9/hfeezRnIuvc8o2ZTyCYbbUN2bN8cjH5hAfAOXvoq73cmE33ahQ==\n   dependencies:\n-    \"@bazel/worker\" \"5.5.2\"\n+    \"@bazel/worker\" \"5.5.3\"\n \n \"@bazel/runfiles@5.5.2\":\n   version \"5.5.2\"\n   resolved \"https://registry.yarnpkg.com/@bazel/runfiles/-/runfiles-5.5.2.tgz#6dfa59c8f7f291daea6a416a095140375e6a3392\"\n   integrity sha512-VOAg+UOwzzchmHb9uVUzIQII0baeTTLxbPgwbkugqO0IVsoS8g2ELUlwulZfKCsGiueI4hkaibq6eCAhqANlkA==\n \n+\"@bazel/runfiles@5.5.3\":\n+  version \"5.5.3\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/runfiles/-/runfiles-5.5.3.tgz#da394adc895f694e3075ba292009163c28b1ee7d\"\n+  integrity sha512-c/2vCJvcmNYhbcqwBrQPV3BSxCIETXCzuMsqEXgudOK5EL70/DtqSOQN1veJW/KUBoMljcxM7DN4gvWEItA2Dg==\n+\n \"@bazel/terser@5.5.2\":\n   version \"5.5.2\"\n   resolved \"https://registry.yarnpkg.com/@bazel/terser/-/terser-5.5.2.tgz#59878ad6e8ecb4dd3d709f3e0a0ace173eff4105\"\n   integrity sha512-uLvk+YaoK6W77P2DoTPpdWpPYaOp9b5x0GBUPhHE4AZSRnfwJE61DG1L+dmAUCCmCKW54ycfLe3GFMPsrcMBkQ==\n \n+\"@bazel/terser@5.5.3\":\n+  version \"5.5.3\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/terser/-/terser-5.5.3.tgz#d8471bb2b2c2f81f31a13545c17090fb7de78208\"\n+  integrity sha512-4QNPwlGJk+fdL4gLIdMPB72XfKPbcvcWmnDBGvRB6TfdTXRt3+78AdZD5Q6Cw9U6Ov67sHRCXqtybWQnTCxF9g==\n+\n \"@bazel/typescript@5.5.2\":\n   version \"5.5.2\"\n   resolved \"https://registry.yarnpkg.com/@bazel/typescript/-/typescript-5.5.2.tgz#dc7464577a99e4586e9a26c4be6f6c7e898d738f\"\n@@ -1649,6 +1678,13 @@\n   dependencies:\n     google-protobuf \"^3.6.1\"\n \n+\"@bazel/worker@5.5.3\":\n+  version \"5.5.3\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/worker/-/worker-5.5.3.tgz#3c23135a4e9d6c8ef05f1de85bc3c0c30df2ad38\"\n+  integrity sha512-Wm0istBBko5w2ddDwCK4rvDQrWfeFGaWdG3iTNkYAHKfQrkgYeMucMoAbFB6LZ87KZKuBEN9KSDq+fi8MXtGlw==\n+  dependencies:\n+    google-protobuf \"^3.6.1\"\n+\n \"@bcoe/v8-coverage@^0.2.3\":\n   version \"0.2.3\"\n   resolved \"https://registry.yarnpkg.com/@bcoe/v8-coverage/-/v8-coverage-0.2.3.tgz#75a2e8b51cb758a7553d6804a5932d7aace75c39\"\n\n\n###\n\n", "completion": "build: update bazel setup to v5.5.3 (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/common/index.md | file path B: goldens/public-api/common/index.md\n\n@@ -403,7 +403,7 @@ export class NgClass implements DoCheck {\n     // (undocumented)\n     set ngClass(value: string | string[] | Set<string> | {\n         [klass: string]: any;\n-    });\n+    } | null | undefined);\n     // (undocumented)\n     ngDoCheck(): void;\n     // (undocumented)\n\n---\n file path A: packages/common/src/directives/ng_class.ts | file path B: packages/common/src/directives/ng_class.ts\n\n@@ -61,7 +61,7 @@ export class NgClass implements DoCheck {\n   }\n \n   @Input('ngClass')\n-  set ngClass(value: string|string[]|Set<string>|{[klass: string]: any}) {\n+  set ngClass(value: string|string[]|Set<string>|{[klass: string]: any}|null|undefined) {\n     this._removeClasses(this._rawClass);\n     this._applyClasses(this._initialClasses);\n \n\n---\n file path A: packages/common/test/directives/ng_class_spec.ts | file path B: packages/common/test/directives/ng_class_spec.ts\n\n@@ -115,6 +115,17 @@ import {ComponentFixture, TestBed, waitForAsync} from '@angular/core/testing';\n            detectChangesAndExpectClassName('bar');\n          }));\n \n+      it('should remove active classes when expression evaluates to undefined', waitForAsync(() => {\n+           fixture = createTestComponent('<div [ngClass]=\"objExpr\"></div>');\n+\n+           detectChangesAndExpectClassName('foo');\n+\n+           getComponent().objExpr = undefined;\n+           detectChangesAndExpectClassName('');\n+\n+           getComponent().objExpr = {'foo': false, 'bar': true};\n+           detectChangesAndExpectClassName('bar');\n+         }));\n \n       it('should allow multiple classes per expression', waitForAsync(() => {\n            fixture = createTestComponent('<div [ngClass]=\"objExpr\"></div>');\n@@ -246,6 +257,15 @@ import {ComponentFixture, TestBed, waitForAsync} from '@angular/core/testing';\n            detectChangesAndExpectClassName('');\n          }));\n \n+      it('should remove active classes when switching from string to undefined',\n+         waitForAsync(() => {\n+           fixture = createTestComponent(`<div [ngClass]=\"strExpr\"></div>`);\n+           detectChangesAndExpectClassName('foo');\n+\n+           getComponent().strExpr = undefined;\n+           detectChangesAndExpectClassName('');\n+         }));\n+\n       it('should take initial classes into account when switching from string to null',\n          waitForAsync(() => {\n            fixture = createTestComponent(`<div class=\"foo\" [ngClass]=\"strExpr\"></div>`);\n@@ -255,6 +275,15 @@ import {ComponentFixture, TestBed, waitForAsync} from '@angular/core/testing';\n            detectChangesAndExpectClassName('foo');\n          }));\n \n+      it('should take initial classes into account when switching from string to undefined',\n+         waitForAsync(() => {\n+           fixture = createTestComponent(`<div class=\"foo\" [ngClass]=\"strExpr\"></div>`);\n+           detectChangesAndExpectClassName('foo');\n+\n+           getComponent().strExpr = undefined;\n+           detectChangesAndExpectClassName('foo');\n+         }));\n+\n       it('should ignore empty and blank strings', waitForAsync(() => {\n            fixture = createTestComponent(`<div class=\"foo\" [ngClass]=\"strExpr\"></div>`);\n            getComponent().strExpr = '';\n@@ -275,6 +304,9 @@ import {ComponentFixture, TestBed, waitForAsync} from '@angular/core/testing';\n \n            getComponent().objExpr = null;\n            detectChangesAndExpectClassName('init foo');\n+\n+           getComponent().objExpr = undefined;\n+           detectChangesAndExpectClassName('init foo');\n          }));\n \n       it('should co-operate with the interpolated class attribute', waitForAsync(() => {\n@@ -289,6 +321,9 @@ import {ComponentFixture, TestBed, waitForAsync} from '@angular/core/testing';\n \n            getComponent().objExpr = null;\n            detectChangesAndExpectClassName(`init foo`);\n+\n+           getComponent().objExpr = undefined;\n+           detectChangesAndExpectClassName(`init foo`);\n          }));\n \n       it('should co-operate with the interpolated class attribute when interpolation changes',\n@@ -315,6 +350,9 @@ import {ComponentFixture, TestBed, waitForAsync} from '@angular/core/testing';\n \n            getComponent().objExpr = null;\n            detectChangesAndExpectClassName(`init foo`);\n+\n+           getComponent().objExpr = undefined;\n+           detectChangesAndExpectClassName(`init foo`);\n          }));\n \n       it('should co-operate with the class attribute and class.name binding', waitForAsync(() => {\n@@ -351,6 +389,9 @@ import {ComponentFixture, TestBed, waitForAsync} from '@angular/core/testing';\n \n            cmp.objExpr = null;\n            detectChangesAndExpectClassName('init baz');\n+\n+           cmp.objExpr = undefined;\n+           detectChangesAndExpectClassName('init baz');\n          }));\n     });\n \n@@ -419,8 +460,8 @@ class TestComponent {\n   items: any[]|undefined;\n   arrExpr: string[] = ['foo'];\n   setExpr: Set<string> = new Set<string>();\n-  objExpr: {[klass: string]: any}|null = {'foo': true, 'bar': false};\n-  strExpr: string|null = 'foo';\n+  objExpr: {[klass: string]: any}|null|undefined = {'foo': true, 'bar': false};\n+  strExpr: string|null|undefined = 'foo';\n \n   constructor() {\n     this.setExpr.add('foo');\n\n\n###\n\n", "completion": "fix(common): allow null/undefined to be passed to ngClass input (#<issue-num>) (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -492,7 +492,7 @@ export abstract class PreloadingStrategy {\n export const PRIMARY_OUTLET = \"primary\";\n \n // @public\n-export function provideRoutes(routes: Routes): any;\n+export function provideRoutes(routes: Routes): Provider[];\n \n // @public\n export type QueryParamsHandling = 'merge' | 'preserve' | '';\n\n---\n file path A: packages/router/src/router_module.ts | file path B: packages/router/src/router_module.ts\n\n@@ -202,7 +202,7 @@ export function provideForRootGuard(router: Router): any {\n  *\n  * @publicApi\n  */\n-export function provideRoutes(routes: Routes): any {\n+export function provideRoutes(routes: Routes): Provider[] {\n   return [\n     {provide: ROUTES, multi: true, useValue: routes},\n   ];\n@@ -249,7 +249,7 @@ function provideInitialNavigation(config: Pick<ExtraOptions, 'initialNavigation'\n   ];\n }\n \n-function provideRouterInitializer(): ReadonlyArray<Provider> {\n+function provideRouterInitializer(): Provider[] {\n   return [\n     // ROUTER_INITIALIZER token should be removed. It's public API but shouldn't be. We can just\n     // have `getBootstrapListener` directly attached to APP_BOOTSTRAP_LISTENER.\n\n\n###\n\n", "completion": "fix(router): Use correct return type for provideRoutes function (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/router/index.md | file path B: goldens/public-api/router/index.md\n\n@@ -210,6 +210,9 @@ export class DefaultTitleStrategy extends TitleStrategy {\n     static \u0275prov: i0.\u0275\u0275InjectableDeclaration<DefaultTitleStrategy>;\n }\n \n+// @public\n+export function defaultUrlMatcher(segments: UrlSegment[], segmentGroup: UrlSegmentGroup, route: Route): UrlMatchResult | null;\n+\n // @public\n export class DefaultUrlSerializer implements UrlSerializer {\n     parse(url: string): UrlTree;\n\n---\n file path A: packages/router/src/index.ts | file path B: packages/router/src/index.ts\n\n@@ -22,7 +22,7 @@ export {provideRoutes, ROUTER_INITIALIZER, RouterModule} from './router_module';\n export {ChildrenOutletContexts, OutletContext} from './router_outlet_context';\n export {NoPreloading, PreloadAllModules, PreloadingStrategy, RouterPreloader} from './router_preloader';\n export {ActivatedRoute, ActivatedRouteSnapshot, RouterState, RouterStateSnapshot} from './router_state';\n-export {convertToParamMap, ParamMap, Params, PRIMARY_OUTLET} from './shared';\n+export {convertToParamMap, defaultUrlMatcher, ParamMap, Params, PRIMARY_OUTLET} from './shared';\n export {UrlHandlingStrategy} from './url_handling_strategy';\n export {DefaultUrlSerializer, IsActiveMatchOptions, UrlSegment, UrlSegmentGroup, UrlSerializer, UrlTree} from './url_tree';\n export {VERSION} from './version';\n\n---\n file path A: packages/router/src/shared.ts | file path B: packages/router/src/shared.ts\n\n@@ -118,7 +118,21 @@ export function convertToParamMap(params: Params): ParamMap {\n   return new ParamsAsMap(params);\n }\n \n-// Matches the route configuration (`route`) against the actual URL (`segments`).\n+/**\n+ * Matches the route configuration (`route`) against the actual URL (`segments`).\n+ *\n+ * When no matcher is defined on a `Route`, this is the matcher used by the Router by default.\n+ *\n+ * @param segments The remaining unmatched segments in the current navigation\n+ * @param segmentGroup The current segment group being matched\n+ * @param route The `Route` to match against.\n+ *\n+ * @see UrlMatchResult\n+ * @see Route\n+ *\n+ * @returns The resulting match information or `null` if the `route` should not match.\n+ * @publicApi\n+ */\n export function defaultUrlMatcher(\n     segments: UrlSegment[], segmentGroup: UrlSegmentGroup, route: Route): UrlMatchResult|null {\n   const parts = route.path!.split('/');\n\n\n###\n\n", "completion": "feat(router): Expose the default matcher for `Routes` used by the `Router` (#<issue-num>)"}
{"prompt": " file path A: packages/core/test/bundling/router/bundle.golden_symbols.json | file path B: packages/core/test/bundling/router/bundle.golden_symbols.json\n\n@@ -2,9 +2,6 @@\n   {\n     \"name\": \"ALLOW_MULTIPLE_PLATFORMS\"\n   },\n-  {\n-    \"name\": \"ANALYZE_FOR_ENTRY_COMPONENTS\"\n-  },\n   {\n     \"name\": \"APP_BASE_HREF\"\n   },\n\n---\n file path A: packages/router/src/router_module.ts | file path B: packages/router/src/router_module.ts\n\n@@ -7,7 +7,7 @@\n  */\n \n import {HashLocationStrategy, Location, LOCATION_INITIALIZED, LocationStrategy, PathLocationStrategy, ViewportScroller} from '@angular/common';\n-import {ANALYZE_FOR_ENTRY_COMPONENTS, APP_BOOTSTRAP_LISTENER, APP_INITIALIZER, ApplicationRef, ComponentRef, ENVIRONMENT_INITIALIZER, inject, Inject, InjectFlags, InjectionToken, Injector, ModuleWithProviders, NgModule, NgProbeToken, Optional, Provider, SkipSelf, Type, \u0275RuntimeError as RuntimeError} from '@angular/core';\n+import {APP_BOOTSTRAP_LISTENER, APP_INITIALIZER, ApplicationRef, ComponentRef, ENVIRONMENT_INITIALIZER, inject, Inject, InjectFlags, InjectionToken, Injector, ModuleWithProviders, NgModule, NgProbeToken, Optional, Provider, SkipSelf, Type, \u0275RuntimeError as RuntimeError} from '@angular/core';\n import {of, Subject} from 'rxjs';\n import {filter, map, take} from 'rxjs/operators';\n \n@@ -204,7 +204,6 @@ export function provideForRootGuard(router: Router): any {\n  */\n export function provideRoutes(routes: Routes): any {\n   return [\n-    {provide: ANALYZE_FOR_ENTRY_COMPONENTS, multi: true, useValue: routes},\n     {provide: ROUTES, multi: true, useValue: routes},\n   ];\n }\n\n\n###\n\n", "completion": "refactor(router): Remove unused ANALYZE_FOR_ENTRY_COMPONENTS (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/component-interaction.md | file path B: aio/content/guide/component-interaction.md\n\n@@ -165,7 +165,7 @@ The `CountdownLocalVarParentComponent` that hosts the timer component is as foll\n \n The parent component cannot data bind to the child's `start` and `stop` methods nor to its `seconds` property.\n \n-Place a local variable, `#timer`, on the tag `<countdown-timer>` representing the child component.\n+Place a local variable, `#timer`, on the tag `<app-countdown-timer>` representing the child component.\n That gives you a reference to the child component and the ability to access *any of its properties or methods* from within the parent template.\n \n This example wires parent buttons to the child's `start` and `stop` and uses interpolation to display the child's `seconds` property.\n\n\n###\n\n", "completion": "docs: fix selector in Component Interaction guide (#<issue-num>)"}
{"prompt": " file path A: .devcontainer/README.md | file path B: .devcontainer/README.md\n\n@@ -12,7 +12,7 @@ Info on remote development and developing inside a container with VSCode:\n \n _Prerequisite: [Install Docker](https://docs.docker.com/install) on your local environment._\n \n-To get started, read and follow the instuctions in [Developing inside a Container](https://code.visualstudio.com/docs/remote/containers). The [.devcontainer/](.) directory contains pre-configured `devcontainer.json` and `Dockerfile` files, which you can use to set up remote development with a docker container.\n+To get started, read and follow the instructions in [Developing inside a Container](https://code.visualstudio.com/docs/remote/containers). The [.devcontainer/](.) directory contains pre-configured `devcontainer.json` and `Dockerfile` files, which you can use to set up remote development with a docker container.\n \n In a nutshell, you need to:\n - Install the [Remote - Containers](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers) extension.\n\n---\n file path A: aio/content/guide/dynamic-form.md | file path B: aio/content/guide/dynamic-form.md\n\n@@ -162,7 +162,7 @@ The following figure shows the final form.\n \n | Steps                                           | Details |\n |:---                                             |:---     |\n-| Different types of forms and control collection | This tutorial shows how to build a questionaire, which is just one kind of dynamic form. The example uses `FormGroup` to collect a set of controls. For an example of a different type of dynamic form, see the section [Creating dynamic forms](guide/reactive-forms#creating-dynamic-forms \"Create dynamic forms with arrays\") in the Reactive Forms guide. That example also shows how to use `FormArray` instead of `FormGroup` to collect a set of controls. |\n+| Different types of forms and control collection | This tutorial shows how to build a questionnaire, which is just one kind of dynamic form. The example uses `FormGroup` to collect a set of controls. For an example of a different type of dynamic form, see the section [Creating dynamic forms](guide/reactive-forms#creating-dynamic-forms \"Create dynamic forms with arrays\") in the Reactive Forms guide. That example also shows how to use `FormArray` instead of `FormGroup` to collect a set of controls. |\n | Validating user input                           | The section [Validating form input](guide/reactive-forms#validating-form-input \"Basic input validation\") introduces the basics of how input validation works in reactive forms. <br /> The [Form validation guide](guide/form-validation \"Form validation guide\") covers the topic in more depth.                                                                                                                                                                 |\n \n <!-- links -->\n\n---\n file path A: aio/content/guide/hierarchical-dependency-injection.md | file path B: aio/content/guide/hierarchical-dependency-injection.md\n\n@@ -173,7 +173,7 @@ If the component's injector lacks the provider, it passes the request up to its\n \n The requests keep forwarding up until Angular finds an injector that can handle the request or runs out of ancestor `ElementInjector` hierarchies.\n \n-If Angular doesn't find the provider in any `ElementInjector` hierarchiess, it goes back to the element where the request originated and looks in the `ModuleInjector` hierarchy.\n+If Angular doesn't find the provider in any `ElementInjector` hierarchies, it goes back to the element where the request originated and looks in the `ModuleInjector` hierarchy.\n If Angular still doesn't find the provider, it throws an error.\n \n If you have registered a provider for the same DI token at different levels, the first one Angular encounters is the one it uses to resolve the dependency.\n\n---\n file path A: aio/content/guide/typed-forms.md | file path B: aio/content/guide/typed-forms.md\n\n@@ -72,7 +72,7 @@ email.reset();\n console.log(email.value); // null\n ```\n \n-TypeScript will enforce that you always handle the possibility that the control has become `null`. If you want to make this control non-nullable, you may use the `nonNullable` option. This will cause the control to reset to its intial value, instead of `null`:\n+TypeScript will enforce that you always handle the possibility that the control has become `null`. If you want to make this control non-nullable, you may use the `nonNullable` option. This will cause the control to reset to its initial value, instead of `null`:\n \n ```ts\n const email = new FormControl('angularrox@gmail.com', {nonNullable: true});\n\n---\n file path A: packages/compiler-cli/src/ngtsc/incremental/README.md | file path B: packages/compiler-cli/src/ngtsc/incremental/README.md\n\n@@ -274,7 +274,7 @@ the previous compilation failed, such information may be unreliable.\n \n In theory, the compiler could simply not perform incremental compilation on top of a broken build,\n and assume that it must redo all analysis and re-emit all files, but this would result in\n-devestatingly poor performance for common developer workflows that rely on automatically running\n+devastatingly poor performance for common developer workflows that rely on automatically running\n builds and/or tests on every change. The compiler must deal with such scenarios more gracefully.\n \n ngtsc solves this problem by always performing its incremental steps from a \"last known good\"\n\n---\n file path A: packages/core/test/di/reflective_injector_spec.ts | file path B: packages/core/test/di/reflective_injector_spec.ts\n\n@@ -391,7 +391,7 @@ describe('instantiate', () => {\n   });\n });\n \n-describe('depedency resolution', () => {\n+describe('dependency resolution', () => {\n   describe('@Self()', () => {\n     it('should return a dependency from self', () => {\n       const inj = ReflectiveInjector.resolveAndCreate([\n\n---\n file path A: packages/core/test/linker/ng_module_integration_spec.ts | file path B: packages/core/test/linker/ng_module_integration_spec.ts\n\n@@ -948,7 +948,7 @@ describe('NgModule', () => {\n       });\n     });\n \n-    describe('depedency resolution', () => {\n+    describe('dependency resolution', () => {\n       describe('@Self()', () => {\n         it('should return a dependency from self', () => {\n           const inj = createInjector([\n\n---\n file path A: packages/zone.js/MODULE.md | file path B: packages/zone.js/MODULE.md\n\n@@ -100,7 +100,7 @@ This package will provide following functionality.\n        console.log('is MyError instanceof Error', (myError instanceof Error));\n      ```\n \n-     without `zone-error` patch, the example above will output `false`, with the patch, the reuslt will be `true`.\n+     without `zone-error` patch, the example above will output `false`, with the patch, the result will be `true`.\n \n   2. ZoneJsInternalStackFrames: remove zone.js stack from `stackTrace`, and add `zone`  information. Without this patch, a lot of `zone.js` invocation stack will be shown\n      in stack frames.\n\n---\n file path A: packages/zone.js/test/browser/browser.spec.ts | file path B: packages/zone.js/test/browser/browser.spec.ts\n\n@@ -3141,7 +3141,7 @@ describe('Zone', function() {\n     });\n \n     // TODO: Re-enable via https://github.com/angular/angular/pull/41526\n-    xdescribe('unhandle promise rejection', () => {\n+    xdescribe('unhandled promise rejection', () => {\n       const AsyncTestZoneSpec = (Zone as any)['AsyncTestZoneSpec'];\n       const asyncTest = function(testFn: Function) {\n         return (done: Function) => {\n\n\n###\n\n", "completion": "docs: fixed typos (#<issue-num>)"}
{"prompt": " file path A: packages/zone.js/lib/jasmine/jasmine.ts | file path B: packages/zone.js/lib/jasmine/jasmine.ts\n\n@@ -332,10 +332,6 @@ Zone.__load_patch('jasmine', (global: any, Zone: ZoneType, api: _ZonePrivate) =>\n \n       if (!isChildOfAmbientZone) throw new Error('Unexpected Zone: ' + Zone.current.name);\n \n-\n-      Error.stackTraceLimit = Infinity;\n-      let context = new Error().stack;\n-\n       // This is the zone which will be used for running individual tests.\n       // It will be a proxy zone, so that the tests function can retroactively install\n       // different zones.\n\n\n###\n\n", "completion": "refactor(zone.js): remove leftover debugging code using `Error.stack` (#<issue-num>)"}
{"prompt": " file path A: packages/service-worker/worker/testing/fetch.ts | file path B: packages/service-worker/worker/testing/fetch.ts\n\n@@ -115,7 +115,7 @@ export class MockRequest extends MockBody implements Request {\n   url: string;\n \n   constructor(input: string|Request, init: RequestInit = {}) {\n-    super(init !== undefined ? (init.body as (string | null)) || null : null);\n+    super((init.body as string | null) ?? null);\n     if (typeof input !== 'string') {\n       throw 'Not implemented';\n     }\n\n\n###\n\n", "completion": "test(service-worker): remove redundant ternary operator from `MockRequest` initialization (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/service-worker-notifications.md | file path B: aio/content/guide/service-worker-notifications.md\n\n@@ -58,13 +58,14 @@ The Angular service worker supports the following operations:\n \n | Operations                  | Details |\n |:---                         |:---     |\n-| `openWindow`                | Opens a new tab at the specified URL, which is resolved relative to the service worker scope.                                                                                                            |\n-| `focusLastFocusedOrOpen`    | Focuses the last focused client. If there is no client open, then it opens a new tab at the specified URL, which is resolved relative to the service worker scope.                                       |\n-| `navigateLastFocusedOrOpen` | Focuses the last focused client and navigates it to the specified URL, which is resolved relative to the service worker scope. If there is no client open, then it opens a new tab at the specified URL. |\n+| `openWindow`                | Opens a new tab at the specified URL.                                                                                                            |\n+| `focusLastFocusedOrOpen`    | Focuses the last focused client. If there is no client open, then it opens a new tab at the specified URL.                                       |\n+| `navigateLastFocusedOrOpen` | Focuses the last focused client and navigates it to the specified URL. If there is no client open, then it opens a new tab at the specified URL. |\n | `sendRequest`               | Send a simple GET request to the specified URL.                                                                                                                                                          |\n \n <div class=\"alert is-important\">\n \n+URLs are resolved relative to the service worker's registration scope.<br />\n If an `onActionClick` item does not define a `url`, then the service worker's registration scope is used.\n \n </div>\n\n\n###\n\n", "completion": "docs(service-worker): remove duplication when describing `notificationclick` operations (#<issue-num>)"}
{"prompt": " file path A: aio/content/guide/service-worker-notifications.md | file path B: aio/content/guide/service-worker-notifications.md\n\n@@ -61,11 +61,12 @@ The Angular service worker supports the following operations:\n | `openWindow`                | Opens a new tab at the specified URL, which is resolved relative to the service worker scope.                                                                                                            |\n | `focusLastFocusedOrOpen`    | Focuses the last focused client. If there is no client open, then it opens a new tab at the specified URL, which is resolved relative to the service worker scope.                                       |\n | `navigateLastFocusedOrOpen` | Focuses the last focused client and navigates it to the specified URL, which is resolved relative to the service worker scope. If there is no client open, then it opens a new tab at the specified URL. |\n+| `sendRequest`               | Send a simple GET request to the specified URL.                                                                                                                                                          |\n \n <div class=\"alert is-important\">\n \n If an `onActionClick` item does not define a `url`, then the service worker's registration scope is used.\n-  \n+\n </div>\n \n ### Actions\n@@ -86,14 +87,16 @@ In addition, using the `onActionClick` property on the `data` object, you can ti\n       {\"action\": \"foo\", \"title\": \"Open new tab\"},\n       {\"action\": \"bar\", \"title\": \"Focus last\"},\n       {\"action\": \"baz\", \"title\": \"Navigate last\"},\n-      {\"action\": \"qux\", \"title\": \"Just notify existing clients\"}\n+      {\"action\": \"qux\", \"title\": \"Send request in the background\"}\n+      {\"action\": \"other\", \"title\": \"Just notify existing clients\"}\n     ],\n     \"data\": {\n       \"onActionClick\": {\n         \"default\": {\"operation\": \"openWindow\"},\n         \"foo\": {\"operation\": \"openWindow\", \"url\": \"/absolute/path\"},\n         \"bar\": {\"operation\": \"focusLastFocusedOrOpen\", \"url\": \"relative/path\"},\n-        \"baz\": {\"operation\": \"navigateLastFocusedOrOpen\", \"url\": \"https://other.domain.com/\"}\n+        \"baz\": {\"operation\": \"navigateLastFocusedOrOpen\", \"url\": \"https://other.domain.com/\"},\n+        \"qux\": {\"operation\": \"sendRequest\", \"url\": \"https://yet.another.domain.com/\"}\n       }\n     }\n   }\n\n---\n file path A: packages/service-worker/worker/src/driver.ts | file path B: packages/service-worker/worker/src/driver.ts\n\n@@ -380,6 +380,10 @@ export class Driver implements Debuggable, UpdateSource {\n         }\n         break;\n       }\n+      case 'sendRequest': {\n+        await this.scope.fetch(urlToOpen);\n+        break;\n+      }\n       default:\n         break;\n     }\n\n---\n file path A: packages/service-worker/worker/test/happy_spec.ts | file path B: packages/service-worker/worker/test/happy_spec.ts\n\n@@ -1035,6 +1035,55 @@ describe('Driver', () => {\n         });\n       });\n \n+      describe('`sendRequest` operation', () => {\n+        it('sends a GET request to the specified URL', async () => {\n+          // Initialize the SW.\n+          expect(await makeRequest(scope, '/foo.txt')).toBe('this is foo');\n+          await driver.initialized;\n+          server.clearRequests();\n+\n+          // Trigger a `notificationlick` event.\n+          const url = '/some/url';\n+          await scope.handleClick(\n+              {\n+                title: 'Test notification',\n+                body: 'This is a test notifiction.',\n+                data: {\n+                  onActionClick: {\n+                    foo: {operation: 'sendRequest', url},\n+                  },\n+                },\n+              },\n+              'foo');\n+\n+          // Expect request to the server.\n+          server.assertSawRequestFor('/some/url');\n+        });\n+\n+        it('falls back to sending a request to `/` when no URL is specified', async () => {\n+          // Initialize the SW.\n+          expect(await makeRequest(scope, '/foo.txt')).toBe('this is foo');\n+          await driver.initialized;\n+          server.clearRequests();\n+\n+          // Trigger a `notificationlick` event.\n+          await scope.handleClick(\n+              {\n+                title: 'Test notification',\n+                body: 'This is a test notifiction.',\n+                data: {\n+                  onActionClick: {\n+                    bar: {operation: 'sendRequest'},\n+                  },\n+                },\n+              },\n+              'bar');\n+\n+          // Expect request to the server.\n+          server.assertSawRequestFor('/');\n+        });\n+      });\n+\n       describe('No matching onActionClick field', () => {\n         it('no client interaction', async () => {\n           expect(await makeRequest(scope, '/foo.txt')).toEqual('this is foo');\n\n\n###\n\n", "completion": "feat(service-worker): support `sendRequest` as a `notificationclick` action (#<issue-num>)"}
{"prompt": " file path A: goldens/public-api/compiler-cli/error_code.md | file path B: goldens/public-api/compiler-cli/error_code.md\n\n@@ -31,8 +31,6 @@ export enum ErrorCode {\n     // (undocumented)\n     DECORATOR_NOT_CALLED = 1003,\n     // (undocumented)\n-    DECORATOR_ON_ANONYMOUS_CLASS = 1004,\n-    // (undocumented)\n     DECORATOR_UNEXPECTED = 1005,\n     DIRECTIVE_INHERITS_UNDECORATED_CTOR = 2006,\n     // (undocumented)\n@@ -72,8 +70,6 @@ export enum ErrorCode {\n     SUGGEST_STRICT_TEMPLATES = 10001,\n     SUGGEST_SUBOPTIMAL_TYPE_INFERENCE = 10002,\n     // (undocumented)\n-    SYMBOL_EXPORTED_UNDER_DIFFERENT_NAME = 3002,\n-    // (undocumented)\n     SYMBOL_NOT_EXPORTED = 3001,\n     TEMPLATE_PARSE_ERROR = 5002,\n     TEXT_ATTRIBUTE_NOT_BINDING = 8104,\n\n---\n file path A: packages/compiler-cli/src/ngtsc/diagnostics/src/error_code.ts | file path B: packages/compiler-cli/src/ngtsc/diagnostics/src/error_code.ts\n\n@@ -13,7 +13,6 @@ export enum ErrorCode {\n   DECORATOR_ARG_NOT_LITERAL = 1001,\n   DECORATOR_ARITY_WRONG = 1002,\n   DECORATOR_NOT_CALLED = 1003,\n-  DECORATOR_ON_ANONYMOUS_CLASS = 1004,\n   DECORATOR_UNEXPECTED = 1005,\n \n   /**\n@@ -73,7 +72,6 @@ export enum ErrorCode {\n   COMPONENT_UNKNOWN_IMPORT = 2012,\n \n   SYMBOL_NOT_EXPORTED = 3001,\n-  SYMBOL_EXPORTED_UNDER_DIFFERENT_NAME = 3002,\n   /**\n    * Raised when a relationship between directives and/or pipes would cause a cyclic import to be\n    * created that cannot be handled, such as in partial compilation mode.\n@@ -269,7 +267,7 @@ export enum ErrorCode {\n   /**\n    * Indicates that the binding suffix is not supported\n    *\n-   * Style bindings support suffixes like `stlye.width.px`, `.em`, and `.%`.\n+   * Style bindings support suffixes like `style.width.px`, `.em`, and `.%`.\n    * These suffixes are _not_ supported for attribute bindings.\n    *\n    * For example `[attr.width.px]=\"5\"` becomes `width.px=\"5\"` when bound.\n\n\n###\n\n", "completion": "refactor(compiler-cli): remove unused error codes (#<issue-num>)"}
{"prompt": " file path A: packages/bazel/src/ngc-wrapped/index.ts | file path B: packages/bazel/src/ngc-wrapped/index.ts\n\n@@ -136,6 +136,7 @@ export async function runOneBuild(\n     'i18nInMissingTranslations',\n     'preserveWhitespaces',\n     'createExternalSymbolFactoryReexports',\n+    'extendedDiagnostics',\n   ]);\n \n   const userOverrides = Object.entries(userOptions)\n\n\n###\n\n", "completion": "fix(bazel): allow extendedDiagnostics option to be passed in through tsconfig (#<issue-num>)"}
{"prompt": " file path A: aio/src/app/layout/doc-viewer/doc-viewer.component.ts | file path B: aio/src/app/layout/doc-viewer/doc-viewer.component.ts\n\n@@ -156,13 +156,6 @@ export class DocViewerComponent implements OnDestroy {\n           this.nextViewContainer.textContent = '';\n           this.setNoIndex(true);\n \n-          // TODO(gkalpak): Remove this once gathering debug info is no longer needed.\n-          if (/loading chunk \\S+ failed/i.test(errorMessage)) {\n-            // Print some info to help with debugging.\n-            // (There is no reason to wait for this async call to complete before continuing.)\n-            printSwDebugInfo();\n-          }\n-\n           return this.void$;\n         }),\n     );\n@@ -268,84 +261,3 @@ export class DocViewerComponent implements OnDestroy {\n     );\n   }\n }\n-\n-// Helpers\n-/**\n- * Print some info regarding the ServiceWorker and the caches contents to help debugging potential\n- * issues with failing to find resources in the cache.\n- * (See https://github.com/angular/angular/issues/28114.)\n- */\n-async function printSwDebugInfo(): Promise<void> {\n-  const sep = '\\n----------';\n-  const swState = navigator.serviceWorker?.controller?.state ?? 'N/A';\n-\n-  console.log(`\\nServiceWorker: ${swState}`);\n-\n-  if (typeof caches === 'undefined') {\n-    console.log(`${sep}\\nCaches: N/A`);\n-  } else {\n-    const allCacheNames = await caches.keys();\n-    const swCacheNames = allCacheNames.filter(name => name.startsWith('ngsw:/:'));\n-\n-    await findCachesAndPrintEntries(swCacheNames, 'db:control', true, ['manifests']);\n-    await findCachesAndPrintEntries(swCacheNames, 'assets:app-shell:cache', false);\n-    await findCachesAndPrintEntries(swCacheNames, 'assets:app-shell:meta', true);\n-  }\n-\n-  if (swState === 'activated') {\n-    console.log(sep);\n-    await fetchAndPrintSwInternalDebugInfo();\n-  }\n-\n-  console.warn(\n-      `${sep}\\nIf you see this error, please report an issue at ` +\n-      'https://github.com/angular/angular/issues/new?template=3-docs-bug.md including the above logs.');\n-\n-  // Internal helpers\n-  async function fetchAndPrintSwInternalDebugInfo() {\n-    try {\n-      const res = await fetch('/ngsw/state');\n-      if (!res.ok) {\n-        throw new Error(`Response ${res.status} ${res.statusText}`);\n-      }\n-      console.log(await res.text());\n-    } catch (err) {\n-      console.log(\n-          `Failed to retrieve debug info from '/ngsw/state': ${(err as Error).message || err}`);\n-    }\n-  }\n-\n-  async function findCachesAndPrintEntries(\n-      swCacheNames: string[], nameSuffix: string, includeValues: boolean,\n-      ignoredKeys: string[] = []): Promise<void> {\n-    const cacheNames = swCacheNames.filter(name => name.endsWith(nameSuffix));\n-\n-    for (const cacheName of cacheNames) {\n-      const cacheEntries = await getCacheEntries(cacheName, includeValues, ignoredKeys);\n-      await printCacheEntries(cacheName, cacheEntries);\n-    }\n-  }\n-\n-  async function getCacheEntries(name: string, includeValues: boolean, ignoredKeys: string[] = []):\n-      Promise<{key: string, value?: unknown}[]> {\n-    const ignoredUrls = new Set(ignoredKeys.map(key => new Request(key).url));\n-\n-    const cache = await caches.open(name);\n-    const keys = (await cache.keys()).map(req => req.url).filter(url => !ignoredUrls.has(url));\n-    const entries = await Promise.all(\n-        keys.map(async key => ({\n-                   key,\n-                   value: !includeValues ? undefined : await (await cache.match(key))?.json(),\n-                 })));\n-\n-    return entries;\n-  }\n-\n-  function printCacheEntries(name: string, entries: {key: string, value?: unknown}[]): void {\n-    const entriesStr =\n-        entries.map(({key, value}) => `  - ${key}${!value ? '' : `: ${JSON.stringify(value)}`}`)\n-            .join('\\n');\n-\n-    console.log(`\\nCache: ${name} (${entries.length} entries)\\n${entriesStr}`);\n-  }\n-}\n\n---\n file path A: goldens/size-tracking/aio-payloads.json | file path B: goldens/size-tracking/aio-payloads.json\n\n@@ -2,7 +2,7 @@\n   \"aio\": {\n     \"uncompressed\": {\n       \"runtime\": 4325,\n-      \"main\": 457028,\n+      \"main\": 454820,\n       \"polyfills\": 33814,\n       \"styles\": 73640,\n       \"light-theme\": 78276,\n@@ -12,7 +12,7 @@\n   \"aio-local\": {\n     \"uncompressed\": {\n       \"runtime\": 4325,\n-      \"main\": 457651,\n+      \"main\": 455179,\n       \"polyfills\": 33922,\n       \"styles\": 73640,\n       \"light-theme\": 78045,\n\n\n###\n\n", "completion": "refactor(docs-infra): remove code that prints debug info (#<issue-num>)"}
{"prompt": " file path A: aio/package.json | file path B: aio/package.json\n\n@@ -119,8 +119,8 @@\n     \"@types/node\": \"^12.7.9\",\n     \"@types/trusted-types\": \"^2.0.2\",\n     \"@types/xregexp\": \"^4.3.0\",\n-    \"@typescript-eslint/eslint-plugin\": \"5.30.7\",\n-    \"@typescript-eslint/parser\": \"5.30.7\",\n+    \"@typescript-eslint/eslint-plugin\": \"5.31.0\",\n+    \"@typescript-eslint/parser\": \"5.31.0\",\n     \"@yarnpkg/lockfile\": \"^1.1.0\",\n     \"archiver\": \"^5.3.0\",\n     \"assert\": \"^2.0.0\",\n\n---\n file path A: aio/yarn.lock | file path B: aio/yarn.lock\n\n@@ -2175,14 +2175,14 @@\n   dependencies:\n     \"@types/node\" \"*\"\n \n-\"@typescript-eslint/eslint-plugin@5.30.7\":\n-  version \"5.30.7\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/eslint-plugin/-/eslint-plugin-5.30.7.tgz#1621dabc1ae4084310e19e9efc80dfdbb97e7493\"\n-  integrity sha512-l4L6Do+tfeM2OK0GJsU7TUcM/1oN/N25xHm3Jb4z3OiDU4Lj8dIuxX9LpVMS9riSXQs42D1ieX7b85/r16H9Fw==\n-  dependencies:\n-    \"@typescript-eslint/scope-manager\" \"5.30.7\"\n-    \"@typescript-eslint/type-utils\" \"5.30.7\"\n-    \"@typescript-eslint/utils\" \"5.30.7\"\n+\"@typescript-eslint/eslint-plugin@5.31.0\":\n+  version \"5.31.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/eslint-plugin/-/eslint-plugin-5.31.0.tgz#cae1967b1e569e6171bbc6bec2afa4e0c8efccfe\"\n+  integrity sha512-VKW4JPHzG5yhYQrQ1AzXgVgX8ZAJEvCz0QI6mLRX4tf7rnFfh5D8SKm0Pq6w5PyNfAWJk6sv313+nEt3ohWMBQ==\n+  dependencies:\n+    \"@typescript-eslint/scope-manager\" \"5.31.0\"\n+    \"@typescript-eslint/type-utils\" \"5.31.0\"\n+    \"@typescript-eslint/utils\" \"5.31.0\"\n     debug \"^4.3.4\"\n     functional-red-black-tree \"^1.0.1\"\n     ignore \"^5.2.0\"\n@@ -2190,14 +2190,14 @@\n     semver \"^7.3.7\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/parser@5.30.7\":\n-  version \"5.30.7\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/parser/-/parser-5.30.7.tgz#99d09729392aec9e64b1de45cd63cb81a4ddd980\"\n-  integrity sha512-Rg5xwznHWWSy7v2o0cdho6n+xLhK2gntImp0rJroVVFkcYFYQ8C8UJTSuTw/3CnExBmPjycjmUJkxVmjXsld6A==\n+\"@typescript-eslint/parser@5.31.0\":\n+  version \"5.31.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/parser/-/parser-5.31.0.tgz#7f42d7dcc68a0a6d80a0f3d9a65063aee7bb8d2c\"\n+  integrity sha512-UStjQiZ9OFTFReTrN+iGrC6O/ko9LVDhreEK5S3edmXgR396JGq7CoX2TWIptqt/ESzU2iRKXAHfSF2WJFcWHw==\n   dependencies:\n-    \"@typescript-eslint/scope-manager\" \"5.30.7\"\n-    \"@typescript-eslint/types\" \"5.30.7\"\n-    \"@typescript-eslint/typescript-estree\" \"5.30.7\"\n+    \"@typescript-eslint/scope-manager\" \"5.31.0\"\n+    \"@typescript-eslint/types\" \"5.31.0\"\n+    \"@typescript-eslint/typescript-estree\" \"5.31.0\"\n     debug \"^4.3.4\"\n \n \"@typescript-eslint/scope-manager@5.29.0\":\n@@ -2208,20 +2208,20 @@\n     \"@typescript-eslint/types\" \"5.29.0\"\n     \"@typescript-eslint/visitor-keys\" \"5.29.0\"\n \n-\"@typescript-eslint/scope-manager@5.30.7\":\n-  version \"5.30.7\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/scope-manager/-/scope-manager-5.30.7.tgz#8269a931ef1e5ae68b5eb80743cc515c4ffe3dd7\"\n-  integrity sha512-7BM1bwvdF1UUvt+b9smhqdc/eniOnCKxQT/kj3oXtj3LqnTWCAM0qHRHfyzCzhEfWX0zrW7KqXXeE4DlchZBKw==\n+\"@typescript-eslint/scope-manager@5.31.0\":\n+  version \"5.31.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/scope-manager/-/scope-manager-5.31.0.tgz#f47a794ba84d9b818ab7f8f44fff55a61016c606\"\n+  integrity sha512-8jfEzBYDBG88rcXFxajdVavGxb5/XKXyvWgvD8Qix3EEJLCFIdVloJw+r9ww0wbyNLOTYyBsR+4ALNGdlalLLg==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.30.7\"\n-    \"@typescript-eslint/visitor-keys\" \"5.30.7\"\n+    \"@typescript-eslint/types\" \"5.31.0\"\n+    \"@typescript-eslint/visitor-keys\" \"5.31.0\"\n \n-\"@typescript-eslint/type-utils@5.30.7\":\n-  version \"5.30.7\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/type-utils/-/type-utils-5.30.7.tgz#5693dc3db6f313f302764282d614cfdbc8a9fcfd\"\n-  integrity sha512-nD5qAE2aJX/YLyKMvOU5jvJyku4QN5XBVsoTynFrjQZaDgDV6i7QHFiYCx10wvn7hFvfuqIRNBtsgaLe0DbWhw==\n+\"@typescript-eslint/type-utils@5.31.0\":\n+  version \"5.31.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/type-utils/-/type-utils-5.31.0.tgz#70a0b7201360b5adbddb0c36080495aa08f6f3d9\"\n+  integrity sha512-7ZYqFbvEvYXFn9ax02GsPcEOmuWNg+14HIf4q+oUuLnMbpJ6eHAivCg7tZMVwzrIuzX3QCeAOqKoyMZCv5xe+w==\n   dependencies:\n-    \"@typescript-eslint/utils\" \"5.30.7\"\n+    \"@typescript-eslint/utils\" \"5.31.0\"\n     debug \"^4.3.4\"\n     tsutils \"^3.21.0\"\n \n@@ -2230,10 +2230,10 @@\n   resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.29.0.tgz#7861d3d288c031703b2d97bc113696b4d8c19aab\"\n   integrity sha512-X99VbqvAXOMdVyfFmksMy3u8p8yoRGITgU1joBJPzeYa0rhdf5ok9S56/itRoUSh99fiDoMtarSIJXo7H/SnOg==\n \n-\"@typescript-eslint/types@5.30.7\":\n-  version \"5.30.7\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.30.7.tgz#18331487cc92d0f1fb1a6f580c8ec832528079d0\"\n-  integrity sha512-ocVkETUs82+U+HowkovV6uxf1AnVRKCmDRNUBUUo46/5SQv1owC/EBFkiu4MOHeZqhKz2ktZ3kvJJ1uFqQ8QPg==\n+\"@typescript-eslint/types@5.31.0\":\n+  version \"5.31.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/types/-/types-5.31.0.tgz#7aa389122b64b18e473c1672fb3b8310e5f07a9a\"\n+  integrity sha512-/f/rMaEseux+I4wmR6mfpM2wvtNZb1p9hAV77hWfuKc3pmaANp5dLAZSiE3/8oXTYTt3uV9KW5yZKJsMievp6g==\n \n \"@typescript-eslint/typescript-estree@5.29.0\":\n   version \"5.29.0\"\n@@ -2248,13 +2248,13 @@\n     semver \"^7.3.7\"\n     tsutils \"^3.21.0\"\n \n-\"@typescript-eslint/typescript-estree@5.30.7\":\n-  version \"5.30.7\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/typescript-estree/-/typescript-estree-5.30.7.tgz#05da9f1b281985bfedcf62349847f8d168eecc07\"\n-  integrity sha512-tNslqXI1ZdmXXrHER83TJ8OTYl4epUzJC0aj2i4DMDT4iU+UqLT3EJeGQvJ17BMbm31x5scSwo3hPM0nqQ1AEA==\n+\"@typescript-eslint/typescript-estree@5.31.0\":\n+  version \"5.31.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/typescript-estree/-/typescript-estree-5.31.0.tgz#eb92970c9d6e3946690d50c346fb9b1d745ee882\"\n+  integrity sha512-3S625TMcARX71wBc2qubHaoUwMEn+l9TCsaIzYI/ET31Xm2c9YQ+zhGgpydjorwQO9pLfR/6peTzS/0G3J/hDw==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.30.7\"\n-    \"@typescript-eslint/visitor-keys\" \"5.30.7\"\n+    \"@typescript-eslint/types\" \"5.31.0\"\n+    \"@typescript-eslint/visitor-keys\" \"5.31.0\"\n     debug \"^4.3.4\"\n     globby \"^11.1.0\"\n     is-glob \"^4.0.3\"\n@@ -2273,15 +2273,15 @@\n     eslint-scope \"^5.1.1\"\n     eslint-utils \"^3.0.0\"\n \n-\"@typescript-eslint/utils@5.30.7\":\n-  version \"5.30.7\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/utils/-/utils-5.30.7.tgz#7135be070349e9f7caa262b0ca59dc96123351bb\"\n-  integrity sha512-Z3pHdbFw+ftZiGUnm1GZhkJgVqsDL5CYW2yj+TB2mfXDFOMqtbzQi2dNJIyPqPbx9mv2kUxS1gU+r2gKlKi1rQ==\n+\"@typescript-eslint/utils@5.31.0\":\n+  version \"5.31.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/utils/-/utils-5.31.0.tgz#e146fa00dca948bfe547d665b2138a2dc1b79acd\"\n+  integrity sha512-kcVPdQS6VIpVTQ7QnGNKMFtdJdvnStkqS5LeALr4rcwx11G6OWb2HB17NMPnlRHvaZP38hL9iK8DdE9Fne7NYg==\n   dependencies:\n     \"@types/json-schema\" \"^7.0.9\"\n-    \"@typescript-eslint/scope-manager\" \"5.30.7\"\n-    \"@typescript-eslint/types\" \"5.30.7\"\n-    \"@typescript-eslint/typescript-estree\" \"5.30.7\"\n+    \"@typescript-eslint/scope-manager\" \"5.31.0\"\n+    \"@typescript-eslint/types\" \"5.31.0\"\n+    \"@typescript-eslint/typescript-estree\" \"5.31.0\"\n     eslint-scope \"^5.1.1\"\n     eslint-utils \"^3.0.0\"\n \n@@ -2293,12 +2293,12 @@\n     \"@typescript-eslint/types\" \"5.29.0\"\n     eslint-visitor-keys \"^3.3.0\"\n \n-\"@typescript-eslint/visitor-keys@5.30.7\":\n-  version \"5.30.7\"\n-  resolved \"https://registry.yarnpkg.com/@typescript-eslint/visitor-keys/-/visitor-keys-5.30.7.tgz#c093abae75b4fd822bfbad9fc337f38a7a14909a\"\n-  integrity sha512-KrRXf8nnjvcpxDFOKej4xkD7657+PClJs5cJVSG7NNoCNnjEdc46juNAQt7AyuWctuCgs6mVRc1xGctEqrjxWw==\n+\"@typescript-eslint/visitor-keys@5.31.0\":\n+  version \"5.31.0\"\n+  resolved \"https://registry.yarnpkg.com/@typescript-eslint/visitor-keys/-/visitor-keys-5.31.0.tgz#b0eca264df01ce85dceb76aebff3784629258f54\"\n+  integrity sha512-ZK0jVxSjS4gnPirpVjXHz7mgdOsZUHzNYSfTw2yPa3agfbt9YfqaBiBZFSSxeBWnpWkzCxTfUpnzA3Vily/CSg==\n   dependencies:\n-    \"@typescript-eslint/types\" \"5.30.7\"\n+    \"@typescript-eslint/types\" \"5.31.0\"\n     eslint-visitor-keys \"^3.3.0\"\n \n \"@webassemblyjs/ast@1.11.1\":\n\n\n###\n\n", "completion": "build: update eslint dependencies to v5.31.0 (#<issue-num>)"}
{"prompt": " file path A: WORKSPACE | file path B: WORKSPACE\n\n@@ -158,10 +158,10 @@ cldr_xml_data_repository(\n # sass rules\n http_archive(\n     name = \"io_bazel_rules_sass\",\n-    sha256 = \"2f86f221636cf721bd118ac954d0c982ef16cb3f795794ce17a5e0b7e62e103b\",\n-    strip_prefix = \"rules_sass-eda73f679f50d1d30599cebb8cc1bbc5ae43d5c6\",\n+    sha256 = \"3e0e115f380227f7f186bcfce29b125e4a02536b6c309f80912ee0d6b79a6e71\",\n+    strip_prefix = \"rules_sass-030f696dcf32508b264c469f26d031f7996dea4c\",\n     urls = [\n-        \"https://github.com/bazelbuild/rules_sass/archive/eda73f679f50d1d30599cebb8cc1bbc5ae43d5c6.zip\",\n+        \"https://github.com/bazelbuild/rules_sass/archive/030f696dcf32508b264c469f26d031f7996dea4c.zip\",\n     ],\n )\n \n\n\n###\n\n", "completion": "build: update io_bazel_rules_sass digest to 030f696 (#<issue-num>)"}
{"prompt": " file path A: package.json | file path B: package.json\n\n@@ -128,7 +128,7 @@\n     \"diff\": \"^5.0.0\",\n     \"document-register-element\": \"^1.7.2\",\n     \"domino\": \"~2.1.6\",\n-    \"google-closure-compiler\": \"20220601.0.0\",\n+    \"google-closure-compiler\": \"20220719.0.0\",\n     \"graceful-fs\": \"4.2.10\",\n     \"hammerjs\": \"~2.0.8\",\n     \"http-server\": \"^14.0.0\",\n\n---\n file path A: packages/zone.js/package.json | file path B: packages/zone.js/package.json\n\n@@ -15,7 +15,7 @@\n     \"@types/node\": \"^10.9.4\",\n     \"domino\": \"2.1.6\",\n     \"jest\": \"^26.4\",\n-    \"google-closure-compiler\": \"^20220601.0.0\",\n+    \"google-closure-compiler\": \"^20220719.0.0\",\n     \"mocha\": \"^10.0.0\",\n     \"mock-require\": \"3.0.3\",\n     \"promises-aplus-tests\": \"^2.1.2\",\n\n---\n file path A: packages/zone.js/yarn.lock | file path B: packages/zone.js/yarn.lock\n\n@@ -1755,40 +1755,40 @@ globals@^11.1.0:\n   resolved \"https://registry.yarnpkg.com/globals/-/globals-11.12.0.tgz#ab8795338868a0babd8525758018c2a7eb95c42e\"\n   integrity sha512-WOBp/EEGUiIsJSp7wcv/y6MO+lV9UoncWqxuFfm8eBwzWNgyfBd6Gz+IeKQ9jCmyhoH99g15M3T+QaVHFjizVA==\n \n-google-closure-compiler-java@^20220601.0.0:\n-  version \"20220601.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-java/-/google-closure-compiler-java-20220601.0.0.tgz#bc0aa67f15c6ac4893dba8ab0b8fa6300e3ee76a\"\n-  integrity sha512-PMlzO2SbwKEm+V3xxigVYqa51e7XPnfsf4VAXS4Bx43ol6xkZnPTgZchGIfxDOMYOch2WlGMY8+/QDEluR/7DQ==\n-\n-google-closure-compiler-linux@^20220601.0.0:\n-  version \"20220601.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-linux/-/google-closure-compiler-linux-20220601.0.0.tgz#468cd878f231d19e180a7046c57e6dafaa5c45fa\"\n-  integrity sha512-ZhEzQ4oCAkbVimkeL84ec+hC1Olcy9dq97q7RhHoSQf4o/oDvEFbIfbeL5tHvIQlv3Ez+TkhRHXvnxam8MYw2Q==\n-\n-google-closure-compiler-osx@^20220601.0.0:\n-  version \"20220601.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-osx/-/google-closure-compiler-osx-20220601.0.0.tgz#1b19367ccedfa949ca54943bae793e86830a0be8\"\n-  integrity sha512-0fhGb08xiSVFzRnC7DUz9v4WfouIWu/GozSAUbDx/u6TnQvkz0ImQTOis37BzgRHoWMQ+1JTwYndRww23JuBWQ==\n-\n-google-closure-compiler-windows@^20220601.0.0:\n-  version \"20220601.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-windows/-/google-closure-compiler-windows-20220601.0.0.tgz#03a35ed2a438b9647cfb958e26466e67de14f7ae\"\n-  integrity sha512-AhZrbTjP2qfltibrFyZ8j4ZAYuqKVks6XUnqaYaXvF1bhwS16hkJC4ZkSxWiLMHTgnUu0lqUIy4FwuEWlTMN1g==\n-\n-google-closure-compiler@^20220601.0.0:\n-  version \"20220601.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler/-/google-closure-compiler-20220601.0.0.tgz#16a8218976fd14e81989bfb6ff685d660558c857\"\n-  integrity sha512-bK0nEtDoQ8WcAtGtEhWu/+OEyzmNp9yCMFc5jLeOajoUuclHWxbjMeJ2eHyMPvvuvoLprollVapyQSAlO+dMIw==\n+google-closure-compiler-java@^20220719.0.0:\n+  version \"20220719.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-java/-/google-closure-compiler-java-20220719.0.0.tgz#a6dc7c7a7e58670d17467c64a77b2fd94418e38e\"\n+  integrity sha512-tjWdQSkFqxaFCgzUBaiJj2CxrWUYV0Ij2txp9Um+GyvrzMeX9rqHSUeW4I9cGpOrXkamvWCyAig4Yi0NZXApdg==\n+\n+google-closure-compiler-linux@^20220719.0.0:\n+  version \"20220719.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-linux/-/google-closure-compiler-linux-20220719.0.0.tgz#85ebdf3da6aaeee094295d6fc2be23324cf386c9\"\n+  integrity sha512-Em8QEAH7RC8T41QgTZC2keO0gsNdQgburXuXoF6gv2ySD/kJvNqrlZCCqLZMZUF6iuCpu3PgnMahdd3IrLpprA==\n+\n+google-closure-compiler-osx@^20220719.0.0:\n+  version \"20220719.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-osx/-/google-closure-compiler-osx-20220719.0.0.tgz#e97246adffc109a64bd79bcfdf964c78664c66da\"\n+  integrity sha512-NwOLgq0ftq0kY1jum6vrafwUMQrCJEpJu6wv5fW/TnYUprPJb1J0T7c4Su8wSm9rdvpqkkqWWMGpfb9RJBuM0g==\n+\n+google-closure-compiler-windows@^20220719.0.0:\n+  version \"20220719.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-windows/-/google-closure-compiler-windows-20220719.0.0.tgz#1177d2d27515d7d0867cdc4e258b32b499a6c005\"\n+  integrity sha512-Qi88lkU7a45SzCwdd9CV1D6paiiF7cEpBefkJIaNKi9MBfOZueHZH7Y8/56rdMhJLRjv5VMCGoJY4xH6FcXkvg==\n+\n+google-closure-compiler@^20220719.0.0:\n+  version \"20220719.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler/-/google-closure-compiler-20220719.0.0.tgz#234a53e0a09ea04ae04df6bab877e9c833afbd8f\"\n+  integrity sha512-0KTxUoX8WBZGeprvZfzp+czdi6wJ5wfJnG4RsIMEPFLR67fW4f+ghh04WSBLBt8kgT64NxaZGESjq23v0dbYNg==\n   dependencies:\n     chalk \"2.x\"\n-    google-closure-compiler-java \"^20220601.0.0\"\n+    google-closure-compiler-java \"^20220719.0.0\"\n     minimist \"1.x\"\n     vinyl \"2.x\"\n     vinyl-sourcemaps-apply \"^0.2.0\"\n   optionalDependencies:\n-    google-closure-compiler-linux \"^20220601.0.0\"\n-    google-closure-compiler-osx \"^20220601.0.0\"\n-    google-closure-compiler-windows \"^20220601.0.0\"\n+    google-closure-compiler-linux \"^20220719.0.0\"\n+    google-closure-compiler-osx \"^20220719.0.0\"\n+    google-closure-compiler-windows \"^20220719.0.0\"\n \n graceful-fs@^4.2.4:\n   version \"4.2.10\"\n\n---\n file path A: yarn.lock | file path B: yarn.lock\n\n@@ -7980,40 +7980,40 @@ google-auth-library@^8.0.2:\n     jws \"^4.0.0\"\n     lru-cache \"^6.0.0\"\n \n-google-closure-compiler-java@^20220601.0.0:\n-  version \"20220601.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-java/-/google-closure-compiler-java-20220601.0.0.tgz#bc0aa67f15c6ac4893dba8ab0b8fa6300e3ee76a\"\n-  integrity sha512-PMlzO2SbwKEm+V3xxigVYqa51e7XPnfsf4VAXS4Bx43ol6xkZnPTgZchGIfxDOMYOch2WlGMY8+/QDEluR/7DQ==\n-\n-google-closure-compiler-linux@^20220601.0.0:\n-  version \"20220601.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-linux/-/google-closure-compiler-linux-20220601.0.0.tgz#468cd878f231d19e180a7046c57e6dafaa5c45fa\"\n-  integrity sha512-ZhEzQ4oCAkbVimkeL84ec+hC1Olcy9dq97q7RhHoSQf4o/oDvEFbIfbeL5tHvIQlv3Ez+TkhRHXvnxam8MYw2Q==\n-\n-google-closure-compiler-osx@^20220601.0.0:\n-  version \"20220601.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-osx/-/google-closure-compiler-osx-20220601.0.0.tgz#1b19367ccedfa949ca54943bae793e86830a0be8\"\n-  integrity sha512-0fhGb08xiSVFzRnC7DUz9v4WfouIWu/GozSAUbDx/u6TnQvkz0ImQTOis37BzgRHoWMQ+1JTwYndRww23JuBWQ==\n-\n-google-closure-compiler-windows@^20220601.0.0:\n-  version \"20220601.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler-windows/-/google-closure-compiler-windows-20220601.0.0.tgz#03a35ed2a438b9647cfb958e26466e67de14f7ae\"\n-  integrity sha512-AhZrbTjP2qfltibrFyZ8j4ZAYuqKVks6XUnqaYaXvF1bhwS16hkJC4ZkSxWiLMHTgnUu0lqUIy4FwuEWlTMN1g==\n-\n-google-closure-compiler@20220601.0.0:\n-  version \"20220601.0.0\"\n-  resolved \"https://registry.yarnpkg.com/google-closure-compiler/-/google-closure-compiler-20220601.0.0.tgz#16a8218976fd14e81989bfb6ff685d660558c857\"\n-  integrity sha512-bK0nEtDoQ8WcAtGtEhWu/+OEyzmNp9yCMFc5jLeOajoUuclHWxbjMeJ2eHyMPvvuvoLprollVapyQSAlO+dMIw==\n+google-closure-compiler-java@^20220719.0.0:\n+  version \"20220719.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-java/-/google-closure-compiler-java-20220719.0.0.tgz#a6dc7c7a7e58670d17467c64a77b2fd94418e38e\"\n+  integrity sha512-tjWdQSkFqxaFCgzUBaiJj2CxrWUYV0Ij2txp9Um+GyvrzMeX9rqHSUeW4I9cGpOrXkamvWCyAig4Yi0NZXApdg==\n+\n+google-closure-compiler-linux@^20220719.0.0:\n+  version \"20220719.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-linux/-/google-closure-compiler-linux-20220719.0.0.tgz#85ebdf3da6aaeee094295d6fc2be23324cf386c9\"\n+  integrity sha512-Em8QEAH7RC8T41QgTZC2keO0gsNdQgburXuXoF6gv2ySD/kJvNqrlZCCqLZMZUF6iuCpu3PgnMahdd3IrLpprA==\n+\n+google-closure-compiler-osx@^20220719.0.0:\n+  version \"20220719.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-osx/-/google-closure-compiler-osx-20220719.0.0.tgz#e97246adffc109a64bd79bcfdf964c78664c66da\"\n+  integrity sha512-NwOLgq0ftq0kY1jum6vrafwUMQrCJEpJu6wv5fW/TnYUprPJb1J0T7c4Su8wSm9rdvpqkkqWWMGpfb9RJBuM0g==\n+\n+google-closure-compiler-windows@^20220719.0.0:\n+  version \"20220719.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler-windows/-/google-closure-compiler-windows-20220719.0.0.tgz#1177d2d27515d7d0867cdc4e258b32b499a6c005\"\n+  integrity sha512-Qi88lkU7a45SzCwdd9CV1D6paiiF7cEpBefkJIaNKi9MBfOZueHZH7Y8/56rdMhJLRjv5VMCGoJY4xH6FcXkvg==\n+\n+google-closure-compiler@20220719.0.0:\n+  version \"20220719.0.0\"\n+  resolved \"https://registry.yarnpkg.com/google-closure-compiler/-/google-closure-compiler-20220719.0.0.tgz#234a53e0a09ea04ae04df6bab877e9c833afbd8f\"\n+  integrity sha512-0KTxUoX8WBZGeprvZfzp+czdi6wJ5wfJnG4RsIMEPFLR67fW4f+ghh04WSBLBt8kgT64NxaZGESjq23v0dbYNg==\n   dependencies:\n     chalk \"2.x\"\n-    google-closure-compiler-java \"^20220601.0.0\"\n+    google-closure-compiler-java \"^20220719.0.0\"\n     minimist \"1.x\"\n     vinyl \"2.x\"\n     vinyl-sourcemaps-apply \"^0.2.0\"\n   optionalDependencies:\n-    google-closure-compiler-linux \"^20220601.0.0\"\n-    google-closure-compiler-osx \"^20220601.0.0\"\n-    google-closure-compiler-windows \"^20220601.0.0\"\n+    google-closure-compiler-linux \"^20220719.0.0\"\n+    google-closure-compiler-osx \"^20220719.0.0\"\n+    google-closure-compiler-windows \"^20220719.0.0\"\n \n google-gax@^3.0.1:\n   version \"3.1.3\"\n\n\n###\n\n", "completion": "build: update dependency google-closure-compiler to v20220719 (#<issue-num>)"}
